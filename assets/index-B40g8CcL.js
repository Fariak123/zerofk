var GF=Object.defineProperty;var WF=(e,t,r)=>t in e?GF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Kl=(e,t,r)=>WF(e,typeof t!="symbol"?t+"":t,r);function HF(e,t){for(var r=0;r<t.length;r++){const i=t[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in e)){const o=Object.getOwnPropertyDescriptor(i,n);o&&Object.defineProperty(e,n,o.get?o:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();function KF(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $P={exports:{}},m_={},qP={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qu=Symbol.for("react.element"),zF=Symbol.for("react.portal"),YF=Symbol.for("react.fragment"),$F=Symbol.for("react.strict_mode"),qF=Symbol.for("react.profiler"),XF=Symbol.for("react.provider"),JF=Symbol.for("react.context"),QF=Symbol.for("react.forward_ref"),ZF=Symbol.for("react.suspense"),eB=Symbol.for("react.memo"),tB=Symbol.for("react.lazy"),$R=Symbol.iterator;function rB(e){return e===null||typeof e!="object"?null:(e=$R&&e[$R]||e["@@iterator"],typeof e=="function"?e:null)}var XP={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},JP=Object.assign,QP={};function wl(e,t,r){this.props=e,this.context=t,this.refs=QP,this.updater=r||XP}wl.prototype.isReactComponent={};wl.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};wl.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function ZP(){}ZP.prototype=wl.prototype;function Lv(e,t,r){this.props=e,this.context=t,this.refs=QP,this.updater=r||XP}var Mv=Lv.prototype=new ZP;Mv.constructor=Lv;JP(Mv,wl.prototype);Mv.isPureReactComponent=!0;var qR=Array.isArray,ek=Object.prototype.hasOwnProperty,Uv={current:null},tk={key:!0,ref:!0,__self:!0,__source:!0};function rk(e,t,r){var i,n={},o=null,a=null;if(t!=null)for(i in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(o=""+t.key),t)ek.call(t,i)&&!tk.hasOwnProperty(i)&&(n[i]=t[i]);var s=arguments.length-2;if(s===1)n.children=r;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];n.children=c}if(e&&e.defaultProps)for(i in s=e.defaultProps,s)n[i]===void 0&&(n[i]=s[i]);return{$$typeof:qu,type:e,key:o,ref:a,props:n,_owner:Uv.current}}function iB(e,t){return{$$typeof:qu,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function xv(e){return typeof e=="object"&&e!==null&&e.$$typeof===qu}function nB(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var XR=/\/+/g;function Em(e,t){return typeof e=="object"&&e!==null&&e.key!=null?nB(""+e.key):t.toString(36)}function Dp(e,t,r,i,n){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case qu:case zF:a=!0}}if(a)return a=e,n=n(a),e=i===""?"."+Em(a,0):i,qR(n)?(r="",e!=null&&(r=e.replace(XR,"$&/")+"/"),Dp(n,t,r,"",function(l){return l})):n!=null&&(xv(n)&&(n=iB(n,r+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(XR,"$&/")+"/")+e)),t.push(n)),1;if(a=0,i=i===""?".":i+":",qR(e))for(var s=0;s<e.length;s++){o=e[s];var c=i+Em(o,s);a+=Dp(o,t,r,c,n)}else if(c=rB(e),typeof c=="function")for(e=c.call(e),s=0;!(o=e.next()).done;)o=o.value,c=i+Em(o,s++),a+=Dp(o,t,r,c,n);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function gh(e,t,r){if(e==null)return e;var i=[],n=0;return Dp(e,i,"","",function(o){return t.call(r,o,n++)}),i}function oB(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ni={current:null},Pp={transition:null},aB={ReactCurrentDispatcher:ni,ReactCurrentBatchConfig:Pp,ReactCurrentOwner:Uv};function ik(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:gh,forEach:function(e,t,r){gh(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return gh(e,function(){t++}),t},toArray:function(e){return gh(e,function(t){return t})||[]},only:function(e){if(!xv(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};He.Component=wl;He.Fragment=YF;He.Profiler=qF;He.PureComponent=Lv;He.StrictMode=$F;He.Suspense=ZF;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aB;He.act=ik;He.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=JP({},e.props),n=e.key,o=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,a=Uv.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(c in t)ek.call(t,c)&&!tk.hasOwnProperty(c)&&(i[c]=t[c]===void 0&&s!==void 0?s[c]:t[c])}var c=arguments.length-2;if(c===1)i.children=r;else if(1<c){s=Array(c);for(var l=0;l<c;l++)s[l]=arguments[l+2];i.children=s}return{$$typeof:qu,type:e.type,key:n,ref:o,props:i,_owner:a}};He.createContext=function(e){return e={$$typeof:JF,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:XF,_context:e},e.Consumer=e};He.createElement=rk;He.createFactory=function(e){var t=rk.bind(null,e);return t.type=e,t};He.createRef=function(){return{current:null}};He.forwardRef=function(e){return{$$typeof:QF,render:e}};He.isValidElement=xv;He.lazy=function(e){return{$$typeof:tB,_payload:{_status:-1,_result:e},_init:oB}};He.memo=function(e,t){return{$$typeof:eB,type:e,compare:t===void 0?null:t}};He.startTransition=function(e){var t=Pp.transition;Pp.transition={};try{e()}finally{Pp.transition=t}};He.unstable_act=ik;He.useCallback=function(e,t){return ni.current.useCallback(e,t)};He.useContext=function(e){return ni.current.useContext(e)};He.useDebugValue=function(){};He.useDeferredValue=function(e){return ni.current.useDeferredValue(e)};He.useEffect=function(e,t){return ni.current.useEffect(e,t)};He.useId=function(){return ni.current.useId()};He.useImperativeHandle=function(e,t,r){return ni.current.useImperativeHandle(e,t,r)};He.useInsertionEffect=function(e,t){return ni.current.useInsertionEffect(e,t)};He.useLayoutEffect=function(e,t){return ni.current.useLayoutEffect(e,t)};He.useMemo=function(e,t){return ni.current.useMemo(e,t)};He.useReducer=function(e,t,r){return ni.current.useReducer(e,t,r)};He.useRef=function(e){return ni.current.useRef(e)};He.useState=function(e){return ni.current.useState(e)};He.useSyncExternalStore=function(e,t,r){return ni.current.useSyncExternalStore(e,t,r)};He.useTransition=function(){return ni.current.useTransition()};He.version="18.3.1";qP.exports=He;var H=qP.exports;const nk=KF(H),sB=HF({__proto__:null,default:nk},[H]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cB=H,lB=Symbol.for("react.element"),dB=Symbol.for("react.fragment"),uB=Object.prototype.hasOwnProperty,hB=cB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pB={key:!0,ref:!0,__self:!0,__source:!0};function ok(e,t,r){var i,n={},o=null,a=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(a=t.ref);for(i in t)uB.call(t,i)&&!pB.hasOwnProperty(i)&&(n[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)n[i]===void 0&&(n[i]=t[i]);return{$$typeof:lB,type:e,key:o,ref:a,props:n,_owner:hB.current}}m_.Fragment=dB;m_.jsx=ok;m_.jsxs=ok;$P.exports=m_;var W=$P.exports,TS={},ak={exports:{}},Fi={},sk={exports:{}},ck={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(L,B){var N=L.length;L.push(B);e:for(;0<N;){var m=N-1>>>1,C=L[m];if(0<n(C,B))L[m]=B,L[N]=C,N=m;else break e}}function r(L){return L.length===0?null:L[0]}function i(L){if(L.length===0)return null;var B=L[0],N=L.pop();if(N!==B){L[0]=N;e:for(var m=0,C=L.length,A=C>>>1;m<A;){var F=2*(m+1)-1,ae=L[F],Re=F+1,st=L[Re];if(0>n(ae,N))Re<C&&0>n(st,ae)?(L[m]=st,L[Re]=N,m=Re):(L[m]=ae,L[F]=N,m=F);else if(Re<C&&0>n(st,N))L[m]=st,L[Re]=N,m=Re;else break e}}return B}function n(L,B){var N=L.sortIndex-B.sortIndex;return N!==0?N:L.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var c=[],l=[],d=1,u=null,h=3,p=!1,g=!1,_=!1,E=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(L){for(var B=r(l);B!==null;){if(B.callback===null)i(l);else if(B.startTime<=L)i(l),B.sortIndex=B.expirationTime,t(c,B);else break;B=r(l)}}function I(L){if(_=!1,y(L),!g)if(r(c)!==null)g=!0,pr(O);else{var B=r(l);B!==null&&x(I,B.startTime-L)}}function O(L,B){g=!1,_&&(_=!1,S(P),P=-1),p=!0;var N=h;try{for(y(B),u=r(c);u!==null&&(!(u.expirationTime>B)||L&&!ce());){var m=u.callback;if(typeof m=="function"){u.callback=null,h=u.priorityLevel;var C=m(u.expirationTime<=B);B=e.unstable_now(),typeof C=="function"?u.callback=C:u===r(c)&&i(c),y(B)}else i(c);u=r(c)}if(u!==null)var A=!0;else{var F=r(l);F!==null&&x(I,F.startTime-B),A=!1}return A}finally{u=null,h=N,p=!1}}var b=!1,k=null,P=-1,j=5,G=-1;function ce(){return!(e.unstable_now()-G<j)}function pe(){if(k!==null){var L=e.unstable_now();G=L;var B=!0;try{B=k(!0,L)}finally{B?Ae():(b=!1,k=null)}}else b=!1}var Ae;if(typeof T=="function")Ae=function(){T(pe)};else if(typeof MessageChannel<"u"){var Ge=new MessageChannel,at=Ge.port2;Ge.port1.onmessage=pe,Ae=function(){at.postMessage(null)}}else Ae=function(){E(pe,0)};function pr(L){k=L,b||(b=!0,Ae())}function x(L,B){P=E(function(){L(e.unstable_now())},B)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_continueExecution=function(){g||p||(g=!0,pr(O))},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(L){switch(h){case 1:case 2:case 3:var B=3;break;default:B=h}var N=h;h=B;try{return L()}finally{h=N}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(L,B){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var N=h;h=L;try{return B()}finally{h=N}},e.unstable_scheduleCallback=function(L,B,N){var m=e.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?m+N:m):N=m,L){case 1:var C=-1;break;case 2:C=250;break;case 5:C=1073741823;break;case 4:C=1e4;break;default:C=5e3}return C=N+C,L={id:d++,callback:B,priorityLevel:L,startTime:N,expirationTime:C,sortIndex:-1},N>m?(L.sortIndex=N,t(l,L),r(c)===null&&L===r(l)&&(_?(S(P),P=-1):_=!0,x(I,N-m))):(L.sortIndex=C,t(c,L),g||p||(g=!0,pr(O))),L},e.unstable_shouldYield=ce,e.unstable_wrapCallback=function(L){var B=h;return function(){var N=h;h=B;try{return L.apply(this,arguments)}finally{h=N}}}})(ck);sk.exports=ck;var fB=sk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _B=H,Vi=fB;function ee(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lk=new Set,ou={};function Ws(e,t){sl(e,t),sl(e+"Capture",t)}function sl(e,t){for(ou[e]=t,e=0;e<t.length;e++)lk.add(t[e])}var Fo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vS=Object.prototype.hasOwnProperty,mB=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,JR={},QR={};function EB(e){return vS.call(QR,e)?!0:vS.call(JR,e)?!1:mB.test(e)?QR[e]=!0:(JR[e]=!0,!1)}function gB(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function SB(e,t,r,i){if(t===null||typeof t>"u"||gB(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function oi(e,t,r,i,n,o,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var xr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){xr[e]=new oi(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];xr[t]=new oi(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){xr[e]=new oi(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){xr[e]=new oi(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){xr[e]=new oi(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){xr[e]=new oi(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){xr[e]=new oi(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){xr[e]=new oi(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){xr[e]=new oi(e,5,!1,e.toLowerCase(),null,!1,!1)});var Vv=/[\-:]([a-z])/g;function Fv(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Vv,Fv);xr[t]=new oi(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Vv,Fv);xr[t]=new oi(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Vv,Fv);xr[t]=new oi(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){xr[e]=new oi(e,1,!1,e.toLowerCase(),null,!1,!1)});xr.xlinkHref=new oi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){xr[e]=new oi(e,1,!1,e.toLowerCase(),null,!0,!0)});function Bv(e,t,r,i){var n=xr.hasOwnProperty(t)?xr[t]:null;(n!==null?n.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(SB(t,r,n,i)&&(r=null),i||n===null?EB(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):n.mustUseProperty?e[n.propertyName]=r===null?n.type===3?!1:"":r:(t=n.attributeName,i=n.attributeNamespace,r===null?e.removeAttribute(t):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var Ho=_B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Sh=Symbol.for("react.element"),yc=Symbol.for("react.portal"),Rc=Symbol.for("react.fragment"),jv=Symbol.for("react.strict_mode"),yS=Symbol.for("react.profiler"),dk=Symbol.for("react.provider"),uk=Symbol.for("react.context"),Gv=Symbol.for("react.forward_ref"),RS=Symbol.for("react.suspense"),CS=Symbol.for("react.suspense_list"),Wv=Symbol.for("react.memo"),sa=Symbol.for("react.lazy"),hk=Symbol.for("react.offscreen"),ZR=Symbol.iterator;function zl(e){return e===null||typeof e!="object"?null:(e=ZR&&e[ZR]||e["@@iterator"],typeof e=="function"?e:null)}var Yt=Object.assign,gm;function gd(e){if(gm===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);gm=t&&t[1]||""}return`
`+gm+e}var Sm=!1;function Tm(e,t){if(!e||Sm)return"";Sm=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var n=l.stack.split(`
`),o=i.stack.split(`
`),a=n.length-1,s=o.length-1;1<=a&&0<=s&&n[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(n[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||n[a]!==o[s]){var c=`
`+n[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=a&&0<=s);break}}}finally{Sm=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?gd(e):""}function TB(e){switch(e.tag){case 5:return gd(e.type);case 16:return gd("Lazy");case 13:return gd("Suspense");case 19:return gd("SuspenseList");case 0:case 2:case 15:return e=Tm(e.type,!1),e;case 11:return e=Tm(e.type.render,!1),e;case 1:return e=Tm(e.type,!0),e;default:return""}}function IS(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Rc:return"Fragment";case yc:return"Portal";case yS:return"Profiler";case jv:return"StrictMode";case RS:return"Suspense";case CS:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case uk:return(e.displayName||"Context")+".Consumer";case dk:return(e._context.displayName||"Context")+".Provider";case Gv:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Wv:return t=e.displayName||null,t!==null?t:IS(e.type)||"Memo";case sa:t=e._payload,e=e._init;try{return IS(e(t))}catch{}}return null}function vB(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return IS(t);case 8:return t===jv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Fa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function pk(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function yB(e){var t=pk(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(a){i=""+a,o.call(this,a)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Th(e){e._valueTracker||(e._valueTracker=yB(e))}function fk(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=pk(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function Ef(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function wS(e,t){var r=t.checked;return Yt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function eC(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=Fa(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function _k(e,t){t=t.checked,t!=null&&Bv(e,"checked",t,!1)}function AS(e,t){_k(e,t);var r=Fa(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?OS(e,t.type,r):t.hasOwnProperty("defaultValue")&&OS(e,t.type,Fa(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function tC(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function OS(e,t,r){(t!=="number"||Ef(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Sd=Array.isArray;function Kc(e,t,r,i){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&i&&(e[r].defaultSelected=!0)}else{for(r=""+Fa(r),t=null,n=0;n<e.length;n++){if(e[n].value===r){e[n].selected=!0,i&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function bS(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ee(91));return Yt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function rC(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(ee(92));if(Sd(r)){if(1<r.length)throw Error(ee(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Fa(r)}}function mk(e,t){var r=Fa(t.value),i=Fa(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function iC(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Ek(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function NS(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Ek(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var vh,gk=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,n){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(vh=vh||document.createElement("div"),vh.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=vh.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function au(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Md={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},RB=["Webkit","ms","Moz","O"];Object.keys(Md).forEach(function(e){RB.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Md[t]=Md[e]})});function Sk(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Md.hasOwnProperty(e)&&Md[e]?(""+t).trim():t+"px"}function Tk(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=Sk(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,n):e[r]=n}}var CB=Yt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function DS(e,t){if(t){if(CB[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ee(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ee(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ee(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ee(62))}}function PS(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kS=null;function Hv(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var LS=null,zc=null,Yc=null;function nC(e){if(e=Qu(e)){if(typeof LS!="function")throw Error(ee(280));var t=e.stateNode;t&&(t=v_(t),LS(e.stateNode,e.type,t))}}function vk(e){zc?Yc?Yc.push(e):Yc=[e]:zc=e}function yk(){if(zc){var e=zc,t=Yc;if(Yc=zc=null,nC(e),t)for(e=0;e<t.length;e++)nC(t[e])}}function Rk(e,t){return e(t)}function Ck(){}var vm=!1;function Ik(e,t,r){if(vm)return e(t,r);vm=!0;try{return Rk(e,t,r)}finally{vm=!1,(zc!==null||Yc!==null)&&(Ck(),yk())}}function su(e,t){var r=e.stateNode;if(r===null)return null;var i=v_(r);if(i===null)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(ee(231,t,typeof r));return r}var MS=!1;if(Fo)try{var Yl={};Object.defineProperty(Yl,"passive",{get:function(){MS=!0}}),window.addEventListener("test",Yl,Yl),window.removeEventListener("test",Yl,Yl)}catch{MS=!1}function IB(e,t,r,i,n,o,a,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(d){this.onError(d)}}var Ud=!1,gf=null,Sf=!1,US=null,wB={onError:function(e){Ud=!0,gf=e}};function AB(e,t,r,i,n,o,a,s,c){Ud=!1,gf=null,IB.apply(wB,arguments)}function OB(e,t,r,i,n,o,a,s,c){if(AB.apply(this,arguments),Ud){if(Ud){var l=gf;Ud=!1,gf=null}else throw Error(ee(198));Sf||(Sf=!0,US=l)}}function Hs(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function wk(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function oC(e){if(Hs(e)!==e)throw Error(ee(188))}function bB(e){var t=e.alternate;if(!t){if(t=Hs(e),t===null)throw Error(ee(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(n===null)break;var o=n.alternate;if(o===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===o.child){for(o=n.child;o;){if(o===r)return oC(n),e;if(o===i)return oC(n),t;o=o.sibling}throw Error(ee(188))}if(r.return!==i.return)r=n,i=o;else{for(var a=!1,s=n.child;s;){if(s===r){a=!0,r=n,i=o;break}if(s===i){a=!0,i=n,r=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===r){a=!0,r=o,i=n;break}if(s===i){a=!0,i=o,r=n;break}s=s.sibling}if(!a)throw Error(ee(189))}}if(r.alternate!==i)throw Error(ee(190))}if(r.tag!==3)throw Error(ee(188));return r.stateNode.current===r?e:t}function Ak(e){return e=bB(e),e!==null?Ok(e):null}function Ok(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Ok(e);if(t!==null)return t;e=e.sibling}return null}var bk=Vi.unstable_scheduleCallback,aC=Vi.unstable_cancelCallback,NB=Vi.unstable_shouldYield,DB=Vi.unstable_requestPaint,sr=Vi.unstable_now,PB=Vi.unstable_getCurrentPriorityLevel,Kv=Vi.unstable_ImmediatePriority,Nk=Vi.unstable_UserBlockingPriority,Tf=Vi.unstable_NormalPriority,kB=Vi.unstable_LowPriority,Dk=Vi.unstable_IdlePriority,E_=null,ao=null;function LB(e){if(ao&&typeof ao.onCommitFiberRoot=="function")try{ao.onCommitFiberRoot(E_,e,void 0,(e.current.flags&128)===128)}catch{}}var Ln=Math.clz32?Math.clz32:xB,MB=Math.log,UB=Math.LN2;function xB(e){return e>>>=0,e===0?32:31-(MB(e)/UB|0)|0}var yh=64,Rh=4194304;function Td(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function vf(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,n=e.suspendedLanes,o=e.pingedLanes,a=r&268435455;if(a!==0){var s=a&~n;s!==0?i=Td(s):(o&=a,o!==0&&(i=Td(o)))}else a=r&~n,a!==0?i=Td(a):o!==0&&(i=Td(o));if(i===0)return 0;if(t!==0&&t!==i&&!(t&n)&&(n=i&-i,o=t&-t,n>=o||n===16&&(o&4194240)!==0))return t;if(i&4&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-Ln(t),n=1<<r,i|=e[r],t&=~n;return i}function VB(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function FB(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,n=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-Ln(o),s=1<<a,c=n[a];c===-1?(!(s&r)||s&i)&&(n[a]=VB(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}}function xS(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Pk(){var e=yh;return yh<<=1,!(yh&4194240)&&(yh=64),e}function ym(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Xu(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ln(t),e[t]=r}function BB(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var n=31-Ln(r),o=1<<n;t[n]=0,i[n]=-1,e[n]=-1,r&=~o}}function zv(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-Ln(r),n=1<<i;n&t|e[i]&t&&(e[i]|=t),r&=~n}}var Tt=0;function kk(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Lk,Yv,Mk,Uk,xk,VS=!1,Ch=[],Ia=null,wa=null,Aa=null,cu=new Map,lu=new Map,la=[],jB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sC(e,t){switch(e){case"focusin":case"focusout":Ia=null;break;case"dragenter":case"dragleave":wa=null;break;case"mouseover":case"mouseout":Aa=null;break;case"pointerover":case"pointerout":cu.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":lu.delete(t.pointerId)}}function $l(e,t,r,i,n,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:o,targetContainers:[n]},t!==null&&(t=Qu(t),t!==null&&Yv(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function GB(e,t,r,i,n){switch(t){case"focusin":return Ia=$l(Ia,e,t,r,i,n),!0;case"dragenter":return wa=$l(wa,e,t,r,i,n),!0;case"mouseover":return Aa=$l(Aa,e,t,r,i,n),!0;case"pointerover":var o=n.pointerId;return cu.set(o,$l(cu.get(o)||null,e,t,r,i,n)),!0;case"gotpointercapture":return o=n.pointerId,lu.set(o,$l(lu.get(o)||null,e,t,r,i,n)),!0}return!1}function Vk(e){var t=_s(e.target);if(t!==null){var r=Hs(t);if(r!==null){if(t=r.tag,t===13){if(t=wk(r),t!==null){e.blockedOn=t,xk(e.priority,function(){Mk(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function kp(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=FS(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);kS=i,r.target.dispatchEvent(i),kS=null}else return t=Qu(r),t!==null&&Yv(t),e.blockedOn=r,!1;t.shift()}return!0}function cC(e,t,r){kp(e)&&r.delete(t)}function WB(){VS=!1,Ia!==null&&kp(Ia)&&(Ia=null),wa!==null&&kp(wa)&&(wa=null),Aa!==null&&kp(Aa)&&(Aa=null),cu.forEach(cC),lu.forEach(cC)}function ql(e,t){e.blockedOn===t&&(e.blockedOn=null,VS||(VS=!0,Vi.unstable_scheduleCallback(Vi.unstable_NormalPriority,WB)))}function du(e){function t(n){return ql(n,e)}if(0<Ch.length){ql(Ch[0],e);for(var r=1;r<Ch.length;r++){var i=Ch[r];i.blockedOn===e&&(i.blockedOn=null)}}for(Ia!==null&&ql(Ia,e),wa!==null&&ql(wa,e),Aa!==null&&ql(Aa,e),cu.forEach(t),lu.forEach(t),r=0;r<la.length;r++)i=la[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<la.length&&(r=la[0],r.blockedOn===null);)Vk(r),r.blockedOn===null&&la.shift()}var $c=Ho.ReactCurrentBatchConfig,yf=!0;function HB(e,t,r,i){var n=Tt,o=$c.transition;$c.transition=null;try{Tt=1,$v(e,t,r,i)}finally{Tt=n,$c.transition=o}}function KB(e,t,r,i){var n=Tt,o=$c.transition;$c.transition=null;try{Tt=4,$v(e,t,r,i)}finally{Tt=n,$c.transition=o}}function $v(e,t,r,i){if(yf){var n=FS(e,t,r,i);if(n===null)Pm(e,t,i,Rf,r),sC(e,i);else if(GB(n,e,t,r,i))i.stopPropagation();else if(sC(e,i),t&4&&-1<jB.indexOf(e)){for(;n!==null;){var o=Qu(n);if(o!==null&&Lk(o),o=FS(e,t,r,i),o===null&&Pm(e,t,i,Rf,r),o===n)break;n=o}n!==null&&i.stopPropagation()}else Pm(e,t,i,null,r)}}var Rf=null;function FS(e,t,r,i){if(Rf=null,e=Hv(i),e=_s(e),e!==null)if(t=Hs(e),t===null)e=null;else if(r=t.tag,r===13){if(e=wk(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Rf=e,null}function Fk(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(PB()){case Kv:return 1;case Nk:return 4;case Tf:case kB:return 16;case Dk:return 536870912;default:return 16}default:return 16}}var _a=null,qv=null,Lp=null;function Bk(){if(Lp)return Lp;var e,t=qv,r=t.length,i,n="value"in _a?_a.value:_a.textContent,o=n.length;for(e=0;e<r&&t[e]===n[e];e++);var a=r-e;for(i=1;i<=a&&t[r-i]===n[o-i];i++);return Lp=n.slice(e,1<i?1-i:void 0)}function Mp(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Ih(){return!0}function lC(){return!1}function Bi(e){function t(r,i,n,o,a){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Ih:lC,this.isPropagationStopped=lC,this}return Yt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Ih)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Ih)},persist:function(){},isPersistent:Ih}),t}var Al={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xv=Bi(Al),Ju=Yt({},Al,{view:0,detail:0}),zB=Bi(Ju),Rm,Cm,Xl,g_=Yt({},Ju,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jv,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Xl&&(Xl&&e.type==="mousemove"?(Rm=e.screenX-Xl.screenX,Cm=e.screenY-Xl.screenY):Cm=Rm=0,Xl=e),Rm)},movementY:function(e){return"movementY"in e?e.movementY:Cm}}),dC=Bi(g_),YB=Yt({},g_,{dataTransfer:0}),$B=Bi(YB),qB=Yt({},Ju,{relatedTarget:0}),Im=Bi(qB),XB=Yt({},Al,{animationName:0,elapsedTime:0,pseudoElement:0}),JB=Bi(XB),QB=Yt({},Al,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ZB=Bi(QB),ej=Yt({},Al,{data:0}),uC=Bi(ej),tj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ij={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nj(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=ij[e])?!!t[e]:!1}function Jv(){return nj}var oj=Yt({},Ju,{key:function(e){if(e.key){var t=tj[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Mp(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?rj[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jv,charCode:function(e){return e.type==="keypress"?Mp(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Mp(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),aj=Bi(oj),sj=Yt({},g_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hC=Bi(sj),cj=Yt({},Ju,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jv}),lj=Bi(cj),dj=Yt({},Al,{propertyName:0,elapsedTime:0,pseudoElement:0}),uj=Bi(dj),hj=Yt({},g_,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),pj=Bi(hj),fj=[9,13,27,32],Qv=Fo&&"CompositionEvent"in window,xd=null;Fo&&"documentMode"in document&&(xd=document.documentMode);var _j=Fo&&"TextEvent"in window&&!xd,jk=Fo&&(!Qv||xd&&8<xd&&11>=xd),pC=" ",fC=!1;function Gk(e,t){switch(e){case"keyup":return fj.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wk(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Cc=!1;function mj(e,t){switch(e){case"compositionend":return Wk(t);case"keypress":return t.which!==32?null:(fC=!0,pC);case"textInput":return e=t.data,e===pC&&fC?null:e;default:return null}}function Ej(e,t){if(Cc)return e==="compositionend"||!Qv&&Gk(e,t)?(e=Bk(),Lp=qv=_a=null,Cc=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jk&&t.locale!=="ko"?null:t.data;default:return null}}var gj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _C(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!gj[e.type]:t==="textarea"}function Hk(e,t,r,i){vk(i),t=Cf(t,"onChange"),0<t.length&&(r=new Xv("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var Vd=null,uu=null;function Sj(e){tL(e,0)}function S_(e){var t=Ac(e);if(fk(t))return e}function Tj(e,t){if(e==="change")return t}var Kk=!1;if(Fo){var wm;if(Fo){var Am="oninput"in document;if(!Am){var mC=document.createElement("div");mC.setAttribute("oninput","return;"),Am=typeof mC.oninput=="function"}wm=Am}else wm=!1;Kk=wm&&(!document.documentMode||9<document.documentMode)}function EC(){Vd&&(Vd.detachEvent("onpropertychange",zk),uu=Vd=null)}function zk(e){if(e.propertyName==="value"&&S_(uu)){var t=[];Hk(t,uu,e,Hv(e)),Ik(Sj,t)}}function vj(e,t,r){e==="focusin"?(EC(),Vd=t,uu=r,Vd.attachEvent("onpropertychange",zk)):e==="focusout"&&EC()}function yj(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return S_(uu)}function Rj(e,t){if(e==="click")return S_(t)}function Cj(e,t){if(e==="input"||e==="change")return S_(t)}function Ij(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Un=typeof Object.is=="function"?Object.is:Ij;function hu(e,t){if(Un(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!vS.call(t,n)||!Un(e[n],t[n]))return!1}return!0}function gC(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function SC(e,t){var r=gC(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=gC(r)}}function Yk(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Yk(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function $k(){for(var e=window,t=Ef();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Ef(e.document)}return t}function Zv(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function wj(e){var t=$k(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&Yk(r.ownerDocument.documentElement,r)){if(i!==null&&Zv(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=r.textContent.length,o=Math.min(i.start,n);i=i.end===void 0?o:Math.min(i.end,n),!e.extend&&o>i&&(n=i,i=o,o=n),n=SC(r,o);var a=SC(r,i);n&&a&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Aj=Fo&&"documentMode"in document&&11>=document.documentMode,Ic=null,BS=null,Fd=null,jS=!1;function TC(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;jS||Ic==null||Ic!==Ef(i)||(i=Ic,"selectionStart"in i&&Zv(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Fd&&hu(Fd,i)||(Fd=i,i=Cf(BS,"onSelect"),0<i.length&&(t=new Xv("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=Ic)))}function wh(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var wc={animationend:wh("Animation","AnimationEnd"),animationiteration:wh("Animation","AnimationIteration"),animationstart:wh("Animation","AnimationStart"),transitionend:wh("Transition","TransitionEnd")},Om={},qk={};Fo&&(qk=document.createElement("div").style,"AnimationEvent"in window||(delete wc.animationend.animation,delete wc.animationiteration.animation,delete wc.animationstart.animation),"TransitionEvent"in window||delete wc.transitionend.transition);function T_(e){if(Om[e])return Om[e];if(!wc[e])return e;var t=wc[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in qk)return Om[e]=t[r];return e}var Xk=T_("animationend"),Jk=T_("animationiteration"),Qk=T_("animationstart"),Zk=T_("transitionend"),eL=new Map,vC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ha(e,t){eL.set(e,t),Ws(t,[e])}for(var bm=0;bm<vC.length;bm++){var Nm=vC[bm],Oj=Nm.toLowerCase(),bj=Nm[0].toUpperCase()+Nm.slice(1);Ha(Oj,"on"+bj)}Ha(Xk,"onAnimationEnd");Ha(Jk,"onAnimationIteration");Ha(Qk,"onAnimationStart");Ha("dblclick","onDoubleClick");Ha("focusin","onFocus");Ha("focusout","onBlur");Ha(Zk,"onTransitionEnd");sl("onMouseEnter",["mouseout","mouseover"]);sl("onMouseLeave",["mouseout","mouseover"]);sl("onPointerEnter",["pointerout","pointerover"]);sl("onPointerLeave",["pointerout","pointerover"]);Ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ws("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nj=new Set("cancel close invalid load scroll toggle".split(" ").concat(vd));function yC(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,OB(i,t,void 0,e),e.currentTarget=null}function tL(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],n=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&n.isPropagationStopped())break e;yC(n,s,l),o=c}else for(a=0;a<i.length;a++){if(s=i[a],c=s.instance,l=s.currentTarget,s=s.listener,c!==o&&n.isPropagationStopped())break e;yC(n,s,l),o=c}}}if(Sf)throw e=US,Sf=!1,US=null,e}function Nt(e,t){var r=t[zS];r===void 0&&(r=t[zS]=new Set);var i=e+"__bubble";r.has(i)||(rL(t,e,2,!1),r.add(i))}function Dm(e,t,r){var i=0;t&&(i|=4),rL(r,e,i,t)}var Ah="_reactListening"+Math.random().toString(36).slice(2);function pu(e){if(!e[Ah]){e[Ah]=!0,lk.forEach(function(r){r!=="selectionchange"&&(Nj.has(r)||Dm(r,!1,e),Dm(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ah]||(t[Ah]=!0,Dm("selectionchange",!1,t))}}function rL(e,t,r,i){switch(Fk(t)){case 1:var n=HB;break;case 4:n=KB;break;default:n=$v}r=n.bind(null,t,r,e),n=void 0,!MS||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),i?n!==void 0?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):n!==void 0?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function Pm(e,t,r,i,n){var o=i;if(!(t&1)&&!(t&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var s=i.stateNode.containerInfo;if(s===n||s.nodeType===8&&s.parentNode===n)break;if(a===4)for(a=i.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===n||c.nodeType===8&&c.parentNode===n))return;a=a.return}for(;s!==null;){if(a=_s(s),a===null)return;if(c=a.tag,c===5||c===6){i=o=a;continue e}s=s.parentNode}}i=i.return}Ik(function(){var l=o,d=Hv(r),u=[];e:{var h=eL.get(e);if(h!==void 0){var p=Xv,g=e;switch(e){case"keypress":if(Mp(r)===0)break e;case"keydown":case"keyup":p=aj;break;case"focusin":g="focus",p=Im;break;case"focusout":g="blur",p=Im;break;case"beforeblur":case"afterblur":p=Im;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=dC;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=$B;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=lj;break;case Xk:case Jk:case Qk:p=JB;break;case Zk:p=uj;break;case"scroll":p=zB;break;case"wheel":p=pj;break;case"copy":case"cut":case"paste":p=ZB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=hC}var _=(t&4)!==0,E=!_&&e==="scroll",S=_?h!==null?h+"Capture":null:h;_=[];for(var T=l,y;T!==null;){y=T;var I=y.stateNode;if(y.tag===5&&I!==null&&(y=I,S!==null&&(I=su(T,S),I!=null&&_.push(fu(T,I,y)))),E)break;T=T.return}0<_.length&&(h=new p(h,g,null,r,d),u.push({event:h,listeners:_}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",h&&r!==kS&&(g=r.relatedTarget||r.fromElement)&&(_s(g)||g[Bo]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(g=r.relatedTarget||r.toElement,p=l,g=g?_s(g):null,g!==null&&(E=Hs(g),g!==E||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=l),p!==g)){if(_=dC,I="onMouseLeave",S="onMouseEnter",T="mouse",(e==="pointerout"||e==="pointerover")&&(_=hC,I="onPointerLeave",S="onPointerEnter",T="pointer"),E=p==null?h:Ac(p),y=g==null?h:Ac(g),h=new _(I,T+"leave",p,r,d),h.target=E,h.relatedTarget=y,I=null,_s(d)===l&&(_=new _(S,T+"enter",g,r,d),_.target=y,_.relatedTarget=E,I=_),E=I,p&&g)t:{for(_=p,S=g,T=0,y=_;y;y=Qs(y))T++;for(y=0,I=S;I;I=Qs(I))y++;for(;0<T-y;)_=Qs(_),T--;for(;0<y-T;)S=Qs(S),y--;for(;T--;){if(_===S||S!==null&&_===S.alternate)break t;_=Qs(_),S=Qs(S)}_=null}else _=null;p!==null&&RC(u,h,p,_,!1),g!==null&&E!==null&&RC(u,E,g,_,!0)}}e:{if(h=l?Ac(l):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var O=Tj;else if(_C(h))if(Kk)O=Cj;else{O=yj;var b=vj}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(O=Rj);if(O&&(O=O(e,l))){Hk(u,O,r,d);break e}b&&b(e,h,l),e==="focusout"&&(b=h._wrapperState)&&b.controlled&&h.type==="number"&&OS(h,"number",h.value)}switch(b=l?Ac(l):window,e){case"focusin":(_C(b)||b.contentEditable==="true")&&(Ic=b,BS=l,Fd=null);break;case"focusout":Fd=BS=Ic=null;break;case"mousedown":jS=!0;break;case"contextmenu":case"mouseup":case"dragend":jS=!1,TC(u,r,d);break;case"selectionchange":if(Aj)break;case"keydown":case"keyup":TC(u,r,d)}var k;if(Qv)e:{switch(e){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else Cc?Gk(e,r)&&(P="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(P="onCompositionStart");P&&(jk&&r.locale!=="ko"&&(Cc||P!=="onCompositionStart"?P==="onCompositionEnd"&&Cc&&(k=Bk()):(_a=d,qv="value"in _a?_a.value:_a.textContent,Cc=!0)),b=Cf(l,P),0<b.length&&(P=new uC(P,e,null,r,d),u.push({event:P,listeners:b}),k?P.data=k:(k=Wk(r),k!==null&&(P.data=k)))),(k=_j?mj(e,r):Ej(e,r))&&(l=Cf(l,"onBeforeInput"),0<l.length&&(d=new uC("onBeforeInput","beforeinput",null,r,d),u.push({event:d,listeners:l}),d.data=k))}tL(u,t)})}function fu(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Cf(e,t){for(var r=t+"Capture",i=[];e!==null;){var n=e,o=n.stateNode;n.tag===5&&o!==null&&(n=o,o=su(e,r),o!=null&&i.unshift(fu(e,o,n)),o=su(e,t),o!=null&&i.push(fu(e,o,n))),e=e.return}return i}function Qs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function RC(e,t,r,i,n){for(var o=t._reactName,a=[];r!==null&&r!==i;){var s=r,c=s.alternate,l=s.stateNode;if(c!==null&&c===i)break;s.tag===5&&l!==null&&(s=l,n?(c=su(r,o),c!=null&&a.unshift(fu(r,c,s))):n||(c=su(r,o),c!=null&&a.push(fu(r,c,s)))),r=r.return}a.length!==0&&e.push({event:t,listeners:a})}var Dj=/\r\n?/g,Pj=/\u0000|\uFFFD/g;function CC(e){return(typeof e=="string"?e:""+e).replace(Dj,`
`).replace(Pj,"")}function Oh(e,t,r){if(t=CC(t),CC(e)!==t&&r)throw Error(ee(425))}function If(){}var GS=null,WS=null;function HS(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var KS=typeof setTimeout=="function"?setTimeout:void 0,kj=typeof clearTimeout=="function"?clearTimeout:void 0,IC=typeof Promise=="function"?Promise:void 0,Lj=typeof queueMicrotask=="function"?queueMicrotask:typeof IC<"u"?function(e){return IC.resolve(null).then(e).catch(Mj)}:KS;function Mj(e){setTimeout(function(){throw e})}function km(e,t){var r=t,i=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){e.removeChild(n),du(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);du(t)}function Oa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function wC(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Ol=Math.random().toString(36).slice(2),Zn="__reactFiber$"+Ol,_u="__reactProps$"+Ol,Bo="__reactContainer$"+Ol,zS="__reactEvents$"+Ol,Uj="__reactListeners$"+Ol,xj="__reactHandles$"+Ol;function _s(e){var t=e[Zn];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Bo]||r[Zn]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=wC(e);e!==null;){if(r=e[Zn])return r;e=wC(e)}return t}e=r,r=e.parentNode}return null}function Qu(e){return e=e[Zn]||e[Bo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Ac(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ee(33))}function v_(e){return e[_u]||null}var YS=[],Oc=-1;function Ka(e){return{current:e}}function Mt(e){0>Oc||(e.current=YS[Oc],YS[Oc]=null,Oc--)}function bt(e,t){Oc++,YS[Oc]=e.current,e.current=t}var Ba={},Yr=Ka(Ba),Si=Ka(!1),ks=Ba;function cl(e,t){var r=e.type.contextTypes;if(!r)return Ba;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var n={},o;for(o in r)n[o]=t[o];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Ti(e){return e=e.childContextTypes,e!=null}function wf(){Mt(Si),Mt(Yr)}function AC(e,t,r){if(Yr.current!==Ba)throw Error(ee(168));bt(Yr,t),bt(Si,r)}function iL(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in t))throw Error(ee(108,vB(e)||"Unknown",n));return Yt({},r,i)}function Af(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ba,ks=Yr.current,bt(Yr,e),bt(Si,Si.current),!0}function OC(e,t,r){var i=e.stateNode;if(!i)throw Error(ee(169));r?(e=iL(e,t,ks),i.__reactInternalMemoizedMergedChildContext=e,Mt(Si),Mt(Yr),bt(Yr,e)):Mt(Si),bt(Si,r)}var bo=null,y_=!1,Lm=!1;function nL(e){bo===null?bo=[e]:bo.push(e)}function Vj(e){y_=!0,nL(e)}function za(){if(!Lm&&bo!==null){Lm=!0;var e=0,t=Tt;try{var r=bo;for(Tt=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}bo=null,y_=!1}catch(n){throw bo!==null&&(bo=bo.slice(e+1)),bk(Kv,za),n}finally{Tt=t,Lm=!1}}return null}var bc=[],Nc=0,Of=null,bf=0,rn=[],nn=0,Ls=null,ko=1,Lo="";function os(e,t){bc[Nc++]=bf,bc[Nc++]=Of,Of=e,bf=t}function oL(e,t,r){rn[nn++]=ko,rn[nn++]=Lo,rn[nn++]=Ls,Ls=e;var i=ko;e=Lo;var n=32-Ln(i)-1;i&=~(1<<n),r+=1;var o=32-Ln(t)+n;if(30<o){var a=n-n%5;o=(i&(1<<a)-1).toString(32),i>>=a,n-=a,ko=1<<32-Ln(t)+n|r<<n|i,Lo=o+e}else ko=1<<o|r<<n|i,Lo=e}function ey(e){e.return!==null&&(os(e,1),oL(e,1,0))}function ty(e){for(;e===Of;)Of=bc[--Nc],bc[Nc]=null,bf=bc[--Nc],bc[Nc]=null;for(;e===Ls;)Ls=rn[--nn],rn[nn]=null,Lo=rn[--nn],rn[nn]=null,ko=rn[--nn],rn[nn]=null}var xi=null,ki=null,Vt=!1,Dn=null;function aL(e,t){var r=cn(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function bC(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,xi=e,ki=Oa(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,xi=e,ki=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Ls!==null?{id:ko,overflow:Lo}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=cn(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,xi=e,ki=null,!0):!1;default:return!1}}function $S(e){return(e.mode&1)!==0&&(e.flags&128)===0}function qS(e){if(Vt){var t=ki;if(t){var r=t;if(!bC(e,t)){if($S(e))throw Error(ee(418));t=Oa(r.nextSibling);var i=xi;t&&bC(e,t)?aL(i,r):(e.flags=e.flags&-4097|2,Vt=!1,xi=e)}}else{if($S(e))throw Error(ee(418));e.flags=e.flags&-4097|2,Vt=!1,xi=e}}}function NC(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xi=e}function bh(e){if(e!==xi)return!1;if(!Vt)return NC(e),Vt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!HS(e.type,e.memoizedProps)),t&&(t=ki)){if($S(e))throw sL(),Error(ee(418));for(;t;)aL(e,t),t=Oa(t.nextSibling)}if(NC(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ee(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){ki=Oa(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}ki=null}}else ki=xi?Oa(e.stateNode.nextSibling):null;return!0}function sL(){for(var e=ki;e;)e=Oa(e.nextSibling)}function ll(){ki=xi=null,Vt=!1}function ry(e){Dn===null?Dn=[e]:Dn.push(e)}var Fj=Ho.ReactCurrentBatchConfig;function Jl(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ee(309));var i=r.stateNode}if(!i)throw Error(ee(147,e));var n=i,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(a){var s=n.refs;a===null?delete s[o]:s[o]=a},t._stringRef=o,t)}if(typeof e!="string")throw Error(ee(284));if(!r._owner)throw Error(ee(290,e))}return e}function Nh(e,t){throw e=Object.prototype.toString.call(t),Error(ee(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function DC(e){var t=e._init;return t(e._payload)}function cL(e){function t(S,T){if(e){var y=S.deletions;y===null?(S.deletions=[T],S.flags|=16):y.push(T)}}function r(S,T){if(!e)return null;for(;T!==null;)t(S,T),T=T.sibling;return null}function i(S,T){for(S=new Map;T!==null;)T.key!==null?S.set(T.key,T):S.set(T.index,T),T=T.sibling;return S}function n(S,T){return S=Pa(S,T),S.index=0,S.sibling=null,S}function o(S,T,y){return S.index=y,e?(y=S.alternate,y!==null?(y=y.index,y<T?(S.flags|=2,T):y):(S.flags|=2,T)):(S.flags|=1048576,T)}function a(S){return e&&S.alternate===null&&(S.flags|=2),S}function s(S,T,y,I){return T===null||T.tag!==6?(T=jm(y,S.mode,I),T.return=S,T):(T=n(T,y),T.return=S,T)}function c(S,T,y,I){var O=y.type;return O===Rc?d(S,T,y.props.children,I,y.key):T!==null&&(T.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===sa&&DC(O)===T.type)?(I=n(T,y.props),I.ref=Jl(S,T,y),I.return=S,I):(I=Gp(y.type,y.key,y.props,null,S.mode,I),I.ref=Jl(S,T,y),I.return=S,I)}function l(S,T,y,I){return T===null||T.tag!==4||T.stateNode.containerInfo!==y.containerInfo||T.stateNode.implementation!==y.implementation?(T=Gm(y,S.mode,I),T.return=S,T):(T=n(T,y.children||[]),T.return=S,T)}function d(S,T,y,I,O){return T===null||T.tag!==7?(T=As(y,S.mode,I,O),T.return=S,T):(T=n(T,y),T.return=S,T)}function u(S,T,y){if(typeof T=="string"&&T!==""||typeof T=="number")return T=jm(""+T,S.mode,y),T.return=S,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Sh:return y=Gp(T.type,T.key,T.props,null,S.mode,y),y.ref=Jl(S,null,T),y.return=S,y;case yc:return T=Gm(T,S.mode,y),T.return=S,T;case sa:var I=T._init;return u(S,I(T._payload),y)}if(Sd(T)||zl(T))return T=As(T,S.mode,y,null),T.return=S,T;Nh(S,T)}return null}function h(S,T,y,I){var O=T!==null?T.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return O!==null?null:s(S,T,""+y,I);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Sh:return y.key===O?c(S,T,y,I):null;case yc:return y.key===O?l(S,T,y,I):null;case sa:return O=y._init,h(S,T,O(y._payload),I)}if(Sd(y)||zl(y))return O!==null?null:d(S,T,y,I,null);Nh(S,y)}return null}function p(S,T,y,I,O){if(typeof I=="string"&&I!==""||typeof I=="number")return S=S.get(y)||null,s(T,S,""+I,O);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Sh:return S=S.get(I.key===null?y:I.key)||null,c(T,S,I,O);case yc:return S=S.get(I.key===null?y:I.key)||null,l(T,S,I,O);case sa:var b=I._init;return p(S,T,y,b(I._payload),O)}if(Sd(I)||zl(I))return S=S.get(y)||null,d(T,S,I,O,null);Nh(T,I)}return null}function g(S,T,y,I){for(var O=null,b=null,k=T,P=T=0,j=null;k!==null&&P<y.length;P++){k.index>P?(j=k,k=null):j=k.sibling;var G=h(S,k,y[P],I);if(G===null){k===null&&(k=j);break}e&&k&&G.alternate===null&&t(S,k),T=o(G,T,P),b===null?O=G:b.sibling=G,b=G,k=j}if(P===y.length)return r(S,k),Vt&&os(S,P),O;if(k===null){for(;P<y.length;P++)k=u(S,y[P],I),k!==null&&(T=o(k,T,P),b===null?O=k:b.sibling=k,b=k);return Vt&&os(S,P),O}for(k=i(S,k);P<y.length;P++)j=p(k,S,P,y[P],I),j!==null&&(e&&j.alternate!==null&&k.delete(j.key===null?P:j.key),T=o(j,T,P),b===null?O=j:b.sibling=j,b=j);return e&&k.forEach(function(ce){return t(S,ce)}),Vt&&os(S,P),O}function _(S,T,y,I){var O=zl(y);if(typeof O!="function")throw Error(ee(150));if(y=O.call(y),y==null)throw Error(ee(151));for(var b=O=null,k=T,P=T=0,j=null,G=y.next();k!==null&&!G.done;P++,G=y.next()){k.index>P?(j=k,k=null):j=k.sibling;var ce=h(S,k,G.value,I);if(ce===null){k===null&&(k=j);break}e&&k&&ce.alternate===null&&t(S,k),T=o(ce,T,P),b===null?O=ce:b.sibling=ce,b=ce,k=j}if(G.done)return r(S,k),Vt&&os(S,P),O;if(k===null){for(;!G.done;P++,G=y.next())G=u(S,G.value,I),G!==null&&(T=o(G,T,P),b===null?O=G:b.sibling=G,b=G);return Vt&&os(S,P),O}for(k=i(S,k);!G.done;P++,G=y.next())G=p(k,S,P,G.value,I),G!==null&&(e&&G.alternate!==null&&k.delete(G.key===null?P:G.key),T=o(G,T,P),b===null?O=G:b.sibling=G,b=G);return e&&k.forEach(function(pe){return t(S,pe)}),Vt&&os(S,P),O}function E(S,T,y,I){if(typeof y=="object"&&y!==null&&y.type===Rc&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Sh:e:{for(var O=y.key,b=T;b!==null;){if(b.key===O){if(O=y.type,O===Rc){if(b.tag===7){r(S,b.sibling),T=n(b,y.props.children),T.return=S,S=T;break e}}else if(b.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===sa&&DC(O)===b.type){r(S,b.sibling),T=n(b,y.props),T.ref=Jl(S,b,y),T.return=S,S=T;break e}r(S,b);break}else t(S,b);b=b.sibling}y.type===Rc?(T=As(y.props.children,S.mode,I,y.key),T.return=S,S=T):(I=Gp(y.type,y.key,y.props,null,S.mode,I),I.ref=Jl(S,T,y),I.return=S,S=I)}return a(S);case yc:e:{for(b=y.key;T!==null;){if(T.key===b)if(T.tag===4&&T.stateNode.containerInfo===y.containerInfo&&T.stateNode.implementation===y.implementation){r(S,T.sibling),T=n(T,y.children||[]),T.return=S,S=T;break e}else{r(S,T);break}else t(S,T);T=T.sibling}T=Gm(y,S.mode,I),T.return=S,S=T}return a(S);case sa:return b=y._init,E(S,T,b(y._payload),I)}if(Sd(y))return g(S,T,y,I);if(zl(y))return _(S,T,y,I);Nh(S,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,T!==null&&T.tag===6?(r(S,T.sibling),T=n(T,y),T.return=S,S=T):(r(S,T),T=jm(y,S.mode,I),T.return=S,S=T),a(S)):r(S,T)}return E}var dl=cL(!0),lL=cL(!1),Nf=Ka(null),Df=null,Dc=null,iy=null;function ny(){iy=Dc=Df=null}function oy(e){var t=Nf.current;Mt(Nf),e._currentValue=t}function XS(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function qc(e,t){Df=e,iy=Dc=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ei=!0),e.firstContext=null)}function hn(e){var t=e._currentValue;if(iy!==e)if(e={context:e,memoizedValue:t,next:null},Dc===null){if(Df===null)throw Error(ee(308));Dc=e,Df.dependencies={lanes:0,firstContext:e}}else Dc=Dc.next=e;return t}var ms=null;function ay(e){ms===null?ms=[e]:ms.push(e)}function dL(e,t,r,i){var n=t.interleaved;return n===null?(r.next=r,ay(t)):(r.next=n.next,n.next=r),t.interleaved=r,jo(e,i)}function jo(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var ca=!1;function sy(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uL(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Uo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ba(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,et&2){var n=i.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),i.pending=t,jo(e,r)}return n=i.interleaved,n===null?(t.next=t,ay(i)):(t.next=n.next,n.next=t),i.interleaved=t,jo(e,r)}function Up(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,zv(e,r)}}function PC(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?n=o=a:o=o.next=a,r=r.next}while(r!==null);o===null?n=o=t:o=o.next=t}else n=o=t;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:o,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Pf(e,t,r,i){var n=e.updateQueue;ca=!1;var o=n.firstBaseUpdate,a=n.lastBaseUpdate,s=n.shared.pending;if(s!==null){n.shared.pending=null;var c=s,l=c.next;c.next=null,a===null?o=l:a.next=l,a=c;var d=e.alternate;d!==null&&(d=d.updateQueue,s=d.lastBaseUpdate,s!==a&&(s===null?d.firstBaseUpdate=l:s.next=l,d.lastBaseUpdate=c))}if(o!==null){var u=n.baseState;a=0,d=l=c=null,s=o;do{var h=s.lane,p=s.eventTime;if((i&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var g=e,_=s;switch(h=t,p=r,_.tag){case 1:if(g=_.payload,typeof g=="function"){u=g.call(p,u,h);break e}u=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,h=typeof g=="function"?g.call(p,u,h):g,h==null)break e;u=Yt({},u,h);break e;case 2:ca=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,h=n.effects,h===null?n.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},d===null?(l=d=p,c=u):d=d.next=p,a|=h;if(s=s.next,s===null){if(s=n.shared.pending,s===null)break;h=s,s=h.next,h.next=null,n.lastBaseUpdate=h,n.shared.pending=null}}while(!0);if(d===null&&(c=u),n.baseState=c,n.firstBaseUpdate=l,n.lastBaseUpdate=d,t=n.shared.interleaved,t!==null){n=t;do a|=n.lane,n=n.next;while(n!==t)}else o===null&&(n.shared.lanes=0);Us|=a,e.lanes=a,e.memoizedState=u}}function kC(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(ee(191,n));n.call(i)}}}var Zu={},so=Ka(Zu),mu=Ka(Zu),Eu=Ka(Zu);function Es(e){if(e===Zu)throw Error(ee(174));return e}function cy(e,t){switch(bt(Eu,t),bt(mu,e),bt(so,Zu),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:NS(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=NS(t,e)}Mt(so),bt(so,t)}function ul(){Mt(so),Mt(mu),Mt(Eu)}function hL(e){Es(Eu.current);var t=Es(so.current),r=NS(t,e.type);t!==r&&(bt(mu,e),bt(so,r))}function ly(e){mu.current===e&&(Mt(so),Mt(mu))}var Gt=Ka(0);function kf(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Mm=[];function dy(){for(var e=0;e<Mm.length;e++)Mm[e]._workInProgressVersionPrimary=null;Mm.length=0}var xp=Ho.ReactCurrentDispatcher,Um=Ho.ReactCurrentBatchConfig,Ms=0,Kt=null,gr=null,Ir=null,Lf=!1,Bd=!1,gu=0,Bj=0;function jr(){throw Error(ee(321))}function uy(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Un(e[r],t[r]))return!1;return!0}function hy(e,t,r,i,n,o){if(Ms=o,Kt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xp.current=e===null||e.memoizedState===null?Hj:Kj,e=r(i,n),Bd){o=0;do{if(Bd=!1,gu=0,25<=o)throw Error(ee(301));o+=1,Ir=gr=null,t.updateQueue=null,xp.current=zj,e=r(i,n)}while(Bd)}if(xp.current=Mf,t=gr!==null&&gr.next!==null,Ms=0,Ir=gr=Kt=null,Lf=!1,t)throw Error(ee(300));return e}function py(){var e=gu!==0;return gu=0,e}function Jn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ir===null?Kt.memoizedState=Ir=e:Ir=Ir.next=e,Ir}function pn(){if(gr===null){var e=Kt.alternate;e=e!==null?e.memoizedState:null}else e=gr.next;var t=Ir===null?Kt.memoizedState:Ir.next;if(t!==null)Ir=t,gr=e;else{if(e===null)throw Error(ee(310));gr=e,e={memoizedState:gr.memoizedState,baseState:gr.baseState,baseQueue:gr.baseQueue,queue:gr.queue,next:null},Ir===null?Kt.memoizedState=Ir=e:Ir=Ir.next=e}return Ir}function Su(e,t){return typeof t=="function"?t(e):t}function xm(e){var t=pn(),r=t.queue;if(r===null)throw Error(ee(311));r.lastRenderedReducer=e;var i=gr,n=i.baseQueue,o=r.pending;if(o!==null){if(n!==null){var a=n.next;n.next=o.next,o.next=a}i.baseQueue=n=o,r.pending=null}if(n!==null){o=n.next,i=i.baseState;var s=a=null,c=null,l=o;do{var d=l.lane;if((Ms&d)===d)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:e(i,l.action);else{var u={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(s=c=u,a=i):c=c.next=u,Kt.lanes|=d,Us|=d}l=l.next}while(l!==null&&l!==o);c===null?a=i:c.next=s,Un(i,t.memoizedState)||(Ei=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,r.lastRenderedState=i}if(e=r.interleaved,e!==null){n=e;do o=n.lane,Kt.lanes|=o,Us|=o,n=n.next;while(n!==e)}else n===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Vm(e){var t=pn(),r=t.queue;if(r===null)throw Error(ee(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,o=t.memoizedState;if(n!==null){r.pending=null;var a=n=n.next;do o=e(o,a.action),a=a.next;while(a!==n);Un(o,t.memoizedState)||(Ei=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,i]}function pL(){}function fL(e,t){var r=Kt,i=pn(),n=t(),o=!Un(i.memoizedState,n);if(o&&(i.memoizedState=n,Ei=!0),i=i.queue,fy(EL.bind(null,r,i,e),[e]),i.getSnapshot!==t||o||Ir!==null&&Ir.memoizedState.tag&1){if(r.flags|=2048,Tu(9,mL.bind(null,r,i,n,t),void 0,null),Nr===null)throw Error(ee(349));Ms&30||_L(r,t,n)}return n}function _L(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Kt.updateQueue,t===null?(t={lastEffect:null,stores:null},Kt.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function mL(e,t,r,i){t.value=r,t.getSnapshot=i,gL(t)&&SL(e)}function EL(e,t,r){return r(function(){gL(t)&&SL(e)})}function gL(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Un(e,r)}catch{return!0}}function SL(e){var t=jo(e,1);t!==null&&Mn(t,e,1,-1)}function LC(e){var t=Jn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Su,lastRenderedState:e},t.queue=e,e=e.dispatch=Wj.bind(null,Kt,e),[t.memoizedState,e]}function Tu(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=Kt.updateQueue,t===null?(t={lastEffect:null,stores:null},Kt.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function TL(){return pn().memoizedState}function Vp(e,t,r,i){var n=Jn();Kt.flags|=e,n.memoizedState=Tu(1|t,r,void 0,i===void 0?null:i)}function R_(e,t,r,i){var n=pn();i=i===void 0?null:i;var o=void 0;if(gr!==null){var a=gr.memoizedState;if(o=a.destroy,i!==null&&uy(i,a.deps)){n.memoizedState=Tu(t,r,o,i);return}}Kt.flags|=e,n.memoizedState=Tu(1|t,r,o,i)}function MC(e,t){return Vp(8390656,8,e,t)}function fy(e,t){return R_(2048,8,e,t)}function vL(e,t){return R_(4,2,e,t)}function yL(e,t){return R_(4,4,e,t)}function RL(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function CL(e,t,r){return r=r!=null?r.concat([e]):null,R_(4,4,RL.bind(null,t,e),r)}function _y(){}function IL(e,t){var r=pn();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&uy(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function wL(e,t){var r=pn();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&uy(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function AL(e,t,r){return Ms&21?(Un(r,t)||(r=Pk(),Kt.lanes|=r,Us|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ei=!0),e.memoizedState=r)}function jj(e,t){var r=Tt;Tt=r!==0&&4>r?r:4,e(!0);var i=Um.transition;Um.transition={};try{e(!1),t()}finally{Tt=r,Um.transition=i}}function OL(){return pn().memoizedState}function Gj(e,t,r){var i=Da(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},bL(e))NL(t,r);else if(r=dL(e,t,r,i),r!==null){var n=ii();Mn(r,e,i,n),DL(r,t,i)}}function Wj(e,t,r){var i=Da(e),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(bL(e))NL(t,n);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var a=t.lastRenderedState,s=o(a,r);if(n.hasEagerState=!0,n.eagerState=s,Un(s,a)){var c=t.interleaved;c===null?(n.next=n,ay(t)):(n.next=c.next,c.next=n),t.interleaved=n;return}}catch{}finally{}r=dL(e,t,n,i),r!==null&&(n=ii(),Mn(r,e,i,n),DL(r,t,i))}}function bL(e){var t=e.alternate;return e===Kt||t!==null&&t===Kt}function NL(e,t){Bd=Lf=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function DL(e,t,r){if(r&4194240){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,zv(e,r)}}var Mf={readContext:hn,useCallback:jr,useContext:jr,useEffect:jr,useImperativeHandle:jr,useInsertionEffect:jr,useLayoutEffect:jr,useMemo:jr,useReducer:jr,useRef:jr,useState:jr,useDebugValue:jr,useDeferredValue:jr,useTransition:jr,useMutableSource:jr,useSyncExternalStore:jr,useId:jr,unstable_isNewReconciler:!1},Hj={readContext:hn,useCallback:function(e,t){return Jn().memoizedState=[e,t===void 0?null:t],e},useContext:hn,useEffect:MC,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Vp(4194308,4,RL.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Vp(4194308,4,e,t)},useInsertionEffect:function(e,t){return Vp(4,2,e,t)},useMemo:function(e,t){var r=Jn();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=Jn();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Gj.bind(null,Kt,e),[i.memoizedState,e]},useRef:function(e){var t=Jn();return e={current:e},t.memoizedState=e},useState:LC,useDebugValue:_y,useDeferredValue:function(e){return Jn().memoizedState=e},useTransition:function(){var e=LC(!1),t=e[0];return e=jj.bind(null,e[1]),Jn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=Kt,n=Jn();if(Vt){if(r===void 0)throw Error(ee(407));r=r()}else{if(r=t(),Nr===null)throw Error(ee(349));Ms&30||_L(i,t,r)}n.memoizedState=r;var o={value:r,getSnapshot:t};return n.queue=o,MC(EL.bind(null,i,o,e),[e]),i.flags|=2048,Tu(9,mL.bind(null,i,o,r,t),void 0,null),r},useId:function(){var e=Jn(),t=Nr.identifierPrefix;if(Vt){var r=Lo,i=ko;r=(i&~(1<<32-Ln(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=gu++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Bj++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Kj={readContext:hn,useCallback:IL,useContext:hn,useEffect:fy,useImperativeHandle:CL,useInsertionEffect:vL,useLayoutEffect:yL,useMemo:wL,useReducer:xm,useRef:TL,useState:function(){return xm(Su)},useDebugValue:_y,useDeferredValue:function(e){var t=pn();return AL(t,gr.memoizedState,e)},useTransition:function(){var e=xm(Su)[0],t=pn().memoizedState;return[e,t]},useMutableSource:pL,useSyncExternalStore:fL,useId:OL,unstable_isNewReconciler:!1},zj={readContext:hn,useCallback:IL,useContext:hn,useEffect:fy,useImperativeHandle:CL,useInsertionEffect:vL,useLayoutEffect:yL,useMemo:wL,useReducer:Vm,useRef:TL,useState:function(){return Vm(Su)},useDebugValue:_y,useDeferredValue:function(e){var t=pn();return gr===null?t.memoizedState=e:AL(t,gr.memoizedState,e)},useTransition:function(){var e=Vm(Su)[0],t=pn().memoizedState;return[e,t]},useMutableSource:pL,useSyncExternalStore:fL,useId:OL,unstable_isNewReconciler:!1};function On(e,t){if(e&&e.defaultProps){t=Yt({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function JS(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:Yt({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var C_={isMounted:function(e){return(e=e._reactInternals)?Hs(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=ii(),n=Da(e),o=Uo(i,n);o.payload=t,r!=null&&(o.callback=r),t=ba(e,o,n),t!==null&&(Mn(t,e,n,i),Up(t,e,n))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=ii(),n=Da(e),o=Uo(i,n);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=ba(e,o,n),t!==null&&(Mn(t,e,n,i),Up(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ii(),i=Da(e),n=Uo(r,i);n.tag=2,t!=null&&(n.callback=t),t=ba(e,n,i),t!==null&&(Mn(t,e,i,r),Up(t,e,i))}};function UC(e,t,r,i,n,o,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,o,a):t.prototype&&t.prototype.isPureReactComponent?!hu(r,i)||!hu(n,o):!0}function PL(e,t,r){var i=!1,n=Ba,o=t.contextType;return typeof o=="object"&&o!==null?o=hn(o):(n=Ti(t)?ks:Yr.current,i=t.contextTypes,o=(i=i!=null)?cl(e,n):Ba),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=C_,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=o),t}function xC(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&C_.enqueueReplaceState(t,t.state,null)}function QS(e,t,r,i){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs={},sy(e);var o=t.contextType;typeof o=="object"&&o!==null?n.context=hn(o):(o=Ti(t)?ks:Yr.current,n.context=cl(e,o)),n.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(JS(e,t,o,r),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&C_.enqueueReplaceState(n,n.state,null),Pf(e,r,n,i),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function hl(e,t){try{var r="",i=t;do r+=TB(i),i=i.return;while(i);var n=r}catch(o){n=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:n,digest:null}}function Fm(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function ZS(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Yj=typeof WeakMap=="function"?WeakMap:Map;function kL(e,t,r){r=Uo(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){xf||(xf=!0,lT=i),ZS(e,t)},r}function LL(e,t,r){r=Uo(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var n=t.value;r.payload=function(){return i(n)},r.callback=function(){ZS(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){ZS(e,t),typeof i!="function"&&(Na===null?Na=new Set([this]):Na.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),r}function VC(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new Yj;var n=new Set;i.set(t,n)}else n=i.get(t),n===void 0&&(n=new Set,i.set(t,n));n.has(r)||(n.add(r),e=s3.bind(null,e,t,r),t.then(e,e))}function FC(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function BC(e,t,r,i,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Uo(-1,1),t.tag=2,ba(r,t,1))),r.lanes|=1),e)}var $j=Ho.ReactCurrentOwner,Ei=!1;function Zr(e,t,r,i){t.child=e===null?lL(t,null,r,i):dl(t,e.child,r,i)}function jC(e,t,r,i,n){r=r.render;var o=t.ref;return qc(t,n),i=hy(e,t,r,i,o,n),r=py(),e!==null&&!Ei?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Go(e,t,n)):(Vt&&r&&ey(t),t.flags|=1,Zr(e,t,i,n),t.child)}function GC(e,t,r,i,n){if(e===null){var o=r.type;return typeof o=="function"&&!Ry(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,ML(e,t,o,i,n)):(e=Gp(r.type,null,i,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&n)){var a=o.memoizedProps;if(r=r.compare,r=r!==null?r:hu,r(a,i)&&e.ref===t.ref)return Go(e,t,n)}return t.flags|=1,e=Pa(o,i),e.ref=t.ref,e.return=t,t.child=e}function ML(e,t,r,i,n){if(e!==null){var o=e.memoizedProps;if(hu(o,i)&&e.ref===t.ref)if(Ei=!1,t.pendingProps=i=o,(e.lanes&n)!==0)e.flags&131072&&(Ei=!0);else return t.lanes=e.lanes,Go(e,t,n)}return eT(e,t,r,i,n)}function UL(e,t,r){var i=t.pendingProps,n=i.children,o=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},bt(kc,Ni),Ni|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,bt(kc,Ni),Ni|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=o!==null?o.baseLanes:r,bt(kc,Ni),Ni|=i}else o!==null?(i=o.baseLanes|r,t.memoizedState=null):i=r,bt(kc,Ni),Ni|=i;return Zr(e,t,n,r),t.child}function xL(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function eT(e,t,r,i,n){var o=Ti(r)?ks:Yr.current;return o=cl(t,o),qc(t,n),r=hy(e,t,r,i,o,n),i=py(),e!==null&&!Ei?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Go(e,t,n)):(Vt&&i&&ey(t),t.flags|=1,Zr(e,t,r,n),t.child)}function WC(e,t,r,i,n){if(Ti(r)){var o=!0;Af(t)}else o=!1;if(qc(t,n),t.stateNode===null)Fp(e,t),PL(t,r,i),QS(t,r,i,n),i=!0;else if(e===null){var a=t.stateNode,s=t.memoizedProps;a.props=s;var c=a.context,l=r.contextType;typeof l=="object"&&l!==null?l=hn(l):(l=Ti(r)?ks:Yr.current,l=cl(t,l));var d=r.getDerivedStateFromProps,u=typeof d=="function"||typeof a.getSnapshotBeforeUpdate=="function";u||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==i||c!==l)&&xC(t,a,i,l),ca=!1;var h=t.memoizedState;a.state=h,Pf(t,i,a,n),c=t.memoizedState,s!==i||h!==c||Si.current||ca?(typeof d=="function"&&(JS(t,r,d,i),c=t.memoizedState),(s=ca||UC(t,r,s,i,h,c,l))?(u||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),a.props=i,a.state=c,a.context=l,i=s):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,uL(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:On(t.type,s),a.props=l,u=t.pendingProps,h=a.context,c=r.contextType,typeof c=="object"&&c!==null?c=hn(c):(c=Ti(r)?ks:Yr.current,c=cl(t,c));var p=r.getDerivedStateFromProps;(d=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==u||h!==c)&&xC(t,a,i,c),ca=!1,h=t.memoizedState,a.state=h,Pf(t,i,a,n);var g=t.memoizedState;s!==u||h!==g||Si.current||ca?(typeof p=="function"&&(JS(t,r,p,i),g=t.memoizedState),(l=ca||UC(t,r,l,i,h,g,c)||!1)?(d||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,g,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,g,c)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=g),a.props=i,a.state=g,a.context=c,i=l):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return tT(e,t,r,i,o,n)}function tT(e,t,r,i,n,o){xL(e,t);var a=(t.flags&128)!==0;if(!i&&!a)return n&&OC(t,r,!1),Go(e,t,o);i=t.stateNode,$j.current=t;var s=a&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&a?(t.child=dl(t,e.child,null,o),t.child=dl(t,null,s,o)):Zr(e,t,s,o),t.memoizedState=i.state,n&&OC(t,r,!0),t.child}function VL(e){var t=e.stateNode;t.pendingContext?AC(e,t.pendingContext,t.pendingContext!==t.context):t.context&&AC(e,t.context,!1),cy(e,t.containerInfo)}function HC(e,t,r,i,n){return ll(),ry(n),t.flags|=256,Zr(e,t,r,i),t.child}var rT={dehydrated:null,treeContext:null,retryLane:0};function iT(e){return{baseLanes:e,cachePool:null,transitions:null}}function FL(e,t,r){var i=t.pendingProps,n=Gt.current,o=!1,a=(t.flags&128)!==0,s;if((s=a)||(s=e!==null&&e.memoizedState===null?!1:(n&2)!==0),s?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),bt(Gt,n&1),e===null)return qS(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=i.children,e=i.fallback,o?(i=t.mode,o=t.child,a={mode:"hidden",children:a},!(i&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=A_(a,i,0,null),e=As(e,i,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=iT(r),t.memoizedState=rT,e):my(t,a));if(n=e.memoizedState,n!==null&&(s=n.dehydrated,s!==null))return qj(e,t,a,i,s,n,r);if(o){o=i.fallback,a=t.mode,n=e.child,s=n.sibling;var c={mode:"hidden",children:i.children};return!(a&1)&&t.child!==n?(i=t.child,i.childLanes=0,i.pendingProps=c,t.deletions=null):(i=Pa(n,c),i.subtreeFlags=n.subtreeFlags&14680064),s!==null?o=Pa(s,o):(o=As(o,a,r,null),o.flags|=2),o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,a=e.child.memoizedState,a=a===null?iT(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=e.childLanes&~r,t.memoizedState=rT,i}return o=e.child,e=o.sibling,i=Pa(o,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function my(e,t){return t=A_({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Dh(e,t,r,i){return i!==null&&ry(i),dl(t,e.child,null,r),e=my(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function qj(e,t,r,i,n,o,a){if(r)return t.flags&256?(t.flags&=-257,i=Fm(Error(ee(422))),Dh(e,t,a,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=i.fallback,n=t.mode,i=A_({mode:"visible",children:i.children},n,0,null),o=As(o,n,a,null),o.flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,t.mode&1&&dl(t,e.child,null,a),t.child.memoizedState=iT(a),t.memoizedState=rT,o);if(!(t.mode&1))return Dh(e,t,a,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var s=i.dgst;return i=s,o=Error(ee(419)),i=Fm(o,i,void 0),Dh(e,t,a,i)}if(s=(a&e.childLanes)!==0,Ei||s){if(i=Nr,i!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|a)?0:n,n!==0&&n!==o.retryLane&&(o.retryLane=n,jo(e,n),Mn(i,e,n,-1))}return yy(),i=Fm(Error(ee(421))),Dh(e,t,a,i)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=c3.bind(null,e),n._reactRetry=t,null):(e=o.treeContext,ki=Oa(n.nextSibling),xi=t,Vt=!0,Dn=null,e!==null&&(rn[nn++]=ko,rn[nn++]=Lo,rn[nn++]=Ls,ko=e.id,Lo=e.overflow,Ls=t),t=my(t,i.children),t.flags|=4096,t)}function KC(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),XS(e.return,t,r)}function Bm(e,t,r,i,n){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=r,o.tailMode=n)}function BL(e,t,r){var i=t.pendingProps,n=i.revealOrder,o=i.tail;if(Zr(e,t,i.children,r),i=Gt.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&KC(e,r,t);else if(e.tag===19)KC(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(bt(Gt,i),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(r=t.child,n=null;r!==null;)e=r.alternate,e!==null&&kf(e)===null&&(n=r),r=r.sibling;r=n,r===null?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),Bm(t,!1,n,r,o);break;case"backwards":for(r=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&kf(e)===null){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}Bm(t,!0,r,null,o);break;case"together":Bm(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Fp(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Go(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Us|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ee(153));if(t.child!==null){for(e=t.child,r=Pa(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Pa(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Xj(e,t,r){switch(t.tag){case 3:VL(t),ll();break;case 5:hL(t);break;case 1:Ti(t.type)&&Af(t);break;case 4:cy(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,n=t.memoizedProps.value;bt(Nf,i._currentValue),i._currentValue=n;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(bt(Gt,Gt.current&1),t.flags|=128,null):r&t.child.childLanes?FL(e,t,r):(bt(Gt,Gt.current&1),e=Go(e,t,r),e!==null?e.sibling:null);bt(Gt,Gt.current&1);break;case 19:if(i=(r&t.childLanes)!==0,e.flags&128){if(i)return BL(e,t,r);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),bt(Gt,Gt.current),i)break;return null;case 22:case 23:return t.lanes=0,UL(e,t,r)}return Go(e,t,r)}var jL,nT,GL,WL;jL=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};nT=function(){};GL=function(e,t,r,i){var n=e.memoizedProps;if(n!==i){e=t.stateNode,Es(so.current);var o=null;switch(r){case"input":n=wS(e,n),i=wS(e,i),o=[];break;case"select":n=Yt({},n,{value:void 0}),i=Yt({},i,{value:void 0}),o=[];break;case"textarea":n=bS(e,n),i=bS(e,i),o=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=If)}DS(r,i);var a;r=null;for(l in n)if(!i.hasOwnProperty(l)&&n.hasOwnProperty(l)&&n[l]!=null)if(l==="style"){var s=n[l];for(a in s)s.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(ou.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in i){var c=i[l];if(s=n!=null?n[l]:void 0,i.hasOwnProperty(l)&&c!==s&&(c!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in c)c.hasOwnProperty(a)&&s[a]!==c[a]&&(r||(r={}),r[a]=c[a])}else r||(o||(o=[]),o.push(l,r)),r=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,s=s?s.__html:void 0,c!=null&&s!==c&&(o=o||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(ou.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Nt("scroll",e),o||s===c||(o=[])):(o=o||[]).push(l,c))}r&&(o=o||[]).push("style",r);var l=o;(t.updateQueue=l)&&(t.flags|=4)}};WL=function(e,t,r,i){r!==i&&(t.flags|=4)};function Ql(e,t){if(!Vt)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Gr(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function Jj(e,t,r){var i=t.pendingProps;switch(ty(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gr(t),null;case 1:return Ti(t.type)&&wf(),Gr(t),null;case 3:return i=t.stateNode,ul(),Mt(Si),Mt(Yr),dy(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(bh(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Dn!==null&&(hT(Dn),Dn=null))),nT(e,t),Gr(t),null;case 5:ly(t);var n=Es(Eu.current);if(r=t.type,e!==null&&t.stateNode!=null)GL(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(ee(166));return Gr(t),null}if(e=Es(so.current),bh(t)){i=t.stateNode,r=t.type;var o=t.memoizedProps;switch(i[Zn]=t,i[_u]=o,e=(t.mode&1)!==0,r){case"dialog":Nt("cancel",i),Nt("close",i);break;case"iframe":case"object":case"embed":Nt("load",i);break;case"video":case"audio":for(n=0;n<vd.length;n++)Nt(vd[n],i);break;case"source":Nt("error",i);break;case"img":case"image":case"link":Nt("error",i),Nt("load",i);break;case"details":Nt("toggle",i);break;case"input":eC(i,o),Nt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Nt("invalid",i);break;case"textarea":rC(i,o),Nt("invalid",i)}DS(r,o),n=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?i.textContent!==s&&(o.suppressHydrationWarning!==!0&&Oh(i.textContent,s,e),n=["children",s]):typeof s=="number"&&i.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&Oh(i.textContent,s,e),n=["children",""+s]):ou.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&Nt("scroll",i)}switch(r){case"input":Th(i),tC(i,o,!0);break;case"textarea":Th(i),iC(i);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(i.onclick=If)}i=n,t.updateQueue=i,i!==null&&(t.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Ek(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=a.createElement(r,{is:i.is}):(e=a.createElement(r),r==="select"&&(a=e,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):e=a.createElementNS(e,r),e[Zn]=t,e[_u]=i,jL(e,t,!1,!1),t.stateNode=e;e:{switch(a=PS(r,i),r){case"dialog":Nt("cancel",e),Nt("close",e),n=i;break;case"iframe":case"object":case"embed":Nt("load",e),n=i;break;case"video":case"audio":for(n=0;n<vd.length;n++)Nt(vd[n],e);n=i;break;case"source":Nt("error",e),n=i;break;case"img":case"image":case"link":Nt("error",e),Nt("load",e),n=i;break;case"details":Nt("toggle",e),n=i;break;case"input":eC(e,i),n=wS(e,i),Nt("invalid",e);break;case"option":n=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},n=Yt({},i,{value:void 0}),Nt("invalid",e);break;case"textarea":rC(e,i),n=bS(e,i),Nt("invalid",e);break;default:n=i}DS(r,n),s=n;for(o in s)if(s.hasOwnProperty(o)){var c=s[o];o==="style"?Tk(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&gk(e,c)):o==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&au(e,c):typeof c=="number"&&au(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(ou.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Nt("scroll",e):c!=null&&Bv(e,o,c,a))}switch(r){case"input":Th(e),tC(e,i,!1);break;case"textarea":Th(e),iC(e);break;case"option":i.value!=null&&e.setAttribute("value",""+Fa(i.value));break;case"select":e.multiple=!!i.multiple,o=i.value,o!=null?Kc(e,!!i.multiple,o,!1):i.defaultValue!=null&&Kc(e,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=If)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Gr(t),null;case 6:if(e&&t.stateNode!=null)WL(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(ee(166));if(r=Es(Eu.current),Es(so.current),bh(t)){if(i=t.stateNode,r=t.memoizedProps,i[Zn]=t,(o=i.nodeValue!==r)&&(e=xi,e!==null))switch(e.tag){case 3:Oh(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Oh(i.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[Zn]=t,t.stateNode=i}return Gr(t),null;case 13:if(Mt(Gt),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Vt&&ki!==null&&t.mode&1&&!(t.flags&128))sL(),ll(),t.flags|=98560,o=!1;else if(o=bh(t),i!==null&&i.dehydrated!==null){if(e===null){if(!o)throw Error(ee(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(ee(317));o[Zn]=t}else ll(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Gr(t),o=!1}else Dn!==null&&(hT(Dn),Dn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||Gt.current&1?Tr===0&&(Tr=3):yy())),t.updateQueue!==null&&(t.flags|=4),Gr(t),null);case 4:return ul(),nT(e,t),e===null&&pu(t.stateNode.containerInfo),Gr(t),null;case 10:return oy(t.type._context),Gr(t),null;case 17:return Ti(t.type)&&wf(),Gr(t),null;case 19:if(Mt(Gt),o=t.memoizedState,o===null)return Gr(t),null;if(i=(t.flags&128)!==0,a=o.rendering,a===null)if(i)Ql(o,!1);else{if(Tr!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=kf(e),a!==null){for(t.flags|=128,Ql(o,!1),i=a.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)o=r,e=i,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,e=a.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return bt(Gt,Gt.current&1|2),t.child}e=e.sibling}o.tail!==null&&sr()>pl&&(t.flags|=128,i=!0,Ql(o,!1),t.lanes=4194304)}else{if(!i)if(e=kf(a),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Ql(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!Vt)return Gr(t),null}else 2*sr()-o.renderingStartTime>pl&&r!==1073741824&&(t.flags|=128,i=!0,Ql(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(r=o.last,r!==null?r.sibling=a:t.child=a,o.last=a)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=sr(),t.sibling=null,r=Gt.current,bt(Gt,i?r&1|2:r&1),t):(Gr(t),null);case 22:case 23:return vy(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?Ni&1073741824&&(Gr(t),t.subtreeFlags&6&&(t.flags|=8192)):Gr(t),null;case 24:return null;case 25:return null}throw Error(ee(156,t.tag))}function Qj(e,t){switch(ty(t),t.tag){case 1:return Ti(t.type)&&wf(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ul(),Mt(Si),Mt(Yr),dy(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return ly(t),null;case 13:if(Mt(Gt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ee(340));ll()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Mt(Gt),null;case 4:return ul(),null;case 10:return oy(t.type._context),null;case 22:case 23:return vy(),null;case 24:return null;default:return null}}var Ph=!1,zr=!1,Zj=typeof WeakSet=="function"?WeakSet:Set,le=null;function Pc(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){Qt(e,t,i)}else r.current=null}function oT(e,t,r){try{r()}catch(i){Qt(e,t,i)}}var zC=!1;function e3(e,t){if(GS=yf,e=$k(),Zv(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var a=0,s=-1,c=-1,l=0,d=0,u=e,h=null;t:for(;;){for(var p;u!==r||n!==0&&u.nodeType!==3||(s=a+n),u!==o||i!==0&&u.nodeType!==3||(c=a+i),u.nodeType===3&&(a+=u.nodeValue.length),(p=u.firstChild)!==null;)h=u,u=p;for(;;){if(u===e)break t;if(h===r&&++l===n&&(s=a),h===o&&++d===i&&(c=a),(p=u.nextSibling)!==null)break;u=h,h=u.parentNode}u=p}r=s===-1||c===-1?null:{start:s,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(WS={focusedElem:e,selectionRange:r},yf=!1,le=t;le!==null;)if(t=le,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,le=e;else for(;le!==null;){t=le;try{var g=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,E=g.memoizedState,S=t.stateNode,T=S.getSnapshotBeforeUpdate(t.elementType===t.type?_:On(t.type,_),E);S.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var y=t.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(I){Qt(t,t.return,I)}if(e=t.sibling,e!==null){e.return=t.return,le=e;break}le=t.return}return g=zC,zC=!1,g}function jd(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&e)===e){var o=n.destroy;n.destroy=void 0,o!==void 0&&oT(t,r,o)}n=n.next}while(n!==i)}}function I_(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function aT(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function HL(e){var t=e.alternate;t!==null&&(e.alternate=null,HL(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Zn],delete t[_u],delete t[zS],delete t[Uj],delete t[xj])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function KL(e){return e.tag===5||e.tag===3||e.tag===4}function YC(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||KL(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function sT(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=If));else if(i!==4&&(e=e.child,e!==null))for(sT(e,t,r),e=e.sibling;e!==null;)sT(e,t,r),e=e.sibling}function cT(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(cT(e,t,r),e=e.sibling;e!==null;)cT(e,t,r),e=e.sibling}var kr=null,bn=!1;function $o(e,t,r){for(r=r.child;r!==null;)zL(e,t,r),r=r.sibling}function zL(e,t,r){if(ao&&typeof ao.onCommitFiberUnmount=="function")try{ao.onCommitFiberUnmount(E_,r)}catch{}switch(r.tag){case 5:zr||Pc(r,t);case 6:var i=kr,n=bn;kr=null,$o(e,t,r),kr=i,bn=n,kr!==null&&(bn?(e=kr,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):kr.removeChild(r.stateNode));break;case 18:kr!==null&&(bn?(e=kr,r=r.stateNode,e.nodeType===8?km(e.parentNode,r):e.nodeType===1&&km(e,r),du(e)):km(kr,r.stateNode));break;case 4:i=kr,n=bn,kr=r.stateNode.containerInfo,bn=!0,$o(e,t,r),kr=i,bn=n;break;case 0:case 11:case 14:case 15:if(!zr&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var o=n,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&oT(r,t,a),n=n.next}while(n!==i)}$o(e,t,r);break;case 1:if(!zr&&(Pc(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(s){Qt(r,t,s)}$o(e,t,r);break;case 21:$o(e,t,r);break;case 22:r.mode&1?(zr=(i=zr)||r.memoizedState!==null,$o(e,t,r),zr=i):$o(e,t,r);break;default:$o(e,t,r)}}function $C(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Zj),t.forEach(function(i){var n=l3.bind(null,e,i);r.has(i)||(r.add(i),i.then(n,n))})}}function Sn(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var o=e,a=t,s=a;e:for(;s!==null;){switch(s.tag){case 5:kr=s.stateNode,bn=!1;break e;case 3:kr=s.stateNode.containerInfo,bn=!0;break e;case 4:kr=s.stateNode.containerInfo,bn=!0;break e}s=s.return}if(kr===null)throw Error(ee(160));zL(o,a,n),kr=null,bn=!1;var c=n.alternate;c!==null&&(c.return=null),n.return=null}catch(l){Qt(n,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)YL(t,e),t=t.sibling}function YL(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Sn(t,e),Gn(e),i&4){try{jd(3,e,e.return),I_(3,e)}catch(_){Qt(e,e.return,_)}try{jd(5,e,e.return)}catch(_){Qt(e,e.return,_)}}break;case 1:Sn(t,e),Gn(e),i&512&&r!==null&&Pc(r,r.return);break;case 5:if(Sn(t,e),Gn(e),i&512&&r!==null&&Pc(r,r.return),e.flags&32){var n=e.stateNode;try{au(n,"")}catch(_){Qt(e,e.return,_)}}if(i&4&&(n=e.stateNode,n!=null)){var o=e.memoizedProps,a=r!==null?r.memoizedProps:o,s=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&_k(n,o),PS(s,a);var l=PS(s,o);for(a=0;a<c.length;a+=2){var d=c[a],u=c[a+1];d==="style"?Tk(n,u):d==="dangerouslySetInnerHTML"?gk(n,u):d==="children"?au(n,u):Bv(n,d,u,l)}switch(s){case"input":AS(n,o);break;case"textarea":mk(n,o);break;case"select":var h=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?Kc(n,!!o.multiple,p,!1):h!==!!o.multiple&&(o.defaultValue!=null?Kc(n,!!o.multiple,o.defaultValue,!0):Kc(n,!!o.multiple,o.multiple?[]:"",!1))}n[_u]=o}catch(_){Qt(e,e.return,_)}}break;case 6:if(Sn(t,e),Gn(e),i&4){if(e.stateNode===null)throw Error(ee(162));n=e.stateNode,o=e.memoizedProps;try{n.nodeValue=o}catch(_){Qt(e,e.return,_)}}break;case 3:if(Sn(t,e),Gn(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{du(t.containerInfo)}catch(_){Qt(e,e.return,_)}break;case 4:Sn(t,e),Gn(e);break;case 13:Sn(t,e),Gn(e),n=e.child,n.flags&8192&&(o=n.memoizedState!==null,n.stateNode.isHidden=o,!o||n.alternate!==null&&n.alternate.memoizedState!==null||(Sy=sr())),i&4&&$C(e);break;case 22:if(d=r!==null&&r.memoizedState!==null,e.mode&1?(zr=(l=zr)||d,Sn(t,e),zr=l):Sn(t,e),Gn(e),i&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!d&&e.mode&1)for(le=e,d=e.child;d!==null;){for(u=le=d;le!==null;){switch(h=le,p=h.child,h.tag){case 0:case 11:case 14:case 15:jd(4,h,h.return);break;case 1:Pc(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){i=h,r=h.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(_){Qt(i,r,_)}}break;case 5:Pc(h,h.return);break;case 22:if(h.memoizedState!==null){XC(u);continue}}p!==null?(p.return=h,le=p):XC(u)}d=d.sibling}e:for(d=null,u=e;;){if(u.tag===5){if(d===null){d=u;try{n=u.stateNode,l?(o=n.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=u.stateNode,c=u.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,s.style.display=Sk("display",a))}catch(_){Qt(e,e.return,_)}}}else if(u.tag===6){if(d===null)try{u.stateNode.nodeValue=l?"":u.memoizedProps}catch(_){Qt(e,e.return,_)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===e)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===e)break e;for(;u.sibling===null;){if(u.return===null||u.return===e)break e;d===u&&(d=null),u=u.return}d===u&&(d=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:Sn(t,e),Gn(e),i&4&&$C(e);break;case 21:break;default:Sn(t,e),Gn(e)}}function Gn(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(KL(r)){var i=r;break e}r=r.return}throw Error(ee(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(au(n,""),i.flags&=-33);var o=YC(e);cT(e,o,n);break;case 3:case 4:var a=i.stateNode.containerInfo,s=YC(e);sT(e,s,a);break;default:throw Error(ee(161))}}catch(c){Qt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function t3(e,t,r){le=e,$L(e)}function $L(e,t,r){for(var i=(e.mode&1)!==0;le!==null;){var n=le,o=n.child;if(n.tag===22&&i){var a=n.memoizedState!==null||Ph;if(!a){var s=n.alternate,c=s!==null&&s.memoizedState!==null||zr;s=Ph;var l=zr;if(Ph=a,(zr=c)&&!l)for(le=n;le!==null;)a=le,c=a.child,a.tag===22&&a.memoizedState!==null?JC(n):c!==null?(c.return=a,le=c):JC(n);for(;o!==null;)le=o,$L(o),o=o.sibling;le=n,Ph=s,zr=l}qC(e)}else n.subtreeFlags&8772&&o!==null?(o.return=n,le=o):qC(e)}}function qC(e){for(;le!==null;){var t=le;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:zr||I_(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!zr)if(r===null)i.componentDidMount();else{var n=t.elementType===t.type?r.memoizedProps:On(t.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&kC(t,o,i);break;case 3:var a=t.updateQueue;if(a!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}kC(t,a,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var d=l.memoizedState;if(d!==null){var u=d.dehydrated;u!==null&&du(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}zr||t.flags&512&&aT(t)}catch(h){Qt(t,t.return,h)}}if(t===e){le=null;break}if(r=t.sibling,r!==null){r.return=t.return,le=r;break}le=t.return}}function XC(e){for(;le!==null;){var t=le;if(t===e){le=null;break}var r=t.sibling;if(r!==null){r.return=t.return,le=r;break}le=t.return}}function JC(e){for(;le!==null;){var t=le;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{I_(4,t)}catch(c){Qt(t,r,c)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var n=t.return;try{i.componentDidMount()}catch(c){Qt(t,n,c)}}var o=t.return;try{aT(t)}catch(c){Qt(t,o,c)}break;case 5:var a=t.return;try{aT(t)}catch(c){Qt(t,a,c)}}}catch(c){Qt(t,t.return,c)}if(t===e){le=null;break}var s=t.sibling;if(s!==null){s.return=t.return,le=s;break}le=t.return}}var r3=Math.ceil,Uf=Ho.ReactCurrentDispatcher,Ey=Ho.ReactCurrentOwner,dn=Ho.ReactCurrentBatchConfig,et=0,Nr=null,hr=null,Ur=0,Ni=0,kc=Ka(0),Tr=0,vu=null,Us=0,w_=0,gy=0,Gd=null,hi=null,Sy=0,pl=1/0,Ao=null,xf=!1,lT=null,Na=null,kh=!1,ma=null,Vf=0,Wd=0,dT=null,Bp=-1,jp=0;function ii(){return et&6?sr():Bp!==-1?Bp:Bp=sr()}function Da(e){return e.mode&1?et&2&&Ur!==0?Ur&-Ur:Fj.transition!==null?(jp===0&&(jp=Pk()),jp):(e=Tt,e!==0||(e=window.event,e=e===void 0?16:Fk(e.type)),e):1}function Mn(e,t,r,i){if(50<Wd)throw Wd=0,dT=null,Error(ee(185));Xu(e,r,i),(!(et&2)||e!==Nr)&&(e===Nr&&(!(et&2)&&(w_|=r),Tr===4&&da(e,Ur)),vi(e,i),r===1&&et===0&&!(t.mode&1)&&(pl=sr()+500,y_&&za()))}function vi(e,t){var r=e.callbackNode;FB(e,t);var i=vf(e,e===Nr?Ur:0);if(i===0)r!==null&&aC(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&aC(r),t===1)e.tag===0?Vj(QC.bind(null,e)):nL(QC.bind(null,e)),Lj(function(){!(et&6)&&za()}),r=null;else{switch(kk(i)){case 1:r=Kv;break;case 4:r=Nk;break;case 16:r=Tf;break;case 536870912:r=Dk;break;default:r=Tf}r=rM(r,qL.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function qL(e,t){if(Bp=-1,jp=0,et&6)throw Error(ee(327));var r=e.callbackNode;if(Xc()&&e.callbackNode!==r)return null;var i=vf(e,e===Nr?Ur:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=Ff(e,i);else{t=i;var n=et;et|=2;var o=JL();(Nr!==e||Ur!==t)&&(Ao=null,pl=sr()+500,ws(e,t));do try{o3();break}catch(s){XL(e,s)}while(!0);ny(),Uf.current=o,et=n,hr!==null?t=0:(Nr=null,Ur=0,t=Tr)}if(t!==0){if(t===2&&(n=xS(e),n!==0&&(i=n,t=uT(e,n))),t===1)throw r=vu,ws(e,0),da(e,i),vi(e,sr()),r;if(t===6)da(e,i);else{if(n=e.current.alternate,!(i&30)&&!i3(n)&&(t=Ff(e,i),t===2&&(o=xS(e),o!==0&&(i=o,t=uT(e,o))),t===1))throw r=vu,ws(e,0),da(e,i),vi(e,sr()),r;switch(e.finishedWork=n,e.finishedLanes=i,t){case 0:case 1:throw Error(ee(345));case 2:as(e,hi,Ao);break;case 3:if(da(e,i),(i&130023424)===i&&(t=Sy+500-sr(),10<t)){if(vf(e,0)!==0)break;if(n=e.suspendedLanes,(n&i)!==i){ii(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=KS(as.bind(null,e,hi,Ao),t);break}as(e,hi,Ao);break;case 4:if(da(e,i),(i&4194240)===i)break;for(t=e.eventTimes,n=-1;0<i;){var a=31-Ln(i);o=1<<a,a=t[a],a>n&&(n=a),i&=~o}if(i=n,i=sr()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*r3(i/1960))-i,10<i){e.timeoutHandle=KS(as.bind(null,e,hi,Ao),i);break}as(e,hi,Ao);break;case 5:as(e,hi,Ao);break;default:throw Error(ee(329))}}}return vi(e,sr()),e.callbackNode===r?qL.bind(null,e):null}function uT(e,t){var r=Gd;return e.current.memoizedState.isDehydrated&&(ws(e,t).flags|=256),e=Ff(e,t),e!==2&&(t=hi,hi=r,t!==null&&hT(t)),e}function hT(e){hi===null?hi=e:hi.push.apply(hi,e)}function i3(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],o=n.getSnapshot;n=n.value;try{if(!Un(o(),n))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function da(e,t){for(t&=~gy,t&=~w_,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Ln(t),i=1<<r;e[r]=-1,t&=~i}}function QC(e){if(et&6)throw Error(ee(327));Xc();var t=vf(e,0);if(!(t&1))return vi(e,sr()),null;var r=Ff(e,t);if(e.tag!==0&&r===2){var i=xS(e);i!==0&&(t=i,r=uT(e,i))}if(r===1)throw r=vu,ws(e,0),da(e,t),vi(e,sr()),r;if(r===6)throw Error(ee(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,as(e,hi,Ao),vi(e,sr()),null}function Ty(e,t){var r=et;et|=1;try{return e(t)}finally{et=r,et===0&&(pl=sr()+500,y_&&za())}}function xs(e){ma!==null&&ma.tag===0&&!(et&6)&&Xc();var t=et;et|=1;var r=dn.transition,i=Tt;try{if(dn.transition=null,Tt=1,e)return e()}finally{Tt=i,dn.transition=r,et=t,!(et&6)&&za()}}function vy(){Ni=kc.current,Mt(kc)}function ws(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,kj(r)),hr!==null)for(r=hr.return;r!==null;){var i=r;switch(ty(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&wf();break;case 3:ul(),Mt(Si),Mt(Yr),dy();break;case 5:ly(i);break;case 4:ul();break;case 13:Mt(Gt);break;case 19:Mt(Gt);break;case 10:oy(i.type._context);break;case 22:case 23:vy()}r=r.return}if(Nr=e,hr=e=Pa(e.current,null),Ur=Ni=t,Tr=0,vu=null,gy=w_=Us=0,hi=Gd=null,ms!==null){for(t=0;t<ms.length;t++)if(r=ms[t],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,o=r.pending;if(o!==null){var a=o.next;o.next=n,i.next=a}r.pending=i}ms=null}return e}function XL(e,t){do{var r=hr;try{if(ny(),xp.current=Mf,Lf){for(var i=Kt.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}Lf=!1}if(Ms=0,Ir=gr=Kt=null,Bd=!1,gu=0,Ey.current=null,r===null||r.return===null){Tr=1,vu=t,hr=null;break}e:{var o=e,a=r.return,s=r,c=t;if(t=Ur,s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,d=s,u=d.tag;if(!(d.mode&1)&&(u===0||u===11||u===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=FC(a);if(p!==null){p.flags&=-257,BC(p,a,s,o,t),p.mode&1&&VC(o,l,t),t=p,c=l;var g=t.updateQueue;if(g===null){var _=new Set;_.add(c),t.updateQueue=_}else g.add(c);break e}else{if(!(t&1)){VC(o,l,t),yy();break e}c=Error(ee(426))}}else if(Vt&&s.mode&1){var E=FC(a);if(E!==null){!(E.flags&65536)&&(E.flags|=256),BC(E,a,s,o,t),ry(hl(c,s));break e}}o=c=hl(c,s),Tr!==4&&(Tr=2),Gd===null?Gd=[o]:Gd.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var S=kL(o,c,t);PC(o,S);break e;case 1:s=c;var T=o.type,y=o.stateNode;if(!(o.flags&128)&&(typeof T.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Na===null||!Na.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t;var I=LL(o,s,t);PC(o,I);break e}}o=o.return}while(o!==null)}ZL(r)}catch(O){t=O,hr===r&&r!==null&&(hr=r=r.return);continue}break}while(!0)}function JL(){var e=Uf.current;return Uf.current=Mf,e===null?Mf:e}function yy(){(Tr===0||Tr===3||Tr===2)&&(Tr=4),Nr===null||!(Us&268435455)&&!(w_&268435455)||da(Nr,Ur)}function Ff(e,t){var r=et;et|=2;var i=JL();(Nr!==e||Ur!==t)&&(Ao=null,ws(e,t));do try{n3();break}catch(n){XL(e,n)}while(!0);if(ny(),et=r,Uf.current=i,hr!==null)throw Error(ee(261));return Nr=null,Ur=0,Tr}function n3(){for(;hr!==null;)QL(hr)}function o3(){for(;hr!==null&&!NB();)QL(hr)}function QL(e){var t=tM(e.alternate,e,Ni);e.memoizedProps=e.pendingProps,t===null?ZL(e):hr=t,Ey.current=null}function ZL(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Qj(r,t),r!==null){r.flags&=32767,hr=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Tr=6,hr=null;return}}else if(r=Jj(r,t,Ni),r!==null){hr=r;return}if(t=t.sibling,t!==null){hr=t;return}hr=t=e}while(t!==null);Tr===0&&(Tr=5)}function as(e,t,r){var i=Tt,n=dn.transition;try{dn.transition=null,Tt=1,a3(e,t,r,i)}finally{dn.transition=n,Tt=i}return null}function a3(e,t,r,i){do Xc();while(ma!==null);if(et&6)throw Error(ee(327));r=e.finishedWork;var n=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(ee(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(BB(e,o),e===Nr&&(hr=Nr=null,Ur=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||kh||(kh=!0,rM(Tf,function(){return Xc(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=dn.transition,dn.transition=null;var a=Tt;Tt=1;var s=et;et|=4,Ey.current=null,e3(e,r),YL(r,e),wj(WS),yf=!!GS,WS=GS=null,e.current=r,t3(r),DB(),et=s,Tt=a,dn.transition=o}else e.current=r;if(kh&&(kh=!1,ma=e,Vf=n),o=e.pendingLanes,o===0&&(Na=null),LB(r.stateNode),vi(e,sr()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)n=t[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(xf)throw xf=!1,e=lT,lT=null,e;return Vf&1&&e.tag!==0&&Xc(),o=e.pendingLanes,o&1?e===dT?Wd++:(Wd=0,dT=e):Wd=0,za(),null}function Xc(){if(ma!==null){var e=kk(Vf),t=dn.transition,r=Tt;try{if(dn.transition=null,Tt=16>e?16:e,ma===null)var i=!1;else{if(e=ma,ma=null,Vf=0,et&6)throw Error(ee(331));var n=et;for(et|=4,le=e.current;le!==null;){var o=le,a=o.child;if(le.flags&16){var s=o.deletions;if(s!==null){for(var c=0;c<s.length;c++){var l=s[c];for(le=l;le!==null;){var d=le;switch(d.tag){case 0:case 11:case 15:jd(8,d,o)}var u=d.child;if(u!==null)u.return=d,le=u;else for(;le!==null;){d=le;var h=d.sibling,p=d.return;if(HL(d),d===l){le=null;break}if(h!==null){h.return=p,le=h;break}le=p}}}var g=o.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var E=_.sibling;_.sibling=null,_=E}while(_!==null)}}le=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,le=a;else e:for(;le!==null;){if(o=le,o.flags&2048)switch(o.tag){case 0:case 11:case 15:jd(9,o,o.return)}var S=o.sibling;if(S!==null){S.return=o.return,le=S;break e}le=o.return}}var T=e.current;for(le=T;le!==null;){a=le;var y=a.child;if(a.subtreeFlags&2064&&y!==null)y.return=a,le=y;else e:for(a=T;le!==null;){if(s=le,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:I_(9,s)}}catch(O){Qt(s,s.return,O)}if(s===a){le=null;break e}var I=s.sibling;if(I!==null){I.return=s.return,le=I;break e}le=s.return}}if(et=n,za(),ao&&typeof ao.onPostCommitFiberRoot=="function")try{ao.onPostCommitFiberRoot(E_,e)}catch{}i=!0}return i}finally{Tt=r,dn.transition=t}}return!1}function ZC(e,t,r){t=hl(r,t),t=kL(e,t,1),e=ba(e,t,1),t=ii(),e!==null&&(Xu(e,1,t),vi(e,t))}function Qt(e,t,r){if(e.tag===3)ZC(e,e,r);else for(;t!==null;){if(t.tag===3){ZC(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Na===null||!Na.has(i))){e=hl(r,e),e=LL(t,e,1),t=ba(t,e,1),e=ii(),t!==null&&(Xu(t,1,e),vi(t,e));break}}t=t.return}}function s3(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=ii(),e.pingedLanes|=e.suspendedLanes&r,Nr===e&&(Ur&r)===r&&(Tr===4||Tr===3&&(Ur&130023424)===Ur&&500>sr()-Sy?ws(e,0):gy|=r),vi(e,t)}function eM(e,t){t===0&&(e.mode&1?(t=Rh,Rh<<=1,!(Rh&130023424)&&(Rh=4194304)):t=1);var r=ii();e=jo(e,t),e!==null&&(Xu(e,t,r),vi(e,r))}function c3(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),eM(e,r)}function l3(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,n=e.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(ee(314))}i!==null&&i.delete(t),eM(e,r)}var tM;tM=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Si.current)Ei=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Ei=!1,Xj(e,t,r);Ei=!!(e.flags&131072)}else Ei=!1,Vt&&t.flags&1048576&&oL(t,bf,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Fp(e,t),e=t.pendingProps;var n=cl(t,Yr.current);qc(t,r),n=hy(null,t,i,e,n,r);var o=py();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ti(i)?(o=!0,Af(t)):o=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,sy(t),n.updater=C_,t.stateNode=n,n._reactInternals=t,QS(t,i,e,r),t=tT(null,t,i,!0,o,r)):(t.tag=0,Vt&&o&&ey(t),Zr(null,t,n,r),t=t.child),t;case 16:i=t.elementType;e:{switch(Fp(e,t),e=t.pendingProps,n=i._init,i=n(i._payload),t.type=i,n=t.tag=u3(i),e=On(i,e),n){case 0:t=eT(null,t,i,e,r);break e;case 1:t=WC(null,t,i,e,r);break e;case 11:t=jC(null,t,i,e,r);break e;case 14:t=GC(null,t,i,On(i.type,e),r);break e}throw Error(ee(306,i,""))}return t;case 0:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:On(i,n),eT(e,t,i,n,r);case 1:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:On(i,n),WC(e,t,i,n,r);case 3:e:{if(VL(t),e===null)throw Error(ee(387));i=t.pendingProps,o=t.memoizedState,n=o.element,uL(e,t),Pf(t,i,null,r);var a=t.memoizedState;if(i=a.element,o.isDehydrated)if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){n=hl(Error(ee(423)),t),t=HC(e,t,i,r,n);break e}else if(i!==n){n=hl(Error(ee(424)),t),t=HC(e,t,i,r,n);break e}else for(ki=Oa(t.stateNode.containerInfo.firstChild),xi=t,Vt=!0,Dn=null,r=lL(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(ll(),i===n){t=Go(e,t,r);break e}Zr(e,t,i,r)}t=t.child}return t;case 5:return hL(t),e===null&&qS(t),i=t.type,n=t.pendingProps,o=e!==null?e.memoizedProps:null,a=n.children,HS(i,n)?a=null:o!==null&&HS(i,o)&&(t.flags|=32),xL(e,t),Zr(e,t,a,r),t.child;case 6:return e===null&&qS(t),null;case 13:return FL(e,t,r);case 4:return cy(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=dl(t,null,i,r):Zr(e,t,i,r),t.child;case 11:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:On(i,n),jC(e,t,i,n,r);case 7:return Zr(e,t,t.pendingProps,r),t.child;case 8:return Zr(e,t,t.pendingProps.children,r),t.child;case 12:return Zr(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,n=t.pendingProps,o=t.memoizedProps,a=n.value,bt(Nf,i._currentValue),i._currentValue=a,o!==null)if(Un(o.value,a)){if(o.children===n.children&&!Si.current){t=Go(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var c=s.firstContext;c!==null;){if(c.context===i){if(o.tag===1){c=Uo(-1,r&-r),c.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var d=l.pending;d===null?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),XS(o.return,r,t),s.lanes|=r;break}c=c.next}}else if(o.tag===10)a=o.type===t.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(ee(341));a.lanes|=r,s=a.alternate,s!==null&&(s.lanes|=r),XS(a,r,t),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===t){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}Zr(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,i=t.pendingProps.children,qc(t,r),n=hn(n),i=i(n),t.flags|=1,Zr(e,t,i,r),t.child;case 14:return i=t.type,n=On(i,t.pendingProps),n=On(i.type,n),GC(e,t,i,n,r);case 15:return ML(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:On(i,n),Fp(e,t),t.tag=1,Ti(i)?(e=!0,Af(t)):e=!1,qc(t,r),PL(t,i,n),QS(t,i,n,r),tT(null,t,i,!0,e,r);case 19:return BL(e,t,r);case 22:return UL(e,t,r)}throw Error(ee(156,t.tag))};function rM(e,t){return bk(e,t)}function d3(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cn(e,t,r,i){return new d3(e,t,r,i)}function Ry(e){return e=e.prototype,!(!e||!e.isReactComponent)}function u3(e){if(typeof e=="function")return Ry(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Gv)return 11;if(e===Wv)return 14}return 2}function Pa(e,t){var r=e.alternate;return r===null?(r=cn(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Gp(e,t,r,i,n,o){var a=2;if(i=e,typeof e=="function")Ry(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Rc:return As(r.children,n,o,t);case jv:a=8,n|=8;break;case yS:return e=cn(12,r,t,n|2),e.elementType=yS,e.lanes=o,e;case RS:return e=cn(13,r,t,n),e.elementType=RS,e.lanes=o,e;case CS:return e=cn(19,r,t,n),e.elementType=CS,e.lanes=o,e;case hk:return A_(r,n,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case dk:a=10;break e;case uk:a=9;break e;case Gv:a=11;break e;case Wv:a=14;break e;case sa:a=16,i=null;break e}throw Error(ee(130,e==null?e:typeof e,""))}return t=cn(a,r,t,n),t.elementType=e,t.type=i,t.lanes=o,t}function As(e,t,r,i){return e=cn(7,e,i,t),e.lanes=r,e}function A_(e,t,r,i){return e=cn(22,e,i,t),e.elementType=hk,e.lanes=r,e.stateNode={isHidden:!1},e}function jm(e,t,r){return e=cn(6,e,null,t),e.lanes=r,e}function Gm(e,t,r){return t=cn(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function h3(e,t,r,i,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ym(0),this.expirationTimes=ym(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ym(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Cy(e,t,r,i,n,o,a,s,c){return e=new h3(e,t,r,s,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=cn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},sy(o),e}function p3(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yc,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function iM(e){if(!e)return Ba;e=e._reactInternals;e:{if(Hs(e)!==e||e.tag!==1)throw Error(ee(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ti(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ee(171))}if(e.tag===1){var r=e.type;if(Ti(r))return iL(e,r,t)}return t}function nM(e,t,r,i,n,o,a,s,c){return e=Cy(r,i,!0,e,n,o,a,s,c),e.context=iM(null),r=e.current,i=ii(),n=Da(r),o=Uo(i,n),o.callback=t??null,ba(r,o,n),e.current.lanes=n,Xu(e,n,i),vi(e,i),e}function O_(e,t,r,i){var n=t.current,o=ii(),a=Da(n);return r=iM(r),t.context===null?t.context=r:t.pendingContext=r,t=Uo(o,a),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=ba(n,t,a),e!==null&&(Mn(e,n,a,o),Up(e,n,a)),a}function Bf(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function eI(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Iy(e,t){eI(e,t),(e=e.alternate)&&eI(e,t)}function f3(){return null}var oM=typeof reportError=="function"?reportError:function(e){console.error(e)};function wy(e){this._internalRoot=e}b_.prototype.render=wy.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ee(409));O_(e,t,null,null)};b_.prototype.unmount=wy.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;xs(function(){O_(null,e,null,null)}),t[Bo]=null}};function b_(e){this._internalRoot=e}b_.prototype.unstable_scheduleHydration=function(e){if(e){var t=Uk();e={blockedOn:null,target:e,priority:t};for(var r=0;r<la.length&&t!==0&&t<la[r].priority;r++);la.splice(r,0,e),r===0&&Vk(e)}};function Ay(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function N_(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function tI(){}function _3(e,t,r,i,n){if(n){if(typeof i=="function"){var o=i;i=function(){var l=Bf(a);o.call(l)}}var a=nM(t,i,e,0,null,!1,!1,"",tI);return e._reactRootContainer=a,e[Bo]=a.current,pu(e.nodeType===8?e.parentNode:e),xs(),a}for(;n=e.lastChild;)e.removeChild(n);if(typeof i=="function"){var s=i;i=function(){var l=Bf(c);s.call(l)}}var c=Cy(e,0,!1,null,null,!1,!1,"",tI);return e._reactRootContainer=c,e[Bo]=c.current,pu(e.nodeType===8?e.parentNode:e),xs(function(){O_(t,c,r,i)}),c}function D_(e,t,r,i,n){var o=r._reactRootContainer;if(o){var a=o;if(typeof n=="function"){var s=n;n=function(){var c=Bf(a);s.call(c)}}O_(t,a,e,n)}else a=_3(r,t,e,n,i);return Bf(a)}Lk=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Td(t.pendingLanes);r!==0&&(zv(t,r|1),vi(t,sr()),!(et&6)&&(pl=sr()+500,za()))}break;case 13:xs(function(){var i=jo(e,1);if(i!==null){var n=ii();Mn(i,e,1,n)}}),Iy(e,1)}};Yv=function(e){if(e.tag===13){var t=jo(e,134217728);if(t!==null){var r=ii();Mn(t,e,134217728,r)}Iy(e,134217728)}};Mk=function(e){if(e.tag===13){var t=Da(e),r=jo(e,t);if(r!==null){var i=ii();Mn(r,e,t,i)}Iy(e,t)}};Uk=function(){return Tt};xk=function(e,t){var r=Tt;try{return Tt=e,t()}finally{Tt=r}};LS=function(e,t,r){switch(t){case"input":if(AS(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var n=v_(i);if(!n)throw Error(ee(90));fk(i),AS(i,n)}}}break;case"textarea":mk(e,r);break;case"select":t=r.value,t!=null&&Kc(e,!!r.multiple,t,!1)}};Rk=Ty;Ck=xs;var m3={usingClientEntryPoint:!1,Events:[Qu,Ac,v_,vk,yk,Ty]},Zl={findFiberByHostInstance:_s,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},E3={bundleType:Zl.bundleType,version:Zl.version,rendererPackageName:Zl.rendererPackageName,rendererConfig:Zl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ho.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ak(e),e===null?null:e.stateNode},findFiberByHostInstance:Zl.findFiberByHostInstance||f3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lh.isDisabled&&Lh.supportsFiber)try{E_=Lh.inject(E3),ao=Lh}catch{}}Fi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=m3;Fi.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ay(t))throw Error(ee(200));return p3(e,t,null,r)};Fi.createRoot=function(e,t){if(!Ay(e))throw Error(ee(299));var r=!1,i="",n=oM;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=Cy(e,1,!1,null,null,r,!1,i,n),e[Bo]=t.current,pu(e.nodeType===8?e.parentNode:e),new wy(t)};Fi.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ee(188)):(e=Object.keys(e).join(","),Error(ee(268,e)));return e=Ak(t),e=e===null?null:e.stateNode,e};Fi.flushSync=function(e){return xs(e)};Fi.hydrate=function(e,t,r){if(!N_(t))throw Error(ee(200));return D_(null,e,t,!0,r)};Fi.hydrateRoot=function(e,t,r){if(!Ay(e))throw Error(ee(405));var i=r!=null&&r.hydratedSources||null,n=!1,o="",a=oM;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),t=nM(t,null,e,1,r??null,n,!1,o,a),e[Bo]=t.current,pu(e),i)for(e=0;e<i.length;e++)r=i[e],n=r._getVersion,n=n(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,n]:t.mutableSourceEagerHydrationData.push(r,n);return new b_(t)};Fi.render=function(e,t,r){if(!N_(t))throw Error(ee(200));return D_(null,e,t,!1,r)};Fi.unmountComponentAtNode=function(e){if(!N_(e))throw Error(ee(40));return e._reactRootContainer?(xs(function(){D_(null,null,e,!1,function(){e._reactRootContainer=null,e[Bo]=null})}),!0):!1};Fi.unstable_batchedUpdates=Ty;Fi.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!N_(r))throw Error(ee(200));if(e==null||e._reactInternals===void 0)throw Error(ee(38));return D_(e,t,r,!1,i)};Fi.version="18.3.1-next-f1338f8080-20240426";function aM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(aM)}catch(e){console.error(e)}}aM(),ak.exports=Fi;var g3=ak.exports,rI=g3;TS.createRoot=rI.createRoot,TS.hydrateRoot=rI.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yu(){return yu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},yu.apply(this,arguments)}var Ea;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Ea||(Ea={}));const iI="popstate";function S3(e){e===void 0&&(e={});function t(i,n){let{pathname:o,search:a,hash:s}=i.location;return pT("",{pathname:o,search:a,hash:s},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function r(i,n){return typeof n=="string"?n:cM(n)}return v3(t,r,null,e)}function vr(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function sM(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function T3(){return Math.random().toString(36).substr(2,8)}function nI(e,t){return{usr:e.state,key:e.key,idx:t}}function pT(e,t,r,i){return r===void 0&&(r=null),yu({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?bl(t):t,{state:r,key:t&&t.key||i||T3()})}function cM(e){let{pathname:t="/",search:r="",hash:i=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),i&&i!=="#"&&(t+=i.charAt(0)==="#"?i:"#"+i),t}function bl(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function v3(e,t,r,i){i===void 0&&(i={});let{window:n=document.defaultView,v5Compat:o=!1}=i,a=n.history,s=Ea.Pop,c=null,l=d();l==null&&(l=0,a.replaceState(yu({},a.state,{idx:l}),""));function d(){return(a.state||{idx:null}).idx}function u(){s=Ea.Pop;let E=d(),S=E==null?null:E-l;l=E,c&&c({action:s,location:_.location,delta:S})}function h(E,S){s=Ea.Push;let T=pT(_.location,E,S);l=d()+1;let y=nI(T,l),I=_.createHref(T);try{a.pushState(y,"",I)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;n.location.assign(I)}o&&c&&c({action:s,location:_.location,delta:1})}function p(E,S){s=Ea.Replace;let T=pT(_.location,E,S);l=d();let y=nI(T,l),I=_.createHref(T);a.replaceState(y,"",I),o&&c&&c({action:s,location:_.location,delta:0})}function g(E){let S=n.location.origin!=="null"?n.location.origin:n.location.href,T=typeof E=="string"?E:cM(E);return T=T.replace(/ $/,"%20"),vr(S,"No window.location.(origin|href) available to create URL for href: "+T),new URL(T,S)}let _={get action(){return s},get location(){return e(n,a)},listen(E){if(c)throw new Error("A history only accepts one active listener");return n.addEventListener(iI,u),c=E,()=>{n.removeEventListener(iI,u),c=null}},createHref(E){return t(n,E)},createURL:g,encodeLocation(E){let S=g(E);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:h,replace:p,go(E){return a.go(E)}};return _}var oI;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(oI||(oI={}));function y3(e,t,r){return r===void 0&&(r="/"),R3(e,t,r,!1)}function R3(e,t,r,i){let n=typeof t=="string"?bl(t):t,o=uM(n.pathname||"/",r);if(o==null)return null;let a=lM(e);C3(a);let s=null;for(let c=0;s==null&&c<a.length;++c){let l=M3(o);s=k3(a[c],l,i)}return s}function lM(e,t,r,i){t===void 0&&(t=[]),r===void 0&&(r=[]),i===void 0&&(i="");let n=(o,a,s)=>{let c={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};c.relativePath.startsWith("/")&&(vr(c.relativePath.startsWith(i),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(i.length));let l=Os([i,c.relativePath]),d=r.concat(c);o.children&&o.children.length>0&&(vr(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),lM(o.children,t,d,l)),!(o.path==null&&!o.index)&&t.push({path:l,score:D3(l,o.index),routesMeta:d})};return e.forEach((o,a)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))n(o,a);else for(let c of dM(o.path))n(o,a,c)}),t}function dM(e){let t=e.split("/");if(t.length===0)return[];let[r,...i]=t,n=r.endsWith("?"),o=r.replace(/\?$/,"");if(i.length===0)return n?[o,""]:[o];let a=dM(i.join("/")),s=[];return s.push(...a.map(c=>c===""?o:[o,c].join("/"))),n&&s.push(...a),s.map(c=>e.startsWith("/")&&c===""?"/":c)}function C3(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:P3(t.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}const I3=/^:[\w-]+$/,w3=3,A3=2,O3=1,b3=10,N3=-2,aI=e=>e==="*";function D3(e,t){let r=e.split("/"),i=r.length;return r.some(aI)&&(i+=N3),t&&(i+=A3),r.filter(n=>!aI(n)).reduce((n,o)=>n+(I3.test(o)?w3:o===""?O3:b3),i)}function P3(e,t){return e.length===t.length&&e.slice(0,-1).every((i,n)=>i===t[n])?e[e.length-1]-t[t.length-1]:0}function k3(e,t,r){let{routesMeta:i}=e,n={},o="/",a=[];for(let s=0;s<i.length;++s){let c=i[s],l=s===i.length-1,d=o==="/"?t:t.slice(o.length)||"/",u=sI({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},d),h=c.route;if(!u&&l&&r&&!i[i.length-1].route.index&&(u=sI({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!u)return null;Object.assign(n,u.params),a.push({params:n,pathname:Os([o,u.pathname]),pathnameBase:j3(Os([o,u.pathnameBase])),route:h}),u.pathnameBase!=="/"&&(o=Os([o,u.pathnameBase]))}return a}function sI(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,i]=L3(e.path,e.caseSensitive,e.end),n=t.match(r);if(!n)return null;let o=n[0],a=o.replace(/(.)\/+$/,"$1"),s=n.slice(1);return{params:i.reduce((l,d,u)=>{let{paramName:h,isOptional:p}=d;if(h==="*"){let _=s[u]||"";a=o.slice(0,o.length-_.length).replace(/(.)\/+$/,"$1")}const g=s[u];return p&&!g?l[h]=void 0:l[h]=(g||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:a,pattern:e}}function L3(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),sM(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let i=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,c)=>(i.push({paramName:s,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(i.push({paramName:"*"}),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,t?void 0:"i"),i]}function M3(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return sM(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function uM(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,i=e.charAt(r);return i&&i!=="/"?null:e.slice(r)||"/"}function U3(e,t){t===void 0&&(t="/");let{pathname:r,search:i="",hash:n=""}=typeof e=="string"?bl(e):e;return{pathname:r?r.startsWith("/")?r:x3(r,t):t,search:G3(i),hash:W3(n)}}function x3(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function Wm(e,t,r,i){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function V3(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function F3(e,t){let r=V3(e);return t?r.map((i,n)=>n===r.length-1?i.pathname:i.pathnameBase):r.map(i=>i.pathnameBase)}function B3(e,t,r,i){i===void 0&&(i=!1);let n;typeof e=="string"?n=bl(e):(n=yu({},e),vr(!n.pathname||!n.pathname.includes("?"),Wm("?","pathname","search",n)),vr(!n.pathname||!n.pathname.includes("#"),Wm("#","pathname","hash",n)),vr(!n.search||!n.search.includes("#"),Wm("#","search","hash",n)));let o=e===""||n.pathname==="",a=o?"/":n.pathname,s;if(a==null)s=r;else{let u=t.length-1;if(!i&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),u-=1;n.pathname=h.join("/")}s=u>=0?t[u]:"/"}let c=U3(n,s),l=a&&a!=="/"&&a.endsWith("/"),d=(o||a===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(l||d)&&(c.pathname+="/"),c}const Os=e=>e.join("/").replace(/\/\/+/g,"/"),j3=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),G3=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,W3=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function H3(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const hM=["post","put","patch","delete"];new Set(hM);const K3=["get",...hM];new Set(K3);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ru(){return Ru=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Ru.apply(this,arguments)}const Oy=H.createContext(null),z3=H.createContext(null),P_=H.createContext(null),k_=H.createContext(null),Ks=H.createContext({outlet:null,matches:[],isDataRoute:!1}),pM=H.createContext(null);function L_(){return H.useContext(k_)!=null}function fM(){return L_()||vr(!1),H.useContext(k_).location}function _M(e){H.useContext(P_).static||H.useLayoutEffect(e)}function mM(){let{isDataRoute:e}=H.useContext(Ks);return e?aG():Y3()}function Y3(){L_()||vr(!1);let e=H.useContext(Oy),{basename:t,future:r,navigator:i}=H.useContext(P_),{matches:n}=H.useContext(Ks),{pathname:o}=fM(),a=JSON.stringify(F3(n,r.v7_relativeSplatPath)),s=H.useRef(!1);return _M(()=>{s.current=!0}),H.useCallback(function(l,d){if(d===void 0&&(d={}),!s.current)return;if(typeof l=="number"){i.go(l);return}let u=B3(l,JSON.parse(a),o,d.relative==="path");e==null&&t!=="/"&&(u.pathname=u.pathname==="/"?t:Os([t,u.pathname])),(d.replace?i.replace:i.push)(u,d.state,d)},[t,i,a,o,e])}function $3(){let{matches:e}=H.useContext(Ks),t=e[e.length-1];return t?t.params:{}}function q3(e,t){return X3(e,t)}function X3(e,t,r,i){L_()||vr(!1);let{navigator:n}=H.useContext(P_),{matches:o}=H.useContext(Ks),a=o[o.length-1],s=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let l=fM(),d;if(t){var u;let E=typeof t=="string"?bl(t):t;c==="/"||(u=E.pathname)!=null&&u.startsWith(c)||vr(!1),d=E}else d=l;let h=d.pathname||"/",p=h;if(c!=="/"){let E=c.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(E.length).join("/")}let g=y3(e,{pathname:p}),_=tG(g&&g.map(E=>Object.assign({},E,{params:Object.assign({},s,E.params),pathname:Os([c,n.encodeLocation?n.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?c:Os([c,n.encodeLocation?n.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),o,r,i);return t&&_?H.createElement(k_.Provider,{value:{location:Ru({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Ea.Pop}},_):_}function J3(){let e=oG(),t=H3(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},t),r?H.createElement("pre",{style:n},r):null,null)}const Q3=H.createElement(J3,null);class Z3 extends H.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?H.createElement(Ks.Provider,{value:this.props.routeContext},H.createElement(pM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function eG(e){let{routeContext:t,match:r,children:i}=e,n=H.useContext(Oy);return n&&n.static&&n.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=r.route.id),H.createElement(Ks.Provider,{value:t},i)}function tG(e,t,r,i){var n;if(t===void 0&&(t=[]),r===void 0&&(r=null),i===void 0&&(i=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=i)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let a=e,s=(n=r)==null?void 0:n.errors;if(s!=null){let d=a.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id])!==void 0);d>=0||vr(!1),a=a.slice(0,Math.min(a.length,d+1))}let c=!1,l=-1;if(r&&i&&i.v7_partialHydration)for(let d=0;d<a.length;d++){let u=a[d];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(l=d),u.route.id){let{loaderData:h,errors:p}=r,g=u.route.loader&&h[u.route.id]===void 0&&(!p||p[u.route.id]===void 0);if(u.route.lazy||g){c=!0,l>=0?a=a.slice(0,l+1):a=[a[0]];break}}}return a.reduceRight((d,u,h)=>{let p,g=!1,_=null,E=null;r&&(p=s&&u.route.id?s[u.route.id]:void 0,_=u.route.errorElement||Q3,c&&(l<0&&h===0?(g=!0,E=null):l===h&&(g=!0,E=u.route.hydrateFallbackElement||null)));let S=t.concat(a.slice(0,h+1)),T=()=>{let y;return p?y=_:g?y=E:u.route.Component?y=H.createElement(u.route.Component,null):u.route.element?y=u.route.element:y=d,H.createElement(eG,{match:u,routeContext:{outlet:d,matches:S,isDataRoute:r!=null},children:y})};return r&&(u.route.ErrorBoundary||u.route.errorElement||h===0)?H.createElement(Z3,{location:r.location,revalidation:r.revalidation,component:_,error:p,children:T(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):T()},null)}var EM=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(EM||{}),jf=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(jf||{});function rG(e){let t=H.useContext(Oy);return t||vr(!1),t}function iG(e){let t=H.useContext(z3);return t||vr(!1),t}function nG(e){let t=H.useContext(Ks);return t||vr(!1),t}function gM(e){let t=nG(),r=t.matches[t.matches.length-1];return r.route.id||vr(!1),r.route.id}function oG(){var e;let t=H.useContext(pM),r=iG(jf.UseRouteError),i=gM(jf.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[i]}function aG(){let{router:e}=rG(EM.UseNavigateStable),t=gM(jf.UseNavigateStable),r=H.useRef(!1);return _M(()=>{r.current=!0}),H.useCallback(function(n,o){o===void 0&&(o={}),r.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,Ru({fromRouteId:t},o)))},[e,t])}function fT(e){vr(!1)}function sG(e){let{basename:t="/",children:r=null,location:i,navigationType:n=Ea.Pop,navigator:o,static:a=!1,future:s}=e;L_()&&vr(!1);let c=t.replace(/^\/*/,"/"),l=H.useMemo(()=>({basename:c,navigator:o,static:a,future:Ru({v7_relativeSplatPath:!1},s)}),[c,s,o,a]);typeof i=="string"&&(i=bl(i));let{pathname:d="/",search:u="",hash:h="",state:p=null,key:g="default"}=i,_=H.useMemo(()=>{let E=uM(d,c);return E==null?null:{location:{pathname:E,search:u,hash:h,state:p,key:g},navigationType:n}},[c,d,u,h,p,g,n]);return _==null?null:H.createElement(P_.Provider,{value:l},H.createElement(k_.Provider,{children:r,value:_}))}function cG(e){let{children:t,location:r}=e;return q3(_T(t),r)}new Promise(()=>{});function _T(e,t){t===void 0&&(t=[]);let r=[];return H.Children.forEach(e,(i,n)=>{if(!H.isValidElement(i))return;let o=[...t,n];if(i.type===H.Fragment){r.push.apply(r,_T(i.props.children,o));return}i.type!==fT&&vr(!1),!i.props.index||!i.props.children||vr(!1);let a={id:i.props.id||o.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=_T(i.props.children,o)),r.push(a)}),r}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const lG="6";try{window.__reactRouterVersion=lG}catch{}const dG="startTransition",cI=sB[dG];function uG(e){let{basename:t,children:r,future:i,window:n}=e,o=H.useRef();o.current==null&&(o.current=S3({window:n,v5Compat:!0}));let a=o.current,[s,c]=H.useState({action:a.action,location:a.location}),{v7_startTransition:l}=i||{},d=H.useCallback(u=>{l&&cI?cI(()=>c(u)):c(u)},[c,l]);return H.useLayoutEffect(()=>a.listen(d),[a,d]),H.createElement(sG,{basename:t,children:r,location:s.location,navigationType:s.action,navigator:a,future:i})}var lI;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(lI||(lI={}));var dI;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(dI||(dI={}));const hG="/zerofk/assets/logo-CREJmf-S.svg",pG=({connectToVideo:e})=>{const[t,r]=H.useState(""),[i,n]=H.useState(""),[o,a]=H.useState(""),s=c=>{const l=t.trim(),d=i.trim();if(l===""&&d===""){c.preventDefault(),a("App ID and Channel name can't be empty."),r("");return}e(l,d)};return W.jsxs("div",{className:"add-theme",children:[W.jsxs("div",{className:"form-container",children:[W.jsx("div",{style:{paddingBottom:"3em"},children:W.jsx("img",{src:hG,className:"logo",alt:"logo"})}),W.jsx("form",{onSubmit:s,children:W.jsxs("div",{className:"card",children:[W.jsx("input",{id:"appId",type:"text",placeholder:"App ID (- u can get it from owner or his followers)",value:i,onChange:c=>{n(c.target.value),a("")}}),W.jsx("input",{id:"channelName",type:"text",placeholder:"Channel Name (- connect to or create channel with typed {name})",value:t,onChange:c=>{r(c.target.value),a("")}}),W.jsx("button",{className:"btnConnect",style:{color:"#000000",background:"#ffffff"},children:"Connect"}),o&&W.jsxs("p",{style:{color:"red"},children:[" ",o," "]})]})})]}),W.jsxs("div",{className:"stars",children:[W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"}),W.jsx("div",{className:"star"})]})]})};/**
 * @license agora-rtc-react
 * @version 2.3.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */function fG(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(i){if(i!=="default"&&!(i in e)){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}})}),Object.freeze(e)}var Jc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var At=function(e){try{return!!e()}catch{return!0}},M_=!At(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),SM=M_,TM=Function.prototype,mT=TM.call,_G=SM&&TM.bind.bind(mT,mT),Ct=SM?_G:function(e){return function(){return mT.apply(e,arguments)}},Dr=Ct({}.isPrototypeOf),Mh=function(e){return e&&e.Math==Math&&e},rr=Mh(typeof globalThis=="object"&&globalThis)||Mh(typeof window=="object"&&window)||Mh(typeof self=="object"&&self)||Mh(typeof Jc=="object"&&Jc)||function(){return this}()||Jc||Function("return this")(),mG=M_,vM=Function.prototype,uI=vM.apply,hI=vM.call,by=typeof Reflect=="object"&&Reflect.apply||(mG?hI.bind(uI):function(){return hI.apply(uI,arguments)}),yM=Ct,EG=yM({}.toString),gG=yM("".slice),po=function(e){return gG(EG(e),8,-1)},SG=po,TG=Ct,Cu=function(e){if(SG(e)==="Function")return TG(e)},Hm=typeof document=="object"&&document.all,U_={all:Hm,IS_HTMLDDA:Hm===void 0&&Hm!==void 0},vG=U_.all,ir=U_.IS_HTMLDDA?function(e){return typeof e=="function"||e===vG}:function(e){return typeof e=="function"},eh={},ji=!At(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),yG=M_,Uh=Function.prototype.call,nr=yG?Uh.bind(Uh):function(){return Uh.apply(Uh,arguments)},x_={},RM={}.propertyIsEnumerable,CM=Object.getOwnPropertyDescriptor,RG=CM&&!RM.call({1:2},1);x_.f=RG?function(e){var t=CM(this,e);return!!t&&t.enumerable}:RM;var qo,Wp,Ya=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},CG=At,IG=po,Km=Object,wG=Ct("".split),V_=CG(function(){return!Km("z").propertyIsEnumerable(0)})?function(e){return IG(e)=="String"?wG(e,""):Km(e)}:Km,Nl=function(e){return e==null},AG=Nl,OG=TypeError,Dl=function(e){if(AG(e))throw OG("Can't call method on "+e);return e},bG=V_,NG=Dl,$a=function(e){return bG(NG(e))},pI=ir,DG=U_.all,Ri=U_.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:pI(e)||e===DG}:function(e){return typeof e=="object"?e!==null:pI(e)},Vn={},zm=Vn,Ym=rr,PG=ir,fI=function(e){return PG(e)?e:void 0},ai=function(e,t){return arguments.length<2?fI(zm[e])||fI(Ym[e]):zm[e]&&zm[e][t]||Ym[e]&&Ym[e][t]},zs=typeof navigator<"u"&&String(navigator.userAgent)||"",IM=rr,$m=zs,_I=IM.process,mI=IM.Deno,EI=_I&&_I.versions||mI&&mI.version,gI=EI&&EI.v8;gI&&(Wp=(qo=gI.split("."))[0]>0&&qo[0]<4?1:+(qo[0]+qo[1])),!Wp&&$m&&(!(qo=$m.match(/Edge\/(\d+)/))||qo[1]>=74)&&(qo=$m.match(/Chrome\/(\d+)/))&&(Wp=+qo[1]);var Vs=Wp,SI=Vs,kG=At,LG=rr.String,Pl=!!Object.getOwnPropertySymbols&&!kG(function(){var e=Symbol();return!LG(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&SI&&SI<41}),wM=Pl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",MG=ai,UG=ir,xG=Dr,VG=Object,th=wM?function(e){return typeof e=="symbol"}:function(e){var t=MG("Symbol");return UG(t)&&xG(t.prototype,VG(e))},FG=String,kl=function(e){try{return FG(e)}catch{return"Object"}},BG=ir,jG=kl,GG=TypeError,fn=function(e){if(BG(e))return e;throw GG(jG(e)+" is not a function")},WG=fn,HG=Nl,F_=function(e,t){var r=e[t];return HG(r)?void 0:WG(r)},TI=nr,vI=ir,yI=Ri,KG=TypeError,AM={exports:{}},RI=rr,zG=Object.defineProperty,YG=function(e,t){try{zG(RI,e,{value:t,configurable:!0,writable:!0})}catch{RI[e]=t}return t},CI="__core-js_shared__",Ny=rr[CI]||YG(CI,{}),II=Ny;(AM.exports=function(e,t){return II[e]||(II[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ll=AM.exports,$G=Dl,qG=Object,fo=function(e){return qG($G(e))},XG=fo,JG=Ct({}.hasOwnProperty),lr=Object.hasOwn||function(e,t){return JG(XG(e),t)},QG=Ct,ZG=0,e4=Math.random(),t4=QG(1 .toString),Dy=function(e){return"Symbol("+(e===void 0?"":e)+")_"+t4(++ZG+e4,36)},r4=Ll,wI=lr,i4=Dy,n4=Pl,o4=wM,Lc=rr.Symbol,qm=r4("wks"),a4=o4?Lc.for||Lc:Lc&&Lc.withoutSetter||i4,vt=function(e){return wI(qm,e)||(qm[e]=n4&&wI(Lc,e)?Lc[e]:a4("Symbol."+e)),qm[e]},s4=nr,AI=Ri,OI=th,c4=F_,l4=function(e,t){var r,i;if(vI(r=e.toString)&&!yI(i=TI(r,e))||vI(r=e.valueOf)&&!yI(i=TI(r,e))||t!=="string")return i;throw KG("Can't convert object to primitive value")},d4=TypeError,u4=vt("toPrimitive"),h4=function(e,t){if(!AI(e)||OI(e))return e;var r,i=c4(e,u4);if(i){if(r=s4(i,e,t),!AI(r)||OI(r))return r;throw d4("Can't convert object to primitive value")}return l4(e,t)},p4=th,B_=function(e){var t=h4(e,"string");return p4(t)?t:t+""},bI=Ri,ET=rr.document,f4=bI(ET)&&bI(ET.createElement),Py=function(e){return f4?ET.createElement(e):{}},_4=Py,OM=!ji&&!At(function(){return Object.defineProperty(_4("div"),"a",{get:function(){return 7}}).a!=7}),m4=ji,E4=nr,g4=x_,S4=Ya,T4=$a,v4=B_,y4=lr,R4=OM,NI=Object.getOwnPropertyDescriptor;eh.f=m4?NI:function(e,t){if(e=T4(e),t=v4(t),R4)try{return NI(e,t)}catch{}if(y4(e,t))return S4(!E4(g4.f,e,t),e[t])};var C4=At,I4=ir,w4=/#|\.prototype\./,rh=function(e,t){var r=O4[A4(e)];return r==N4||r!=b4&&(I4(t)?C4(t):!!t)},A4=rh.normalize=function(e){return String(e).replace(w4,".").toLowerCase()},O4=rh.data={},b4=rh.NATIVE="N",N4=rh.POLYFILL="P",bM=rh,D4=fn,P4=M_,k4=Cu(Cu.bind),qa=function(e,t){return D4(e),t===void 0?e:P4?k4(e,t):function(){return e.apply(t,arguments)}},_n={},NM=ji&&At(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),L4=Ri,M4=String,U4=TypeError,$r=function(e){if(L4(e))return e;throw U4(M4(e)+" is not an object")},x4=ji,V4=OM,F4=NM,xh=$r,DI=B_,B4=TypeError,Xm=Object.defineProperty,j4=Object.getOwnPropertyDescriptor,Jm="enumerable",Qm="configurable",Zm="writable";_n.f=x4?F4?function(e,t,r){if(xh(e),t=DI(t),xh(r),typeof e=="function"&&t==="prototype"&&"value"in r&&Zm in r&&!r[Zm]){var i=j4(e,t);i&&i[Zm]&&(e[t]=r.value,r={configurable:Qm in r?r[Qm]:i[Qm],enumerable:Jm in r?r[Jm]:i[Jm],writable:!1})}return Xm(e,t,r)}:Xm:function(e,t,r){if(xh(e),t=DI(t),xh(r),V4)try{return Xm(e,t,r)}catch{}if("get"in r||"set"in r)throw B4("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var G4=_n,W4=Ya,Xa=ji?function(e,t,r){return G4.f(e,t,W4(1,r))}:function(e,t,r){return e[t]=r,e},Vh=rr,H4=by,K4=Cu,z4=ir,Y4=eh.f,$4=bM,Zs=Vn,q4=qa,ec=Xa,PI=lr,X4=function(e){var t=function(r,i,n){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,n)}return H4(e,this,arguments)};return t.prototype=e.prototype,t},Be=function(e,t){var r,i,n,o,a,s,c,l,d,u=e.target,h=e.global,p=e.stat,g=e.proto,_=h?Vh:p?Vh[u]:(Vh[u]||{}).prototype,E=h?Zs:Zs[u]||ec(Zs,u,{})[u],S=E.prototype;for(o in t)i=!(r=$4(h?o:u+(p?".":"#")+o,e.forced))&&_&&PI(_,o),s=E[o],i&&(c=e.dontCallGetSet?(d=Y4(_,o))&&d.value:_[o]),a=i&&c?c:t[o],i&&typeof s==typeof a||(l=e.bind&&i?q4(a,Vh):e.wrap&&i?X4(a):g&&z4(a)?K4(a):a,(e.sham||a&&a.sham||s&&s.sham)&&ec(l,"sham",!0),ec(E,o,l),g&&(PI(Zs,n=u+"Prototype")||ec(Zs,n,{}),ec(Zs[n],o,a),e.real&&S&&(r||!S[o])&&ec(S,o,a)))},J4=Math.ceil,Q4=Math.floor,Z4=Math.trunc||function(e){var t=+e;return(t>0?Q4:J4)(t)},eW=Z4,ky=function(e){var t=+e;return t!=t||t===0?0:eW(t)},tW=ky,rW=Math.max,iW=Math.min,Ly=function(e,t){var r=tW(e);return r<0?rW(r+t,0):iW(r,t)},nW=ky,oW=Math.min,DM=function(e){return e>0?oW(nW(e),9007199254740991):0},aW=DM,Ko=function(e){return aW(e.length)},sW=$a,cW=Ly,lW=Ko,kI=function(e){return function(t,r,i){var n,o=sW(t),a=lW(o),s=cW(i,a);if(e&&r!=r){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},My={includes:kI(!0),indexOf:kI(!1)},dW=My.includes;Be({target:"Array",proto:!0,forced:At(function(){return!Array(1).includes()})},{includes:function(e){return dW(this,e,arguments.length>1?arguments[1]:void 0)}});var uW=Vn,mn=function(e){return uW[e+"Prototype"]},hW=mn("Array").includes,pW=Ri,fW=po,_W=vt("match"),PM=function(e){var t;return pW(e)&&((t=e[_W])!==void 0?!!t:fW(e)=="RegExp")},mW=PM,EW=TypeError,kM={};kM[vt("toStringTag")]="z";var Uy=String(kM)==="[object z]",gW=Uy,SW=ir,Hp=po,TW=vt("toStringTag"),vW=Object,yW=Hp(function(){return arguments}())=="Arguments",_o=gW?Hp:function(e){var t,r,i;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(n,o){try{return n[o]}catch{}}(t=vW(e),TW))=="string"?r:yW?Hp(t):(i=Hp(t))=="Object"&&SW(t.callee)?"Arguments":i},RW=_o,CW=String,Gi=function(e){if(RW(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return CW(e)},IW=vt("match"),wW=Be,AW=function(e){if(mW(e))throw EW("The method doesn't accept regular expressions");return e},OW=Dl,LI=Gi,bW=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[IW]=!1,"/./"[e](t)}catch{}}return!1},NW=Ct("".indexOf);wW({target:"String",proto:!0,forced:!bW("includes")},{includes:function(e){return!!~NW(LI(OW(this)),LI(AW(e)),arguments.length>1?arguments[1]:void 0)}});var DW=mn("String").includes,MI=Dr,PW=hW,kW=DW,eE=Array.prototype,tE=String.prototype,LW=function(e){var t=e.includes;return e===eE||MI(eE,e)&&t===eE.includes?PW:typeof e=="string"||e===tE||MI(tE,e)&&t===tE.includes?kW:t},Y=_t(LW),MW=fn,UW=fo,xW=V_,VW=Ko,FW=TypeError,UI=function(e){return function(t,r,i,n){MW(r);var o=UW(t),a=xW(o),s=VW(o),c=e?s-1:0,l=e?-1:1;if(i<2)for(;;){if(c in a){n=a[c],c+=l;break}if(c+=l,e?c<0:s<=c)throw FW("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=l)c in a&&(n=r(n,a[c],c,o));return n}},BW={left:UI(!1),right:UI(!0)},jW=At,j_=function(e,t){var r=[][e];return!!r&&jW(function(){r.call(null,t||function(){return 1},1)})},ih=typeof process<"u"&&po(process)=="process",GW=BW.left;Be({target:"Array",proto:!0,forced:!ih&&Vs>79&&Vs<83||!j_("reduce")},{reduce:function(e){var t=arguments.length;return GW(this,e,t,t>1?arguments[1]:void 0)}});var WW=mn("Array").reduce,HW=Dr,KW=WW,rE=Array.prototype,zW=function(e){var t=e.reduce;return e===rE||HW(rE,e)&&t===rE.reduce?KW:t},LM=zW,xn=_t(LM),MM=!0,UM=!0;function Fh(e,t,r){let i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function Ys(e,t,r){if(!e.RTCPeerConnection)return;let i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(a,s){if(a!==t)return n.apply(this,arguments);let c=l=>{let d=r(l);d&&(s.handleEvent?s.handleEvent(d):s(d))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(s,c),n.apply(this,[a,c])};let o=i.removeEventListener;i.removeEventListener=function(a,s){if(a!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(s))return o.apply(this,arguments);let c=this._eventMap[t].get(s);return this._eventMap[t].delete(s),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function YW(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(MM=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function $W(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(UM=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function xM(){if(typeof window=="object"){if(MM)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function xy(e,t){UM&&console.warn(e+" is deprecated, please use "+t+" instead.")}function xI(e){return Object.prototype.toString.call(e)==="[object Object]"}function VM(e){var t;return xI(e)?xn(t=Object.keys(e)).call(t,function(r,i){let n=xI(e[i]),o=n?VM(e[i]):e[i],a=n&&!Object.keys(o).length;return o===void 0||a?r:Object.assign(r,{[i]:o})},{}):e}function gT(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?gT(e,e.get(t[i]),r):i.endsWith("Ids")&&t[i].forEach(n=>{gT(e,e.get(n),r)})}))}function VI(e,t,r){let i=r?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;let o=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&o.push(a)}),o.forEach(a=>{e.forEach(s=>{s.type===i&&s.trackId===a.id&&gT(e,s,n)})}),n}var qW=Dy,FI=Ll("keys"),G_=function(e){return FI[e]||(FI[e]=qW(e))},XW=!At(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),JW=lr,QW=ir,ZW=fo,e5=XW,BI=G_("IE_PROTO"),ST=Object,t5=ST.prototype,Vy=e5?ST.getPrototypeOf:function(e){var t=ZW(e);if(JW(t,BI))return t[BI];var r=t.constructor;return QW(r)&&t instanceof r?r.prototype:t instanceof ST?t5:null},r5=Ct,i5=fn,n5=ir,o5=String,a5=TypeError,s5=function(e,t,r){try{return r5(i5(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},c5=$r,l5=function(e){if(typeof e=="object"||n5(e))return e;throw a5("Can't set "+o5(e)+" as a prototype")},d5=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=s5(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(i,n){return c5(i),l5(n),t?e(i,n):i.__proto__=n,i}}():void 0),W_={},H_={},iE=lr,u5=$a,h5=My.indexOf,p5=H_,jI=Ct([].push),FM=function(e,t){var r,i=u5(e),n=0,o=[];for(r in i)!iE(p5,r)&&iE(i,r)&&jI(o,r);for(;t.length>n;)iE(i,r=t[n++])&&(~h5(o,r)||jI(o,r));return o},Fy=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],f5=FM,_5=Fy.concat("length","prototype");W_.f=Object.getOwnPropertyNames||function(e){return f5(e,_5)};var nh={};nh.f=Object.getOwnPropertySymbols;var m5=ai,E5=W_,g5=nh,S5=$r,T5=Ct([].concat),v5=m5("Reflect","ownKeys")||function(e){var t=E5.f(S5(e)),r=g5.f;return r?T5(t,r(e)):t},GI=lr,y5=v5,R5=eh,C5=_n,By={},I5=FM,w5=Fy,K_=Object.keys||function(e){return I5(e,w5)},A5=ji,O5=NM,b5=_n,N5=$r,D5=$a,P5=K_;By.f=A5&&!O5?Object.defineProperties:function(e,t){N5(e);for(var r,i=D5(t),n=P5(t),o=n.length,a=0;o>a;)b5.f(e,r=n[a++],i[r]);return e};var Bh,BM=ai("document","documentElement"),k5=$r,L5=By,WI=Fy,M5=H_,U5=BM,x5=Py,TT="prototype",vT="script",jM=G_("IE_PROTO"),nE=function(){},GM=function(e){return"<"+vT+">"+e+"</"+vT+">"},HI=function(e){e.write(GM("")),e.close();var t=e.parentWindow.Object;return e=null,t},Kp=function(){try{Bh=new ActiveXObject("htmlfile")}catch{}var e,t,r;Kp=typeof document<"u"?document.domain&&Bh?HI(Bh):(t=x5("iframe"),r="java"+vT+":",t.style.display="none",U5.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(GM("document.F=Object")),e.close(),e.F):HI(Bh);for(var i=WI.length;i--;)delete Kp[TT][WI[i]];return Kp()};M5[jM]=!0;var oh=Object.create||function(e,t){var r;return e!==null?(nE[TT]=k5(e),r=new nE,nE[TT]=null,r[jM]=e):r=Kp(),t===void 0?r:L5.f(r,t)},V5=Ri,F5=Xa,WM=Error,B5=Ct("".replace),j5=String(WM("zxcasd").stack),HM=/\n\s*at [^:]*:[^\n]*/,G5=HM.test(j5),W5=Ya,H5=!At(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",W5(1,7)),e.stack!==7)}),K5=Xa,z5=function(e,t){if(G5&&typeof e=="string"&&!WM.prepareStackTrace)for(;t--;)e=B5(e,HM,"");return e},Y5=H5,KI=Error.captureStackTrace,$s={},$5=$s,q5=vt("iterator"),X5=Array.prototype,KM=function(e){return e!==void 0&&($5.Array===e||X5[q5]===e)},J5=_o,zI=F_,Q5=Nl,Z5=$s,eH=vt("iterator"),z_=function(e){if(!Q5(e))return zI(e,eH)||zI(e,"@@iterator")||Z5[J5(e)]},tH=nr,rH=fn,iH=$r,nH=kl,oH=z_,aH=TypeError,jy=function(e,t){var r=arguments.length<2?oH(e):t;if(rH(r))return iH(tH(r,e));throw aH(nH(e)+" is not iterable")},sH=nr,YI=$r,cH=F_,zM=function(e,t,r){var i,n;YI(e);try{if(!(i=cH(e,"return"))){if(t==="throw")throw r;return r}i=sH(i,e)}catch(o){n=!0,i=o}if(t==="throw")throw r;if(n)throw i;return YI(i),r},lH=qa,dH=nr,uH=$r,hH=kl,pH=KM,fH=Ko,$I=Dr,_H=jy,mH=z_,qI=zM,EH=TypeError,zp=function(e,t){this.stopped=e,this.result=t},XI=zp.prototype,ah=function(e,t,r){var i,n,o,a,s,c,l,d=r&&r.that,u=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),g=!(!r||!r.INTERRUPTED),_=lH(t,d),E=function(T){return i&&qI(i,"normal",T),new zp(!0,T)},S=function(T){return u?(uH(T),g?_(T[0],T[1],E):_(T[0],T[1])):g?_(T,E):_(T)};if(h)i=e.iterator;else if(p)i=e;else{if(!(n=mH(e)))throw EH(hH(e)+" is not iterable");if(pH(n)){for(o=0,a=fH(e);a>o;o++)if((s=S(e[o]))&&$I(XI,s))return s;return new zp(!1)}i=_H(e,n)}for(c=h?e.next:i.next;!(l=dH(c,i)).done;){try{s=S(l.value)}catch(T){qI(i,"throw",T)}if(typeof s=="object"&&s&&$I(XI,s))return s}return new zp(!1)},gH=Gi,SH=Be,TH=Dr,vH=Vy,Gf=d5,yH=function(e,t,r){for(var i=y5(t),n=C5.f,o=R5.f,a=0;a<i.length;a++){var s=i[a];GI(e,s)||r&&GI(r,s)||n(e,s,o(t,s))}},YM=oh,oE=Xa,aE=Ya,RH=function(e,t){V5(t)&&"cause"in t&&F5(e,"cause",t.cause)},CH=function(e,t,r,i){Y5&&(KI?KI(e,t):K5(e,"stack",z5(r,i)))},IH=ah,wH=function(e,t){return e===void 0?arguments.length<2?"":t:gH(e)},AH=vt("toStringTag"),Wf=Error,OH=[].push,fl=function(e,t){var r,i=TH(sE,this);Gf?r=Gf(Wf(),i?vH(this):sE):(r=i?this:YM(sE),oE(r,AH,"Error")),t!==void 0&&oE(r,"message",wH(t)),CH(r,fl,r.stack,1),arguments.length>2&&RH(r,arguments[2]);var n=[];return IH(e,OH,{that:n}),oE(r,"errors",n),r};Gf?Gf(fl,Wf):yH(fl,Wf,{name:!0});var sE=fl.prototype=YM(Wf.prototype,{constructor:aE(1,fl),message:aE(1,""),name:aE(1,"AggregateError")});SH({global:!0,constructor:!0,arity:2},{AggregateError:fl});var Hf,Hd,Kf,bH=ir,JI=rr.WeakMap,NH=bH(JI)&&/native code/.test(String(JI)),$M=rr,DH=Ri,PH=Xa,cE=lr,lE=Ny,kH=G_,LH=H_,QI="Object already initialized",yT=$M.TypeError,MH=$M.WeakMap;NH||lE.state?(Tn=lE.state||(lE.state=new MH),Tn.get=Tn.get,Tn.has=Tn.has,Tn.set=Tn.set,Hf=function(e,t){if(Tn.has(e))throw yT(QI);return t.facade=e,Tn.set(e,t),t},Hd=function(e){return Tn.get(e)||{}},Kf=function(e){return Tn.has(e)}):(Za=kH("state"),LH[Za]=!0,Hf=function(e,t){if(cE(e,Za))throw yT(QI);return t.facade=e,PH(e,Za,t),t},Hd=function(e){return cE(e,Za)?e[Za]:{}},Kf=function(e){return cE(e,Za)});var Tn,Za,bs,ZI,ew,qs={set:Hf,get:Hd,has:Kf,enforce:function(e){return Kf(e)?Hd(e):Hf(e,{})},getterFor:function(e){return function(t){var r;if(!DH(t)||(r=Hd(t)).type!==e)throw yT("Incompatible receiver, "+e+" required");return r}}},RT=ji,UH=lr,qM=Function.prototype,xH=RT&&Object.getOwnPropertyDescriptor,dE=UH(qM,"name"),XM={EXISTS:dE,PROPER:dE&&(function(){}).name==="something",CONFIGURABLE:dE&&(!RT||RT&&xH(qM,"name").configurable)},VH=Xa,Ja=function(e,t,r,i){return i&&i.enumerable?e[t]=r:VH(e,t,r),e},FH=At,BH=ir,jH=Ri,GH=oh,tw=Vy,WH=Ja,CT=vt("iterator"),JM=!1;[].keys&&("next"in(ew=[].keys())?(ZI=tw(tw(ew)))!==Object.prototype&&(bs=ZI):JM=!0);var HH=!jH(bs)||FH(function(){var e={};return bs[CT].call(e)!==e});BH((bs=HH?{}:GH(bs))[CT])||WH(bs,CT,function(){return this});var QM={IteratorPrototype:bs,BUGGY_SAFARI_ITERATORS:JM},KH=_o,zH=Uy?{}.toString:function(){return"[object "+KH(this)+"]"},YH=Uy,$H=_n.f,qH=Xa,XH=lr,JH=zH,rw=vt("toStringTag"),Qa=function(e,t,r,i){if(e){var n=r?e:e.prototype;XH(n,rw)||$H(n,rw,{configurable:!0,value:t}),i&&!YH&&qH(n,"toString",JH)}},QH=QM.IteratorPrototype,ZH=oh,e6=Ya,t6=Qa,r6=$s,i6=function(){return this},Gy=function(e,t,r,i){var n=t+" Iterator";return e.prototype=ZH(QH,{next:e6(+!i,r)}),t6(e,n,!1,!0),r6[n]=i6,e},n6=Be,o6=nr,a6=XM,s6=Gy,c6=Vy,l6=Qa,iw=Ja,nw=$s,d6=QM,u6=a6.PROPER,jh=d6.BUGGY_SAFARI_ITERATORS,uE=vt("iterator"),ow="keys",Gh="values",aw="entries",h6=function(){return this},ZM=function(e,t,r,i,n,o,a){s6(r,t,i);var s,c,l,d=function(S){if(S===n&&_)return _;if(!jh&&S in p)return p[S];switch(S){case ow:case Gh:case aw:return function(){return new r(this,S)}}return function(){return new r(this)}},u=t+" Iterator",h=!1,p=e.prototype,g=p[uE]||p["@@iterator"]||n&&p[n],_=!jh&&g||d(n),E=t=="Array"&&p.entries||g;if(E&&(s=c6(E.call(new e)))!==Object.prototype&&s.next&&(l6(s,u,!0,!0),nw[u]=h6),u6&&n==Gh&&g&&g.name!==Gh&&(h=!0,_=function(){return o6(g,this)}),n)if(c={values:d(Gh),keys:o?_:d(ow),entries:d(aw)},a)for(l in c)(jh||h||!(l in p))&&iw(p,l,c[l]);else n6({target:t,proto:!0,forced:jh||h},c);return a&&p[uE]!==_&&iw(p,uE,_,{name:n}),nw[t]=_,c},Wy=function(e,t){return{value:e,done:t}},p6=$a,sw=$s,eU=qs;_n.f;var f6=ZM,cw=Wy,tU="Array Iterator",_6=eU.set,m6=eU.getterFor(tU);f6(Array,"Array",function(e,t){_6(this,{type:tU,target:p6(e),index:0,kind:t})},function(){var e=m6(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,cw(void 0,!0)):cw(r=="keys"?i:r=="values"?t[i]:[i,t[i]],!1)},"values"),sw.Arguments=sw.Array;var E6=_n,Y_=function(e,t,r){return E6.f(e,t,r)},g6=ai,S6=Y_,T6=ji,lw=vt("species"),v6=Dr,y6=TypeError,Hy=function(e,t){if(v6(t,e))return e;throw y6("Incorrect invocation")},R6=ir,IT=Ny,C6=Ct(Function.toString);R6(IT.inspectSource)||(IT.inspectSource=function(e){return C6(e)});var rU=IT.inspectSource,I6=Ct,w6=At,iU=ir,A6=_o,O6=rU,nU=function(){},b6=[],oU=ai("Reflect","construct"),Ky=/^\s*(?:class|function)\b/,N6=I6(Ky.exec),D6=!Ky.exec(nU),ed=function(e){if(!iU(e))return!1;try{return oU(nU,b6,e),!0}catch{return!1}},aU=function(e){if(!iU(e))return!1;switch(A6(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return D6||!!N6(Ky,O6(e))}catch{return!0}};aU.sham=!0;var Iu,tc,dw,hE,$_=!oU||w6(function(){var e;return ed(ed.call)||!ed(Object)||!ed(function(){e=!0})||e})?aU:ed,P6=$_,k6=kl,L6=TypeError,uw=$r,M6=function(e){if(P6(e))return e;throw L6(k6(e)+" is not a constructor")},U6=Nl,x6=vt("species"),zy=function(e,t){var r,i=uw(e).constructor;return i===void 0||U6(r=uw(i)[x6])?t:M6(r)},Yy=Ct([].slice),V6=TypeError,q_=function(e,t){if(e<t)throw V6("Not enough arguments");return e},sU=/(?:ipad|iphone|ipod).*applewebkit/i.test(zs),Li=rr,F6=by,B6=qa,hw=ir,j6=lr,cU=At,pw=BM,G6=Yy,fw=Py,W6=q_,H6=sU,K6=ih,wT=Li.setImmediate,AT=Li.clearImmediate,z6=Li.process,pE=Li.Dispatch,Y6=Li.Function,_w=Li.MessageChannel,$6=Li.String,fE=0,Kd={},mw="onreadystatechange";cU(function(){Iu=Li.location});var $y=function(e){if(j6(Kd,e)){var t=Kd[e];delete Kd[e],t()}},_E=function(e){return function(){$y(e)}},Ew=function(e){$y(e.data)},gw=function(e){Li.postMessage($6(e),Iu.protocol+"//"+Iu.host)};wT&&AT||(wT=function(e){W6(arguments.length,1);var t=hw(e)?e:Y6(e),r=G6(arguments,1);return Kd[++fE]=function(){F6(t,void 0,r)},tc(fE),fE},AT=function(e){delete Kd[e]},K6?tc=function(e){z6.nextTick(_E(e))}:pE&&pE.now?tc=function(e){pE.now(_E(e))}:_w&&!H6?(hE=(dw=new _w).port2,dw.port1.onmessage=Ew,tc=B6(hE.postMessage,hE)):Li.addEventListener&&hw(Li.postMessage)&&!Li.importScripts&&Iu&&Iu.protocol!=="file:"&&!cU(gw)?(tc=gw,Li.addEventListener("message",Ew,!1)):tc=mw in fw("script")?function(e){pw.appendChild(fw("script"))[mw]=function(){pw.removeChild(this),$y(e)}}:function(e){setTimeout(_E(e),0)});var lU={set:wT,clear:AT},dU=function(){this.head=null,this.tail=null};dU.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var rc,mE,EE,gE,Sw,uU=dU,q6=/ipad|iphone|ipod/i.test(zs)&&typeof Pebble<"u",X6=/web0s(?!.*chrome)/i.test(zs),Fs=rr,Tw=qa,J6=eh.f,SE=lU.set,Q6=uU,Z6=sU,eK=q6,tK=X6,TE=ih,vw=Fs.MutationObserver||Fs.WebKitMutationObserver,yw=Fs.document,Rw=Fs.process,Wh=Fs.Promise,Cw=J6(Fs,"queueMicrotask"),OT=Cw&&Cw.value;OT||(td=new Q6,rd=function(){var e,t;for(TE&&(e=Rw.domain)&&e.exit();t=td.get();)try{t()}catch(r){throw td.head&&rc(),r}e&&e.enter()},Z6||TE||tK||!vw||!yw?!eK&&Wh&&Wh.resolve?((gE=Wh.resolve(void 0)).constructor=Wh,Sw=Tw(gE.then,gE),rc=function(){Sw(rd)}):TE?rc=function(){Rw.nextTick(rd)}:(SE=Tw(SE,Fs),rc=function(){SE(rd)}):(mE=!0,EE=yw.createTextNode(""),new vw(rd).observe(EE,{characterData:!0}),rc=function(){EE.data=mE=!mE}),OT=function(e){td.head||rc(),td.add(e)});var td,rd,rK=OT,Ml=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Bs=rr.Promise,hU=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",iK=!hU&&!ih&&typeof window=="object"&&typeof document=="object",nK=rr,zd=Bs,oK=ir,aK=bM,sK=rU,cK=vt,lK=iK,dK=hU,vE=Vs,Iw=zd&&zd.prototype,uK=cK("species"),pU=!1,fU=oK(nK.PromiseRejectionEvent),hK=aK("Promise",function(){var e=sK(zd),t=e!==String(zd);if(!t&&vE===66||!Iw.catch||!Iw.finally)return!0;if(!vE||vE<51||!/native code/.test(e)){var r=new zd(function(n){n(1)}),i=function(n){n(function(){},function(){})};if((r.constructor={})[uK]=i,!(pU=r.then(function(){})instanceof i))return!0}return!t&&(lK||dK)&&!fU}),sh={CONSTRUCTOR:hK,REJECTION_EVENT:fU,SUBCLASSING:pU},mo={},ww=fn,pK=TypeError,fK=function(e){var t,r;this.promise=new e(function(i,n){if(t!==void 0||r!==void 0)throw pK("Bad Promise constructor");t=i,r=n}),this.resolve=ww(t),this.reject=ww(r)};mo.f=function(e){return new fK(e)};var yE,Aw,_K=Be,zf=ih,ja=rr,ch=nr,mK=Ja,EK=Qa,gK=function(e){var t=g6(e);T6&&t&&!t[lw]&&S6(t,lw,{configurable:!0,get:function(){return this}})},SK=fn,bT=ir,TK=Ri,vK=Hy,yK=zy,_U=lU.set,qy=rK,RK=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},CK=Ml,IK=uU,mU=qs,NT=Bs,EU=sh,gU=mo,Yp="Promise",Ow=EU.CONSTRUCTOR,wK=EU.REJECTION_EVENT,RE=mU.getterFor(Yp),AK=mU.set,OK=NT&&NT.prototype,id=NT,CE=OK,SU=ja.TypeError,DT=ja.document,Xy=ja.process,PT=gU.f,bK=PT,NK=!!(DT&&DT.createEvent&&ja.dispatchEvent),TU="unhandledrejection",vU=function(e){var t;return!(!TK(e)||!bT(t=e.then))&&t},yU=function(e,t){var r,i,n,o=t.value,a=t.state==1,s=a?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{s?(a||(t.rejection===2&&PK(t),t.rejection=1),s===!0?r=o:(d&&d.enter(),r=s(o),d&&(d.exit(),n=!0)),r===e.promise?l(SU("Promise-chain cycle")):(i=vU(r))?ch(i,r,c,l):c(r)):l(o)}catch(u){d&&!n&&d.exit(),l(u)}},RU=function(e,t){e.notified||(e.notified=!0,qy(function(){for(var r,i=e.reactions;r=i.get();)yU(r,e);e.notified=!1,t&&!e.rejection&&DK(e)}))},CU=function(e,t,r){var i,n;NK?((i=DT.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),ja.dispatchEvent(i)):i={promise:t,reason:r},!wK&&(n=ja["on"+e])?n(i):e===TU&&RK("Unhandled promise rejection",r)},DK=function(e){ch(_U,ja,function(){var t,r=e.facade,i=e.value;if(bw(e)&&(t=CK(function(){zf?Xy.emit("unhandledRejection",i,r):CU(TU,r,i)}),e.rejection=zf||bw(e)?2:1,t.error))throw t.value})},bw=function(e){return e.rejection!==1&&!e.parent},PK=function(e){ch(_U,ja,function(){var t=e.facade;zf?Xy.emit("rejectionHandled",t):CU("rejectionhandled",t,e.value)})},Mc=function(e,t,r){return function(i){e(t,i,r)}},Qc=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,RU(e,!0))},kT=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw SU("Promise can't be resolved itself");var i=vU(t);i?qy(function(){var n={done:!1};try{ch(i,t,Mc(kT,n,e),Mc(Qc,n,e))}catch(o){Qc(n,o,e)}}):(e.value=t,e.state=1,RU(e,!1))}catch(n){Qc({done:!1},n,e)}}};Ow&&(CE=(id=function(e){vK(this,CE),SK(e),ch(yE,this);var t=RE(this);try{e(Mc(kT,t),Mc(Qc,t))}catch(r){Qc(t,r)}}).prototype,(yE=function(e){AK(this,{type:Yp,done:!1,notified:!1,parent:!1,reactions:new IK,rejection:!1,state:0,value:void 0})}).prototype=mK(CE,"then",function(e,t){var r=RE(this),i=PT(yK(this,id));return r.parent=!0,i.ok=!bT(e)||e,i.fail=bT(t)&&t,i.domain=zf?Xy.domain:void 0,r.state==0?r.reactions.add(i):qy(function(){yU(i,r)}),i.promise}),Aw=function(){var e=new yE,t=RE(e);this.promise=e,this.resolve=Mc(kT,t),this.reject=Mc(Qc,t)},gU.f=PT=function(e){return e===id||e===void 0?new Aw(e):bK(e)}),_K({global:!0,constructor:!0,wrap:!0,forced:Ow},{Promise:id}),EK(id,Yp,!1,!0),gK(Yp);var IU=vt("iterator"),wU=!1;try{Nw=0,IE={next:function(){return{done:!!Nw++}},return:function(){wU=!0}},IE[IU]=function(){return this},Array.from(IE,function(){throw 2})}catch{}var Nw,IE,kK=Bs,LK=function(e,t){if(!wU)return!1;var r=!1;try{var i={};i[IU]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch{}return r},X_=sh.CONSTRUCTOR||!LK(function(e){kK.all(e).then(void 0,function(){})}),MK=nr,UK=fn,xK=mo,VK=Ml,FK=ah;Be({target:"Promise",stat:!0,forced:X_},{all:function(e){var t=this,r=xK.f(t),i=r.resolve,n=r.reject,o=VK(function(){var a=UK(t.resolve),s=[],c=0,l=1;FK(e,function(d){var u=c++,h=!1;l++,MK(a,t,d).then(function(p){h||(h=!0,s[u]=p,--l||i(s))},n)}),--l||i(s)});return o.error&&n(o.value),r.promise}});var BK=Be,jK=sh.CONSTRUCTOR;Bs&&Bs.prototype,BK({target:"Promise",proto:!0,forced:jK,real:!0},{catch:function(e){return this.then(void 0,e)}});var GK=nr,WK=fn,HK=mo,KK=Ml,zK=ah;Be({target:"Promise",stat:!0,forced:X_},{race:function(e){var t=this,r=HK.f(t),i=r.reject,n=KK(function(){var o=WK(t.resolve);zK(e,function(a){GK(o,t,a).then(r.resolve,i)})});return n.error&&i(n.value),r.promise}});var YK=nr,$K=mo;Be({target:"Promise",stat:!0,forced:sh.CONSTRUCTOR},{reject:function(e){var t=$K.f(this);return YK(t.reject,void 0,e),t.promise}});var qK=$r,XK=Ri,JK=mo,AU=function(e,t){if(qK(e),XK(t)&&t.constructor===e)return t;var r=JK.f(e);return(0,r.resolve)(t),r.promise},QK=Be,ZK=Bs,e8=sh.CONSTRUCTOR,t8=AU,r8=ai("Promise"),i8=!e8;QK({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return t8(i8&&this===r8?ZK:this,e)}});var n8=nr,o8=fn,a8=mo,s8=Ml,c8=ah;Be({target:"Promise",stat:!0,forced:X_},{allSettled:function(e){var t=this,r=a8.f(t),i=r.resolve,n=r.reject,o=s8(function(){var a=o8(t.resolve),s=[],c=0,l=1;c8(e,function(d){var u=c++,h=!1;l++,n8(a,t,d).then(function(p){h||(h=!0,s[u]={status:"fulfilled",value:p},--l||i(s))},function(p){h||(h=!0,s[u]={status:"rejected",reason:p},--l||i(s))})}),--l||i(s)});return o.error&&n(o.value),r.promise}});var l8=nr,d8=fn,u8=ai,h8=mo,p8=Ml,f8=ah,Dw="No one promise resolved";Be({target:"Promise",stat:!0,forced:X_},{any:function(e){var t=this,r=u8("AggregateError"),i=h8.f(t),n=i.resolve,o=i.reject,a=p8(function(){var s=d8(t.resolve),c=[],l=0,d=1,u=!1;f8(e,function(h){var p=l++,g=!1;d++,l8(s,t,h).then(function(_){g||u||(u=!0,n(_))},function(_){g||u||(g=!0,c[p]=_,--d||o(new r(c,Dw)))})}),--d||o(new r(c,Dw))});return a.error&&o(a.value),i.promise}});var _8=Be,LT=Bs,m8=At,E8=ai,g8=ir,S8=zy,Pw=AU,T8=LT&&LT.prototype;_8({target:"Promise",proto:!0,real:!0,forced:!!LT&&m8(function(){T8.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=S8(this,E8("Promise")),r=g8(e);return this.then(r?function(i){return Pw(t,e()).then(function(){return i})}:e,r?function(i){return Pw(t,e()).then(function(){throw i})}:e)}});var Jy=Ct,v8=ky,y8=Gi,R8=Dl,C8=Jy("".charAt),kw=Jy("".charCodeAt),I8=Jy("".slice),Lw=function(e){return function(t,r){var i,n,o=y8(R8(t)),a=v8(r),s=o.length;return a<0||a>=s?e?"":void 0:(i=kw(o,a))<55296||i>56319||a+1===s||(n=kw(o,a+1))<56320||n>57343?e?C8(o,a):i:e?I8(o,a,a+2):n-56320+(i-55296<<10)+65536}},Qy={codeAt:Lw(!1),charAt:Lw(!0)},w8=Qy.charAt,A8=Gi,OU=qs,O8=ZM,Mw=Wy,bU="String Iterator",b8=OU.set,N8=OU.getterFor(bU);O8(String,"String",function(e){b8(this,{type:bU,string:A8(e),index:0})},function(){var e,t=N8(this),r=t.string,i=t.index;return i>=r.length?Mw(void 0,!0):(e=w8(r,i),t.index+=e.length,Mw(e,!1))});var D8=Vn.Promise,P8={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},k8=rr,L8=_o,M8=Xa,Uw=$s,xw=vt("toStringTag");for(Kh in P8)wE=k8[Kh],Hh=wE&&wE.prototype,Hh&&L8(Hh)!==xw&&M8(Hh,xw,Kh),Uw[Kh]=Uw.Array;var wE,Hh,Kh,NU=D8,K=_t(NU),Vw=xM;function DU(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;let s={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;let l=typeof a[c]=="object"?a[c]:{ideal:a[c]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);let d=function(u,h){return u?u+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(l.ideal!==void 0){s.optional=s.optional||[];let u={};typeof l.ideal=="number"?(u[d("min",c)]=l.ideal,s.optional.push(u),u={},u[d("max",c)]=l.ideal,s.optional.push(u)):(u[d("",c)]=l.ideal,s.optional.push(u))}l.exact!==void 0&&typeof l.exact!="number"?(s.mandatory=s.mandatory||{},s.mandatory[d("",c)]=l.exact):["min","max"].forEach(u=>{l[u]!==void 0&&(s.mandatory=s.mandatory||{},s.mandatory[d(u,c)]=l[u])})}),a.advanced&&(s.optional=(s.optional||[]).concat(a.advanced)),s},n=function(a,s){if(t.version>=61)return s(a);if((a=JSON.parse(JSON.stringify(a)))&&typeof a.audio=="object"){let c=function(l,d,u){d in l&&!(u in l)&&(l[u]=l[d],delete l[d])};c((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});let l=t.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||l)){let d;if(delete a.video.facingMode,c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:c.exact!=="user"&&c.ideal!=="user"||(d=["front"]),d)return r.mediaDevices.enumerateDevices().then(u=>{let h=(u=u.filter(p=>p.kind==="videoinput")).find(p=>d.some(g=>{var _;return Y(_=p.label.toLowerCase()).call(_,g)}));return!h&&u.length&&Y(d).call(d,"back")&&(h=u[u.length-1]),h&&(a.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),a.video=i(a.video),Vw("chrome: "+JSON.stringify(a)),s(a)})}a.video=i(a.video)}return Vw("chrome: "+JSON.stringify(a)),s(a)},o=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(a,s,c){n(a,l=>{r.webkitGetUserMedia(l,s,d=>{c&&c(o(d))})})}).bind(r),r.mediaDevices.getUserMedia){let a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(s){return n(s,c=>a(c).then(l=>{if(c.audio&&!l.getAudioTracks().length||c.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return l},l=>K.reject(o(l))))}}}function PU(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function kU(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):{track:i.track};let o=new Event("track");o.track=i.track,o.receiver=n,o.transceiver={receiver:n},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===i.id):{track:i};let o=new Event("track");o.track=i,o.receiver=n,o.transceiver={receiver:n},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ys(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function LU(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(n,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=n.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:n}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,s){let c=n.apply(this,arguments);return c||(c=t(this,a),this._senders.push(c)),c};let o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);let s=this._senders.indexOf(a);s!==-1&&this._senders.splice(s,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(n){this._senders=this._senders||[],r.apply(this,[n]),n.getTracks().forEach(o=>{this._senders.push(t(this,o))})};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(n){this._senders=this._senders||[],i.apply(this,[n]),n.getTracks().forEach(o=>{let a=this._senders.find(s=>s.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function MU(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[r,i,n]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);let o=function(s){let c={};return s.result().forEach(l=>{let d={id:l.id,timestamp:l.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type};l.names().forEach(u=>{d[u]=l.stat(u)}),c[d.id]=d}),c},a=function(s){return new Map(Object.keys(s).map(c=>[c,s[c]]))};if(arguments.length>=2){let s=function(c){i(a(o(c)))};return t.apply(this,[s,r])}return new K((s,c)=>{t.apply(this,[function(l){s(a(o(l)))},c])}).then(i,n)}}function UU(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let n=r.apply(this,[]);return n.forEach(o=>o._pc=this),n});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let n=i.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){let n=this;return this._pc.getStats().then(o=>VI(o,n.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=r.apply(this,[]);return i.forEach(n=>n._pc=this),i}),Ys(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){let i=this;return this._pc.getStats().then(n=>VI(n,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let r=arguments[0],i,n,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(n?o=!0:n=a),a.track===r)),o||i&&n?K.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():n?n.getStats():K.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function xU(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let s=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(s)===-1&&this._shimmedLocalStreams[a.id].push(s):this._shimmedLocalStreams[a.id]=[a,s],s};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(l=>l.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});let a=this.getSenders();r.apply(this,arguments);let s=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(s)};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};let n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{let s=this._shimmedLocalStreams[a].indexOf(o);s!==-1&&this._shimmedLocalStreams[a].splice(s,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),n.apply(this,arguments)}}function VU(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return xU(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let c=r.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(l=>this._reverseStreams[l.id])};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){let l=new e.MediaStream(c.getTracks());this._streams[c.id]=l,this._reverseStreams[l.id]=c,c=l}i.apply(this,[c])};let n=e.RTCPeerConnection.prototype.removeStream;function o(c,l){let d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{let h=c._reverseStreams[u],p=c._streams[h.id];d=d.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:l.type,sdp:d})}e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(h=>h===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(h=>h.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let u=this._streams[l.id];if(u)u.addTrack(c),K.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let h=new e.MediaStream([c]);this._streams[l.id]=h,this._reverseStreams[h.id]=l,this.addStream(h)}return this.getSenders().find(h=>h.track===c)},["createOffer","createAnswer"].forEach(function(c){let l=e.RTCPeerConnection.prototype[c],d={[c](){let u=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[h=>{let p=o(this,h);u[0].apply(null,[p])},h=>{u[1]&&u[1].apply(null,h)},arguments[2]]):l.apply(this,arguments).then(h=>o(this,h))}};e.RTCPeerConnection.prototype[c]=d[c]});let a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(c,l){let d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{let h=c._reverseStreams[u],p=c._streams[h.id];d=d.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:l.type,sdp:d})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};let s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let c=s.get.apply(this);return c.type===""?c:o(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let l;this._streams=this._streams||{},Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(u=>c.track===u)&&(l=this._streams[d])}),l&&(l.getTracks().length===1?this.removeStream(this._reverseStreams[l.id]):l.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function MT(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let i=e.RTCPeerConnection.prototype[r],n={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=n[r]})}function FU(e,t){Ys(e,"negotiationneeded",r=>{let i=r.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return r})}var Fw=Object.freeze({__proto__:null,fixNegotiationNeeded:FU,shimAddTrackRemoveTrack:VU,shimAddTrackRemoveTrackWithNative:xU,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{let n=r.video&&r.video.width,o=r.video&&r.video.height,a=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:a||3}},n&&(r.video.mandatory.maxWidth=n),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:LU,shimGetStats:MU,shimGetUserMedia:DU,shimMediaStream:PU,shimOnTrack:kU,shimPeerConnection:MT,shimSenderReceiverGetStats:UU});function BU(e,t){let r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(n,o,a){xy("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(n).then(o,a)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let n=function(a,s,c){s in a&&!(c in a)&&(a[c]=a[s],delete a[s])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a.audio,"autoGainControl","mozAutoGainControl"),n(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},i&&i.prototype.getSettings){let a=i.prototype.getSettings;i.prototype.getSettings=function(){let s=a.apply(this,arguments);return n(s,"mozAutoGainControl","autoGainControl"),n(s,"mozNoiseSuppression","noiseSuppression"),s}}if(i&&i.prototype.applyConstraints){let a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(s){return this.kind==="audio"&&typeof s=="object"&&(s=JSON.parse(JSON.stringify(s)),n(s,"autoGainControl","mozAutoGainControl"),n(s,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[s])}}}}function jU(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function UT(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){let o=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[n,o,a]=arguments;return i.apply(this,[n||null]).then(s=>{if(t.version<53&&!o)try{s.forEach(c=>{c.type=r[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;s.forEach((l,d)=>{s.set(d,Object.assign({},l,{type:r[l.type]||l.type}))})}return s}).then(o,a)}}function GU(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(n=>n._pc=this),i});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):K.resolve(new Map)}}function WU(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Ys(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function HU(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){xy("removeStream","removeTrack"),this.getSenders().forEach(r=>{var i;r.track&&Y(i=t.getTracks()).call(i,r.track)&&this.removeTrack(r)})})}function KU(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function zU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];let i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let n=t.apply(this,arguments);if(i){let{sender:o}=n,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return n})}function YU(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function $U(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?K.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function qU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?K.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Bw=Object.freeze({__proto__:null,shimAddTransceiver:zU,shimCreateAnswer:qU,shimCreateOffer:$U,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){let i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,K.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:YU,shimGetUserMedia:BU,shimOnTrack:jU,shimPeerConnection:UT,shimRTCDataChannel:KU,shimReceiverGetStats:WU,shimRemoveStream:HU,shimSenderGetStats:GU});function XU(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var i;this._localStreams||(this._localStreams=[]),Y(i=this._localStreams).call(i,r)||this._localStreams.push(r),r.getAudioTracks().forEach(n=>t.call(this,n,r)),r.getVideoTracks().forEach(n=>t.call(this,n,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return n&&n.forEach(a=>{var s;this._localStreams?Y(s=this._localStreams).call(s,a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);let i=t.getTracks();this.getSenders().forEach(n=>{Y(i).call(i,n.track)&&this.removeTrack(n)})})}}function JU(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(n=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),Y(o=this._remoteStreams).call(o,n))return;this._remoteStreams.push(n);let a=new Event("addstream");a.stream=n,this.dispatchEvent(a)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(n=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(n)>=0)return;r._remoteStreams.push(n);let o=new Event("addstream");o.stream=n,r.dispatchEvent(o)})}),t.apply(r,arguments)}}}function QU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(c,l){let d=arguments.length>=2?arguments[2]:arguments[0],u=r.apply(this,[d]);return l?(u.then(c,l),K.resolve()):u},t.createAnswer=function(c,l){let d=arguments.length>=2?arguments[2]:arguments[0],u=i.apply(this,[d]);return l?(u.then(c,l),K.resolve()):u};let s=function(c,l,d){let u=n.apply(this,[c]);return d?(u.then(l,d),K.resolve()):u};t.setLocalDescription=s,s=function(c,l,d){let u=o.apply(this,[c]);return d?(u.then(l,d),K.resolve()):u},t.setRemoteDescription=s,s=function(c,l,d){let u=a.apply(this,[c]);return d?(u.then(l,d),K.resolve()):u},t.addIceCandidate=s}function ZU(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let r=t.mediaDevices,i=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=n=>i(e2(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,i,n){t.mediaDevices.getUserMedia(r).then(i,n)}).bind(t))}function e2(e){return e&&e.video!==void 0?Object.assign({},e,{video:VM(e.video)}):e}function t2(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){let n=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(xy("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,n.push(a)):n.push(r.iceServers[o])}r.iceServers=n}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function r2(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function i2(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);let i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);let n=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveVideo!==!0||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function n2(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var jw=Object.freeze({__proto__:null,shimAudioContext:n2,shimCallbacksAPI:QU,shimConstraints:e2,shimCreateOfferLegacy:i2,shimGetUserMedia:ZU,shimLocalStreamsAPI:XU,shimRTCIceServerUrls:t2,shimRemoteStreamsAPI:JU,shimTrackEventTransceiver:r2}),o2=`	
\v\f\r \u2028\u2029\uFEFF`,U8=Dl,x8=Gi,xT=o2,Gw=Ct("".replace),V8=RegExp("^["+xT+"]+"),F8=RegExp("(^|[^"+xT+"])["+xT+"]+$"),AE=function(e){return function(t){var r=x8(U8(t));return 1&e&&(r=Gw(r,V8,"")),2&e&&(r=Gw(r,F8,"$1")),r}},B8={start:AE(1),end:AE(2),trim:AE(3)},j8=XM.PROPER,G8=At,Ww=o2,W8=B8.trim;Be({target:"String",proto:!0,forced:function(e){return G8(function(){return!!Ww[e]()||""[e]()!==""||j8&&Ww[e].name!==e})}("trim")},{trim:function(){return W8(this)}});var H8=mn("String").trim,K8=Dr,z8=H8,OE=String.prototype,Y8=function(e){var t=e.trim;return typeof e=="string"||e===OE||K8(OE,e)&&t===OE.trim?z8:t},Sr=_t(Y8),a2={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(r){return r.split(`
m=`).map((i,n)=>(n>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(r){let i=t.splitSections(r);return i&&i[0]},t.getMediaSections=function(r){let i=t.splitSections(r);return i.shift(),i},t.matchPrefix=function(r,i){return t.splitLines(r).filter(n=>n.indexOf(i)===0)},t.parseCandidate=function(r){let i;i=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");let n={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":n.relatedAddress=i[o+1];break;case"rport":n.relatedPort=parseInt(i[o+1],10);break;case"tcptype":n.tcpType=i[o+1];break;case"ufrag":n.ufrag=i[o+1],n.usernameFragment=i[o+1];break;default:n[i[o]]===void 0&&(n[i[o]]=i[o+1])}return n},t.writeCandidate=function(r){let i=[];i.push(r.foundation);let n=r.component;n==="rtp"?i.push(1):n==="rtcp"?i.push(2):i.push(n),i.push(r.protocol.toUpperCase()),i.push(r.priority),i.push(r.address||r.ip),i.push(r.port);let o=r.type;return i.push("typ"),i.push(o),o!=="host"&&r.relatedAddress&&r.relatedPort&&(i.push("raddr"),i.push(r.relatedAddress),i.push("rport"),i.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(i.push("ufrag"),i.push(r.usernameFragment||r.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let i=r.substring(9).split(" "),n={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),n.name=i[0],n.clockRate=parseInt(i[1],10),n.channels=i.length===3?parseInt(i[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(r){let i=r.payloadType;r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType);let n=r.channels||r.numChannels||1;return"a=rtpmap:"+i+" "+r.name+"/"+r.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(r){let i=r.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){let i={},n,o=r.substring(r.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)n=o[a].trim().split("="),i[n[0].trim()]=n[1];return i},t.writeFmtp=function(r){let i="",n=r.payloadType;if(r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){let o=[];Object.keys(r.parameters).forEach(a=>{r.parameters[a]!==void 0?o.push(a+"="+r.parameters[a]):o.push(a)}),i+="a=fmtp:"+n+" "+o.join(";")+`\r
`}return i},t.parseRtcpFb=function(r){let i=r.substring(r.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(r){let i="",n=r.payloadType;return r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+n+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(r){let i=r.indexOf(" "),n={ssrc:parseInt(r.substring(7,i),10)},o=r.indexOf(":",i);return o>-1?(n.attribute=r.substring(i+1,o),n.value=r.substring(o+1)):n.attribute=r.substring(i+1),n},t.parseSsrcGroup=function(r){let i=r.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(n=>parseInt(n,10))}},t.getMid=function(r){let i=t.matchPrefix(r,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(r){let i=r.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(r,i){return{role:"auto",fingerprints:t.matchPrefix(r+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,i){let n="a=setup:"+i+`\r
`;return r.fingerprints.forEach(o=>{n+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),n},t.parseCryptoLine=function(r){let i=r.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;let i=r.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,i){return t.matchPrefix(r+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,i){let n=t.matchPrefix(r+i,"a=ice-ufrag:")[0],o=t.matchPrefix(r+i,"a=ice-pwd:")[0];return n&&o?{usernameFragment:n.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(r){let i="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(r){let i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(r)[0].split(" ");i.profile=n[2];for(let a=3;a<n.length;a++){let s=n[a],c=t.matchPrefix(r,"a=rtpmap:"+s+" ")[0];if(c){let l=t.parseRtpMap(c),d=t.matchPrefix(r,"a=fmtp:"+s+" ");switch(l.parameters=d.length?t.parseFmtp(d[0]):{},l.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),i.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(l.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(a=>{i.headerExtensions.push(t.parseExtmap(a))});let o=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(s=>{a.rtcpFeedback.find(c=>c.type===s.type&&c.parameter===s.parameter)||a.rtcpFeedback.push(s)})}),i},t.writeRtpDescription=function(r,i){let n="";n+="m="+r+" ",n+=i.codecs.length>0?"9":"0",n+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{n+=t.writeRtpMap(a),n+=t.writeFmtp(a),n+=t.writeRtcpFb(a)});let o=0;return i.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(n+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{n+=t.writeExtmap(a)}),n},t.parseRtpEncodingParameters=function(r){let i=[],n=t.parseRtpParameters(r),o=n.fecMechanisms.indexOf("RED")!==-1,a=n.fecMechanisms.indexOf("ULPFEC")!==-1,s=t.matchPrefix(r,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=s.length>0&&s[0].ssrc,l,d=t.matchPrefix(r,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(p=>parseInt(p,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),n.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),i.push(p),o&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&c&&i.push({ssrc:c});let u=t.matchPrefix(r,"b=");return u.length&&(u=u[0].indexOf("b=TIAS:")===0?parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,i.forEach(h=>{h.maxBitrate=u})),i},t.parseRtcpParameters=function(r){let i={},n=t.matchPrefix(r,"a=ssrc:").map(s=>t.parseSsrcMedia(s)).filter(s=>s.attribute==="cname")[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);let o=t.matchPrefix(r,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;let a=t.matchPrefix(r,"a=rtcp-mux");return i.mux=a.length>0,i},t.writeRtcpParameters=function(r){let i="";return r.reducedSize&&(i+=`a=rtcp-rsize\r
`),r.mux&&(i+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(i+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),i},t.parseMsid=function(r){let i,n=t.matchPrefix(r,"a=msid:");if(n.length===1)return i=n[0].substring(7).split(" "),{stream:i[0],track:i[1]};let o=t.matchPrefix(r,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");return o.length>0?(i=o[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(r){let i=t.parseMLine(r),n=t.matchPrefix(r,"a=max-message-size:"),o;n.length>0&&(o=parseInt(n[0].substring(19),10)),isNaN(o)&&(o=65536);let a=t.matchPrefix(r,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};let s=t.matchPrefix(r,"a=sctpmap:");if(s.length>0){let c=s[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},t.writeSctpDescription=function(r,i){let n=[];return n=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&n.push("a=max-message-size:"+i.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,i,n){let o,a=i!==void 0?i:2;return o=r||t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,i){let n=t.splitLines(r);for(let o=0;o<n.length;o++)switch(n[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[o].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){let i=t.splitLines(r)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(r){let i=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;let i=t.splitLines(r);for(let n=0;n<i.length;n++)if(i[n].length<2||i[n].charAt(1)!=="=")return!1;return!0},e.exports=t})(a2);var s2=a2.exports,Zc=_t(s2),$8=fG({__proto__:null,default:Zc},[s2]);function $p(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){let i=new t(r),n=Zc.parseCandidate(r.candidate),o=Object.assign(i,n);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Ys(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function VT(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ys(e,"icecandidate",t=>{if(t.candidate){let r=Zc.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function qp(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let r=function(s){if(!s||!s.sdp)return!1;let c=Zc.splitSections(s.sdp);return c.shift(),c.some(l=>{let d=Zc.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},i=function(s){let c=s.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;let l=parseInt(c[1],10);return l!=l?-1:l},n=function(s){let c=65536;return t.browser==="firefox"&&(c=t.version<57?s===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),c},o=function(s,c){let l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);let d=Zc.matchPrefix(s.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substr(19),10):t.browser==="firefox"&&c!==-1&&(l=2147483637),l},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:s}=this.getConfiguration();s==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let s=i(arguments[0]),c=n(s),l=o(arguments[0],s),d;d=c===0&&l===0?Number.POSITIVE_INFINITY:c===0||l===0?Math.max(c,l):Math.min(c,l);let u={};Object.defineProperty(u,"maxMessageSize",{get:()=>d}),this._sctp=u}return a.apply(this,arguments)}}function Xp(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,n){let o=i.send;i.send=function(){let a=arguments[0],s=a.length||a.size||a.byteLength;if(i.readyState==="open"&&n.sctp&&s>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let i=r.apply(this,arguments);return t(i,this),i},Ys(e,"datachannel",i=>(t(i.channel,i.target),i))}function FT(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let i=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{let o=n.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;let a=new Event("connectionstatechange",n);o.dispatchEvent(a)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function BT(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let n=i.sdp.split(`
`).filter(o=>Sr(o).call(o)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:n}):i.sdp=n}return r.apply(this,arguments)}}function Jp(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?K.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),K.resolve())})}function Qp(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return r.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?r.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(n=>r.apply(this,[n]))})}var q8=Object.freeze({__proto__:null,removeExtmapAllowMixed:BT,shimAddIceCandidateNullOrEmpty:Jp,shimConnectionState:FT,shimMaxMessageSize:qp,shimParameterlessSetLocalDescription:Qp,shimRTCIceCandidate:$p,shimRTCIceCandidateRelayProtocol:VT,shimSendThrowTypeError:Xp});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=xM,i=function(o){let a={browser:null,version:null};if(o===void 0||!o.navigator)return a.browser="Not a browser.",a;let{navigator:s}=o;if(s.mozGetUserMedia)a.browser="firefox",a.version=Fh(s.userAgent,/Firefox\/(\d+)\./,1);else if(s.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)a.browser="chrome",a.version=Fh(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!s.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=Fh(s.userAgent,/AppleWebKit\/(\d+)\./,1),a.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return a}(e),n={browserDetails:i,commonShim:q8,extractVersion:Fh,disableLog:YW,disableWarnings:$W,sdp:$8};switch(i.browser){case"chrome":if(!Fw||!MT||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),n;if(i.version===null)return r("Chrome shim can not determine version, not shimming."),n;r("adapter.js shimming chrome."),n.browserShim=Fw,Jp(e,i),Qp(e),DU(e,i),PU(e),MT(e,i),kU(e),VU(e,i),LU(e),MU(e),UU(e),FU(e,i),$p(e),VT(e),FT(e),qp(e,i),Xp(e),BT(e,i);break;case"firefox":if(!Bw||!UT||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),n;r("adapter.js shimming firefox."),n.browserShim=Bw,Jp(e,i),Qp(e),BU(e,i),UT(e,i),jU(e),HU(e),GU(e),WU(e),KU(e),zU(e),YU(e),$U(e),qU(e),$p(e),FT(e),qp(e,i),Xp(e);break;case"safari":if(!jw||!t.shimSafari)return r("Safari shim is not included in this adapter release."),n;r("adapter.js shimming safari."),n.browserShim=jw,Jp(e,i),Qp(e),t2(e),i2(e),QU(e),XU(e),JU(e),r2(e),ZU(e),n2(e),$p(e),VT(e),qp(e,i),Xp(e),BT(e,i);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var X8=mn("Array").keys,J8=_o,Q8=lr,Z8=Dr,ez=X8,bE=Array.prototype,tz={DOMTokenList:!0,NodeList:!0},rz=function(e){var t=e.keys;return e===bE||Z8(bE,e)&&t===bE.keys||Q8(tz,J8(e))?ez:t},ui=_t(rz),Hw=kl,iz=TypeError,nz=B_,oz=_n,az=Ya,J_=function(e,t,r){var i=nz(t);i in e?oz.f(e,i,az(0,r)):e[i]=r},Kw=Ly,sz=Ko,cz=J_,lz=Array,dz=Math.max,Zy=function(e,t,r){for(var i=sz(e),n=Kw(t,i),o=Kw(r===void 0?i:r,i),a=lz(dz(o-n,0)),s=0;n<o;n++,s++)cz(a,s,e[n]);return a.length=s,a},zw=Zy,uz=Math.floor,jT=function(e,t){var r=e.length,i=uz(r/2);return r<8?hz(e,t):pz(e,jT(zw(e,0,i),t),jT(zw(e,i),t),t)},hz=function(e,t){for(var r,i,n=e.length,o=1;o<n;){for(i=o,r=e[o];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==o++&&(e[i]=r)}return e},pz=function(e,t,r,i){for(var n=t.length,o=r.length,a=0,s=0;a<n||s<o;)e[a+s]=a<n&&s<o?i(t[a],r[s])<=0?t[a++]:r[s++]:a<n?t[a++]:r[s++];return e},c2=jT,Yw=zs.match(/firefox\/(\d+)/i),fz=!!Yw&&+Yw[1],_z=/MSIE|Trident/.test(zs),$w=zs.match(/AppleWebKit\/(\d+)\./),mz=!!$w&&+$w[1],Ez=Be,l2=Ct,gz=fn,Sz=fo,qw=Ko,Tz=function(e,t){if(!delete e[t])throw iz("Cannot delete property "+Hw(t)+" of "+Hw(e))},Xw=Gi,eR=At,vz=c2,yz=j_,Jw=fz,Rz=_z,Qw=Vs,Zw=mz,ga=[],eA=l2(ga.sort),Cz=l2(ga.push),Iz=eR(function(){ga.sort(void 0)}),wz=eR(function(){ga.sort(null)}),Az=yz("sort"),tA=!eR(function(){if(Qw)return Qw<70;if(!(Jw&&Jw>3)){if(Rz)return!0;if(Zw)return Zw<603;var e,t,r,i,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)ga.push({k:t+i,v:r})}for(ga.sort(function(o,a){return a.v-o.v}),i=0;i<ga.length;i++)t=ga[i].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return n!=="DGBEFHACIJK"}});Ez({target:"Array",proto:!0,forced:Iz||!wz||!Az||!tA},{sort:function(e){e!==void 0&&gz(e);var t=Sz(this);if(tA)return e===void 0?eA(t):eA(t,e);var r,i,n=[],o=qw(t);for(i=0;i<o;i++)i in t&&Cz(n,t[i]);for(vz(n,function(a){return function(s,c){return c===void 0?-1:s===void 0?1:a!==void 0?+a(s,c)||0:Xw(s)>Xw(c)?1:-1}}(e)),r=qw(n),i=0;i<r;)t[i]=n[i++];for(;i<o;)Tz(t,i++);return t}});var NE,DE,Oz=mn("Array").sort,bz=Dr,Nz=Oz,PE=Array.prototype,Dz=function(e){var t=e.sort;return e===PE||bz(PE,e)&&t===PE.sort?Nz:t},lh=_t(Dz),GT={exports:{}};NE=GT,DE=GT.exports,function(e,t){var r="function",i="undefined",n="object",o="string",a="major",s="model",c="name",l="type",d="vendor",u="version",h="architecture",p="console",g="mobile",_="tablet",E="smarttv",S="wearable",T="embedded",y="Amazon",I="Apple",O="ASUS",b="BlackBerry",k="Browser",P="Chrome",j="Firefox",G="Google",ce="Huawei",pe="LG",Ae="Microsoft",Ge="Motorola",at="Opera",pr="Samsung",x="Sharp",L="Sony",B="Xiaomi",N="Zebra",m="Facebook",C="Chromium OS",A="Mac OS",F=function(lt){for(var yt={},Ke=0;Ke<lt.length;Ke++)yt[lt[Ke].toUpperCase()]=lt[Ke];return yt},ae=function(lt,yt){return typeof lt===o&&Re(yt).indexOf(Re(lt))!==-1},Re=function(lt){return lt.toLowerCase()},st=function(lt,yt){if(typeof lt===o)return lt=lt.replace(/^\s\s*/,""),typeof yt===i?lt:lt.substring(0,350)},Fr=function(lt,yt){for(var Ke,qr,jn,dt,Ce,Br,Yo=0;Yo<yt.length&&!Ce;){var gn=yt[Yo],YR=yt[Yo+1];for(Ke=qr=0;Ke<gn.length&&!Ce&&gn[Ke];)if(Ce=gn[Ke++].exec(lt))for(jn=0;jn<YR.length;jn++)Br=Ce[++qr],typeof(dt=YR[jn])===n&&dt.length>0?dt.length===2?typeof dt[1]==r?this[dt[0]]=dt[1].call(this,Br):this[dt[0]]=dt[1]:dt.length===3?typeof dt[1]!==r||dt[1].exec&&dt[1].test?this[dt[0]]=Br?Br.replace(dt[1],dt[2]):t:this[dt[0]]=Br?dt[1].call(this,Br,dt[2]):t:dt.length===4&&(this[dt[0]]=Br?dt[3].call(this,Br.replace(dt[1],dt[2])):t):this[dt]=Br||t;Yo+=2}},go=function(lt,yt){for(var Ke in yt)if(typeof yt[Ke]===n&&yt[Ke].length>0){for(var qr=0;qr<yt[Ke].length;qr++)if(ae(yt[Ke][qr],lt))return Ke==="?"?t:Ke}else if(ae(yt[Ke],lt))return Ke==="?"?t:Ke;return lt},mh={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Eh={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[u,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[u,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,u],[/opios[\/ ]+([\w\.]+)/i],[u,[c,at+" Mini"]],[/\bopr\/([\w\.]+)/i],[u,[c,at]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c,u],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[u,[c,"UC"+k]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[u,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[u,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[u,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[u,[c,"IE"]],[/yabrowser\/([\w\.]+)/i],[u,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+k],u],[/\bfocus\/([\w\.]+)/i],[u,[c,j+" Focus"]],[/\bopt\/([\w\.]+)/i],[u,[c,at+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[u,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[u,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[u,[c,at+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[u,[c,"MIUI "+k]],[/fxios\/([-\w\.]+)/i],[u,[c,j]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+k]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+k],u],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],u],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,u],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,m],u],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,u],[/\bgsa\/([\w\.]+) .*safari\//i],[u,[c,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[u,[c,P+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,P+" WebView"],u],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[u,[c,"Android "+k]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,u],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[u,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[u,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[u,go,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,u],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],u],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[u,[c,j+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,u],[/(cobalt)\/([\w\.]+)/i],[c,[u,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,Re]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",Re]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,Re]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[d,pr],[l,_]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[d,pr],[l,g]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[d,I],[l,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[d,I],[l,_]],[/(macintosh);/i],[s,[d,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[d,x],[l,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[d,ce],[l,_]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[s,[d,ce],[l,g]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[d,B],[l,g]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[d,B],[l,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[d,"OPPO"],[l,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[d,"Vivo"],[l,g]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[d,"Realme"],[l,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[d,Ge],[l,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[d,Ge],[l,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[d,pe],[l,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[d,pe],[l,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[d,"Lenovo"],[l,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[d,"Nokia"],[l,g]],[/(pixel c)\b/i],[s,[d,G],[l,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[d,G],[l,g]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[d,L],[l,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[d,L],[l,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[d,"OnePlus"],[l,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[d,y],[l,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[d,y],[l,g]],[/(playbook);[-\w\),; ]+(rim)/i],[s,d,[l,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[d,b],[l,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[d,O],[l,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[d,O],[l,g]],[/(nexus 9)/i],[s,[d,"HTC"],[l,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[s,/_/g," "],[l,g]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[d,"Acer"],[l,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[d,"Meizu"],[l,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,s,[l,g]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,s,[l,_]],[/(surface duo)/i],[s,[d,Ae],[l,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[d,"Fairphone"],[l,g]],[/(u304aa)/i],[s,[d,"AT&T"],[l,g]],[/\bsie-(\w*)/i],[s,[d,"Siemens"],[l,g]],[/\b(rct\w+) b/i],[s,[d,"RCA"],[l,_]],[/\b(venue[\d ]{2,7}) b/i],[s,[d,"Dell"],[l,_]],[/\b(q(?:mv|ta)\w+) b/i],[s,[d,"Verizon"],[l,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[d,"Barnes & Noble"],[l,_]],[/\b(tm\d{3}\w+) b/i],[s,[d,"NuVision"],[l,_]],[/\b(k88) b/i],[s,[d,"ZTE"],[l,_]],[/\b(nx\d{3}j) b/i],[s,[d,"ZTE"],[l,g]],[/\b(gen\d{3}) b.+49h/i],[s,[d,"Swiss"],[l,g]],[/\b(zur\d{3}) b/i],[s,[d,"Swiss"],[l,_]],[/\b((zeki)?tb.*\b) b/i],[s,[d,"Zeki"],[l,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],s,[l,_]],[/\b(ns-?\w{0,9}) b/i],[s,[d,"Insignia"],[l,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[d,"NextBook"],[l,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],s,[l,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],s,[l,g]],[/\b(ph-1) /i],[s,[d,"Essential"],[l,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[d,"Envizen"],[l,_]],[/\b(trio[-\w\. ]+) b/i],[s,[d,"MachSpeed"],[l,_]],[/\btu_(1491) b/i],[s,[d,"Rotor"],[l,_]],[/(shield[\w ]+) b/i],[s,[d,"Nvidia"],[l,_]],[/(sprint) (\w+)/i],[d,s,[l,g]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[d,Ae],[l,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[d,N],[l,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[d,N],[l,g]],[/smart-tv.+(samsung)/i],[d,[l,E]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[d,pr],[l,E]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,pe],[l,E]],[/(apple) ?tv/i],[d,[s,I+" TV"],[l,E]],[/crkey/i],[[s,P+"cast"],[d,G],[l,E]],[/droid.+aft(\w)( bui|\))/i],[s,[d,y],[l,E]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[s,[d,x],[l,E]],[/(bravia[\w ]+)( bui|\))/i],[s,[d,L],[l,E]],[/(mitv-\w{5}) bui/i],[s,[d,B],[l,E]],[/Hbbtv.*(technisat) (.*);/i],[d,s,[l,E]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,st],[s,st],[l,E]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,E]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,s,[l,p]],[/droid.+; (shield) bui/i],[s,[d,"Nvidia"],[l,p]],[/(playstation [345portablevi]+)/i],[s,[d,L],[l,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[d,Ae],[l,p]],[/((pebble))app/i],[d,s,[l,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[s,[d,I],[l,S]],[/droid.+; (glass) \d/i],[s,[d,G],[l,S]],[/droid.+; (wt63?0{2,3})\)/i],[s,[d,N],[l,S]],[/(quest( 2| pro)?)/i],[s,[d,m],[l,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[l,T]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[l,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[l,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,g]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[u,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c,u],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[u,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,u],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[u,go,mh]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[u,go,mh]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,A],[u,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[u,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,u],[/\(bb(10);/i],[u,[c,b]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[u,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[u,[c,j+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[u,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[u,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[u,[c,P+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,C],u],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,u],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],u],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c,u]]},Ci=function(lt,yt){if(typeof lt===n&&(yt=lt,lt=t),!(this instanceof Ci))return new Ci(lt,yt).getResult();var Ke=typeof e!==i&&e.navigator?e.navigator:t,qr=lt||(Ke&&Ke.userAgent?Ke.userAgent:""),jn=Ke&&Ke.userAgentData?Ke.userAgentData:t,dt=yt?function(Ce,Br){var Yo={};for(var gn in Ce)Br[gn]&&Br[gn].length%2==0?Yo[gn]=Br[gn].concat(Ce[gn]):Yo[gn]=Ce[gn];return Yo}(Eh,yt):Eh;return this.getBrowser=function(){var Ce={};return Ce[c]=t,Ce[u]=t,Fr.call(Ce,qr,dt.browser),Ce[a]=function(Br){return typeof Br===o?Br.replace(/[^\d\.]/g,"").split(".")[0]:t}(Ce[u]),Ke&&Ke.brave&&typeof Ke.brave.isBrave==r&&(Ce[c]="Brave"),Ce},this.getCPU=function(){var Ce={};return Ce[h]=t,Fr.call(Ce,qr,dt.cpu),Ce},this.getDevice=function(){var Ce={};return Ce[d]=t,Ce[s]=t,Ce[l]=t,Fr.call(Ce,qr,dt.device),!Ce[l]&&jn&&jn.mobile&&(Ce[l]=g),Ce[s]=="Macintosh"&&Ke&&typeof Ke.standalone!==i&&Ke.maxTouchPoints&&Ke.maxTouchPoints>2&&(Ce[s]="iPad",Ce[l]=_),Ce},this.getEngine=function(){var Ce={};return Ce[c]=t,Ce[u]=t,Fr.call(Ce,qr,dt.engine),Ce},this.getOS=function(){var Ce={};return Ce[c]=t,Ce[u]=t,Fr.call(Ce,qr,dt.os),!Ce[c]&&jn&&jn.platform!="Unknown"&&(Ce[c]=jn.platform.replace(/chrome os/i,C).replace(/macos/i,A)),Ce},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return qr},this.setUA=function(Ce){return qr=typeof Ce===o&&Ce.length>350?st(Ce,350):Ce,this},this.setUA(qr),this};Ci.VERSION="0.7.34",Ci.BROWSER=F([c,u,a]),Ci.CPU=F([h]),Ci.DEVICE=F([s,d,l,p,g,E,_,S,T]),Ci.ENGINE=Ci.OS=F([c,u]),NE.exports&&(DE=NE.exports=Ci),DE.UAParser=Ci;var zo=typeof e!==i&&(e.jQuery||e.Zepto);if(zo&&!zo.ua){var Js=new Ci;zo.ua=Js.getResult(),zo.ua.get=function(){return Js.getUA()},zo.ua.set=function(lt){Js.setUA(lt);var yt=Js.getResult();for(var Ke in yt)zo.ua[Ke]=yt[Ke]}}}(typeof window=="object"?window:Jc);var Pz=_t(GT.exports),kz=_o,Lz=lr,Mz=Nl,Uz=$s,xz=vt("iterator"),Vz=Object,Fz=function(e){if(Mz(e))return!1;var t=Vz(e);return t[xz]!==void 0||"@@iterator"in t||Lz(Uz,kz(t))},Bz=_t(Fz),kE=rr;Be({global:!0,forced:kE.globalThis!==kE},{globalThis:kE});var rA=_t(rr);function d2(e,t){return function(){return e.apply(t,arguments)}}var{toString:jz}=Object.prototype,{getPrototypeOf:tR}=Object,Yf=(LE=Object.create(null),e=>{let t=jz.call(e);return LE[t]||(LE[t]=t.slice(8,-1).toLowerCase())}),LE,Eo=e=>(e=e.toLowerCase(),t=>Yf(t)===e),Q_=e=>t=>typeof t===e,{isArray:Ec}=Array,yd=Q_("undefined"),iA=Eo("ArrayBuffer"),Gz=Q_("string"),Wi=Q_("function"),nA=Q_("number"),zh=e=>e!==null&&typeof e=="object",Yh=e=>{if(Yf(e)!=="object")return!1;let t=tR(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||Bz(e))},Wz=Eo("Date"),Hz=Eo("File"),Kz=Eo("Blob"),zz=Eo("FileList"),Yz=Eo("URLSearchParams");function Rd(e,t){let r,i,{allOwnKeys:n=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Ec(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{let o=n?Object.getOwnPropertyNames(e):Object.keys(e),a=o.length,s;for(r=0;r<a;r++)s=o[r],t.call(null,e[s],s,e)}}function oA(e,t){t=t.toLowerCase();let r=Object.keys(e),i,n=r.length;for(;n-- >0;)if(i=r[n],t===i.toLowerCase())return i;return null}var u2=rA!==void 0?rA:typeof self<"u"?self:typeof window<"u"?window:global,aA=e=>!yd(e)&&e!==u2,$z=(ME=typeof Uint8Array<"u"&&tR(Uint8Array),e=>ME&&e instanceof ME),ME,qz=Eo("HTMLFormElement"),sA=(e=>{let{hasOwnProperty:t}=e;return(r,i)=>t.call(r,i)})(Object.prototype),Xz=Eo("RegExp"),cA=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),i={};Rd(r,(n,o)=>{let a;(a=t(n,o,e))!==!1&&(i[o]=a||n)}),Object.defineProperties(e,i)},UE="abcdefghijklmnopqrstuvwxyz",lA="0123456789",dA={DIGIT:lA,ALPHA:UE,ALPHA_DIGIT:UE+UE.toUpperCase()+lA},Jz=Eo("AsyncFunction"),q={isArray:Ec,isArrayBuffer:iA,isBuffer:function(e){return e!==null&&!yd(e)&&e.constructor!==null&&!yd(e.constructor)&&Wi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Wi(e.append)&&((t=Yf(e))==="formdata"||t==="object"&&Wi(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&iA(e.buffer),t},isString:Gz,isNumber:nA,isBoolean:e=>e===!0||e===!1,isObject:zh,isPlainObject:Yh,isUndefined:yd,isDate:Wz,isFile:Hz,isBlob:Kz,isRegExp:Xz,isFunction:Wi,isStream:e=>zh(e)&&Wi(e.pipe),isURLSearchParams:Yz,isTypedArray:$z,isFileList:zz,forEach:Rd,merge:function e(){let{caseless:t}=aA(this)&&this||{},r={},i=(n,o)=>{let a=t&&oA(r,o)||o;Yh(r[a])&&Yh(n)?r[a]=e(r[a],n):Yh(n)?r[a]=e({},n):Ec(n)?r[a]=n.slice():r[a]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&Rd(arguments[n],i);return r},extend:function(e,t,r){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Rd(t,(n,o)=>{r&&Wi(n)?e[o]=d2(n,r):e[o]=n},{allOwnKeys:i}),e},trim:e=>Sr(e)?Sr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,i)=>{let n,o,a,s={};if(t=t||{},e==null)return t;do{for(n=Object.getOwnPropertyNames(e),o=n.length;o-- >0;)a=n[o],i&&!i(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=r!==!1&&tR(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:Yf,kindOfTest:Eo,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;let i=e.indexOf(t,r);return i!==-1&&i===r},toArray:e=>{if(!e)return null;if(Ec(e))return e;let t=e.length;if(!nA(t))return null;let r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{let r=(e&&e[Symbol.iterator]).call(e),i;for(;(i=r.next())&&!i.done;){let n=i.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let r,i=[];for(;(r=e.exec(t))!==null;)i.push(r);return i},isHTMLForm:qz,hasOwnProperty:sA,hasOwnProp:sA,reduceDescriptors:cA,freezeMethods:e=>{cA(e,(t,r)=>{if(Wi(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;let i=e[r];Wi(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{let r={},i=n=>{n.forEach(o=>{r[o]=!0})};return Ec(e)?i(e):i(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:oA,global:u2,isContextDefined:aA,ALPHABET:dA,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:dA.ALPHA_DIGIT,r="",{length:i}=t;for(;e--;)r+=t[Math.random()*i|0];return r},isSpecCompliantForm:function(e){return!!(e&&Wi(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),r=(i,n)=>{if(zh(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[n]=i;let o=Ec(i)?[]:{};return Rd(i,(a,s)=>{let c=r(a,n+1);!yd(c)&&(o[s]=c)}),t[n]=void 0,o}}return i};return r(e,0)},isAsyncFn:Jz,isThenable:e=>e&&(zh(e)||Wi(e))&&Wi(e.then)&&Wi(e.catch)};function Je(e,t,r,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),n&&(this.response=n)}q.inherits(Je,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:q.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var uA=Je.prototype,hA={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{hA[e]={value:e}}),Object.defineProperties(Je,hA),Object.defineProperty(uA,"isAxiosError",{value:!0}),Je.from=(e,t,r,i,n,o)=>{let a=Object.create(uA);return q.toFlatObject(e,a,function(s){return s!==Error.prototype},s=>s!=="isAxiosError"),Je.call(a,e.message,t,r,i,n),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};function xE(e){return q.isPlainObject(e)||q.isArray(e)}function h2(e){return q.endsWith(e,"[]")?e.slice(0,-2):e}function pA(e,t,r){return e?e.concat(t).map(function(i,n){return i=h2(i),!r&&n?"["+i+"]":i}).join(r?".":""):t}var Qz=q.toFlatObject(q,{},null,function(e){return/^is[A-Z]/.test(e)});function $f(e,t,r){if(!q.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let i=(r=q.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,p){return!q.isUndefined(p[h])})).metaTokens,n=r.visitor||l,o=r.dots,a=r.indexes,s=(r.Blob||typeof Blob<"u"&&Blob)&&q.isSpecCompliantForm(t);if(!q.isFunction(n))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(q.isDate(h))return h.toISOString();if(!s&&q.isBlob(h))throw new Je("Blob is not supported. Use a Buffer instead.");return q.isArrayBuffer(h)||q.isTypedArray(h)?s&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function l(h,p,g){let _=h;if(h&&!g&&typeof h=="object"){if(q.endsWith(p,"{}"))p=i?p:p.slice(0,-2),h=JSON.stringify(h);else if(q.isArray(h)&&function(E){return q.isArray(E)&&!E.some(xE)}(h)||(q.isFileList(h)||q.endsWith(p,"[]"))&&(_=q.toArray(h)))return p=h2(p),_.forEach(function(E,S){!q.isUndefined(E)&&E!==null&&t.append(a===!0?pA([p],S,o):a===null?p:p+"[]",c(E))}),!1}return!!xE(h)||(t.append(pA(g,p,o),c(h)),!1)}let d=[],u=Object.assign(Qz,{defaultVisitor:l,convertValue:c,isVisitable:xE});if(!q.isObject(e))throw new TypeError("data must be an object");return function h(p,g){if(!q.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(p),q.forEach(p,function(_,E){(!(q.isUndefined(_)||_===null)&&n.call(t,_,q.isString(E)?Sr(E).call(E):E,g,u))===!0&&h(_,g?g.concat(E):[E])}),d.pop()}}(e),t}function fA(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function rR(e,t){this._pairs=[],e&&$f(e,this,t)}var _A=rR.prototype;function Zz(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function p2(e,t,r){if(!t)return e;let i=r&&r.encode||Zz,n=r&&r.serialize,o;if(o=n?n(t,r):q.isURLSearchParams(t)?t.toString():new rR(t,r).toString(i),o){let a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}_A.append=function(e,t){this._pairs.push([e,t])},_A.toString=function(e){let t=e?function(r){return e.call(this,r,fA)}:fA;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var mA=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){q.forEach(this.handlers,function(t){t!==null&&e(t)})}},f2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},_2={exports:{}},eY=Be,tY=ji,EA=_n.f;eY({target:"Object",stat:!0,forced:Object.defineProperty!==EA,sham:!tY},{defineProperty:EA});var m2=Vn.Object,rY=_2.exports=function(e,t,r){return m2.defineProperty(e,t,r)};m2.defineProperty.sham&&(rY.sham=!0);var E2=_t(_2.exports),iY=po,dh=Array.isArray||function(e){return iY(e)=="Array"},nY=TypeError,gA=dh,oY=$_,aY=Ri,sY=vt("species"),SA=Array,cY=function(e){var t;return gA(e)&&(t=e.constructor,(oY(t)&&(t===SA||gA(t.prototype))||aY(t)&&(t=t[sY])===null)&&(t=void 0)),t===void 0?SA:t},g2=function(e,t){return new(cY(e))(t===0?0:t)},lY=At,dY=Vs,uY=vt("species"),S2=function(e){return dY>=51||!lY(function(){var t=[];return(t.constructor={})[uY]=function(){return{foo:1}},t[e](Boolean).foo!==1})},hY=Be,pY=At,fY=dh,_Y=Ri,mY=fo,EY=Ko,TA=function(e){if(e>9007199254740991)throw nY("Maximum allowed index exceeded");return e},vA=J_,gY=g2,SY=S2,TY=Vs,T2=vt("isConcatSpreadable"),vY=TY>=51||!pY(function(){var e=[];return e[T2]=!1,e.concat()[0]!==e}),yY=function(e){if(!_Y(e))return!1;var t=e[T2];return t!==void 0?!!t:fY(e)};hY({target:"Array",proto:!0,arity:1,forced:!vY||!SY("concat")},{concat:function(e){var t,r,i,n,o,a=mY(this),s=gY(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(yY(o=t===-1?a:arguments[t]))for(n=EY(o),TA(c+n),r=0;r<n;r++,c++)r in o&&vA(s,c,o[r]);else TA(c+1),vA(s,c++,o);return s.length=c,s}});var v2={},RY=po,CY=$a,yA=W_.f,IY=Zy,RA=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];v2.f=function(e){return RA&&RY(e)=="Window"?function(t){try{return yA(t)}catch{return IY(RA)}}(e):yA(CY(e))};var Ul={},wY=vt;Ul.f=wY;var CA=Vn,AY=lr,OY=Ul,bY=_n.f,Jt=function(e){var t=CA.Symbol||(CA.Symbol={});AY(t,e)||bY(t,e,{value:OY.f(e)})},NY=nr,DY=ai,PY=vt,kY=Ja,y2=function(){var e=DY("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,i=PY("toPrimitive");t&&!t[i]&&kY(t,i,function(n){return NY(r,this)},{arity:1})},LY=qa,MY=V_,UY=fo,xY=Ko,VY=g2,IA=Ct([].push),Xo=function(e){var t=e==1,r=e==2,i=e==3,n=e==4,o=e==6,a=e==7,s=e==5||o;return function(c,l,d,u){for(var h,p,g=UY(c),_=MY(g),E=LY(l,d),S=xY(_),T=0,y=u||VY,I=t?y(c,S):r||a?y(c,0):void 0;S>T;T++)if((s||T in _)&&(p=E(h=_[T],T,g),e))if(t)I[T]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return T;case 2:IA(I,h)}else switch(e){case 4:return!1;case 7:IA(I,h)}return o?-1:i||n?n:I}},R2={forEach:Xo(0),map:Xo(1),filter:Xo(2),some:Xo(3),every:Xo(4),find:Xo(5),findIndex:Xo(6),filterReject:Xo(7)},$h=Be,iR=rr,nR=nr,FY=Ct,el=ji,ic=Pl,BY=At,Ar=lr,jY=Dr,WT=$r,Z_=$a,oR=B_,GY=Gi,HT=Ya,wu=oh,C2=K_,WY=W_,I2=v2,HY=nh,w2=eh,A2=_n,KY=By,O2=x_,wA=Ja,zY=Y_,aR=Ll,b2=H_,AA=Dy,YY=vt,$Y=Ul,qY=Jt,XY=y2,JY=Qa,N2=qs,em=R2.forEach,pi=G_("hidden"),qf="Symbol",Au="prototype",QY=N2.set,OA=N2.getterFor(qf),Pn=Object[Au],Uc=iR.Symbol,Zp=Uc&&Uc[Au],ZY=iR.TypeError,VE=iR.QObject,D2=w2.f,us=A2.f,P2=I2.f,e$=O2.f,k2=FY([].push),Wo=aR("symbols"),uh=aR("op-symbols"),t$=aR("wks"),FE=!VE||!VE[Au]||!VE[Au].findChild,KT=el&&BY(function(){return wu(us({},"a",{get:function(){return us(this,"a",{value:7}).a}})).a!=7})?function(e,t,r){var i=D2(Pn,t);i&&delete Pn[t],us(e,t,r),i&&e!==Pn&&us(Pn,t,i)}:us,BE=function(e,t){var r=Wo[e]=wu(Zp);return QY(r,{type:qf,tag:e,description:t}),el||(r.description=t),r},Xf=function(e,t,r){e===Pn&&Xf(uh,t,r),WT(e);var i=oR(t);return WT(r),Ar(Wo,i)?(r.enumerable?(Ar(e,pi)&&e[pi][i]&&(e[pi][i]=!1),r=wu(r,{enumerable:HT(0,!1)})):(Ar(e,pi)||us(e,pi,HT(1,{})),e[pi][i]=!0),KT(e,i,r)):us(e,i,r)},jE=function(e,t){WT(e);var r=Z_(t),i=C2(r).concat(M2(r));return em(i,function(n){el&&!nR(L2,r,n)||Xf(e,n,r[n])}),e},L2=function(e){var t=oR(e),r=nR(e$,this,t);return!(this===Pn&&Ar(Wo,t)&&!Ar(uh,t))&&(!(r||!Ar(this,t)||!Ar(Wo,t)||Ar(this,pi)&&this[pi][t])||r)},bA=function(e,t){var r=Z_(e),i=oR(t);if(r!==Pn||!Ar(Wo,i)||Ar(uh,i)){var n=D2(r,i);return!n||!Ar(Wo,i)||Ar(r,pi)&&r[pi][i]||(n.enumerable=!0),n}},NA=function(e){var t=P2(Z_(e)),r=[];return em(t,function(i){Ar(Wo,i)||Ar(b2,i)||k2(r,i)}),r},M2=function(e){var t=e===Pn,r=P2(t?uh:Z_(e)),i=[];return em(r,function(n){!Ar(Wo,n)||t&&!Ar(Pn,n)||k2(i,Wo[n])}),i};ic||(wA(Zp=(Uc=function(){if(jY(Zp,this))throw ZY("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?GY(arguments[0]):void 0,t=AA(e),r=function(i){this===Pn&&nR(r,uh,i),Ar(this,pi)&&Ar(this[pi],t)&&(this[pi][t]=!1),KT(this,t,HT(1,i))};return el&&FE&&KT(Pn,t,{configurable:!0,set:r}),BE(t,e)})[Au],"toString",function(){return OA(this).tag}),wA(Uc,"withoutSetter",function(e){return BE(AA(e),e)}),O2.f=L2,A2.f=Xf,KY.f=jE,w2.f=bA,WY.f=I2.f=NA,HY.f=M2,$Y.f=function(e){return BE(YY(e),e)},el&&zY(Zp,"description",{configurable:!0,get:function(){return OA(this).description}})),$h({global:!0,constructor:!0,wrap:!0,forced:!ic,sham:!ic},{Symbol:Uc}),em(C2(t$),function(e){qY(e)}),$h({target:qf,stat:!0,forced:!ic},{useSetter:function(){FE=!0},useSimple:function(){FE=!1}}),$h({target:"Object",stat:!0,forced:!ic,sham:!el},{create:function(e,t){return t===void 0?wu(e):jE(wu(e),t)},defineProperty:Xf,defineProperties:jE,getOwnPropertyDescriptor:bA}),$h({target:"Object",stat:!0,forced:!ic},{getOwnPropertyNames:NA}),XY(),JY(Uc,qf),b2[pi]=!0;var U2=Pl&&!!Symbol.for&&!!Symbol.keyFor,r$=Be,i$=ai,n$=lr,o$=Gi,x2=Ll,a$=U2,GE=x2("string-to-symbol-registry"),s$=x2("symbol-to-string-registry");r$({target:"Symbol",stat:!0,forced:!a$},{for:function(e){var t=o$(e);if(n$(GE,t))return GE[t];var r=i$("Symbol")(t);return GE[t]=r,s$[r]=t,r}});var c$=Be,l$=lr,d$=th,u$=kl,h$=U2,DA=Ll("symbol-to-string-registry");c$({target:"Symbol",stat:!0,forced:!h$},{keyFor:function(e){if(!d$(e))throw TypeError(u$(e)+" is not a symbol");if(l$(DA,e))return DA[e]}});var PA=dh,p$=ir,kA=po,f$=Gi,LA=Ct([].push),_$=Be,V2=ai,F2=by,m$=nr,hh=Ct,B2=At,MA=ir,UA=th,j2=Yy,E$=function(e){if(p$(e))return e;if(PA(e)){for(var t=e.length,r=[],i=0;i<t;i++){var n=e[i];typeof n=="string"?LA(r,n):typeof n!="number"&&kA(n)!="Number"&&kA(n)!="String"||LA(r,f$(n))}var o=r.length,a=!0;return function(s,c){if(a)return a=!1,c;if(PA(this))return c;for(var l=0;l<o;l++)if(r[l]===s)return c}}},g$=Pl,S$=String,ka=V2("JSON","stringify"),qh=hh(/./.exec),xA=hh("".charAt),T$=hh("".charCodeAt),v$=hh("".replace),y$=hh(1 .toString),R$=/[\uD800-\uDFFF]/g,VA=/^[\uD800-\uDBFF]$/,FA=/^[\uDC00-\uDFFF]$/,BA=!g$||B2(function(){var e=V2("Symbol")();return ka([e])!="[null]"||ka({a:e})!="{}"||ka(Object(e))!="{}"}),jA=B2(function(){return ka("\uDF06\uD834")!=='"\\udf06\\ud834"'||ka("\uDEAD")!=='"\\udead"'}),C$=function(e,t){var r=j2(arguments),i=E$(t);if(MA(i)||e!==void 0&&!UA(e))return r[1]=function(n,o){if(MA(i)&&(o=m$(i,this,S$(n),o)),!UA(o))return o},F2(ka,null,r)},I$=function(e,t,r){var i=xA(r,t-1),n=xA(r,t+1);return qh(VA,e)&&!qh(FA,n)||qh(FA,e)&&!qh(VA,i)?"\\u"+y$(T$(e,0),16):e};ka&&_$({target:"JSON",stat:!0,arity:3,forced:BA||jA},{stringify:function(e,t,r){var i=j2(arguments),n=F2(BA?C$:ka,null,i);return jA&&typeof n=="string"?v$(n,R$,I$):n}});var GA=nh,w$=fo;Be({target:"Object",stat:!0,forced:!Pl||At(function(){GA.f(1)})},{getOwnPropertySymbols:function(e){var t=GA.f;return t?t(w$(e)):[]}}),Jt("asyncIterator"),Jt("hasInstance"),Jt("isConcatSpreadable"),Jt("iterator"),Jt("match"),Jt("matchAll"),Jt("replace"),Jt("search"),Jt("species"),Jt("split");var A$=y2;Jt("toPrimitive"),A$();var O$=ai,b$=Qa;Jt("toStringTag"),b$(O$("Symbol"),"Symbol"),Jt("unscopables"),Qa(rr.JSON,"JSON",!0);var N$=Vn.Symbol,D$=vt,P$=_n.f,WA=D$("metadata"),HA=Function.prototype;HA[WA]===void 0&&P$(HA,WA,{value:null}),Jt("dispose"),Jt("metadata");var k$=N$;Jt("asyncDispose");var L$=Ct,sR=ai("Symbol"),M$=sR.keyFor,U$=L$(sR.prototype.valueOf),G2=sR.isRegisteredSymbol||function(e){try{return M$(U$(e))!==void 0}catch{return!1}};Be({target:"Symbol",stat:!0},{isRegisteredSymbol:G2});for(KA=Ll,HE=ai,zA=Ct,YA=th,$A=vt,nd=HE("Symbol"),zT=nd.isWellKnownSymbol,YT=HE("Object","getOwnPropertyNames"),W2=zA(nd.prototype.valueOf),$T=KA("wks"),Xh=0,KE=YT(nd),qA=KE.length;Xh<qA;Xh++)try{WE=KE[Xh],YA(nd[WE])&&$A(WE)}catch{}var WE,KA,HE,zA,YA,$A,nd,zT,YT,W2,$T,Xh,KE,qA,XA=function(e){if(zT&&zT(e))return!0;try{for(var t=W2(e),r=0,i=YT($T),n=i.length;r<n;r++)if($T[i[r]]==t)return!0}catch{}return!1};Be({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:XA}),Jt("matcher"),Jt("observable"),Be({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:G2}),Be({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:XA}),Jt("metadataKey"),Jt("patternMatch"),Jt("replaceAll");var xc=_t(k$),H2=_t(Ul.f("iterator"));function Yd(e){return Yd=typeof xc=="function"&&typeof H2=="symbol"?function(t){return typeof t}:function(t){return t&&typeof xc=="function"&&t.constructor===xc&&t!==xc.prototype?"symbol":typeof t},Yd(e)}var x$=_t(Ul.f("toPrimitive"));function V$(e){var t=function(r,i){if(Yd(r)!=="object"||r===null)return r;var n=r[x$];if(n!==void 0){var o=n.call(r,i||"default");if(Yd(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(r)}(e,"string");return Yd(t)==="symbol"?t:String(t)}function v(e,t,r){return(t=V$(t))in e?E2(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var F$=At,B$=vt("iterator"),cR=!F$(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2"),i="";return e.pathname="c%20d",t.forEach(function(n,o){t.delete("b"),i+=o+n}),r.delete("a",2),!e.toJSON||!r.has("a",1)||r.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[B$]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),j$=Ja,zE=Be,_l=rr,Jh=nr,uo=Ct,Vc=ji,JA=cR,QA=Ja,G$=Y_,W$=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:j$(e,i,t[i],r);return e},H$=Qa,K$=Gy,lR=qs,K2=Hy,YE=ir,z$=lr,Y$=qa,$$=_o,q$=$r,z2=Ri,Qr=Gi,X$=oh,ZA=Ya,qT=jy,J$=z_,nc=q_,Q$=c2,Z$=vt("iterator"),Ou="URLSearchParams",Y2=Ou+"Iterator",$2=lR.set,Zi=lR.getterFor(Ou),eq=lR.getterFor(Y2),tq=Object.getOwnPropertyDescriptor,dR=function(e){if(!Vc)return _l[e];var t=tq(_l,e);return t&&t.value},eO=dR("fetch"),Jf=dR("Request"),$d=dR("Headers"),$E=Jf&&Jf.prototype,tO=$d&&$d.prototype,rq=_l.RegExp,iq=_l.TypeError,q2=_l.decodeURIComponent,nq=_l.encodeURIComponent,oq=uo("".charAt),rO=uo([].join),gs=uo([].push),XT=uo("".replace),aq=uo([].shift),iO=uo([].splice),nO=uo("".split),sq=uo("".slice),cq=/\+/g,oO=Array(4),lq=function(e){return oO[e-1]||(oO[e-1]=rq("((?:%[\\da-f]{2}){"+e+"})","gi"))},dq=function(e){try{return q2(e)}catch{return e}},aO=function(e){var t=XT(e,cq," "),r=4;try{return q2(t)}catch{for(;r;)t=XT(t,lq(r--),dq);return t}},uq=/[!'()~]|%20/g,hq={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},pq=function(e){return hq[e]},sO=function(e){return XT(nq(e),uq,pq)},qE=K$(function(e,t){$2(this,{type:Y2,iterator:qT(Zi(e).entries),kind:t})},"Iterator",function(){var e=eq(this),t=e.kind,r=e.iterator.next(),i=r.value;return r.done||(r.value=t==="keys"?i.key:t==="values"?i.value:[i.key,i.value]),r},!0),X2=function(e){this.entries=[],this.url=null,e!==void 0&&(z2(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?oq(e,0)==="?"?sq(e,1):e:Qr(e)))};X2.prototype={type:Ou,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,i,n,o,a,s,c=J$(e);if(c)for(r=(t=qT(e,c)).next;!(i=Jh(r,t)).done;){if(o=(n=qT(q$(i.value))).next,(a=Jh(o,n)).done||(s=Jh(o,n)).done||!Jh(o,n).done)throw iq("Expected sequence with length 2");gs(this.entries,{key:Qr(a.value),value:Qr(s.value)})}else for(var l in e)z$(e,l)&&gs(this.entries,{key:l,value:Qr(e[l])})},parseQuery:function(e){if(e)for(var t,r,i=nO(e,"&"),n=0;n<i.length;)(t=i[n++]).length&&(r=nO(t,"="),gs(this.entries,{key:aO(aq(r)),value:aO(rO(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],i=0;i<t.length;)e=t[i++],gs(r,sO(e.key)+"="+sO(e.value));return rO(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Qf=function(){K2(this,gc);var e=$2(this,new X2(arguments.length>0?arguments[0]:void 0));Vc||(this.size=e.entries.length)},gc=Qf.prototype;W$(gc,{append:function(e,t){var r=Zi(this);nc(arguments.length,2),gs(r.entries,{key:Qr(e),value:Qr(t)}),Vc||this.length++,r.updateURL()},delete:function(e){for(var t=Zi(this),r=nc(arguments.length,1),i=t.entries,n=Qr(e),o=r<2?void 0:arguments[1],a=o===void 0?o:Qr(o),s=0;s<i.length;){var c=i[s];if(c.key!==n||a!==void 0&&c.value!==a)s++;else if(iO(i,s,1),a!==void 0)break}Vc||(this.size=i.length),t.updateURL()},get:function(e){var t=Zi(this).entries;nc(arguments.length,1);for(var r=Qr(e),i=0;i<t.length;i++)if(t[i].key===r)return t[i].value;return null},getAll:function(e){var t=Zi(this).entries;nc(arguments.length,1);for(var r=Qr(e),i=[],n=0;n<t.length;n++)t[n].key===r&&gs(i,t[n].value);return i},has:function(e){for(var t=Zi(this).entries,r=nc(arguments.length,1),i=Qr(e),n=r<2?void 0:arguments[1],o=n===void 0?n:Qr(n),a=0;a<t.length;){var s=t[a++];if(s.key===i&&(o===void 0||s.value===o))return!0}return!1},set:function(e,t){var r=Zi(this);nc(arguments.length,1);for(var i,n=r.entries,o=!1,a=Qr(e),s=Qr(t),c=0;c<n.length;c++)(i=n[c]).key===a&&(o?iO(n,c--,1):(o=!0,i.value=s));o||gs(n,{key:a,value:s}),Vc||(this.size=n.length),r.updateURL()},sort:function(){var e=Zi(this);Q$(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=Zi(this).entries,i=Y$(e,arguments.length>1?arguments[1]:void 0),n=0;n<r.length;)i((t=r[n++]).value,t.key,this)},keys:function(){return new qE(this,"keys")},values:function(){return new qE(this,"values")},entries:function(){return new qE(this,"entries")}},{enumerable:!0}),QA(gc,Z$,gc.entries,{name:"entries"}),QA(gc,"toString",function(){return Zi(this).serialize()},{enumerable:!0}),Vc&&G$(gc,"size",{get:function(){return Zi(this).entries.length},configurable:!0,enumerable:!0}),H$(Qf,Ou),zE({global:!0,constructor:!0,forced:!JA},{URLSearchParams:Qf}),!JA&&YE($d)&&(cO=uo(tO.has),lO=uo(tO.set),XE=function(e){if(z2(e)){var t,r=e.body;if($$(r)===Ou)return t=e.headers?new $d(e.headers):new $d,cO(t,"content-type")||lO(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),X$(e,{body:ZA(0,Qr(r)),headers:ZA(0,t)})}return e},YE(eO)&&zE({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return eO(e,arguments.length>1?XE(arguments[1]):{})}}),YE(Jf)&&(Qh=function(e){return K2(this,$E),new Jf(e,arguments.length>1?XE(arguments[1]):{})},$E.constructor=Qh,Qh.prototype=$E,zE({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Qh})));var cO,lO,XE,Qh,fq={URLSearchParams:Qf,getState:Zi},dO=_t(Vn.URLSearchParams),_q={isBrowser:!0,classes:{URLSearchParams:dO!==void 0?dO:rR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},J2=typeof window<"u"&&typeof document<"u",mq=(uO=typeof navigator<"u"&&navigator.product,J2&&["ReactNative","NativeScript","NS"].indexOf(uO)<0),uO,Eq=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function hO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function pO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hO(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hO(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var io=pO(pO({},Object.freeze({__proto__:null,hasBrowserEnv:J2,hasStandardBrowserEnv:mq,hasStandardBrowserWebWorkerEnv:Eq})),_q),gq=$r,Sq=nr,Tq=lr,vq=Dr,yq=function(){var e=gq(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},fO=RegExp.prototype,Q2=function(e){var t=e.flags;return t!==void 0||"flags"in fO||Tq(e,"flags")||!vq(fO,e)?t:Sq(yq,e)},Rq=Qy.charAt,_O=nr,Cq=$r,Iq=ir,wq=po,Aq=/./.exec,Oq=TypeError,bq=Be,mO=nr,Z2=Cu,Nq=Gy,Zh=Wy,EO=Dl,ex=DM,bu=Gi,Dq=$r,Pq=Nl,kq=po,Lq=PM,tx=Q2,Mq=F_,Uq=At,xq=zy,Vq=function(e,t,r){return t+(r?Rq(e,t).length:1)},Fq=function(e,t){var r=e.exec;if(Iq(r)){var i=_O(r,e,t);return i!==null&&Cq(i),i}if(wq(e)==="RegExp")return _O(Aq,e,t);throw Oq("RegExp#exec called on incompatible receiver")},rx=qs,Bq=vt("matchAll"),ix="RegExp String",nx=ix+" Iterator",jq=rx.set,Gq=rx.getterFor(nx),Wq=TypeError,JT=Z2("".indexOf),Zf=Z2("".matchAll),JE=!!Zf&&!Uq(function(){Zf("a",/./)}),Hq=Nq(function(e,t,r,i){jq(this,{type:nx,regexp:e,string:t,global:r,unicode:i,done:!1})},ix,function(){var e=Gq(this);if(e.done)return Zh(void 0,!0);var t=e.regexp,r=e.string,i=Fq(t,r);return i===null?(e.done=!0,Zh(void 0,!0)):e.global?(bu(i[0])===""&&(t.lastIndex=Vq(r,ex(t.lastIndex),e.unicode)),Zh(i,!1)):(e.done=!0,Zh(i,!1))}),gO=function(e){var t,r,i,n=Dq(this),o=bu(e),a=xq(n,RegExp),s=bu(tx(n));return t=new a(a===RegExp?n.source:n,s),r=!!~JT(s,"g"),i=!!~JT(s,"u"),t.lastIndex=ex(n.lastIndex),new Hq(t,o,r,i)};bq({target:"String",proto:!0,forced:JE},{matchAll:function(e){var t,r,i,n,o=EO(this);if(Pq(e)){if(JE)return Zf(o,e)}else{if(Lq(e)&&(t=bu(EO(tx(e))),!~JT(t,"g")))throw Wq("`.matchAll` does not allow non-global regexes");if(JE)return Zf(o,e);if((i=Mq(e,Bq))===void 0&&kq(e)=="RegExp"&&(i=gO),i)return mO(i,e,o)}return r=bu(o),n=new RegExp(e,"g"),mO(gO,n,r)}});var Kq=mn("String").matchAll,zq=Dr,Yq=Kq,QE=String.prototype,$q=function(e){var t=e.matchAll;return typeof e=="string"||e===QE||zq(QE,e)&&t===QE.matchAll?Yq:t},qq=_t($q);function ox(e){function t(r,i,n,o){let a=r[o++];if(a==="__proto__")return!0;let s=Number.isFinite(+a),c=o>=r.length;return a=!a&&q.isArray(n)?n.length:a,c?(q.hasOwnProp(n,a)?n[a]=[n[a],i]:n[a]=i,!s):(n[a]&&q.isObject(n[a])||(n[a]=[]),t(r,i,n[a],o)&&q.isArray(n[a])&&(n[a]=function(l){let d={},u=Object.keys(l),h,p=u.length,g;for(h=0;h<p;h++)g=u[h],d[g]=l[g];return d}(n[a])),!s)}if(q.isFormData(e)&&q.isFunction(e.entries)){let r={};return q.forEachEntry(e,(i,n)=>{t(function(o){return qq(q).call(q,/\w+|\[(\w*)]/g,o).map(a=>a[0]==="[]"?"":a[1]||a[0])}(i),n,r,0)}),r}return null}var uR={transitional:f2,adapter:["xhr","http"],transformRequest:[function(e,t){let r=t.getContentType()||"",i=r.indexOf("application/json")>-1,n=q.isObject(e);if(n&&q.isHTMLForm(e)&&(e=new FormData(e)),q.isFormData(e))return i?JSON.stringify(ox(e)):e;if(q.isArrayBuffer(e)||q.isBuffer(e)||q.isStream(e)||q.isFile(e)||q.isBlob(e))return e;if(q.isArrayBufferView(e))return e.buffer;if(q.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(n){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(a,s){return $f(a,new io.classes.URLSearchParams,Object.assign({visitor:function(c,l,d,u){return io.isNode&&q.isBuffer(c)?(this.append(l,c.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},s))}(e,this.formSerializer).toString();if((o=q.isFileList(e))||r.indexOf("multipart/form-data")>-1){let a=this.env&&this.env.FormData;return $f(o?{"files[]":e}:e,a&&new a,this.formSerializer)}}return n||i?(t.setContentType("application/json",!1),function(a,s,c){if(q.isString(a))try{return(s||JSON.parse)(a),Sr(q).call(q,a)}catch(l){if(l.name!=="SyntaxError")throw l}return(0,JSON.stringify)(a)}(e)):e}],transformResponse:[function(e){let t=this.transitional||uR.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&q.isString(e)&&(r&&!this.responseType||i)){let n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(n)throw o.name==="SyntaxError"?Je.from(o,Je.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:io.classes.FormData,Blob:io.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};q.forEach(["delete","get","head","post","put","patch"],e=>{uR.headers[e]={}});var hR=uR,Xq=q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),SO=Symbol("internals");function od(e){var t;return e&&Sr(t=String(e)).call(t).toLowerCase()}function ef(e){return e===!1||e==null?e:q.isArray(e)?e.map(ef):String(e)}function ZE(e,t,r,i,n){return q.isFunction(i)?i.call(this,t,r):(n&&(t=r),q.isString(t)?q.isString(i)?t.indexOf(i)!==-1:q.isRegExp(i)?i.test(t):void 0:void 0)}var tf=class{constructor(e){e&&this.set(e)}set(e,t,r){let i=this;function n(s,c,l){let d=od(c);if(!d)throw new Error("header name must be a non-empty string");let u=q.findKey(i,d);(!u||i[u]===void 0||l===!0||l===void 0&&i[u]!==!1)&&(i[u||c]=ef(s))}let o=(s,c)=>q.forEach(s,(l,d)=>n(l,d,c));var a;return q.isPlainObject(e)||e instanceof this.constructor?o(e,t):q.isString(e)&&(e=Sr(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Sr(a=e).call(a))?o((s=>{let c={},l,d,u;return s&&s.split(`
`).forEach(function(h){var p,g;u=h.indexOf(":"),l=Sr(p=h.substring(0,u)).call(p).toLowerCase(),d=Sr(g=h.substring(u+1)).call(g),!l||c[l]&&Xq[l]||(l==="set-cookie"?c[l]?c[l].push(d):c[l]=[d]:c[l]=c[l]?c[l]+", "+d:d)}),c})(e),t):e!=null&&n(t,e,r),this}get(e,t){if(e=od(e)){let r=q.findKey(this,e);if(r){let i=this[r];if(!t)return i;if(t===!0)return function(n){let o=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,s;for(;s=a.exec(n);)o[s[1]]=s[2];return o}(i);if(q.isFunction(t))return t.call(this,i,r);if(q.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=od(e)){let r=q.findKey(this,e);return!(!r||this[r]===void 0||t&&!ZE(0,this[r],r,t))}return!1}delete(e,t){let r=this,i=!1;function n(o){if(o=od(o)){let a=q.findKey(r,o);!a||t&&!ZE(0,r[a],a,t)||(delete r[a],i=!0)}}return q.isArray(e)?e.forEach(n):n(e),i}clear(e){let t=Object.keys(this),r=t.length,i=!1;for(;r--;){let n=t[r];e&&!ZE(0,this[n],n,e,!0)||(delete this[n],i=!0)}return i}normalize(e){let t=this,r={};return q.forEach(this,(i,n)=>{var o;let a=q.findKey(r,n);if(a)return t[a]=ef(i),void delete t[n];let s=e?function(c){return Sr(c).call(c).toLowerCase().replace(/([a-z\d])(\w*)/g,(l,d,u)=>d.toUpperCase()+u)}(n):Sr(o=String(n)).call(o);s!==n&&delete t[n],t[s]=ef(i),r[s]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.constructor.concat(this,...t)}toJSON(e){let t=Object.create(null);return q.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&q.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,r]=e;return t+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let t=new this(e);for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return i.forEach(o=>t.set(o)),t}static accessor(e){let t=(this[SO]=this[SO]={accessors:{}}).accessors,r=this.prototype;function i(n){let o=od(n);t[o]||(function(a,s){let c=q.toCamelCase(" "+s);["get","set","has"].forEach(l=>{Object.defineProperty(a,l+c,{value:function(d,u,h){return this[l].call(this,s,d,u,h)},configurable:!0})})}(r,n),t[o]=!0)}return q.isArray(e)?e.forEach(i):i(e),this}};tf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),q.reduceDescriptors(tf.prototype,(e,t)=>{let{value:r}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(n){this[i]=n}}}),q.freezeMethods(tf);var xo=tf;function eg(e,t){let r=this||hR,i=t||r,n=xo.from(i.headers),o=i.data;return q.forEach(e,function(a){o=a.call(r,o,n.normalize(),t?t.status:void 0)}),n.normalize(),o}function ax(e){return!(!e||!e.__CANCEL__)}function ph(e,t,r){Je.call(this,e??"canceled",Je.ERR_CANCELED,t,r),this.name="CanceledError"}q.inherits(ph,Je,{__CANCEL__:!0});var Jq=io.hasStandardBrowserEnv?{write(e,t,r,i,n,o){let a=[e+"="+encodeURIComponent(t)];q.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),q.isString(i)&&a.push("path="+i),q.isString(n)&&a.push("domain="+n),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function sx(e,t){return e&&!function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}(t)?function(r,i){return i?r.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):r}(e,t):t}var Qq=io.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),r;function i(n){let o=n;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=i(window.location.href),function(n){let o=q.isString(n)?i(n):n;return o.protocol===r.protocol&&o.host===r.host}}():function(){return!0};function TO(e,t){let r=0,i=function(n,o){n=n||10;let a=new Array(n),s=new Array(n),c,l=0,d=0;return o=o!==void 0?o:1e3,function(u){let h=Date.now(),p=s[d];c||(c=h),a[l]=u,s[l]=h;let g=d,_=0;for(;g!==l;)_+=a[g++],g%=n;if(l=(l+1)%n,l===d&&(d=(d+1)%n),h-c<o)return;let E=p&&h-p;return E?Math.round(1e3*_/E):void 0}}(50,250);return n=>{let o=n.loaded,a=n.lengthComputable?n.total:void 0,s=o-r,c=i(s);r=o;let l={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:c||void 0,estimated:c&&a&&o<=a?(a-o)/c:void 0,event:n};l[t?"download":"upload"]=!0,e(l)}}var Zq=typeof XMLHttpRequest<"u"&&function(e){return new K(function(t,r){let i=e.data,n=xo.from(e.headers).normalize(),o,a,{responseType:s,withXSRFToken:c}=e;function l(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}if(q.isFormData(i)){if(io.hasStandardBrowserEnv||io.hasStandardBrowserWebWorkerEnv)n.setContentType(!1);else if((a=n.getContentType())!==!1){let[g,..._]=a?a.split(";").map(E=>Sr(E).call(E)).filter(Boolean):[];n.setContentType([g||"multipart/form-data",..._].join("; "))}}let d=new XMLHttpRequest;if(e.auth){let g=e.auth.username||"",_=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";n.set("Authorization","Basic "+btoa(g+":"+_))}let u=sx(e.baseURL,e.url);function h(){if(!d)return;let g=xo.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders());(function(_,E,S){let T=S.config.validateStatus;S.status&&T&&!T(S.status)?E(new Je("Request failed with status code "+S.status,[Je.ERR_BAD_REQUEST,Je.ERR_BAD_RESPONSE][Math.floor(S.status/100)-4],S.config,S.request,S)):_(S)})(function(_){t(_),l()},function(_){r(_),l()},{data:s&&s!=="text"&&s!=="json"?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:g,config:e,request:d}),d=null}if(d.open(e.method.toUpperCase(),p2(u,e.params,e.paramsSerializer),!0),d.timeout=e.timeout,"onloadend"in d?d.onloadend=h:d.onreadystatechange=function(){d&&d.readyState===4&&(d.status!==0||d.responseURL&&d.responseURL.indexOf("file:")===0)&&setTimeout(h)},d.onabort=function(){d&&(r(new Je("Request aborted",Je.ECONNABORTED,e,d)),d=null)},d.onerror=function(){r(new Je("Network Error",Je.ERR_NETWORK,e,d)),d=null},d.ontimeout=function(){let g=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",_=e.transitional||f2;e.timeoutErrorMessage&&(g=e.timeoutErrorMessage),r(new Je(g,_.clarifyTimeoutError?Je.ETIMEDOUT:Je.ECONNABORTED,e,d)),d=null},io.hasStandardBrowserEnv&&(c&&q.isFunction(c)&&(c=c(e)),c||c!==!1&&Qq(u))){let g=e.xsrfHeaderName&&e.xsrfCookieName&&Jq.read(e.xsrfCookieName);g&&n.set(e.xsrfHeaderName,g)}i===void 0&&n.setContentType(null),"setRequestHeader"in d&&q.forEach(n.toJSON(),function(g,_){d.setRequestHeader(_,g)}),q.isUndefined(e.withCredentials)||(d.withCredentials=!!e.withCredentials),s&&s!=="json"&&(d.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&d.addEventListener("progress",TO(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",TO(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=g=>{d&&(r(!g||g.type?new ph(null,e,d):g),d.abort(),d=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));let p=function(g){let _=/^([-+\w]{1,25})(:?\/\/|:)/.exec(g);return _&&_[1]||""}(u);p&&io.protocols.indexOf(p)===-1?r(new Je("Unsupported protocol "+p+":",Je.ERR_BAD_REQUEST,e)):d.send(i||null)})},QT={http:null,xhr:Zq};q.forEach(QT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});var vO=e=>"- ".concat(e),e9=e=>q.isFunction(e)||e===null||e===!1,cx={getAdapter:e=>{e=q.isArray(e)?e:[e];let{length:t}=e,r,i,n={};for(let o=0;o<t;o++){let a;if(r=e[o],i=r,!e9(r)&&(i=QT[(a=String(r)).toLowerCase()],i===void 0))throw new Je("Unknown adapter '".concat(a,"'"));if(i)break;n[a||"#"+o]=i}if(!i){let o=Object.entries(n).map(a=>{let[s,c]=a;return"adapter ".concat(s," ")+(c===!1?"is not supported by the environment":"is not available in the build")});throw new Je("There is no suitable adapter to dispatch the request "+(t?o.length>1?`since :
`+o.map(vO).join(`
`):" "+vO(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:QT};function tg(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ph(null,e)}function yO(e){return tg(e),e.headers=xo.from(e.headers),e.data=eg.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),cx.getAdapter(e.adapter||hR.adapter)(e).then(function(t){return tg(e),t.data=eg.call(e,e.transformResponse,t),t.headers=xo.from(t.headers),t},function(t){return ax(t)||(tg(e),t&&t.response&&(t.response.data=eg.call(e,e.transformResponse,t.response),t.response.headers=xo.from(t.response.headers))),K.reject(t)})}function RO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}var CO=e=>e instanceof xo?function(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?RO(Object(i),!0).forEach(function(n){v(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):RO(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}({},e):e;function ml(e,t){t=t||{};let r={};function i(l,d,u){return q.isPlainObject(l)&&q.isPlainObject(d)?q.merge.call({caseless:u},l,d):q.isPlainObject(d)?q.merge({},d):q.isArray(d)?d.slice():d}function n(l,d,u){return q.isUndefined(d)?q.isUndefined(l)?void 0:i(void 0,l,u):i(l,d,u)}function o(l,d){if(!q.isUndefined(d))return i(void 0,d)}function a(l,d){return q.isUndefined(d)?q.isUndefined(l)?void 0:i(void 0,l):i(void 0,d)}function s(l,d,u){return u in t?i(l,d):u in e?i(void 0,l):void 0}let c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(l,d)=>n(CO(l),CO(d),!0)};return q.forEach(Object.keys(Object.assign({},e,t)),function(l){let d=c[l]||n,u=d(e[l],t[l],l);q.isUndefined(u)&&d!==s||(r[l]=u)}),r}var lx="1.6.8",pR={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{pR[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});var IO={};pR.transitional=function(e,t,r){function i(n,o){return"[Axios v"+lx+"] Transitional option '"+n+"'"+o+(r?". "+r:"")}return(n,o,a)=>{if(e===!1)throw new Je(i(o," has been removed"+(t?" in "+t:"")),Je.ERR_DEPRECATED);return t&&!IO[o]&&(IO[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,a)}};var ZT={assertOptions:function(e,t,r){if(typeof e!="object")throw new Je("options must be an object",Je.ERR_BAD_OPTION_VALUE);let i=Object.keys(e),n=i.length;for(;n-- >0;){let o=i[n],a=t[o];if(a){let s=e[o],c=s===void 0||a(s,o,e);if(c!==!0)throw new Je("option "+o+" must be "+c,Je.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new Je("Unknown option "+o,Je.ERR_BAD_OPTION)}},validators:pR},Jo=ZT.validators,rf=class{constructor(e){this.defaults=e,this.interceptors={request:new mA,response:new mA}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;let n=i.stack?i.stack.replace(/^.+\n/,""):"";r.stack?n&&!String(r.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+n):r.stack=n}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=ml(this.defaults,t);let{transitional:r,paramsSerializer:i,headers:n}=t;r!==void 0&&ZT.assertOptions(r,{silentJSONParsing:Jo.transitional(Jo.boolean),forcedJSONParsing:Jo.transitional(Jo.boolean),clarifyTimeoutError:Jo.transitional(Jo.boolean)},!1),i!=null&&(q.isFunction(i)?t.paramsSerializer={serialize:i}:ZT.assertOptions(i,{encode:Jo.function,serialize:Jo.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=n&&q.merge(n.common,n[t.method]);n&&q.forEach(["delete","get","head","post","put","patch","common"],p=>{delete n[p]}),t.headers=xo.concat(o,n);let a=[],s=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(s=s&&p.synchronous,a.unshift(p.fulfilled,p.rejected))});let c=[],l;this.interceptors.response.forEach(function(p){c.push(p.fulfilled,p.rejected)});let d,u=0;if(!s){let p=[yO.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,c),d=p.length,l=K.resolve(t);u<d;)l=l.then(p[u++],p[u++]);return l}d=a.length;let h=t;for(u=0;u<d;){let p=a[u++],g=a[u++];try{h=p(h)}catch(_){g.call(this,_);break}}try{l=yO.call(this,h)}catch(p){return K.reject(p)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return p2(sx((e=ml(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};q.forEach(["delete","get","head","options"],function(e){rf.prototype[e]=function(t,r){return this.request(ml(r||{},{method:e,url:t,data:(r||{}).data}))}}),q.forEach(["post","put","patch"],function(e){function t(r){return function(i,n,o){return this.request(ml(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}rf.prototype[e]=t(),rf.prototype[e+"Form"]=t(!0)});var nf=rf,t9=class dx{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new K(function(n){r=n});let i=this;this.promise.then(n=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](n);i._listeners=null}),this.promise.then=n=>{let o,a=new K(s=>{i.subscribe(s),o=s}).then(n);return a.cancel=function(){i.unsubscribe(o)},a},t(function(n,o,a){i.reason||(i.reason=new ph(n,o,a),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}static source(){let t;return{token:new dx(function(r){t=r}),cancel:t}}},r9=t9,ev={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ev).forEach(e=>{let[t,r]=e;ev[r]=t});var i9=ev,dr=function e(t){let r=new nf(t),i=d2(nf.prototype.request,r);return q.extend(i,nf.prototype,r,{allOwnKeys:!0}),q.extend(i,r,null,{allOwnKeys:!0}),i.create=function(n){return e(ml(t,n))},i}(hR);dr.Axios=nf,dr.CanceledError=ph,dr.CancelToken=r9,dr.isCancel=ax,dr.VERSION=lx,dr.toFormData=$f,dr.AxiosError=Je,dr.Cancel=dr.CanceledError,dr.all=function(e){return K.all(e)},dr.spread=function(e){return function(t){return e.apply(null,t)}},dr.isAxiosError=function(e){return q.isObject(e)&&e.isAxiosError===!0},dr.mergeConfig=ml,dr.AxiosHeaders=xo,dr.formToJSON=e=>ox(q.isHTMLForm(e)?new FormData(e):e),dr.getAdapter=cx.getAdapter,dr.HttpStatusCode=i9,dr.default=dr;var Vr=dr,n9=()=>{};function Nu(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:n9};return e.promise=new K((t,r)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(i))}}),e}var ep=new Map,tp=new Map,Wn=new Map,Lt=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ne=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),ux=new Pz,Nn=ux.getResult(),rg=null;function ve(e){if(!rg){Nn=ux.getResult();let t=function(s){if(s.engine.name==="Blink"&&s.browser.name!=="WeChat")return Ne.CHROME;switch(s.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ne.CHROME;case"Safari":case"Mobile Safari":return Ne.SAFARI;case"Edge":return Ne.EDGE;case"Firefox":return Ne.FIREFOX;case"QQ":case"QQBrowser":return Ne.QQ;case"Opera":return Ne.OPERA;case"WeChat":return Ne.WECHAT;default:return s.browser.name||""}}(Nn),r=wO(Nn),i=function(s){return s.os.name==="Windows"?s.os.version?s.os.name+" "+s.os.version:s.os.name:s.os.name||""}(Nn),n=Nn.os.version,o=wO(Nn,!1),a=Nn.device.type;if(!(t&&r&&i&&n))return{name:t,version:r,os:i,osVersion:n,browserVersion:o,deviceType:a};rg={name:t,version:r,os:i,osVersion:n,browserVersion:o,deviceType:a}}return rg}function wO(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function tm(){return ve().os}function AO(){let e=ve();return"".concat(e.os," ").concat(e.osVersion)}function e_(){let e=ve();return!!(Nn.engine.name==="WebKit"&&e.os===Lt.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ne.SAFARI||Or()&&e.name!==Ne.SAFARI)}function La(){return ve().name===Ne.CHROME}function er(){return ve().name===Ne.SAFARI}function hx(){return ve().name===Ne.EDGE}function ot(){return ve().name===Ne.FIREFOX}function Or(){return ve().os===Lt.IOS}function tv(e){let t=ve();return!(t.name!==Ne.CHROME||!t.osVersion)&&Number(t.version)>=e}function px(e){let t=ve();return!(t.name!==Ne.CHROME||!t.osVersion)&&Number(t.version)<e}function OO(e){let t=ve();return!(t.name!==Ne.EDGE||!t.osVersion)&&Number(t.version)>=e}function fx(e){let t=ve();return!(t.name!==Ne.SAFARI||!t.osVersion)&&Number(t.version)>=e}function _x(e,t,r){let i=ve();if(i.os!==Lt.IOS||!i.osVersion)return!1;let n=i.osVersion.split(".");return t&&Number(n[0])===e&&Number(n[1])<t||Number(n[0])<e}function mx(e,t,r){let i=ve();if(i.name!==Ne.SAFARI||!i.osVersion||!i.browserVersion)return!1;let n=i.browserVersion.split(".");return t&&Number(n[0])===e&&Number(n[1])<t||Number(n[0])<e}function bO(e){let t=ve();return!(t.name!==Ne.OPERA||!t.osVersion)&&Number(t.version)>=e}function NO(){let e=ve();if(e.os!==Lt.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function El(){let e=ve();if(e.os!==Lt.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function rv(){let e=ve();if(e.os!==Lt.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function DO(){let e=ve();if(e.os!==Lt.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function un(){return er()&&navigator.maxTouchPoints>0}function Ex(){return ve().name===Ne.WECHAT}function gx(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function fR(){let e=tm();return function(){let{deviceType:t}=ve();return t==="mobile"||t==="tablet"}()||e===Lt.ANDROID||e===Lt.IOS||e===Lt.HARMONY_OS}function Ga(){let e=ve();return e.name!==Ne.EDGE&&e.name!==Ne.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function rm(){return tm()===Lt.ANDROID}function Du(){let e=ve();return rm()&&(e.name===Ne.CHROME||e.name===Ne.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function ze(e,t,r){return(t=function(i){var n=function(o,a){if(typeof o!="object"||!o)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var c=s.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof n=="symbol"?n:n+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PO(Object(r),!0).forEach(function(i){ze(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PO(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var R=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),M=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),ze(this,"code",void 0),ze(this,"message",void 0),ze(this,"data",void 0),ze(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Po(e,t){if(typeof e!="boolean")throw new M(R.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Ot(e,t,r){if(!Y(r).call(r,e))throw new M(R.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Me(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(n){return typeof n=="number"&&n%1==0}(e))throw new M(R.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(i,"]. integer only"))}function ig(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new M(R.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Me(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Me(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Me(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Me(e.ideal,"".concat(t,".ideal"),1,1/0)}else Me(e,t,1,1/0)}function jt(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,n=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new M(R.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Sx(e,r,i,n))throw new M(R.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(i,"].").concat(n?" ASCII characters only.":""))}function Oo(e,t){if(!Array.isArray(e))throw new M(R.INVALID_PARAMS,"".concat(t," should be an array"))}function Qe(e){return e==null}function Sx(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!i||function(n){if(typeof n!="string")return!1;for(let o=0;o<n.length;o+=1){let a=n.charCodeAt(o);if(a<0||a>255)return!1}return!0}(e))}var Cd=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Cd||{}),iv=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(iv||{}),Tx=new class{constructor(){ze(this,"_clientSize",null),ze(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),ze(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),ze(this,"getStyle",e=>window.getComputedStyle(e,null)),ze(this,"checkCssVisibleProperty",e=>{var t;let r=!0,i=this.getStyle(e),{display:n,visibility:o,opacity:a,filter:s}=i;return(n==="none"||Y(t=["hidden","collapse"]).call(t,o)||Number(a)<.1)&&(r=!1),!!r&&(s&&s.split(" ").filter(c=>{var l;let d=c.split("(")[0];return Y(l=["brightness","blur","opacity"]).call(l,d)}).map(c=>{let[l,d]=c.split(/\(|\)/);return[l,Number(d.match(/^[0-9\.]+/))]}).forEach(c=>{let[l,d]=c;switch(l){case"brightness":(d<.1||d>3)&&(r=!1);break;case"blur":d>3&&(r=!1);break;case"opacity":d<.1&&(r=!1)}}),r)}),ze(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,i=!0,n=a=>t(a),o=e;for(;o&&i;)n(o)||(r=!1,i=!1),o=o.parentElement,o||(i=!1);return r}),ze(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),ze(this,"getSizeAboutClient",e=>{let{width:t,height:r,left:i,right:n,top:o,bottom:a}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:r,left:i,right:n,top:o,bottom:a,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}}),ze(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),ze(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),ze(this,"checkCoverForAPoint",(e,t,r)=>{let i=this.elementFromPoint(e,t);return i!==null&&i!==r}),ze(this,"getPointPositionList",()=>{let{width:e,height:t,left:r,top:i}=this._clientSize,n=e/6,o=t/6,a=[],s=10**6;for(let c=0;c<5;c++)for(let l=0;l<5;l++){let d=(r*s+(c===0?.1:c===4?(n*c*s-1e5)/s:n*c)*s)/s,u=(i*s+(l===0?.1:l===4?(o*l*s-1e5)/s:o*l)*s)/s;a.push({x:d,y:u})}return[...a]}),ze(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),ze(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),ze(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:r,bottom:i,clientHeight:n,clientWidth:o,clientMin:a}=this._clientSize,s,c,l,d;if(e<0)s=0;else{if(!(e<o))return!1;s=e}if(t<0)return!1;if(c=t<o?t:o,r<0)l=0;else{if(!(r<n))return!1;l=r}if(i<0)return!1;d=i<n?i:n;let u=c-s,h=d-l;return this.checkSizeIsVisible(u,h,a)}),ze(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),ze(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Cd.COVERED);{let t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(Cd.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Cd.SIZE)}}return this.returnHiddenResult(Cd.STYLE)}return this.returnHiddenResult(iv.UNMOUNTED)}return this.returnHiddenResult(iv.INVALID_HTML_ELEMENT)}),ze(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function _R(e){return new TextEncoder().encode(e)}var kO=function(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},nv=async e=>function(t,r){let i="";return new Uint8Array(t).forEach(n=>{i+=n.toString(r).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",_R(e)),16),tt=class{constructor(){ze(this,"_events",{}),ze(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],i=this._indexOfListener(r,t);i!==-1&&r.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(o=>o);for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(let o=0;o<t.length;o+=1){let a=t[o];a.once&&this.off(e,a.listener),a.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];[...this._events[e]||[]].forEach(n=>{n.once&&this.off(e,n.listener);try{n.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(e," error ").concat(o==null?void 0:o.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},ad=null;function vx(){if(ad)return ad;if(window.electron)return ad=window.electron;if(!window.require)return null;try{return ad=window.require("electron"),ad}catch{return null}}var wt=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),nt=function(e){return e.TRACER="tracer",e}({});function LO(e){return Me(e.timeout,"config.timeout",0,1e5),Me(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Me(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Me(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}var o9=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Pe=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function im(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function yx(e){return jt(e.turnServerURL,"turnServerURL"),jt(e.username,"username"),jt(e.password,"password"),e.udpport&&Me(e.udpport,"udpport",1,99999,!0),e.forceturn&&Po(e.forceturn,"forceturn"),e.security&&Po(e.security,"security"),e.tcpport&&Me(e.tcpport,"tcpport",1,99999,!0),!0}function MO(e){return e.level!==void 0&&Ot(e.level,"level",[1,2,3]),e.delay!==void 0&&Me(e.delay,"delay",0,3e3,!0),!0}var me=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Zt=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),ei=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Fc=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function tr(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return e.getListeners(t).length===0?K.reject(new M(R.UNEXPECTED_ERROR,"can not emit promise")):new K((o,a)=>{e.emit(t,...i,o,a)})}function xe(e,t){if(e.getListeners(t).length===0)return K.resolve();for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return tr(e,t,...i)}function Mi(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return Pu(e,t,...i)}function Pu(e,t){let r=null,i=null;for(var n=arguments.length,o=new Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];if(e.emit(t,...o,s=>{r=s},s=>{i=s}),i!==null)throw i;if(r===null)throw new M(R.UNEXPECTED_ERROR,"handler is not sync");return r}var St=new class extends tt{set networkState(e){this.emit(Fc.NETWORK_STATE_CHANGE,e,this._networkState),e===ei.ONLINE?this.emit(Fc.ONLINE):e===ei.OFFLINE&&(this.onlineWaiter=new K(t=>{this.once(Fc.ONLINE,()=>{this.onlineWaiter=void 0,t(ei.ONLINE)})}),this.emit(Fc.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ei.ONLINE}constructor(){super(),ze(this,"_moduleName","network-indicator"),ze(this,"_networkState",ei.ONLINE),ze(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ei.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ei.OFFLINE})}};function t_(e,t){let r=e.indexOf(t);r!==-1&&e.splice(r,1)}function Bc(e){let t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function nm(e){K!==void 0?K.resolve().then(e):setTimeout(e,0)}function Et(e){return JSON.parse(JSON.stringify(e))}function Ss(e){try{return Et(e)}catch{return e}}var UO={};function Wa(e,t){UO[t]||(UO[t]=!0,e())}function Ts(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)r[i]=t.charCodeAt(i);return r}function Ma(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function Rx(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){let i=new Uint8Array(t);i.set(r),r=i}return r}function xO(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=xn(t).call(t,(a,s)=>a+s.length,0),n=new Uint8Array(new ArrayBuffer(i)),o=0;return t.forEach(a=>{n.set(a,o),o+=a.length}),n}function no(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function Cx(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?no(r):r.size}),t+138}function a9(e){let t=new M(R.TIMEOUT,"timeout");return new K((r,i)=>{window.setTimeout(()=>i(t),e)})}function zt(e){return new K(t=>{window.setTimeout(t,e)})}function Fe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+Fe(e-r.length,"")}function jc(){return Fe(32,"").toUpperCase()}var om=()=>{},VO=new class{constructor(){ze(this,"fnMap",new Map)}throttleByKey(e,t,r,i){for(var n=arguments.length,o=new Array(n>4?n-4:0),a=4;a<n;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){let s=this.fnMap.get(t);if(s.threshold!==r){s.fn(...s.args),clearTimeout(s.timer);let c=window.setTimeout(()=>{let l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:c,args:o,skipFn:i})}else s.skipFn&&s.skipFn(...s.args),this.fnMap.set(t,J(J({},s),{},{fn:e,args:o,skipFn:i}))}else{let s=window.setTimeout(()=>{let c=this.fnMap.get(t);c&&c.fn(...c.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:s,args:o,skipFn:i})}}},FO=VO.throttleByKey.bind(VO);function BO(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function ov(e,t){if(!BO(e)||!BO(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let r=[...e];for(let i=0;i<t.length;i++)r[i]=ov(e[i],t[i]);return r}{let r=J({},e);for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?r[i]=ov(e[i],t[i]):r[i]=t[i]);return r}}function jO(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let i=0;for(;e>0&&(r[i]=255&e,e>>=8,i++,i!==t););return r}function ng(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Ix(e){let t="0123456789abcdef";function r(y){let I,O="";for(I=0;I<=3;I++)O+=t.charAt(y>>8*I+4&15)+t.charAt(y>>8*I&15);return O}function i(y,I){let O=(65535&y)+(65535&I);return(y>>16)+(I>>16)+(O>>16)<<16|65535&O}function n(y,I,O,b,k,P){return i(function(j,G){return j<<G|j>>>32-G}(i(i(I,y),i(b,P)),k),O)}function o(y,I,O,b,k,P,j){return n(I&O|~I&b,y,I,k,P,j)}function a(y,I,O,b,k,P,j){return n(I&b|O&~b,y,I,k,P,j)}function s(y,I,O,b,k,P,j){return n(I^O^b,y,I,k,P,j)}function c(y,I,O,b,k,P,j){return n(O^(I|~b),y,I,k,P,j)}let l=function(y){let I,O=1+(y.length+8>>6),b=new Array(16*O);for(I=0;I<16*O;I++)b[I]=0;for(I=0;I<y.length;I++)b[I>>2]|=y.charCodeAt(I)<<I%4*8;return b[I>>2]|=128<<I%4*8,b[16*O-2]=8*y.length,b}(e),d,u,h,p,g,_=1732584193,E=-271733879,S=-1732584194,T=271733878;for(d=0;d<l.length;d+=16)u=_,h=E,p=S,g=T,_=o(_,E,S,T,l[d+0],7,-680876936),T=o(T,_,E,S,l[d+1],12,-389564586),S=o(S,T,_,E,l[d+2],17,606105819),E=o(E,S,T,_,l[d+3],22,-1044525330),_=o(_,E,S,T,l[d+4],7,-176418897),T=o(T,_,E,S,l[d+5],12,1200080426),S=o(S,T,_,E,l[d+6],17,-1473231341),E=o(E,S,T,_,l[d+7],22,-45705983),_=o(_,E,S,T,l[d+8],7,1770035416),T=o(T,_,E,S,l[d+9],12,-1958414417),S=o(S,T,_,E,l[d+10],17,-42063),E=o(E,S,T,_,l[d+11],22,-1990404162),_=o(_,E,S,T,l[d+12],7,1804603682),T=o(T,_,E,S,l[d+13],12,-40341101),S=o(S,T,_,E,l[d+14],17,-1502002290),E=o(E,S,T,_,l[d+15],22,1236535329),_=a(_,E,S,T,l[d+1],5,-165796510),T=a(T,_,E,S,l[d+6],9,-1069501632),S=a(S,T,_,E,l[d+11],14,643717713),E=a(E,S,T,_,l[d+0],20,-373897302),_=a(_,E,S,T,l[d+5],5,-701558691),T=a(T,_,E,S,l[d+10],9,38016083),S=a(S,T,_,E,l[d+15],14,-660478335),E=a(E,S,T,_,l[d+4],20,-405537848),_=a(_,E,S,T,l[d+9],5,568446438),T=a(T,_,E,S,l[d+14],9,-1019803690),S=a(S,T,_,E,l[d+3],14,-187363961),E=a(E,S,T,_,l[d+8],20,1163531501),_=a(_,E,S,T,l[d+13],5,-1444681467),T=a(T,_,E,S,l[d+2],9,-51403784),S=a(S,T,_,E,l[d+7],14,1735328473),E=a(E,S,T,_,l[d+12],20,-1926607734),_=s(_,E,S,T,l[d+5],4,-378558),T=s(T,_,E,S,l[d+8],11,-2022574463),S=s(S,T,_,E,l[d+11],16,1839030562),E=s(E,S,T,_,l[d+14],23,-35309556),_=s(_,E,S,T,l[d+1],4,-1530992060),T=s(T,_,E,S,l[d+4],11,1272893353),S=s(S,T,_,E,l[d+7],16,-155497632),E=s(E,S,T,_,l[d+10],23,-1094730640),_=s(_,E,S,T,l[d+13],4,681279174),T=s(T,_,E,S,l[d+0],11,-358537222),S=s(S,T,_,E,l[d+3],16,-722521979),E=s(E,S,T,_,l[d+6],23,76029189),_=s(_,E,S,T,l[d+9],4,-640364487),T=s(T,_,E,S,l[d+12],11,-421815835),S=s(S,T,_,E,l[d+15],16,530742520),E=s(E,S,T,_,l[d+2],23,-995338651),_=c(_,E,S,T,l[d+0],6,-198630844),T=c(T,_,E,S,l[d+7],10,1126891415),S=c(S,T,_,E,l[d+14],15,-1416354905),E=c(E,S,T,_,l[d+5],21,-57434055),_=c(_,E,S,T,l[d+12],6,1700485571),T=c(T,_,E,S,l[d+3],10,-1894986606),S=c(S,T,_,E,l[d+10],15,-1051523),E=c(E,S,T,_,l[d+1],21,-2054922799),_=c(_,E,S,T,l[d+8],6,1873313359),T=c(T,_,E,S,l[d+15],10,-30611744),S=c(S,T,_,E,l[d+6],15,-1560198380),E=c(E,S,T,_,l[d+13],21,1309151649),_=c(_,E,S,T,l[d+4],6,-145523070),T=c(T,_,E,S,l[d+11],10,-1120210379),S=c(S,T,_,E,l[d+2],15,718787259),E=c(E,S,T,_,l[d+9],21,-343485551),_=i(_,u),E=i(E,h),S=i(S,p),T=i(T,g);return r(_)+r(E)+r(S)+r(T)}var s9=1,rp=console,cr=class{static setLogger(e){rp=e}constructor(e){ze(this,"lockingPromise",K.resolve()),ze(this,"locks",0),ze(this,"name",""),ze(this,"lockId",void 0),this.lockId=s9++,e&&(this.name=e),rp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,rp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));let r=new K(n=>{t=()=>{this.locks-=1,rp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),n()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),i}};function gl(e,t){return function(r,i,n){let o=n.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let a=this[t];if(!a)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let s=await a.lock("From ".concat(e,".").concat(i));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await o.apply(this,l)}finally{s()}},n}}var Rt={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function mR(e,t){let r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function Fn(e,t,r,i){let n=Object.assign({},Rt,i),o=n.timeout,a=async()=>{await function(l){return new K(d=>{window.setTimeout(d,l)})}(o),o*=n.timeoutFactor,o=Math.min(n.maxRetryTimeout,o)},s=!1,c=new K(async(l,d)=>{t=t||(()=>!1),r=r||(()=>!0);for(let u=0;u<n.maxRetryCount;u+=1){if(s)return d(new M(R.OPERATION_ABORTED));try{let h=await e();if(!t(h,u)||u+1===n.maxRetryCount)return l(h);await a()}catch(h){if(!r(h,u)||u+1===n.maxRetryCount)return d(h);await a()}}});return c.cancel=()=>s=!0,c}var wx=class{constructor(e){ze(this,"input",[]),ze(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:xn(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},ip,np=0,og=0;function av(e,t,r,i){return new K((n,o)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),np+=no(t.data)):r&&(t.data.size?np+=t.data.size:t.data instanceof FormData?np+=Cx(t.data):np+=no(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Vr.request(t).then(a=>{typeof a.data=="string"?og+=no(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?og+=a.data.byteLength:og+=no(JSON.stringify(a.data)),n(a.data)}).catch(a=>{Vr.isCancel(a)?o(new M(R.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?o(new M(R.NETWORK_TIMEOUT,a.message)):a.response?o(new M(R.NETWORK_RESPONSE_ERROR,a.response.status)):o(new M(R.NETWORK_ERROR,a.message))})})}async function c9(e,t){let r=new Blob([t.data],{type:"buffer"});return await av(e,J(J({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}var GO=()=>window.isSecureContext!==void 0,Ui=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){let i=t[1],n=t[2];return"".concat(i,".").concat(n)}let r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){let i=r[1],n=r[2];return"".concat(i,".").concat(100*(Number(n)+1))}return"4.0.0.999"}("4.22.0"),ER=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),ss=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),gR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},SR="v4.22.0-0-g8569241d-dirty(8/15/2024, 7:04:06 PM)",pt=J(J({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:gR,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1});function Le(e,t,r){var i,n,o;Y(i=Object.keys(pt)).call(i,e)&&(!r&&Y(n=Object.keys(Sa)).call(n,e)||(pt[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(pt.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(o=!!t,pt.USE_NEW_NETWORK_CONFIG=o,o&&(pt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],pt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],pt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],pt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],pt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",pt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",pt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(pt.ENABLE_INSTANT_VIDEO=!0,pt.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(pt.ENABLE_AUT_CC=!0)))}function w(e){return pt[e]}var Sa={},fe=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(fe||{}),l9=class{constructor(e,t,r,i){ze(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ss.Default}}dispatch(e){this.state=function(t,r){switch(r.type){case fe.SET_SESSION_ID:return J(J({},t),{},{sessionId:r.sessionId});case fe.SET_P2P_ID:return J(J({},t),{},{p2pId:r.p2pId});case fe.SET_UID:return J(J({},t),{},{uid:r.uid});case fe.SET_INT_UID:return J(J({},t),{},{intUid:r.intUid});case fe.SET_PUB_ID:return J(J({},t),{},{pubId:r.pubId});case fe.KEY_METRIC_CLIENT_CREATED:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{clientCreated:r.metric})});case fe.KEY_METRIC_JOIN_START:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{joinStart:r.metric})});case fe.AVOID_JOIN_START:return J(J({},t),{},{avoidJoinStart:r.avoidJoinStart});case fe.KEY_METRIC_JOIN_END:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{joinEnd:r.metric})});case fe.KEY_METRIC_REQUEST_AP_START:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{requestAPStart:r.metric})});case fe.KEY_METRIC_REQUEST_AP_END:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{requestAPEnd:r.metric})});case fe.KEY_METRIC_JOIN_GATEWAY_START:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{joinGatewayStart:r.metric})});case fe.KEY_METRIC_JOIN_GATEWAY_END:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{joinGatewayEnd:r.metric})});case fe.KEY_METRIC_PEER_CONNECTION_START:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{peerConnectionStart:r.metric})});case fe.KEY_METRIC_PEER_CONNECTION_END:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{peerConnectionEnd:r.metric})});case fe.KEY_METRIC_DESCRIPTION_START:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{descriptionStart:r.metric})});case fe.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{signalChannelOpen:r.metric})});case fe.KEY_METRIC_ICE_CONNECTION_END:return J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{iceConnectionEnd:r.metric})});case fe.KEY_METRIC_PUBLISH:{let i=t.keyMetrics.publish,n=i.findIndex(o=>o.trackId===r.metric.trackId);return n!==-1?(i[n]=J(J({},i[n]),r.metric),J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{publish:[...i]})})):J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{publish:[...t.keyMetrics.publish,r.metric]})})}case fe.KEY_METRIC_SUBSCRIBE:{let i=t.keyMetrics.subscribe,n=i.findIndex(o=>o.userId===r.metric.userId&&o.type===r.metric.type);return n!==-1?(i[n]=J(J({},i[n]),r.metric),J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{subscribe:[...i]})})):J(J({},t),{},{keyMetrics:J(J({},t.keyMetrics),{},{subscribe:[...t.keyMetrics.subscribe,r.metric]})})}case fe.SET_CLOUD_PROXY_SERVER_MODE:return t.cloudProxyServerMode=r.mode,t;case fe.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?t.joinChannelServiceRecords=[...t.joinChannelServiceRecords,r.record]:(t.joinChannelServiceRecords[r.index]=J(J({},t.joinChannelServiceRecords[r.index]),r.record),t.joinChannelServiceRecords=[...t.joinChannelServiceRecords]),t;case fe.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t.joinChannelServiceRecords=[],t;case fe.RESET_KEY_METRICS:return t.keyMetrics={publish:[],subscribe:[]},t;case fe.SET_USE_P2P:return J(J({},t),{},{useP2P:r.val});case fe.SET_TRANSPORT_TYPE:return J(J({},t),{},{p2pTransport:r.val});default:return t}}(this.state,e)}set sessionId(e){this.dispatch({type:fe.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:fe.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:fe.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:fe.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:fe.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:fe.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:fe.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:fe.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:fe.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:fe.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:fe.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:fe.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:fe.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:fe.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:fe.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:fe.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:fe.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:fe.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:fe.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:fe.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:fe.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,r,i){this.dispatch({type:fe.KEY_METRIC_PUBLISH,metric:J(J({trackId:e,type:t},r&&{publishStart:r}),i&&{publishEnd:i})})}subscribe(e,t,r,i,n,o,a){this.dispatch({type:fe.KEY_METRIC_SUBSCRIBE,metric:J(J(J(J(J({userId:e,type:t},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),n&&{firstFrame:n}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,t,r,i){e.forEach(n=>{this.dispatch({type:fe.KEY_METRIC_SUBSCRIBE,metric:J(J(J({userId:n.userId,type:n.type},t&&{subscribeStart:t}),r&&{subscribeEnd:r}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof t!="number"?(this.dispatch({type:fe.RECORD_JOIN_CHANNEL_SERVICE,record:J(J({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:fe.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:fe.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:fe.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:fe.AVOID_JOIN_START,avoidJoinStart:e})}},am=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});var WO=128,d9=96,HO=1e3,oc=10,u9=0;function ht(e,t,r){return(t=function(i){var n=function(o,a){if(typeof o!="object"||!o)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var c=s.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof n=="symbol"?n:n+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KO(Object(r),!0).forEach(function(i){ht(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KO(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Ax=new class extends tt{constructor(){super(...arguments),ht(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}},h9=class{constructor(e){ht(this,"logger",void 0),ht(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}};function ag(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function zO(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var Oi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},op=Date.now(),sd=e=>{for(let t in Oi)if(Object.prototype.hasOwnProperty.call(Oi,t)&&Oi[t]===e)return t;return"DEFAULT"},f=new class{constructor(){ht(this,"proxyServerURL",void 0),ht(this,"logLevel",Oi.DEBUG),ht(this,"uploadState","collecting"),ht(this,"uploadLogWaitingList",[]),ht(this,"uploadLogUploadingList",[]),ht(this,"uploadErrorCount",0),ht(this,"currentLogID",0),ht(this,"url",void 0),ht(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[Oi.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[Oi.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[Oi.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[Oi.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[Oi.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Le("UPLOAD_LOG",!0)}disableLogUpload(){Le("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new h9(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-op<100)return void setTimeout(()=>{this.log(...t)},Date.now()-op);let i=Math.max(0,Math.min(4,t[0]));if(t[0]=ag()+" Agora-SDK [".concat(sd(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;let n=ag()+" %cAgora-SDK [".concat(sd(i),"]:"),o=[];if(!w("USE_NEW_LOG"))switch(i){case Oi.DEBUG:o=[n,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case Oi.INFO:o=[n,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case Oi.WARNING:o=[n,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case Oi.ERROR:o=[n,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-op<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-op);let i=Math.max(0,Math.min(4,t[0]));t[0]=ag()+" Agora-SDK [".concat(sd(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!w("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];Array.isArray(r[0])?r[0][0]=zO()+" Agora-SDK [".concat(sd(e),"]:"):r[0]=zO()+" Agora-SDK [".concat(sd(e),"]:");let n="";r.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),n+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Ui,process_id:w("PROCESS_ID"),payload:JSON.stringify(e)};return Fn(async()=>{let r=await Vr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(w("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(w("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){let i=new Error("unexpected upload log response");throw i.response=r,i}},()=>(this.uploadLogUploadingList=[],!1),r=>{let i={status:-1,message:r.message,errorRange:e.map(n=>n.log_item_id)};return r.response?(i.status=r.response.status,i.data=r.response.data,i.headers=r.response.headers):r.request&&(i.status=r.request.status),Ax.reportLogUploadError(i),!0},{timeout:w("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:w("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,w("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),w("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),w("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),w("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},YO;function p9(e){return jt(e.reportId,"params.reportId",0,100,!1),jt(e.category,"params.category",0,100,!1),jt(e.event,"params.event",0,100,!1),jt(e.label,"params.label",0,100,!1),Me(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(YO={}).FREE="free",YO.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});var f9={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Bt=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Ze=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});var _9=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({}),TR=class Ox{constructor(){ht(this,"baseInfoMap",new Map),ht(this,"proxyServer",void 0),ht(this,"eventUploadTimer",void 0),ht(this,"setSessionIdTimer",void 0),ht(this,"url",void 0),ht(this,"backupUrl",void 0),ht(this,"_appId",void 0),ht(this,"keyEventUploadPendingItems",[]),ht(this,"normalEventUploadPendingItems",[]),ht(this,"apiInvokeUploadPendingItems",[]),ht(this,"apiInvokeCount",0),ht(this,"ltsList",[]),ht(this,"lastSendNormalEventTime",Date.now()),ht(this,"customReportCounterTimer",void 0),ht(this,"customReportCount",0),ht(this,"extApiInvoke",async t=>{for(let r of t){let i=de(de({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:nt.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),w("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),w("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void f.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));let r=this.baseInfoMap.get(t),i=Date.now(),n=r.startTime;r.startTime=i,f.debug("rewrite session ".concat(t," startTime: ").concat(i," , ").concat(i-n,"ms")),this.baseInfoMap.set(t,r)}setAppId(t){this._appId=t}reportApiInvoke(t,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;let n=Date.now();this.apiInvokeCount+=1;let o=this.apiInvokeCount,a=()=>({tag:r.tag,invokeId:o,sid:t,name:r.name,apiInvokeTime:n,options:r.options,states:r.states||null}),s=!!w("SHOW_REPORT_INVOKER_LOG");s&&f.info("".concat(r.name," start"),r.options);let c=!1;zt(r.timeout).then(()=>{c||(this.sendApiInvoke(de(de({},a()),{},{error:R.API_INVOKE_TIMEOUT,success:!1})),f.debug("".concat(r.name," timeout")))});let l=new M(R.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:d=>{let u=()=>{if(c)throw l;return c=!0,this.sendApiInvoke(de(de({},a()),{},{success:!0},r.reportResult&&{result:d})),s&&f.info("".concat(r.name," onSuccess")),d};return i?FO(u,r.name+"Success",i,()=>c=!0):u()},onError:d=>{let u=()=>{if(c)throw d;c=!0,this.sendApiInvoke(de(de({},a()),{},{success:!1,error:d})),s&&f.info("".concat(r.name," onFailure"),d.toString())};return i?FO(u,r.name+"Error",i,()=>c=!0):u()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;let i=Date.now(),n=this.createBaseInfo(t,i);n.cname=r.cname;let o=Object.assign({},{willUploadConsoleLog:w("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ER?"global":"oversea",areas:w("AREAS")&&w("AREAS").join(",")},r.extend),{stringUid:a,channelProfile:s,channelMode:c,isABTestSuccess:l,lsid:d,clientRole:u}=r,h=Date.now(),p=de(de({},n),{},{eventType:Bt.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:SR,lts:h,elapse:h-i,extend:JSON.stringify(o),mode:r.mode,process:w("PROCESS_ID"),appType:w("APP_TYPE"),success:!0,version:Ui,stringUid:a,channelProfile:s,channelMode:c,isABTestSuccess:l,lsid:d,clientType:Y(g=window.navigator.userAgent).call(g,"AgoraWebView")?42:20,clientRole:u,serviceId:w("PROCESS_ID"),extensionID:w("PLUGIN_INFO").join(",")||""});var g;this.send({type:Ze.SESSION,data:p},!0)}joinChooseServer(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de({},n),{},{eventType:Bt.JOIN_CHOOSE_SERVER,lts:o,eventElapse:r.elapse||o-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:o-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:Ze.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de({},n),{},{eventType:Bt.REQ_USER_ACCOUNT,lts:o,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||o-i.startTime,eventElapse:o-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Ze.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info;r.vid&&(n.vid=r.vid),n.uid=r.uid,n.cid=r.cid;let o=Date.now(),{firstSuccess:a,avoidJoinStartTime:s}=r,c=o-(a&&s?s:i.startTime),l=de(de({},n),{},{eventType:Bt.JOIN_GATEWAY,lts:o,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:c,eventElapse:o-r.lts,firstSuccess:a,signalChannel:r.signalChannel,preload:r.preload?1:0});r.succ&&(i.lastJoinSuccessTime=o),this.send({type:Ze.JOIN_GATEWAY,data:l},!0)}joinChannelTimeout(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=Date.now(),o=de(de({},i.info),{},{lts:n,timeout:r,elapse:n-i.startTime});this.send({type:Ze.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de({},n),{},{eventType:Bt.PUBLISH,lts:o,eventElapse:r.eventElapse,elapse:o-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Ze.PUBLISH,data:a},!0)}subscribe(t,r,i){let n=this.baseInfoMap.get(t);if(!n)return;let o=n.info,a=Date.now(),s=de(de({},o),{},{eventType:Bt.SUBSCRIBE,lts:a,eventElapse:r.eventElapse,elapse:a-n.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?s.peerSuid=r.peerid:s.peer=r.peerid,this.send({type:Ze.SUBSCRIBE,data:s},!0)}wsCompressorInit(t){var r;let i=[...ui(r=this.baseInfoMap).call(r)],n=i.length?i[0]:"UnableToGetSid",o=this.baseInfoMap.get(n);if(!o)return;let a=o.info,s=Date.now(),c=de(de({},a),{},{eventType:Bt.WS_COMPRESSOR_INIT,lts:s,eventElapse:t.eventElapse,elapse:s-o.startTime,status:t.status?1:2});this.send({type:Ze.WS_COMPRESSOR_INIT,data:c},!0)}firstRemoteVideoDecode(t,r,i,n){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,s=Date.now(),c=de(de(de({},a),n),{},{elapse:s-o.startTime,eventType:r,lts:s,firstDecodeFrame:Math.max((n.firstFrame||s)-o.startTime,0),apEnd:Math.max(n.apEnd-o.startTime,0),apStart:Math.max(n.apStart-o.startTime,0),joinGwEnd:Math.max(n.joinGwEnd-o.startTime,0),joinGwStart:Math.max(n.joinGwStart-o.startTime,0),pcEnd:Math.max(n.pcEnd-o.startTime,0),pcStart:Math.max(n.pcStart-o.startTime,0),subscriberEnd:Math.max(n.subscriberEnd-o.startTime,0),subscriberStart:Math.max(n.subscriberStart-o.startTime,0),videoAddNotify:Math.max(n.videoAddNotify-o.startTime,0)});this.send({type:i,data:c},!0)}firstRemoteFrame(t,r,i,n){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,s=Date.now(),c=de(de(de({},a),n),{},{elapse:s-o.startTime,eventType:r,lts:s});this.send({type:i,data:c},!0)}pcStats(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de(de({},n),r),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:o-i.startTime,eventType:Bt.PC_STATS,lts:o,preallocation:r.preallocation?1:0});this.send({type:Ze.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(t,r){if(t){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de(de({},n),r),{},{vid:n.vid===void 0?0:Number(n.vid),eventType:Bt.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:Ze.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(t,r,i,n){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,s=Date.now(),c=de(de(de({},a),n),{},{eventType:r,lts:s});this.send({type:i,data:c},!0)}streamSwitch(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de({},n),{},{eventType:Bt.STREAM_SWITCH,lts:o,isDual:r.isdual,elapse:o-i.startTime,success:r.succ});this.send({type:Ze.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de({},n),{},{eventType:Bt.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-r.lts,elapse:o-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Ze.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de({},n),{},{eventType:Bt.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-r.lts,elapse:o-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Ze.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(t){this.proxyServer=t,t?f.debug("reportProxyServerurl: ".concat(t)):f.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de({},n),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:o,elapse:o-i.startTime,joinChannelSuccessElapse:o-(i.lastJoinSuccessTime||o),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Ze.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now();(function(a,s,c){let l=a[s];if(!l||typeof l!="string")return[a];a[s]="";let d=no(JSON.stringify(a)),u=0,h=[],p=0;for(let g=0;g<l.length;g++)p+=l.charCodeAt(g)<=127?1:3,p<=c-d||(h[h.length]=J(J({},a),{},{[s]:l.substring(u,g)}),u=g,p=l.charCodeAt(g)<=127?1:3);return u!==l.length-1&&(h[h.length]=J(J({},a),{},{[s]:l.substring(u)})),h})(de(de(de({},n),r),{},{elapse:o-i.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:Ze.WORKER_EVENT,data:a},!0))}apworkerEvent(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de(de({},n),r),{},{elapse:o-i.startTime,lts:o});this.send({type:Ze.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de(de({},n),r),{},{elapse:o-i.startTime,lts:o,extend:r.extend||void 0});this.send({type:Ze.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(t,r){let i=this.baseInfoMap.get(t);if(!i)return;let n=i.info,o=Date.now(),a=de(de(de({},n),r),{},{elapse:o-i.startTime,lts:o});this.send({type:Ze.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>w("CUSTOM_REPORT_LIMIT"))throw new M(R.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let i=Date.now(),n=r.map(o=>({type:Ze.USER_ANALYTICS,data:de(de({sid:t},o),{},{lts:i})}));try{w("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n):await this.postDataToStatsCollector(n)}catch(o){throw f.error("send custom report message failed",o.toString()),new M(R.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(t){let r=w("NOT_REPORT_EVENT");if(t.tag&&Y(r)&&Y(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;let i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;let{cname:n,uid:o,cid:a}=i.info,s;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof M){let{code:l,message:d}=t.error;s=l||d||t.error.toString()}else s=t.error.toString();let c={invokeId:t.invokeId,sid:t.sid,cname:n,cid:a,uid:o,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?s:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Ze.API_INVOKE,data:c},!1),!0}appendSessionId(){Ox.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){let r=this.apiInvokeUploadPendingItems.length;for(let i=0;i<r;i++){let n=this.apiInvokeUploadPendingItems.shift();n&&(n.sid=t._sessionId,this.sendApiInvoke(Object.assign({},n)))}}})}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>w("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){let i=[],n=[];for(;t.length;){let a=t.shift();i.length<20?i.push(a):n.push(a)}t.push(...n);for(let a of[...i]){var o;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),lh(o=this.ltsList).call(o,(s,c)=>s-c))}return r||(this.lastSendNormalEventTime=Date.now()),w("ENABLE_EVENT_REPORT")&&i.length&&(w("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((a=>s=>{w("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>w("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-w("NORMAL_EVENT_QUEUE_CAPACITY")),f.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){St.networkState===ei.OFFLINE&&await K.race([St.onlineWaiter,zt(2*Rt.maxRetryTimeout)]);let r=o=>{let a=new Uint8Array;return o.forEach(s=>{let c=_R(JSON.stringify(s.data)),l=new ArrayBuffer(5),d=(h=>{let p=0;return Object.entries(Ze).forEach(g=>{let[_,E]=g;E===h.type&&(p=_9[_])}),p})(s),u=new DataView(l);u.setUint16(0,c.byteLength,!0),u.setUint8(2,255&d),u.setUint8(3,d>>>8&255),u.setUint8(4,d>>>16&255),a=kO(a,new Uint8Array(l)),a=kO(a,c)}),a},i="event",n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(w("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(w("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let o=0;o<2;o+=1){o===1&&(n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(w("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(w("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await av(n,{timeout:1e4,data:r(t),headers:de(de({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(o===1)throw a;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(a=>JSON.stringify(a)),vid:(a=>{let s=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return s&&s.info.vid&&+s.info.vid||0})(t[0])};St.networkState===ei.OFFLINE&&await K.race([St.onlineWaiter,zt(2*Rt.maxRetryTimeout)]);let n=r?"/events/proto-raws":"/events/messages",o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(w("EVENT_REPORT_DOMAIN"),"&p=").concat(w("STATS_COLLECTOR_PORT"),"&d=").concat(n):"https://".concat(w("EVENT_REPORT_DOMAIN"),":").concat(w("STATS_COLLECTOR_PORT")).concat(n));for(let a=0;a<2;a+=1){a===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(w("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(w("STATS_COLLECTOR_PORT"),"&d=").concat(n):"https://".concat(w("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(w("STATS_COLLECTOR_PORT")).concat(n)));try{r?await c9(o,{timeout:1e4,data:i}):await av(o,{timeout:1e4,data:i})}catch(s){if(a===1)throw s;continue}return}}createBaseInfo(t,r){let i=Object.assign({},f9);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:r}),i}reportResourceTiming(t,r){let i=performance.getEntriesByName(t),n=i[i.length-1];n&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:n,tag:nt.TRACER}).onSuccess()}};function re(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,i){let n=i.value;if(typeof n=="function"){let o=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];let l=s;if(e.argsMap)try{l=e.argsMap(this,...s)}catch(u){f.warning(u),l=[]}try{JSON.stringify(l)}catch{f.warning("arguments for method ".concat(o,".").concat(String(r)," not serializable for apiInvoke.")),l=[]}let d=(e.report||Q).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(r)),options:l,tag:nt.TRACER,reportResult:e.reportResult},e.throttleTime);try{let u=n.apply(this,s);return u instanceof K?u.then(h=>(d.onSuccess(e.reportResult&&h),h)).catch(h=>{throw d.onError(h),h}):(d.onSuccess(e.reportResult&&u),u)}catch(u){throw d.onError(u),u}}}return i}}ht(TR,"__CLIENT_LIST__",[]);var Q=new TR;Ax.on("REPORT_LOG_UPLOAD",e=>{e.networkState=St.networkState,Q.reportApiInvoke(null,{name:"logUploadError",options:e,tag:nt.TRACER}).onSuccess("logUploadError")});var m9=["CHINA","GLOBAL"],Xt=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");let i=r.join(""),n=[];for(let s=0;s<6;s++)n.push("1");let o=n.join(""),a={};return a[e]=i,a[t]=o,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Xt,ER||(pt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],pt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],pt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],pt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],pt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],pt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],pt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",pt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",pt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",pt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",pt.AREAS=["NORTH_AMERICA","OVERSEA"]);var bx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ua=[];function es(e,t){return!!t&&ua.some(r=>r.uid===e&&r.channelName===t)}TR.__CLIENT_LIST__=ua;var E9=R2.forEach,$O=j_("forEach")?[].forEach:function(e){return E9(this,e,arguments.length>1?arguments[1]:void 0)};Be({target:"Array",proto:!0,forced:[].forEach!=$O},{forEach:$O});var g9=mn("Array").forEach,S9=_o,T9=lr,v9=Dr,y9=g9,sg=Array.prototype,R9={DOMTokenList:!0,NodeList:!0},C9=function(e){var t=e.forEach;return e===sg||v9(sg,e)&&t===sg.forEach||T9(R9,S9(e))?y9:t},I9=_t(C9),w9=fo,qO=K_;Be({target:"Object",stat:!0,forced:At(function(){qO(1)})},{keys:function(e){return qO(w9(e))}});var Nx=_t(Vn.Object.keys),A9=_t(LM),O9=Be,b9=dh,N9=Ct([].reverse),XO=[1,2];O9({target:"Array",proto:!0,forced:String(XO)===String(XO.reverse())},{reverse:function(){return b9(this)&&(this.length=this.length),N9(this)}});var D9=mn("Array").reverse,P9=Dr,k9=D9,cg=Array.prototype,L9=function(e){var t=e.reverse;return e===cg||P9(cg,e)&&t===cg.reverse?k9:t},Dx=L9,M9=_t(Dx),U9=Be,JO=dh,x9=$_,V9=Ri,QO=Ly,F9=Ko,B9=$a,j9=J_,G9=vt,W9=Yy,H9=S2("slice"),K9=G9("species"),lg=Array,z9=Math.max;U9({target:"Array",proto:!0,forced:!H9},{slice:function(e,t){var r,i,n,o=B9(this),a=F9(o),s=QO(e,a),c=QO(t===void 0?a:t,a);if(JO(o)&&(r=o.constructor,(x9(r)&&(r===lg||JO(r.prototype))||V9(r)&&(r=r[K9])===null)&&(r=void 0),r===lg||r===void 0))return W9(o,s,c);for(i=new(r===void 0?lg:r)(z9(c-s,0)),n=0;s<c;s++,n++)s in o&&j9(i,n,o[s]);return i.length=n,i}});var Y9=mn("Array").slice,$9=Dr,q9=Y9,dg=Array.prototype,X9=function(e){var t=e.slice;return e===dg||$9(dg,e)&&t===dg.slice?q9:t},J9=_t(X9);function X(e,t,r,i,n){var o,a,s,c={};return I9(o=Nx(i)).call(o,function(l){c[l]=i[l]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=A9(a=M9(s=J9(r).call(r)).call(s)).call(a,function(l,d){return d(e,t,l)||l},c),n&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(n):void 0,c.initializer=void 0),c.initializer===void 0&&(E2(e,t,c),c=null),c}var sv=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),si=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),of=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),ug=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Hi=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),yr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),te=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Ve=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),oe=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),ne=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),ku=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),_e=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),wr=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),se=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({}),D=class extends M{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),v(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,f)}throw(){super.throw(f)}};function sm(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw f.error("Invalid Channel Name ".concat(e)),new D(R.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function cm(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!Sx(e,1,255))throw new D(R.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&f.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}var Mo=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),Q9={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},hg={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function pg(e,t){jt(e.url,"".concat(t,".url"),1,1e3,!1),Qe(e.x)||Me(e.x,"".concat(t,".x"),0,1e4),Qe(e.y)||Me(e.y,"".concat(t,".y"),0,1e4),Qe(e.width)||Me(e.width,"".concat(t,".width"),0,1e4),Qe(e.height)||Me(e.height,"".concat(t,".height"),0,1e4),Qe(e.zOrder)||Me(e.zOrder,"".concat(t,".zOrder"),0,255),Qe(e.alpha)||Me(e.alpha,"".concat(t,".alpha"),0,1,!1)}var Z9={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},ha=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),cv=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),It=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function ZO(e){if(!e.channelName)throw new D(R.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new D(R.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&jt(e.token,"info.token",1,2047),cm(e.uid),sm(e.channelName),!0}var Rr=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Ro=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Hr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Sc=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),be=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),qt=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),af=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Pt=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),we=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),e0=[we.AFRICA,we.ASIA,we.CHINA,we.EUROPE,we.GLOBAL,we.INDIA,we.JAPAN,we.NORTH_AMERICA,we.OCEANIA,we.OVERSEA,we.SOUTH_AMERICA],or=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),lm={CHINA:{},ASIA:{CODE:or.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:or.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:or.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:or.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:or.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:or.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:or.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:or.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:or.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:or.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:or.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:or.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:or.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};ER&&(lm.CHINA={CODE:or.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});var lv=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({}),Px=class extends tt{constructor(e,t){super(),v(this,"onICEConnectionStateChange",void 0),v(this,"onConnectionStateChange",void 0),v(this,"onDTLSTransportStateChange",void 0),v(this,"onDTLSTransportError",void 0),v(this,"onICETransportStateChange",void 0),v(this,"onFirstAudioReceived",void 0),v(this,"onFirstVideoReceived",void 0),v(this,"onFirstAudioDecoded",void 0),v(this,"onFirstVideoDecoded",void 0),v(this,"onFirstVideoDecodedTimeout",void 0),v(this,"onSelectedLocalCandidateChanged",void 0),v(this,"onSelectedRemoteCandidateChanged",void 0),v(this,"getLocalVideoStats",void 0)}},kx=class extends Px{constructor(e,t){super(e,t),v(this,"establishPromise",void 0)}},Z=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),ti=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),So=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),V=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Oe=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),ie=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ji=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ki=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),xt=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Lx=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),eo=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Ai=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),In=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),ac=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ut=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),sc=function(e){return e.ABORT="abort",e}({}),Ta=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),e7=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),t7={[of.ACCESS_POINT]:{[yr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[yr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[yr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[yr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[yr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[yr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[of.UNILBS]:{[Hi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Hi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Hi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Hi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Hi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Hi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Hi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Hi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Hi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Hi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Hi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Hi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[of.STRING_UID_ALLOCATOR]:{[ug.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[ug.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[ug.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Sl(e){let t=t7[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===of.ACCESS_POINT){let i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}var r7={[te.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[te.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[te.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[te.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[te.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[te.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[te.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[te.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[te.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[te.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[te.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[te.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[te.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[te.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[te.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[te.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[te.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[te.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[te.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[te.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[te.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[te.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[te.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[te.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[te.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[te.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[te.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[te.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[te.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[te.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[te.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[te.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[te.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[te.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[te.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[te.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[te.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[te.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[te.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[te.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[te.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[te.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[te.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[te.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[te.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[te.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[te.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[te.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[te.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[te.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[te.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[te.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[te.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[te.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[te.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[te.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[te.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[te.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[te.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[te.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[te.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[te.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[te.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Lu(e){return r7[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function t0(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function fg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?t0(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function r0(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function i0(e,t){if(typeof e=="string")return e;let{proxy:r,host:i,port:n}=e;if(t){let o=w("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(i,"/ws/?p=").concat(Number(n)+150):"wss://".concat(i,":").concat(o,"/ws/?p=").concat(Number(n)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(i,"&p=").concat(n):"wss://".concat(i,":").concat(n)}var i7=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,n7=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,o7=/wss:\/\/(.+):([0-9]+)\/?/,a7=/wss:\/\/(.[^\/]+)\/?/,s7=0,c7=class{constructor(e,t){v(this,"id",0),v(this,"store",void 0),v(this,"recordIndex",void 0),v(this,"websockets",[]),v(this,"try443PortDuration",2e3),v(this,"forceCloseWSDuration",5e3),v(this,"try443PortTimeout",null),v(this,"forceCloseTimeout",null),v(this,"isTry443PortFailed",!1),v(this,"isNormalPortFailed",!1),v(this,"useDoubleDomain",!1),v(this,"useProxy",!1),v(this,"startTime",Date.now()),this.id=++s7,this.try443PortDuration=w("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;let t=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];f.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...i)}createWebSocket(e,t,r){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:r});let i=w("GATEWAY_DOMAINS"),n=Date.now(),o=[],a=i.find(l=>{var d;return Y(d=e.host).call(d,l)});a||(this.useDoubleDomain=!1);let s=[];if(this.useDoubleDomain)i.forEach(l=>{s.push(i0(fg(fg({},e),{},{host:e.host.replace(a,l)}),t))});else{let l=fg({},e);if(t&&a){let d=i.find(u=>u!==a);d&&(l.host=l.host.replace(a,d))}s.push(i0(l,t))}try{s.forEach(l=>{let d=new WebSocket(l);d.binaryType="arraybuffer",o.push(d),this.logger("ws is connecting:",d.url)})}catch(l){if(this.logger("ws create failed"),o.forEach(d=>d.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,r);if(!t&&Number(e.port)!==443)return this.createWebSocket(e,!0,r);throw new D(R.WS_ERR,"init websocket failed! Error: ".concat(l.toString()))}let c=Nu();return this.store&&this.store.recordJoinChannelService({urls:o.map(l=>l.url),service:"gateway"},this.recordIndex),o.forEach(l=>{l.onopen=()=>{this.logger("onopen: ws ".concat(l.url," open cost ").concat(Date.now()-n,"ms")),this.websockets.forEach(d=>{d!==l&&(d.onopen=null,d.onclose=null,d.onmessage=null,d.close(),this.logger("close backup websocket: ".concat(d.url)))}),this.websockets.length=0,c.resolve(l)},l.onclose=d=>{this.logger("onclose: ws ".concat(l.url," closed cost ").concat(Date.now()-n,"ms state: ").concat(l.readyState)),t?this.isTry443PortFailed=r0(o):this.isNormalPortFailed=r0(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(d.reason)),c.reject({code:d.code,reason:af.A_ROUND_WS_FAILED}))},l.onmessage=d=>this.logger("".concat(l.url," onmessage: ").concat(d.data))}),this.websockets.push(...o),r||(()=>{let l=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.websockets.forEach(d=>d.readyState!==WebSocket.OPEN&&d.close())};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(l,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",c.isResolved),c.isResolved)return l();ve().os===Lt.MAC_OS&&ot()&&l(),this.createWebSocket(e,!0,!0).then(d=>c.resolve(d)).catch(d=>{this.isNormalPortFailed&&c.reject(d),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(l,this.forceCloseWSDuration)},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,r,i){return this.useDoubleDomain=!!t,typeof e=="string"&&(e=function(n){let o,a,s;return[,o,a,s]=n.match(i7)||[],o||([,a,s]=n.match(n7)||[]),a&&s||([,a,s]=n.match(o7)||[]),a&&s||([,a]=n.match(a7)||[]),a||f.warning("un-destructible url: ",n),{proxy:o,host:a,port:s||"443"}}(e)),this.recordIndex=i,this.useProxy=!!e.proxy,r&&this.useProxy&&(f.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(e,!!r,!1).finally(()=>this.clearTimeout())}};function n0(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}var Mx=class extends tt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Y(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(se.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(se.CONNECTED):this._state==="closed"?this.emit(se.CLOSED):this._state==="failed"&&this.emit(se.FAILED))}resetReconnectCount(e){f.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],n=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),v(this,"connectionID",0),v(this,"currentURLIndex",0),v(this,"urls",[]),v(this,"_reconnectMode","tryNext"),v(this,"reconnectReason",void 0),v(this,"_initMutex",new cr("websocket")),v(this,"name",void 0),v(this,"_state","closed"),v(this,"reconnectInterrupter",void 0),v(this,"websocket",void 0),v(this,"retryConfig",void 0),v(this,"reconnectCount",0),v(this,"forceCloseTimeout",5e3),v(this,"onlineReconnectListener",void 0),v(this,"useCompress",void 0),v(this,"tryDoubleDomain",!1),v(this,"use443PortOnly",!1),v(this,"wsInflateLength",0),v(this,"wsDeflateLength",0),v(this,"closeEstablishingWs",()=>{}),v(this,"store",void 0),v(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(d){for(var u=1;u<arguments.length;u++){var h=arguments[u]!=null?arguments[u]:{};u%2?n0(Object(h),!0).forEach(function(p){v(d,p,h[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(h)):n0(Object(h)).forEach(function(p){Object.defineProperty(d,p,Object.getOwnPropertyDescriptor(h,p))})}return d}({},t),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=n;let{timeout:a,timeoutFactor:s}=t,c=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*s)/10);ei.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),St.on(Fc.NETWORK_STATE_CHANGE,(d,u)=>{d!==u&&(this.resetReconnectCount("network state change: ".concat(u," -> ").concat(d)),d===ei.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=s))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{let i=Nu(),n=this.urls[this.currentURLIndex];w("ENABLE_PREALLOC_PC")&&this.emit(Lx.PRE_CONNECT_PC),this.createWebSocketConnection(n).then(i.resolve).catch(i.reject),this.once(se.CLOSED,()=>{i.reject(new M(R.WS_DISCONNECT))}),this.once(se.CONNECTED,i.resolve),await i.promise}catch{}finally{r()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let r=this.websocket;t?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void f.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),f.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);let r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new M(R.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(r){throw new M(R.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;let r=Nu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let i=l=>{var d;(d=this.store)===null||d===void 0||d.signalChannelOpen(),f.debug("[".concat(this.name,"] websocket opened:"),l),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},n=async l=>{var d;if(f.debug("[".concat(this.name,"] websocket close ").concat((d=this.websocket)===null||d===void 0?void 0:d.url,", code: ").concat(l.code,", reason: ").concat(l.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new M(R.WS_DISCONNECT,"websocket close: ".concat(l.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=l.reason,this.state="reconnecting");let u=Mi(this,se.WILL_RECONNECT,this.reconnectMode,l.reason)||this.reconnectMode,h=await this.reconnectWithAction(u);if(this.state==="closed")return void f.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!h)return r.reject(new M(R.WS_DISCONNECT,"websocket reconnect failed: ".concat(l.code))),this.close(!0);r.resolve()}},o=l=>{this.emit(se.ON_MESSAGE,l)},a=l=>{f.warn("[".concat(this.connectionID,"] ws open error ").concat(l))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),w("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=w("GATEWAY_WSS_ADDRESS")),f.debug("[".concat(this.name,"] start connect, url:"),e);let s=(t=this.store)===null||t===void 0?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;let l=await this.chooseBestWebsocketConnection(e);this.websocket=l,i&&i(this.websocket.url),this.websocket.onclose=n,this.websocket.onmessage=o,this.websocket.onerror=a,(c=this.store)===null||c===void 0||c.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this.joinGatewayRecordIndex=s}catch(l){let d=this.state==="closed",u=l instanceof M,h=u&&l.code===R.WS_ABORT,p=u&&l.code===R.WS_ERR,g=u?l.message:l&&(l.reason||l.toString());f.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(g)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:h?"aborted":"error",errors:[l]},s),d||p?(r.reject(d?new M(R.WS_DISCONNECT,"websocket is closed: ".concat(g)):new M(R.WS_ERR,"init websocket failed: ".concat(g))),p&&f.error("[".concat(this.name,"] init websocket failed: ").concat(g))):n&&n(l)}return r.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;f.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||St.isOnline||!St.onlineWaiter||(this.onlineReconnectListener=St.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,t){let o=mR(this.reconnectCount,this.retryConfig);f.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(e)),await K.race([zt(o),this.onlineReconnectListener||new K(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;let i=async(o,a)=>{this.emit(se.RECONNECT_CREATE_CONNECTION,a),await this.createWebSocketConnection(o)};try{if(e==="retry")this.emit(se.RECONNECT_WAITTING_FINISH,e),await i(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);f.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(se.RECONNECT_WAITTING_FINISH,e),await i(this.urls[this.currentURLIndex],e)}else e==="recover"&&(f.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(se.RECONNECT_WAITTING_FINISH,e),this.urls=await tr(this,se.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(o){var n;f.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));let a=o==null||(n=o.data)===null||n===void 0?void 0:n.desc;return Array.isArray(a)&&Y(a).call(a,"dynamic key expired")?(this.emit(se.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}},vR=class extends Mx{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){let r=Nu(),i=function(o,a){return new c7(o,a)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{f.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new M(R.WS_ABORT,"choose best websocket aborted"))};let n=w("GATEWAY_DOMAINS");return f.debug("[choose-best-ws] currentDomain: ",e,", domains: ",n,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}},Mu=class extends Mx{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new K((r,i)=>{let n=!1,o=[];this.closeEstablishingWs=()=>{f.debug("[choose-best-ws] close establishing websockets"),o.forEach(p=>{p.onclose=null,p.onopen=null,p.onmessage=null,p.close()}),i(new M(R.WS_ABORT,"choose best websocket aborted"))};let a=w("GATEWAY_DOMAINS"),s,c=e.indexOf("?h="),l=a.find(p=>c!==-1?Y(e).call(e,p,c):Y(e).call(e,p));f.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let d=!this.tryDoubleDomain||!l;if(!d&&l){var u;let p=Date.now();try{a.forEach(g=>{let _=c===-1?e.replace(l,g):e.substr(0,c)+e.substr(c).replace(l,g),E=new WebSocket(_);E.binaryType="arraybuffer",o.push(E),f.debug("[choose-best-ws] ws is connecting:",E.url)})}catch{for(f.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(g=>g.close());o.length;)o.pop();d=!0}(u=this.store)===null||u===void 0||u.recordJoinChannelService({urls:o.map(g=>g.url),service:"gateway"},t),o.forEach(g=>{g.onopen=()=>{if(n)return;let _=Date.now()-p;f.debug("[choose-best-ws] ws open cost ".concat(_,"ms")),o.filter(E=>E!==g).forEach(E=>{f.debug("[choose-best-ws]close backup websocket: ".concat(E.url)),E.close()}),n=!0,r(g)},g.onclose=_=>{s=_,!n&&(o.find(E=>!(E.readyState===WebSocket.CLOSED||E.readyState===WebSocket.CLOSING))||(f.debug("[choose-best-ws] all websocket is closed"),n=!0,i(s)))},g.onmessage=_=>{f.debug("[choose-best-ws]".concat(g.url," onmessage: ").concat(_.data))}}),zt(this.forceCloseTimeout).then(()=>{o.forEach(g=>{g.readyState!==WebSocket.OPEN&&g.close()})})}if(d){var h;let p;f.debug("[choose-best-ws] use single url: ",e),(h=this.store)===null||h===void 0||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{p=new WebSocket(e),o.push(p),p.binaryType="arraybuffer"}catch(g){let _=new M(R.WS_ERR,"init websocket failed! Error: ".concat(g.toString()));return f.error("[".concat(this.name,"]").concat(_)),void i(_)}p.onopen=()=>{r(p)},p.onclose=g=>{i(g)},p.onmessage=g=>{f.debug("[choose-best-ws]".concat(p.url," onmessage: ").concat(g.data))},zt(this.forceCloseTimeout).then(()=>{p&&p.readyState!==WebSocket.OPEN&&p.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}},l7=class extends tt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Ve.CONNECTED?this.emit(oe.WS_CONNECTED):e===Ve.RECONNECTING?this.emit(oe.WS_RECONNECTING,this._websocketReconnectReason):e===Ve.CLOSED&&this.emit(oe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),v(this,"_disconnectedReason",void 0),v(this,"_websocketReconnectReason",void 0),v(this,"_connectionState",Ve.CLOSED),v(this,"reconnectToken",void 0),v(this,"websocket",void 0),v(this,"openConnectionTime",void 0),v(this,"clientId",void 0),v(this,"lastMsgTime",Date.now()),v(this,"uploadCache",[]),v(this,"uploadCacheInterval",void 0),v(this,"rttRolling",new wx(5)),v(this,"pingpongTimer",void 0),v(this,"wsInflateDataTimer",void 0),v(this,"pingpongTimeoutCount",0),v(this,"joinResponse",void 0),v(this,"multiIpOption",void 0),v(this,"initError",void 0),v(this,"spec",void 0),v(this,"store",void 0),v(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(oe.ON_BINARY_DATA,r.data);let i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let n="res-@".concat(i._id);this.emit(n,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===_e.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===_e.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Pe.UID_BANNED);break;case 15:this.close(Pe.IP_BANNED);break;case 16:this.close(Pe.CHANNEL_BANNED)}if(i._type===_e.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case te.ERR_LICENSE_MISSING:this.close(Pe.LICENSE_MISSING);break;case te.ERR_LICENSE_EXPIRED:this.close(Pe.LICENSE_EXPIRED);break;case te.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Pe.LICENSE_MINUTES_EXCEEDED);break;case te.ERR_LICENSE_PERIOD_INVALID:this.close(Pe.LICENSE_PERIOD_INVALID);break;case te.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Pe.LICENSE_MULTIPLE_SDK_SERVICE);break;case te.ERR_LICENSE_ILLEGAL:this.close(Pe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new vR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,w("JOIN_GATEWAY_USE_DUAL_DOMAIN"),w("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ve.CONNECTED&&this.reconnect("retry",Zt.OFFLINE)})}async request(e,t,r,i){let n=Fe(6,""),o={_id:n,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new K((p,g)=>{if(this.connectionState===Ve.CONNECTED)return p();let _=()=>{this.off(oe.WS_CLOSED,E),p()},E=()=>{this.off(oe.WS_CONNECTED,_),g(new D(R.WS_ABORT))};this.once(oe.WS_CONNECTED,_),this.once(oe.WS_CLOSED,E),e!==ne.PUBLISH&&e!==ne.PUBLISH_DATASTREAM&&e!==ne.SUBSCRIBE&&e!==ne.SUBSCRIBE_DATASTREAM&&e!==ne.UNSUBSCRIBE&&e!==ne.UNSUBSCRIBE_DATASTREAM&&e!==ne.UNPUBLISH&&e!==ne.UNPUBLISH_DATASTREAM&&e!==ne.CONTROL&&e!==ne.RESTART_ICE||this.once(oe.DISCONNECT_P2P,()=>{g(new D(R.DISCONNECT_P2P))}),e!==ne.PUBLISH&&e!==ne.RESTART_ICE||this.once(oe.ABORT_P2P_EXECUTION,()=>{g(new D(R.DISCONNECT_P2P))})});if(this.connectionState!==Ve.CONNECTING&&this.connectionState!==Ve.RECONNECTING||e===ne.JOIN||e===ne.REJOIN||await s(),this.websocket.sendMessage(o,!0),i)return;let c=new K((p,g)=>{let _=!1,E=(T,y)=>{_=!0,p({isSuccess:T==="success",message:y||{}}),this.off(oe.WS_CLOSED,S),this.off(oe.WS_RECONNECTING,S),this.emit(oe.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(n),E);let S=()=>{g(new D(R.WS_ABORT,"type: ".concat(e))),this.off(oe.WS_CLOSED,S),this.off(oe.WS_RECONNECTING,S),this.off("res-@".concat(n),E)};this.once(oe.WS_CLOSED,S),this.once(oe.WS_RECONNECTING,S),zt(w("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||_||(f.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(oe.REQUEST_TIMEOUT,e,t))})}),l=null;try{l=await c}catch(p){if(this.connectionState===Ve.CLOSED||e===ne.LEAVE)throw new D(R.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?p.throw():e===ne.JOIN||e===ne.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;let d=Number(l.message.error_code||l.message.code),u=Lu(d),h=new D(R.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return u.action==="success"?l.message:(f.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===te.ERR_TOO_MANY_BROADCASTERS?((e===ne.JOIN||e===ne.REJOIN)&&(this.initError=h,this.close()),h.throw()):u.action==="failed"?h.throw():u.action==="quit"?(this.initError=h,this.close(),h.throw()):(d===te.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,f.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Zt.MULTI_IP)):this.reconnect(u.action,Zt.SERVER_ERROR),e===ne.JOIN||e===ne.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new K(r=>{let i=n=>{(!t||t(n))&&(this.off(e,i),r(n))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void f.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(ku.WRTC_STATS,t)}upload(e,t){let r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch{let i=w("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ve.CONNECTED)return;let n=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(n._type,n._message)},w("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let r={_type:e,_message:t};this.websocket.sendMessage(r)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new K((r,i)=>{this.once(oe.WS_CONNECTED,()=>r(this.joinResponse)),this.once(oe.WS_CLOSED,()=>i(this.initError||new D(R.WS_ABORT))),this.connectionState=Ve.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Pe.LEAVE,this.connectionState=Ve.CLOSED,f.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(oe.ABORT_P2P_EXECUTION);let e=await tr(this,oe.REQUEST_JOIN_INFO),t=await this.request(ne.JOIN,e);if(!t)return this.emit(oe.REPORT_JOIN_GATEWAY,af.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(oe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ve.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new D(R.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=Pu(this,oe.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(ne.REJOIN,e);return!!t&&(this.connectionState=Ve.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(r=>{this.emit(_e.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(_e.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(_e.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(_e.MUTE_AUDIO,{uid:r.uid}):this.emit(_e.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(_e.MUTE_VIDEO,{uid:r.uid}):this.emit(_e.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(_e.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(_e.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(_e.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(_e.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(_e.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){f.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Lu(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Pe.UID_BANNED),void this.close()):void this.reconnect(t.action,Zt.SERVER_ERROR);f.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=w("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(f.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>w("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Zt.TIMEOUT):this.request(ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-t;this.rttRolling.add(r),w("REPORT_STATS")&&this.send(ne.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();e!==0&&t!==0&&this.upload(ku.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(se.RECONNECT_WAITTING_FINISH,e=>{this.emit(oe.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(se.RECONNECT_CREATE_CONNECTION,e=>{this.emit(oe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(se.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(se.CLOSED,()=>{this.connectionState=Ve.CLOSED}),this.websocket.on(se.FAILED,()=>{this._disconnectedReason=Pe.NETWORK_ERROR,this.connectionState=Ve.CLOSED}),this.websocket.on(se.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Ve.CONNECTED?this.connectionState=Ve.RECONNECTING:this.connectionState=Ve.CONNECTING}),this.websocket.on(se.WILL_RECONNECT,(e,t,r)=>{let i=Pu(this,oe.IS_P2P_DISCONNECTED),n=i||e!=="retry";i&&e==="retry"&&(f.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=af.P2P_DISCONNECTED),n&&(f.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(oe.REPORT_JOIN_GATEWAY,t||af.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(oe.DISCONNECT_P2P)),r(e)}),this.websocket.on(se.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{f.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Zt.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(oe.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof D){if(e.code===R.UNEXPECTED_RESPONSE&&e.data.code===te.ERR_NO_AUTHORIZED)return this.initError=new D(R.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),f.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Zt.SERVER_ERROR);f.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Zt.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(se.REQUEST_NEW_URLS,(e,t)=>{tr(this,oe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(se.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Lx.PRE_CONNECT_PC,()=>{this.emit(oe.PRE_CONNECT_PC)})}},gt=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function o0(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function ap(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?o0(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Gc(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(w("TURN_DOMAIN")):(f.info("Unidentified as ip: ".concat(e,", use as host")),e)}function yR(e,t){e.addresses||(e.addresses=[]);let r=function(s,c){if(w("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return s.map(u=>{let{ip:h,port:p}=u;return{address:"".concat(h,":").concat(p)}});let l=w("GATEWAY_DOMAINS"),d=l[1]&&Y(c).call(c,l[1])?1:0;return s.map(u=>{let{domain_prefix:h,port:p,ip:g}=u;if(h)return{address:"".concat(h,".").concat(l[d++%l.length],":").concat(p)};let _=/^[\.\:\d]+$/.test(g),E=_?"".concat(g.replace(/[^\d]/g,"-"),".").concat(l[d++%l.length],":").concat(p):"".concat(g,":").concat(p);return _||f.info("Unidentified as ip: ".concat(g,", use as host")),{ip:g,port:p,address:E}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){let s=i.split(";");for(let c=0;c<s.length;c++){var n;let l=Sr(n=s[c]).call(n);r[c]&&l&&(r[c].ip6=l)}}let o=e.detail&&e.detail.candidate,a;if(o){let[s,c]=o.split(":");s&&c&&(a={port:Number(c),ip:s,address:"".concat(s,":").concat(c)})}return{gatewayAddrs:r,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function ri(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function a0(e){let t=e._encoderConfig;if(!t)return{};let r={resolution:t.width&&t.height?"".concat(ri(t.width),"x").concat(ri(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function s0(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Uu(e,t){let r,i,n;switch(t){case gt.CHOOSE_SERVER:i=4096,n="choose server";break;case gt.CLOUD_PROXY:i=1048576,n="proxy";break;case gt.CLOUD_PROXY_5:i=4194304,n="proxy5";break;case gt.CLOUD_PROXY_FALLBACK:i=4194310,n="proxy fallback";break;default:throw new D(R.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(o=>{o.buffer&&o.buffer.flag===i&&(r={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(a=>ap(ap({},a),{},{ticket:o.buffer.cert})),server_ts:e.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:ap(ap({},o.buffer.detail),e.detail),flag:o.buffer.flag,opid:e.opid,cert:o.buffer.cert})}),!r)throw new D(R.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(n," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function Ux(e,t){return await K.all(e.addresses.map(async r=>({address:Gc(r.ip),tcpport:r.port,udpport:r.port,username:t&&w("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Xt.username,password:t&&w("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await nv(t.toString()):Xt.password})))}function dv(e,t){let r=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||r.height,n=t.videoWidth||r.width;return i&&n?Math.max(Math.min(i,n)/Math.min(ri(e.height),ri(e.width)),1):(f.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function va(e){let{candidateType:t,relayProtocol:r,type:i,address:n,port:o,protocol:a}=e;return i==="local-candidate"?{candidateType:t,relayProtocol:r,protocol:a}:{candidateType:t,relayProtocol:r,address:n,port:o,protocol:a}}var zi,d7=_t(Dx),u7=mn("Array").values,h7=_o,p7=lr,f7=Dr,_7=u7,_g=Array.prototype,m7={DOMTokenList:!0,NodeList:!0},E7=function(e){var t=e.values;return e===_g||f7(_g,e)&&t===_g.values||p7(m7,h7(e))?_7:t},Vo=_t(E7),c0=ji,g7=Ct,S7=nr,T7=At,mg=K_,v7=nh,y7=x_,R7=fo,C7=V_,cc=Object.assign,l0=Object.defineProperty,I7=g7([].concat),w7=!cc||T7(function(){if(c0&&cc({b:1},cc(l0({},"a",{enumerable:!0,get:function(){l0(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(n){t[n]=n}),cc({},e)[r]!=7||mg(cc({},t)).join("")!=i})?function(e,t){for(var r=R7(e),i=arguments.length,n=1,o=v7.f,a=y7.f;i>n;)for(var s,c=C7(arguments[n++]),l=o?I7(mg(c),o(c)):mg(c),d=l.length,u=0;d>u;)s=l[u++],c0&&!S7(a,c,s)||(r[s]=c[s]);return r}:cc,A7=$r,O7=zM,b7=qa,N7=nr,D7=fo,P7=function(e,t,r,i){try{return i?t(A7(r)[0],r[1]):t(r)}catch(n){O7(e,"throw",n)}},k7=KM,L7=$_,M7=Ko,d0=J_,U7=jy,x7=z_,u0=Array,Xs=Ct,Eg=2147483647,V7=/[^\0-\u007E]/,xx=/[.\u3002\uFF0E\uFF61]/g,h0="Overflow: input needs wider integers to process",p0=RangeError,F7=Xs(xx.exec),Wc=Math.floor,gg=String.fromCharCode,f0=Xs("".charCodeAt),Vx=Xs([].join),oa=Xs([].push),B7=Xs("".replace),j7=Xs("".split),G7=Xs("".toLowerCase),_0=function(e){return e+22+75*(e<26)},W7=function(e,t,r){var i=0;for(e=r?Wc(e/700):e>>1,e+=Wc(e/t);e>455;)e=Wc(e/35),i+=36;return Wc(i+36*e/(e+38))},H7=function(e){var t=[];e=function(S){for(var T=[],y=0,I=S.length;y<I;){var O=f0(S,y++);if(O>=55296&&O<=56319&&y<I){var b=f0(S,y++);(64512&b)==56320?oa(T,((1023&O)<<10)+(1023&b)+65536):(oa(T,O),y--)}else oa(T,O)}return T}(e);var r,i,n=e.length,o=128,a=0,s=72;for(r=0;r<e.length;r++)(i=e[r])<128&&oa(t,gg(i));var c=t.length,l=c;for(c&&oa(t,"-");l<n;){var d=Eg;for(r=0;r<e.length;r++)(i=e[r])>=o&&i<d&&(d=i);var u=l+1;if(d-o>Wc((Eg-a)/u))throw p0(h0);for(a+=(d-o)*u,o=d,r=0;r<e.length;r++){if((i=e[r])<o&&++a>Eg)throw p0(h0);if(i==o){for(var h=a,p=36;;){var g=p<=s?1:p>=s+26?26:p-s;if(h<g)break;var _=h-g,E=36-g;oa(t,gg(_0(g+_%E))),h=Wc(_/E),p+=36}oa(t,gg(_0(h))),s=W7(a,u,l==c),a=0,l++}}a++,o++}return Vx(t,"")},K7=Be,RR=ji,z7=cR,CR=rr,m0=qa,En=Ct,sp=Ja,Yi=Y_,Y7=Hy,uv=lr,IR=w7,lc=function(e){var t=D7(e),r=L7(this),i=arguments.length,n=i>1?arguments[1]:void 0,o=n!==void 0;o&&(n=b7(n,i>2?arguments[2]:void 0));var a,s,c,l,d,u,h=x7(t),p=0;if(!h||this===u0&&k7(h))for(a=M7(t),s=r?new this(a):u0(a);a>p;p++)u=o?n(t[p],p):t[p],d0(s,p,u);else for(d=(l=U7(t,h)).next,s=r?new this:[];!(c=N7(d,l)).done;p++)u=o?P7(l,n,[c.value,p],!0):c.value,d0(s,p,u);return s.length=p,s},vn=Zy,$7=Qy.codeAt,q7=function(e){var t,r,i=[],n=j7(B7(G7(e),xx,"."),".");for(t=0;t<n.length;t++)r=n[t],oa(i,F7(V7,r)?"xn--"+H7(r):r);return Vx(i,".")},Co=Gi,X7=Qa,J7=q_,Fx=fq,Bx=qs,Q7=Bx.set,r_=Bx.getterFor("URL"),Z7=Fx.URLSearchParams,eX=Fx.getState,cd=CR.URL,hv=CR.TypeError,cp=CR.parseInt,tX=Math.floor,E0=Math.pow,tn=En("".charAt),Cn=En(/./.exec),Id=En([].join),rX=En(1 .toString),iX=En([].pop),dc=En([].push),Sg=En("".replace),nX=En([].shift),oX=En("".split),wd=En("".slice),sf=En("".toLowerCase),aX=En([].unshift),Tg="Invalid scheme",ld="Invalid host",g0="Invalid port",jx=/[a-z]/i,sX=/[\d+-.a-z]/i,vg=/\d/,cX=/^0x/i,lX=/^[0-7]+$/,dX=/^\d+$/,S0=/^[\da-f]+$/i,uX=/[\0\t\n\r #%/:<>?@[\\\]^|]/,hX=/[\0\t\n\r #/:<>?@[\\\]^|]/,pX=/^[\u0000-\u0020]+/,fX=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,_X=/[\t\n\r]/g,dd=function(e){var t,r,i,n;if(typeof e=="number"){for(t=[],r=0;r<4;r++)aX(t,e%256),e=tX(e/256);return Id(t,".")}if(typeof e=="object"){for(t="",i=function(o){for(var a=null,s=1,c=null,l=0,d=0;d<8;d++)o[d]!==0?(l>s&&(a=c,s=l),c=null,l=0):(c===null&&(c=d),++l);return l>s&&(a=c,s=l),a}(e),r=0;r<8;r++)n&&e[r]===0||(n&&(n=!1),i===r?(t+=r?":":"::",n=!0):(t+=rX(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},cf={},Gx=IR({},cf,{" ":1,'"':1,"<":1,">":1,"`":1}),Wx=IR({},Gx,{"#":1,"?":1,"{":1,"}":1}),yg=IR({},Wx,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qo=function(e,t){var r=$7(e,0);return r>32&&r<127&&!uv(t,e)?e:encodeURIComponent(e)},lp={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ad=function(e,t){var r;return e.length==2&&Cn(jx,tn(e,0))&&((r=tn(e,1))==":"||!t&&r=="|")},T0=function(e){var t;return e.length>1&&Ad(wd(e,0,2))&&(e.length==2||(t=tn(e,2))==="/"||t==="\\"||t==="?"||t==="#")},mX=function(e){return e==="."||sf(e)==="%2e"},Rg={},v0={},Cg={},y0={},R0={},Ig={},C0={},I0={},dp={},up={},wg={},Ag={},Og={},bg={},w0={},Ng={},uc={},Hn={},A0={},ts={},To={},wR=function(e,t,r){var i,n,o,a=Co(e);if(t){if(n=this.parse(a))throw hv(n);this.searchParams=null}else{if(r!==void 0&&(i=new wR(r,!0)),n=this.parse(a,null,i))throw hv(n);(o=eX(new Z7)).bindURL(this),this.searchParams=o}};wR.prototype={type:"URL",parse:function(e,t,r){var i,n,o,a,s,c=this,l=t||Rg,d=0,u="",h=!1,p=!1,g=!1;for(e=Co(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=Sg(e,pX,""),e=Sg(e,fX,"$1")),e=Sg(e,_X,""),i=lc(e);d<=i.length;){switch(n=i[d],l){case Rg:if(!n||!Cn(jx,n)){if(t)return Tg;l=Cg;continue}u+=sf(n),l=v0;break;case v0:if(n&&(Cn(sX,n)||n=="+"||n=="-"||n=="."))u+=sf(n);else{if(n!=":"){if(t)return Tg;u="",l=Cg,d=0;continue}if(t&&(c.isSpecial()!=uv(lp,u)||u=="file"&&(c.includesCredentials()||c.port!==null)||c.scheme=="file"&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&lp[c.scheme]==c.port&&(c.port=null));u="",c.scheme=="file"?l=bg:c.isSpecial()&&r&&r.scheme==c.scheme?l=y0:c.isSpecial()?l=I0:i[d+1]=="/"?(l=R0,d++):(c.cannotBeABaseURL=!0,dc(c.path,""),l=A0)}break;case Cg:if(!r||r.cannotBeABaseURL&&n!="#")return Tg;if(r.cannotBeABaseURL&&n=="#"){c.scheme=r.scheme,c.path=vn(r.path),c.query=r.query,c.fragment="",c.cannotBeABaseURL=!0,l=To;break}l=r.scheme=="file"?bg:Ig;continue;case y0:if(n!="/"||i[d+1]!="/"){l=Ig;continue}l=dp,d++;break;case R0:if(n=="/"){l=up;break}l=Hn;continue;case Ig:if(c.scheme=r.scheme,n==zi)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=vn(r.path),c.query=r.query;else if(n=="/"||n=="\\"&&c.isSpecial())l=C0;else if(n=="?")c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=vn(r.path),c.query="",l=ts;else{if(n!="#"){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=vn(r.path),c.path.length--,l=Hn;continue}c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=vn(r.path),c.query=r.query,c.fragment="",l=To}break;case C0:if(!c.isSpecial()||n!="/"&&n!="\\"){if(n!="/"){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,l=Hn;continue}l=up}else l=dp;break;case I0:if(l=dp,n!="/"||tn(u,d+1)!="/")continue;d++;break;case dp:if(n!="/"&&n!="\\"){l=up;continue}break;case up:if(n=="@"){h&&(u="%40"+u),h=!0,o=lc(u);for(var _=0;_<o.length;_++){var E=o[_];if(E!=":"||g){var S=Qo(E,yg);g?c.password+=S:c.username+=S}else g=!0}u=""}else if(n==zi||n=="/"||n=="?"||n=="#"||n=="\\"&&c.isSpecial()){if(h&&u=="")return"Invalid authority";d-=lc(u).length+1,u="",l=wg}else u+=n;break;case wg:case Ag:if(t&&c.scheme=="file"){l=Ng;continue}if(n!=":"||p){if(n==zi||n=="/"||n=="?"||n=="#"||n=="\\"&&c.isSpecial()){if(c.isSpecial()&&u=="")return ld;if(t&&u==""&&(c.includesCredentials()||c.port!==null))return;if(a=c.parseHost(u))return a;if(u="",l=uc,t)return;continue}n=="["?p=!0:n=="]"&&(p=!1),u+=n}else{if(u=="")return ld;if(a=c.parseHost(u))return a;if(u="",l=Og,t==Ag)return}break;case Og:if(!Cn(vg,n)){if(n==zi||n=="/"||n=="?"||n=="#"||n=="\\"&&c.isSpecial()||t){if(u!=""){var T=cp(u,10);if(T>65535)return g0;c.port=c.isSpecial()&&T===lp[c.scheme]?null:T,u=""}if(t)return;l=uc;continue}return g0}u+=n;break;case bg:if(c.scheme="file",n=="/"||n=="\\")l=w0;else{if(!r||r.scheme!="file"){l=Hn;continue}if(n==zi)c.host=r.host,c.path=vn(r.path),c.query=r.query;else if(n=="?")c.host=r.host,c.path=vn(r.path),c.query="",l=ts;else{if(n!="#"){T0(Id(vn(i,d),""))||(c.host=r.host,c.path=vn(r.path),c.shortenPath()),l=Hn;continue}c.host=r.host,c.path=vn(r.path),c.query=r.query,c.fragment="",l=To}}break;case w0:if(n=="/"||n=="\\"){l=Ng;break}r&&r.scheme=="file"&&!T0(Id(vn(i,d),""))&&(Ad(r.path[0],!0)?dc(c.path,r.path[0]):c.host=r.host),l=Hn;continue;case Ng:if(n==zi||n=="/"||n=="\\"||n=="?"||n=="#"){if(!t&&Ad(u))l=Hn;else if(u==""){if(c.host="",t)return;l=uc}else{if(a=c.parseHost(u))return a;if(c.host=="localhost"&&(c.host=""),t)return;u="",l=uc}continue}u+=n;break;case uc:if(c.isSpecial()){if(l=Hn,n!="/"&&n!="\\")continue}else if(t||n!="?")if(t||n!="#"){if(n!=zi&&(l=Hn,n!="/"))continue}else c.fragment="",l=To;else c.query="",l=ts;break;case Hn:if(n==zi||n=="/"||n=="\\"&&c.isSpecial()||!t&&(n=="?"||n=="#")){if((s=sf(s=u))===".."||s==="%2e."||s===".%2e"||s==="%2e%2e"?(c.shortenPath(),n=="/"||n=="\\"&&c.isSpecial()||dc(c.path,"")):mX(u)?n=="/"||n=="\\"&&c.isSpecial()||dc(c.path,""):(c.scheme=="file"&&!c.path.length&&Ad(u)&&(c.host&&(c.host=""),u=tn(u,0)+":"),dc(c.path,u)),u="",c.scheme=="file"&&(n==zi||n=="?"||n=="#"))for(;c.path.length>1&&c.path[0]==="";)nX(c.path);n=="?"?(c.query="",l=ts):n=="#"&&(c.fragment="",l=To)}else u+=Qo(n,Wx);break;case A0:n=="?"?(c.query="",l=ts):n=="#"?(c.fragment="",l=To):n!=zi&&(c.path[0]+=Qo(n,cf));break;case ts:t||n!="#"?n!=zi&&(n=="'"&&c.isSpecial()?c.query+="%27":c.query+=n=="#"?"%23":Qo(n,cf)):(c.fragment="",l=To);break;case To:n!=zi&&(c.fragment+=Qo(n,Gx))}d++}},parseHost:function(e){var t,r,i;if(tn(e,0)=="["){if(tn(e,e.length-1)!="]"||(t=function(n){var o,a,s,c,l,d,u,h=[0,0,0,0,0,0,0,0],p=0,g=null,_=0,E=function(){return tn(n,_)};if(E()==":"){if(tn(n,1)!=":")return;_+=2,g=++p}for(;E();){if(p==8)return;if(E()!=":"){for(o=a=0;a<4&&Cn(S0,E());)o=16*o+cp(E(),16),_++,a++;if(E()=="."){if(a==0||(_-=a,p>6))return;for(s=0;E();){if(c=null,s>0){if(!(E()=="."&&s<4))return;_++}if(!Cn(vg,E()))return;for(;Cn(vg,E());){if(l=cp(E(),10),c===null)c=l;else{if(c==0)return;c=10*c+l}if(c>255)return;_++}h[p]=256*h[p]+c,++s!=2&&s!=4||p++}if(s!=4)return;break}if(E()==":"){if(_++,!E())return}else if(E())return;h[p++]=o}else{if(g!==null)return;_++,g=++p}}if(g!==null)for(d=p-g,p=7;p!=0&&d>0;)u=h[p],h[p--]=h[g+d-1],h[g+--d]=u;else if(p!=8)return;return h}(wd(e,1,-1)),!t))return ld;this.host=t}else if(this.isSpecial()){if(e=q7(e),Cn(uX,e)||(t=function(n){var o,a,s,c,l,d,u,h=oX(n,".");if(h.length&&h[h.length-1]==""&&h.length--,(o=h.length)>4)return n;for(a=[],s=0;s<o;s++){if((c=h[s])=="")return n;if(l=10,c.length>1&&tn(c,0)=="0"&&(l=Cn(cX,c)?16:8,c=wd(c,l==8?1:2)),c==="")d=0;else{if(!Cn(l==10?dX:l==8?lX:S0,c))return n;d=cp(c,l)}dc(a,d)}for(s=0;s<o;s++)if(d=a[s],s==o-1){if(d>=E0(256,5-o))return null}else if(d>255)return null;for(u=iX(a),s=0;s<a.length;s++)u+=a[s]*E0(256,3-s);return u}(e),t===null))return ld;this.host=t}else{if(Cn(hX,e))return ld;for(t="",r=lc(e),i=0;i<r.length;i++)t+=Qo(r[i],cf);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return uv(lp,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&Ad(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,i=e.password,n=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,l=t+":";return n!==null?(l+="//",e.includesCredentials()&&(l+=r+(i?":"+i:"")+"@"),l+=dd(n),o!==null&&(l+=":"+o)):t=="file"&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+Id(a,"/"):"",s!==null&&(l+="?"+s),c!==null&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw hv(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Tl(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+dd(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Co(e)+":",Rg)},getUsername:function(){return this.username},setUsername:function(e){var t=lc(Co(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=Qo(t[r],yg)}},getPassword:function(){return this.password},setPassword:function(e){var t=lc(Co(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=Qo(t[r],yg)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?dd(e):dd(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,wg)},getHostname:function(){var e=this.host;return e===null?"":dd(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Ag)},getPort:function(){var e=this.port;return e===null?"":Co(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Co(e))==""?this.port=null:this.parse(e,Og))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Id(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,uc))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Co(e))==""?this.query=null:(tn(e,0)=="?"&&(e=wd(e,1)),this.query="",this.parse(e,ts)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Co(e))!=""?(tn(e,0)=="#"&&(e=wd(e,1)),this.fragment="",this.parse(e,To)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Tl=function(e){var t=Y7(this,Xr),r=J7(arguments.length,1)>1?arguments[1]:void 0,i=Q7(t,new wR(e,!1,r));RR||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},Xr=Tl.prototype,$i=function(e,t){return{get:function(){return r_(this)[e]()},set:t&&function(r){return r_(this)[t](r)},configurable:!0,enumerable:!0}};RR&&(Yi(Xr,"href",$i("serialize","setHref")),Yi(Xr,"origin",$i("getOrigin")),Yi(Xr,"protocol",$i("getProtocol","setProtocol")),Yi(Xr,"username",$i("getUsername","setUsername")),Yi(Xr,"password",$i("getPassword","setPassword")),Yi(Xr,"host",$i("getHost","setHost")),Yi(Xr,"hostname",$i("getHostname","setHostname")),Yi(Xr,"port",$i("getPort","setPort")),Yi(Xr,"pathname",$i("getPathname","setPathname")),Yi(Xr,"search",$i("getSearch","setSearch")),Yi(Xr,"searchParams",$i("getSearchParams")),Yi(Xr,"hash",$i("getHash","setHash"))),sp(Xr,"toJSON",function(){return r_(this).serialize()},{enumerable:!0}),sp(Xr,"toString",function(){return r_(this).serialize()},{enumerable:!0}),cd&&(Dg=cd.createObjectURL,Pg=cd.revokeObjectURL,Dg&&sp(Tl,"createObjectURL",m0(Dg,cd)),Pg&&sp(Tl,"revokeObjectURL",m0(Pg,cd)));var Dg,Pg;X7(Tl,"URL"),K7({global:!0,constructor:!0,forced:!z7,sham:!RR},{URL:Tl});var EX=Be,gX=At,SX=q_,O0=Gi,TX=cR,b0=ai("URL");EX({target:"URL",stat:!0,forced:!(TX&&gX(function(){b0.canParse()}))},{canParse:function(e){var t=SX(arguments.length,1),r=O0(e),i=t<2||arguments[1]===void 0?void 0:O0(arguments[1]);try{return!!new b0(r,i)}catch{return!1}}});var N0=_t(Vn.URL),Ft={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ye(){return Ft}function Hx(){return"setSinkId"in HTMLAudioElement.prototype&&(!w("RESTRICTION_SET_PLAYBACK_DEVICE")||(La()||hx())&&!fR())}function D0(){return!Ft.supportUnifiedPlan||w("CHROME_FORCE_PLAN_B")&&Ga()}var Wt=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function hc(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function Se(e,t,r,i,n){return{width:e,height:t,frameRate:r,bitrateMin:i,bitrateMax:n}}function qi(e,t,r,i,n){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:i,bitrateMax:n}}function kg(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}var vX={"90p":Se(160,90),"90p_1":Se(160,90),"120p":Se(160,120,15,30,65),"120p_1":Se(160,120,15,30,65),"120p_3":Se(120,120,15,30,50),"120p_4":Se(212,120),"180p":Se(320,180,15,30,140),"180p_1":Se(320,180,15,30,140),"180p_3":Se(180,180,15,30,100),"180p_4":Se(240,180,15,30,120),"240p":Se(320,240,15,40,200),"240p_1":Se(320,240,15,40,200),"240p_3":Se(240,240,15,40,140),"240p_4":Se(424,240,15,40,220),"360p":Se(640,360,15,80,400),"360p_1":Se(640,360,15,80,400),"360p_3":Se(360,360,15,80,260),"360p_4":Se(640,360,30,80,600),"360p_6":Se(360,360,30,80,400),"360p_7":Se(480,360,15,80,320),"360p_8":Se(480,360,30,80,490),"360p_9":Se(640,360,15,80,800),"360p_10":Se(640,360,24,80,800),"360p_11":Se(640,360,24,80,1e3),"480p":Se(640,480,15,100,500),"480p_1":Se(640,480,15,100,500),"480p_2":Se(640,480,30,100,1e3),"480p_3":Se(480,480,15,100,400),"480p_4":Se(640,480,30,100,750),"480p_6":Se(480,480,30,100,600),"480p_8":Se(848,480,15,100,610),"480p_9":Se(848,480,30,100,930),"480p_10":Se(640,480,10,100,400),"720p":Se(1280,720,15,120,1130),"720p_auto":Se(1280,720,30,900,3e3),"720p_1":Se(1280,720,15,120,1130),"720p_2":Se(1280,720,30,120,2e3),"720p_3":Se(1280,720,30,120,1710),"720p_5":Se(960,720,15,120,910),"720p_6":Se(960,720,30,120,1380),"1080p":Se(1920,1080,15,120,2080),"1080p_1":Se(1920,1080,15,120,2080),"1080p_2":Se(1920,1080,30,120,3e3),"1080p_3":Se(1920,1080,30,120,3150),"1080p_5":Se(1920,1080,60,120,4780),"1440p":Se(2560,1440,30,120,4850),"1440p_1":Se(2560,1440,30,120,4850),"1440p_2":Se(2560,1440,60,120,7350),"4k":Se(3840,2160,30,120,8910),"4k_1":Se(3840,2160,30,120,8910),"4k_3":Se(3840,2160,60,120,13500)},yX={"480p":qi(640,480,5),"480p_1":qi(640,480,5),"480p_2":qi(640,480,30),"480p_3":qi(640,480,15),"720p":qi(1280,720,5),"720p_auto":Se(1280,720,30,900,3e3),"720p_1":qi(1280,720,5),"720p_2":qi(1280,720,30),"720p_3":qi(1280,720,15),"1080p":qi(1920,1080,5),"1080p_1":qi(1920,1080,5),"1080p_2":qi(1920,1080,30),"1080p_3":qi(1920,1080,15)},RX={"1SL1TL":kg(1,1),"3SL3TL":kg(3,3),"2SL3TL":kg(2,3)};function oo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},vX[e]):e}function Lg(e){return typeof e=="string"?Object.assign({},yX[e]):e}function hp(e){return typeof e=="string"?Object.assign({},RX[e]):e}var CX={speech_low_quality:hc(16e3,!1),speech_standard:hc(32e3,!1,18),music_standard:hc(48e3,!1),standard_stereo:hc(48e3,!0,56),high_quality:hc(48e3,!1,128),high_quality_stereo:hc(48e3,!0,192)};function i_(e){return typeof e=="string"?Object.assign({},CX[e]):e}var Tc=[];function P0(e){return Ot(e,"mediaSource",["screen","window","application"]),!0}var $=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Ye=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),vl=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),IX=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),wX=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),Ns=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),xl=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),tl=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Vl=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),mi=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});var pv={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},fv={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Kx={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},AX={uplinkNetworkQuality:0,downlinkNetworkQuality:0},zx={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},br=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),yi=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),ud=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),vs=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Er=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Kn=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),Mg={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},lf=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Te(e,t,r,i,n){var o,a,s={};return Object.keys(i).forEach(function(c){s[c]=i[c]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=xn(o=d7(a=r.slice()).call(a)).call(o,function(c,l){return l(e,t,c)||c},s),n&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,t,s),s=null),s}function U(e,t,r){return(t=function(i){var n=function(o,a){if(typeof o!="object"||!o)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var c=s.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof n=="symbol"?n:n+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k0(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k0(Object(r),!0).forEach(function(i){U(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Yx=class extends tt{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Ns.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),U(this,"trackMediaType",void 0),U(this,"_ID",void 0),U(this,"_rtpTransceiver",void 0),U(this,"_lowRtpTransceiver",void 0),U(this,"_hints",[]),U(this,"_isClosed",!1),U(this,"_originMediaStreamTrack",void 0),U(this,"mediaStreamTrack",void 0),U(this,"_external",{}),this._ID=t||Fe(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(r){Y(Tc).call(Tc,r)||Tc.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Wa(()=>{var t;Q.reportApiInvoke(null,{name:wt.GET_MEDIA_STREAM_TRACK,options:[],tag:nt.TRACER}).onSuccess(((t=this._mediaStreamTrack)===null||t===void 0?void 0:t.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===vl.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){let t=Tc.indexOf(e);t!==-1&&Tc.splice(t,1)}(this),this.emit(xl.CLOSED),this.removeAllListeners(Ns.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===vl.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Ns.TRANSCEIVER_UPDATED,e,t)}},Hc=class extends Yx{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),U(this,"_enabled",!0),U(this,"_muted",!1),U(this,"_isExternalTrack",!1),U(this,"_isClosed",!1),U(this,"_enabledMutex",void 0),U(this,"processor",void 0),U(this,"_processorContext",void 0),U(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new cr("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return(e=(t=this._originMediaStreamTrack)===null||t===void 0?void 0:t.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,f.debug("[".concat(this.getTrackId(),"] close")),this.emit($.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xe(this,$.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){f.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(xl.TRACK_ENDED)}stateCheck(e,t){if(f.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),Po(t,e),this._enabled&&this._muted&&e==="enabled"&&t===!1)throw new M(R.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",f);if(!this._enabled&&!this._muted&&e==="muted"&&t===!0)throw new M(R.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",f)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():K.resolve([])}},L0=window.AudioContext||window.webkitAudioContext,li=null,ke=new class extends tt{constructor(){super(...arguments),U(this,"prevState",void 0),U(this,"curState",void 0),U(this,"currentTime",void 0),U(this,"currentTimeStuckAt",void 0),U(this,"interruptDetectorTrack",void 0),U(this,"onLocalAudioTrackMute",()=>{f.info("ios15-interruption-start"),this.emit(Wt.IOS_15_16_INTERRUPTION_START)}),U(this,"onLocalAudioTrackUnmute",async()=>{f.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?f.info("ios15-interruption-end-canceled"):(li&&await li.suspend(),this.emit(Wt.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){f.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){f.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Fl(){if(!li){if(function(){if(!L0)return void f.error("your browser is not support web audio");f.info("create audio context");let e=qe({},w("WEBAUDIO_INIT_OPTIONS"));f.debug("audio context init option:",JSON.stringify(e)),li=new L0(e),ke.curState=li.state,li.onstatechange=()=>{ke.prevState=ke.curState,ke.curState=li?li.state:void 0;let{prevState:t,curState:r}=ke,i=r==="running",n=r==="interrupted",o=t==="running",a=t==="suspended",s=t==="interrupted",c=ve().osVersion;(Or()||un())&&o&&n&&(f.info("ios".concat(c,"-interruption-start")),ke.emit(Wt.IOS_INTERRUPTION_START)),(Or()||un())&&(a||s)&&i&&(f.info("ios".concat(c,"-interruption-end")),ke.emit(Wt.IOS_INTERRUPTION_END)),t!==r&&ke.emit(Wt.STATE_CHANGE,r,t)},setInterval(()=>{var t;let r=(t=li)===null||t===void 0?void 0:t.currentTime;ke.currentTime!==r?(ke.currentTimeStuckAt&&(f.debug("AudioContext current time resume at ".concat(r)),ke.currentTimeStuckAt=void 0),ke.currentTime=r):(r!==ke.currentTimeStuckAt&&(Q.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:nt.TRACER}).onSuccess(),f.warning("AudioContext current time stuck at ".concat(r))),ke.currentTimeStuckAt=r)},5e3),async function(t){let r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],i,n=!1,o=!1,a=!1;function s(_){t.state==="running"?c(!1):Or()||un()?t.state==="suspended"&&(c(!0),_&&t.resume().then(l,l)):t.state!=="closed"&&(c(!0),_&&t.resume().then(l,l))}function c(_){if(n!==_){n=_;for(let E=0,S=r;E<S.length;E+=1){let T=S[E];_?window.addEventListener(T,d,{capture:!0,passive:!0}):window.removeEventListener(T,d,{capture:!0,passive:!0})}}}function l(){s(!1)}function d(){s(!0)}function u(_){if(!a)if(i.paused)if(_){let E;h(!1),a=!0;try{E=i.play(),E?E.then(p,p):(i.addEventListener("playing",p),i.addEventListener("abort",p),i.addEventListener("error",p))}catch{p()}}else h(!0);else h(!1)}function h(_){if(o!==_){o=_;for(let E=0,S=r;E<S.length;E++){let T=S[E];_?window.addEventListener(T,g,{capture:!0,passive:!0}):window.removeEventListener(T,g,{capture:!0,passive:!0})}}}function p(){i.removeEventListener("playing",p),i.removeEventListener("abort",p),i.removeEventListener("error",p),a=!1,u(!1)}function g(){u(!0)}if(Or()){let _=t.createMediaStreamDestination(),E=document.createElement("div");E.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=E.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=_.stream,u(!0)}ke.on(Wt.STATE_CHANGE,function(){s(!0)}),s(!1)}(li)}(),!li)throw new M(R.NOT_SUPPORTED,"can not create audio context");return li}return li}function cs(e){if(function(){if(Ug!==null)return Ug;let i=Fl(),n=i.createBufferSource(),o=i.createGain(),a=i.createGain();n.connect(o),n.connect(a),n.disconnect(o);let s=!1;try{n.disconnect(o)}catch{s=!0}return n.disconnect(),Ug=s,s}())return;let t=e.connect,r=e.disconnect;e.connect=(i,n,o)=>{var a;return e._inputNodes||(e._inputNodes=[]),Y(a=e._inputNodes).call(a,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,n,o)):t.call(e,i,n)),e},e.disconnect=(i,n,o)=>{r.call(e),i?t_(e._inputNodes,i):e._inputNodes=[];for(let a of e._inputNodes)t.call(e,a)}}var Ug=null;function AR(e,t){let r=!1,i=1/t;if(w("DISABLE_WEBAUDIO")){let n=window.setInterval(()=>{r?window.clearInterval(n):e(performance.now()/1e3)},1e3*i)}else{let n=Fl(),o=n.createGain();o.gain.value=0,o.connect(n.destination);let a=()=>{if(r)return void(o=null);let s=n.createOscillator();s.onended=a,s.connect(o),s.start(0),s.stop(n.currentTime+i),e(n.currentTime)};a()}return()=>{r=!0}}var $x=class{constructor(){U(this,"context",void 0),U(this,"analyserNode",void 0),U(this,"sourceNode",void 0),this.context=Fl(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Or()||un()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<e.length;++i)e[i]=r[i]/128-1}let t=xn(e).call(e,(r,i)=>r+i*i,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(t=this.sourceNode)===null||t===void 0||t.connect(this.analyserNode)}catch{f.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}},qx=class extends tt{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(t=this._processedNode)===null||t===void 0||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),U(this,"outputNode",void 0),U(this,"outputTrack",void 0),U(this,"isPlayed",!1),U(this,"sourceNode",void 0),U(this,"context",void 0),U(this,"audioBufferNode",void 0),U(this,"destNode",void 0),U(this,"audioOutputLevel",0),U(this,"volumeLevelAnalyser",void 0),U(this,"_processedNode",void 0),U(this,"playNode",void 0),U(this,"isDestroyed",!1),U(this,"onNoAudioInput",void 0),U(this,"isNoAudioInput",!1),U(this,"_noAudioInputCount",0),this.context=Fl(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),cs(this.outputNode),this.volumeLevelAnalyser=new $x}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t=>{this.emit(mi.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){let n=r.outputBuffer.getChannelData(i);for(let o=0;o<n.length;o+=1)n[o]=0}return r.inputBuffer}(t))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ye().webAudioMediaStreamDest)throw new M(R.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&nm(()=>{ke.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Or()||un()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let t=this.volumeLevelAnalyser.getAnalyserNode(),r;t.getFloatTimeDomainData?(r=new Float32Array(t.fftSize),t.getFloatTimeDomainData(r)):(r=new Uint8Array(t.fftSize),t.getByteTimeDomainData(r));let i=!1;for(let n=0;n<r.length;n++)r[n]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await zt(200),await this.checkHasAudioInput(e?e+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;(e=this.processedNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}},Xx=class extends qx{get isFreeze(){return!1}constructor(e,t,r){var i;if(super(),U(this,"sourceNode",void 0),U(this,"track",void 0),U(this,"clonedTrack",void 0),U(this,"audioElement",void 0),U(this,"isCurrentTrackCloned",!1),U(this,"isRemoteTrack",!1),U(this,"originVolumeLevelAnalyser",void 0),U(this,"rebuildWebAudio",async()=>{if(f.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void f.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>f.info("resume success")),f.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let a=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?a.stop():this.isCurrentTrackCloned=!0;let s=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(s),cs(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let c=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(c,this.context.currentTime),cs(this.outputNode),this.emit(mi.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=s,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new M(R.UNEXPECTED_ERROR);this.track=e;let n=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(n),cs(this.sourceNode),r){let a=r.clone();a.enabled=!0,this.clonedTrack=a,f.debug("create an unmuted track ".concat(a.id," from the original track ").concat(r.id," to get the volume"));let s=this.context.createMediaStreamSource(new MediaStream([a]));cs(s),this.originVolumeLevelAnalyser=new $x,this.originVolumeLevelAnalyser.updateSource(s)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=n;let o=ve();t&&o.os===Lt.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(ke.on(Wt.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(a=>{a||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),cs(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(mi.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),ke.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),f.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let r=this.context.createMediaStreamSource(new MediaStream([t]));cs(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}};async function Jx(e,t,r){let i=(o,a)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||a:o:a,n={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(n.video.mandatory.maxFrameRate=t.frameRate.max,n.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(n.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(n)}async function OX(e,t){let r=await Qx(e.mediaSource),{sourceId:i,audio:n}=await function(o){let a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new K((s,c)=>{let l=document.createElement("div");l.innerText="share screen",l.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let d=document.createElement("div");d.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let u=document.createElement("div");u.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",u.setAttribute("style","height: 12%;");let h=document.createElement("div");h.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let p=document.createElement("div");p.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let g=document.createElement("button");g.innerHTML="cancel",g.setAttribute("style","width: 85px;"),g.onclick=()=>{document.body.removeChild(S);let T=new Error("NotAllowedError");T.name="NotAllowedError",c(T)};let _=a,E=document.createElement("div");if(a){let T=document.createElement("input");T.setAttribute("type","checkbox");let y=document.createElement("span");T.setAttribute("style","margin-right: 6px;"),y.innerText="Share audio",T.checked=_,T.onchange=()=>{_=T.checked},E.appendChild(T),E.appendChild(y)}p.appendChild(E),p.appendChild(g),d.appendChild(u),d.appendChild(h),d.appendChild(p);let S=document.createElement("div");S.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),S.appendChild(l),S.appendChild(d),document.body.appendChild(S),o.map(T=>{if(T.id){let y=document.createElement("div");y.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let I=T.thumbnail;try{let{width:O}=I.getSize();O>1920&&(I=I.resize({width:1920}))}catch(O){throw O&&O.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),O}y.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+I.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+T.name.replace(/[\u00A0-\u9999<>\&]/g,function(O){return"&#"+O.charCodeAt(0)+";"})+"</span>",y.onclick=()=>{document.body.removeChild(S),s({sourceId:T.id,audio:_})},h.appendChild(y)}})})}(r,t);return await Jx(i,e,n)}async function Qx(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let r=vx();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new M(R.ELECTRON_IS_NULL);let i=null;try{var n;i=((n=r.desktopCapturer)===null||n===void 0?void 0:n.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new K((o,a)=>{r.desktopCapturer.getSources({types:t},(s,c)=>{s?a(s):o(c)})}));try{return await i}catch(o){throw new M(R.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}var _v=new cr("safari"),Zx=!1,eV=!1;async function fi(e,t){let r=0,i=null;for(;r<2;)try{i=await bX(e,t,r>0);break}catch(n){if(n instanceof M)throw f.error("[".concat(t,"] ").concat(n.toString())),n;let o=df(n.name||n.code||n,n.message);if(o.code===R.MEDIA_OPTION_INVALID){f.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await zt(500);continue}throw f.error("[".concat(t,"] ").concat(o.toString())),o}if(!i)throw new M(R.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function bX(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new M(R.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let i=ye(),n=new MediaStream;if(e.audioSource&&n.addTrack(e.audioSource),e.videoSource&&n.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return f.debug("Using Video Source/ Audio Source"),n;if(e.screen)if(vx())e.screen.sourceId?pc(n,await Jx(e.screen.sourceId,e.screen,e.screenAudio)):pc(n,await OX(e.screen,e.screenAudio));else if(La()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new M(R.NOT_SUPPORTED,"This browser does not support screen sharing");f.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let h=await(a=e.screen.extensionId,s=t,new K((p,g)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},_=>{if(!_||!_.streamId)return f.error("[".concat(s,"] No response from Chrome Plugin. Plugin not installed properly"),_),void g(new M(R.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));p(_.streamId)})}catch(_){f.error("[".concat(s,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),_.toString()),g(new M(R.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=h,pc(n,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var o;e.screen.mediaSource&&P0(e.screen.mediaSource);let h={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(o=e.screen.displaySurface)!==null&&o!==void 0?o:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:p,surfaceSwitching:g,systemAudio:_}=e.screen,E={selfBrowserSurface:p,surfaceSwitching:g,systemAudio:_};!p&&delete E.selfBrowserSurface,!g&&delete E.surfaceSwitching,!_&&delete E.systemAudio,f.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:h,audio:!!e.screenAudio,controls:E})),pc(n,await navigator.mediaDevices.getDisplayMedia(qe({video:h,audio:!!e.screenAudio},E)))}else{if(!ot())throw f.error("[".concat(t,"] This browser does not support screenSharing")),new M(R.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&P0(e.screen.mediaSource);let h={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};f.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(h))),pc(n,await navigator.mediaDevices.getUserMedia(h))}}var a,s;if(!e.video&&!e.audio)return n;let c={video:e.video,audio:e.audio},l=w("MEDIA_DEVICE_CONSTRAINTS");if(l)try{typeof l=="string"&&(l=JSON.parse(l)),c=ov(c,l)}catch{}f.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),ve();let d,u=null;(er()||Or()||e_())&&(u=await _v.lock());try{d=await navigator.mediaDevices.getUserMedia(c)}catch(h){throw u&&u(),h}return c.audio&&(Zx=!0),c.video&&(eV=!0),pc(n,d),u&&u(),n}function df(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new M(R.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new M(R.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new M(R.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new M(R.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new M(R.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new M(R.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return f.error("getUserMedia unexpected error",e),new M(R.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function pc(e,t){let r=e.getVideoTracks()[0],i=e.getAudioTracks()[0],n=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(i&&e.removeTrack(i),e.addTrack(o)),n&&(r&&e.removeTrack(r),e.addTrack(n))}var gi=new class extends tt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(vs.STATE_CHANGE,e),this._state=e)}constructor(){super(),U(this,"_state",ud.IDLE),U(this,"isAccessMicrophonePermission",!1),U(this,"isAccessCameraPermission",!1),U(this,"lastAccessMicrophonePermission",!1),U(this,"lastAccessCameraPermission",!1),U(this,"checkdeviceMatched",!1),U(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(w("ENUMERATE_DEVICES_INTERVAL")||(rm()||tm()===Lt.HARMONY_OS)&&Ga())&&this.updateDevicesInfo()},w("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>f.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new M(R.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let i=await navigator.mediaDevices.enumerateDevices(),n=this.checkMediaDeviceInfoIsOk(i),o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;n.audio&&(o=!1),n.video&&(a=!1);let s=null,c=null,l=null;if(!r&&(o||a)){if(_v.isLocked&&(f.debug("[device manager] wait GUM lock"),(await _v.lock())(),f.debug("[device manager] GUM unlock")),Zx&&(o=!1,this.isAccessMicrophonePermission=!0),eV&&(a=!1,this.isAccessCameraPermission=!0),f.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(d){let u=df(d.name||d.code||d,d.message);if(u.code===R.PERMISSION_DENIED)throw u;f.warning("getUserMedia failed in getDevices",u)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(d){let u=df(d.name||d.code||d,d.message);if(u.code===R.PERMISSION_DENIED)throw u;f.warning("getUserMedia failed in getDevices",u)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(d){let u=df(d.name||d.code||d,d.message);if(u.code===R.PERMISSION_DENIED)throw u;f.warning("getUserMedia failed in getDevices",u)}this.isAccessCameraPermission=!0}f.debug("[device manager] mic permission",e,"cam permission",t)}try{let d=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach(u=>u.stop()),c&&c.getTracks().forEach(u=>u.stop()),l&&l.getTracks().forEach(u=>u.stop()),s=null,c=null,l=null,d}catch(d){return s&&s.getTracks().forEach(u=>u.stop()),c&&c.getTracks().forEach(u=>u.stop()),l&&l.getTracks().forEach(u=>u.stop()),s=null,c=null,l=null,new M(R.ENUMERATE_DEVICES_FAILED,d.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new M(R.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=ud.INITING;try{await this.updateDevicesInfo(),this.state=ud.INITEND}catch(e){throw f.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=ud.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new M(R.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let n=e.find(a=>a.kind==="audioinput"&&a.deviceId==="default"),o=e.find(a=>a.kind==="audiooutput"&&a.deviceId==="default");n&&o?o.groupId===n.groupId?f.debug("[device-check] default input ".concat(n.label," and output ").concat(o.label," is the same group")):f.warning("[device-check] default input ".concat(n.label," and output ").concat(o.label," is not the same group")):f.debug("[device-check] default input or output not found")}let i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(n=>{if(!n.deviceId)return;let o=this.deviceInfoMap.get("".concat(n.kind,"_").concat(n.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){let a={initAt:t,updateAt:t,device:n,state:"ACTIVE"};this.deviceInfoMap.set("".concat(n.kind,"_").concat(n.deviceId),a),r.push(a)}o&&(o.updateAt=t)}),this.deviceInfoMap.forEach((n,o)=>{n.state==="ACTIVE"&&n.updateAt!==t&&(n.state="INACTIVE",r.push(n))}),this.state!==ud.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(n=>{switch(n.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(vs.RECORDING_DEVICE_CHANGED,n);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(vs.CAMERA_DEVICE_CHANGED,n);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(vs.PLAYOUT_DEVICE_CHANGED,n)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(n=>n.kind==="audioinput"),r=e.filter(n=>n.kind==="videoinput"),i={audio:!1,video:!1};for(let n of t)if(n.label&&n.deviceId){i.audio=!0;break}for(let n of r)if(n.label&&n.deviceId){i.video=!0;break}return i}},xg=!1,di=new class extends tt{constructor(){super(...arguments),U(this,"onAutoplayFailed",void 0),U(this,"onAudioAutoplayFailed",void 0)}};function tV(){if(ve(),!xg){let e=t=>{t.preventDefault(),xg=!1,Du()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};xg=!0,Du()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),f.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),di.onAutoplayFailed?di.onAutoplayFailed():di.onAudioAutoplayFailed?f.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):f.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),di.emit("autoplay-failed")}}function rV(e,t,r,i){if(!e)return;let n=Q.getBaseInfoBySessionId(e);if(!n)return;let o=n.info,a=Date.now(),s=qe(qe({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:a,elapse:a-n.startTime,cbRegistered:di.onAutoplayFailed||di.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:i,extend:void 0});Q.send({type:Ze.AUTOPLAY_FAILED,data:s},!0)}var NX=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Mr=new class{constructor(){U(this,"onAutoplayFailed",void 0),U(this,"elementMap",new Map),U(this,"elementStateMap",new Map),U(this,"elementsNeedToResume",[]),U(this,"sinkIdMap",new Map),U(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t,n=this.elementStateMap.get(r),o=i.srcObject.getAudioTracks()[0],a=o&&o.readyState;if(f.debug("resume after interrupted, ele: ".concat(n," audio: ").concat(a," ").concat(e)),a==="live"){if(e)return i.pause(),void i.play();if(ke.curState==="running")return El()?(i.pause(),void i.play()):void(n&&n==="paused"&&i.play())}})}),U(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e,i=r.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(f.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),ke.on(Wt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.on(Wt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ke.on(Wt.STATE_CHANGE,()=>{Or()&&ke.prevState==="suspended"&&ke.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(i){throw new M(R.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,r,i){if(this.elementMap.has(t))return;let n=document.createElement("audio");n.autoplay=!0,n.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,n),this.elementMap.set(t,n),this.elementStateMap.set(t,Er.INIT),this.setVolume(t,r);let o=this.sinkIdMap.get(t);if(o)try{n.setSinkId(o).catch(s=>{f.warning("[".concat(t,"] set sink id failed"),s.toString())})}catch(s){f.warning("[".concat(t,"] set sink id failed"),s.toString())}let a=n.play();a&&a.then&&a.catch(s=>{i&&rV(i,"audio",s.message,t),f.warning("audio element play warning",s.toString()),this.elementMap.has(t)&&s.name==="NotAllowedError"&&(f.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(n),nm(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),tV()}))})}updateTrack(e,t){let r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){NX.forEach(r=>{t.addEventListener(r,i=>{let n=this.elementStateMap.get(e),o=i.type==="pause"?"paused":i.type;if(f.debug("[".concat(e,"] audio-element-status change ").concat(n," => ").concat(o)),i.type==="error"){let a=t==null?void 0:t.error;a&&f.error("[".concat(e,"] media error, code: ").concat(a.code,", message: ").concat(a.message))}this.elementStateMap.set(e,o)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{f.debug("Auto resume audio element success")}).catch(r=>{f.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new K(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Du()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function ft(){return function(e,t,r){let i=r.value;return typeof i=="function"&&(r.value=function(){this._isClosed&&new M(R.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",f);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];let s=i.apply(this,o);return s instanceof K?new K((c,l)=>{s.then(c).catch(l)}):s}),r}}var iV=class extends tt{constructor(e){super(),U(this,"name","VideoProcessorDestination"),U(this,"ID","0"),U(this,"_source",void 0),U(this,"videoContext",void 0),U(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new M(R.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new M(R.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(br.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(br.ON_TRACK,void 0)}},nV=class extends tt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),U(this,"constraintsMap",new Map),U(this,"statsRegistry",[]),U(this,"usageRegistry",[]),U(this,"trackId",void 0),U(this,"direction",void 0),U(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await tr(this,yi.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var r;return f.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),xe(this,yi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return f.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),xe(this,yi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vo(t=this.constraintsMap).call(t)))}registerStats(e,t,r){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:r})}unregisterStats(e,t){let r=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===t);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:r,type:i,cb:n}of this.statsRegistry)try{let o=n();e.push({processorID:t,processorName:r,type:i,stats:o})}catch(o){f.error(new M(R.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,t){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let r=t();r instanceof K&&(r=await r),e.push(qe(qe({},r),{},{direction:this.direction}))}catch(r){f.error("gather extension usage error",r)}return e}getDirection(){return this.direction}},oV=class extends tt{constructor(e){super(),U(this,"name","AudioProcessorDestination"),U(this,"ID","0"),U(this,"inputTrack",void 0),U(this,"inputNode",void 0),U(this,"audioProcessorContext",void 0),U(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new M(R.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new M(R.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(br.ON_TRACK,void 0),this.emit(br.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(br.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(br.ON_NODE,this.inputNode))}},aV=class extends tt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,r){super(),U(this,"constraintsMap",new Map),U(this,"statsRegistry",[]),U(this,"audioContext",void 0),U(this,"trackId",void 0),U(this,"direction",void 0),U(this,"usageRegistry",[]),U(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=r}async getConstraints(){return tr(this,yi.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var r;return f.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),xe(this,yi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),xe(this,yi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vo(t=this.constraintsMap).call(t)))}registerStats(e,t,r){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:r})}unregisterStats(e,t){let r=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===t);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:r,type:i,cb:n}of this.statsRegistry)try{let o=n();e.push({processorID:t,processorName:r,type:i,stats:o})}catch(o){f.error(new M(R.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,t){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let r=t();r instanceof K&&(r=await r),e.push(qe(qe({},r),{},{direction:this.direction}))}catch(r){f.error("gather extension usage error",r)}return e}getDirection(){return this.direction}},mv=class extends tt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),U(this,"context",void 0),U(this,"processSourceNode",void 0),U(this,"outputTrack",void 0),U(this,"processedNode",void 0),U(this,"clonedTrack",void 0),U(this,"outputNode",void 0),this.outputNode=new DX}setVolume(){}createOutputTrack(){throw new M(R.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}},DX=class{disconnect(){}connect(){}};function sV(e){return new K((t,r)=>{let i=!1,n=document.createElement("video");n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.muted=!0,n.autoplay=!0,n.setAttribute("playsinline",""),n.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(n);let o=Or()?"canplay":"playing";n.addEventListener(o,()=>{let a=n.videoWidth,s=n.videoHeight;!a&&ot()||(i=!0,n.srcObject=null,n.remove(),t([a,s]))}),n.srcObject=new MediaStream([e]),n.play().catch(om),setTimeout(()=>{i||(n.srcObject=null,n.remove(),t([n.videoWidth,n.videoHeight]))},4e3)})}function n_(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let r=oo(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!gx()&&r.frameRate&&(t.frameRate=r.frameRate),hx()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),ot()&&(t.frameRate={ideal:30,max:30}),t}function M0(e){let t={};if(gx()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,La()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){let r=i_(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),rm()&&(t.sampleRate=void 0),t}var PX=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:r,width:i,height:n}=e.getMediaStreamTrackSettings(),{frameRate:o=r,width:a=i,height:s=n}=t;if(!o||!a||!s)return;a=ng(a),s=ng(s),o=ng(o);let{max:c,min:l}=function(p,g,_){let E=200*Math.pow(_/15,.6)*Math.pow(p*g/640/360,.75);return{min:Math.floor(E),max:Math.floor(4*E)}}(a,s,o),{bitrateMax:d,bitrateMin:u}=t||{};d||f.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(d,", brMin: ").concat(u,"]"));let{maxFramerate:h}=w("ENCODER_CONFIG_LIMIT");return h&&typeof h=="number"&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:d||c,bitrateMin:u||l,scaleResolutionDownBy:1,scale:0}},cV=async(e,t,r)=>await(async(i,n,o)=>{let a=function(l){let d=[];for(let u=0;u<l.length;u+=2)d.push(parseInt(l.slice(u,u+2),16));return Uint8Array.from(d)}(Ix(""+n+o)).slice(0,16),s=a.slice(0,12),c=await window.crypto.subtle.importKey("raw",a,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},c,i))})(e.buffer,t,r),OR=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new K((r,i)=>{t.toBlob(async n=>{if(t.remove(),n){let o=await lV(n);r({buffer:o,width:t.width,height:t.height})}else i(new M(R.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},lV=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)},U0,x0,V0,F0,B0,j0,G0,W0,H0,K0,z0,Y0,$0,q0,X0,J0,Q0,Z0,Xe,eb,tb,rb,ib,nb,ob,zn,ab,sb,cb,lb,db,ub,hb,pb,fb,_b,mb,Eb,gb,$t,it=(U0=re({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),x0=re({argsMap:(e,t)=>[e.getTrackId(),t]}),V0=ft(),F0=gl("LocalAudioTrack","_enabledMutex"),B0=re({argsMap:(e,t)=>[e.getTrackId(),t]}),j0=ft(),G0=gl("LocalAudioTrack","_enabledMutex"),W0=re({argsMap:(e,t)=>[e.getTrackId(),t]}),H0=ft(),K0=ft(),z0=ft(),Y0=re({argsMap:e=>[e.getTrackId()]}),$0=ft(),q0=re({argsMap:e=>[e.getTrackId()]}),X0=ft(),J0=re({argsMap:e=>[e.getTrackId()]}),Q0=re({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Z0=re({argsMap:e=>[e.getTrackId()]}),Te((Xe=class extends Hc{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Mr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,i){super(e,r),U(this,"trackMediaType",Vl.AUDIO),U(this,"_encoderConfig",void 0),U(this,"_trackSource",void 0),U(this,"_enabled",!0),U(this,"_volume",100),U(this,"_useAudioElement",!0),U(this,"_bypassWebAudio",!1),U(this,"processor",void 0),U(this,"_processorContext",void 0),U(this,"_processorDestination",void 0),U(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new mv,w("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),w("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),er()&&!li?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Me(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Mr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void f.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,xe(this,$.NEED_REPLACE_TRACK,this).then(()=>{f.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{f.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!Hx())throw new M(R.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Mr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(f.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await xe(this,$.NEED_ENABLE_TRACK,this),f.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw r||(this._enabled=!1),f.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await xe(this,$.NEED_DISABLE_TRACK,this)}catch(i){throw r||(this._enabled=!0),f.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,f.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await xe(this,$.NEED_MUTE_TRACK,this):await xe(this,$.NEED_UNMUTE_TRACK,this))}getStats(){return Wa(()=>{f.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Mi(this,$.GET_STATS)||qe({},pv)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(mi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(mi.ON_AUDIO_BUFFER),this._source.on(mi.ON_AUDIO_BUFFER,r=>e(r))}play(){f.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(f.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Mr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){f.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Mr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];f.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Mr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xe(this,$.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return K.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new M(R.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new M(R.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(br.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await xe(this,$.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xe(this,$.NEED_REPLACE_TRACK,this))}),e.on(br.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(br.ON_TRACK),e.removeAllListeners(br.ON_NODE)}bindProcessorContextEvents(e){e.on(yi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(yi.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof mv&&(this._trackSource=new Xx(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new aV(this._source.context,this.getTrackId(),"local"),t=new oV(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(mi.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Mr.stop(this.getTrackId()),this._source.play()),xe(this,$.NEED_REPLACE_MIXING_TRACK,this).then(()=>{f.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{f.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[U0],Object.getOwnPropertyDescriptor(Xe.prototype,"setVolume"),Xe.prototype),Te(Xe.prototype,"setPlaybackDevice",[x0,V0],Object.getOwnPropertyDescriptor(Xe.prototype,"setPlaybackDevice"),Xe.prototype),Te(Xe.prototype,"setEnabled",[F0,B0,j0],Object.getOwnPropertyDescriptor(Xe.prototype,"setEnabled"),Xe.prototype),Te(Xe.prototype,"setMuted",[G0,W0,H0],Object.getOwnPropertyDescriptor(Xe.prototype,"setMuted"),Xe.prototype),Te(Xe.prototype,"getStats",[K0],Object.getOwnPropertyDescriptor(Xe.prototype,"getStats"),Xe.prototype),Te(Xe.prototype,"setAudioFrameCallback",[z0],Object.getOwnPropertyDescriptor(Xe.prototype,"setAudioFrameCallback"),Xe.prototype),Te(Xe.prototype,"play",[Y0,$0],Object.getOwnPropertyDescriptor(Xe.prototype,"play"),Xe.prototype),Te(Xe.prototype,"stop",[q0,X0],Object.getOwnPropertyDescriptor(Xe.prototype,"stop"),Xe.prototype),Te(Xe.prototype,"close",[J0],Object.getOwnPropertyDescriptor(Xe.prototype,"close"),Xe.prototype),Te(Xe.prototype,"pipe",[Q0],Object.getOwnPropertyDescriptor(Xe.prototype,"pipe"),Xe.prototype),Te(Xe.prototype,"unpipe",[Z0],Object.getOwnPropertyDescriptor(Xe.prototype,"unpipe"),Xe.prototype),Xe),o_=(eb=re({argsMap:(e,t)=>[e.getTrackId(),t]}),tb=ft(),rb=gl("MicrophoneAudioTrack","_enabledMutex"),ib=re({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),nb=ft(),ob=re({argsMap:e=>[e.getTrackId()]}),Te((zn=class extends it{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,i){super(e,t.encoderConfig?i_(t.encoderConfig):{},i,w("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),U(this,"_config",void 0),U(this,"_deviceName","default"),U(this,"_constraints",void 0),U(this,"_originalConstraints",void 0),U(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(El()||rv())&&ke.bindInterruptDetectorTrack(this)}async setDevice(e){if(f.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await gi.getDeviceById(e),r={};r.audio=qe({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await fi(r,this.getTrackId())}catch(n){throw f.error("[".concat(this.getTrackId(),"] setDevice failed"),n.toString()),i=await fi({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),n}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw f.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await gi.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw f.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}f.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return f.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(f.info("[".concat(this.getTrackId(),"] start setEnabled"),e),w("AUTO_RESET_AUDIO_ROUTE")&&(Or()||un())){let a=navigator.audioSession;a&&(e||(a.type="playback"),a.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),r||(this._enabled=!1);try{await xe(this,$.NEED_DISABLE_TRACK,this)}catch(a){throw f.error("[".concat(this.getTrackId(),"] setEnabled false failed"),a.toString()),a}return}let n=qe({},this._constraints),o=gi.searchDeviceIdByName(this._deviceName);o&&!n.deviceId&&(n.deviceId=o);try{r||(this._enabled=!0);let a=await fi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),await xe(this,$.NEED_ENABLE_TRACK,this)}catch(a){throw r||(this._enabled=!1),f.error("[".concat(this.getTrackId(),"] setEnabled true failed"),a.toString()),a}f.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(El()||rv())&&ke.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Or()||un())&&this._enabled&&!this._isClosed&&ke.duringInterruption){let e=async()=>{ke.off(Wt.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(f.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ke.on(Wt.IOS_INTERRUPTION_END,e)}else f.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(xl.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=gi.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let i=await fi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(yi.REQUEST_UPDATE_CONSTRAINTS,async(t,r,i)=>{try{let n=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(n),r()}catch(n){i(n)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(yi.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[eb,tb],Object.getOwnPropertyDescriptor(zn.prototype,"setDevice"),zn.prototype),Te(zn.prototype,"setEnabled",[rb,ib,nb],Object.getOwnPropertyDescriptor(zn.prototype,"setEnabled"),zn.prototype),Te(zn.prototype,"close",[ob],Object.getOwnPropertyDescriptor(zn.prototype,"close"),zn.prototype),zn),kX=(ab=re({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),sb=ft(),cb=re({argsMap:e=>[e.getTrackId()]}),lb=ft(),db=re({argsMap:e=>[e.getTrackId()]}),ub=ft(),hb=re({argsMap:e=>[e.getTrackId()]}),pb=ft(),fb=re({argsMap:e=>[e.getTrackId()]}),_b=ft(),mb=re({argsMap:e=>[e.getTrackId()]}),Eb=re({argsMap:e=>[e.getTrackId()]}),gb=ft(),Te(($t=class extends it{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,i){super(t.createOutputTrack(),r,i),U(this,"source",void 0),U(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(mi.AUDIO_SOURCE_STATE_CHANGE,n=>{this.safeEmit(xl.SOURCE_STATE_CHANGE,n)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Me(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[ab,sb],Object.getOwnPropertyDescriptor($t.prototype,"startProcessAudioBuffer"),$t.prototype),Te($t.prototype,"pauseProcessAudioBuffer",[cb,lb],Object.getOwnPropertyDescriptor($t.prototype,"pauseProcessAudioBuffer"),$t.prototype),Te($t.prototype,"seekAudioBuffer",[db,ub],Object.getOwnPropertyDescriptor($t.prototype,"seekAudioBuffer"),$t.prototype),Te($t.prototype,"resumeProcessAudioBuffer",[hb,pb],Object.getOwnPropertyDescriptor($t.prototype,"resumeProcessAudioBuffer"),$t.prototype),Te($t.prototype,"stopProcessAudioBuffer",[fb,_b],Object.getOwnPropertyDescriptor($t.prototype,"stopProcessAudioBuffer"),$t.prototype),Te($t.prototype,"close",[mb],Object.getOwnPropertyDescriptor($t.prototype,"close"),$t.prototype),Te($t.prototype,"setAudioBufferPlaybackSpeed",[Eb,gb],Object.getOwnPropertyDescriptor($t.prototype,"setAudioBufferPlaybackSpeed"),$t.prototype),$t),kt=class dV extends it{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=Fl().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Fe(8,"track-mix-")),U(this,"trackList",void 0),U(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(f.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):f.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){f.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}t_(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof dV?r.emit(Ns.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}},LX=class extends qx{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(mi.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),U(this,"audioBuffer",void 0),U(this,"sourceNode",void 0),U(this,"startPlayTime",0),U(this,"startPlayOffset",0),U(this,"pausePlayTime",0),U(this,"options",void 0),U(this,"currentLoopCount",0),U(this,"currentPlaybackSpeed",100),U(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):f.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}},Sb=new Map,bR=class{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(f.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,(t=this.onVideoStateChanged)===null||t===void 0||t.call(this,this.videoState))}constructor(e){U(this,"trackId",void 0),U(this,"config",void 0),U(this,"onFirstVideoFrameDecoded",void 0),U(this,"onVideoStateChanged",void 0),U(this,"freezeTimeCounterList",[]),U(this,"renderFreezeAccTime",0),U(this,"isKeepLastFrame",!1),U(this,"timeUpdatedCount",0),U(this,"freezeTime",0),U(this,"playbackTime",0),U(this,"lastTimeUpdatedTime",0),U(this,"autoplayFailed",!1),U(this,"videoTrack",void 0),U(this,"videoElement",void 0),U(this,"cacheVideoElement",void 0),U(this,"renderStats",void 0),U(this,"_videoState",Kn.VideoStateStopped),U(this,"videoElementCheckInterval",void 0),U(this,"videoElementFreezeTimeout",void 0),U(this,"_videoElementStatus",Er.NONE),U(this,"isGettingVideoDimensions",!1),U(this,"startGetVideoDimensions",()=>{let t=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return f.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t,500)};!this.isGettingVideoDimensions&&t()}),U(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ke.curState==="running"&&(f.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(AO())),DO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),U(this,"handleVideoEvents",t=>{switch(t.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Er.PLAYING;break;case"loadeddata":if(this.videoState=Kn.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Er.CANPLAY;break;case"stalled":this.videoElementStatus=Er.STALLED;break;case"suspend":this.videoElementStatus=Er.SUSPEND;break;case"pause":this.videoElementStatus=Er.PAUSED,Or()||un()||er()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(f.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Er.WAITING;break;case"abort":this.videoElementStatus=Er.ABORT;break;case"ended":this.videoElementStatus=Er.ENDED;break;case"emptied":this.videoElementStatus=Er.EMPTIED;break;case"error":{let r=this.videoElement.error;r?(this.videoElementStatus=Er.ERROR,f.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")"))):f.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);let i=r-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Io.lastVisibleTime<Io.lastHiddenTime||n<Io.lastHiddenTime||n<Io.lastVisibleTime)return;for(i>w("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;let o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),U(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(f.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(AO())),DO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),ke.on(Wt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.on(Wt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch(i=>{e&&rV(e,"video",i.message,this.trackId),i.name==="NotAllowedError"?(f.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):f.warning("[".concat(this.trackId,"] play warning: "),i)});let r=ve();if((r.name==="Safari"&&Number(r.version)===15||El())&&t&&t.then){let i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(i).catch(i)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return f.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let r=t.getImageData(0,0,e.width,e.height);return e.remove(),r}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;let i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new K((n,o)=>{r.toBlob(async a=>{if(r.remove(),a){let s=await lV(a);n({buffer:s,width:r.width,height:r.height})}else o(new M(R.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await OR(e)}destroy(){this.renderStats=void 0,ke.off(Wt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.off(Wt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Kn.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Er.INIT,!this.videoElementCheckInterval&&(Tb.forEach(n=>{this.videoElement.addEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(n){return n!==document.body&&document.body.contains(n)})(this.videoElement)||(this.videoElementStatus=Er.DESTROYED)},1e3),w("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n,o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(a,w("VIDEO_FREEZE_DURATION")))},a=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Kn.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Kn.VideoStateFrozen:document.addEventListener("visibilitychange",o))},s=(c,l)=>{if(this.videoElementStatus===Er.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=l.mediaTime):this.renderStats={lastTs:l.mediaTime,curTs:l.mediaTime,lastRenderNum:0,renderNum:0},n){let h=l.presentationTime-n.presentationTime;this.videoState===Kn.VideoStateStarting&&(this.videoState=Kn.VideoStateDecoding),this.videoState===Kn.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a,w("VIDEO_FREEZE_DURATION"))),h<w("VIDEO_FREEZE_DURATION")&&this.videoState===Kn.VideoStateFrozen&&(this.videoState=Kn.VideoStateDecoding),h>w("VIDEO_FREEZE_DURATION")&&Io.lastVisibleTime>=Io.lastHiddenTime&&n.timestamp>Io.lastVisibleTime&&n.timestamp>Io.lastHiddenTime&&(this.renderFreezeAccTime+=h)}n=qe(qe({},l),{},{timestamp:c})}var d,u;w("ENABLE_VIDEO_FRAME_CALLBACK")&&((d=(u=this.videoElement).requestVideoFrameCallback)===null||d===void 0||d.call(u,s))};(e=(t=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(t,s)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),rm()&&!w("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let r=ve();r.name==="Safari"&&Number(r.version)===15||El()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ot()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ot()&&this.videoElement.load());let i=this.videoElement.play();i!==void 0&&i.catch(n=>{f.debug("[".concat(this.trackId,"] playback interrupted"),n.toString())})}resetVideoElement(){Tb.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Er.NONE}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{f.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{f.error(r)}),this.autoplayFailed=!1,Du()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Du()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),tV()}},Tb=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],uV=class extends bR{constructor(e){super(e),U(this,"container",void 0),U(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,r):await OR(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",w("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}},vb,yb,Rb,Cb,Ib,wb,Ab,Ob,bb,Nb,Db,Pb,kb,Lb,Mb,Ub,xb,Vb,Fb,Bb,jb,Gb,Wb,Hb,Ee,Kb,zb,Yb,$b,qb,Xb,Jb,Qb,ci,We=(vb=re({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),yb=ft(),Rb=re({argsMap:e=>[e.getTrackId()]}),Cb=gl("LocalVideoTrack","_enabledMutex"),Ib=re({argsMap:(e,t)=>[e.getTrackId(),t]}),wb=ft(),Ab=gl("LocalVideoTrack","_enabledMutex"),Ob=re({argsMap:(e,t)=>[e.getTrackId(),t]}),bb=ft(),Nb=re({argsMap:(e,t)=>[e.getTrackId(),t]}),Db=ft(),Pb=ft(),kb=re({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),Lb=ft(),Mb=ft(),Ub=ft(),xb=ft(),Vb=ft(),Fb=ft(),Bb=ft(),jb=re({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Gb=re({argsMap:e=>[e.getTrackId()]}),Wb=re({argsMap:e=>[e.getTrackId()]}),Hb=re({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),Ee=class hV extends Hc{get videoHeight(){if(er()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(er()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Er.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,i,n,o,a){if(super(t,o),U(this,"trackMediaType",Vl.VIDEO),U(this,"_player",void 0),U(this,"isUseScaleResolutionDownBy",!1),U(this,"_videoVisibleTimer",null),U(this,"_previousVideoVisibleStatus",void 0),U(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),U(this,"_encoderConfig",void 0),U(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),U(this,"_optimizationMode",void 0),U(this,"_videoHeight",void 0),U(this,"_videoWidth",void 0),U(this,"_forceBitrateLimit",void 0),U(this,"_enabled",!0),U(this,"_processorDestination",void 0),U(this,"_processorContext",void 0),er()){let{width:s,height:c}=t.getSettings();this._videoWidth=s,this._videoHeight=c}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=i,this._optimizationMode=n,this._hints=a||[],this._hints.indexOf(Ye.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(s,c,l){let d=ve();return!(d.name!==s||!d.osVersion)&&Number(d.version)===c}(Ne.CHROME,115)&&tm().indexOf("Windows")!==-1){let s=function(c,l){if("VideoFrame"in window&&"TransformStream"in window&&ye().supportWebRTCInsertableStream){let d=new MediaStreamTrackProcessor(c),u=new MediaStreamTrackGenerator({kind:"video"}),h,p,g=Date.now(),_=()=>{E&&(clearInterval(E),E=void 0),h&&(h.close(),h=void 0),c.stop(),p=void 0,u.removeEventListener("ended",_)},E=window.setInterval(()=>{if(p&&h&&Date.now()-g>1e3)try{u.readyState==="live"?p.enqueue(h.clone()):_()}catch{_()}},1e3),S=new TransformStream({transform:(T,y)=>{u.readyState==="live"?(p=y,g=Date.now(),h===void 0?(h=T,y.enqueue(T.clone())):(y.enqueue(h),h=T)):T.close()}});return u.addEventListener("ended",_),d.readable.pipeThrough(S).pipeTo(u.writable),u}}(t);s&&(f.info("local screen video track begin to inject frame"),this._mediaStreamTrack=s)}r&&this._hints.indexOf(Ye.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new nV(this.getTrackId(),"local"),this._processorDestination=new iV(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let n=document.getElementById(t);n?t=n:(f.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}f.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));let i=qe(qe(qe({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new bR(i):this._player=new uV(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let n=this.getVideoElementVisibleStatus();this.safeEmit(xl.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},w("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,f.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(f.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await xe(this,$.NEED_DISABLE_TRACK,this)}catch(i){throw f.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return r||(this._enabled=!1),void f.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await xe(this,$.NEED_ENABLE_TRACK,this)}catch(i){throw f.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}f.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,f.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await xe(this,$.NEED_MUTE_TRACK,this):await xe(this,$.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,r){if(!this._enabled)throw new M(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=oo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let i=n_({encoderConfig:t});(er()||Or()||un())&&(i.deviceId=void 0),f.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(n){let o=new M(R.UNEXPECTED_ERROR,n.toString());throw f.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=t,this._hints.indexOf(Ye.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xe(this,$.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(f)}}getStats(){return Wa(()=>{f.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Mi(this,$.GET_STATS)||qe({},fv)}async setBeautyEffect(t){f.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await OR(t)}async setBitrateLimit(t){if(f.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await xe(this,$.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(f)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void f.error(R.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let r=this._optimizationMode;try{this._optimizationMode=t,await xe(this,$.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=r,f.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}f.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return f.error(R.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,f.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){sV(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(om)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new M(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");f.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=oo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Ye.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xe(this,$.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(f)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:r,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!r||!i)return;let{bitrateMax:n,bitrateMin:o}=this._encoderConfig;if(o==null||n==null){let{max:a,min:s}=function(c,l,d,u,h){let p=w("BITRATE_ADAPTER_TYPE");if(p==="DEFAULT_BITRATE")return{min:u,max:h};if(h===void 0){var g;let E=Math.floor(200*Math.pow(d/15,.6)*Math.pow(c*l/640/360,.75));h=p==="STANDARD_BITRATE"?4*E:2*E,u=(g=u)!==null&&g!==void 0?g:E}else{var _;u=(_=u)!==null&&_!==void 0?_:Math.floor(h/10)}return{min:u,max:h}}(t,r,i,o,n);this._encoderConfig.bitrateMin=s,this._encoderConfig.bitrateMax=a,f.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(i,"] => [brMax: ").concat(a,", brMin: ").concat(s,"]"))}}getVideoElementVisibleStatus(){try{var t,r;let i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),n={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:o,slot:a}=n;if(this.isPlaying&&o instanceof HTMLVideoElement&&a instanceof HTMLElement){let s=Tx.checkOneElementVisible(o),c=Object.assign({},s);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;let l=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(i){throw new M(R.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new M(R.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=qe(qe({},i),oo(t))),i=Ss(i);let n=Fe(8,"track-video-cloned-"),o=new hV(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Ss(this._scalabilityMode),this._optimizationMode,n,Ss(this._hints));return t&&i&&o.setEncoderConfiguration(i),f.debug("clone video track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(r)),o}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new M(R.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new M(R.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Wa(()=>{Q.reportApiInvoke(null,{name:wt.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:nt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!w("ENABLE_VIDEO_SEI")||!w("ENABLE_ENCODED_TRANSFORM"))return void f.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new M(R.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let r=this.getRTCRtpTransceiver();if(!r)return void f.warning("Video track is not published, SEI can not be send");let i=r.sender.getParameters();if(i.codecs.length===0)return;let n=i.codecs[0].mimeType.toLocaleLowerCase();n==="video/h264"?this.safeEmit("sei-to-send",t):f.warning("SEI is not supported by ".concat(n))}bindProcessorDestinationEvents(){this.processorDestination.on(br.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await xe(this,$.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xe(this,$.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(br.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yi.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yi.REQUEST_CONSTRAINTS)}},Te(Ee.prototype,"play",[vb,yb],Object.getOwnPropertyDescriptor(Ee.prototype,"play"),Ee.prototype),Te(Ee.prototype,"stop",[Rb],Object.getOwnPropertyDescriptor(Ee.prototype,"stop"),Ee.prototype),Te(Ee.prototype,"setEnabled",[Cb,Ib,wb],Object.getOwnPropertyDescriptor(Ee.prototype,"setEnabled"),Ee.prototype),Te(Ee.prototype,"setMuted",[Ab,Ob,bb],Object.getOwnPropertyDescriptor(Ee.prototype,"setMuted"),Ee.prototype),Te(Ee.prototype,"setEncoderConfiguration",[Nb,Db],Object.getOwnPropertyDescriptor(Ee.prototype,"setEncoderConfiguration"),Ee.prototype),Te(Ee.prototype,"getStats",[Pb],Object.getOwnPropertyDescriptor(Ee.prototype,"getStats"),Ee.prototype),Te(Ee.prototype,"setBeautyEffect",[kb,Lb],Object.getOwnPropertyDescriptor(Ee.prototype,"setBeautyEffect"),Ee.prototype),Te(Ee.prototype,"getCurrentFrameData",[Mb],Object.getOwnPropertyDescriptor(Ee.prototype,"getCurrentFrameData"),Ee.prototype),Te(Ee.prototype,"getCurrentFrameImage",[Ub],Object.getOwnPropertyDescriptor(Ee.prototype,"getCurrentFrameImage"),Ee.prototype),Te(Ee.prototype,"setBitrateLimit",[xb],Object.getOwnPropertyDescriptor(Ee.prototype,"setBitrateLimit"),Ee.prototype),Te(Ee.prototype,"setOptimizationMode",[Vb],Object.getOwnPropertyDescriptor(Ee.prototype,"setOptimizationMode"),Ee.prototype),Te(Ee.prototype,"setScalabiltyMode",[Fb],Object.getOwnPropertyDescriptor(Ee.prototype,"setScalabiltyMode"),Ee.prototype),Te(Ee.prototype,"updateMediaStreamTrackResolution",[Bb],Object.getOwnPropertyDescriptor(Ee.prototype,"updateMediaStreamTrackResolution"),Ee.prototype),Te(Ee.prototype,"pipe",[jb],Object.getOwnPropertyDescriptor(Ee.prototype,"pipe"),Ee.prototype),Te(Ee.prototype,"unpipe",[Gb],Object.getOwnPropertyDescriptor(Ee.prototype,"unpipe"),Ee.prototype),Te(Ee.prototype,"close",[Wb],Object.getOwnPropertyDescriptor(Ee.prototype,"close"),Ee.prototype),Te(Ee.prototype,"replaceTrack",[Hb],Object.getOwnPropertyDescriptor(Ee.prototype,"replaceTrack"),Ee.prototype),Ee),Ev=(Kb=re({argsMap:(e,t)=>[e.getTrackId(),t]}),zb=ft(),Yb=gl("CameraVideoTrack","_enabledMutex"),$b=re({argsMap:(e,t)=>[e.getTrackId(),t]}),qb=ft(),Xb=re({argsMap:(e,t)=>[e.getTrackId(),t]}),Jb=ft(),Qb=re({argsMap:e=>[e.getTrackId()]}),ci=class pV extends We{get __className__(){return"CameraVideoTrack"}constructor(t,r,i,n,o,a){super(t,oo(r.encoderConfig),n,o,a),U(this,"_config",void 0),U(this,"_originalConstraints",void 0),U(this,"_constraints",void 0),U(this,"_enabled",!0),U(this,"_deviceName","default"),U(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(El()||rv())&&!function(){let s=ve();if(s.os!==Lt.IOS||!s.osVersion)return!1;let c=s.osVersion.split(".");return Number(c[0])===15&&Number(c[1])>=2}()&&Ex()&&this._enabled&&!this._isClosed&&(f.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=oo(this._config.encoderConfig),ke.on(Wt.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ke.on(Wt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(f.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let r=await gi.getDeviceById(t),i={};i.video=qe({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let n=null;try{n=await fi(i,this.getTrackId())}catch(o){throw f.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),n=await fi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw f.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{let r=await gi.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw f.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}f.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){f.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let r={video:qe(qe({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await fi(r,this.getTrackId())}catch(n){throw f.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),n.toString()),i=await fi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),n}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=qe({},r.video),f.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(f.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let i=await fi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await xe(this,$.NEED_ENABLE_TRACK,this)}catch(i){throw f.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),f.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await xe(this,$.NEED_DISABLE_TRACK,this)}catch(i){throw f.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}f.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new M(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=oo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let i=Et(this._config);i.encoderConfig=t;let n=n_(i);(er()||Or()||un())&&(n.deviceId=void 0),f.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(o){let a=new M(R.UNEXPECTED_ERROR,o.toString());throw f.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=i,this._constraints=n,this._originalConstraints=n,this._encoderConfig=t,this._hints.indexOf(Ye.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xe(this,$.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(f)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Or()||un())&&this._enabled&&!this._isClosed&&ke.duringInterruption){let t=async()=>{ke.off(Wt.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(f.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ke.on(Wt.IOS_INTERRUPTION_END,t)}else f.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(xl.TRACK_ENDED)}async renewMediaStreamTrack(t){let r=t||this._constraints,i=gi.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId={exact:i}),this._enabled){let n=await fi({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ke.off(Wt.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ke.off(Wt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=qe(qe({},i),oo(t))),i=Ss(i);let n=Fe(8,"track-cam-cloned-"),o=new pV(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ss(qe(qe({},this._config),{},{encoderConfig:i})),Ss(this._constraints),Ss(this._scalabilityMode),this._optimizationMode,n);return t&&i&&o.setEncoderConfiguration(i),f.debug("clone track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(r)),o}bindProcessorContextEvents(){this.processorContext.on(yi.REQUEST_UPDATE_CONSTRAINTS,async(t,r,i)=>{try{let n=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(n),r()}catch(n){i(n)}}),this.processorContext.on(yi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Te(ci.prototype,"setDevice",[Kb,zb],Object.getOwnPropertyDescriptor(ci.prototype,"setDevice"),ci.prototype),Te(ci.prototype,"setEnabled",[Yb,$b,qb],Object.getOwnPropertyDescriptor(ci.prototype,"setEnabled"),ci.prototype),Te(ci.prototype,"setEncoderConfiguration",[Xb,Jb],Object.getOwnPropertyDescriptor(ci.prototype,"setEncoderConfiguration"),ci.prototype),Te(ci.prototype,"close",[Qb],Object.getOwnPropertyDescriptor(ci.prototype,"close"),ci.prototype),ci);function Vg(e,t,r,i){r.optimizationMode&&(i&&i.width&&i.height?(r.encoderConfig=qe(qe({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?f.debug("[".concat(e,"] set content hint to"),r.optimizationMode):f.debug("[".concat(e,"] set content hint failed")))):f.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Zb,eN,tN,rN,Ii,iN,nN,oN,aN,sN,cN,fr,fV=class extends Yx{getUserId(){return this._userId}constructor(e,t,r,i){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(i.clientId,"_").concat(Fe(5,""))),U(this,"_userId",void 0),U(this,"_uintId",void 0),U(this,"_isDestroyed",!1),U(this,"store",void 0),U(this,"processor",void 0),U(this,"processorContext",void 0),this._userId=t,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,f.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}},rl=(Zb=re({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),eN=re({argsMap:e=>[e.getTrackId()]}),tN=re({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rN=re({argsMap:e=>[e.getTrackId()]}),Te((Ii=class extends fV{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Er.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,i){super(e,t,r,i),U(this,"_videoVisibleTimer",null),U(this,"_previousVideoVisibleStatus",void 0),U(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),U(this,"trackMediaType",Vl.VIDEO),U(this,"_videoWidth",void 0),U(this,"_videoHeight",void 0),U(this,"_player",void 0),U(this,"processorDestination",void 0),U(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new nV(this.getTrackId(),"remote"),this.processorDestination=new iV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wa(()=>{f.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Mi(this,$.GET_STATS)||qe({},zx)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let i=document.getElementById(e);i?e=i:(f.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}f.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=qe(qe({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new bR(r):this._player=new uV(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(tl.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(tl.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i=this.getVideoElementVisibleStatus();this.safeEmit(tl.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},w("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,f.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){sV(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(om)}_updatePlayerSource(){f.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:n,slot:o}=i;if(this.isPlaying&&n instanceof HTMLVideoElement&&o instanceof HTMLElement){let a=Tx.checkOneElementVisible(n),s=Object.assign({},a);if(s.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=s.visible;let c=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});s.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(s.reason))}return s}return}catch(r){throw new M(R.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new M(R.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(br.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(br.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ns.SEI_RECEIVED,e)}}).prototype,"play",[Zb],Object.getOwnPropertyDescriptor(Ii.prototype,"play"),Ii.prototype),Te(Ii.prototype,"stop",[eN],Object.getOwnPropertyDescriptor(Ii.prototype,"stop"),Ii.prototype),Te(Ii.prototype,"pipe",[tN],Object.getOwnPropertyDescriptor(Ii.prototype,"pipe"),Ii.prototype),Te(Ii.prototype,"unpipe",[rN],Object.getOwnPropertyDescriptor(Ii.prototype,"unpipe"),Ii.prototype),Ii),il=(iN=re({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),nN=re({argsMap:(e,t)=>[e.getTrackId(),t]}),oN=re({argsMap:e=>[e.getTrackId()]}),aN=re({argsMap:e=>[e.getTrackId()]}),sN=re({argsMap:(e,t)=>[e.getTrackId(),t.name]}),cN=re({argsMap:e=>[e.getTrackId()]}),Te((fr=class extends fV{get isPlaying(){return this._useAudioElement?Mr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,i){super(e,t,r,i),U(this,"trackMediaType",Vl.AUDIO),U(this,"_source",void 0),U(this,"_useAudioElement",!0),U(this,"_volume",100),U(this,"processorContext",void 0),U(this,"processorDestination",void 0),U(this,"_played",!1),U(this,"_bypassWebAudio",!1),w("DISABLE_WEBAUDIO")?(this._source=new mv,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Xx(e,!0),w("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(mi.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(tl.FIRST_FRAME_DECODED)}),this.processorContext=new aV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new oV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(mi.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(mi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(mi.ON_AUDIO_BUFFER),this._source.on(mi.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?Mr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!Hx())throw new M(R.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Mr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Wa(()=>{f.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Mi(this,$.GET_STATS)||qe({},Kx)}play(){f.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(f.debug("[".concat(this.getTrackId(),"] use audio element to play")),Mr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){f.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Mr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];f.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Mr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new M(R.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new M(R.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new M(R.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(br.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(br.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(br.ON_TRACK),this.processorDestination.removeAllListeners(br.ON_NODE)}}).prototype,"setVolume",[iN],Object.getOwnPropertyDescriptor(fr.prototype,"setVolume"),fr.prototype),Te(fr.prototype,"setPlaybackDevice",[nN],Object.getOwnPropertyDescriptor(fr.prototype,"setPlaybackDevice"),fr.prototype),Te(fr.prototype,"play",[oN],Object.getOwnPropertyDescriptor(fr.prototype,"play"),fr.prototype),Te(fr.prototype,"stop",[aN],Object.getOwnPropertyDescriptor(fr.prototype,"stop"),fr.prototype),Te(fr.prototype,"pipe",[sN],Object.getOwnPropertyDescriptor(fr.prototype,"pipe"),fr.prototype),Te(fr.prototype,"unpipe",[cN],Object.getOwnPropertyDescriptor(fr.prototype,"unpipe"),fr.prototype),fr),Io=new class extends tt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),U(this,"_lastHiddenTime",0),U(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),f.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}},_V=class extends tt{constructor(e,t){super(),U(this,"trackMediaType",Vl.DATA),U(this,"_version",1),U(this,"_type",3),U(this,"_config",void 0),U(this,"_originDataChannel",void 0),U(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),U(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),U(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return w("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new K((e,t)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();let r=setTimeout(()=>{var i;t(new M(R.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new M(R.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new M(R.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[lf.OPEN,lf.CLOSE,lf.ERROR].forEach(t=>{let r=()=>{this.emit(t)};this._datachannelEventMap.set(t,r),e.addEventListener(t,r)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[r,i]=t;e.removeEventListener(r,i)}),this._datachannelEventMap.clear()}},MX=class extends _V{constructor(e){super(e),U(this,"_messageListener",void 0),this._messageListener=t=>{if(t.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let r=t.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(w("SHOW_DATASTREAM2_LOG")&&f.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let n=t.data.slice(this._dataStreamPacketHeader.byteLength);n=this._dataStreamPacketHandler.deserialize(n),this.emit(lf.MESSAGE,n)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}},UX=class extends _V{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);let r=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}};function uf(){let e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>N0.revokeObjectURL(e),0),new Worker(N0.createObjectURL(e))}var pp=new Map,fp=new Map;function xX(e,t,r){let i=new Uint8Array(e,t,r),n=[],o=0;for(;n.length<r;)o+3<r&&i[o]===0&&i[o+1]===0&&i[o+2]===3&&(i[o+3]===0||i[o+3]===1||i[o+3]===2||i[o+3]===3)?(n.push(i[o],i[o+1],i[o+3]),o+=4):(n.push(i[o]),o++);return new Uint8Array(n)}var _p=new Map;async function VX(e,t){if(!ye().supportWebRTCEncodedTransform)return void f.warning("browser not support video encoded transform");if(_p.has(e)||!e.track)return;let r={track:e.track};if(La()){if(!e.createEncodedStreams)return void f.warning("browser not support createEncodedStreams() API");let n=null;try{n=e.createEncodedStreams()}catch(s){return void f.error("create video-encoded-streams error",s&&s.message)}let o=[];t.on("sei-to-send",s=>{o.push(s)});let a=new TransformStream({transform(s,c){r.controller||(r.controller=c),e.track&&e.track.id!==r.track.id&&(f.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let l=o.shift();l&&(s.data=function(d,u){let h=function(T){let y=T.length,I=[],O=0;for(;O<y;)O+2<y&&T[O]===0&&T[O+1]===0&&(T[O+2]===0||T[O+2]===1||T[O+2]===2||T[O+2]===3)?(I.push(T[O],T[O+1],3,T[O+2]),O+=3):(I.push(T[O]),O++);return new Uint8Array(I)}(u),p=h.length,g=Math.floor(p/255),_=p%255,E=new Uint8Array(6+g+1+p+d.byteLength);E[0]=0,E[1]=0,E[2]=0,E[3]=1,E[4]=6,E[5]=101;let S=0;for(;S<g;)E[6+S]=255,S++;return E[6+S]=_,S++,E.set(h,6+S),E.set(new Uint8Array(d),6+S+p),E.buffer}(s.data,l)),c.enqueue(s)}});n.readable.pipeThrough(a).pipeTo(n.writable)}else{if(!er())return;{if(typeof RTCRtpScriptTransform>"u")return void f.warning("browser not support RTCRtpScriptTransform");let n=uf(),o=new MessageChannel;await new K(s=>n.onmessage=c=>{c.data==="registered"&&s(void 0)});let a=new RTCRtpScriptTransform(n,{name:"tx",port:o.port2},[o.port2]);e.transform=a,await new K(s=>n.onmessage=c=>{c.data==="started"&&s(void 0)}),t.on("sei-to-send",s=>{o.port1.postMessage({sei:s})}),o.port1.onmessage=s=>{var c;s.data.transformed&&e.track&&((c=e.track)===null||c===void 0?void 0:c.id)!==r.track.id&&(f.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i))},r.worker=n}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let n=_p.get(e);if(n){_p.delete(e);try{var o,a;(o=n.controller)===null||o===void 0||o.terminate(),(a=n.worker)===null||a===void 0||a.terminate()}catch(s){f.warning(s&&s.message)}}}_p.set(e,r),e.track.addEventListener("ended",i)}var hd=new Map;(function(){let e=ve();Ft.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ft.getStreamFromExtension=e.name===Ne.CHROME&&Number(e.version)>34,Ft.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),Ft.supportMinBitrate=e.name===Ne.CHROME||e.name===Ne.EDGE,Ft.supportSetRtpSenderParameters=function(){let t=ve();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ga()||!(!er()&&!e_())||t.name===Ne.FIREFOX&&Number(t.version)>=64)}(),e.name===Ne.SAFARI&&(Number(e.version)>=14?Ft.supportDualStream=!0:Ft.supportDualStream=!1),Ft.webAudioMediaStreamDest=function(){let t=ve();return!(t.name===Ne.SAFARI&&Number(t.version)<12)}(),Ft.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ft.supportWebGL=typeof WebGLRenderingContext<"u",Ft.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ga()||(Ft.webAudioWithAEC=!0),Ft.supportShareAudio=function(){let t=ve();return(t.os===Lt.WIN_10||t.os===Lt.WIN_81||t.os===Lt.WIN_7||t.os===Lt.LINUX||t.os===Lt.MAC_OS||t.os===Lt.CHROMIUM_OS)&&t.name===Ne.CHROME&&Number(t.version)>=74}(),Ft.supportDataChannel=!!(tv(76)||function(t){let r=ve();return!(r.name!==Ne.FIREFOX||!r.osVersion)&&Number(r.version)>=t}(68)||fx(14)),Ft.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!ot()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Ft.supportWebRTCEncodedTransform=function(){let t=ve();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),Ft.supportWebRTCInsertableStream=function(){let t=ve();return(t.name===Ne.CHROME||t.name===Ne.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ft.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ft.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,nm(()=>{Ft.supportDualStreamEncoding=function(){let t=ve();return!!w("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&w("CHROME_DUAL_STREAM_USE_ENCODING"))}(),f.info("browser compatibility",JSON.stringify(Ft),JSON.stringify(e))})})();var a_=class gv extends tt{constructor(t,r){super(),v(this,"signal",void 0),v(this,"token",void 0),v(this,"tokenTimeout",void 0),v(this,"tokenInterval",void 0),v(this,"_sequence",0),v(this,"userMap",new Map),v(this,"encoder",new TextEncoder),this.signal=t,this.token=r;let i=()=>{this.signal.connectionState===Ve.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*w("P2P_TOKEN_INTERVAL"))};i()}async send(t,r,i,n,o){var a,s,c;if(this.userMap.size===0)return;let l=Array.from(Vo(a=this.userMap).call(a))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),n=(s=n)!==null&&s!==void 0?s:Fe(6,""),o=(c=o)!==null&&c!==void 0?c:this._sequence++;let d={_id:n,_type:t,_seq:o,_message:r,token:"".concat(this.token,"_").concat(l)};w("SHOW_P2P_LOG")&&f.debug("send message",d,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(d)).forEach(h=>{this.signal.request(ne.DATA_STREAM,{payload:Ma(this.encoder.encode(h))})});let u=new K((h,p)=>{let g=window.setTimeout(()=>{this.off("res-@".concat(n,"_ack"),_),this.off("res-@".concat(n),S),this.off(sc.ABORT,E),f.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(n)),this.userMap.size===0?p(new M(R.INVALID_REMOTE_USER)):p(new M(R.TIMEOUT))},w("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),_=()=>{g&&window.clearTimeout(g),this.off(sc.ABORT,E),i&&h()},E=()=>{g&&window.clearTimeout(g),this.off("res-@".concat(n,"_ack"),_),this.off("res-@".concat(n),S),p(new M(R.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(n)))};this.once(sc.ABORT,E),this.once("res-@".concat(n,"_ack"),_);let S=(y,I)=>{T=!0,g&&window.clearTimeout(g),this.off("res-@".concat(n,"_ack"),_),this.off(sc.ABORT,E),y==="success"?h(I):p(new M(R.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(n)))},T=!1;i||(this.once("res-@".concat(n),S),zt(w("SIGNAL_REQUEST_TIMEOUT")).then(()=>{T||f.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(n,", ").concat(d))}))});try{return await u}catch(h){if(h.code===R.TIMEOUT)return await this.send(t,r,i,n,o);throw h}}onMessage(t){var r;let{_uid:i}=t,n,o=this.userMap.get(i);if(o)n=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==ut.CHECK)return;let{token:l}=t;n=new Map,o={uid:i,isStart:!0,token:l,splitMessageMap:n,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,o),this.signal.emit(_e.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var a;let{id:l,total:d}=t,u=(a=n.get(l))!==null&&a!==void 0?a:[];if(u.push(t),n.has(l)||n.set(l,u),u.length!==d)return;{let h=lh(u).call(u,(p,g)=>p.index-g.index).map(p=>p.payload).join("");n.delete(l),(t=JSON.parse(h))._uid=i}}let{_type:s,token:c}=t;if(Y(r=[ut.ACK,ut.CHECK]).call(r,s))return s===ut.CHECK&&this.handleCheckToken(o,c),void this.receiveMessage(t);c==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(t):f.debug('Receive unexpected message", '.concat(c,", cur_token: ").concat(o.token,"_").concat(this.token),t)}check(){let t={_id:Fe(6,""),token:this.token,_type:ut.CHECK};w("SHOW_P2P_LOG")&&f.debug("send message",t),this.signal.request(ne.DATA_STREAM,{payload:Ma(this.encoder.encode(JSON.stringify(t)))})}ack(t){let r={_id:t,_type:ut.ACK,token:this.token};w("SHOW_P2P_LOG")&&f.debug("send message",r),this.signal.request(ne.DATA_STREAM,{payload:Ma(this.encoder.encode(JSON.stringify(r)))})}response(t,r,i){this.send(ut.RESPONSE,JSON.stringify({success:!i,message:r}),!0,t)}handleReceivedMessage(t){let r=()=>{this.userMap.forEach(l=>{let{receivedMessagesMap:d,nextExpectedSequenceNumber:u}=l;for(;d.has(u);){let h=d.get(u);d.delete(u),this.receiveMessage(h),l.nextExpectedSequenceNumber++}})};if(!t)return void r();let{_uid:i,_seq:n}=t,o=this.userMap.get(i),{receivedMessagesMap:a,isStart:s,nextExpectedSequenceNumber:c}=o;if(n<c)return this.ack(t._id),void f.debug("[external-signal] receive old message, seq: ".concat(n,", ").concat(t._message));a.set(n,t),s&&n===c&&(this.receiveMessage(t),a.delete(c),o.nextExpectedSequenceNumber++,r())}receiveMessage(t){let{_id:r,_type:i,_message:n,_uid:o}=t;if(w("SHOW_P2P_LOG")&&f.debug("receive message",t),r){let a;switch(t._type!==ut.ACK&&(n&&(a=JSON.parse(n)),this.ack(t._id)),t._type){case ut.CANDIDATE:case ut.CONTROL:this.signal.emit(i,a,o);break;case ut.PUBLISH:case ut.UNPUBLISH:case ut.RESTART_ICE:case ut.CALL:a.uid=o,tr(this.signal,i,a).then(s=>{this.response(t._id,s)}).catch(()=>{this.response(t._id,void 0,!0)});break;case ut.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case ut.RESPONSE:{let{success:s,message:c}=a;this.emit("res-@".concat(r),s?"success":"failed",c);break}}}}splitMessage(t){if(t.length<gv.MAX_MESSAGE_SIZE)return[t];let r=[],{remoteToken:i}=JSON.parse(t),n=Fe(6,""),o=0,a=800,s=Math.ceil(t.length/a);for(;t.length>0;){o++;let c={id:n,index:o,total:s,payload:t.slice(0,a),token:"".concat(this.token,"_").concat(i)};JSON.stringify(c).length>gv.MAX_MESSAGE_SIZE?a-=50:(r.push(c),t=t.slice(a))}return r.map(c=>JSON.stringify(c))}handleCheckToken(t,r){return t.token!==r?(f.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{f.debug("token timeout, ".concat(r)),this.reset(t.uid)},w("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await tr(this.signal,ut.CALL,void 0),r=await this.send(ut.CALL,t);this.signal.emit(oe.P2P_CONNECTION,r,!0)}async reset(t,r){let i=this.userMap.get(t);i&&(this.emit(sc.ABORT),this.signal.emit(_e.ON_USER_OFFLINE,{uid:i.uid,reason:e7.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(f.debug("change local token from ".concat(r," to ").concat(r)),this.token=Fe(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(sc.ABORT)}};v(a_,"MAX_SIZE",1),v(a_,"MAX_MESSAGE_SIZE",1024);var lN=class extends tt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Ve.CONNECTED?this.emit(oe.WS_CONNECTED):e===Ve.RECONNECTING?this.emit(oe.WS_RECONNECTING,this._websocketReconnectReason):e===Ve.CLOSED&&this.emit(oe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),v(this,"_disconnectedReason",void 0),v(this,"_websocketReconnectReason",void 0),v(this,"_connectionState",Ve.CLOSED),v(this,"reconnectToken",void 0),v(this,"p2pToken",void 0),v(this,"websocket",void 0),v(this,"openConnectionTime",void 0),v(this,"clientId",void 0),v(this,"lastMsgTime",Date.now()),v(this,"uploadCache",[]),v(this,"uploadCacheInterval",void 0),v(this,"rttRolling",new wx(5)),v(this,"pingpongTimer",void 0),v(this,"pingpongTimeoutCount",0),v(this,"joinResponse",void 0),v(this,"multiIpOption",void 0),v(this,"initError",void 0),v(this,"spec",void 0),v(this,"store",void 0),v(this,"_external_signal",void 0),v(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(oe.ON_BINARY_DATA,r.data);let i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let n="res-@".concat(i._id);this.emit(n,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case _e.ON_DATA_STREAM:return void this.handleDataStream(i._message);case _e.MUTE_AUDIO:case _e.MUTE_VIDEO:case _e.ON_P2P_LOST:case _e.ON_USER_ONLINE:return;case _e.ON_USER_OFFLINE:let{uid:n}=i._message;return f.debug("[".concat(this.clientId,"] user-offline uid: ").concat(n)),void this._external_signal.reset(n)}if(this.emit(i._type,i._message),i._type===_e.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===_e.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Pe.UID_BANNED);break;case 15:this.close(Pe.IP_BANNED);break;case 16:this.close(Pe.CHANNEL_BANNED)}if(i._type===_e.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case te.ERR_LICENSE_MISSING:this.close(Pe.LICENSE_MISSING);break;case te.ERR_LICENSE_EXPIRED:this.close(Pe.LICENSE_EXPIRED);break;case te.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Pe.LICENSE_MINUTES_EXCEEDED);break;case te.ERR_LICENSE_PERIOD_INVALID:this.close(Pe.LICENSE_PERIOD_INVALID);break;case te.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Pe.LICENSE_MULTIPLE_SDK_SERVICE);break;case te.ERR_LICENSE_ILLEGAL:this.close(Pe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new vR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,w("JOIN_GATEWAY_USE_DUAL_DOMAIN"),w("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ve.CONNECTED&&this.reconnect("retry",Zt.OFFLINE)}),this.p2pToken=Fe(6,""),this._external_signal=new a_(this,this.p2pToken)}async request(e,t,r,i){let n=Fe(6,""),o={_id:n,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new K((p,g)=>{if(this.connectionState===Ve.CONNECTED)return p();let _=()=>{this.off(oe.WS_CLOSED,E),p()},E=()=>{this.off(oe.WS_CONNECTED,_),g(new M(R.WS_ABORT))};this.once(oe.WS_CONNECTED,_),this.once(oe.WS_CLOSED,E)});if(this.connectionState!==Ve.CONNECTING&&this.connectionState!==Ve.RECONNECTING||e===ne.JOIN||e===ne.REJOIN||await s(),this.websocket.sendMessage(o,!0),i)return;let c=new K((p,g)=>{let _=!1,E=(T,y)=>{_=!0,p({isSuccess:T==="success",message:y||{}}),this.off(oe.WS_CLOSED,S),this.off(oe.WS_RECONNECTING,S),this.emit(oe.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(n),E);let S=()=>{g(new M(R.WS_ABORT,"type: ".concat(e))),this.off(oe.WS_CLOSED,S),this.off(oe.WS_RECONNECTING,S),this.off("res-@".concat(n),E)};this.once(oe.WS_CLOSED,S),this.once(oe.WS_RECONNECTING,S),zt(w("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||_||(f.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(oe.REQUEST_TIMEOUT,e,t))})}),l=null;try{l=await c}catch(p){if(this.connectionState===Ve.CLOSED||e===ne.LEAVE)throw new M(R.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?p.throw():e===ne.JOIN||e===ne.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;let d=Number(l.message.error_code||l.message.code),u=Lu(d),h=new M(R.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return u.action==="success"?l.message:(f.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===te.ERR_TOO_MANY_BROADCASTERS?((e===ne.JOIN||e===ne.REJOIN)&&(this.initError=h,this.close()),h.throw()):u.action==="failed"?h.throw():u.action==="quit"?(this.initError=h,this.close(),h.throw()):(d===te.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,f.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Zt.MULTI_IP)):this.reconnect(u.action,Zt.SERVER_ERROR),e===ne.JOIN||e===ne.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new K(r=>{let i=n=>{(!t||t(n))&&(this.off(e,i),r(n))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void f.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(ku.WRTC_STATS,t)}upload(e,t){let r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch{let i=w("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ve.CONNECTED)return;let n=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(n._type,n._message)},w("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let r={_type:e,_message:t};this.websocket.sendMessage(r)}async sendExtensionMessage(e,t,r){return await this._external_signal.send(e,t,r)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new K((t,r)=>{this.once(oe.WS_CONNECTED,()=>t(this.joinResponse)),this.once(oe.WS_CLOSED,()=>r(this.initError||new M(R.WS_ABORT))),this.connectionState=Ve.CONNECTING,this.websocket.init(e).catch(r)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Pe.LEAVE,this.connectionState=Ve.CLOSED,f.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Fe(6,""),this._external_signal.clear(),this._external_signal=new a_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(oe.ABORT_P2P_EXECUTION);let e=await tr(this,oe.REQUEST_JOIN_INFO),t=await this.request(ne.JOIN,e);if(!t)return this.emit(oe.REPORT_JOIN_GATEWAY,R.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(oe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ve.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;let r=Ts(e.payload),i=new TextDecoder().decode(r),n=JSON.parse(i);"total"in n&&"id"in n||Y(t=Object.values(ut)).call(t,n._type)?(n._uid=e.uid,this._external_signal.onMessage(n)):this.emit(_e.ON_DATA_STREAM,e)}catch{this.emit(_e.ON_DATA_STREAM,e)}}handleNotification(e){f.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Lu(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Pe.UID_BANNED),void this.close()):void this.reconnect(t.action,Zt.SERVER_ERROR);f.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=w("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(f.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>w("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Zt.TIMEOUT):this.request(ne.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-t;this.rttRolling.add(r),w("REPORT_STATS")&&this.send(ne.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(se.RECONNECT_WAITTING_FINISH,e=>{this.emit(oe.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(se.RECONNECT_CREATE_CONNECTION,e=>{this.emit(oe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(se.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(se.CLOSED,()=>{this.connectionState=Ve.CLOSED}),this.websocket.on(se.FAILED,()=>{this._disconnectedReason=Pe.NETWORK_ERROR,this.connectionState=Ve.CLOSED}),this.websocket.on(se.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Ve.CONNECTED?this.connectionState=Ve.RECONNECTING:this.connectionState=Ve.CONNECTING}),this.websocket.on(se.WILL_RECONNECT,(e,t,r)=>{e!=="retry"?(f.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):f.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(e)}),this.websocket.on(se.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(oe.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof M&&e.code===R.UNEXPECTED_RESPONSE&&e.data.code===te.ERR_NO_AUTHORIZED)return f.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Zt.SERVER_ERROR);f.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Zt.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(se.REQUEST_NEW_URLS,(e,t)=>{tr(this,oe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(se.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}},mV={exports:{}};mV.exports=(()=>{var e={8:(i,n,o)=>{o.r(n),o.d(n,{Parser:()=>j,Printer:()=>Ge,parse:()=>L,print:()=>B});let a=`
`,s="".concat("\r").concat(a),c=" ",l;function d(N){return N>="0"&&N<="9"}function u(N){return N>="!"&&N<="~"}function h(N){return u(N)||N>=""&&N<=""}function p(N){return N==="!"||N>="#"&&N<="'"||N>="*"&&N<="+"||N>="-"&&N<="."||N>="0"&&N<="9"||N>="A"&&N<="Z"||N>="^"&&N<="~"}function g(N){return N>="1"&&N<="9"}function _(N){return N>="A"&&N<="Z"||N>="a"&&N<="z"}function E(N){return N==="d"||N==="h"||N==="m"||N==="s"}function S(N){return N>""&&N<"	"||N>"\v"&&N<"\f"||N>""&&N<""}function T(N){return _(N)||d(N)||N==="+"||N==="/"}function y(N){return d(N)||_(N)||N==="+"||N==="/"||N==="-"||N==="_"}function I(N){return _(N)||d(N)||N==="+"||N==="/"}function O(N,m){var C=Object.keys(N);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(N);m&&(A=A.filter(function(F){return Object.getOwnPropertyDescriptor(N,F).enumerable})),C.push.apply(C,A)}return C}function b(N){for(var m=1;m<arguments.length;m++){var C=arguments[m]!=null?arguments[m]:{};m%2?O(Object(C),!0).forEach(function(A){k(N,A,C[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(C)):O(Object(C)).forEach(function(A){Object.defineProperty(N,A,Object.getOwnPropertyDescriptor(C,A))})}return N}function k(N,m,C){return m in N?Object.defineProperty(N,m,{value:C,enumerable:!0,configurable:!0,writable:!0}):N[m]=C,N}(function(N){N.VERSION="v",N.ORIGIN="o",N.SESSION_NAME="s",N.INFORMATION="i",N.URI="u",N.EMAIL="e",N.PHONE="p",N.CONNECTION="c",N.BANDWIDTH="b",N.TIME="t",N.REPEAT="r",N.ZONE_ADJUSTMENTS="z",N.KEY="k",N.ATTRIBUTE="a",N.MEDIA="m"})(l||(l={}));class P{consumeText(m,C){let A=C;for(;A<m.length;){let F=m[A];if(F==="\0"||F==="\r"||F===a)break;A+=1}if(A-C==0)throw new Error("Invalid text, at ".concat(m));return A}consumeUnicastAddress(m,C,A){return this.consumeTill(m,C,c)}consumeOneOrMore(m,C,A){let F=C;for(;A(m[F]);)F++;if(F-C==0)throw new Error("Invalid rule at ".concat(C,"."));return F}consumeSpace(m,C){if(m[C]===c)return C+1;throw new Error("Invalid space at ".concat(C,"."))}consumeIP4Address(m,C){let A=C;for(let F=0;F<4;F++)if(A=this.consumeDecimalUChar(m,A),F!==3){if(m[A]!==".")throw new Error("Invalid IP4 address.");A++}return A}consumeDecimalUChar(m,C){let A=C;for(let ae=0;ae<3&&d(m[A]);ae++,A++);if(A-C==0)throw new Error("Invalid decimal uchar.");let F=parseInt(m.slice(C,A));if(F>=0&&F<=255)return A;throw new Error("Invalid decimal uchar")}consumeIP6Address(m,C){let A=this.consumeHexpart(m,C);return m[A]===":"&&(A+=1,A=this.consumeIP4Address(m,A)),A}consumeHexpart(m,C){let A=C;if(m[A]===":"&&m[A+1]===":"){A+=2;try{A=this.consumeHexseq(m,A)}catch{}return A}if(A=this.consumeHexseq(m,A),m[A]===":"&&m[A+1]===":"){A+=2;try{A=this.consumeHexseq(m,A)}catch{}return A}return A}consumeHexseq(m,C){let A=C;for(;A=this.consumeHex4(m,A),m[A]===":"&&m[A+1]!==":";)A+=1;return A}consumeHex4(m,C){let A=0;for(;A<4;A++)if(!((F=m[C+A])>="0"&&F<="9"||F>="a"&&F<="f"||F>="A"&&F<="F")){if(A===0)throw new Error("Invalid hex 4");break}var F;return C+A}consumeFQDN(m,C){let A=C;for(;d(m[A])||_(m[A])||m[A]==="-"||m[A]===".";)A+=1;if(A-C<4)throw new Error("Invalid FQDN");return A}consumeExtnAddr(m,C){return this.consumeOneOrMore(m,C,h)}consumeMulticastAddress(m,C,A){switch(A){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(m,C);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(m,C);default:try{return this.consumeFQDN(m,C)}catch{return this.consumeExtnAddr(m,C)}}}consumeIP6MulticastAddress(m,C){let A=this.consumeHexpart(m,C);return m[A]==="/"?this.consumeInteger(m,A+1):A}consumeIP4MulticastAddress(m,C){let A=C+3,F=m.slice(C,A),ae=parseInt(F);if(ae<224||ae>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Re=0;Re<3;Re++){if(m[A]!==".")throw new Error("Invalid IP4 multicast address.");A+=1,A=this.consumeDecimalUChar(m,A)}return m[A]==="/"&&(A+=1),A=this.consumeTTL(m,A),m[A]==="/"&&(A=this.consumeInteger(m,A)),A}consumeInteger(m,C){if(!g(m[C]))throw new Error("Invalid integer.");for(C+=1;d(m[C]);)C+=1;return C}consumeTTL(m,C){if(m[C]==="0")return C+1;if(!g(m[C]))throw new Error("Invalid TTL.");C+=1;for(let A=0;A<2&&d(m[C]);A++)C+=1;return C}consumeToken(m,C){return this.consumeOneOrMore(m,C,p)}consumeTime(m,C){let A=C;if(m[A]==="0")return A+1;for(g(m[A])&&(A+=1);d(m[A]);)A++;if(A-C<10)throw new Error("Invalid time");return A}consumeAddress(m,C){return this.consumeTill(m,C,c)}consumeTypedTime(m,C){let A=C;return A=this.consumeOneOrMore(m,A,d),E(m[A])?A+1:A}consumeRepeatInterval(m,C){if(!g(m[C]))throw new Error("Invalid repeat interval");for(C+=1;d(m[C]);)C+=1;return E(m[C])&&(C+=1),C}consumePort(m,C){return this.consumeOneOrMore(m,C,d)}consume(m,C,A){for(let F=0;F<A.length;F++){if(C+F>=m.length)throw new Error("consume exceeding value length");if(m[C+F]!==A[F])throw new Error("consume ".concat(A," failed at ").concat(F))}return C+A.length}consumeTill(m,C,A){let F=C;for(;F<m.length&&(typeof A!="string"||m[F]!==A)&&(typeof A!="function"||!A(m[F]));)F++;return F}}class j extends P{constructor(){super(),k(this,"records",[]),k(this,"currentLine",0)}parse(m){let C=this.probeEOL(m);this.records=m.split(C).filter(yt=>!!Sr(yt).call(yt)).map(this.parseLine),this.currentLine=0;let A=this.parseVersion(),F=this.parseOrigin(),ae=this.parseSessionName(),Re=this.parseInformation(),st=this.parseUri(),Fr=this.parseEmail(),go=this.parsePhone(),mh=this.parseConnection(),Eh=this.parseBandWidth(),Ci=this.parseTimeFields(),zo=this.parseKey(),Js=this.parseSessionAttribute(),lt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:A,origin:F,sessionName:ae,information:Re,uri:st,emails:Fr,phones:go,connection:mh,bandwidths:Eh,timeFields:Ci,key:zo,attributes:Js,mediaDescriptions:lt}}getCurrentRecord(){let m=this.records[this.currentLine];if(!m)throw new Error("Record doesn't exit.");return m}probeEOL(m){for(let C=0;C<m.length;C++)if(m[C]===a)return m[C-1]==="\r"?s:a;throw new Error("Invalid newline character.")}parseLine(m,C){if(m.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let A=m[0];if(m[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:A,value:m.slice(2),line:C,cur:0}}parseSessionAttribute(){let m=new ce;for(;this.currentLine<this.records.length;){let C=this.getCurrentRecord();if(C.type!==l.ATTRIBUTE)break;let A={attField:this.extractOneOrMore(C,F=>p(F)&&F!==":"),_cur:0};C.value[C.cur]===":"&&(C.cur+=1,A.attValue=this.extractOneOrMore(C,S)),m.parse(A),this.currentLine++}return m.digest()}parseMediaAttributes(m){let C=new pe(m);for(;this.currentLine<this.records.length;){let A=this.getCurrentRecord();if(A.type!==l.ATTRIBUTE)break;let F={attField:this.extractOneOrMore(A,ae=>p(ae)&&ae!==":"),_cur:0};A.value[A.cur]===":"&&(A.cur+=1,F.attValue=this.extractOneOrMore(A,S)),C.parse(F),this.currentLine++}return C.digest()}parseKey(){let m=this.getCurrentRecord();if(m.type===l.KEY){if(m.value==="prompt"||m.value==="clear:"||m.value==="base64:"||m.value==="uri:")return m.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let m=this.getCurrentRecord();if(m.type===l.ZONE_ADJUSTMENTS){let C=[];for(;;)try{let A=this.extract(m,this.consumeTime);this.consumeSpaceForRecord(m);let F=!1;m.value[m.cur]==="-"&&(F=!0,m.cur+=1);let ae=this.extract(m,this.consumeTypedTime);C.push({time:A,typedTime:ae,back:F})}catch{break}if(C.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,C}return[]}parseRepeat(){let m=[];for(;;){let C=this.getCurrentRecord();if(C.type!==l.REPEAT)break;{let A=this.extract(C,this.consumeRepeatInterval),F=this.parseTypedTime(C);m.push({repeatInterval:A,typedTimes:F}),this.currentLine++}}return m}parseTypedTime(m){let C=[];for(;;)try{this.consumeSpaceForRecord(m),C.push(this.extract(m,this.consumeTypedTime))}catch{break}if(C.length===0)throw new Error("Invalid typed time.");return C}parseTime(){let m=this.getCurrentRecord(),C=this.extract(m,this.consumeTime);this.consumeSpaceForRecord(m);let A=this.extract(m,this.consumeTime);return this.currentLine++,{startTime:C,stopTime:A}}parseBandWidth(){let m=[];for(;this.currentLine<this.records.length;){let C=this.getCurrentRecord();if(C.type!==l.BANDWIDTH)break;{let A=this.extractOneOrMore(C,p);if(C.value[C.cur]!==":")throw new Error("Invalid bandwidth field.");C.cur++;let F=this.extractOneOrMore(C,d);m.push({bwtype:A,bandwidth:F}),this.currentLine++}}return m}parseVersion(){let m=this.getCurrentRecord();if(m.type!==l.VERSION)throw new Error("first sdp record must be version");let C=m.value.slice(0,this.consumeOneOrMore(m.value,0,d));if(C.length!==m.value.length)throw new Error('invalid proto version, "v='.concat(m.value,'"'));return this.currentLine++,C}parseOrigin(){let m=this.getCurrentRecord();if(m.type!==l.ORIGIN)throw new Error("second line of sdp must be origin");let C=this.extractOneOrMore(m,h);this.consumeSpaceForRecord(m);let A=this.extractOneOrMore(m,d);this.consumeSpaceForRecord(m);let F=this.extractOneOrMore(m,d);this.consumeSpaceForRecord(m);let ae=this.extractOneOrMore(m,p);this.consumeSpaceForRecord(m);let Re=this.extractOneOrMore(m,p);this.consumeSpaceForRecord(m);let st=this.extract(m,this.consumeUnicastAddress);return this.currentLine++,{username:C,sessId:A,sessVersion:F,nettype:ae,addrtype:Re,unicastAddress:st}}parseSessionName(){let m=this.getCurrentRecord();if(m.type===l.SESSION_NAME){let C=this.extract(m,this.consumeText);return this.currentLine++,C}}parseInformation(){let m=this.getCurrentRecord();if(m.type!==l.INFORMATION)return;let C=this.extract(m,this.consumeText);return this.currentLine++,C}parseUri(){let m=this.getCurrentRecord();if(m.type===l.URI)return this.currentLine++,m.value}parseEmail(){let m=[];for(;;){let C=this.getCurrentRecord();if(C.type!==l.EMAIL)break;m.push(C.value),this.currentLine++}return m}parsePhone(){let m=[];for(;;){let C=this.getCurrentRecord();if(C.type!==l.PHONE)break;m.push(C.value),this.currentLine++}return m}parseConnection(){let m=this.getCurrentRecord();if(m.type===l.CONNECTION){let C=this.extractOneOrMore(m,p);this.consumeSpaceForRecord(m);let A=this.extractOneOrMore(m,p);this.consumeSpaceForRecord(m);let F=this.extract(m,this.consumeAddress);return this.currentLine++,{nettype:C,addrtype:A,address:F}}}parseMedia(){let m=this.getCurrentRecord(),C=this.extract(m,this.consumeToken);this.consumeSpaceForRecord(m);let A=this.extract(m,this.consumePort);m.value[m.cur]==="/"&&(m.cur+=1,A+=this.extract(m,this.consumeInteger)),this.consumeSpaceForRecord(m);let F=[];for(F.push(this.extract(m,this.consumeToken));m.value[m.cur]==="/";)m.cur+=1,F.push(this.extract(m,this.consumeToken));if(F.length===0)throw new Error("Invalid proto");let ae=this.parseFmt(m);return this.currentLine++,{mediaType:C,port:A,protos:F,fmts:ae}}parseTimeFields(){let m=[];for(;this.getCurrentRecord().type===l.TIME;){let C=this.parseTime(),A=this.parseRepeat(),F=this.parseZone();m.push({time:C,repeats:A,zones:F})}return m}parseMediaDescription(){let m=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.MEDIA;){let C=this.parseMedia(),A=this.parseInformation(),F=this.parseConnections(),ae=this.parseBandWidth(),Re=this.parseKey(),st=this.parseMediaAttributes(C);m.push({media:C,information:A,connections:F,bandwidths:ae,key:Re,attributes:st})}return m}parseConnections(){let m=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.CONNECTION;)m.push(this.parseConnection());return m}parseFmt(m){let C=[];for(;;)try{this.consumeSpaceForRecord(m),C.push(this.extract(m,this.consumeToken))}catch{break}if(C.length===0)throw new Error("Invalid fmts");return C}extract(m,C){for(var A=arguments.length,F=new Array(A>2?A-2:0),ae=2;ae<A;ae++)F[ae-2]=arguments[ae];let Re=C.call(this,m.value,m.cur,...F),st=m.value.slice(m.cur,Re);return m.cur=Re,st}extractOneOrMore(m,C){let A=this.consumeOneOrMore(m.value,m.cur,C),F=m.value.slice(m.cur,A);return m.cur=A,F}consumeSpaceForRecord(m){if(m.value[m.cur]!==c)throw new Error("Invalid space at ".concat(m.cur,"."));m.cur+=1}}class G extends P{constructor(){super(...arguments),k(this,"attributes",void 0),k(this,"digested",!1)}extractOneOrMore(m,C,A){let F=this.consumeOneOrMore(m.attValue,m._cur,C),ae=m.attValue.slice(m._cur,F),[Re,st]=A||[];if(typeof Re=="number"&&ae.length<Re)throw new Error("error in length, should be more or equal than ".concat(Re," characters."));if(typeof st=="number"&&ae.length>st)throw new Error("error in length, should be less or equal than ".concat(st," characters."));return m._cur=F,ae}consumeAttributeSpace(m){if(m.attValue[m._cur]!==c)throw new Error("Invalid space at ".concat(m._cur,"."));m._cur+=1}extract(m,C){if(!m.attValue)throw new Error("Nothing to extract from attValue.");for(var A=arguments.length,F=new Array(A>2?A-2:0),ae=2;ae<A;ae++)F[ae-2]=arguments[ae];let Re=C.call(this,m.attValue,m._cur,...F),st=m.attValue.slice(m._cur,Re);return m._cur=Re,st}atEnd(m){if(!m.attValue)throw new Error;return m._cur>=m.attValue.length}peekChar(m){if(!m.attValue)throw new Error;return m.attValue[m._cur]}peek(m,C){if(!m.attValue)throw new Error;for(let A=0;A<C.length;A++)if(C[A]!==m.attValue[m._cur+A])return!1;return!0}parseIceUfrag(m){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(m,T,[4,256])}parseIcePwd(m){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(m,T,[22,256])}parseIceOptions(m){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let C=[];for(;!this.atEnd(m);){C.push(this.extractOneOrMore(m,T));try{this.consumeAttributeSpace(m)}catch(A){if(this.atEnd(m))break;throw A}}this.attributes.iceOptions=C}parseFingerprint(m){let C=this.extract(m,this.consumeToken);this.consumeAttributeSpace(m);let A=this.extract(m,this.consumeTill);this.attributes.fingerprints.push({hashFunction:C,fingerprint:A})}parseExtmap(m){let C=this.extractOneOrMore(m,d),A;this.peekChar(m)==="/"&&(this.extract(m,this.consume,"/"),A=this.extract(m,this.consumeToken)),this.consumeAttributeSpace(m);let F=this.extract(m,this.consumeTill,c),ae=b(b({entry:parseInt(C,10)},A&&{direction:A}),{},{extensionName:F});this.peekChar(m)===c&&(this.consumeAttributeSpace(m),ae.extensionAttributes=this.extract(m,this.consumeTill)),this.attributes.extmaps.push(ae)}parseSetup(m){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let C=this.extract(m,this.consumeTill);if(C!=="active"&&C!=="passive"&&C!=="actpass"&&C!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=C}}class ce extends G{constructor(){super(...arguments),k(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(m){if(this.digested)throw new Error("already digested");try{switch(m.attField){case"group":this.parseGroup(m);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(m);break;case"ice-pwd":this.parseIcePwd(m);break;case"ice-options":this.parseIceOptions(m);break;case"fingerprint":this.parseFingerprint(m);break;case"setup":this.parseSetup(m);break;case"tls-id":this.parseTlsId(m);break;case"identity":this.parseIdentity(m);break;case"extmap":this.parseExtmap(m);break;case"msid-semantic":this.parseMsidSemantic(m);break;default:m.ignored=!0,this.attributes.unrecognized.push(m)}}catch(C){throw console.error("parsing session attribute ".concat(m.attField,' error, "a=').concat(m.attField,":").concat(m.attValue,'"')),C}if(!m.ignored&&m.attValue&&!this.atEnd(m))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(m){let C=this.extract(m,this.consumeToken),A=[];for(;!this.atEnd(m)&&this.peekChar(m)===c;)this.consumeAttributeSpace(m),A.push(this.extract(m,this.consumeToken));this.attributes.groups.push({semantic:C,identificationTag:A})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(m){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(m,y)}parseIdentity(m){let C=this.extractOneOrMore(m,I),A=[];for(;!this.atEnd(m)&&this.peekChar(m)===c;){this.consumeAttributeSpace(m);let F=this.extract(m,this.consumeToken);this.extract(m,this.consume,"=");let ae=this.extractOneOrMore(m,Re=>Re!==c&&S(Re));A.push({name:F,value:ae})}this.attributes.identities.push({assertionValue:C,extensions:A})}parseMsidSemantic(m){this.peekChar(m)===c&&this.consumeAttributeSpace(m);let C={semantic:this.extract(m,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(m)}catch{break}if(this.peekChar(m)==="*"){this.extract(m,this.consume,"*"),C.applyForAll=!0;break}{let A=this.extract(m,this.consumeTill,c);C.identifierList.push(A)}}this.attributes.msidSemantic=C}}class pe extends G{constructor(m){super(),k(this,"attributes",void 0),m.protos.indexOf("RTP")!==-1||m.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(m){if(this.digested)throw new Error("already digested");try{switch(m.attField){case"extmap":this.parseExtmap(m);break;case"setup":this.parseSetup(m);break;case"ice-ufrag":this.parseIceUfrag(m);break;case"ice-pwd":this.parseIcePwd(m);break;case"ice-options":this.parseIceOptions(m);break;case"candidate":this.parseCandidate(m);break;case"remote-candidate":this.parseRemoteCandidate(m);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(m);break;case"rtpmap":this.parseRtpmap(m);break;case"ptime":this.parsePtime(m);break;case"maxptime":this.parseMaxPtime(m);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(m);break;case"ssrc":this.parseSSRC(m);break;case"fmtp":this.parseFmtp(m);break;case"rtcp-fb":this.parseRtcpFb(m);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(m);break;case"mid":this.parseMid(m);break;case"msid":this.parseMsid(m);break;case"imageattr":this.parseImageAttr(m);break;case"rid":this.parseRid(m);break;case"simulcast":this.parseSimulcast(m);break;case"sctp-port":this.parseSctpPort(m);break;case"max-message-size":this.parseMaxMessageSize(m);break;case"ssrc-group":this.parseSSRCGroup(m);break;default:m.ignored=!0,this.attributes.unrecognized.push(m)}}catch(C){throw console.error("parsing media attribute ".concat(m.attField,' error, "a=').concat(m.attField,":").concat(m.attValue,'"')),C}if(!m.ignored&&m.attValue&&!this.atEnd(m))throw new Error("attribute parsing error")}parseCandidate(m){let C=this.extractOneOrMore(m,T,[1,32]);this.consumeAttributeSpace(m);let A=this.extractOneOrMore(m,d,[1,5]);this.consumeAttributeSpace(m);let F=this.extract(m,this.consumeToken);this.consumeAttributeSpace(m);let ae=this.extractOneOrMore(m,d,[1,10]);this.consumeAttributeSpace(m);let Re=this.extract(m,this.consumeAddress);this.consumeAttributeSpace(m);let st=this.extract(m,this.consumePort);this.consumeAttributeSpace(m),this.extract(m,this.consume,"typ"),this.consumeAttributeSpace(m);let Fr={foundation:C,componentId:A,transport:F,priority:ae,connectionAddress:Re,port:st,type:this.extract(m,this.consumeToken),extension:{}};for(this.peek(m," raddr")&&(this.extract(m,this.consume," raddr"),this.consumeAttributeSpace(m),Fr.relAddr=this.extract(m,this.consumeAddress)),this.peek(m," rport")&&(this.extract(m,this.consume," rport"),this.consumeAttributeSpace(m),Fr.relPort=this.extract(m,this.consumePort));this.peekChar(m)===c;){this.consumeAttributeSpace(m);let go=this.extract(m,this.consumeToken);this.consumeAttributeSpace(m),Fr.extension[go]=this.extractOneOrMore(m,u)}this.attributes.candidates.push(Fr)}parseRemoteCandidate(m){let C=[];for(;;){let A=this.extractOneOrMore(m,d,[1,5]);this.consumeAttributeSpace(m);let F=this.extract(m,this.consumeAddress);this.consumeAttributeSpace(m);let ae=this.extract(m,this.consumePort);C.push({componentId:A,connectionAddress:F,port:ae});try{this.consumeAttributeSpace(m)}catch{break}}this.attributes.remoteCandidatesList.push(C)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(m){let C=this.extract(m,this.consumeToken);this.consumeAttributeSpace(m);let A=this.extract(m,this.consumeTill,"/");this.extract(m,this.consume,"/");let F={encodingName:A,clockRate:this.extractOneOrMore(m,d)};this.atEnd(m)||this.peekChar(m)!=="/"||(this.extract(m,this.consume,"/"),F.encodingParameters=parseInt(this.extract(m,this.consumeTill),10));let ae=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(C,10));ae?ae.rtpMap=F:this.attributes.payloads.push({payloadType:parseInt(C,10),rtpMap:F,rtcpFeedbacks:[]})}parsePtime(m){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(m,this.consumeTill)}parseMaxPtime(m){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(m,this.consumeTill)}parseDirection(m){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=m.attField}parseSSRC(m){let C=this.extractOneOrMore(m,d);this.consumeAttributeSpace(m);let A=this.extract(m,this.consumeTill,":"),F;this.peekChar(m)===":"&&(this.extract(m,this.consume,":"),F=this.extract(m,this.consumeTill));let ae=this.attributes.ssrcs.find(Re=>Re.ssrcId===parseInt(C,10));ae?ae.attributes[A]=F:this.attributes.ssrcs.push({ssrcId:parseInt(C,10),attributes:{[A]:F}})}parseFmtp(m){let C=this.extract(m,this.consumeTill,c);this.consumeAttributeSpace(m);let A=this.extract(m,this.consumeTill),F={};A.split(";").forEach(Re=>{let[st,Fr]=Re.split("=");st=Sr(st).call(st);let go=typeof Fr=="string"?Sr(Fr).call(Fr):null;typeof st=="string"&&st.length>0&&(F[st]=go)});let ae=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(C,10));ae?ae.fmtp={parameters:F}:this.attributes.payloads.push({payloadType:parseInt(C,10),rtcpFeedbacks:[],fmtp:{parameters:F}})}parseFmtParameters(m){let C={},A=this.extract(m,this.consumeTill,"=");m._cur++;let F=this.extract(m,this.consumeTill,";");for(C[A]=F;m.attValue[m._cur]===";";){let ae=this.extract(m,this.consumeTill,"=");m._cur++;let Re=this.extract(m,this.consumeTill,";");C[ae]=Re}return C}parseRtcpFb(m){let C="";C=this.peekChar(m)==="*"?this.extract(m,this.consume,"*"):this.extract(m,this.consumeTill,c),this.consumeAttributeSpace(m);let A=this.extract(m,this.consumeTill,c),F;if(A==="trr-int")F={type:A,interval:this.extract(m,this.consumeTill)};else{let ae={type:A};this.peekChar(m)===c&&(this.consumeAttributeSpace(m),ae.parameter=this.extract(m,this.consumeToken),this.peekChar(m)===c&&(ae.additional=this.extract(m,this.consumeTill))),F=ae}if(C==="*")this.attributes.rtcpFeedbackWildcards.push(F);else{let ae=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(C,10));ae?ae.rtcpFeedbacks.push(F):this.attributes.payloads.push({payloadType:parseInt(C,10),rtcpFeedbacks:[F]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(m){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let C={port:this.extract(m,this.consumePort)};this.peekChar(m)===c&&(this.consumeAttributeSpace(m),C.netType=this.extractOneOrMore(m,p),this.consumeAttributeSpace(m),C.addressType=this.extractOneOrMore(m,p),this.consumeAttributeSpace(m),C.address=this.extract(m,this.consumeAddress)),this.attributes.rtcp=C}parseMsid(m){let C={id:this.extractOneOrMore(m,p,[1,64])};this.peekChar(m)===c&&(this.consumeAttributeSpace(m),C.appdata=this.extractOneOrMore(m,p,[1,64])),this.attributes.msids.push(C)}parseImageAttr(m){this.attributes.imageattr.push(m.attValue)}parseRid(m){let C=this.extractOneOrMore(m,F=>_(F)||d(F)||F==="_"||F==="-");this.consumeAttributeSpace(m);let A={id:C,direction:this.extract(m,this.consumeToken),params:[]};if(this.peekChar(m)===c){if(this.consumeAttributeSpace(m),this.peek(m,"pt=")){this.extract(m,this.consume,"pt=");let F=[];for(;;){let ae=this.extract(m,this.consumeToken);F.push(ae);try{this.extract(m,this.consume,",")}catch{break}}A.payloads=F,this.peekChar(m)===c&&this.extract(m,this.consume,c)}for(;;){let F=this.extract(m,this.consumeToken);switch(F){case"depend":{let ae={type:F,rids:this.extract(m,this.consume,"=").split(",")};A.params.push(ae);break}default:{let ae={type:F};this.peekChar(m)==="="&&(this.extract(m,this.consume,"="),ae.val=this.extract(m,this.consumeTill,";")),A.params.push(ae)}}try{this.extract(m,this.consume,";")}catch{break}}}this.attributes.rids.push(A)}parseSimulcast(m){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=m.attValue,this.extract(m,this.consumeTill)}parseSctpPort(m){this.attributes.sctpPort=this.extractOneOrMore(m,d,[1,5])}parseMaxMessageSize(m){this.attributes.maxMessageSize=this.extractOneOrMore(m,d,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(m){this.attributes.mid=this.extract(m,this.consumeToken)}parseSSRCGroup(m){let C=this.extract(m,this.consumeToken),A=[];for(;;)try{this.consumeAttributeSpace(m);let F=this.extract(m,this.consumeInteger);A.push(parseInt(F,10))}catch{break}this.attributes.ssrcGroups.push({semantic:C,ssrcIds:A})}}function Ae(N,m,C){return m in N?Object.defineProperty(N,m,{value:C,enumerable:!0,configurable:!0,writable:!0}):N[m]=C,N}class Ge{constructor(){Ae(this,"eol",s)}print(m,C){let A="";return C&&(this.eol=C),A+=this.printVersion(m.version),A+=this.printOrigin(m.origin),A+=this.printSessionName(m.sessionName),A+=this.printInformation(m.information),A+=this.printUri(m.uri),A+=this.printEmail(m.emails),A+=this.printPhone(m.phones),A+=this.printConnection(m.connection),A+=this.printBandwidth(m.bandwidths),A+=this.printTimeFields(m.timeFields),A+=this.printKey(m.key),A+=this.printSessionAttributes(m.attributes),A+=this.printMediaDescription(m.mediaDescriptions),A}printVersion(m){return"v=".concat(m).concat(this.eol)}printOrigin(m){return"o=".concat(m.username," ").concat(m.sessId," ").concat(m.sessVersion," ").concat(m.nettype," ").concat(m.addrtype," ").concat(m.unicastAddress).concat(this.eol)}printSessionName(m){return m?"s=".concat(m).concat(this.eol):""}printInformation(m){return m?"i=".concat(m).concat(this.eol):""}printUri(m){return m?"u=".concat(m).concat(this.eol):""}printEmail(m){let C="";for(let A of m)C+="e=".concat(A).concat(this.eol);return C}printPhone(m){let C="";for(let A of m)C+="e=".concat(A).concat(this.eol);return C}printConnection(m){return m?"c=".concat(m.nettype," ").concat(m.addrtype," ").concat(m.address).concat(this.eol):""}printBandwidth(m){let C="";for(let A of m)C+="b=".concat(A.bwtype,":").concat(A.bandwidth).concat(this.eol);return C}printTimeFields(m){let C="";for(let A of m){C+="t=".concat(A.time.startTime," ").concat(A.time.startTime).concat(this.eol);for(let F of A.repeats)C+="r=".concat(F.repeatInterval," ").concat(F.typedTimes.join(" ")).concat(this.eol);A.zoneAdjustments&&(C+="z=",C+="z=".concat(A.zoneAdjustments.map(F=>"".concat(F.time," ").concat(F.back?"-":""," ").concat(F.typedTime)).join(" ")).concat(this.eol),C+=this.eol)}return C}printKey(m){return m?"k=".concat(m).concat(this.eol):""}printAttributes(m){let C="";for(let A of m)C+="a=".concat(A.attField).concat(A.attValue?":".concat(A.attValue):"").concat(this.eol);return C}printMediaDescription(m){let C="";for(let A of m)C+=this.printMedia(A.media),C+=this.printInformation(A.information),C+=this.printConnections(A.connections),C+=this.printBandwidth(A.bandwidths),C+=this.printKey(A.key),C+=this.printMediaAttributes(A);return C}printConnections(m){let C="";for(let A of m)C+=this.printConnection(A);return C}printMedia(m){return"m=".concat(m.mediaType," ").concat(m.port," ").concat(m.protos.join("/")," ").concat(m.fmts.join(" ")).concat(this.eol)}printSessionAttributes(m){return new pr(this.eol).print(m)}printMediaAttributes(m){return new x(this.eol).print(m)}}class at{constructor(m){Ae(this,"eol",void 0),this.eol=m}printIceUfrag(m){return m===void 0?"":"a=ice-ufrag:".concat(m).concat(this.eol)}printIcePwd(m){return m===void 0?"":"a=ice-pwd:".concat(m).concat(this.eol)}printIceOptions(m){return m===void 0?"":"a=ice-options:".concat(m.join(c)).concat(this.eol)}printFingerprints(m){return m.length>0?m.map(C=>"a=fingerprint:".concat(C.hashFunction).concat(c).concat(C.fingerprint)).join(this.eol)+this.eol:""}printExtmap(m){return m.map(C=>"a=extmap:".concat(C.entry).concat(C.direction?"/".concat(C.direction):"").concat(c).concat(C.extensionName).concat(C.extensionAttributes?"".concat(c).concat(C.extensionAttributes):"").concat(this.eol)).join("")}printSetup(m){return m===void 0?"":"a=setup:".concat(m).concat(this.eol)}printUnrecognized(m){return m.map(C=>"a=".concat(C.attField).concat(C.attValue?":".concat(C.attValue):"").concat(this.eol)).join("")}}class pr extends at{print(m){let C="";return C+=this.printGroups(m.groups),C+=this.printMsidSemantic(m.msidSemantic),C+=this.printIceLite(m.iceLite),C+=this.printIceUfrag(m.iceUfrag),C+=this.printIcePwd(m.icePwd),C+=this.printIceOptions(m.iceOptions),C+=this.printFingerprints(m.fingerprints),C+=this.printSetup(m.setup),C+=this.printTlsId(m.tlsId),C+=this.printIdentity(m.identities),C+=this.printExtmap(m.extmaps),C+=this.printUnrecognized(m.unrecognized),C}printGroups(m){let C="";return m.length>0&&(C+=m.map(A=>"a=group:".concat(A.semantic).concat(A.identificationTag.map(F=>"".concat(c).concat(F)).join("")).concat(this.eol)).join("")),C}printIceLite(m){return m===void 0?"":"a=ice-lite"+this.eol}printTlsId(m){return m?"a=tls-id:".concat(m).concat(this.eol):""}printIdentity(m){return m.length===0?"":m.map(C=>"a=identity:".concat(C.assertionValue).concat(C.extensions.map(A=>"".concat(c).concat(A.name).concat(A.value?"=".concat(A.value):"")))).join(this.eol)+this.eol}printMsidSemantic(m){if(!m)return"";let C="a=msid-semantic:".concat(m.semantic);return m.applyForAll?C+="".concat(c,"*"):m.identifierList.length>0&&(C+=m.identifierList.map(A=>"".concat(c).concat(A))),C+this.eol}}class x extends at{print(m){let C=m.attributes,A="";return A+=this.printRTCP(C.rtcp),A+=this.printIceUfrag(C.iceUfrag),A+=this.printIcePwd(C.icePwd),A+=this.printIceOptions(C.iceOptions),A+=this.printCandidates(C.candidates),A+=this.printRemoteCandidatesList(C.remoteCandidatesList),A+=this.printEndOfCandidates(C.endOfCandidates),A+=this.printFingerprints(C.fingerprints),A+=this.printSetup(C.setup),A+=this.printMid(C.mid),A+=this.printExtmap(C.extmaps),A+=this.printRTPRelated(C),A+=this.printPtime(C.ptime),A+=this.printMaxPtime(C.maxPtime),A+=this.printDirection(C.direction),A+=this.printSSRCGroups(C.ssrcGroups),A+=this.printSSRC(C.ssrcs),A+=this.printRTCPMux(C.rtcpMux),A+=this.printRTCPMuxOnly(C.rtcpMuxOnly),A+=this.printRTCPRsize(C.rtcpRsize),A+=this.printMSId(C.msids),A+=this.printImageattr(C.imageattr),A+=this.printRid(C.rids),A+=this.printSimulcast(C.simulcast),A+=this.printSCTPPort(C.sctpPort),A+=this.printMaxMessageSize(C.maxMessageSize),A+=this.printUnrecognized(C.unrecognized),A}printCandidates(m){return m.map(C=>"a=candidate:".concat(C.foundation).concat(c).concat(C.componentId).concat(c).concat(C.transport).concat(c).concat(C.priority).concat(c).concat(C.connectionAddress).concat(c).concat(C.port).concat(c,"typ").concat(c).concat(C.type).concat(C.relAddr?"".concat(c,"raddr").concat(c).concat(C.relAddr):"").concat(C.relPort?"".concat(c,"rport").concat(c).concat(C.relPort):"").concat(Object.keys(C.extension).map(A=>"".concat(c).concat(A).concat(c).concat(C.extension[A])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(m){return m.map(C=>"a=remote-candidates:".concat(C.join(c)).concat(this.eol)).join("")}printEndOfCandidates(m){return m===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(m){if(!m.payloads)return"";let C=m.payloads,A="";A+=m.rtcpFeedbackWildcards.map(F=>this.printRTCPFeedback("*",F)).join("");for(let F of C)A+=this.printRtpMap(F.payloadType,F.rtpMap),A+=this.printFmtp(F.payloadType,F.fmtp),A+=F.rtcpFeedbacks.map(ae=>this.printRTCPFeedback(F.payloadType,ae)).join("");return A}printFmtp(m,C){if(!C)return"";let A=Object.keys(C.parameters);return A.length===1&&C.parameters[A[0]]===null?"a=fmtp:".concat(m).concat(c).concat(A[0]).concat(this.eol):"a=fmtp:".concat(m).concat(c).concat(Object.keys(C.parameters).map(F=>"".concat(F,"=").concat(C.parameters[F])).join(";")).concat(this.eol)}printRtpMap(m,C){return C?"a=rtpmap:".concat(m).concat(c).concat(C.encodingName,"/").concat(C.clockRate).concat(C.encodingParameters?"/".concat(C.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(m,C){let A="a=rtcp-fb:".concat(m).concat(c),F=C;return F.type==="trr-int"?A+="ttr-int".concat(c).concat(F.interval):(A+="".concat(F.type),F.parameter&&(A+="".concat(c).concat(F.parameter),F.additional&&(A+="".concat(c).concat(F.additional)))),A+this.eol}printPtime(m){return m===void 0?"":"a=ptime:".concat(m).concat(this.eol)}printMaxPtime(m){return m===void 0?"":"a=maxptime:".concat(m).concat(this.eol)}printDirection(m){return m===void 0?"":"a=".concat(m).concat(this.eol)}printSSRC(m){return m.map(C=>Object.keys(C.attributes).map(A=>"a=ssrc:".concat(C.ssrcId.toString(10)).concat(c).concat(A).concat(C.attributes[A]?":".concat(C.attributes[A]):"").concat(this.eol)).join("")).join("")}printRTCPMux(m){return m===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(m){return m===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(m){return m===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(m){if(m===void 0)return"";let C="a=rtcp:".concat(m.port);return m.netType&&(C+="".concat(c).concat(m.netType)),m.addressType&&(C+="".concat(c).concat(m.addressType)),m.address&&(C+="".concat(c).concat(m.address)),C+this.eol}printMSId(m){return m.map(C=>"a=msid:".concat(C.id).concat(C.appdata?"".concat(c).concat(C.appdata):"").concat(this.eol)).join("")}printImageattr(m){return m.map(C=>"a=imageattr:".concat(C).concat(this.eol)).join("")}printRid(m){return m.map(C=>{let A="a=rid:".concat(C.id).concat(c).concat(C.direction);return C.payloads&&(A+="".concat(c,"pt=").concat(C.payloads.join(","))),C.params.length>0&&(A+="".concat(c).concat(C.params.map(F=>F.type==="depend"?"depend=".concat(F.rids.join(",")):"".concat(F.type,"=").concat(F.val)).join(";"))),A+this.eol}).join("")}printSimulcast(m){return m===void 0?"":"a=simulcast:".concat(m).concat(this.eol)}printSCTPPort(m){return m===void 0?"":"a=sctp-port:".concat(m).concat(this.eol)}printMaxMessageSize(m){return m===void 0?"":"a=max-message-size:".concat(m).concat(this.eol)}printMid(m){return m===void 0?"":"a=mid:".concat(m).concat(this.eol)}printSSRCGroups(m){return m.map(C=>"a=ssrc-group:".concat(C.semantic).concat(C.ssrcIds.map(A=>"".concat(c).concat(A.toString(10))).join("")).concat(this.eol)).join("")}}function L(N){return new j().parse(N)}function B(N,m){return new Ge().print(N,m)}}},t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}return r.d=(i,n)=>{for(var o in n)r.o(n,o)&&!r.o(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:n[o]})},r.o=(i,n)=>Object.prototype.hasOwnProperty.call(i,n),r.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},r(8)})();var Ht=mV.exports;function Sv(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:w("SVC_MODE");if(w("ENABLE_SVC"))return function(t){return t in sv}(e)?e:sv.L1T3}function dN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function uN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,{filterRTX:n,filterVideoFec:o,filterAudioFec:a,filterAudioCodec:s,filterVideoCodec:c}=t,{useXR:l}=r,d=[],u=[],h=[],p=[],g=!1,_=!1;if(Ht.parse(e).mediaDescriptions.forEach(S=>{i&&i!==S.attributes.direction||(S.media.mediaType!=="video"||g||(u=S.attributes.payloads,p=S.attributes.extmaps,g=!0),S.media.mediaType!=="audio"||_||(d=S.attributes.payloads,h=S.attributes.extmaps,_=!0))}),!p||u.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!h||d.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(u.forEach(S=>{var T;(T=S.rtpMap)!==null&&T!==void 0&&T.clockRate&&(S.rtpMap.clockRate=parseInt(S.rtpMap.clockRate)),l&&S.rtcpFeedbacks.push({type:"rrtr"})}),d.forEach(S=>{var T;(T=S.rtpMap)!==null&&T!==void 0&&T.clockRate&&(S.rtpMap.clockRate=parseInt(S.rtpMap.clockRate)),l&&S.rtcpFeedbacks.push({type:"rrtr"})}),n&&(d=d.filter(S=>{var T;return((T=S.rtpMap)===null||T===void 0?void 0:T.encodingName.toLowerCase())!=="rtx"}),u=u.filter(S=>{var T;return((T=S.rtpMap)===null||T===void 0?void 0:T.encodingName.toLowerCase())!=="rtx"})),o&&(u=u.filter(S=>{var T;return!/(red)|(ulpfec)|(flexfec)/i.test(((T=S.rtpMap)===null||T===void 0?void 0:T.encodingName)||"")})),a&&(d=d.filter(S=>{var T;return!/(red)|(ulpfec)|(flexfec)/i.test(((T=S.rtpMap)===null||T===void 0?void 0:T.encodingName)||"")})),s&&(s==null?void 0:s.length)>0&&(d=d.filter(S=>{var T;return Y(s).call(s,((T=S.rtpMap)===null||T===void 0?void 0:T.encodingName.toLowerCase())||"")})),c&&(c==null?void 0:c.length)>0){let S=u.filter(T=>{var y;return Y(c).call(c,((y=T.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())||"")});u=S.concat(n?[]:PR(S,u))}let E=w("UNSUPPORTED_VIDEO_CODEC");return E&&E.length>0&&(u=u.filter(S=>!(S.rtpMap&&Y(E).call(E,S.rtpMap.encodingName.toLowerCase())))),{audioCodecs:d,videoCodecs:u,audioExtensions:h,videoExtensions:p}}function ya(e){let t=Ht.parse(e),r,i;for(let n of t.mediaDescriptions){if(!r){let o=n.attributes.iceUfrag,a=n.attributes.icePwd;if(!o||!a)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:o,icePwd:a}}if(!i){let o=n.attributes.fingerprints;o.length>0&&(i={fingerprints:o})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:i}}function EV(e,t){let r=[],i=e.attributes.ssrcGroups.filter(a=>a.semantic==="FID"),n=e.attributes.ssrcGroups.find(a=>a.semantic==="SIM"),o=e.attributes.ssrcs;if(n)n.ssrcIds.forEach(a=>{var s;let c=(s=i.find(l=>l.ssrcIds[0]===a))===null||s===void 0?void 0:s.ssrcIds[1];r.push({ssrcId:a,rtx:t?c:void 0})});else if(i.length>0){let a=i[0].ssrcIds[0],s=i[0].ssrcIds[1];r.push({ssrcId:a,rtx:t?s:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:o[0].ssrcId})}return r}function hN(e,t,r){let{cname:i}=e,n;t?n=gV(t):(n=e.iceParameters.candidates.map(d=>({foundation:d.foundation,componentId:"1",transport:d.protocol,priority:d.priority.toString(),connectionAddress:d.ip,port:d.port.toString(),type:d.type,extension:{}})),f.debug("Using candidates from gateway."));let o={fingerprints:e.dtlsParameters.fingerprints.map(d=>({hashFunction:d.algorithm,fingerprint:d.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},s;switch(e.dtlsParameters.role){case"server":s="passive";break;case"client":s="active";break;case"auto":s="actpass"}let c=c_(e.rtpCapabilities),l=[];return Array.isArray(r)&&r.length>0&&r.forEach(d=>{l.push({kind:Z.VIDEO,ssrcId:d.v,rtx:d.v_rtx,mslabel:"".concat(d.v,"_").concat(d.a)},{kind:Z.AUDIO,ssrcId:d.a,mslabel:"".concat(d.v,"_").concat(d.a)})}),{dtlsParameters:o,iceParameters:a,candidates:n,rtpCapabilities:c,setup:s,cname:i,preSSRCs:l}}function gV(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],f.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),f.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function hs(e,t,r){let i=[],n=[];return e.forEach(o=>{let{ssrcId:a,rtx:s}=o,c=Fe(8,"track-"),l={ssrcId:a,attributes:uN({label:c,mslabel:r=r||Fe(10,""),msid:"".concat(r," ").concat(c)},t&&{cname:t})};if(i.push(l),s!==void 0){let d={ssrcId:s,attributes:uN({label:c,mslabel:r,msid:"".concat(r," ").concat(c)},t&&{cname:t})};i.push(d),n.push({semantic:"FID",ssrcIds:[a,s]})}}),e.length>1&&n.push({semantic:"SIM",ssrcIds:e.map(o=>{let{ssrcId:a}=o;return a})}),{ssrcs:i,ssrcGroups:n}}function yl(e,t){t instanceof it&&e.attributes.payloads.forEach(r=>{var i;let n=(i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!n||["opus","pcmu","pcma","g722"].indexOf(n)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";let o=t._encoderConfig;o&&n!=="pcmu"&&n!=="pcma"&&n!=="g722"&&(o.bitrate&&!ot()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function NR(e){let t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function DR(e,t){var r;if(!(t instanceof We&&t._encoderConfig&&t._hints.indexOf(Ye.SCREEN_TRACK)===-1))return;let i=t._encoderConfig;ye().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(n=>{var o,a;Y(o=["h264","h265","vp8","vp9","av1"]).call(o,((a=n.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),ye().supportMinBitrate&&!Y(r=t._hints).call(r,Ye.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(n=>{var o,a;Y(o=["h264","h265","vp8","vp9","av1"]).call(o,((a=n.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters["x-google-start-bitrate"]="".concat(w("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function SV(e){if(e.media.mediaType!=="video")return;let t=ve();if(t.name!==Ne.SAFARI&&t.os!==Lt.IOS)return;let r=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function s_(e,t,r){if(!t)return;let i,n;if(e.media.mediaType==="video"?(i=r.videoExtensions,n=r.videoCodecs):(i=r.audioExtensions,n=r.audioCodecs),t.twcc===!0){let o=i.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&(e.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a,s){return s.filter(c=>!!a.find(l=>l.payloadType===c.payloadType&&!!l.rtcpFeedbacks.find(d=>d.type==="transport-cc")))}(n,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(s=>s.type==="transport-cc")||a.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){let o=e.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(a=>{let s=a.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");s!==-1&&a.rtcpFeedbacks.splice(s,1)})}if(t.remb===!0){let o=i.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o&&(e.attributes.extmaps.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a,s){return s.filter(c=>!!a.find(l=>l.payloadType===c.payloadType&&!!l.rtcpFeedbacks.find(d=>d.type==="goog-remb")))}(n,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(s=>s.type==="goog-remb")||a.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){let o=e.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(a=>{let s=a.rtcpFeedbacks.findIndex(c=>c.type==="goog-remb");s!==-1&&a.rtcpFeedbacks.splice(s,1)})}}function TV(e,t,r){if(ot()||e.media.mediaType!=="video"||!(t instanceof We)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!w("SIMULCAST")||r==="vp9"&&w("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let i=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,n=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(s=>s.semantic==="FID"&&s.ssrcIds[0]===n.ssrcId),a={semantic:"SIM",ssrcIds:[n.ssrcId]};for(let s=1;s<i;s++)e.attributes.ssrcs.push({ssrcId:n.ssrcId+s,attributes:Et(n.attributes)}),a.ssrcIds.push(n.ssrcId+s),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+s,attributes:Et(n.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[n.ssrcId+s,o.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(a)}async function vV(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});let i=(await r.createOffer()).sdp,{send:n,recv:o,sendrecv:a}=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0,d=xu(l,s,c,"sendonly"),u=xu(l,s,c,"recvonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ln(d,u,"videoExtensions",h,p,g),ln(d,u,"videoCodecs",h,p,g),ln(d,u,"audioExtensions",h,p,g),ln(d,u,"audioCodecs",h,p,g),w("RAISE_H264_BASELINE_PRIORITY")){let _=g.videoCodecs.findIndex(E=>{var S,T;return((S=E.rtpMap)===null||S===void 0?void 0:S.encodingName.toLocaleLowerCase())==="h264"&&((T=E.fmtp)===null||T===void 0?void 0:T.parameters["profile-level-id"])==="42001f"});if(_!==-1){let E=g.videoCodecs.findIndex(S=>{var T;return((T=S.rtpMap)===null||T===void 0?void 0:T.encodingName.toLocaleLowerCase())==="h264"});if(E<_){f.debug("raising H264 baseline profile priority");let S=g.videoCodecs[_];g.videoCodecs.splice(_,1),g.videoCodecs.splice(E,0,S)}E!==-1&&(p.videoCodecs=p.videoCodecs.filter(S=>{var T,y;return!(((T=S.rtpMap)===null||T===void 0?void 0:T.encodingName.toLocaleLowerCase())==="h264"&&((y=S.fmtp)===null||y===void 0?void 0:y.parameters["profile-level-id"])!=="42001f")})),E!==-1&&w("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(S=>{var T,y;return!(((T=S.rtpMap)===null||T===void 0?void 0:T.encodingName.toLocaleLowerCase())==="h264"&&((y=S.fmtp)===null||y===void 0?void 0:y.parameters["profile-level-id"])!=="42001f")}))}}return{send:h,recv:p,sendrecv:g}}(e,t,i);try{r.close()}catch{}return{send:n,recv:o,sendrecv:a}}function pN(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=xu(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ln(e,t,"videoExtensions",r,i,n),ln(e,t,"videoCodecs",r,i,n),ln(e,t,"audioExtensions",r,i,n),ln(e,t,"audioCodecs",r,i,n),w("RAISE_H264_BASELINE_PRIORITY")){let o=n.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){let a=n.videoCodecs.findIndex(s=>s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(a<o){f.debug("raising H264 baseline profile priority");let s=n.videoCodecs[o];n.videoCodecs.splice(o,1),n.videoCodecs.splice(a,0,s)}a!==-1&&(i.videoCodecs=i.videoCodecs.filter(s=>!(s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&s.fmtp&&s.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:i,sendrecv:n}}function ln(e,t,r,i,n,o){if(r==="videoExtensions"||r==="audioExtensions"){let a=[];return e[r].forEach(s=>{t[r].some((c,l)=>{if(s.entry===c.entry&&s.extensionName===c.extensionName)return a.push(l),!0})?o[r].push(s):i[r].push(s)}),void t[r].forEach((s,c)=>{a.indexOf(c)===-1&&n[r].push(s)})}if(r==="videoCodecs"||r==="audioCodecs"){let a=[];return e[r].forEach(s=>{t[r].some((c,l)=>{if(s.payloadType===c.payloadType&&JSON.stringify(s)===JSON.stringify(c))return a.push(l),!0})?o[r].push(s):i[r].push(s)}),void t[r].forEach((s,c)=>{a.indexOf(c)===-1&&n[r].push(s)})}}function c_(e){let{send:t,recv:r,sendrecv:i}=e;if(!i){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let n,o;return t?(n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n.audioCodecs=[...t.audioCodecs,...i.audioCodecs],n.videoCodecs=[...t.videoCodecs,...i.videoCodecs],n.audioExtensions=[...t.audioExtensions,...i.audioExtensions],n.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):n=i,r?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...r.audioCodecs,...i.audioCodecs],o.videoCodecs=[...r.videoCodecs,...i.videoCodecs],o.audioExtensions=[...r.audioExtensions,...i.audioExtensions],o.videoExtensions=[...r.videoExtensions,...i.videoExtensions]):o=i,{send:n,recv:o}}function Rl(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function qd(e,t,r,i){let n=[];if(e===Z.VIDEO){if(w("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(n=t.videoCodecs.filter(o=>{var a;return Y(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,i)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===w("H264_PROFILE_LEVEL_ID")})),!Array.isArray(n)||n.length===0){let o=[],a=[],s=[],c=[];if(r.videoCodecs.forEach(l=>{let d=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"";Y(d).call(d,i)?o.push(l):Y(d).call(d,"vp9")?a.push(l):Y(d).call(d,"vp8")?s.push(l):Y(d).call(d,"h264")&&c.push(l)}),o.length===0){let l="";a.length!==0?(o=a,l="vp9"):s.length!==0?(o=s,l="vp8"):c.length!==0&&(o=c,l="h264"),f.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(l))}o.length!==0&&(n=t.videoCodecs.filter(l=>o.some(d=>d.payloadType===l.payloadType)))}if(n.length===0&&(f.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),n=t.videoCodecs),w("USE_PUB_RTX")||w("USE_SUB_RTX")){let o=PR(n,t.videoCodecs);n=[...n,...o]}}else n=t.audioCodecs.filter(o=>{var a;return Y(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,i)}),n.length===0&&(f.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),n=t.audioCodecs.filter(o=>{var a;return Y(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,"opus")}));return n}function PR(e,t){let r=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&Y(r).call(r,i.fmtp&&i.fmtp.parameters.apt))}async function mp(e,t,r){let i=t.toString(),n=RV(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});let o=await e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let a=o.sdp;a=yV(a,r||{}),n==null||n(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function yV(e,t,r){let i=Ht.parse(e),{useXR:n}=t;return i.mediaDescriptions.forEach(o=>{var a;o.attributes.mid&&(Array.isArray(r)&&!Y(r).call(r,o.attributes.mid)||(o.media.mediaType==="audio"&&Rl(o),n&&Y(a=["audio","video"]).call(a,o.media.mediaType)&&o.attributes.payloads.forEach(s=>{s.rtcpFeedbacks.findIndex(c=>c.type==="rrtr")===-1&&s.rtcpFeedbacks.push({type:"rrtr"})})))}),Ht.print(i)}function RV(e,t,r,i){if(w("SDP_LOGGING"))return f.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?n=>{RV(n,"answer",r==="local"?"remote":"local",i)}:void 0}function Yn(e,t){return typeof w(e)===t?w(e):void 0}function fN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Zo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Fg=new Map,FX=class extends tt{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(qt.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(qt.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){f.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),v(this,"store",void 0),v(this,"joinInfo",void 0),v(this,"key",void 0),v(this,"ntpOffset",0),v(this,"signal",void 0),v(this,"role",void 0),v(this,"inChannelInfo",{joinAt:null,duration:0}),v(this,"spec",void 0),v(this,"_state","DISCONNECTED"),v(this,"_statsCollector",void 0),v(this,"_disconnectedReason",void 0),v(this,"isSignalRecover",!1),v(this,"hasChangeBGPAddress",!1),v(this,"trafficStatsInterval",void 0),v(this,"networkQualityInterval",void 0),v(this,"_joinGatewayStartTime",0),v(this,"_signalTimeout",!1),v(this,"_clientRoleOptions",void 0),v(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new lN(Zo(Zo({},t),{},{retryConfig:t.websocketRetryConfig}),e):new l7(Zo(Zo({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,r){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let i=Date.now(),n=Fg.get(e.cname);if(n||(n=new Map,Fg.set(e.cname,n)),this._isProactiveJoin=!0,n.has(e.uid)){let c=new D(R.UID_CONFLICT);throw Q.joinGateway(e.sid,{lts:i,succ:!1,ec:c.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,c}n.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=i;let a=e.proxyServer;try{f.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));let c=e.gatewayAddrs.map(l=>{let{address:d}=l,[u,h]=d.split(":"),p={host:u,port:h};return e.proxyServer&&(p.proxy=e.proxyServer),p});o=(await this.signal.init(c,r)).uid,f.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(c){var s;throw f.error("[".concat(this.store.clientId,"] User join failed"),c.toString()),Q.joinGateway(e.sid,{lts:i,succ:!1,ec:((s=c.data)===null||s===void 0?void 0:s.desc)||c.code,errorMsg:c.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,n.delete(e.uid),this.signal.close(),c}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),f.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(c=>{f.warning("[".concat(this.store.clientId,"] get traffic stats error"),c.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(qt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(qt.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(qt.NETWORK_QUALITY,{uplinkNetworkQuality:s0(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:s0(this._statsCollector.trafficStats.B_dnq)}):this.emit(qt.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){t!==Pe.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Ve.CONNECTED||await function(r,i){return i===1/0?r:K.race([r,a9(i)])}(this.signal.request(ne.LEAVE,void 0,!0),3e3)}catch(r){f.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(t),t!==Pe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:w("PUB_EXTEND"),twcc:!!w("PUBLISH_TWCC"),rtx:!!w("USE_PUB_RTX")};try{return(await this.signal.request(ne.PUBLISH,i,!0))._message}catch(n){if(r&&n.data&&n.data.code===te.ERR_PUBLISH_REQUEST_INVALID)return f.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),n.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw n}}async publishDataChannel(e,t,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let n={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:(i=t.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(ne.PUBLISH_DATASTREAM,n,!0)}catch(o){if(r&&o.data&&o.data.code===te.ERR_PUBLISH_REQUEST_INVALID)return f.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw o}}async unpublish(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ne.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(r){f.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await K.all(e.map(t=>this.signal.request(ne.UNPUBLISH_DATASTREAM,{channel_id:t},!0)))}catch(t){f.warning("unpublish datachannels warning: ",t)}}async presubscribe(e,t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let i={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!w("SUBSCRIBE_TWCC"),rtx:!!w("USE_SUB_RTX")||void 0,extend:w("SUB_EXTEND"),svc:Array.isArray(w("SVC"))&&w("SVC").length!==0?w("SVC"):void 0};try{return await this.signal.request(ne.PRE_SUBSCRIBE,i,!0)}catch(n){if(r&&n.data&&n.data.code===te.ERR_SUBSCRIBE_REQUEST_INVALID)return f.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),n.toString()),this.presubscribe(e,t,!1);throw n}}async subscribe(e,t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let i={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!w("SUBSCRIBE_TWCC"),rtx:!!w("USE_SUB_RTX"),extend:w("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(w("SVC"))&&w("SVC").length!==0?w("SVC"):void 0};try{return(await this.signal.request(ne.SUBSCRIBE,i,!0))._message}catch(n){if(r&&n.data&&n.data.code===te.ERR_SUBSCRIBE_REQUEST_INVALID)return f.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),n.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw n}}async subscribeDataChannel(e,t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let i={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(ne.SUBSCRIBE_DATASTREAM,i,!0)}catch(n){if(r&&n.data&&n.data.code===te.ERR_SUBSCRIBE_REQUEST_INVALID)return f.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),n.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw n}}async subscribeAll(e,t){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!w("USE_SUB_RTX"),twcc:!!w("SUBSCRIBE_TWCC"),svc:Array.isArray(w("SVC"))&&w("SVC").length!==0?w("SVC"):void 0};try{return await this.signal.request(ne.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(t&&i.data&&i.data.code===te.ERR_SUBSCRIBE_REQUEST_INVALID)return f.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw i}}async setVideoProfile(e){let t=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,n=r.width,o=r.height,a=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(a=!1)),typeof n!="number"&&(n=n.exact||n.ideal||n.max||n.min||0,n||(a=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(a=!1)),a?{stream_type:0,width:n,height:o,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(e);if(t)return this.signal.request(ne.SET_VIDEO_PROFILE,t);f.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(ne.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(r){f.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await K.all(e.map(r=>this.signal.request(ne.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:t},!0)))}catch(r){f.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(e){try{await this.signal.request(ne.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){f.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(ne.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ne.GATEWAY_INFO)}async renewToken(e){await this.signal.request(ne.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),this.state!=="CONNECTED")return void(this.role=e);let r,i=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(ne.SET_CLIENT_ROLE,{role:e,level:i,delay:r,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(ne.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(ne.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(ne.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(ne.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(ne.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,r){if(this.signal instanceof lN)return this.signal.sendExtensionMessage(e,t,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Zo({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ne.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=Fg.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e=function(t){let r;return r=t.startsWith("dc")?t.match(/(dc\:\/\/)?([^:]+):(\d+)/):t.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Xt.username,password:Xt.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Zo(Zo({},Xt),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let e=await this.signal.request(ne.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(t=>{let r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===t.peer_uid);r&&r.B_st!==t.B_st&&nm(()=>{this.emit(qt.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new D(R.UNEXPECTED_ERROR,"can not generate join message, no join info");let t=Object.assign({},this.joinInfo.apResponse),r=w("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);let i=!(ot()||px(87)||D0())&&typeof w("ENABLE_PRE_SUB")=="boolean"&&w("ENABLE_PRE_SUB"),n=!D0()&&Yn("ENABLE_PREALLOC_PC","boolean"),o=Zo({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ui,browser:navigator.userAgent,process_id:w("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:w("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:w("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:w("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof w("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?w("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof w("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?w("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof w("ENABLE_USER_LICENSE_CHECK")=="boolean"?w("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:w("USE_PUB_RTX")===!0||w("USE_SUB_RTX")===!0||void 0,disableFEC:w("DISABLE_FEC"),enableNTPReport:!!w("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!w("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!w("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Yn("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!w("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!w("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Yn("USE_XR","boolean"),enableLossbasedBwe:Yn("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!w("ENABLE_AUT_CC")||void 0,enableCCFallback:Yn("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:n,preSubNum:i?Yn("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Yn("PUBLISH_TWCC","boolean"),enableSubTWCC:Yn("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Yn("USE_PUB_RTX","boolean"),enableSubRTX:Yn("USE_SUB_RTX","boolean"),enableSubSVC:w("ENABLE_SVC")?w("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(w("SVC"))&&w("SVC").length!==0?w("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,w("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new D(R.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(oe.WS_RECONNECT_WAITTING_FINISH,e=>{var t;Y(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&Q.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(oe.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(oe.WS_RECONNECTING,e=>{this.joinInfo&&Q.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Zt.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Q.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(oe.WS_CLOSED,e=>{let t;switch(e){case Pe.LEAVE:t=Zt.LEAVE;break;case Pe.UID_BANNED:case Pe.IP_BANNED:case Pe.CHANNEL_BANNED:case Pe.SERVER_ERROR:t=Zt.SERVER_ERROR;break;case Pe.FALLBACK:t=Zt.FALLBACK;break;case Pe.LICENSE_MISSING:case Pe.LICENSE_EXPIRED:case Pe.LICENSE_MINUTES_EXCEEDED:case Pe.LICENSE_PERIOD_INVALID:case Pe.LICENSE_MULTIPLE_SDK_SERVICE:case Pe.LICENSE_ILLEGAL:case Pe.TOKEN_EXPIRE:t=e;break;default:t=Zt.NETWORK_ERROR}f.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+Zt.NETWORK_ERROR)),this.joinInfo&&Q.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Pe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==Pe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(oe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(f.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Q.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void f.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Le("EVENT_REPORT_DOMAIN",e[1]),Le("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Le("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(_e.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(oe.REQUEST_RECOVER,(e,t,r)=>{if(!this.joinInfo)return r(new D(R.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,tr(this,qt.REQUEST_NEW_GATEWAY_LIST).then(t).catch(r)}),this.signal.on(oe.REQUEST_JOIN_INFO,async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let{iceParameters:r,dtlsParameters:i,rtpCapabilities:n}=await tr(this,qt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(t=this.joinInfo)===null||t===void 0?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:n,version:"2"}}))}),this.signal.on(oe.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(oe.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let r,i="";var n;e instanceof D?(r=((n=e.data)===null||n===void 0?void 0:n.desc)||e.code,i=e.message):r=e,Q.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(oe.IS_P2P_DISCONNECTED,e=>{e(Pu(this,qt.IS_P2P_DISCONNECTED))}),this.signal.on(oe.DISCONNECT_P2P,()=>{this.emit(qt.DISCONNECT_P2P)}),this.signal.on(oe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(oe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(oe.JOIN_RESPONSE,e=>{let t=this.getCurrentGatewayAddress();this.emit(qt.JOIN_RESPONSE,e,t)}),this.signal.on(oe.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let e=this.getCurrentGatewayAddress(),t=w("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){let r=gV(e);this.emit(qt.PRE_CONNECT_PC,{candidates:r,fingerprint:t})}}})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(ne.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(r){throw f.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(ne.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(r){throw f.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(ne.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(r){throw f.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(ne.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(r){throw f.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(e){let t={users:e.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(ne.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){throw f.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(e,t){let r={action:e.find(i=>i.stream_type===be.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ne.CONTROL,r,!0,!0)}catch(i){throw f.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(e,t){let r={action:e.find(i=>i.stream_type===be.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ne.CONTROL,r,!0,!0)}catch(i){throw f.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(e,t){let r={action:e===Z.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ne.CONTROL,r,!0,!0)}catch(i){throw f.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(e,t){let r={action:e===Z.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ne.CONTROL,r,!0,!0)}catch(i){throw f.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(ne.RESTART_ICE,t,!0)}catch(r){throw f.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Zt.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!w("GATEWAY_WSS_ADDRESS"))return w("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(f.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(ne.SET_PARAMETER,{enablePublishAudioFilter:e})}},Ep=0,Bg=0;function Bn(e,t,r,i){return new K((n,o)=>{t.timeout=t.timeout||w("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),Ep+=no(t.data)):r&&(t.data.size?Ep+=t.data.size:t.data instanceof FormData?Ep+=Cx(t.data):Ep+=no(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Vr.request(t).then(a=>{typeof a.data=="string"?Bg+=no(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?Bg+=a.data.byteLength:Bg+=no(JSON.stringify(a.data)),i&&n({data:a.data,headers:a.headers}),n(a.data)}).catch(a=>{Vr.isCancel(a)?o(new D(R.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?o(new D(R.NETWORK_TIMEOUT,a.message)):a.response?o(new D(R.NETWORK_RESPONSE_ERROR,a.response.status)):o(new D(R.NETWORK_ERROR,a.message))})})}(function(){var e;function t(x){var L=0;return function(){return L<x.length?{done:!1,value:x[L++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,L,B){return x==Array.prototype||x==Object.prototype||(x[L]=B.value),x},i,n=function(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof Jc=="object"&&Jc];for(var L=0;L<x.length;++L){var B=x[L];if(B&&B.Math==Math)return B}throw Error("Cannot find global object")}(this);function o(x,L){if(L)e:{var B=n;x=x.split(".");for(var N=0;N<x.length-1;N++){var m=x[N];if(!(m in B))break e;B=B[m]}(L=L(N=B[x=x[x.length-1]]))!=N&&L!=null&&r(B,x,{configurable:!0,writable:!0,value:L})}}function a(x){return(x={next:x})[Symbol.iterator]=function(){return this},x}function s(x){var L=typeof Symbol<"u"&&Symbol.iterator&&x[Symbol.iterator];return L?L.call(x):{next:t(x)}}if(o("Symbol",function(x){function L(m,C){this.A=m,r(this,"description",{configurable:!0,writable:!0,value:C})}if(x)return x;L.prototype.toString=function(){return this.A};var B="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",N=0;return function m(C){if(this instanceof m)throw new TypeError("Symbol is not a constructor");return new L(B+(C||"")+"_"+N++,C)}}),o("Symbol.iterator",function(x){if(x)return x;x=Symbol("Symbol.iterator");for(var L="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),B=0;B<L.length;B++){var N=n[L[B]];typeof N=="function"&&typeof N.prototype[x]!="function"&&r(N.prototype,x,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return x}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var c;e:{var l={};try{l.__proto__={a:!0},c=l.a;break e}catch{}c=!1}i=c?function(x,L){if(x.__proto__=L,x.__proto__!==L)throw new TypeError(x+" is not extensible");return x}:null}var d=i;function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(x){if(x.m)throw new TypeError("Generator is already running");x.m=!0}function p(x,L){return x.h=3,{value:L}}function g(x){this.g=new u,this.G=x}function _(x,L,B,N){try{var m=L.call(x.g.j,B);if(!(m instanceof Object))throw new TypeError("Iterator result "+m+" is not an object");if(!m.done)return x.g.m=!1,m;var C=m.value}catch(A){return x.g.j=null,x.g.s(A),E(x)}return x.g.j=null,N.call(x.g,C),E(x)}function E(x){for(;x.g.h;)try{var L=x.G(x.g);if(L)return x.g.m=!1,{value:L.value,done:!1}}catch(B){x.g.v=void 0,x.g.s(B)}if(x.g.m=!1,x.g.l){if(L=x.g.l,x.g.l=null,L.F)throw L.D;return{value:L.return,done:!0}}return{value:void 0,done:!0}}function S(x){this.next=function(L){return x.o(L)},this.throw=function(L){return x.s(L)},this.return=function(L){return function(B,N){h(B.g);var m=B.g.j;return m?_(B,"return"in m?m.return:function(C){return{value:C,done:!0}},N,B.g.return):(B.g.return(N),E(B))}(x,L)},this[Symbol.iterator]=function(){return this}}function T(x,L){return L=new S(new g(L)),d&&x.prototype&&d(L,x.prototype),L}if(u.prototype.o=function(x){this.v=x},u.prototype.s=function(x){this.l={D:x,F:!0},this.h=this.C||this.u},u.prototype.return=function(x){this.l={return:x},this.h=this.u},g.prototype.o=function(x){return h(this.g),this.g.j?_(this,this.g.j.next,x,this.g.o):(this.g.o(x),E(this))},g.prototype.s=function(x){return h(this.g),this.g.j?_(this,this.g.j.throw,x,this.g.o):(this.g.s(x),E(this))},o("Array.prototype.entries",function(x){return x||function(){return function(L,B){L instanceof String&&(L+="");var N=0,m=!1,C={next:function(){if(!m&&N<L.length){var A=N++;return{value:B(A,L[A]),done:!1}}return m=!0,{done:!0,value:void 0}}};return C[Symbol.iterator]=function(){return C},C}(this,function(L,B){return[L,B]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var y=function(x,L){for(var B=0;B<x.length;B++)L(x[B])},I=function(x){return x.replace(/\r?\n|\r/g,`\r
`)},O=function(x,L,B){return L instanceof Blob?(B=B!==void 0?B+"":typeof L.name=="string"?L.name:"blob",L.name===B&&Object.prototype.toString.call(L)!=="[object Blob]"||(L=new File([L],B)),[String(x),L]):[String(x),String(L)]},b=function(x,L){if(x.length<L)throw new TypeError(L+" argument required, but only "+x.length+" present.")},k=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,P=k.FormData,j=k.XMLHttpRequest&&k.XMLHttpRequest.prototype.send,G=k.Request&&k.fetch,ce=k.navigator&&k.navigator.sendBeacon,pe=k.Element&&k.Element.prototype,Ae=k.Symbol&&Symbol.toStringTag;Ae&&(Blob.prototype[Ae]||(Blob.prototype[Ae]="Blob"),"File"in k&&!File.prototype[Ae]&&(File.prototype[Ae]="File"));try{new File([],"")}catch{k.File=function(x,L,B){return x=new Blob(x,B||{}),Object.defineProperties(x,{name:{value:L},lastModified:{value:+(B&&B.lastModified!==void 0?new Date(B.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ae&&Object.defineProperty(x,Ae,{value:"File"}),x}}var Ge=function(x){return x.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},at=function(x){this.i=[];var L=this;x&&y(x.elements,function(B){if(B.name&&!B.disabled&&B.type!=="submit"&&B.type!=="button"&&!B.matches("form fieldset[disabled] *"))if(B.type==="file"){var N=B.files&&B.files.length?B.files:[new File([],"",{type:"application/octet-stream"})];y(N,function(m){L.append(B.name,m)})}else B.type==="select-multiple"||B.type==="select-one"?y(B.options,function(m){!m.disabled&&m.selected&&L.append(B.name,m.value)}):B.type==="checkbox"||B.type==="radio"?B.checked&&L.append(B.name,B.value):(N=B.type==="textarea"?I(B.value):B.value,L.append(B.name,N))})};if((e=at.prototype).append=function(x,L,B){b(arguments,2),this.i.push(O(x,L,B))},e.delete=function(x){b(arguments,1);var L=[];x=String(x),y(this.i,function(B){B[0]!==x&&L.push(B)}),this.i=L},e.entries=function x(){var L,B=this;return T(x,function(N){if(N.h==1&&(L=0),N.h!=3)return L<B.i.length?N=p(N,B.i[L]):(N.h=0,N=void 0),N;L++,N.h=2})},e.forEach=function(x,L){b(arguments,1);for(var B=s(this),N=B.next();!N.done;N=B.next()){var m=s(N.value);N=m.next().value,m=m.next().value,x.call(L,m,N,this)}},e.get=function(x){b(arguments,1);var L=this.i;x=String(x);for(var B=0;B<L.length;B++)if(L[B][0]===x)return L[B][1];return null},e.getAll=function(x){b(arguments,1);var L=[];return x=String(x),y(this.i,function(B){B[0]===x&&L.push(B[1])}),L},e.has=function(x){b(arguments,1),x=String(x);for(var L=0;L<this.i.length;L++)if(this.i[L][0]===x)return!0;return!1},e.keys=function x(){var L,B,N,m,C=this;return T(x,function(A){if(A.h==1&&(L=s(C),B=L.next()),A.h!=3)return B.done?void(A.h=0):(N=B.value,m=s(N),p(A,m.next().value));B=L.next(),A.h=2})},e.set=function(x,L,B){b(arguments,2),x=String(x);var N=[],m=O(x,L,B),C=!0;y(this.i,function(A){A[0]===x?C&&(C=!N.push(m)):N.push(A)}),C&&N.push(m),this.i=N},e.values=function x(){var L,B,N,m,C=this;return T(x,function(A){if(A.h==1&&(L=s(C),B=L.next()),A.h!=3)return B.done?void(A.h=0):(N=B.value,(m=s(N)).next(),p(A,m.next().value));B=L.next(),A.h=2})},at.prototype._asNative=function(){for(var x=new P,L=s(this),B=L.next();!B.done;B=L.next()){var N=s(B.value);B=N.next().value,N=N.next().value,x.append(B,N)}return x},at.prototype._blob=function(){var x="----formdata-polyfill-"+Math.random(),L=[],B="--"+x+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(N,m){return typeof N=="string"?L.push(B+Ge(I(m))+`"\r
\r
`+I(N)+`\r
`):L.push(B+Ge(I(m))+'"; filename="'+Ge(N.name)+`"\r
Content-Type: `+(N.type||"application/octet-stream")+`\r
\r
`,N,`\r
`)}),L.push("--"+x+"--"),new Blob(L,{type:"multipart/form-data; boundary="+x})},at.prototype[Symbol.iterator]=function(){return this.entries()},at.prototype.toString=function(){return"[object FormData]"},pe&&!pe.matches&&(pe.matches=pe.matchesSelector||pe.mozMatchesSelector||pe.msMatchesSelector||pe.oMatchesSelector||pe.webkitMatchesSelector||function(x){for(var L=(x=(this.document||this.ownerDocument).querySelectorAll(x)).length;0<=--L&&x.item(L)!==this;);return-1<L}),Ae&&(at.prototype[Ae]="FormData"),j){var pr=k.XMLHttpRequest.prototype.setRequestHeader;k.XMLHttpRequest.prototype.setRequestHeader=function(x,L){pr.call(this,x,L),x.toLowerCase()==="content-type"&&(this.B=!0)},k.XMLHttpRequest.prototype.send=function(x){x instanceof at?(x=x._blob(),this.B||this.setRequestHeader("Content-Type",x.type),j.call(this,x)):j.call(this,x)}}G&&(k.fetch=function(x,L){return L&&L.body&&L.body instanceof at&&(L.body=L.body._blob()),G.call(this,x,L)}),ce&&(k.navigator.sendBeacon=function(x,L){return L instanceof at&&(L=L._asNative()),ce.call(this,x,L)}),k.FormData=at}})();var Vu=()=>{let e=w("AREAS");return e.length===0&&e.push(we.GLOBAL),xn(e).call(e,(t,r,i)=>{let n=CV(r);return n?i===0?n:"".concat(t,",").concat(n):t},"")},CV=e=>e===we.OVERSEA?"".concat(or.ASIA,",").concat(or.EUROPE,",").concat(or.AFRICA,",").concat(or.NORTH_AMERICA,",").concat(or.SOUTH_AMERICA,",").concat(or.OCEANIA):or[e],BX=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{let i=lm[r],n=Object.keys(i);n&&n.map(o=>{o!=="CODE"&&(t[o]=t[o].concat(i[o]))})}),t},hf={GLOBAL:{ASIA:[we.CHINA,we.JAPAN,we.INDIA,we.KOREA,we.HKMC],EUROPE:[],NORTH_AMERICA:[we.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},gp=Object.keys(hf[we.GLOBAL]),jg=[we.CHINA,we.NORTH_AMERICA,we.EUROPE,we.ASIA,we.JAPAN,we.INDIA,we.OCEANIA,we.SOUTH_AMERICA,we.AFRICA,we.KOREA,we.HKMC,we.US],jX=function(e,t){let r=[];if(Y(e).call(e,we.GLOBAL)){let o=[we.GLOBAL,we.OVERSEA],a=Object.keys(lm);if(t===we.GLOBAL)throw new D(R.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===we.CHINA)r=[we.OVERSEA];else if(n=t,Y(gp).call(gp,n)){let s=(i=t,hf[we.GLOBAL][i]||[]),c=[...o,t,...s];r=a.filter(l=>!Y(c).call(c,l))}else if(function(s){let c=!1;return gp.forEach(l=>{var d;Y(d=hf[we.GLOBAL][l]).call(d,s)&&(c=!0)}),c}(t)){let s=function(l){let d;return gp.forEach(u=>{var h;Y(h=hf[we.GLOBAL][u]).call(h,l)&&(d=u)}),d}(t),c=[...o,s,t];r=a.filter(l=>!Y(c).call(c,l))}else r=e;r=function(s){let c=[];return jg.forEach(l=>{Y(s).call(s,l)&&c.push(l)}),c.concat(s.filter(l=>!Y(jg).call(jg,l)))}(r)}else r=e;var i,n;return r};function _N(e){var t,r;if(!e&&Y(t=w("AREAS")).call(t,we.EXTENSIONS))return f.debug("update area from ap : reset"),void kR(m9,!0);if(!Y(r=w("AREAS")).call(r,we.GLOBAL)||!e)return;let i=lm.EXTENSIONS;i&&(i={CODE:CV(we.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},f.debug("update area from ap success: ".concat(e,",config is "),i),Le("AREAS",[we.EXTENSIONS],!0),Object.keys(i).map(n=>{n==="LOG_UPLOAD_SERVER"||n==="EVENT_REPORT_DOMAIN"||n==="EVENT_REPORT_BACKUP_DOMAIN"||n==="PROXY_SERVER_TYPE3"?Le(n,i[n][0]):Le(n,i[n])}))}function kR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=Q.reportApiInvoke(null,{name:wt.SET_AREA,options:e,tag:nt.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(o=>{if(!Y(e0).call(e0,o))throw new D(R.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:o,excludedArea:a}=e;if(!o)throw new D(R.INVALID_PARAMS,"area code is needed");let s=o;typeof o=="string"&&(s=[o]),i=a?jX(s,a):s}if(!t){if(Sa.AREAS){let o=new D(R.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(o),void f.warning("setArea is prohibited because of config-distribute")}if(Y(i).call(i,we.GLOBAL)&&w("AREAS")===we.EXTENSIONS){let o=new D(R.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(o),void f.warning("setArea is prohibited because of ap extensions")}}Le("AREAS",i,t);let n=BX(i);Object.keys(n).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?Le(o,n[o][0]):Le(o,n[o])}),f.debug("set area success:",i.join(","))}catch(i){throw r.onError(i),i}r.onSuccess()}function mN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Tv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Gg=1;function GX(e,t,r,i,n){Gg+=1;let o={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:Gg,requestId:Gg,version:Ui,cname:r.cname},a={service_name:t,json_body:JSON.stringify(o)},s,c,l=e[0];return Fn(async()=>{s=Date.now();let d=await Bn(l,{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-s,d.code!==0){let p=new D(R.UNEXPECTED_RESPONSE,"live streaming ap error, code"+d.code,{retry:!0,responseTime:c});throw f.error(p.toString()),p}let u=JSON.parse(d.json_body);if(u.code!==200){let p=new D(R.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(u.code,", reason: ").concat(u.reason),{code:u.code,responseTime:c});throw f.error(p.toString()),p}if(!u.servers||u.servers.length===0){let p=new D(R.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:u.code,responseTime:c});throw f.error(p.toString()),p}let h=function(p,g){return{addressList:p.servers.map(_=>"wss://".concat(_.address.replace(/\./g,"-"),".").concat(w("WORKER_DOMAIN"),":").concat(_.wss,"?serviceName=").concat(encodeURIComponent(g))),workerToken:p.workerToken,vid:p.vid}}(u,t);return w("LIVE_STREAMING_ADDRESS")&&(h.addressList=w("LIVE_STREAMING_ADDRESS")instanceof Array?w("LIVE_STREAMING_ADDRESS"):[w("LIVE_STREAMING_ADDRESS")]),Tv(Tv({},h),{},{responseTime:c})},(d,u)=>(Q.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(d.addressList),firstSuccess:u===0,responseTime:c,serverIp:e[u%e.length]}),!1),(d,u)=>(Q.apworkerEvent(r.sid,{success:!1,sc:d.data&&d.data.code||200,serviceName:t,responseTime:c,serverIp:e[u%e.length]}),!!(d.code!==R.OPERATION_ABORTED&&d.code!==R.UNEXPECTED_RESPONSE||d.data&&d.data.retry)&&(l=e[(u+1)%e.length],!0)),n)}var Wg=1;function EN(e,t,r,i){let{url:n,areaCode:o}=e,{clientId:a,sid:s}=t,c=Date.now(),l,[d,u]=MR(t,o,[gt.CHOOSE_SERVER]),h=St.networkState;return Fn(async()=>{h&&St.networkState===ei.OFFLINE&&St.onlineWaiter&&await K.race([St.onlineWaiter,zt(i&&i.maxRetryTimeout||Rt.maxRetryTimeout)]),h=St.networkState;let{data:p,headers:g}=await Bn(n,{data:d,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=g.http3==="1"?1:-1,Q.reportResourceTiming(n,s),IV(p,n,t,c,[gt.CHOOSE_SERVER],l);let _=Uu(p,gt.CHOOSE_SERVER);return LR(_),yR(_,n)},p=>(p&&Q.joinChooseServer(s,{lts:c,succ:!0,csAddr:n,opid:u,serverList:p.gatewayAddrs.map(g=>g.address),ec:null,cid:p.cid.toString(),uid:p.uid.toString(),csIp:p.csIp,unilbsServerIds:[gt.CHOOSE_SERVER].toString(),isHttp3:l}),!1),p=>p.code!==R.OPERATION_ABORTED&&(p.code===R.CAN_NOT_GET_GATEWAY_SERVER?p.data.retry:(Q.joinChooseServer(s,{lts:c,succ:!1,csAddr:n,serverList:null,opid:u,ec:p.code,csIp:p.data&&p.data.csIp,unilbsServerIds:[gt.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:l}),f.warning("[".concat(a||"sid-".concat(s.slice(0,6)),"] Choose server network error, retry"),p),!0)),i)}function gN(e,t,r,i){let n,{url:o,areaCode:a,serviceIds:s}=e,c=Date.now(),[l,d]=MR(t,a,s),u;return Fn(async()=>{u&&St.networkState===ei.OFFLINE&&St.onlineWaiter&&await K.race([St.onlineWaiter,zt(i&&i.maxRetryTimeout||Rt.maxRetryTimeout)]),u=St.networkState;let{data:h,headers:p}=await Bn(o,{data:l,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);n=p.http3==="1"?1:-1,Q.reportResourceTiming(o,t.sid),IV(h,o,t,c,s,n);let g=Uu(h,gt.CHOOSE_SERVER),_=Uu(h,t.cloudProxyServer==="proxy5"?gt.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?gt.CLOUD_PROXY:gt.CLOUD_PROXY_FALLBACK);return LR(g),{gatewayInfo:yR(g,o),proxyInfo:_,url:o}},h=>(h.gatewayInfo&&Q.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,serverList:h.gatewayInfo.gatewayAddrs.map(p=>p.address),ec:null,opid:d,cid:h.gatewayInfo.cid.toString(),uid:h.gatewayInfo.uid.toString(),csIp:h.gatewayInfo.csIp,unilbsServerIds:s.toString(),isHttp3:n}),h.proxyInfo&&Q.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:h.proxyInfo.addresses.map(p=>p.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:s.toString()}),!1),h=>h.code!==R.OPERATION_ABORTED&&(h.code===R.CAN_NOT_GET_GATEWAY_SERVER?h.data.retry:(Q.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:h.code,eventType:t.cloudProxyServer,unilbsServerIds:s.toString(),extend:JSON.stringify({networkState:u})}),f.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),h),!0)),i)}var IV=(e,t,r,i,n,o)=>{let{sid:a,clientId:s,cloudProxyServer:c}=r,l=[],d=u=>{u.flag===4096?Q.joinChooseServer(a,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:u.error.message,csIp:u.error.data&&u.error.data.csIp,unilbsServerIds:n.toString(),isHttp3:o}):u.flag!==1048576&&u.flag!==4194304&&u.flag!==4194310||Q.joinWebProxyAP(a,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:u.error.code,eventType:c,unilbsServerIds:n.toString()})};if(e.response_body.forEach(u=>{let h=u.buffer.code;if(u.uri===23&&h===0&&!u.buffer.edges_services)if(u.buffer.flag===4194310)f.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),u.buffer.edges_services=[];else{let p={error:new D(R.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:u.buffer.flag};l.push(p),d(p)}if(h!==0){let p=Sl(h),g={error:new D(R.CAN_NOT_GET_GATEWAY_SERVER,p.desc,{desc:p.desc,retry:p.retry,csIp:e.detail[502]}),flag:u.buffer.flag};u.buffer.flag===4194310?f.warning(g.error.toString()):l.push(g),d(g)}}),l.length)throw f.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message,", retry: ").concat(u.error.data.retry)).join(" | "))),new D(R.CAN_NOT_GET_GATEWAY_SERVER,l.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message)).join(" | "),{retry:!!l.find(u=>u.error.data.retry),csIp:e.detail[502],desc:[...new Set(l.map(u=>{var h;return u==null||(h=u.error)===null||h===void 0||(h=h.data)===null||h===void 0?void 0:h.desc}).filter(u=>!!u))]})},LR=e=>{var t,r,i,n;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new D(R.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(w("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((n=e.detail)===null||n===void 0?void 0:n[23])=="string"?_N(e.detail[23].toLowerCase()):_N()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){let a=e.detail[19],s=a==null?void 0:a.split(";");for(let c=0;c<s.length;c++){var o;let l=Sr(o=s[c]).call(o);e.addresses[c]&&s&&(e.addresses[c].fingerprint=l)}}if(w("GATEWAY_ADDRESS")&&w("GATEWAY_ADDRESS").length>0){f.debug("assign gateway address to",w("GATEWAY_ADDRESS"));let a=w("GATEWAY_ADDRESS").map(s=>{var c,l;let d=(c=(l=e.addresses.find(u=>u.ip===s.ip&&u.port===s.port))===null||l===void 0?void 0:l.fingerprint)!==null&&c!==void 0?c:"";return{ip:s.ip,port:s.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:d}});e.addresses=a}},WX=(e,t)=>{if(e.response_body&&e.response_body.length){let r=e.response_body[0];if(r.buffer.code!==0){let i=Sl(r.buffer.code);throw new D(R.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return r.buffer.ticket}throw f.debug("update ticket request received ap response without response body:",t),new D(R.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},MR=(e,t,r)=>{let i=Math.floor(Math.random()*1e12),n={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Tv({6:e.stringUid,11:t,12:w("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};n.request_bodies.forEach(a=>{e.multiIP&&e.multiIP.gateway_ip&&(a.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let o=new FormData;return o.append("request",JSON.stringify(n)),[o,i]},HX=(e,t)=>{let r=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},n=new FormData;return n.append("request",JSON.stringify(i)),[n,r]},nl=0;function Bl(e){return K.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}var Fu=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:i,allFailedhandler:n,promisesCollector:o}=e,a=0,s=t,c,l=0,d=async()=>{let u=(()=>{let h=a*s,p=h+s;return r.slice(h,p).map(i)})();o&&o.push(...u);try{c=await Bl(u)}catch(h){if(l+=s,a++,!(l>=r.length))return void await d();n(h)}u.forEach(h=>h.cancel())};return await d(),c},wV=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:i}=e,n=t.length,o=0,a=async()=>{let s=r(t.shift());try{return await s}catch(c){if(o++,o>=n||i!=null&&i(c))throw c;return a()}};return a()};async function vv(e,t,r,i){return{gatewayInfo:await async function(n,o,a,s){let c=null,l=[],d=async()=>{let h=w("WEBCS_DOMAIN").slice(0,w("AJAX_REQUEST_CONCURRENT")).map(_=>({url:n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"),areaCode:Vu()})),p=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:h.map(_=>_.url)}),g=await Fu({fragementLength:w("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:_=>(f.debug("[".concat(n.clientId,"] Connect to choose_server:"),_.url),EN(_,n,o,a)),allFailedhandler:_=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_},p),_[0]},promisesCollector:l});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},p),g},u=async()=>{if(await zt(1e3),c!==null)return c;let h=w("WEBCS_DOMAIN_BACKUP_LIST").map(_=>({url:n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"),areaCode:Vu()})),p=s.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:h.map(_=>_.url)}),g=await Fu({fragementLength:w("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:_=>(f.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),_.url),EN(_,n,o,a)),allFailedhandler:_=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_},p),_[0]},promisesCollector:l});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},p),g};try{return c=await Bl([d(),u()]),l.length&&l.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),c}catch(h){throw h[0]}}(e,t,r,i)}}async function SN(e,t,r,i,n){let o=e.cloudProxyServer;if(o==="disabled"){if(e.useLocalAccessPoint)return await vv(e,t,r,n);if(w("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:h,proxyInfo:p}=await vN(e,t,r,n);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:h};let g=p.map(_=>({turnServerURL:_.address,tcpport:_.tcpport||Xt.tcpport,udpport:_.udpport||Xt.udpport,username:_.username||Xt.username,password:_.password||Xt.password,forceturn:!1,security:!0}));if(n.useP2P){var a;let _=(a=e.uid)!==null&&a!==void 0?a:h.uid,E="glb:".concat(_.toString()),S=await nv(E),T=p.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||Xt.tcpport,udpport:y.udpport||Xt.udpport,username:E,password:S,forceturn:!1,security:!0}));g.push(...T)}return e.turnServer={mode:"manual",servers:g},{gatewayInfo:h}}return await vv(e,t,r,n)}let{proxyInfo:s,gatewayInfo:c}=await vN(e,t,r,n),l={gatewayInfo:c},d=s.map(h=>({turnServerURL:h.address,tcpport:o==="proxy3"?void 0:h.tcpport?h.tcpport:Xt.tcpport,udpport:o==="proxy4"?void 0:h.udpport?h.udpport:Xt.udpport,username:h.username||Xt.username,password:h.password||Xt.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(n.useP2P){var u;let h=(u=e.uid)!==null&&u!==void 0?u:c.uid,p="glb:".concat(h.toString()),g=await nv(p),_=s.map(E=>({turnServerURL:E.address,tcpport:o==="proxy3"?void 0:E.tcpport||Xt.tcpport,udpport:o==="proxy4"?void 0:E.udpport||Xt.udpport,username:p,password:g,forceturn:o!=="proxy4",security:o==="proxy5"}));d.push(..._)}return e.turnServer={mode:"manual",servers:d},f.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),l}async function AV(e,t,r,i,n){let o=w("ACCOUNT_REGISTER").slice(0,w("AJAX_REQUEST_CONCURRENT")),a=[];a=t.proxyServer?o.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):o.map(c=>"https://".concat(c,"/api/v1"));let s=n==null?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{let c=await async function(l,d,u,h,p){let g=Date.now(),_={sid:u.sid,opid:10,appid:u.appId,string_uid:d},E=l[0],S=await Fn(()=>Bn(E+"".concat(E.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(T,y)=>{if(T.code===0){if(T.uid<=0||T.uid>=Math.pow(2,32))throw f.error("Invalid Uint Uid ".concat(d," => ").concat(T.uid),T),Q.reqUserAccount(_.sid,{lts:g,success:!1,serverAddr:E,stringUid:_.string_uid,uid:T.uid,errorCode:R.INVALID_UINT_UID_FROM_STRING_UID,extend:_}),new D(R.INVALID_UINT_UID_FROM_STRING_UID);return Q.reqUserAccount(_.sid,{lts:g,success:!0,serverAddr:E,stringUid:_.string_uid,uid:T.uid,errorCode:null,extend:_}),!1}let I=Sl(T.code);return I.retry&&(E=l[(y+1)%l.length]),Q.reqUserAccount(_.sid,{lts:g,success:!1,serverAddr:E,stringUid:_.string_uid,uid:T.uid,errorCode:I.desc,extend:_}),I.retry},(T,y)=>T.code!==R.OPERATION_ABORTED&&(Q.reqUserAccount(_.sid,{lts:g,success:!1,serverAddr:E,stringUid:_.string_uid,uid:null,errorCode:T.code,extend:_}),E=l[(y+1)%l.length],!0),p);if(S.code!==0){let T=Sl(S.code);throw new D(R.UNEXPECTED_RESPONSE,T.desc)}return S}(a,e,t,r,i);return n==null||n.recordJoinChannelService({status:"success",endTs:Date.now()},s),c.uid}catch(c){throw n==null||n.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c]},s),c}}async function KX(e,t,r){let i=w("ACCOUNT_REGISTER"),n=[];n=t.proxyServer?i.map(o=>"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1")):i.map(o=>"https://".concat(o,"/api/v1"));try{return await wV({referenceList:n,asyncMapHandler:o=>async function(a,s,c,l){let d=Date.now(),u={sid:c.sid,opid:10,appid:c.appId,string_uid:s};try{let h=await Bn(a+"".concat(a.indexOf("?")===-1?"?":"&","action=stringuid"),{data:u,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(h.code!==0){let p=Sl(h.code);throw new D(R.UNEXPECTED_RESPONSE,"preload sua error:".concat(p.desc),p)}if(h.uid<=0||h.uid>=Math.pow(2,32))throw new D(R.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:d,url:a,req:u,uid:h.uid,elapse:Date.now()-d}}catch(h){throw h}}(o,e,t,r),closeFn:o=>o.code===R.OPERATION_ABORTED||o.code===R.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(o){throw o}}async function zX(e,t,r){let i=w("CDS_AP").slice(0,w("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1"):"https://".concat(c,"/api/v1?action=config")),n=i.map(c=>function(l,d,u,h){let p=ve(),g={flag:64,cipher_method:0,features:{device:p.name,system:p.os,system_general:navigator.userAgent,vendor:d.appId,version:Ui,cname:d.cname,sid:d.sid,session_id:d.sid,detail:"",proxyServer:d.proxyServer}};return Fn(()=>Bn(l,{data:g,timeout:1e3,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,_=>_.code!==R.OPERATION_ABORTED,h)}(c,e,t,r)),o=null,a=null,s={};try{o=await Bl(n)}catch(c){if(c.code===R.OPERATION_ABORTED)throw c;a=c}if(n.forEach(c=>c.cancel()),Q.reportApiInvoke(e.sid,{name:wt.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{s=function(c){if(!c.test_tags)return{};let l=c.test_tags,d=Object.keys(l),u={};return d.forEach(h=>{var p;let g=Sr(p=h.slice(4)).call(p),_=JSON.parse(l[h])[1];u[g]=_}),u}(o)}catch{}return s}async function TN(e,t){let r=w("WEBCS_DOMAIN").concat(w("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Vu(),serviceIds:[gt.CHOOSE_SERVER,gt.CLOUD_PROXY_FALLBACK]}));try{return await wV({referenceList:r,asyncMapHandler:i=>async function(n,o,a){let s,{url:c,areaCode:l,serviceIds:d}=n,u=Date.now(),[h,p]=MR(o,l,d),g=St.networkState;try{g&&St.networkState===ei.OFFLINE&&St.onlineWaiter&&await K.race([St.onlineWaiter,zt(Rt.maxRetryTimeout)]),g=St.networkState;let{data:_,headers:E}=await Bn(c,{data:h,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=E.http3==="1"?1:-1,(y=>{let I=[];if(y.response_body.forEach(O=>{let b=O.buffer.code;if(O.uri===23&&b===0&&!O.buffer.edges_services)if(O.buffer.flag===4194310)O.buffer.edges_services=[];else{let k={error:new D(R.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:y.detail[502]}),flag:O.buffer.flag};I.push(k)}if(b!==0){let k=Sl(b),P={error:new D(R.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:y.detail[502]}),flag:O.buffer.flag};O.buffer.flag===4194310?f.warning(P.error.toString()):I.push(P)}}),I.length)throw new D(R.CAN_NOT_GET_GATEWAY_SERVER,I.map(O=>"flag: ".concat(O.flag,", message: ").concat(O.error.message)).join(" | "),{retry:!!I.find(O=>O.error.data.retry),csIp:y.detail[502],desc:[...new Set(I.map(O=>{var b;return O==null||(b=O.error)===null||b===void 0||(b=b.data)===null||b===void 0?void 0:b.desc}).filter(O=>!!O))]})})(_);let S=Uu(_,gt.CHOOSE_SERVER),T=Uu(_,gt.CLOUD_PROXY_FALLBACK);return LR(S),{gatewayInfo:yR(S,c),proxyInfo:T,opid:p,requestTime:u,url:c,isHttp3:s,elapse:Date.now()-u}}catch(_){throw _}}(i,e,t),closeFn:i=>i.code===R.OPERATION_ABORTED||i.code===R.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(i){throw i}}async function vN(e,t,r,i){let n=w("PROXY_SERVER_TYPE3"),o=(p,g,_)=>{let E=_||n;return Array.isArray(E)&&(E=g%2==0?n[1]:n[0]),"https://".concat(E,"/ap/?url=").concat(p)},a=null,s=[],c=async()=>{let p=w("WEBCS_DOMAIN").slice(0,w("AJAX_REQUEST_CONCURRENT")).map((E,S)=>{let T;return T=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(E,"/api/v2/transpond/webrtc?v=2"),S,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(E,"/api/v2/transpond/webrtc?v=2"):o("".concat(E,"/api/v2/transpond/webrtc?v=2"),S),{url:T,areaCode:Vu(),serviceIds:[gt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?gt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?gt.CLOUD_PROXY:gt.CLOUD_PROXY_FALLBACK]}}),g=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(E=>E.url)}),_=await Fu({fragementLength:w("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:E=>(f.debug("[".concat(e.clientId,"] Connect to choose_server:"),E.url),gN(E,e,t,r)),allFailedhandler:E=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:E},g),E[0]},promisesCollector:s});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},g),_},l=async()=>{if(await zt(1e3),a!==null)return a;let p=w("WEBCS_DOMAIN_BACKUP_LIST").map((E,S)=>{let T;return T=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(E,"/api/v2/transpond/webrtc?v=2"),S,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(E,"/api/v2/transpond/webrtc?v=2"):o("".concat(E,"/api/v2/transpond/webrtc?v=2"),S),{url:T,areaCode:Vu(),serviceIds:[gt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?gt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?gt.CLOUD_PROXY:gt.CLOUD_PROXY_FALLBACK]}}),g=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(E=>E.url)}),_=await Fu({fragementLength:w("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:E=>(f.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),E.url),gN(E,e,t,r)),allFailedhandler:E=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:E},g),E[0]},promisesCollector:s});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},g),_},d,u,h;try{({gatewayInfo:d,proxyInfo:u,url:h}=await Bl([c(),l()]))}catch(p){throw p[0]}if(s.length&&s.forEach(p=>p.cancel&&typeof p.cancel=="function"&&p.cancel()),!d||!u)throw new D(R.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,e.cloudProxyServer!=="disabled"&&Array.isArray(n)&&h){let p=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Y(n).call(n,p)&&(e.proxyServer=p,f.setProxyServer(p),Q.setProxyServer(p))}return a={gatewayInfo:d,proxyInfo:await Ux(u,d.uid)},a}async function YX(e,t,r){let i=w("UAP_AP").slice(0,w("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),n=i.map(o=>function(a,s,c,l){let d={command:"convergeAllocateEdge",sid:s.sid,appId:s.appId,token:s.token,ts:Date.now(),version:Ui,cname:s.cname,uid:s.uid.toString(),requestId:Wg,seq:Wg};Wg+=1;let u={service_name:"tele_channel",json_body:JSON.stringify(d)};return Fn(async()=>{let h=await Bn(a,{data:u,cancelToken:c,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(h.code!==0){let g=new D(R.UNEXPECTED_RESPONSE,"cross channel ap error, code"+h.code,{retry:!0});throw f.error(g.toString()),g}let p=JSON.parse(h.json_body);if(p.code!==200){let g=new D(R.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(p.code,", reason: ").concat(p.reason));throw f.error(g.toString()),g}if(!p.servers||p.servers.length===0){let g=new D(R.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw f.error(g.toString()),g}return{vid:p.vid,workerToken:p.workerToken,addressList:(w("CHANNEL_MEDIA_RELAY_SERVERS")||p.servers).map(g=>"wss://".concat(g.address.replace(/\./g,"-"),".").concat(w("WORKER_DOMAIN"),":").concat(g.wss))}},void 0,h=>!!(h.code!==R.OPERATION_ABORTED&&h.code!==R.UNEXPECTED_RESPONSE||h.data&&h.data.retry),l)}(o,e,t,r));try{let o=await Bl(n);return n.forEach(a=>a.cancel()),o}catch(o){throw o[0]}}async function $X(e,t,r){let i=null,n=[],o=async a=>{let s=w(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v2/transpond/webrtc?v=2"):"https://".concat(c,"/api/v2/transpond/webrtc?v=2"));return a&&(await zt(1e3),i!==null)?i:await Fu({fragementLength:w("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:c=>(f.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),c),function(l,d,u,h){let[p]=HX(d,[gt.CHOOSE_SERVER]),g=St.networkState;return Fn(async()=>{g&&St.networkState===ei.OFFLINE&&St.onlineWaiter&&await K.race([St.onlineWaiter,zt(h&&h.maxRetryTimeout||Rt.maxRetryTimeout)]),g=St.networkState;let _=await Bn(l,{data:p,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0);return WX(_,l)},()=>!1,_=>_.code!==R.OPERATION_ABORTED&&(_.code===R.UPDATE_TICKET_FAILED?_.data.retry:(f.warning("[".concat(d.clientId,"] update ticket network error, retry"),_),!0)),h)}(c,e,t,r)),allFailedhandler:c=>{throw c[0]},promisesCollector:n})};try{return i=await Bl([o(!1),o(!0)]),n.length&&n.forEach(a=>a.cancel&&typeof a.cancel=="function"&&a.cancel()),i}catch(a){throw a[0]}}function yN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function RN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var qX=class extends tt{get isSuccess(){return!!this.configs}constructor(){super(),v(this,"configs",void 0),v(this,"joinInfo",void 0),v(this,"cancelToken",void 0),v(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),v(this,"interval",void 0),v(this,"mutex",new cr("config-distribute")),v(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),w("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},w("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Q.reportApiInvoke(null,{options:void 0,name:wt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:nt.TRACER}).onSuccess(JSON.stringify(Sa))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void f.debug("[config-distribute] get config distribute interrupted have no joininfo");let e,t=await this.mutex.lock();try{e=await zX(this.joinInfo,this.cancelToken,this.retryConfig),f.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(r){let i=new D(R.NETWORK_RESPONSE_ERROR,r);f.warning("[config-distribute] ".concat(i.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(lv.UPDATE_BITRATE_LIMIT,e):this.emit(lv.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&RN({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;let r=lh(t=Object.keys(e).filter(n=>/^webrtc_ng_global_parameter/.test(n))).call(t);for(let n=0;n<r.length;n++)for(let o=r.length-1;o>n;o--){let a=r[o];if(typeof e[a].__priority=="number"){let s=e[a].__priority,c=r[o-1];if(typeof e[c].__priority=="number"){if(!(s>e[c].__priority))continue;{let l=a;r[o]=r[o-1],r[o-1]=l}}else{let l=a;r[o]=r[o-1],r[o-1]=l}}}let i={};r.forEach(n=>{let o=e[n],a=o.__expires;Object.keys(o).forEach(s=>{s==="__priority"||s==="__expires"||Object.prototype.hasOwnProperty.call(i,s)||(i[s]=RN({value:o[s]},a&&{expires:a}))})});try{(function(a){try{let s=Date.now();Object.keys(a).forEach(c=>{switch(c){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(pt,c)){let{value:l,expires:d}=a[c];if(d&&d<=s)return;Sa[c]=l,pt[c]=l,f.debug("Update global parameters from config distribute",c,l)}}})}catch(s){f.error("Error update config immediately: ".concat(a),s.message)}})(i);let n=JSON.stringify(i),o=window.btoa(n);window.localStorage.setItem("websdk_ng_global_parameter",o),f.debug("Caching global parameters ".concat(n))}catch(n){f.error("Error caching global parameters:",n.message)}}},XX=class extends tt{constructor(){super(...arguments),v(this,"resultStorage",new Map)}setLocalAudioStats(e,t,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(r,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(r,t))}setLocalVideoStats(e,t,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(r,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(r,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(r))}setRemoteAudioStats(e,t){let r=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let r=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(t))}record(e,t,r){if(w("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let i=this.resultStorage.get(e);if(i&&(i.result.push(r),i.result.length>=5)){var n;let o=Y(n=i.result).call(n,!0);i.isPrevNormal&&!o&&this.emit("exception",CN[e],e,t),!i.isPrevNormal&&o&&this.emit("exception",CN[e]+2e3,e+"_RECOVER",t),i.isPrevNormal=o,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,t){return t instanceof kt&&!t.isActive||!!t.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,t){let r=null;t._encoderConfig&&t._encoderConfig.frameRate&&(r=ri(t._encoderConfig.frameRate));let i=e.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,t){return t instanceof kt&&!t.isActive||!!t.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}},CN={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ar=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){let i=r[r.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){let i=r[r.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function UR(e,t){this.v=e,this.k=t}function Ie(e){return new UR(e,0)}var JX=NU,QX=mo;Be({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=QX.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var ZX=mo,eJ=Ml;Be({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=ZX.f(this),r=eJ(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var yv=_t(JX),OV=Ul.f("asyncIterator"),tJ=_t(OV);function Od(e){var t,r;function i(o,a){try{var s=e[o](a),c=s.value,l=c instanceof UR;yv.resolve(l?c.v:c).then(function(d){if(l){var u=o==="return"?"return":"next";if(!c.k||d.done)return i(u,d);d=e[u](d).value}n(s.done?"return":"normal",d)},function(d){i("throw",d)})}catch(d){n("throw",d)}}function n(o,a){switch(o){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?i(t.key,t.arg):r=null}this._invoke=function(o,a){return new yv(function(s,c){var l={key:o,arg:a,resolve:s,reject:c,next:null};r?r=r.next=l:(t=r=l,i(o,a))})},typeof e.return!="function"&&(this.return=void 0)}function kn(e){return function(){return new Od(e.apply(this,arguments))}}Od.prototype[typeof xc=="function"&&tJ||"@@asyncIterator"]=function(){return this},Od.prototype.next=function(e){return this._invoke("next",e)},Od.prototype.throw=function(e){return this._invoke("throw",e)},Od.prototype.return=function(e){return this._invoke("return",e)};var IN=_t(Vn.Object.getOwnPropertySymbols),rJ=Be,iJ=My.indexOf,nJ=j_,Rv=Cu([].indexOf),wN=!!Rv&&1/Rv([1],1,-0)<0;rJ({target:"Array",proto:!0,forced:wN||!nJ("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return wN?Rv(this,e,t)||0:iJ(this,e,t)}});var oJ=mn("Array").indexOf,aJ=Dr,sJ=oJ,Hg=Array.prototype,cJ=function(e){var t=e.indexOf;return e===Hg||aJ(Hg,e)&&t===Hg.indexOf?sJ:t},AN=_t(cJ);function lJ(e,t){if(e==null)return{};var r,i,n=function(a,s){if(a==null)return{};var c,l,d={},u=Nx(a);for(l=0;l<u.length;l++)c=u[l],AN(s).call(s,c)>=0||(d[c]=a[c]);return d}(e,t);if(IN){var o=IN(e);for(i=0;i<o.length;i++)r=o[i],AN(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function on(e){if(Array.isArray(e))return e.map(r=>r);if(!ON(e))return e;let t={};for(let r in e){let i=e[r];ON(i)||Array.isArray(i)?t[r]=on(i):t[r]=i}return t}function ON(e){return!(typeof e!="object"||Array.isArray(e)||!e)}var Kg=class{constructor(e){v(this,"input",[]),v(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},ho={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Bu={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ho,remoteCandidate:ho}},bV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},NV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},DV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},PV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function bN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function NN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var xR=class{constructor(e,t){v(this,"onFirstVideoReceived",void 0),v(this,"onFirstVideoDecoded",void 0),v(this,"onFirstAudioReceived",void 0),v(this,"onFirstVideoDecodedTimeout",void 0),v(this,"onFirstAudioDecoded",void 0),v(this,"onSelectedLocalCandidateChanged",void 0),v(this,"onSelectedRemoteCandidateChanged",void 0),v(this,"videoIsReady",!1),v(this,"videoIsReady2",{}),v(this,"pc",void 0),v(this,"options",void 0),v(this,"intervalTimer",void 0),v(this,"stats",on(Bu)),v(this,"isFirstVideoReceived",{}),v(this,"isFirstVideoDecoded",{}),v(this,"isFirstAudioReceived",{}),v(this,"isFirstAudioDecoded",{}),v(this,"isFirstVideoDecodedTimeout",{}),v(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new K(e=>{e({local:NN({},ho),remote:NN({},ho)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"],i=0,n=0,o=0,a=0;for(let s of r)e[s].forEach((c,l)=>{if(!this.lossRateWindowStats[t-1][s][l]||!this.lossRateWindowStats[0][s][l])return;let d=this.lossRateWindowStats[t-1][s][l].packets-this.lossRateWindowStats[0][s][l].packets,u=this.lossRateWindowStats[t-1][s][l].packetsLost-this.lossRateWindowStats[0][s][l].packetsLost;s==="videoSend"||s==="audioSend"?(i+=d,o+=u):(n+=d,a+=u),Number.isNaN(d)||Number.isNaN(d)?c.packetLostRate=0:c.packetLostRate=d<=0||u<=0?0:u/(d+u)});e.sendPacketLossRate=i<=0||o<=0?0:o/(i+o),e.recvPacketLossRate=n<=0||a<=0?0:a/(n+a)}};function DN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function dJ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var uJ=class extends xR{constructor(){super(...arguments),v(this,"_stats",Bu),v(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=on(Bu);let r=t.filter(n=>n.type==="ssrc");this.processSSRCStats(r);let i=t.find(n=>n.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;let i=Y(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{let n=on(NV);n.codec=t.googCodecName,n.adaptionChangeReason="none",t.googCpuLimitedResolution&&(n.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(n.adaptionChangeReason="bandwidth"),n.avgEncodeMs=Number(t.googAvgEncodeMs),n.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},n.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},n.firsCount=Number(t.googFirReceived),n.nacksCount=Number(t.googNacksReceived),n.plisCount=Number(t.googPlisReceived),n.frameCount=Number(t.framesEncoded),n.bytes=Number(t.bytesSent),n.packets=Number(t.packetsSent),n.packetsLost=Number(t.packetsLost),n.ssrc=Number(t.ssrc),n.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(n),this._stats.rtt=n.rttMs;break}case"video_recv":{let n=on(bV),o=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(n.codec=t.googCodecName,n.targetDelayMs=Number(t.googTargetDelayMs),n.renderDelayMs=Number(t.googRenderDelayMs),n.currentDelayMs=Number(t.googCurrentDelayMs),n.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),n.decodeMs=Number(t.googDecodeMs),n.maxDecodeMs=Number(t.googMaxDecodeMs),n.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},n.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},n.decodeFrameRate=Number(t.googFrameRateDecoded),n.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},n.jitterBufferMs=Number(t.googJitterBufferMs),n.firsCount=Number(t.googFirsSent),n.nacksCount=Number(t.googNacksSent),n.plisCount=Number(t.googPlisSent),n.framesDecodeCount=Number(t.framesDecoded),n.bytes=Number(t.bytesReceived),n.packets=Number(t.packetsReceived),n.packetsLost=Number(t.packetsLost),n.ssrc=Number(t.ssrc),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,n.decodedFrame.width,n.decodedFrame.height),this.isFirstVideoDecoded[n.ssrc]=!0),o){let a=o.stats,s=Date.now()-o.lts;n.framesDecodeFreezeTime=a.framesDecodeFreezeTime,n.framesDecodeInterval=a.framesDecodeInterval,n.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(o.lts=Date.now(),n.framesDecodeInterval=s,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<o.stats.framesDecodeCount&&(n.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:dJ({},n),lts:Date.now()}),this._stats.videoRecv.push(n);break}case"audio_recv":{let n=on(PV);n.codec=t.googCodecName,n.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,n.decodingCNG=Number(t.googDecodingCNG),n.decodingCTN=Number(t.googDecodingCTN),n.decodingCTSG=Number(t.googDecodingCTSG),n.decodingNormal=Number(t.googDecodingNormal),n.decodingPLC=Number(t.googDecodingPLC),n.decodingPLCCNG=Number(t.googDecodingPLCCNG),n.expandRate=Number(t.googExpandRate),n.accelerateRate=Number(t.googAccelerateRate),n.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),n.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),n.speechExpandRate=Number(t.googSpeechExpandRate),n.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),n.jitterBufferMs=Number(t.googJitterBufferMs),n.jitterMs=Number(t.googJitterReceived),n.bytes=Number(t.bytesReceived),n.packets=Number(t.packetsReceived),n.packetsLost=Number(t.packetsLost),n.ssrc=Number(t.ssrc),n.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),n.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.decodingNormal>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),this._stats.audioRecv.push(n);break}case"audio_send":{let n=on(DV);n.codec=t.googCodecName,n.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,n.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),n.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),n.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),n.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),n.bytes=Number(t.bytesSent),n.packets=Number(t.packetsSent),n.packetsLost=Number(t.packetsLost),n.ssrc=Number(t.ssrc),n.rttMs=Number(t.googRtt||0),this._stats.rtt=n.rttMs,this._stats.audioSend.push(n);break}}})}_getStats(){return new K((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(r=>{let i={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(n=>{i[n]=r.stat(n)}),t.push(i)}),t}};function PN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function rs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var kN=class extends xR{constructor(){super(...arguments),v(this,"_stats",Bu),v(this,"report",void 0),v(this,"lastDecodeVideoReceiverStats",new Map),v(this,"lastVideoFramesRecv",new Map),v(this,"lastVideoFramesSent",new Map),v(this,"lastVideoFramesDecode",new Map),v(this,"lastVideoFramesOutput",new Map),v(this,"lastVideoJBDelay",new Map),v(this,"lastAudioJBDelay",new Map),v(this,"mediaBytesSent",new Map),v(this,"mediaBytesRetransmit",new Map),v(this,"mediaBytesTargetEncode",new Map),v(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=on(Bu),this.report.forEach(e=>{switch(e.type){case si.OUTBOUND:case si.INBOUND:{let t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===si.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===si.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case si.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case si.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:rs({},ho),remote:rs({},ho)};return e.forEach(r=>{let i;if(r.type===si.TRANSPORT&&(i=e.get(r.selectedCandidatePairId)),r.type===si.CANDIDATE_PAIR&&r.selected&&(i=r),i){let n=(o,a)=>{o.type=a.type,o.id=a.id,a.address&&(o.address=a.address),a.candidateType&&(o.candidateType=a.candidateType),a.port&&(o.port=a.port),a.priority&&(o.priority=a.priority),a.protocol&&(o.protocol=a.protocol),a.relayProtocol&&(o.relayProtocol=a.relayProtocol)};if(i.localCandidateId){let o=e.get(i.localCandidateId);o&&n(t.local,o)}if(i.remoteCandidateId){let o=e.get(i.remoteCandidateId);o&&n(t.remote,o)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===si.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===si.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===si.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(rs({},t),rs({},this.stats.selectedCandidatePair.localCandidate)),e.type===si.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(rs({},t),rs({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=on(PV),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find(a=>a.ssrc===e.ssrc);t||(t=on(bV),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration;let r=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),n=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let a=t.decodedFrame?t.decodedFrame.width:0,s=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,a,s),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){let a=r.stats,s=o-r.lts;t.framesDecodeFreezeTime=a.framesDecodeFreezeTime,t.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&s>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=s,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<a.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}i&&o-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(n&&o-n.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-n.count)/((o-n.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):n?t.outputFrameRate=n.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:rs({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=on(NV),this._stats.videoSend.push(t));let r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{let i=new Kg(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){let i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{let n=new Kg(10);n.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,n)}}if(e.totalEncodedBytesTarget){let i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{let n=new Kg(10);n.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,n)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){let i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let n=e.framesEncoded-i.lastFrameCount,o=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*o/n}}if(e.framesEncoded&&e.qpSum){let i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let i=this.findRemoteStatsId(e.ssrc,si.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=on(DV),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,si.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;let i=Array.from(Vo(r=this.report).call(r)).find(n=>n.type===t&&n.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){let r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){let r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var i,n,o,a;let s=t?this.report.get(t):void 0,c=(i=s==null?void 0:s.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof c!="number")return;let l=(n=s==null?void 0:s.frameWidth)!==null&&n!==void 0?n:e.frameWidth,d=(o=s==null?void 0:s.frameHeight)!==null&&o!==void 0?o:e.frameHeight,u=(a=s==null?void 0:s.framesPerSecond)!==null&&a!==void 0?a:e.framesPerSecond;if(typeof l=="number"&&typeof d=="number"||(l=0,d=0),u==null){let h=Date.now(),p=this.lastVideoFramesSent.get(r.ssrc);p&&h-p.lts>=800?(u=Math.round((c-p.count)/((h-p.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:h,rate:u})):p?u=p.rate:this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:h,rate:0})}r.sentFrame={width:l,height:d,frameRate:Math.max(0,u)}}processVideoTrackReceiverStats(e,t,r){var i,n,o,a,s;let c=t?this.report.get(t):void 0,l=(i=c==null?void 0:c.framesReceived)!==null&&i!==void 0?i:e.framesReceived,d=(n=c==null?void 0:c.frameWidth)!==null&&n!==void 0?n:e.frameWidth,u=(o=c==null?void 0:c.frameHeight)!==null&&o!==void 0?o:e.frameHeight,h=(a=c==null?void 0:c.jitterBufferDelay)!==null&&a!==void 0?a:e.jitterBufferDelay,p=(s=c==null?void 0:c.jitterBufferEmittedCount)!==null&&s!==void 0?s:e.jitterBufferEmittedCount;if(typeof l=="number"){let g=this.lastVideoFramesRecv.get(r.ssrc),_=Date.now();r.framesReceivedCount=l;let E=0;g&&_-g.lts>=800?(E=Math.round((l-g.count)/((_-g.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:l,lts:_,rate:E})):g?E=g.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:l,lts:_,rate:0}),r.receivedFrame={width:d||0,height:u||0,frameRate:E||0},r.decodedFrame={width:d||0,height:u||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:d||0,height:u||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(h&&p){let g=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},_=g.jitterBufferMs,E=p-g.jitterBufferEmittedCount;E>0&&(_=1e3*(h-g.jitterBufferDelay)/E),r.jitterBufferMs=_,r.currentDelayMs=Math.round(_),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var i,n,o,a;let s=t?this.report.get(t):void 0,c=(i=(n=s==null?void 0:s.echoReturnLoss)!==null&&n!==void 0?n:e.echoReturnLoss)!==null&&i!==void 0?i:0,l=(o=(a=s==null?void 0:s.echoReturnLossEnhancement)!==null&&a!==void 0?a:e.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;r.aecReturnLoss=c,r.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,r){var i,n,o,a,s,c,l;let d=t?this.report.get(t):void 0,u=(i=d==null?void 0:d.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,h=(n=d==null?void 0:d.totalSamplesReceived)!==null&&n!==void 0?n:e.totalSamplesReceived,p=(o=d==null?void 0:d.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,g=(a=d==null?void 0:d.jitterBufferEmittedCount)!==null&&a!==void 0?a:e.jitterBufferEmittedCount,_=(s=d==null?void 0:d.audioLevel)!==null&&s!==void 0?s:e==null?void 0:e.audioLevel,E=(c=d==null?void 0:d.totalSamplesDuration)!==null&&c!==void 0?c:e==null?void 0:e.totalSamplesDuration,S=(l=d==null?void 0:d.concealedSamples)!==null&&l!==void 0?l:e.concealedSamples;if(u&&h&&(r.accelerateRate=u/h),p&&g){let y=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},I=y.jitterBufferMs,O=g-y.jitterBufferEmittedCount;O>0&&(I=1e3*(p-y.jitterBufferDelay)/O),r.jitterBufferMs=Math.round(I),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:g,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=_;let T=1920;E&&h&&(T=h/E/50,r.receivedFrames=Math.round(h/T)),S&&(r.droppedFrames=Math.round(S/T))}processRemoteInboundStats(e,t){let r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(n=>{e+=n.diffMean()}),this.mediaBytesRetransmit.forEach(n=>{t=t===null?n.diffMean():t+n.diffMean()}),this.mediaBytesTargetEncode.forEach(n=>{r=r===null?n.diffMean():r+n.diffMean()});let i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},hJ=class extends xR{updateStats(){return K.resolve()}};function VR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,o=function(){let a=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return a&&a[0]?Number(a[0].split("/")[1]):null}();return o?o<76?new uJ(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):new kN(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):function(a){if(!window.RTCStatsReport)return!1;let s=a.getStats();return!!(s instanceof K||function(c){return!!c&&(typeof c=="object"||typeof c=="function")&&typeof c.then=="function"}(s))}(e)?new kN(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):new hJ(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n})}var LN=class{get localCapabilities(){return Et(this._localCapabilities)}get rtpCapabilities(){return Et(this._rtpCapabilities)}get candidates(){return Et(this._candidates)}get iceParameters(){return Et(this._iceParameters)}get dtlsParameters(){return Et(this._dtlsParameters)}constructor(e){v(this,"sessionDesc",void 0),v(this,"_localCapabilities",void 0),v(this,"_rtpCapabilities",void 0),v(this,"_candidates",void 0),v(this,"_iceParameters",void 0),v(this,"_dtlsParameters",void 0),v(this,"setup",void 0),v(this,"currentMidIndex",void 0),v(this,"cname","o/i14u9pJrxRKAsu"),v(this,"firefoxSsrcMidMap",new Map),e=Et(e);let{remoteIceParameters:t,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:n,localCapabilities:o,direction:a,setup:s,videoCodec:c,audioCodec:l}=e,d;this.setup=s,d=a===wr.RECEIVE_ONLY?Ht.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ht.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=n,this._candidates=i,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=o;let u=a===wr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=a===wr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=a===wr.RECEIVE_ONLY?n.send.videoCodecs:qd(Z.VIDEO,u,h,c),g=a===wr.RECEIVE_ONLY?n.send.audioCodecs:qd(Z.AUDIO,u,h,l);for(let _ of d.mediaDescriptions)_.attributes.iceUfrag=t.iceUfrag,_.attributes.icePwd=t.icePwd,_.attributes.fingerprints=r.fingerprints,_.attributes.candidates=i,_.attributes.setup=this.setup,_.media.mediaType==="application"&&(_.attributes.sctpPort="5000"),_.media.mediaType==="video"&&(_.media.fmts=p.map(E=>E.payloadType.toString(10)),_.attributes.payloads=p,_.attributes.extmaps=u.videoExtensions),_.media.mediaType==="audio"&&(_.media.fmts=g.map(E=>E.payloadType.toString(10)),_.attributes.payloads=g,_.attributes.extmaps=u.audioExtensions,Rl(_));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return Ht.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,i,n){r=r.replace(/ /g,"-");let{ssrcs:o,ssrcGroups:a}=hs(t,this.cname,w("SYNC_GROUP")?r:void 0),s=this.findPreloadMediaDesc(o);if(s){if(ot()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,s.attributes.mid),n&&(n.twcc||n.remb)){let c=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(s,n),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{let c=this.findAvailableMediaIndex(e,o,i),l;return c===-1?(l=this.createOrRecycleSendMedia(e,o,a,"sendonly",i,n),this.updateBundleMids()):(l=Et(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="sendonly",l.attributes.ssrcs=o,l.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(l,n)),ot()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,l.attributes.mid),{needExchangeSDP:!0,mid:l.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){let i=[];return e.forEach(n=>{let o=n._mediaStreamTrack.kind,a=this.findAvailableRecvMediaIndex(o),s,c=!1;a===-1?(c=!0,s=this.createOrRecycleRecvMedia(n,[],"recvonly",t,r),this.updateBundleMids()):(s=Et(this.sessionDesc.mediaDescriptions[a]),s.attributes.direction="recvonly"),i.push({mid:s.attributes.mid,needCreateTransceiver:c})}),i}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:r,address:i,port:n,type:o,relatedAddress:a,relatedPort:s,priority:c}=new RTCIceCandidate(e),l={foundation:t??"",componentId:"1",transport:r??"",priority:c?c+"":"",connectionAddress:i??"",port:n?n+"":"",type:o?o+"":"",relAddr:a??"",relPort:s?s+"":"",extension:{}};this.candidates.some(d=>d.priority===l.priority&&d.connectionAddress===l.connectionAddress&&d.port===l.port)||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,i,n){let o=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,s=qd(o,a,this.localCapabilities.send,o===Z.AUDIO?n:i),c=o===Z.VIDEO?a.videoExtensions:a.audioExtensions,l="".concat(++this.currentMidIndex),d={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e);let u=this.findFirstClosedMedia(o);if(u){let h=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[h]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>Y(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>Y(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{let n=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(ot()){if(n){let o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!o||o!==i.attributes.mid)}return!1}return n&&i.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Et(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,i,n,o){let a=this.rtpCapabilities.send,s=e===Z.VIDEO?a.videoCodecs:a.audioCodecs,c=e===Z.VIDEO?a.videoExtensions:a.audioExtensions;ot()&&(n="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map(u=>u.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:n}};l=this.mungSendMediaDesc(l,o);let d=this.findFirstClosedMedia(e);if(d){let u=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[u]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,r){let i=Et(e);return NR(i),yl(i,t),DR(i,t),SV(i),s_(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,t){let r=Et(e);return s_(r,t,this.localCapabilities.recv),Rl(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(r!==-1){let i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>ot()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},pJ=["sdp"],je;function MN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function ea(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var UN=(je=class vc extends Px{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,i){super(t,r),v(this,"direction",void 0),v(this,"name",void 0),v(this,"store",void 0),v(this,"spec",void 0),v(this,"peerConnection",void 0),v(this,"initialOffer",void 0),v(this,"transport",void 0),v(this,"statsFilter",void 0),v(this,"localCandidateCount",0),v(this,"_isInRestartIce",!1),v(this,"mutex",new cr("P2PConnection-mutex")),v(this,"onLocalCandidate",void 0),v(this,"remoteSDP",void 0),v(this,"pendingCandidates",[]),v(this,"localCapabilities",void 0),v(this,"isReady",!1),v(this,"restartCnt",0),v(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.peerConnection=new RTCPeerConnection(vc.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??wr.SEND_ONLY,this.name=this.direction===wr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=VR(this.peerConnection,w("STATS_UPDATE_INTERVAL"),void 0,ot()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let r=await vV();if(this.localCapabilities=c_(r),t){let{sdp:i}=t,n=lJ(t,pJ),o=function(){let d={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},u=xu(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ln(u,d,"videoExtensions",h,p,g),ln(u,d,"videoCodecs",h,p,g),ln(u,d,"audioExtensions",h,p,g),ln(u,d,"audioCodecs",h,p,g),w("RAISE_H264_BASELINE_PRIORITY")){let _=g.videoCodecs.findIndex(E=>E.rtpMap&&E.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&E.fmtp&&E.fmtp.parameters["profile-level-id"]==="42001f");if(_!==-1){let E=g.videoCodecs.findIndex(S=>S.rtpMap&&S.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(E<_){f.debug("raising H264 baseline profile priority");let S=g.videoCodecs[_];g.videoCodecs.splice(_,1),g.videoCodecs.splice(E,0,S)}E!==-1&&w("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(S=>!(S.rtpMap&&S.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&S.fmtp&&S.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:h,recv:p,sendrecv:g}}({},{},i);this.remoteSDP=new LN({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let a=await this.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let s=ya(a.sdp);await this.peerConnection.setLocalDescription(a);let c=await pN({},{},a.sdp);this.localCapabilities=c_(c);let l=this.peerConnection.getTransceivers()[0];return l!=null&&l.receiver&&l.receiver.transport&&this.tryBindTransportEvents(l.receiver.transport),ea(ea({},s),{},{sdp:a.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=ya(i.sdp);return this.initialOffer=i,ea(ea({},n),{},{sdp:i.sdp})}}catch(r){throw new M(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:r,iceParameters:i,dtlsParameters:n}=t,o=await pN({},{},r);this.remoteSDP=new LN({remoteIceParameters:i,remoteDtlsParameters:n,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let a=this.peerConnection.getTransceivers()[0];a!=null&&a.sender&&a.sender.transport&&this.tryBindTransportEvents(a.sender.transport)}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new M(R.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,i){var n=this;return kn(function*(){let o=yield Ie(n.mutex.lock("From P2PConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let a=[],s=n.remoteSDP.receive(t,r,i);t.forEach((E,S)=>{if(s[S].needCreateTransceiver){let T=n.peerConnection.addTransceiver(E._mediaStreamTrack,{direction:"sendonly"});a.push(T),E._updateRtpTransceiver(T)}else{let T=n.peerConnection.getTransceivers().find(y=>y.mid===s[S].mid);if(!T)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(s[S].mid));a.push(T),E._updateRtpTransceiver(T)}}),ot()&&w("SIMULCAST")===!0&&(yield Ie(n.applySimulcastForFirefox(a,t)));let c=s.map(E=>E.mid),l=yield Ie(n.peerConnection.createOffer()),d=n.mungSendOfferSDP(l.sdp,t,c),u=Ht.parse(d),h=c.map(E=>{let S=u.mediaDescriptions.find(T=>T.attributes.mid===E);if(!S)throw new Error("Cannot extract ssrc from mediaDescription.");return EV(S,w("USE_PUB_RTX"))}),p=a.map((E,S)=>{let T=c[S];return{localSSRC:h[S],id:T}});yield Ie(n.peerConnection.setLocalDescription({type:"offer",sdp:d}));try{yield p}catch(E){let S=n.remoteSDP.toString();throw yield Ie(n.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Ie(n.peerConnection.setRemoteDescription({type:"answer",sdp:S})),yield Ie(n.stopSending(c,!0)),E}yield Ie(n.applySimulcastEncodings(a,t)),yield Ie(n.applySendEncodings(a,t));let g=n.remoteSDP.toString(),_=n.logSDPExchange(d,"offer","local","send");return _==null||_(g),yield Ie(n.setRemoteDescription({type:"answer",sdp:g})),a.map((E,S)=>{let T=c[S];return{localSSRC:h[S],id:T}})}catch(a){throw a instanceof M?a:new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(t,r){let i=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getTransceivers().filter(c=>t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length (".concat(n.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));n.map(c=>{var l;c.direction="inactive",(l=c.stop)===null||l===void 0||l.call(c)});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let s=this.remoteSDP.toString();a==null||a(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}finally{i&&i()}}async receive(t,r,i,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,r,i,n);if(a){let c=this.remoteSDP.toString(),l=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});let d=await this.peerConnection.createAnswer(),u=this.mungReceiveAnswerSDP(d.sdp,o,t);l==null||l(u||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:u}),f.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else f.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let s=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!s||s.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,mid:s.mid,transceiver:s}}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(t,r,i,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,r,i,n);if(a){let s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:s});let l=await this.peerConnection.createAnswer(),d=this.mungReceiveAnswerSDP(l.sdp,o,t);c==null||c(d||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:d}),f.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else f.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});let n=await this.peerConnection.createAnswer();i==null||i(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===ss.Auto&&(this.store.p2pTransport=ss.SdRtn,ye().supportPCSetConfiguration&&this.peerConnection.setConfiguration(vc.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ye().supportPCSetConfiguration&&this.peerConnection.setConfiguration(vc.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:i}=ya(r.sdp);return this.store.descriptionStart(),this.direction===wr.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===wr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:i}=ya(r.sdp);return await this.peerConnection.setLocalDescription(r),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(i.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let o=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),a==null||a(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new M(R.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getTransceivers().filter(n=>n.mid===t);i.length===1&&(this.isVP8Simulcast(r)?ot()||await this.applySimulcastEncodings(i,[r]):await this.applySendEncodings(i,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getTransceivers().find(n=>n.mid===r);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:i,remote:n}=r.getSelectedCandidatePair();return{local:ea(ea({},ho),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:ea(ea({},ho),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;Y(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else f.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n={iceServers:[]};var o;return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(im(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...vc.turnServerConfigToIceServers(t.turnServer.servers,r,i)),w("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...vc.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,i)),Y(o=[ss.Relay,ss.SdRtn]).call(o,r)&&(n.iceTransportPolicy="relay"),w("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(n.iceTransportPolicy="relay")}))),w("ENABLE_ENCODED_TRANSFORM")&&ye().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),f.debug("P2PConnection p2pTransport is ".concat(r)),n}static turnServerConfigToIceServers(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=[],o=t.filter(s=>s.tcpport);f.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(i));let a=o.length>i?o[i]:o[0];switch(r){case ss.SdRtn:let s=t.filter(l=>{var d;return Y(d=l.username).call(d,"glb:")&&l.turnServerURL==l.turnServerURL}),c=s.length>i?s[i]:s[0];c&&(n.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(Gc(c.turnServerURL),":").concat(c.tcpport,"?transport=udp")}),n.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Gc(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;case ss.Relay:a&&(n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Gc(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}));break;default:a&&(n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Gc(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),n.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}return n}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var n;(n=this.onDTLSTransportError)===null||n===void 0||n.call(this,"error"in i?i.error:i)};let r=t.iceTransport;r&&(r.onstatechange=()=>{let i=t==null?void 0:t.iceTransport.state;var n;i&&((n=this.onICETransportStateChange)===null||n===void 0||n.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:i,remote:n}=r.getSelectedCandidatePair();f.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var i;if(r||(r=this.peerConnection.getSenders().find(d=>d.track===t._mediaStreamTrack)),!r)return f.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return f.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ye().supportSetRtpSenderParameters)return f.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let n={},o={};switch(t._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(t._encoderConfig){var a;let{bitrateMax:d,frameRate:u,scaleResolutionDownBy:h}=t._encoderConfig;d&&(o.maxBitrate=1e3*d),Y(a=t._hints).call(a,Ye.LOW_STREAM)&&(u&&(o.maxFramerate=ri(u)),h&&h>=1&&(o.scaleResolutionDownBy=h))}if(w("DSCP_TYPE")&&Ga()){var s;let d=w("DSCP_TYPE");Y(s=["very-low","low","medium","high"]).call(s,d)&&(o.networkPriority=d)}let c=r.getParameters(),l=(i=c.encodings)===null||i===void 0?void 0:i[0];ot()&&!l&&(n.encodings=[o]),l&&Object.assign(l,o),Object.assign(c,n),f.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await r.setParameters(c)}async applySendEncodings(t,r){try{if(!ye().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let n=t[i],o=r[i];o instanceof We&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,n.sender)}}catch{f.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,i){let n=Ht.parse(t);return r.forEach((o,a)=>{let s=i[a],c=n.mediaDescriptions.find(l=>l.attributes.mid===s);c&&(yl(c,o),TV(c,o,this.store.codec))}),Ht.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let c=0;c<t.length;c++){var i,n,o,a,s;let l=t[c],d=r[c];if(d instanceof We&&!Y(i=d._hints).call(i,Ye.LOW_STREAM)&&(n=d._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((o=d._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=d._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((s=d._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1&&this.store.codec==="vp8"){let u={},h={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}];let p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,u))}}}async applySimulcastEncodings(t,r){if(!ot()&&t.length===r.length)for(let i=0;i<t.length;i++){let n=r[i];if(n instanceof We&&this.isVP8Simulcast(n)){let o=t[i],a={},s={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];let c=o.sender.getParameters();await o.sender.setParameters(Object.assign(c,a))}}}isVP8Simulcast(t){var r,i,n,o,a;return!!(t instanceof We&&w("SIMULCAST")&&this.store.codec==="vp8"&&!Y(r=t._hints).call(r,Ye.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((n=t._encoderConfig)===null||n===void 0?void 0:n.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,r,i,n){if(w("SDP_LOGGING"))return f.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(r," SDP during P2PConnection.").concat(n,`
`),t),r==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",n)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(a=>{a.direction="inactive"});let i=await this.peerConnection.createOffer(),n=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async a=>{a.direction="sendonly"});let i=await this.peerConnection.createOffer(),n=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var i,n;if(r=(i=r)!==null&&i!==void 0?i:(n=this.currentRemoteDescription)===null||n===void 0?void 0:n.sdp){var o;let a=(o=Ht.parse(r).mediaDescriptions.find(s=>s.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs;return a==null?void 0:a[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),Y(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,i){let n=Ht.parse(t),o=n.mediaDescriptions.find(a=>a.attributes.mid===r);return o&&i===Z.AUDIO&&o.media.mediaType==="audio"&&Rl(o),Ht.print(n)}},X(je.prototype,"establish",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"establish"),je.prototype),X(je.prototype,"connect",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"connect"),je.prototype),X(je.prototype,"receive",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"receive"),je.prototype),X(je.prototype,"mockReceive",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"mockReceive"),je.prototype),X(je.prototype,"stopReceiving",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"stopReceiving"),je.prototype),X(je.prototype,"restartICE",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"restartICE"),je.prototype),X(je.prototype,"close",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"close"),je.prototype),X(je.prototype,"updateEncoderConfig",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"updateEncoderConfig"),je.prototype),X(je.prototype,"updateSendParameters",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"updateSendParameters"),je.prototype),X(je.prototype,"replaceTrack",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"replaceTrack"),je.prototype),X(je.prototype,"muteLocal",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"muteLocal"),je.prototype),X(je.prototype,"unmuteLocal",[Xi],Object.getOwnPropertyDescriptor(je.prototype,"unmuteLocal"),je.prototype),je);function Xi(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let n=this.mutex,o=await n.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await i.apply(this,s)}finally{o()}},r}function Cv(e,t){let r=document.createElement("video"),i=document.createElement("canvas");r.setAttribute("style","display:none"),i.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),i.width=ri(t.width),i.height=ri(t.height);let n=ri(t.framerate||15);document.body.append(r),document.body.append(i);let o=e._mediaStreamTrack;r.srcObject=new MediaStream([o]),r.play();let a=i.getContext("2d");if(!a)throw new D(R.UNEXPECTED_ERROR,"can not get canvas context");let s=ye(),c=i.captureStream(s.supportRequestFrame?0:n).getVideoTracks()[0];c.canvas||(c.canvas=i),i.startCapture=()=>{if(!r)return i.stopCapture&&i.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){let d=r.videoWidth,u=r.videoHeight/d,h=i.width*u;Math.abs(h-i.height)>=2&&(f.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(h)),i.height=h)}a.drawImage(r,0,0,i.width,i.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,r.srcObject=new MediaStream([o]))},i.stopCapture=AR(()=>i.startCapture&&i.startCapture(),n);let l=c.stop;return c.stop=()=>{l.call(c),r&&(r.remove(),r.srcObject=null,r=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),f.debug("clean low stream renderer")},c}var pf=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(pf||{}),Dt=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(Dt||{}),ls=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(ls||{}),ur=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(ur||{}),ds=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(ds||{}),kV=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(kV||{}),aa=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(aa||{}),Qi=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(Qi||{}),LV=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(LV||{}),Di=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Di||{}),vo=1e3,is=3;function ue(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function xN(e){let t={[Di.CONN_TYPE]:0,[Di.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[Di.CONN_TYPE]=1),r==="tcp"&&(t[Di.CONN_TYPE]=3),r==="tls"&&(t[Di.CONN_TYPE]=4);break}case"srflx":t[Di.CONN_TYPE]=2}return t}function VN(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}var MV=class extends tt{constructor(e){super(),v(this,"store",void 0),v(this,"uploadWRTCStatsTimer",void 0),v(this,"uploadOutboundDenoiserStatsTimer",void 0),v(this,"uploadExtStatsTimer",void 0),v(this,"uploadExtUsageStatsTimer",void 0),v(this,"uploadInboundExtStatsTimer",void 0),v(this,"requestStats",void 0),v(this,"requestTransportStats",void 0),v(this,"requestLocalMedia",void 0),v(this,"requestRemoteMedia",void 0),v(this,"requestAllTracks",void 0),v(this,"requestVideoIsReady",void 0),v(this,"requestUploadStats",void 0),v(this,"requestUpload",void 0),v(this,"uploadOutboundStarted",!1),v(this,"uploadInboundStarted",!1),v(this,"uploadTransportStarted",!1),v(this,"uploadExtensionUsageStarted",!1),v(this,"lastRecvStats",void 0),v(this,"lastSendStats",void 0),v(this,"lastFullRecvStats",void 0),v(this,"lastFullSendStats",void 0),v(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,r;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),t||r){let i={};if(this.uploadTransportStarted&&t){let n=this.getTransportStats(t,r,e);n&&(i.misc=[n])}if(this.uploadOutboundStarted&&t){let n=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);n&&(i.outbound=[n])}if(this.uploadInboundStarted&&r){let n=this.getInboundStats(r,e?this.lastRecvStats:this.lastFullRecvStats,e);n&&(i.inbound=n)}this.requestUploadStats(i)}this.lastRecvStats=r,this.lastSendStats=t,e||(this.lastFullRecvStats=r,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==is),++e===is+1&&(e=1)},vo)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,r){if(!this.requestStats)return;if(r)return e.rtt==null?void 0:{addition:{[Di.RTT]:e.rtt,[Di.CONN_TYPE]:void 0}};let i=xN(e);if(this.store.useP2P){if(t){let n=xN(t);i[Di.CONN_TYPE]+=n[Di.CONN_TYPE]<<3}i[Di.CONN_TYPE]+=110}else i[Di.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,t,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;let i=this.requestLocalMedia();if(!i||i.length===0)return;let n,o,a;return i.forEach(s=>{let[c,{track:l,ssrcs:d}]=s;switch(c){case V.LocalVideoLowTrack:case V.LocalVideoTrack:if(c===V.LocalVideoTrack){let u=function(g,_,E,S,T){let y=_.videoSend.find(j=>j.ssrc===g);if(!y)return;let I={},{sentFrame:O,inputFrame:b}=y;if(b&&O){let j=b.frameRate,G=O.frameRate;I[Dt.FREEZE]=function(ce,pe){let Ae=!0;return Ae=!(ce<=5)&&(ce<=10?pe<3:ce<=20?pe<4:pe<5),Ae}(j,G)?1:0}if(ue(I,Dt.QP_SUM,y.qpSumPerFrame),T)return I;switch(O&&(ue(I,Dt.HEIGHT,O.height),ue(I,Dt.WIDTH,O.width),ue(I,Dt.FRAME_RATE,O.frameRate)),I[Dt.DISABLED]=S._originMediaStreamTrack&&!S._originMediaStreamTrack.enabled||S._mediaStreamTrack&&!S._mediaStreamTrack.enabled?1:0,y.adaptionChangeReason){case"none":I[Dt.ADAPTATION]=0;break;case"cpu":I[Dt.ADAPTATION]=1;break;case"bandwidth":I[Dt.ADAPTATION]=2;break;case"other":I[Dt.ADAPTATION]=3}let k=0;y.adaptionChangeReason&&(k+=VN(y.adaptionChangeReason)),_.qualityLimitationReason&&(k+=VN(_.qualityLimitationReason)<<3),I[Dt.ADAPTATION]=k,I[Dt.PLAYER_STATUS]=Mg[S._player?S._player.videoElementStatus:"uninit"],ue(I,Dt.NACKS,y.nacksCount),ue(I,Dt.PLIS,y.plisCount),ue(I,Dt.FIRS,y.firsCount),ue(I,Dt.AVG_ENCODE,y.avgEncodeMs);let P=E&&E.videoSend.find(j=>j.ssrc===g);if(P){let j=T?vo:vo*is;P.timestamp&&y.timestamp&&(j=y.timestamp-P.timestamp),P.packets!=null&&y.packets!=null&&ue(I,Dt.PACKAGE_RATE,1e3*(y.packets-P.packets)/j),y.packetsLost!=null&&P.packetsLost!=null&&ue(I,Dt.PACKAGE_LOST,y.packetsLost-P.packetsLost),P.bytes!=null&&y.bytes!=null&&ue(I,Dt.BITRATE,8*(y.bytes-P.bytes)/j)}return I}(d[0].ssrcId,e,t,l,r),h=r?null:function(g,_,E){let S=_.videoSend.find(k=>k.ssrc===g);if(!S)return null;let T={},y=S.inputFrame,I=y&&y.height||E&&E.videoHeight||0,O=y&&y.width||E&&E.videoWidth||0,b=y&&y.frameRate||0;return ue(T,pf.HEIGHT,I),ue(T,pf.WIDTH,O),ue(T,pf.FRAME_RATE,b),T}(d[0].ssrcId,e,l),p=r?null:function(g){let _={};return ue(_,Dt.RETRANSMIT,g.bitrate.retransmit),ue(_,Dt.TARGET_ENCODED,g.bitrate.targetEncoded),ue(_,Dt.ACTUAL_ENCODED,g.bitrate.actualEncoded),ue(_,Dt.TRANSMIT,g.bitrate.transmit),ue(_,Dt.BANDWIDTH,g.sendBandwidth),_}(e);o=Object.assign({},u,h,p)}else a=r?void 0:function(u,h,p){let g=h.videoSend.find(S=>S.ssrc===u);if(!g)return;let _={},E=g.sentFrame;if(E&&(ue(_,ls.HEIGHT,E.height),ue(_,ls.WIDTH,E.width),ue(_,ls.FRAME_RATE,E.frameRate)),p){let S=p.videoSend.find(T=>T.ssrc===u);if(S){let T=vo*is;S.timestamp&&g.timestamp&&(T=g.timestamp-S.timestamp),S.packets!=null&&g.packets!=null&&ue(_,ls.PACKAGE_RATE,1e3*(g.packets-S.packets)/T),g.packetsLost!=null&&S.packetsLost!=null&&ue(_,ls.PACKAGE_LOST,g.packetsLost-S.packetsLost),S.bytes!=null&&g.bytes!=null&&ue(_,ls.BITRATE,8*(g.bytes-S.bytes)/T)}}return _}(d[0].ssrcId,e,t);break;case V.LocalAudioTrack:n=r?void 0:function(u,h,p,g){let _=h.audioSend.find(I=>I.ssrc===u);if(!_)return;let E={};E[aa.DISABLED]=g._originMediaStreamTrack&&!g._originMediaStreamTrack.enabled||g._mediaStreamTrack&&!g._mediaStreamTrack.enabled?1:0;let S=100*g._source.getAccurateVolumeLevel(),T=_.inputLevel;if(T!=null){let I=Math.ceil(50*Math.log10(100*T+1));ue(E,aa.LEVEL,I)}ue(E,kV.PCM_LEVEL,S),ue(E,aa.AEC_RETURN_LOSS,_.aecReturnLoss),ue(E,aa.AEC_RETURN_LOSS_ENH,_.aecReturnLossEnhancement),E[aa.FREEZE]=0;let y=p&&p.audioSend.find(I=>I.ssrc===u);if(y){let I=vo*is;y.timestamp&&_.timestamp&&(I=_.timestamp-y.timestamp),y.bytes!=null&&_.bytes!=null&&ue(E,aa.BITRATE,8*(_.bytes-y.bytes)/I),y.packets!=null&&_.packets!=null&&ue(E,aa.PACKAGE_RATE,1e3*(_.packets-y.packets)/I)}return E}(d[0].ssrcId,e,t,l)}}),{high:o,low:a,audio:n}}getInboundStats(e,t,r){if(!this.requestRemoteMedia)return;let i=this.requestRemoteMedia()||[],n=[];return i.forEach(o=>{let[a,s]=o,c={peer:a.uid};if(s.has(Z.VIDEO)&&a.videoTrack){let l=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,d=a.videoTrack?function(u,h,p,g,_,E,S){var T;let y=h.videoRecv.find(G=>G.ssrc===u);if(!y)return;let I={},{receivedFrame:O,outputFrame:b,decodeFrameRate:k}=y,P=p&&p.videoRecv.find(G=>G.ssrc===u);if(I[ur.FREEZE]=_&&UV.isRemoteVideoFreeze(g,y,P)?1:0,ue(I,ds.FRAME_RATE_DECODE,k),ue(I,ur.QP_SUM,y.qpSumPerFrame),y.framesRateFirefox&&ue(I,ur.FRAME_RATE,y.framesRateFirefox),O&&ue(I,ur.FRAME_RATE,O.frameRate),P){let G=h.timestamp-p.timestamp||(S?vo:is*vo);y.packetsLost!=null&&P.packetsLost!=null&&ue(I,ur.PACKAGE_LOST,y.packetsLost-P.packetsLost),P.bytes!=null&&y.bytes!=null&&ue(I,ur.BITRATE,8*(y.bytes-P.bytes)/G),P.packets!=null&&y.packets!=null&&ue(I,ur.PACKAGE_RATE,1e3*(y.packets-P.packets)/G)}if(S)return I;O?(ue(I,ur.HEIGHT,O.height),ue(I,ur.WIDTH,O.width)):g&&(ue(I,ur.HEIGHT,g._videoHeight||0),ue(I,ur.WIDTH,g._videoWidth||0)),b&&ue(I,ds.FRAME_RATE_OUTPUT,b.frameRate);let j=(T=g._player)===null||T===void 0?void 0:T.rendFrameRate.toFixed(0);if(j&&ue(I,ds.FRAME_RATE_RENDER,+j),ue(I,ur.JITTER_BUFFER,y.jitterBufferMs),ue(I,ur.CURRENT_DELAY,y.currentDelayMs),ue(I,ur.FIRS,y.firsCount),ue(I,ur.NACKS,y.nacksCount),ue(I,ur.PLIS,y.plisCount),g){I[ur.DISABLED]=g._originMediaStreamTrack.enabled&&g._mediaStreamTrack.enabled?0:1;let G=g._player;if(G){let{freezeTimeCounterList:ce,renderFreezeAccTime:pe,videoElementStatus:Ae}=G;if(ce&&ce.length>0&&ue(I,ds.FREEZE_TIME,ce.splice(0,1)[0]),E&&Io.visibility==="visible"&&Ae===Er.PLAYING&&ye().supportRequestVideoFrameCallback){let Ge=Math.min(6e3,pe);G.renderFreezeAccTime=Math.max(0,pe-Ge),ue(I,ds.FREEZE_TIME_RENDER,Ge)}if(typeof y.totalFreezesDuration=="number"){let Ge=P&&P.totalFreezesDuration?y.totalFreezesDuration-P.totalFreezesDuration:y.totalFreezesDuration;ue(I,ds.FREEZE_DURATION,1e3*Ge)}}}if(I[ur.PLAYER_STATUS]=Mg[g._player?g._player.videoElementStatus:"uninit"],P&&y.totalInterFrameDelay!==void 0&&y.totalSquaredInterFrameDelay!==void 0&&P.totalInterFrameDelay!==void 0&&P.totalSquaredInterFrameDelay!==void 0){let G=y.totalInterFrameDelay-P.totalInterFrameDelay,ce=y.totalSquaredInterFrameDelay-P.totalSquaredInterFrameDelay,pe=y.framesDecodeCount-P.framesDecodeCount,Ae=G/pe*1e3,Ge=Math.round(1e3*Math.sqrt((ce-Math.pow(G,2)/pe)/pe));!isNaN(Ge)&&Ae+Ge>Math.max(3*Ae,Ae+150)&&(I[ur.I_FRAME_DELAY]=Ge)}return I}(a._videoSSRC,e,t,a.videoTrack,l===!0,this.needUploadRenderFreezeTime,r):void 0;d&&(c.video=d)}if(s.has(Z.AUDIO)&&a.audioTrack){let l=a.audioTrack?function(d,u,h,p,g){let _=u.audioRecv.find(P=>P.ssrc===d);if(!_)return;let E={},S=h&&h.audioRecv.find(P=>P.ssrc===d),{receivedFrames:T,droppedFrames:y}=_;var I,O;if(ue(E,Qi.JITTER,_.jitterMs),T!=null&&y!=null&&(E[Qi.FREEZE]=(O=y,(I=T)===0||100*O/I>20?1:0)),S){let P=u.timestamp-h.timestamp||(g?vo:vo*is);_.packets!=null&&S.packets!=null&&ue(E,Qi.PACKAGE_RATE,1e3*(_.packets-S.packets)/P),S.bytes!=null&&_.bytes!=null&&ue(E,Qi.BITRATE,8*(_.bytes-S.bytes)/P),_.packetsLost!=null&&S.packetsLost!=null&&ue(E,Qi.PACKAGE_LOST,_.packetsLost-S.packetsLost)}if(g)return E;let b=100*p._source.getAccurateVolumeLevel(),k=_.outputLevel;if(k!=null){let P=Math.ceil(50*Math.log10(100*k+1));ue(E,LV.LEVEL,P)}if(ue(E,Qi.PCM_LEVEL,b),p&&(E[Qi.DISABLED]=p._originMediaStreamTrack.enabled&&p._mediaStreamTrack.enabled?0:1),ue(E,Qi.JITTER_BUFFER,_.jitterBufferMs),ue(E,Qi.CURRENT_DELAY,_.jitterBufferMs),E[Qi.PLAYER_STATUS]=Mg[Mr.getPlayerState(p.getTrackId())],S){let P=_.concealedSamples-S.concealedSamples;P>0&&ue(E,Qi.CONCEALED_SAMPLES,P)}return E}(a._audioSSRC,e,t,a.audioTrack,r):void 0;l&&(c.audio=l)}(c.video||c.audio)&&n.push(c)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,n}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find(t=>t instanceof o_);if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(ku.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(t=>{this.requestUpload&&this.requestUpload(t.type,t.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[t,r]=e;r.has(Z.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(Z.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let t=Date.now(),r={connectionInterval:w("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t},i=[],n=this.requestAllTracks&&this.requestAllTracks()||[];for(let c of n)!c.muted&&c.enabled&&(i=i.concat(await c.getProcessorUsage()));let o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[c,l]of o)l.has(Z.VIDEO)&&c.videoTrack&&(i=i.concat(await c.videoTrack.getProcessorUsage())),l.has(Z.AUDIO)&&c.audioTrack&&(i=i.concat(await c.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(c,l){let d={};for(let{id:g,value:_,level:E,direction:S}of c){var u;let T=(u=l.get(g))!==null&&u!==void 0?u:0,y=_===2?T+w("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:T;var h,p;l.set(g,y),d[g]?(_===2&&(d[g].value=_),E>d[g].level&&(d[g].level=E),S==="remote"&&(d[g].remoteUidCount+=1),d[g].totalTs=(h=l.get(g))!==null&&h!==void 0?h:0):d[g]={value:_,level:E,remoteUidCount:S==="local"?0:1,totalTs:(p=l.get(g))!==null&&p!==void 0?p:0}}return Object.keys(d).map(g=>{let{level:_,value:E,totalTs:S}=d[g];return{id:g,level:_,value:E,totalTs:S}})}(i,e);let a=Date.now(),s=a>t?a:t+1;this.requestUpload&&this.requestUpload(ku.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:s})},w("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}},pa=class{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){v(this,"uid",void 0),v(this,"_uintid",void 0),v(this,"_trust_in_room_",!0),v(this,"_trust_audio_enabled_state_",!0),v(this,"_trust_video_enabled_state_",!0),v(this,"_trust_audio_mute_state_",!0),v(this,"_trust_video_mute_state_",!0),v(this,"_audio_muted_",!1),v(this,"_video_muted_",!1),v(this,"_audio_enabled_",!0),v(this,"_video_enabled_",!0),v(this,"_audio_added_",!1),v(this,"_video_added_",!1),v(this,"_is_pre_created",!1),v(this,"_video_pre_subscribed",!1),v(this,"_audio_pre_subscribed",!1),v(this,"_trust_video_stream_added_state_",!0),v(this,"_trust_audio_stream_added_state_",!0),v(this,"_audioTrack",void 0),v(this,"_videoTrack",void 0),v(this,"_dataChannels",[]),v(this,"_audioSSRC",void 0),v(this,"_videoSSRC",void 0),v(this,"_audioOrtc",void 0),v(this,"_videoOrtc",void 0),v(this,"_cname",void 0),v(this,"_rtxSsrcId",void 0),v(this,"_videoMid",void 0),v(this,"_audioMid",void 0),this.uid=e,this._uintid=t}},wn=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function fJ(e,t){var r;let i;switch(t){case V.LocalAudioTrack:i=be.Audio;break;case V.LocalVideoTrack:i=Y(r=e._hints).call(r,Ye.SCREEN_TRACK)?be.Screen:be.High;break;case V.LocalVideoLowTrack:i=be.Low}return i}function Iv(e){let t=ye();if(e.some(r=>r._bypassWebAudio))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function zg(e,t){Iv(e);let r=new kt;return e.forEach(i=>r.addAudioTrack(i)),r}var FN,BN,jN,GN,WN,HN,KN,zN,YN,$N,qN,$e;function XN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Sp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Jr=(FN=yn(wn.SEND_ONLY),BN=yn(wn.SEND_ONLY),jN=yn(),GN=yn(wn.RECEIVE_ONLY),WN=yn(wn.RECEIVE_ONLY),HN=yn(wn.RECEIVE_ONLY),KN=yn(wn.RECEIVE_ONLY),zN=yn(wn.RECEIVE_ONLY),YN=yn(wn.RECEIVE_ONLY),$N=yn(),qN=yn(wn.RECEIVE_ONLY),$e=class extends tt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(ie.StateChange,t,this._state)}constructor(e,t){super(),v(this,"isPlanB",!1),v(this,"store",void 0),v(this,"statsUploader",void 0),v(this,"sendConnection",void 0),v(this,"recvConnection",void 0),v(this,"localTrackMap",new Map),v(this,"remoteUserMap",new Map),v(this,"localDataChannels",[]),v(this,"pendingLocalTracks",[]),v(this,"pendingRemoteTracks",[]),v(this,"statsCollector",void 0),v(this,"dtlsFailedCount",0),v(this,"sendMutex",new cr("P2PChannel2-send-mutex")),v(this,"recvMutex",new cr("P2PChannel2-recv-mutex")),v(this,"_state",Oe.Disconnected),v(this,"_restartStates",["disconnected","failed"]),v(this,"reconnectInterval",void 0),v(this,"uploadUnplinkStarted",!1),v(this,"uploadDownlinkStarted",!1),v(this,"uplinkStateUploadInterval",void 0),v(this,"downlinkStatsUploadInterval",void 0),v(this,"handleMuteLocalTrack",async(r,i,n)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Oe.Connected)return void n(new M(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let c=this.filterTobeMutedTracks(r);if(c.length===0)return void i();let l=c.find(p=>p[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(c.map(p=>{let[,{id:g}]=p;return g}));let d=!1;var a,s;r.trackMediaType==="video"?d=!((a=this.localTrackMap.get(V.LocalAudioTrack))===null||a===void 0||!a.track._muted):d=((s=this.localTrackMap.get(V.LocalVideoTrack))===null||s===void 0?void 0:s.id)===void 0;let u=this.createMuteMessage(c);await xe(this,ie.RequestMuteLocal,u);let h=r.trackMediaType==="video"?Ta.MUTE_LOCAL_VIDEO:Ta.MUTE_LOCAL_AUDIO;await xe(this,ie.RequestP2PMuteLocal,{action:h,message:u,isMuteAll:d}),i()}catch(c){n(c)}finally{o()}}),v(this,"handleUnmuteLocalTrack",async(r,i,n)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Oe.Connected)return void n(new M(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let a=this.filterTobeUnmutedTracks(r);if(a.length===0)return void i();await this.sendConnection.unmuteLocal(a.map(l=>{let[,{id:d}]=l;return d}));let s=this.createUnmuteMessage(a),c=r.trackMediaType==="video"?Ta.UNMUTE_LOCAL_VIDEO:Ta.UNMUTE_LOCAL_AUDIO;await xe(this,ie.RequestP2PMuteLocal,{action:c,message:s}),i()}catch(a){n(a)}finally{o()}}),v(this,"handleUpdateVideoEncoder",async(r,i,n)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let a=this.localTrackMap.get(V.LocalVideoTrack);if(!this.sendConnection||!a||a.track!==r||this.state!==Oe.Connected)return void i();let{id:s,track:c}=a;s&&(await this.sendConnection.updateSendParameters(s,c),await this.sendConnection.updateEncoderConfig(s,c),this.emit(ie.UpdateVideoEncoder,c)),i()}catch(a){n(a)}finally{o()}}),v(this,"handleUpdateVideoSendParameters",async(r,i,n)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let a=this.localTrackMap.get(V.LocalVideoTrack);if(!this.sendConnection||!a||a.track!==r||this.state!==Oe.Connected)return void i();let{id:s,track:c}=a;s&&await this.sendConnection.updateSendParameters(s,c),i()}catch(a){n(a)}finally{o()}}),v(this,"handleReplaceTrack",async(r,i,n,o)=>{let a;f.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof o=="boolean"&&o||(a=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var s;let l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:u}]=d;return r===u});if(!this.sendConnection||!l||l[1].id===void 0||this.state!==Oe.Connected)return void i();if(await((s=this.sendConnection)===null||s===void 0?void 0:s.replaceTrack(r,l[1].id)),l[0]===V.LocalVideoTrack&&ye().supportDualStreamEncoding){let d=this.localTrackMap.get(V.LocalVideoLowTrack);if(d){let u=r._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=u,d.track._originMediaStreamTrack=u,await new K((h,p)=>{this.handleReplaceTrack(d.track,h,p,!0)})}}i()}catch(l){n(l)}finally{var c;(c=a)===null||c===void 0||c()}}),v(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),v(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),v(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),v(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new MV(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},w("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new M(R.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new M(R.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(f.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new UN(e,this.store,wr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Oe.New,this.sendConnection&&(f.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new UN(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Oe.Connected}async addRemoteCandidate(e,t){if(t===wr.RECEIVE_ONLY){if(!this.sendConnection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var i=this;return kn(function*(){let n=yield Ie(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Oe.Connected){i.throwIfTrackTypeNotMatch(e);let l=e.filter(d=>i.pendingLocalTracks.indexOf(d)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(l))}i.store.pubId=i.store.pubId+1,ar.markPublishStart(i.store.clientId,i.store.pubId);let o=i.filterTobePublishedTracks(e,t,r);if(o.length===0)return void(yield Ie(i.tryToUnmuteAudio(e)));o.forEach(l=>{let{track:d,type:u}=l,h=Date.now();i.store.publish(d.getTrackId(),u===V.LocalAudioTrack?"audio":"video",h)}),i.bindLocalTrackEvents(o);let a=yield Ie(i.sendConnection.send(o.map(l=>{let{track:d}=l;return d}),i.store.codec,i.store.audioCodec)),s=(yield Ie(a.next())).value,c=i.createGatewayPublishMessage(o,s);try{yield c}catch(l){throw a.throw(l),(l==null?void 0:l.code)===R.WS_ABORT&&o.forEach(d=>{let{track:u}=d;i.pendingLocalTracks.indexOf(u)===-1&&i.pendingLocalTracks.push(u)}),i.unbindLocalTrackEvents(o),l}yield Ie(a.next()),o.forEach(l=>{let{type:d}=l;i.statsCollector.addLocalStats(d)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(o,s),o.forEach(l=>{let{track:d,type:u}=l,h=Date.now();i.store.publish(d.getTrackId(),u===V.LocalAudioTrack?"audio":"video",void 0,h)}),i.startUploadUplinkState()}finally{n()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Oe.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(n=>!Y(e).call(e,n)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(n=>n[0]==="videoLowTrack");r&&r[1].track.close();let i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(n=>{let[,{id:o}]=n;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(n=>{let[o,{track:a}]=n;return{type:o,track:a}})),t.forEach(n=>{let[o]=n;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Oe.Connected)return r&&r[1].track.close(),i;e.forEach(n=>{let o=this.pendingLocalTracks.indexOf(n);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[n,{track:o,ssrcs:a}]=i,s={stream_type:fJ(o,n),ssrcs:a};o._muted||!o._enabled?t.push(s):r.push(s)}),t.length>0&&t.forEach(i=>{xe(this,ie.RequestMuteLocal,[i])}),r.length>0&&r.forEach(i=>{xe(this,ie.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return kn(function*(){throw new M(R.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(f.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await tr(this,ie.RequestRePublish,this.pendingLocalTracks),this.emit(ie.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new M(R.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,i){var n;if(!this.recvConnection)throw new M(R.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((n=this.remoteUserMap.get(e))!==null&&n!==void 0&&n.has(t))return;let{track:o,mid:a,transceiver:s}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),i);t===Z.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new il(o,e.uid,e._uintid,this.store),f.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),s&&e._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new rl(o,e.uid,e._uintid,this.store),f.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),s&&e._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._videoTrack));let c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let l=this.pendingRemoteTracks.findIndex(d=>{let{user:u,kind:h}=d;return u.uid===e.uid&&t===h});l!==-1&&(this.pendingRemoteTracks.splice(l,1),this.emit(ie.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,i){if(!this.recvConnection)throw new M(R.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),i)}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(o=>{let{user:a,kind:s}=o;return t!==void 0?a.uid===e.uid&&t===s:a.uid===e.uid});if(i.forEach(o=>{let a=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(a,1)}),this.recvConnection||r||i.forEach(o=>{let{kind:a}=o;var s;if(a===Z.AUDIO)(s=e._audioTrack)===null||s===void 0||s._destroy(),e._audioTrack=void 0;else if(a===Z.VIDEO){var c;(c=e._videoTrack)===null||c===void 0||c._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let n=this.filterTobeUnSubscribedTracks(e,t);n.length!==0&&(await this.recvConnection.stopReceiving(n.map(o=>{let[,{id:a}]=o;return a})),this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),n.forEach(o=>{let[a,{kind:s}]=o;var c,l;if(s===Z.VIDEO&&a._videoSSRC&&((c=this.recvConnection)===null||c===void 0||c.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),s===Z.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),r||((l=a._videoTrack)===null||l===void 0||l._destroy(),a._videoTrack=void 0);else if(s===Z.AUDIO){var d;this.unbindRemoteTrackEvents(a._audioTrack),!r&&((d=a._audioTrack)===null||d===void 0||d._destroy(),a._audioTrack=void 0)}}),n.forEach(o=>{let[,{kind:a}]=o;xe(this,ie.RequestP2PMuteRemote,a)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[Z.VIDEO,Z.AUDIO].forEach(i=>{r.has(i)?xe(this,ie.RequestP2PUnmuteRemote,i):xe(this,ie.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new M(R.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new M(R.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new M(R.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new M(R.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void f.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void f.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===Z.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void f.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||f.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(V.LocalAudioTrack);if((t==null?void 0:t.track)instanceof kt){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[n]=i;return n!==V.LocalAudioTrack}).filter(i=>{let[n]=i;return!(e&&n===V.LocalVideoLowTrack)}).map(i=>{let[,{track:n}]=i;return n}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return!(e&&i===V.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i})}reportPublishEvent(e,t,r,i,n){if(e){let a=this.localTrackMap.get(V.LocalAudioTrack),s=i?this.localTrackMap.get(V.LocalVideoLowTrack):this.localTrackMap.get(V.LocalVideoTrack);Q.publish(this.store.sessionId,{eventElapse:ar.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:s==null?void 0:s.track.getTrackLabel(),screenshare:(s==null?void 0:s.track._hints.indexOf(Ye.SCREEN_TRACK))!==-1,audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var o;r||(r=[]);let a=r.find(c=>c instanceof it),s=i?(o=this.localTrackMap.get(V.LocalVideoTrack))===null||o===void 0?void 0:o.track:r.find(c=>c instanceof We);Q.publish(this.store.sessionId,{eventElapse:ar.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:s==null?void 0:s.getTrackLabel(),screenshare:(s==null?void 0:s._hints.indexOf(Ye.SCREEN_TRACK))!==-1,audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,r,i){let n=i===Z.VIDEO?r._videoSSRC:r._audioSSRC;n&&Q.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Z.VIDEO,audio:i===Z.AUDIO,peerid:r.uid,subscribeRequestid:i===Z.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:ar.measureFromSubscribeStart(this.store.clientId,n)})}reset(){f.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new cr("P2PChannel2-send-mutex"),this.sendMutex=new cr("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(V.LocalAudioTrack);if((e==null?void 0:e.track)instanceof kt){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Oe.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(V.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(V.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof We||t&&t.track instanceof it?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(ui(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[i]=r;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(V.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=lh(e).call(e,(r,i)=>r.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(f.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Oe.Reconnecting,w("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:i}]=e;switch(r){case V.LocalVideoTrack:Y(t=i._hints).call(t,Ye.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case V.LocalAudioTrack:i instanceof kt?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case V.LocalVideoLowTrack:}}),this.emit(ie.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ui(r).call(r)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(ie.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),f.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:n}=r;if((e instanceof pa?e.uid:e)===i.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,i;if(e===wr.SEND_ONLY){if(!this.sendConnection)throw new M(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new M(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){let n=await i.restartICE(t);return i.isInRestartIce=!1,n}{let n=await i.restartICE();if(n){let o=await tr(this,ie.RequestP2PRestartICE,{direction:wr.RECEIVE_ONLY,iceParameter:n});await i.restartICE(o),i.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(V.LocalVideoTrack),r=this.localTrackMap.get(V.LocalAudioTrack),i=e.videoSend.find(p=>{var g;return p.ssrc===(t==null||(g=t.ssrcs)===null||g===void 0?void 0:g[0].ssrcId)}),n=e.audioSend.find(p=>{var g;return p.ssrc===(r==null||(g=r.ssrcs)===null||g===void 0?void 0:g[0].ssrcId)});if(!i||!n)return 1;let o=Mi(this,ie.NeedSignalRTT),a=i?i.rttMs:void 0,s=n?n.rttMs:void 0,c=a&&s?(a+s)/2:a||s,l=(c&&o?(c+o)/2:c||o)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=t==null?void 0:t.track;if(h&&h._encoderConfig&&h._hints.indexOf(Ye.SCREEN_TRACK)===-1){let p=h._encoderConfig.bitrateMax,g=e.bitrate.actualEncoded;if(p&&g){let _=(1e3*p-g)/(1e3*p);return bx[_<.15?0:_<.3?1:_<.45?2:_<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,n=i._audioSSRC,o=i._videoSSRC,a=e.audioRecv.find(g=>g.ssrc===n),s=e.videoRecv.find(g=>g.ssrc===o);if(!a&&!s)return void(t+=1);let c=Mi(this,ie.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new K((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){let i=[],n=ye(),o=this.getAllTracks();e=Bc(e=e.filter(c=>o.indexOf(c)===-1));let a=!1,s=!1;for(let c of e){if(c instanceof We&&(this.localTrackMap.has(V.LocalVideoTrack)||a?new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:c,type:V.LocalVideoTrack}),a=!0),t)){let l=this.getLowVideoTrack(c,r);i.push({track:l,type:V.LocalVideoLowTrack})}if(c instanceof it){let l=this.localTrackMap.get(V.LocalAudioTrack);if(l){if(!(l.track instanceof kt))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(s){let d=i.find(u=>{let{type:h}=u;return h===V.LocalAudioTrack});if(!(d.track instanceof kt))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");d.track.addAudioTrack(c)}else{if(!n.webAudioMediaStreamDest||c instanceof kt||c._bypassWebAudio)i.push({track:c,type:V.LocalAudioTrack});else{let d=new kt;d.addAudioTrack(c),i.push({track:d,type:V.LocalAudioTrack})}s=!0}}}return i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=Bc(e=e.filter(i=>r.indexOf(i)!==-1));for(let i of e){if(i instanceof it){let n=this.localTrackMap.get(V.LocalAudioTrack);if(!n)continue;n.track instanceof kt?(n.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),n.track.trackList.length===0&&(t.push([V.LocalAudioTrack,n]),n.track.close())):t.push([V.LocalAudioTrack,n])}if(i instanceof We){let n=this.localTrackMap.get(V.LocalVideoTrack);if(!n)continue;t.push([V.LocalVideoTrack,n]);let o=this.localTrackMap.get(V.LocalVideoLowTrack);o&&t.push([V.LocalVideoLowTrack,o])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:i}=t;switch(i){case V.LocalVideoTrack:r.addListener($.GET_STATS,this.handleGetLocalVideoStats),r.addListener($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener($.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener($.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener($.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case V.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case V.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof kt?e.trackList.forEach(r=>{r.addListener($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener($.GET_STATS,this.handleGetLocalAudioStats),r.addListener($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener($.GET_STATS,this.handleGetLocalAudioStats),e.addListener($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener($.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:i}]=t;return{track:i,type:r}})),e.forEach(t=>{let{track:r,type:i}=t;switch(i){case V.LocalVideoTrack:r.off($.GET_STATS,this.handleGetLocalVideoStats),r.off($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off($.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off($.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off($.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case V.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case V.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof kt?e.trackList.forEach(t=>{t.off($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off($.GET_STATS,this.handleGetLocalAudioStats),t.off($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off($.GET_STATS,this.handleGetLocalAudioStats),e.off($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off($.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof rl&&t.addListener($.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof il&&t.addListener($.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners($.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Z.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Z.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,i)=>{var n;let o,{track:a,type:s}=r;switch(s){case V.LocalAudioTrack:o=be.Audio;break;case V.LocalVideoTrack:o=Y(n=a._hints).call(n,Ye.SCREEN_TRACK)?be.Screen:be.High;break;case V.LocalVideoLowTrack:o=be.Low}return{kind:s===V.LocalAudioTrack?Z.AUDIO:Z.VIDEO,stream_type:o,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:a.muted||!a.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let i,[n,{track:o,ssrcs:a,id:s}]=t;switch(n){case V.LocalVideoTrack:i=Y(r=o._hints).call(r,Ye.SCREEN_TRACK)?be.Screen:be.High;break;case V.LocalAudioTrack:i=be.Audio;break;case V.LocalVideoLowTrack:i=be.Low}return{stream_type:i,ssrcs:a,mid:s}})}assignLocalTracks(e,t){e.forEach((r,i)=>{let{track:n,type:o}=r;this.localTrackMap.set(o,{track:n,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(ie.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Y(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await zt(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Q.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:nt.TRACER}).onSuccess(),this.emit(ie.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let i=Array.from(ui(r=this.remoteUserMap).call(r)).find(o=>o._audioSSRC===t);var n;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(n=i.audioTrack)===null||n===void 0||n.emit(tl.FIRST_FRAME_DECODED),Q.firstRemoteFrame(this.store.sessionId,Bt.FIRST_AUDIO_DECODE,Ze.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ar.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let i=Array.from(ui(r=this.remoteUserMap).call(r)).find(n=>n._audioSSRC===t);i&&Q.firstRemoteFrame(this.store.sessionId,Bt.FIRST_AUDIO_RECEIVED,Ze.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ar.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,i)=>{this.reportVideoFirstFrameDecoded(t,r,i)},e.onFirstVideoReceived=t=>{var r;let i=Array.from(ui(r=this.remoteUserMap).call(r)).find(n=>n._videoSSRC===t);i&&Q.firstRemoteFrame(this.store.sessionId,Bt.FIRST_VIDEO_RECEIVED,Ze.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ar.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let i=t.candidateType==="relay",n=r.candidateType==="relay";r.candidateType!=="unknown"&&i===n||this.emit(ie.ConnectionTypeChange,i),f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(va(r))," -> ").concat(JSON.stringify(va(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(va(r))," -> ").concat(JSON.stringify(va(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(ie.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===wr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,f.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===wr.SEND_ONLY?this.restartICE(e):tr(this,ie.RequestP2PRestartICE,{direction:wr.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(V.LocalAudioTrack);if(e instanceof it&&(r==null?void 0:r.track)instanceof kt)return r.track.isActive||t.push([V.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:o}]=n;return e===o});if(i&&(t.push(i),i[0]===V.LocalVideoTrack)){let n=this.localTrackMap.get(V.LocalVideoLowTrack);n&&t.push([V.LocalVideoLowTrack,n])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(V.LocalAudioTrack);if(e instanceof it&&(r==null?void 0:r.track)instanceof kt)return r.track.isActive&&t.push([V.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:o}]=n;return e===o});if(i)if(i[0]===V.LocalVideoTrack){t.push(i);let n=this.localTrackMap.get(V.LocalVideoLowTrack);n&&t.push([V.LocalVideoLowTrack,n])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var r;let i,[n,{track:o,ssrcs:a,id:s}]=t;switch(n){case V.LocalAudioTrack:i=be.Audio;break;case V.LocalVideoTrack:i=Y(r=o._hints).call(r,Ye.SCREEN_TRACK)?be.Screen:be.High;break;case V.LocalVideoLowTrack:i=be.Low}return{stream_type:i,ssrcs:a,mid:s}})}createUnmuteMessage(e){return e.map(t=>{var r;let i,[n,{track:o,ssrcs:a,id:s}]=t;switch(n){case V.LocalAudioTrack:i=be.Audio;break;case V.LocalVideoTrack:i=Y(r=o._hints).call(r,Ye.SCREEN_TRACK)?be.Screen:be.High;break;case V.LocalVideoLowTrack:i=be.Low}return{stream_type:i,ssrcs:a,mid:s}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let n=i.get(t);if(!n)return r;r.push([e,{kind:t,id:n}])}else Array.from(i.entries()).forEach(n=>{let[o,a]=n;r.push([e,{kind:o,id:a}])});return r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[i,{kind:n,id:o}]=r;switch(n){case Z.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Z.VIDEO,ssrcId:i._videoSSRC}));case Z.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Z.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:i}]=t,n=this.remoteUserMap.get(r);n&&(n.delete(i),Array.from(n.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(V.LocalVideoTrack),r=this.localTrackMap.get(V.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),r&&e.low_stream_uplink&&await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof it){let r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;let i=this.createUnmuteMessage(r);return void await xe(this,ie.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(ie.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(ie.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await zt(mR(this.dtlsFailedCount,Rt)),this.emit(ie.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(V.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof We)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof We).length>1)throw new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof it).length>1&&(e.some(t=>t instanceof it&&t._bypassWebAudio)||!ye().webAudioMediaStreamDest))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof We&&this.pendingLocalTracks.some(r=>r instanceof We))throw new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof it&&this.pendingLocalTracks.some(r=>r instanceof it)&&(!ye().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof it&&r._bypassWebAudio)))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!w("DISABLE_DUAL_STREAM_USE_ENCODING")&&ye().supportDualStreamEncoding,i=Sp(Sp({},{width:160,height:120,framerate:15,bitrate:50}),t),n;n=r?e._mediaStreamTrack.clone():Cv(e,i);let o=Fe(8,"track-low-"),a=new We(n,Sp(Sp({},r&&{scaleResolutionDownBy:dv(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return a.on(Ns.TRANSCEIVER_UPDATED,s=>{e._updateRtpTransceiver(s,vl.LOW_STREAM)}),a._hints.push(Ye.LOW_STREAM),e.addListener($.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,i){var n;let o=Array.from(ui(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===e);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let a=this.store.keyMetrics,s=a.subscribe.find(c=>c.userId===o.uid&&c.type==="video");Q.firstRemoteVideoDecode(this.store.sessionId,Bt.FIRST_VIDEO_DECODE,Ze.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:r,subscribeElapse:ar.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(s==null?void 0:s.subscribeEnd)||0,subscriberStart:(s==null?void 0:s.subscribeStart)||0,videoAddNotify:(s==null?void 0:s.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let n=i.get(t);if(!n)return!1;let o=await this.recvConnection.getRemoteSSRC(n);return o!==void 0&&o!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new M(R.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new M(R.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new M(R.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new M(R.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new M(R.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new M(R.NOT_SUPPORTED)}async preConnect(e){throw new M(R.NOT_SUPPORTED)}getEstablishParams(){throw new M(R.NOT_SUPPORTED)}async reSubscribe(e){throw new M(R.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new M(R.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===V.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,vl.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},X($e.prototype,"p2pConnect",[FN],Object.getOwnPropertyDescriptor($e.prototype,"p2pConnect"),$e.prototype),X($e.prototype,"unpublish",[BN],Object.getOwnPropertyDescriptor($e.prototype,"unpublish"),$e.prototype),X($e.prototype,"unpublishLowStream",[jN],Object.getOwnPropertyDescriptor($e.prototype,"unpublishLowStream"),$e.prototype),X($e.prototype,"subscribe",[GN],Object.getOwnPropertyDescriptor($e.prototype,"subscribe"),$e.prototype),X($e.prototype,"mockSubscribe",[WN],Object.getOwnPropertyDescriptor($e.prototype,"mockSubscribe"),$e.prototype),X($e.prototype,"unsubscribe",[HN],Object.getOwnPropertyDescriptor($e.prototype,"unsubscribe"),$e.prototype),X($e.prototype,"muteRemote",[KN],Object.getOwnPropertyDescriptor($e.prototype,"muteRemote"),$e.prototype),X($e.prototype,"unmuteRemote",[zN],Object.getOwnPropertyDescriptor($e.prototype,"unmuteRemote"),$e.prototype),X($e.prototype,"hasRemoteMediaWithLock",[YN],Object.getOwnPropertyDescriptor($e.prototype,"hasRemoteMediaWithLock"),$e.prototype),X($e.prototype,"disconnectForReconnect",[$N],Object.getOwnPropertyDescriptor($e.prototype,"disconnectForReconnect"),$e.prototype),X($e.prototype,"remoteMediaSsrcChanged",[qN],Object.getOwnPropertyDescriptor($e.prototype,"remoteMediaSsrcChanged"),$e.prototype),$e);function yn(e){return function(t,r,i){let n=t[r];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];switch(e){case wn.SEND_ONLY:{let c=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await n.apply(this,a)}finally{c()}}case wn.RECEIVE_ONLY:{let c=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await n.apply(this,a)}finally{c()}}default:{let c=await this.sendMutex.lock("From P2PChannel2.".concat(r)),l=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await n.apply(this,a)}finally{c(),l()}}}},i}}function JN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function ns(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?JN(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):JN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var UV=class wv{constructor(t){v(this,"store",void 0),v(this,"onStatsException",void 0),v(this,"onUploadPublishDuration",void 0),v(this,"onStatsChanged",void 0),v(this,"localStats",new Map),v(this,"remoteStats",new Map),v(this,"updateStatsInterval",void 0),v(this,"trafficStats",void 0),v(this,"trafficStatsPeerList",[]),v(this,"uplinkStats",void 0),v(this,"exceptionMonitor",void 0),v(this,"p2pChannel",void 0),v(this,"scalabilityMode",sv.L1T1),v(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new XX,this.exceptionMonitor.on("exception",(r,i,n)=>{this.onStatsException&&this.onStatsException(r,i,n)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(V.LocalAudioTrack)||ns({},pv)}getLocalVideoTrackStats(){return this.localStats.get(V.LocalVideoTrack)||ns({},fv)}getRemoteAudioTrackStats(t){let r=(o,a)=>{if(!this.trafficStats)return a;let s=this.trafficStats.peer_delay.find(c=>c.peer_uid===o);return s&&(a.publishDuration=s.B_ppad+(Date.now()-this.trafficStats.timestamp)),a},i={};if(t){var n;let o=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.audioStats;o&&(i[t]=r(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{audioStats:s}]=o;s&&(i[a]=r(a,s))});return i}getRemoteNetworkQualityStats(t){let r={};if(t){var i;let n=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;n&&(r[t]=n)}else Array.from(this.remoteStats.entries()).forEach(n=>{let[o,{networkStats:a}]=n;a&&(r[o]=a)});return r}getRemoteVideoTrackStats(t){let r=(o,a)=>{if(!this.trafficStats)return a;let s=this.trafficStats.peer_delay.find(c=>c.peer_uid===o);return s&&(a.publishDuration=s.B_ppvd+(Date.now()-this.trafficStats.timestamp)),a},i={};if(t){var n;let o=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.videoStats;o&&(i[t]=r(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{videoStats:s}]=o;s&&(i[a]=r(a,s))});return i}getRTCStats(){let t=0,r=0,i=0,n=0,o=this.localStats.get(V.LocalAudioTrack);o&&(t+=o.sendBytes,r+=o.sendBitrate);let a=this.localStats.get(V.LocalVideoTrack);a&&(t+=a.sendBytes,r+=a.sendBitrate);let s=this.localStats.get(V.LocalVideoLowTrack);s&&(t+=s.sendBytes,r+=s.sendBitrate),this.remoteStats.forEach(l=>{let{audioStats:d,videoStats:u}=l;d&&(i+=d.receiveBytes,n+=d.receiveBitrate),u&&(i+=u.receiveBytes,n+=u.receiveBitrate)});let c=1;return this.trafficStats&&(c+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c,SendBitrate:r,SendBytes:t,RecvBytes:i,RecvBitrate:n,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var i;let n=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(r.peer_uid),o=n!=null&&n.videoSSRC?ar.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,a=n!=null&&n.audioSSRC?ar.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,o>a?o:a),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&f.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,i){if(!t)return!1;let n=!!i&&r.framesDecodeFreezeTime>i.framesDecodeFreezeTime,o=!i||r.framesDecodeCount>i.framesDecodeCount;return n||!o}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[i,n]=r;switch(i){case V.LocalVideoTrack:case V.LocalVideoLowTrack:{let a=n,s=ns({},fv),c=t.getStats(),l=t.getLocalMedia(i);if(c){let d=c.videoSend.find(u=>u.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId));if(d){let u=t.getLocalVideoSize(),h=t.getEncoderConfig(V.LocalVideoTrack);d.codec!=="H264"&&d.codec!=="H265"&&d.codec!=="VP8"&&d.codec!=="VP9"&&d.codec!=="AV1X"&&d.codec!=="AV1"||(s.codecType=d.codec),s.sendBytes=d.bytes,s.sendBitrate=a?8*Math.max(0,s.sendBytes-a.sendBytes):0,d.inputFrame?(s.captureFrameRate=d.inputFrame.frameRate,s.captureResolutionHeight=d.inputFrame.height,s.captureResolutionWidth=d.inputFrame.width):u&&(s.captureResolutionWidth=u.width,s.captureResolutionHeight=u.height),d.sentFrame?(s.sendFrameRate=d.sentFrame.frameRate,s.sendResolutionHeight=d.sentFrame.height,s.sendResolutionWidth=d.sentFrame.width):u&&(s.sendResolutionWidth=u.width,s.sendResolutionHeight=u.height),d.avgEncodeMs&&(s.encodeDelay=d.avgEncodeMs),h&&h.bitrateMax&&(s.targetSendBitrate=1e3*h.bitrateMax),s.sendPackets=d.packets,s.sendPacketsLost=d.packetsLost,s.sendJitterMs=d.jitterMs,s.sendRttMs=d.rttMs,s.totalDuration=a?a.totalDuration+1:1,s.totalFreezeTime=a?a.totalFreezeTime:0,this.isLocalVideoFreeze(d)&&(s.totalFreezeTime+=1),d.scalabilityMode&&this.scalabilityMode!==d.scalabilityMode&&(f.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(d.scalabilityMode)),this.scalabilityMode=d.scalabilityMode)}this.trafficStats&&(s.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(i,s),((a==null?void 0:a.sendResolutionWidth)!==s.sendResolutionWidth||(a==null?void 0:a.sendResolutionHeight)!==s.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:s.sendResolutionWidth,height:s.sendResolutionHeight})),s&&l&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,l.track,s);break}case V.LocalAudioTrack:{let a=n,s=ns({},pv),c=t.getStats(),l=t.getLocalMedia(i);if(c){let d=c.audioSend.find(u=>u.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId));if(d){if(d.codec!=="opus"&&d.codec!=="aac"&&d.codec!=="PCMU"&&d.codec!=="PCMA"&&d.codec!=="G722"||(s.codecType=d.codec),d.inputLevel)s.sendVolumeLevel=Math.round(32767*d.inputLevel);else{let u=t.getLocalAudioVolume();u&&(s.sendVolumeLevel=Math.round(32767*u))}s.sendBytes=d.bytes,s.sendPackets=d.packets,s.sendPacketsLost=d.packetsLost,s.sendJitterMs=d.jitterMs,s.sendRttMs=d.rttMs,s.sendBitrate=a?8*Math.max(0,s.sendBytes-a.sendBytes):0}}this.trafficStats&&(s.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(V.LocalAudioTrack,s),s&&l&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,l.track,s);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var i,n;let[o,{videoStats:a,audioStats:s,videoPcStats:c}]=r,l=s,d=a,u=c,h=ns({},Kx),p=ns({},zx),g=ns({},AX),{audioTrack:_,videoTrack:E,audioSSRC:S,videoSSRC:T}=t.getRemoteMedia(o),y;y=t instanceof Jr?t.getStats(!0):t.getStats();let I=(i=y)===null||i===void 0?void 0:i.audioRecv.find(k=>k.ssrc===S),O=(n=y)===null||n===void 0?void 0:n.videoRecv.find(k=>k.ssrc===T),b=this.trafficStats&&this.trafficStats.peer_delay.find(k=>k.peer_uid===o);if(I&&(I.codec!=="opus"&&I.codec!=="aac"&&I.codec!=="PCMU"&&I.codec!=="PCMA"&&I.codec!=="G722"||(h.codecType=I.codec),I.outputLevel?h.receiveLevel=Math.round(32767*I.outputLevel):_&&(h.receiveLevel=Math.round(32767*_.getVolumeLevel())),h.receiveBytes=I.bytes,h.receivePackets=I.packets,h.receivePacketsLost=I.packetsLost,h.receivePacketsDiscarded=I.packetsDiscarded,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=l?l.totalFreezeTime:0,h.freezeRate=h.totalFreezeTime/h.totalDuration,h.receiveDelay=I.jitterBufferMs,h.totalDuration>10&&wv.isRemoteAudioFreeze(_)&&(h.totalFreezeTime+=1)),O){O.codec!=="H264"&&O.codec!=="H265"&&O.codec!=="VP8"&&O.codec!=="VP9"&&O.codec!=="AV1X"&&O.codec!=="AV1"||(p.codecType=O.codec),p.receiveBytes=O.bytes,p.receiveBitrate=d?8*Math.max(0,p.receiveBytes-d.receiveBytes):0,p.decodeFrameRate=O.decodeFrameRate<0?0:O.decodeFrameRate,p.renderFrameRate=O.decodeFrameRate<0?0:O.decodeFrameRate,O.outputFrame&&(p.renderFrameRate=O.outputFrame.frameRate),O.receivedFrame?(p.receiveFrameRate=O.receivedFrame.frameRate,p.receiveResolutionHeight=O.receivedFrame.height,p.receiveResolutionWidth=O.receivedFrame.width):E&&(p.receiveResolutionHeight=E._videoHeight||0,p.receiveResolutionWidth=E._videoWidth||0),O.framesRateFirefox!==void 0&&(p.receiveFrameRate=Math.round(O.framesRateFirefox)),p.receivePackets=O.packets,p.receivePacketsLost=O.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.totalDuration=d?d.totalDuration+1:1,p.totalFreezeTime=d?d.totalFreezeTime:0,p.receiveDelay=O.jitterBufferMs||0;let k=!!T&&t.getRemoteVideoIsReady(T);E&&k&&wv.isRemoteVideoFreeze(E,O,u)&&(p.totalFreezeTime+=1),p.freezeRate=p.totalFreezeTime/p.totalDuration}b&&(h.end2EndDelay=b.B_ad,p.end2EndDelay=b.B_vd,h.transportDelay=b.B_ed,p.transportDelay=b.B_ed,h.currentPacketLossRate=b.B_ealr4/100,p.currentPacketLossRate=b.B_evlr4/100,g.uplinkNetworkQuality=b.B_punq?b.B_punq:0,g.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(o,{audioStats:h,videoStats:p,videoPcStats:O,networkStats:g}),_&&this.exceptionMonitor.setRemoteAudioStats(_,h),E&&this.exceptionMonitor.setRemoteVideoStats(E,p)})}},xV=class{constructor(){v(this,"destChannelMediaInfos",new Map),v(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){ZO(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){ZO(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){sm(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}};function QN(e){if(!(e instanceof xV))return new D(R.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new D(R.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new D(R.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function ZN(e){var t={},r=!1;function i(n,o){return r=!0,{done:!1,value:new UR(o=new yv(function(a){a(e[n](o))}),1)}}return t[xc!==void 0&&H2||"@@iterator"]=function(){return this},t.next=function(n){return r?(r=!1,n):i("next",n)},typeof e.throw=="function"&&(t.throw=function(n){if(r)throw r=!1,n;return i("throw",n)}),typeof e.return=="function"&&(t.return=function(n){return r?(r=!1,n):i("return",n)}),t}var _J=_t(OV);function eD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function tD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?eD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Ue;function rD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Tp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var pd=(Ue=class bd extends kx{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Y(r=Object.keys(am)).call(r,t)}))]}constructor(t,r){super(t,r),v(this,"store",void 0),v(this,"peerConnection",void 0),v(this,"remoteSDP",void 0),v(this,"initialOffer",void 0),v(this,"statsFilter",void 0),v(this,"useRTX",!1),v(this,"localCapabilities",void 0),v(this,"localCandidateCount",0),v(this,"allCandidatesReceived",!1),v(this,"establishPromise",void 0),v(this,"mutex",new cr("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(bd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=VR(this.peerConnection,w("STATS_UPDATE_INTERVAL"),void 0,ot()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=ya(t.sdp),i=xu(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:w("FILTER_VIDEO_FEC"),filterAudioFec:w("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,Tp(Tp({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new M(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(i){v(this,"sessionDesc",void 0),v(this,"localCapabilities",void 0),v(this,"rtpCapabilities",void 0),v(this,"candidates",void 0),v(this,"iceParameters",void 0),v(this,"dtlsParameters",void 0),v(this,"setup",void 0),v(this,"currentMidIndex",void 0),v(this,"cname",void 0),i=Et(i);let{iceParameters:n,dtlsParameters:o,candidates:a,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:d,cname:u}=i,h=Ht.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=a,this.iceParameters=n,this.dtlsParameters=o,this.setup=c,this.localCapabilities=l,this.cname=u;for(let p=0;p<h.mediaDescriptions.length;p++){let g=h.mediaDescriptions[p];if(g.attributes.iceUfrag=n.iceUfrag,g.attributes.icePwd=n.icePwd,g.attributes.fingerprints=o.fingerprints,g.attributes.candidates=a,g.attributes.setup=c,g.media.mediaType==="video"){g.media.fmts=s.videoCodecs.map(E=>E.payloadType.toString(10));let _=s.videoCodecs.filter(E=>{var S,T;return(S=E.rtpMap)===null||S===void 0?void 0:Y(T=S.encodingName.toLowerCase()).call(T,d)});_.length===0&&(_=s.videoCodecs),g.attributes.payloads=_,g.attributes.extmaps=s.videoExtensions}g.media.mediaType==="audio"&&(g.media.fmts=s.audioCodecs.map(_=>_.payloadType.toString(10)),g.attributes.payloads=s.audioCodecs,g.attributes.extmaps=s.audioExtensions),h.mediaDescriptions[p]=this.mungMediaDesc(g)}this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1}toString(){return Ht.print(this.sessionDesc)}send(i,n,o){let{ssrcs:a,ssrcGroups:s}=hs(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(u=>i===Z.VIDEO?u.media.mediaType==="video":u.media.mediaType==="audio"),l=a[0].attributes.label,d=a[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(a),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:d}}batchSend(i){return i.map(n=>{let{kind:o,ssrcMsg:a}=n;return this.send(o,a,void 0)})}stopSending(i){this.sessionDesc.mediaDescriptions.forEach(n=>{let o=[],a=[],s=[];n.attributes.ssrcs.forEach(c=>{Y(i).call(i,c.attributes.label||"")?s.push(c):o.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;Y(l=s.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||a.push(c)}),n.attributes.ssrcs=o,n.attributes.ssrcGroups=a})}mute(i){let n=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===i);if(!n)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(i){let n=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===i);if(!n)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(i,n,o){i.forEach((a,s)=>{let c=a._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],a);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(i){}updateCandidates(i){i===ti.TCP?this.candidates.forEach(n=>{this.candidates.findIndex(o=>o.transport==="tcp"&&o.connectionAddress===n.connectionAddress&&o.port===n.port)===-1&&this.candidates.push(tD(tD({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this.candidates=this.candidates.filter(n=>n.transport!=="tcp");for(let n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(i){i=Et(i),this.iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=i.iceUfrag,n.attributes.icePwd=i.icePwd})}predictReceivingMids(i){let n=[];for(let o=0;o<i;o++)n.push((this.currentMidIndex+o+1).toString(10));return n}mungRecvMediaDsec(i,n){let o=Et(i);return yl(o,n),DR(o,n),o}updateRecvMedia(i,n){let o=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===i);if(o!==-1){let a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],n);this.sessionDesc.mediaDescriptions[o]=a}}bumpMid(i){this.currentMidIndex+=i}updateTrackLabel(i,n,o){let a=this.sessionDesc.mediaDescriptions.find(c=>i===Z.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(a){let c=a.attributes.ssrcs.find(l=>l.attributes.label===n);var s;c&&(c.attributes.label=o,(s=c.attributes.msid)===null||s===void 0||s.replace(n,o))}}mungMediaDesc(i){let n=Et(i);return NR(n),function(o){let a=o.attributes.extmaps.find(s=>s.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(a),1),o.attributes.payloads.forEach(s=>{let c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(i){for(let n of this.sessionDesc.mediaDescriptions)for(let o of n.attributes.ssrcs)if(o.attributes.label===i)return[o]}}(Tp(Tp({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new M(R.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var i=this;return kn(function*(){let n=yield Ie(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let o=t.map(h=>i.peerConnection.addTrack(h._mediaStreamTrack)),a=yield Ie(i.peerConnection.createOffer()),s=Ht.parse(a.sdp),c=t.map(h=>{let p=h._mediaStreamTrack,g=s.mediaDescriptions.find(_=>_.attributes.mid===p.kind);if(!g)throw new Error("Cannot extract ssrc from mediaDescription.");return function(_,E,S){let T=_.attributes.ssrcs.filter(I=>I.attributes.label===E),y=_.attributes.ssrcGroups;if(T.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(y&&T.length>1){let I=y.find(O=>O.ssrcIds.indexOf(T[0].ssrcId)!==-1);return I?[{ssrcId:I.ssrcIds[0],rtx:S?I.ssrcIds[1]:void 0}]:[{ssrcId:T[0].ssrcId}]}return[{ssrcId:T[0].ssrcId}]}(g,p.id,i.useRTX)}),l;try{l=yield c}catch(h){throw o.forEach(p=>{er()&&p.replaceTrack(null),i.peerConnection.removeTrack(p)}),h}let d=i.mungSendOfferSDP(a.sdp,t);i.remoteSDP.receive(t,r,l);let u=i.remoteSDP.toString();return yield Ie(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Ie(i.applySendEncodings(o,t)),yield Ie(i.peerConnection.setRemoteDescription({type:"answer",sdp:u})),t.map((h,p)=>{let g=h._mediaStreamTrack.id;return{localSSRC:c[p],id:g}})}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{n()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getSenders().filter(o=>{var a;return t.indexOf(((a=o.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(o=>{er()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});let i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);let n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,i,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:o,mslabel:a}=this.remoteSDP.send(t,r,n),s=new K((d,u)=>{let h=setTimeout(()=>{u(new Error("Cannot receive track, id: ".concat(o)))},1e4),p=g=>{let _=ve();if((_.name==="Safari"&&Number(_.version)===11||Or())&&g.track.id!==o&&g.streams[0].id===a){var E;let S=g.streams[0].getTracks()[0];return(E=this.remoteSDP)===null||E===void 0||E.updateTrackLabel(t,o,g.track.id),this.peerConnection.removeEventListener("track",p),clearTimeout(h),void d(S)}if(g.track.id===o)return this.peerConnection.removeEventListener("track",p),clearTimeout(h),void d(g.track)};this.peerConnection.addEventListener("track",p)}),c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});let l=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(l),{track:await s,id:o}}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(i=>{var n;return t.indexOf(((n=i.track)===null||n===void 0?void 0:n.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(i=>{if(er()&&i.track)i.track.enabled=!1;else{let n=i.getParameters();n.encodings.forEach(o=>o.active=!1),i.setParameters(n)}})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(o=>{var a;return t.indexOf(((a=o.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async o=>{if(er()&&o.track)o.track.enabled=!0;else{let a=o.getParameters();a.encodings.forEach(s=>s.active=!0),await o.setParameters(a)}});let i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);let n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return kn(function*(){let i=yield Ie(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ye().supportPCSetConfiguration){let c=r.peerConnection.getConfiguration(),l=t===ti.RELAY?"relay":"all";c.iceTransportPolicy!==l&&(f.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(c.iceTransportPolicy,"] to [").concat(l,"]")),c.iceTransportPolicy=l,r.peerConnection.setConfiguration(c))}else if(t===ti.RELAY)return;t!==ti.RELAY&&r.remoteSDP.updateCandidates(t);let n=yield Ie(r.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=ya(n.sdp),{remoteIceParameters:a}=yield o.iceParameters;r.remoteSDP.restartICE(a);let s=r.remoteSDP.toString();yield Ie(r.peerConnection.setLocalDescription(n)),yield Ie(r.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(n){f.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),n)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(i.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);let o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new M(R.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getSenders().filter(n=>{var o;return((o=n.track)===null||o===void 0?void 0:o.id)===t});i.length===1&&await this.applySendEncodings(i,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getSenders().find(n=>{var o;return((o=n.track)===null||o===void 0?void 0:o.id)===r});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new M(R.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new M(R.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,f.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,f.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},w("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(im(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...bd.turnServerConfigToIceServers(t.turnServer.servers)),w("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...bd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{i.security?i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var i;if(r||(r=this.peerConnection.getSenders().find(l=>{var d;return((d=l.track)===null||d===void 0?void 0:d.id)===t._mediaStreamTrack.id})),!r)return f.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!ye().supportSetRtpSenderParameters)return f.warn("Browser not support set rtp-sender parameters");let n={},o={};if(t instanceof We)switch(t._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(w("DSCP_TYPE")&&Ga()){var a;let l=w("DSCP_TYPE");Y(a=["very-low","low","medium","high"]).call(a,l)&&(o.networkPriority=l)}let s=r.getParameters(),c=(i=s.encodings)===null||i===void 0?void 0:i[0];c&&Object.assign(c,o),Object.assign(s,n),f.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await r.setParameters(s)}async applySendEncodings(t,r){try{if(!ye().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let n=t[i],o=r[i];n&&o&&await this.updateRtpSenderEncodings(o,n)}}catch{f.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){let i=Ht.parse(t);return r.forEach((n,o)=>{let a=n._mediaStreamTrack,s=i.mediaDescriptions.find(c=>c.attributes.mid===a.kind);s&&yl(s,n)}),Ht.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let r=this.remoteSDP.batchSend(t).map((o,a)=>{let{id:s,mslabel:c}=o,{kind:l}=t[a];return new K((d,u)=>{let h=setTimeout(()=>{u(new Error("Cannot receive track, id: ".concat(s)))},1e4),p=g=>{let _=ve();if(_.name==="Safari"&&Number(_.version)===11&&g.track.id!==s&&g.streams[0].id===c){var E;let S=g.streams[0].getTracks()[0];return(E=this.remoteSDP)===null||E===void 0||E.updateTrackLabel(l,s,g.track.id),this.peerConnection.removeEventListener("track",p),clearTimeout(h),void d({track:S,id:s})}if(g.track.id===s)return this.peerConnection.removeEventListener("track",p),clearTimeout(h),void d({track:g.track,id:s})};this.peerConnection.addEventListener("track",p)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(n),await K.all(r)}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(ye().supportPCSetConfiguration){let r=bd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},X(Ue.prototype,"connect",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"connect"),Ue.prototype),X(Ue.prototype,"stopSending",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"stopSending"),Ue.prototype),X(Ue.prototype,"receive",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"receive"),Ue.prototype),X(Ue.prototype,"stopReceiving",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"stopReceiving"),Ue.prototype),X(Ue.prototype,"muteRemote",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"muteRemote"),Ue.prototype),X(Ue.prototype,"unmuteRemote",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"unmuteRemote"),Ue.prototype),X(Ue.prototype,"muteLocal",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"muteLocal"),Ue.prototype),X(Ue.prototype,"unmuteLocal",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"unmuteLocal"),Ue.prototype),X(Ue.prototype,"close",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"close"),Ue.prototype),X(Ue.prototype,"updateEncoderConfig",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"updateEncoderConfig"),Ue.prototype),X(Ue.prototype,"updateSendParameters",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"updateSendParameters"),Ue.prototype),X(Ue.prototype,"replaceTrack",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"replaceTrack"),Ue.prototype),X(Ue.prototype,"getRemoteSSRC",[wi],Object.getOwnPropertyDescriptor(Ue.prototype,"getRemoteSSRC"),Ue.prototype),Ue);function wi(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let n=this.mutex,o=await n.lock("Locking from P2PConnection.".concat(t));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await i.apply(this,s)}finally{o()}},r}function iD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function ta(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var fd="9",nD=4e4,mJ=class{get localCapabilities(){return Et(this._localCapabilities)}get rtpCapabilities(){return Et(this._rtpCapabilities)}get candidates(){return Et(this._candidates)}get iceParameters(){return Et(this._iceParameters)}get dtlsParameters(){return Et(this._dtlsParameters)}constructor(e){v(this,"sessionDesc",void 0),v(this,"_localCapabilities",void 0),v(this,"_rtpCapabilities",void 0),v(this,"_candidates",void 0),v(this,"_iceParameters",void 0),v(this,"_dtlsParameters",void 0),v(this,"setup",void 0),v(this,"currentMidIndex",void 0),v(this,"cname",void 0),v(this,"firefoxSsrcMidMap",new Map),e=Et(e);let{iceParameters:t,dtlsParameters:r,candidates:i,rtpCapabilities:n,setup:o,localCapabilities:a,cname:s}=e;this._rtpCapabilities=n,this._candidates=i,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=a,this.setup=o,this.cname=s,this.sessionDesc=this.updateRemoteRTPCapabilities(n),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){let t=this.candidates,r=this.dtlsParameters,i=this.iceParameters,n=this.rtpCapabilities.send,o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){let s=2*a+2e4,c=2*a+nD,{ssrcs:l,ssrcGroups:d}=hs([{ssrcId:s}],this.cname),{ssrcs:u,ssrcGroups:h}=hs([{ssrcId:c,rtx:w("USE_SUB_RTX")?c+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:fd,protos:["UDP","TLS","RTP","SAVPF"],fmts:n.videoCodecs.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:t,extmaps:n.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:h,rtcpFeedbackWildcards:[],payloads:n.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:fd,protos:["UDP","TLS","RTP","SAVPF"],fmts:n.audioCodecs.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:t,extmaps:n.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:n.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Ht.print(this.sessionDesc)}send(e,t,r,i){let{ssrcs:n,ssrcGroups:o}=hs(t,this.cname,w("SYNC_GROUP")?r:void 0),a=this.findPreloadMediaDesc(n);if(a){if(ot()&&this.firefoxSsrcMidMap.set(n[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){let s=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[s]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{let s=this.findAvailableMediaIndex(e,n),c;return s===-1||s===1&&(er()||function(){let l=ve();return!(l.name!==Ne.CHROME||!l.osVersion)&&Number(l.version)<=90}())||s===0&&w("USE_SUB_RTX")||NO()?(c=this.createOrRecycleSendMedia(e,n,o,"sendonly",i),this.updateBundleMids()):(c=Et(this.sessionDesc.mediaDescriptions[s]),c.attributes.direction="sendonly",c.attributes.ssrcs=n,c.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[s]=this.mungSendMediaDesc(c,i)),ot()&&this.firefoxSsrcMidMap.set(n[0].ssrcId,c.attributes.mid),{mid:c.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(n=>{let{kind:o,ssrcMsg:a,mslabel:s}=n;return this.send(o,a,s)}),r=[],i=!1;return t.forEach(n=>{let{mid:o,needExchangeSDP:a}=n;a&&(i=!0),r.push(o)}),{mids:r,needExchangeSDP:i}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.mid==="0"||ot()||NO()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>Y(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>Y(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}receive(e,t,r,i){e.forEach((n,o)=>{this.createOrRecycleRecvMedia(n,[],"recvonly",t,r,i[o])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let t=this.sessionDesc||Ht.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e;let r=this.rtpCapabilities.send,i=this.localCapabilities.send;for(let n of t.mediaDescriptions){if(n.attributes.iceUfrag=this._iceParameters.iceUfrag,n.attributes.icePwd=this._iceParameters.icePwd,n.attributes.fingerprints=this._dtlsParameters.fingerprints,n.attributes.candidates=this._candidates,n.attributes.setup=this.setup,n.media.mediaType==="application"&&(n.attributes.sctpPort="5000"),n.media.mediaType==="video"){if(r.videoCodecs.length===0){let o=i.videoCodecs.filter(a=>{var s,c;return(s=a.rtpMap)===null||s===void 0?void 0:Y(c=s.encodingName.toLowerCase()).call(c,"vp8")})||[i.videoCodecs[0]];n.media.fmts=o.map(a=>a.payloadType.toString(10)),n.attributes.payloads=o,n.attributes.extmaps=[]}else if(n.media.fmts=r.videoCodecs.map(o=>o.payloadType.toString(10)),n.attributes.payloads=r.videoCodecs,n.attributes.extmaps=r.videoExtensions,w("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:o,ssrcGroups:a}=hs([{ssrcId:nD,rtx:w("USE_SUB_RTX")?40001:void 0}],this.cname);n.attributes.ssrcs=o,n.attributes.ssrcGroups=a}}if(n.media.mediaType==="audio"){if(r.audioCodecs.length===0){let o=i.audioCodecs.filter(a=>{var s,c;return(s=a.rtpMap)===null||s===void 0?void 0:Y(c=s.encodingName.toLowerCase()).call(c,"opus")})||[i.audioCodecs[0]];n.media.fmts=o.map(a=>a.payloadType.toString(10)),n.attributes.payloads=o,n.attributes.extmaps=[]}else if(n.media.fmts=r.audioCodecs.map(o=>o.payloadType.toString(10)),n.attributes.payloads=r.audioCodecs,n.attributes.extmaps=r.audioExtensions,Rl(n),w("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:o,ssrcGroups:a}=hs([{ssrcId:2e4}],this.cname);n.attributes.ssrcs=o,n.attributes.ssrcGroups=a}}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){let t=this._candidates.filter(r=>r.transport==="udp");if(e===ti.TCP){if(t.length===0)return;if(w("TCP_CANDIDATE_ONLY")){let r=this._candidates.filter(i=>i.transport==="tcp");t.forEach(i=>{r.findIndex(n=>n.connectionAddress===i.connectionAddress)===-1&&r.push(ta(ta({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=r}else{let r=[];t.forEach(i=>{r.push(ta(ta({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=[...t,...r]}}else if(e===ti.RELAY){if(t.length!==0)return;{let r=this._candidates.filter(i=>i.transport==="tcp");r.forEach(i=>{t.push(ta(ta({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=[...t,...r]}}else t.length===0?(this._candidates.filter(r=>r.transport==="tcp").forEach(r=>{t.push(ta(ta({},r),{},{foundation:"udpcandidate",priority:Number(r.priority)+1+"",transport:"udp",port:Number(r.port)-90+""}))}),this._candidates=t):this._candidates=this._candidates.filter(r=>r.transport!=="tcp");for(let r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(e){e=Et(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(ot()){if(i){let n=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(n||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!n||n!==r.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(let r of this.sessionDesc.mediaDescriptions)if(r.media.mediaType==="application")return{mediaDesc:r,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:fd,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,r,i,n,o){let a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=qd(a,s,this.localCapabilities.send,a===Z.VIDEO?i:n),l=a===Z.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;let d="".concat(this.currentMidIndex),u={media:{mediaType:a,port:fd,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};u=this.mungRecvMediaDsec(u,e,o);let h=this.findFirstClosedMedia(a);if(h){let p=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[p]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateRemoteCodec(e,t,r){let i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(u=>u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").filter(u=>{var h;return Y(h=Object.keys(am)).call(h,u)}))],n=new Set(t);if(i.every(u=>n.has(u)))return f.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let o=this._rtpCapabilities.recv.videoCodecs.filter(u=>t.some(h=>{var p;return Y(p=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(p,h)}));if(o.length===0)return f.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(t)),!1;let a=[...new Set(o.map(u=>u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||""))],s;if(f.debug("updateRemoteCodec, from ".concat(i," to ").concat(a)),e.length===0)s=this.sessionDesc.mediaDescriptions.filter(u=>u.media.mediaType==="video"&&u.attributes.direction==="recvonly");else if(s=this.sessionDesc.mediaDescriptions.filter(u=>u.attributes.mid&&Y(e).call(e,u.attributes.mid)&&u.attributes.direction==="recvonly"),s.length!==e.length)return f.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(w("USE_PUB_RTX")||w("USE_SUB_RTX")){let u=PR(o,this.rtpCapabilities.recv.videoCodecs);o.push(...u)}this._rtpCapabilities.recv.videoCodecs=o;let c=this.localCapabilities.send,l=this.rtpCapabilities.recv,d=qd(Z.VIDEO,l,c,r);return s.forEach(u=>{let h=d.map(p=>p.payloadType.toString(10));f.debug("updateRemoteCodec mid: ".concat(u.attributes.mid,", from ").concat(u.attributes.payloads," to ").concat(d)),u.attributes.payloads=d,u.media.fmts=h}),!0}createOrRecycleSendMedia(e,t,r,i,n){let o=this.rtpCapabilities.send,a=e===Z.VIDEO?o.videoCodecs:o.audioCodecs,s=e===Z.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;let c="".concat(this.currentMidIndex),l={media:{mediaType:e,port:fd,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(u=>u.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,n);let d=this.findFirstClosedMedia(e);if(d){let u=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[u]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,r){let i=Et(e);return NR(i),yl(i,t),DR(i,t),SV(i),s_(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,t){let r=Et(e);return s_(r,t,this.localCapabilities.recv),Rl(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(r!==-1){let i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>ot()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function oD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function wo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Xd=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),ol=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(ol||{}),l_=new Map;function aD(e,t,r,i){let{scale:n}=e;if(n===0&&i===ol.UP||n>=t.length-1&&i===ol.DOWN)return e;let o=wo(wo({},e),{},{scale:i===ol.DOWN?++n:--n});switch(r){case"maintain-framerate":o=wo(wo({},o),t[n].motion);break;case"maintain-resolution":o=wo(wo({},o),t[n].detail);break;case"balanced":o=wo(wo({},o),t[n].balanced)}return o}function VV(e,t){if(t){let r={overUse:0,underUse:0,adaptationList:FV(t)};l_.set(e,r)}else l_.delete(e)}function FV(e){let t=wo({},e),{bitrateMax:r,frameRate:i,scaleResolutionDownBy:n,bitrateMin:o}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:g,BALANCE_BITRATE_FACTOR:_,BALANCE_FRAMERATE_FACTOR:E,BALANCE_RESOLUTION_FACTOR:S,MOTION_RESOLUTION_FACTOR:T,MOTION_BITRATE_FACTOR:y,DETAIL_FRAMERATE_FACTOR:I,DETAIL_BITRATE_FACTOR:O}=gR,b=Math.min(t.frameRate,s),k=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(p,1)*b),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o}}];for(let P=1;P<=c;P++){let j={bwe_up:Math.round(Math.pow(u,P)*r),bwe_down:Math.round(Math.pow(h,P+1)*r),fps_up:Math.round(Math.pow(g,P)*b),fps_down:Math.round(Math.pow(p,P+1)*b)},G={scaleResolutionDownBy:n/Math.pow(S,P),frameRate:Math.max(Math.round(Math.pow(E,P)*i),a),bitrateMax:Math.max(Math.round(Math.pow(_,P)*r),d),bitrateMin:Math.max(Math.round(Math.pow(_,P)*o),l)},ce={scaleResolutionDownBy:n/Math.pow(T,P),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(y,P)*r),d),bitrateMin:Math.max(Math.round(Math.pow(y,P)*o),l)},pe={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(I,P)*i),a),bitrateMax:Math.max(Math.round(Math.pow(O,P)*r),d),bitrateMin:Math.max(Math.round(Math.pow(O,P)*o),l)};k.push({scale:P,threshold:j,balanced:G,motion:ce,detail:pe})}return k}function EJ(e,t,r,i,n,o){let a=l_.get(e)||{overUse:0,underUse:0,adaptationList:FV(n)},{adaptationList:s}=a;l_.set(e,a);let{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=gR,{scale:d}=i,u,h;return typeof t=="number"&&t>0&&function(p,g,_,E){if(g>=_.length)return!1;let{threshold:{fps_down:S}}=_[g];return w("FORCE_AG_HIGH_FRAMERATE")&&E==="maintain-framerate"&&(S=_[0].threshold.fps_down),p<S}(t,d,s,o)&&(a.overUse++,h=Xd.CPU,a.overUse>c)||typeof r=="number"&&r>0&&function(p,g,_){if(g>=_.length)return!1;let{threshold:{bwe_down:E}}=_[g];return p<E}(r,d,s)&&(a.overUse++,h=Xd.BANDWIDTH,a.overUse>c)?(a.overUse=0,a.underUse=0,u=aD(i,s,o,ol.DOWN),[u,h]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(p,g,_,E){if(g===0)return;let{threshold:{fps_up:S}}=_[g];return w("FORCE_AG_HIGH_FRAMERATE")&&E==="maintain-framerate"&&(S=_[1].threshold.fps_up),p>S}(t,d,s,o)&&function(p,g,_){if(g===0)return;let{threshold:{bwe_up:E}}=_[g];return p>E}(r,d,s)&&(a.underUse++,a.underUse>l&&(a.overUse=0,a.underUse=0,u=aD(i,s,o,ol.UP),u.scale===0&&(h=Xd.NONE))),[u,h])}function sD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Yg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function gJ(e){var t;return!!w("ENABLE_AG_ADAPTATION")&&!!(e instanceof Ev||Y(t=e._hints).call(t,Ye.CUSTOM_TRACK))&&(!!w("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r){let i=ve();if(i.os!==Lt.IOS||!i.osVersion)return!1;let n=i.osVersion.split(".");return Number(n[0])>=r}(14)&&_x(17,4)||fx(14)&&mx(17,4)))}var d_=new Map;function vp(e,t){let r=d_.get(e);if(r){let{timer:i}=r;window.clearTimeout(i),d_.delete(e)}t.qualityLimitationReason=Xd.NONE,VV(e)}var ge;function cD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function $n(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Rn=(ge=class Nd extends kx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Y(r=Object.keys(am)).call(r,t)}))]}constructor(t,r){super(t,r),v(this,"store",void 0),v(this,"peerConnection",void 0),v(this,"id",Fe(5,"connection-")),v(this,"remoteSDP",void 0),v(this,"initialOffer",void 0),v(this,"transportEventReceiver",void 0),v(this,"statsFilter",void 0),v(this,"extension",{useXR:w("USE_XR")}),v(this,"localCapabilities",void 0),v(this,"remoteCodecs",void 0),v(this,"localCandidateCount",0),v(this,"allCandidatesReceived",!1),v(this,"isPreallocation",!1),v(this,"preSSRCMap",new Map),v(this,"dataStreamChannelMap",new Map),v(this,"establishPromise",void 0),v(this,"recoveredDataChannelIds",[]),v(this,"currentDataChannelId",1),v(this,"mutex",new cr("P2PConnection-mutex")),v(this,"qualityLimitationReason",Xd.NONE),this.store=r,this.peerConnection=new RTCPeerConnection(Nd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=VR(this.peerConnection,w("STATS_UPDATE_INTERVAL"),void 0,ot()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){let r=this.preSSRCMap.get(t);if(r!==void 0){let i=this.peerConnection.getTransceivers().find(n=>n.mid===r);if(i)return{transceiver:i,track:i.receiver.track,id:r}}}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void f.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){let i=await this.peerConnection.createOffer(),n=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else f.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=ya(t.sdp),i=await vV({filterRTX:!w("USE_PUB_RTX")&&!w("USE_SUB_RTX"),filterVideoFec:w("FILTER_VIDEO_FEC"),filterAudioFec:w("FILTER_AUDIO_FEC"),filterVideoCodec:w("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=c_(i),this.initialOffer=t,$n($n({},r),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new M(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new mJ($n($n({},t),{},{localCapabilities:this.localCapabilities})),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let r=this.remoteSDP.toString(),i=yV(this.initialOffer.sdp,this.extension),n=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),n==null||n(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});let o=this.peerConnection.getTransceivers()[0];if(o!=null&&o.receiver&&this.tryBindTransportEvents(o.receiver),w("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(w("PRELOAD_MEDIA_COUNT"));let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c)}let{preSSRCs:a}=t;if(Array.isArray(a)&&a.length>0){let{mids:s}=this.remoteSDP.batchSend(a.map(c=>({kind:c.kind,ssrcMsg:[{ssrcId:c.ssrcId,rtx:c.rtx}],mslabel:c.mslabel})));s.forEach((c,l)=>{this.preSSRCMap.set(a[l].ssrcId,c)}),await mp(this.peerConnection,this.remoteSDP,this.extension),f.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:r}=t;this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:i}=t;if(Array.isArray(i)&&i.length>0){let{mids:n}=this.remoteSDP.batchSend(i.map(o=>Object.assign({},{kind:o.kind,ssrcMsg:[{ssrcId:o.ssrcId,rtx:o.rtx}],mslabel:o.mslabel})));n.forEach((o,a)=>{this.preSSRCMap.set(i[a].ssrcId,o)})}await mp(this.peerConnection,this.remoteSDP,this.extension),f.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,i){var n=this;return kn(function*(){let o=yield Ie(n.mutex.lock("From P2PConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let a=[];t.forEach(_=>{let E=n.peerConnection.addTransceiver(_._mediaStreamTrack,{direction:"sendonly"});a.push(E),_._updateRtpTransceiver(E)}),ot()&&w("SIMULCAST")===!0&&(yield Ie(n.applySimulcastForFirefox(a,t)));let s=yield Ie(n.peerConnection.createOffer()),c=n.remoteSDP.predictReceivingMids(t.length),l=n.mungSendOfferSDP(s.sdp,t,c),d=Ht.parse(l),u=c.map(_=>{let E=d.mediaDescriptions.find(S=>S.attributes.mid===_);if(!E)throw new Error("Cannot extract ssrc from mediaDescription.");return EV(E,w("USE_PUB_RTX"))}),h;try{h=yield u}catch(_){h=[],n.remoteSDP.receive(t,r,i,h);let E=n.remoteSDP.toString();throw yield Ie(n.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ie(n.peerConnection.setRemoteDescription({type:"answer",sdp:E})),yield Ie(n.stopSending(c,!0)),_}n.remoteSDP.receive(t,r,i,h);let p=n.remoteSDP.toString(),g=n.logSDPExchange(l,"offer","local","send");return yield Ie(n.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ie(n.applySimulcastEncodings(a,t)),yield Ie(n.applySendEncodings(a,t)),g==null||g(p),yield Ie(n.peerConnection.setRemoteDescription({type:"answer",sdp:p})),a.map((_,E)=>{let S=c[E];return{localSSRC:u[E],id:S,transceiver:_}})}catch(a){throw a instanceof M?a:new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")f.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:w("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}r.forEach(o=>{o._updateOriginDataChannel(i)});let{needExchangeSDP:n}=this.remoteSDP.sendDataChannel();if(n){let o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),f.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else f.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof M?i:new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{let r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof M?r:new M(R.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){let i=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getTransceivers().filter(c=>t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(c=>{var l;vp(this.id+c.mid,this),c.direction="inactive",(l=c.stop)===null||l===void 0||l.call(c)});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let s=this.remoteSDP.toString();a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}finally{i&&i()}}async receive(t,r,i,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,r,i,n);a&&(await mp(this.peerConnection,this.remoteSDP,this.extension),f.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let s=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:o,transceiver:s}}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:r,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await mp(this.peerConnection,this.remoteSDP,this.extension),f.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(n=>{let o=this.peerConnection.getTransceivers().find(a=>a.mid===n);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:n,transceiver:o}})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(o=>{Array.from(this.preSSRCMap.entries()).some(a=>{let[s,c]=a;if(c===o)return this.preSSRCMap.delete(s),!0})}),this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let n=await this.peerConnection.createAnswer();i==null||i(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let n=await this.peerConnection.createAnswer();i==null||i(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let n=await this.peerConnection.createAnswer();i==null||i(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(a=>{a.direction="inactive"});let i=await this.peerConnection.createOffer(),n=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(a,s)=>{a.direction="sendonly"});let i=await this.peerConnection.createOffer(),n=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return kn(function*(){let i=yield Ie(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ye().supportPCSetConfiguration){let l=r.peerConnection.getConfiguration(),d=t===ti.RELAY?"relay":"all";l.iceTransportPolicy!==d&&(f.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(l.iceTransportPolicy,"] to [").concat(d,"]")),l.iceTransportPolicy=d,r.peerConnection.setConfiguration(l))}else if(t===ti.RELAY)return;r.remoteSDP.updateCandidates(t);let n=yield Ie(r.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=ya(n.sdp),{remoteIceParameters:a}=yield o.iceParameters;r.remoteSDP.restartICE(a);let s=r.remoteSDP.toString(),c=r.logSDPExchange(n.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Ie(r.peerConnection.setLocalDescription(n)),c==null||c(s),yield Ie(r.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(n){f.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),n)}finally{i()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{vp(this.id+r.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return $n($n({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(i.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let o=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),a==null||a(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new M(R.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getTransceivers().filter(n=>n.mid===t);i.length===1&&(this.isVP8Simulcast(r)?ot()||await this.applySimulcastEncodings(i,[r]):await this.applySendEncodings(i,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getTransceivers().find(n=>n.mid===r);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:i,remote:n}=r.getSelectedCandidatePair();return{local:$n($n({},ho),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:$n($n({},ho),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,f.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,f.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},w("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(im(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Nd.turnServerConfigToIceServers(t.turnServer.servers)),w("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Nd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),w("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(r.iceTransportPolicy="relay")}))),w("ENABLE_ENCODED_TRANSFORM")&&ye().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{i.security?i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Gc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!w("FORCE_TURN_TCP")&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(t){let r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var n;r!=null&&r.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,r.state))},r.onerror=n=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in n?n.error:n)};let i=r.iceTransport;i&&(i.onstatechange=()=>{let n=r==null?void 0:r.iceTransport.state;var o;n&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,n))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:n,remote:o}=i.getSelectedCandidatePair();f.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var i,n;if(r||(r=this.peerConnection.getSenders().find(_=>_.track===t._mediaStreamTrack)),!r)return f.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return f.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ye().supportSetRtpSenderParameters)return f.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let o={},a={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}let s=function(_,E){return _.getTransceivers().find(S=>S.sender.track===E||S.receiver.track===E)}(this.peerConnection,t._mediaStreamTrack),c=PX(t);if(gJ(t)&&s&&r&&c&&this.getLocalVideoStats&&Y(i=["vp8","vp9"]).call(i,this.store.codec)){var l;let _=o.degradationPreference||(Y(l=t._hints).call(l,Ye.CUSTOM_TRACK)?w("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(E,S,T,y,I,O){if(vp(E,T),I(S),y!=="balanced"&&y!=="maintain-framerate"&&y!=="maintain-resolution")return;let b=-1;VV(E,S);let k=window.setInterval(()=>{let j=d_.get(E);if(!w("ENABLE_AG_ADAPTATION")||!j)return vp(E,T),void I(S);let G=O();if(G.sendPackets>0&&G.OutgoingAvailableBandwidth>0){if(b===-1)return void(b=Date.now());if(Date.now()-b<1e3)return;let ce=G.sendFrameRate,pe=G.OutgoingAvailableBandwidth,[Ae,Ge]=EJ(E,ce,pe,j.adaptationConfig,S,y);Ge&&(T.qualityLimitationReason=Ge),Ae&&j.adaptationConfig.scale!==Ae.scale&&(f.debug("[".concat(E,"] applyAdaptation: ").concat(T.qualityLimitationReason,`
           sendFps `).concat(ce,", bwe ").concat(pe,", switch from ").concat(j.adaptationConfig.scale," to ").concat(Ae.scale," ")),j.adaptationConfig=Yg(Yg({},j.adaptationConfig),Ae),I(Ae))}},w("CHECK_LOCAL_STATS_INTERVAL")),P=Yg({},S);d_.set(E,{timer:k,adaptationConfig:P,originConfig:S,adaptationFunc:I}),f.debug("[".concat(E,"] start adaptation, originConfig: ").concat(JSON.stringify(S),", degradationPreference: ").concat(y))})(this.id+s.mid,c,this,_,E=>{r&&this.updateAdaptation(r,E)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var d;let{bitrateMax:_,frameRate:E,scaleResolutionDownBy:S}=t._encoderConfig;_&&(a.maxBitrate=1e3*_),(Y(d=t._hints).call(d,Ye.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(E&&(a.maxFramerate=ri(E)),S&&S>=1&&(a.scaleResolutionDownBy=S))}let{maxFramerate:u}=w("ENCODER_CONFIG_LIMIT");if(u&&typeof u=="number"&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,u):u),w("DSCP_TYPE")&&Ga()){var h;let _=w("DSCP_TYPE");Y(h=["very-low","low","medium","high"]).call(h,_)&&(a.networkPriority=_)}let p=r.getParameters(),g=(n=p.encodings)===null||n===void 0?void 0:n[0];ot()&&!g&&(o.encodings=[a]),g&&Object.assign(g,a),Object.assign(p,o),f.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await r.setParameters(p),await async function(_,E,S){try{var T;if(!ye().supportSetRtpSenderParameters||!function(k){return k==="vp9"}(_)||!w("ENABLE_SVC"))return;let y={},I={},O=E.getParameters(),b=(T=O.encodings)===null||T===void 0?void 0:T[0];I.scalabilityMode=Sv(S),b&&Object.assign(b,I),Object.assign(O,y),await E.setParameters(O),f.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(O.encodings)))}catch(y){f.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",y)}}(this.store.codec,r,w("SVC_MODE"))}async updateAdaptation(t,r){var i,n;if(!t)return f.debug("[updateAdaptation] no rtpSender found");if(!ye().supportSetRtpSenderParameters)return f.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let o={},{bitrateMax:a,frameRate:s,scaleResolutionDownBy:c}=r;a&&(o.maxBitrate=1e3*a),s&&(o.maxFramerate=ri(s)),c&&c>=1&&Y(i=["vp8","vp9"]).call(i,this.store.codec)&&(o.scaleResolutionDownBy=c);let l=t.getParameters(),d=(n=l.encodings)===null||n===void 0?void 0:n[0];d&&Object.assign(d,o),Object.assign(l,{});try{await t.setParameters(l),f.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(l.encodings)))}catch(u){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?f.debug("[updateAdaptation] peerConnection not connected}"):f.debug("[updateAdaptation] updateRtpSenderEncodings failed",u):f.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!ye().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let n=t[i],o=r[i];o instanceof We&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,n.sender)}}catch{f.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,i){let n=Ht.parse(t);return r.forEach((o,a)=>{let s=i[a],c=n.mediaDescriptions.find(l=>l.attributes.mid===s);c&&(yl(c,o),TV(c,o,this.store.codec))}),Ht.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let c=0;c<t.length;c++){var i,n,o,a,s;let l=t[c],d=r[c];if(d instanceof We&&!Y(i=d._hints).call(i,Ye.LOW_STREAM)&&(n=d._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((o=d._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=d._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((s=d._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1&&this.store.codec==="vp8"){let u={},h={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}];let p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,u))}}}async applySimulcastEncodings(t,r){if(!ot()&&t.length===r.length)for(let i=0;i<t.length;i++){let n=r[i];if(n instanceof We&&this.isVP8Simulcast(n)){let o=t[i],a={},s={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];let c=o.sender.getParameters();await o.sender.setParameters(Object.assign(c,a))}}}isVP8Simulcast(t){var r,i,n,o,a;return!!(t instanceof We&&w("SIMULCAST")&&this.store.codec==="vp8"&&!Y(r=t._hints).call(r,Ye.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((n=t._encoderConfig)===null||n===void 0?void 0:n.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,r,i,n){if(w("SDP_LOGGING"))return f.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(r," SDP during P2PConnection.").concat(n,`
`),t),r==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",n)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(ye().supportPCSetConfiguration){let r=Nd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},X(ge.prototype,"updateRemoteRTPCapabilities",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"updateRemoteRTPCapabilities"),ge.prototype),X(ge.prototype,"connect",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"connect"),ge.prototype),X(ge.prototype,"updateRemoteConnect",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"updateRemoteConnect"),ge.prototype),X(ge.prototype,"createDataChannels",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"createDataChannels"),ge.prototype),X(ge.prototype,"receive",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"receive"),ge.prototype),X(ge.prototype,"batchReceive",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"batchReceive"),ge.prototype),X(ge.prototype,"stopReceiving",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"stopReceiving"),ge.prototype),X(ge.prototype,"muteRemote",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"muteRemote"),ge.prototype),X(ge.prototype,"unmuteRemote",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"unmuteRemote"),ge.prototype),X(ge.prototype,"muteLocal",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"muteLocal"),ge.prototype),X(ge.prototype,"unmuteLocal",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"unmuteLocal"),ge.prototype),X(ge.prototype,"close",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"close"),ge.prototype),X(ge.prototype,"updateEncoderConfig",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"updateEncoderConfig"),ge.prototype),X(ge.prototype,"updateSendParameters",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"updateSendParameters"),ge.prototype),X(ge.prototype,"replaceTrack",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"replaceTrack"),ge.prototype),X(ge.prototype,"updateAdaptation",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"updateAdaptation"),ge.prototype),X(ge.prototype,"getRemoteSSRC",[Pr],Object.getOwnPropertyDescriptor(ge.prototype,"getRemoteSSRC"),ge.prototype),ge);function Pr(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let n=this.mutex,o=await n.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await i.apply(this,s)}finally{o()}},r}var he;function lD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function qn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function dD(e){var t,r,i,n=2;for(typeof Symbol<"u"&&(r=_J,i=Symbol.iterator);n--;){if(r&&(t=e[r])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new ff(t.call(e));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function ff(e){function t(r){if(Object(r)!==r)return K.reject(new TypeError(r+" is not an object."));var i=r.done;return K.resolve(r.value).then(function(n){return{value:n,done:i}})}return ff=function(r){this.s=r,this.n=r.next},ff.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?K.resolve({value:r,done:!0}):t(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?K.reject(r):t(i.apply(this.s,arguments))}},new ff(e)}var yp=(he=class extends tt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(ie.StateChange,t,this._state)}constructor(e,t){super(),v(this,"isPlanB",void 0),v(this,"store",void 0),v(this,"statsUploader",void 0),v(this,"connection",void 0),v(this,"localTrackMap",new Map),v(this,"remoteUserMap",new Map),v(this,"localDataChannels",[]),v(this,"remoteDataChannelMap",new Map),v(this,"pendingLocalTracks",[]),v(this,"pendingRemoteTracks",[]),v(this,"pendingLocalDataChannels",[]),v(this,"pendingRemoteDataChannels",[]),v(this,"statsCollector",void 0),v(this,"shouldForwardP2PCreation",void 0),v(this,"iceFailedCount",0),v(this,"dtlsFailedCount",0),v(this,"mutex",new cr("P2PChannel-mutex")),v(this,"_state",Oe.Disconnected),v(this,"_pcStatsUploadType",w("NEW_ICE_RESTART")?So.FIRST_CONNECTION:So.OLD_FIRST_CONNECTION),v(this,"_isInRestartIce",!1),v(this,"_isStartRestartIce",!1),v(this,"_restartStates",["disconnected","failed"]),v(this,"_restartTimer",void 0),v(this,"_isFirstConnected",!0),v(this,"handleMuteLocalTrack",async(r,i,n)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Oe.Connected)return void n(new M(R.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let a=this.filterTobeMutedTracks(r);if(a.length===0)return void i();let s=a.find(l=>l[0]==="videoLowTrack");s&&s[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(a.map(l=>{let[,{id:d}]=l;return d}));let c=this.createMuteMessage(a);await xe(this,ie.RequestMuteLocal,c),i()}catch(a){n(a)}finally{o()}}),v(this,"handleUnmuteLocalTrack",async(r,i,n)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Oe.Connected)return void n(new M(R.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let a=this.filterTobeUnmutedTracks(r);if(a.length===0)return void i();let s=a.find(l=>l[0]==="videoLowTrack");if(s){let l=s[1];if(l.track._originMediaStreamTrack.stop(),!w("DISABLE_DUAL_STREAM_USE_ENCODING")&&ye().supportDualStreamEncoding){let d=r._mediaStreamTrack.clone();l.track._mediaStreamTrack=d,l.track._originMediaStreamTrack=d}else{let d=Cv(r,Pu(this,ie.RequestLowStreamParameter));l.track._mediaStreamTrack=d,l.track._originMediaStreamTrack=d}await new K((d,u)=>{this.handleReplaceTrack(l.track,d,u,!0)})}await this.connection.unmuteLocal(a.map(l=>{let[,{id:d}]=l;return d}));let c=this.createUnmuteMessage(a);await xe(this,ie.RequestUnmuteLocal,c),i()}catch(a){n(a)}finally{o()}}),v(this,"handleUpdateVideoEncoder",async(r,i,n)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let a=this.localTrackMap.get(V.LocalVideoTrack);if(!this.connection||!a||a.track!==r||this.state!==Oe.Connected)return void i();let{id:s,track:c}=a;await this.connection.updateSendParameters(s,c),await this.connection.updateEncoderConfig(s,c),this.emit(ie.UpdateVideoEncoder,c),i()}catch(a){n(a)}finally{o()}}),v(this,"handleUpdateVideoSendParameters",async(r,i,n)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let a=this.localTrackMap.get(V.LocalVideoTrack);if(!this.connection||!a||a.track!==r||this.state!==Oe.Connected)return void i();let{id:s,track:c}=a;await this.connection.updateSendParameters(s,c),i()}catch(a){n(a)}finally{o()}}),v(this,"handleReplaceMixingTrack",async(r,i,n,o)=>{if(!this.connection||this.state!==Oe.Connected)return void i();let a=zg([r]),s;f.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(a.getTrackId(),"]")),typeof o=="boolean"&&o||(s=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,a),i()}catch(l){n(l)}finally{var c;(c=s)===null||c===void 0||c()}}),v(this,"handleReplaceTrack",async(r,i,n,o)=>{let a;f.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof o=="boolean"&&o||(a=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var s;let l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:u}]=d;return r===u});if(!this.connection||!l||this.state!==Oe.Connected)return void i();if(await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,l[1].id)),this.isPlanB){let d=l[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(l[0],d)}if(l[0]===V.LocalVideoTrack&&!w("DISABLE_DUAL_STREAM_USE_ENCODING")&&ye().supportDualStreamEncoding){let d=this.localTrackMap.get(V.LocalVideoLowTrack);if(d){let u=r._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=u,d.track._originMediaStreamTrack=u,await new K((h,p)=>{this.handleReplaceTrack(d.track,h,p,!0)})}}i()}catch(l){n(l)}finally{var c;(c=a)===null||c===void 0||c()}}),v(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),v(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),v(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),v(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),v(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new MV(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!ye().supportUnifiedPlan||w("CHROME_FORCE_PLAN_B")&&Ga(),this.shouldForwardP2PCreation=w("FORWARD_P2P_CREATION")&&ye().supportPCSetConfiguration&&fR(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new pd({},this.store):new Rn({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=Oe.New;let r=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(f.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new pd(e,this.store):new Rn(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=w("NEW_ICE_RESTART")?So.FIRST_CONNECTION:So.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");w("ENABLE_PREALLOC_PC")&&this.state===Oe.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Oe.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(n=>{var o;let[a]=n;return Y(o=[V.LocalVideoLowTrack,V.LocalVideoTrack]).call(o,a)}),r=t.map(n=>{let[,{id:o}]=n;return o}),i=t.map(n=>{let[o]=n;return o});if(this.connection instanceof Rn){if(Q.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Y(e).call(e,this.store.codec)){let n=["vp9","vp8","h264"].find(o=>Y(e).call(e,o));n&&(this.store.codec=n,f.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(n,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof Rn&&this.connection.peerConnectionState!=="closed"&&Y(e=[Oe.New,Oe.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Oe.Connected){if(this.state===Oe.Disconnected)throw new M(R.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var i;Y(i=this.pendingLocalDataChannels).call(i,r)||this.pendingLocalDataChannels.push(r)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{let i=Date.now();this.store.publish(r.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);let i=Date.now();this.store.publish(r.id+"","datachannel",void 0,i)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var i=this;return kn(function*(){let n=yield Ie(i.mutex.lock("From P2PChannel.publish"));try{if(!i.connection||i.state!==Oe.Connected){if(i.state===Oe.Disconnected)throw new M(R.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);let a=e.filter(s=>i.pendingLocalTracks.indexOf(s)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(a))}i.store.pubId=i.store.pubId+1,ar.markPublishStart(i.store.clientId,i.store.pubId);let o=i.filterTobePublishedTracks(e,t,r);if(o.length===0)return void(yield Ie(i.tryToUnmuteAudio(e)));yield*ZN(dD(i.doPublish(i.connection,o)))}finally{n()}})()}doPublish(e,t){var r=this;return kn(function*(){t.forEach(u=>{let{track:h,type:p}=u,g=Date.now();r.store.publish(h.getTrackId(),p===V.LocalAudioTrack?"audio":"video",g)}),r.bindLocalTrackEvents(t);let i=t.map(u=>{let{track:h}=u;return h}),n=yield Ie(e.send(t.map(u=>{let{track:h}=u;return h}),r.store.codec,r.store.audioCodec)),o=(yield Ie(n.next())).value,a=r.createGatewayPublishMessage(t,o),s;try{s=yield a}catch(u){throw n.throw(u),(u==null?void 0:u.code)===R.WS_ABORT&&t.forEach(h=>{let{track:p}=h;r.pendingLocalTracks.indexOf(p)===-1&&r.pendingLocalTracks.push(p)}),r.unbindLocalTrackEvents(t),u}let c=r.mapPubResToRemoteConfig(a,s),l=(yield Ie(n.next(c))).value,d=w("ENABLE_VIDEO_SEI");i.forEach(async u=>{let h=u.getRTCRtpTransceiver();h&&d&&(u.trackMediaType===Z.VIDEO?await VX(h.sender,u):u.trackMediaType===Z.AUDIO&&await async function(p){if(!ye().supportWebRTCEncodedTransform)return void f.warning("browser not support audio encoded transform");if(pp.has(p)||!p.track)return;let g={track:p.track};if(La()){if(!p.createEncodedStreams)return void f.warning("browser not support createEncodedStreams() API");let E=null;try{E=p.createEncodedStreams()}catch(T){return void f.error("create audio-encoded-streams error",T&&T.message)}let S=new TransformStream({transform(T,y){g.controller||(g.controller=y),p.track&&p.track.id!==g.track.id&&(f.debug("audio track changed: ".concat(g.track.id," => ").concat(p.track.id)),g.track.removeEventListener("ended",_),g.track=p.track,g.track.addEventListener("ended",_)),y.enqueue(T)}});E.readable.pipeThrough(S).pipeTo(E.writable)}else if(er()){if(typeof RTCRtpScriptTransform>"u")return void f.warning("browser not support RTCRtpScriptTransform");let E=uf(),S=new MessageChannel;await new K(y=>E.onmessage=I=>{I.data==="registered"&&y(void 0)});let T=new RTCRtpScriptTransform(E,{name:"tx",port:S.port2},[S.port2]);p.transform=T,await new K(y=>E.onmessage=I=>{I.data==="started"&&y(void 0)}),S.port1.onmessage=y=>{var I;y.data.transformed&&p.track&&((I=p.track)===null||I===void 0?void 0:I.id)!==g.track.id&&(f.debug("audio track changed: ".concat(g.track.id," => ").concat(p.track.id)),g.track.removeEventListener("ended",_),g.track=p.track,g.track.addEventListener("ended",_))},g.worker=E}function _(){if(p.track){if(this.id!==p.track.id)return;p.track.removeEventListener("ended",_)}let E=pp.get(p);if(E){pp.delete(p);try{var S,T;(S=E.controller)===null||S===void 0||S.terminate(),(T=E.worker)===null||T===void 0||T.terminate()}catch(y){f.warning(y&&y.message)}}}pp.set(p,g),p.track.addEventListener("ended",_)}(h.sender))}),t.forEach(u=>{let{type:h}=u;r.statsCollector.addLocalStats(h)}),r.assignLocalTracks(t,l),r.statsUploader.startUploadOutboundStats(),t.forEach(u=>{let{track:h,type:p}=u,g=Date.now();r.store.publish(h.getTrackId(),p===V.LocalAudioTrack?"audio":"video",void 0,g)})})()}async updateVideoStreamParameter(e,t){let r=this.localTrackMap.get(t);if(!r)return;if(!(r.track instanceof We))return f.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Rn||this.connection instanceof pd))return f.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:i}=r,n=function(o,a){let s={};return o.height&&o.width&&(s.scaleResolutionDownBy=dv(o,a)),s.maxFramerate=o.framerate?ri(o.framerate):void 0,s.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,s}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==V.LocalVideoLowTrack||!w("DISABLE_DUAL_STREAM_USE_ENCODING")&&ye().supportDualStreamEncoding)n.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=n.scaleResolutionDownBy);else{let o=i._originMediaStreamTrack;if(!o.canvas)return f.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(a,s){let c=a.canvas;s.width&&(c.width=ri(s.width)),s.height&&(c.height=ri(s.height)),s.framerate&&(c.stopCapture&&c.stopCapture(),c.stopCapture=AR(()=>{!c.startCapture&&c.stopCapture&&c.stopCapture(),c.startCapture&&c.startCapture()},ri(s.framerate)))})(o,e)}n.maxBitrate!=null&&(i._encoderConfig.bitrateMax=n.maxBitrate/1e3),n.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=n.maxFramerate:i._encoderConfig.frameRate={max:n.maxFramerate}),f.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return kn(function*(){if(!t.connection||t.state!==Oe.Connected)return;let r=yield Ie(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let n=t.localTrackMap.get(V.LocalVideoTrack);if(!n)throw new M(R.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(V.LocalVideoLowTrack))throw new M(R.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let o=[{track:t.getLowVideoTrack(n.track,e),type:V.LocalVideoLowTrack}];if(yield*ZN(dD(t.doPublish(t.connection,o))),n.track.muted||!n.track.enabled){var i;let a=(i=t.localTrackMap.get(V.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;a!==void 0&&(yield Ie(t.connection.muteLocal([a])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(f.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await tr(this,ie.RequestRePublish,this.pendingLocalTracks),this.emit(ie.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(f.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await tr(this,ie.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:r,kind:i}=this.pendingRemoteTracks[t];(i!==Z.AUDIO||r._audio_added_&&r._audioSSRC)&&(i!==Z.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await tr(this,ie.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===Z.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(ie.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Oe.Connected)return void e.forEach(i=>{let n=this.pendingLocalTracks.indexOf(i);n!==-1&&this.pendingLocalTracks.splice(n,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(i=>i[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Oe.Connected)return void e.forEach(r=>{let i=this.pendingLocalDataChannels.indexOf(r);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{let i=this.localDataChannels.indexOf(r);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Oe.Connected)return;let e=this.localTrackMap.get(V.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[V.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:n}]=i;return n})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[n,{track:o}]=i;return{type:n,track:o}})),t.forEach(i=>{let[n]=i;this.statsCollector.removeLocalStats(n)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Oe.Connected)throw new M(R.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r=t.filter(i=>{var n;return!((n=this.remoteDataChannelMap.get(e))!==null&&n!==void 0&&n.get(i.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(i=>{var n;this.remoteDataChannelMap.has(e)?(n=this.remoteDataChannelMap.get(e))===null||n===void 0||n.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));let o=this.pendingRemoteDataChannels.findIndex(a=>{let{user:s,id:c}=a;return s.uid===e.uid&&c===i.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),r.map(i=>i.id)}async subscribe(e,t,r,i,n){var o;if(!this.connection||this.state!==Oe.Connected)throw new M(R.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;let a,s,c,l=this.connection.getPreMedia(r);if(l)f.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),c=l.transceiver,a=l.track,s=l.id;else if(n){let h=n.find(g=>{let{stream_type:_}=g;return _===t});if(!h)throw new M(R.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let p=await this.connection.receive(t,h.ssrcs,String(e._uintid),h.attributes);this.connection instanceof Rn&&(c=p.transceiver),a=p.track,s=p.id}else{let h=await this.connection.receive(t,[{ssrcId:r,rtx:i}],String(e._uintid),void 0);this.connection instanceof Rn&&(c=h.transceiver),a=h.track,s=h.id}t===Z.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new il(a,e.uid,e._uintid,this.store),f.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new rl(a,e.uid,e._uintid,this.store),f.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),w("ENABLE_VIDEO_SEI")&&c&&(t==Z.VIDEO?await async function(h){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ye().supportWebRTCEncodedTransform)return void f.warning("browser not support video encoded transform");if(!h.track)return;if(hd.has(h)){let E=hd.get(h);return void(E&&(E.onSei=p.onSei))}let g={track:h.track,onSei:p.onSei};if(La()){if(!h.createEncodedStreams)return void f.warning("browser not support createEncodedStreams() API");let E=null;try{E=h.createEncodedStreams()}catch(T){return void f.error("create video-encoded-streams error",T&&T.message)}let S=new TransformStream({transform(T,y){g.controller||(g.controller=y),h.track&&h.track.id!==g.track.id&&(f.debug("video track changed: ".concat(g.track.id," => ").concat(h.track.id)),g.track.removeEventListener("ended",_),g.track=h.track,g.track.addEventListener("ended",_));let I=function(O){let b=new DataView(O.data),k=0;for(;k+4<O.data.byteLength;){if(b.getUint8(k+0)===0&&b.getUint8(k+1)===0&&b.getUint8(k+2)===0&&b.getUint8(k+3)===1&&b.getUint8(k+4)===6){let P=k+6,j=0,G=0;for(;(G=b.getUint8(P++))===255;)j+=255;j+=G;let ce=xX(O.data,P,j);return new Uint8Array(ce)}k++}return null}(T);I&&g.onSei&&g.onSei(I),y.enqueue(T)}});E.readable.pipeThrough(S).pipeTo(E.writable)}else if(er()){if(typeof RTCRtpScriptTransform>"u")return void f.warning("browser not support RTCRtpScriptTransform");let E=uf(),S=new MessageChannel;await new K(y=>E.onmessage=I=>{I.data==="registered"&&y(void 0)});let T=new RTCRtpScriptTransform(E,{name:"rx",port:S.port2},[S.port2]);h.transform=T,await new K(y=>E.onmessage=I=>{I.data==="started"&&y(void 0)}),S.port1.onmessage=y=>{var I;y.data.transformed&&h.track&&((I=h.track)===null||I===void 0?void 0:I.id)!==g.track.id?(f.debug("video track changed: ".concat(g.track.id," => ").concat(h.track.id)),g.track.removeEventListener("ended",_),g.track=h.track,g.track.addEventListener("ended",_)):y.data.sei&&g.onSei&&g.onSei(y.data.sei)},g.worker=E}function _(){if(h.track){if(this.id!==h.track.id)return;h.track.removeEventListener("ended",_)}(function(E){let S=hd.get(E);if(S){hd.delete(E);try{var T,y;(T=S.controller)===null||T===void 0||T.terminate(),(y=S.worker)===null||y===void 0||y.terminate()}catch(I){f.warning(I&&I.message)}}})(h)}hd.set(h,g),h.track.addEventListener("ended",_)}(c.receiver,{onSei:h=>{var p;(p=e._videoTrack)===null||p===void 0||p._onSei(h)}}):t==Z.AUDIO&&await async function(h){if(!ye().supportWebRTCEncodedTransform)return void f.warning("browser not support audio encoded transform");if(fp.has(h))return;let p={track:h.track};if(La()){if(!h.createEncodedStreams)return void f.warning("browser not support createEncodedStreams() API");let _=null;try{_=h.createEncodedStreams()}catch(S){return void f.error("create audio-encoded-streams error",S&&S.message)}let E=new TransformStream({transform(S,T){p.controller||(p.controller=T),h.track&&h.track.id!==p.track.id&&(f.debug("audio track changed: ".concat(p.track.id," => ").concat(h.track.id)),p.track.removeEventListener("ended",g),p.track=h.track,p.track.addEventListener("ended",g)),T.enqueue(S)}});_.readable.pipeThrough(E).pipeTo(_.writable)}else if(er()){if(typeof RTCRtpScriptTransform>"u")return void f.warning("browser not support RTCRtpScriptTransform");let _=uf(),E=new MessageChannel;await new K(T=>_.onmessage=y=>{y.data==="registered"&&T(void 0)});let S=new RTCRtpScriptTransform(_,{name:"rx",port:E.port2},[E.port2]);h.transform=S,await new K(T=>_.onmessage=y=>{y.data==="started"&&T(void 0)}),E.port1.onmessage=T=>{var y;T.data.transformed&&h.track&&((y=h.track)===null||y===void 0?void 0:y.id)!==p.track.id&&(f.debug("audio track changed: ".concat(p.track.id," => ").concat(h.track.id)),p.track.removeEventListener("ended",g),p.track=h.track,p.track.addEventListener("ended",g))},p.worker=_}function g(){h.track.removeEventListener("ended",g),function(_){let E=fp.get(_);if(E){fp.delete(_);try{var S,T;(S=E.controller)===null||S===void 0||S.terminate(),(T=E.worker)===null||T===void 0||T.terminate()}catch(y){f.warning(y&&y.message)}}}(h)}fp.set(h,p),h.track.addEventListener("ended",g)}(c.receiver));let d=this.remoteUserMap.get(e);d?d.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let u=this.pendingRemoteTracks.findIndex(h=>{let{user:p,kind:g}=h;return p.uid===e.uid&&t===g});u!==-1&&(this.pendingRemoteTracks.splice(u,1),this.emit(ie.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Oe.Connected)throw new M(R.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var o;let{user:a,mediaType:s}=n;return!((o=this.remoteUserMap.get(a))!==null&&o!==void 0&&o.has(s))});let t=[],r=new Map;e.forEach(n=>{if(!this.connection)return;let o=this.connection.getPreMedia(n.ssrcId);o?r.set(n.ssrcId,o):t.push(n)});let i=await this.connection.batchReceive(t.map(n=>{let{user:o,mediaType:a,ssrcId:s,rtxSsrcId:c}=n;return{kind:a,ssrcMsg:[{ssrcId:s,rtx:c}],mslabel:String(o._uintid)}}));t.forEach((n,o)=>{r.set(n.ssrcId,i[o])}),e.forEach(n=>{let{user:o,mediaType:a,ssrcId:s}=n,c=r.get(s);if(!c)return void f.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(a,", ").concat(s));let{track:l,id:d,transceiver:u}=c;a===Z.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(l):(o._audioTrack=new il(l,o.uid,o._uintid,this.store),f.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),u&&o._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(l):(o._videoTrack=new rl(l,o.uid,o._uintid,this.store),f.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),u&&o._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(o,o._videoTrack));let h=this.remoteUserMap.get(o);h?h.set(a,d):this.remoteUserMap.set(o,new Map([[a,d]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();let p=this.pendingRemoteTracks.findIndex(g=>{let{user:_,kind:E}=g;return _.uid===o.uid&&a===E});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(ie.MediaReconnectEnd,o.uid))})}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(a=>{let{user:s,kind:c}=a;return t!==void 0?s.uid===e.uid&&t===c:s.uid===e.uid});if(i.forEach(a=>{let s=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(s,1)}),this.connection&&this.state===Oe.Connected||r||i.forEach(a=>{let{kind:s}=a;var c;if(s===Z.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(s===Z.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Oe.Connected)return;let n=this.filterTobeUnSubscribedTracks(e,t);if(n.length===0)return;await this.connection.stopReceiving(n.map(a=>{let[,{id:s}]=a;return s}));let o=this.createUnsubscribeMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(a=>{let[s,{kind:c}]=a;var l,d;if(c===Z.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===Z.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),r||((d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0);else if(c===Z.AUDIO){var u;this.unbindRemoteTrackEvents(s._audioTrack),!r&&((u=s._audioTrack)===null||u===void 0||u._destroy(),s._audioTrack=void 0)}}),o}async unsubscribeDataChannel(e,t){if(t.forEach(n=>{let o=this.pendingRemoteDataChannels.findIndex(a=>a.id===n.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;let r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(n=>{n._close()});let i=this.remoteDataChannelMap.get(e);return r.forEach(n=>{i&&i.delete(n.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(n=>n.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:n,mediaType:o}of e){let a=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return o!==void 0?c.uid===n.uid&&o===l:c.uid===n.uid});a.forEach(s=>{let c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),t=t.concat(a)}if(!this.connection||this.state!==Oe.Connected)return void t.forEach(n=>{let{user:o,kind:a}=n;var s;if(a===Z.AUDIO)(s=o._audioTrack)===null||s===void 0||s._destroy(),o._audioTrack=void 0;else if(a===Z.VIDEO){var c;(c=o._videoTrack)===null||c===void 0||c._destroy(),o._videoTrack=void 0}});let r=xn(e).call(e,(n,o)=>{let{user:a,mediaType:s}=o,c=this.filterTobeUnSubscribedTracks(a,s);return n.concat(c)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(n=>{let[,{id:o}]=n;return o}));let i=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(n=>{let[o,{kind:a}]=n;var s,c;if(a===Z.VIDEO&&o._videoSSRC&&((s=this.connection)===null||s===void 0||s.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===Z.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(c=o._videoTrack)===null||c===void 0||c._destroy(),o._videoTrack=void 0;else if(a===Z.AUDIO){var l;this.unbindRemoteTrackEvents(o._audioTrack),(l=o._audioTrack)===null||l===void 0||l._destroy(),o._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==Oe.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void f.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void f.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===Z.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void f.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||f.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(V.LocalAudioTrack);if((t==null?void 0:t.track)instanceof kt){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[n]=i;return n!==V.LocalAudioTrack}).filter(i=>{let[n]=i;return!(e&&n===V.LocalVideoLowTrack)}).map(i=>{let[,{track:n}]=i;return n}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return!(e&&i===V.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,i,n){if(e){let a=this.localTrackMap.get(V.LocalAudioTrack),s=i?this.localTrackMap.get(V.LocalVideoLowTrack):this.localTrackMap.get(V.LocalVideoTrack);Q.publish(this.store.sessionId,{eventElapse:ar.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:s==null?void 0:s.track.getTrackLabel(),screenshare:(s==null?void 0:s.track._hints.indexOf(Ye.SCREEN_TRACK))!==-1,audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var o;r||(r=[]);let a=r.find(c=>c instanceof it),s=i?(o=this.localTrackMap.get(V.LocalVideoTrack))===null||o===void 0?void 0:o.track:r.find(c=>c instanceof We);Q.publish(this.store.sessionId,{eventElapse:ar.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:s==null?void 0:s.getTrackLabel(),screenshare:(s==null?void 0:s._hints.indexOf(Ye.SCREEN_TRACK))!==-1,audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,r,i){let n=i===Z.VIDEO?r._videoSSRC:r._audioSSRC;n&&Q.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Z.VIDEO,audio:i===Z.AUDIO,peerid:r.uid,subscribeRequestid:n,p2pid:this.store.p2pId,eventElapse:ar.measureFromSubscribeStart(this.store.clientId,n),preSsrc:this.isPreSubScribe(n)})}reset(){f.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new cr("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new pd({},this.store):new Rn({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(V.LocalAudioTrack);if((e==null?void 0:e.track)instanceof kt){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Oe.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(V.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(V.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof We||t&&t.track instanceof it?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(ui(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[i]=r;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(V.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=lh(e).call(e,(r,i)=>r.level-i.level),e}async disconnectForReconnect(){this.connection&&(f.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Oe.Reconnecting,w("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new pd({},this.store):new Rn({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:i}]=e;switch(r){case V.LocalVideoTrack:Y(t=i._hints).call(t,Ye.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case V.LocalAudioTrack:i instanceof kt?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case V.LocalVideoLowTrack:}}),this.emit(ie.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ui(r).call(r)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(ie.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ui(r).call(r)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),f.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let r of this.pendingRemoteDataChannels){let{user:i,id:n}=r;if((e instanceof pa?e.uid:e)===i.uid&&n===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:n}=r;if((e instanceof pa?e.uid:e)===i.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return kn(function*(){if(!t.connection||t.state!==Oe.Connected)return;let r=yield Ie(t.mutex.lock("From P2PChannel.restartICE")),i;try{i=yield Ie(t.connection.restartICE(e));let o=yield Ie(i.next());if(o.done)return;let a=o.value,s=yield a;switch(t.reportPCDisconnectedOrFailed(e),e){case ti.TCP:t._pcStatsUploadType=So.TCP_RESTART;break;case ti.RELAY:t._pcStatsUploadType=So.RELAY_RESTART;break;default:t._pcStatsUploadType=So.OLD_RESTART}t._isInRestartIce=!0,i.next(s)}catch(o){var n;(n=i)===null||n===void 0||n.throw(o)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(V.LocalVideoTrack),r=this.localTrackMap.get(V.LocalAudioTrack),i=e.videoSend.find(p=>p.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),n=e.audioSend.find(p=>p.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!i||!n)return 1;let o=Mi(this,ie.NeedSignalRTT),a=i?i.rttMs:void 0,s=n?n.rttMs:void 0,c=a&&s?(a+s)/2:a||s,l=(c&&o?(c+o)/2:c||o)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=t==null?void 0:t.track;if(h&&h._encoderConfig&&h._hints.indexOf(Ye.SCREEN_TRACK)===-1){let p=h._encoderConfig.bitrateMax,g=e.bitrate.actualEncoded;if(p&&g){let _=(1e3*p-g)/(1e3*p);return bx[_<.15?0:_<.3?1:_<.45?2:_<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,n=i._audioSSRC,o=i._videoSSRC,a=e.audioRecv.find(g=>g.ssrc===n),s=e.videoRecv.find(g=>g.ssrc===o);if(!a&&!s)return void(t+=1);let c=Mi(this,ie.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new K((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(f.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Oe.Connected)return;let i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(!i)return;let n=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:n}]),this.bindLocalTrackEvents([{track:t,type:n}]),i[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,i[1].id)),this.isPlanB){let o=i[1];o.id=t._mediaStreamTrack.id,this.localTrackMap.set(n,o)}if(n===V.LocalVideoTrack&&!w("DISABLE_DUAL_STREAM_USE_ENCODING")&&ye().supportDualStreamEncoding){let o=this.localTrackMap.get(V.LocalVideoLowTrack);if(o){let a=e._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=a,o.track._originMediaStreamTrack=a,await new K((s,c)=>{this.handleReplaceTrack(o.track,s,c,!0)})}}}filterTobePublishedTracks(e,t,r){let i=[],n=this.getAllTracks();e=Bc(e=e.filter(c=>n.indexOf(c)===-1));let o,a=!1,s=this.localTrackMap.get(V.LocalAudioTrack);for(let c of e){if(c instanceof We&&(this.localTrackMap.has(V.LocalVideoTrack)||a?new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:c,type:V.LocalVideoTrack}),a=!0),t)){let l=this.getLowVideoTrack(c,r);i.push({track:l,type:V.LocalVideoLowTrack})}if(c instanceof it)if(s){let l=s.track;if(l instanceof kt)Iv([c]),l.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{let d=zg([l,c]);f.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),this.replaceTrack(l,d)}}else o instanceof kt?(Iv([c]),o.addAudioTrack(c)):o||!c._useAudioElement&&ye().webAudioMediaStreamDest&&!c._bypassWebAudio?o=zg(o?[c,o]:[c]):o=c}return o&&(f.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),i.push({track:o,type:V.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=Bc(e=e.filter(i=>r.indexOf(i)!==-1));for(let i of e){if(i instanceof it){let n=this.localTrackMap.get(V.LocalAudioTrack);if(!n)continue;n.track instanceof kt?(n.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),n.track.trackList.length===0&&(t.push([V.LocalAudioTrack,n]),n.track.close())):t.push([V.LocalAudioTrack,n])}if(i instanceof We){let n=this.localTrackMap.get(V.LocalVideoTrack);if(!n)continue;t.push([V.LocalVideoTrack,n]);let o=this.localTrackMap.get(V.LocalVideoLowTrack);o&&t.push([V.LocalVideoLowTrack,o])}}return t}filterTobePublishedDataChannels(e){return e=(e=Bc(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Bc(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:i}=t;switch(i){case V.LocalVideoTrack:r.addListener($.GET_STATS,this.handleGetLocalVideoStats),r.addListener($.GET_RTC_STATS,this.handleGetRTCStats),r.addListener($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener($.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener($.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener($.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case V.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case V.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof kt?e.trackList.forEach(r=>{r.addListener($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener($.GET_STATS,this.handleGetLocalAudioStats),r.addListener($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener($.GET_STATS,this.handleGetLocalAudioStats),e.addListener($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener($.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener($.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:i}]=t;return{track:i,type:r}})),e.forEach(t=>{let{track:r,type:i}=t;switch(i){case V.LocalVideoTrack:r.off($.GET_STATS,this.handleGetLocalVideoStats),r.off($.GET_RTC_STATS,this.handleGetRTCStats),r.off($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off($.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off($.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off($.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case V.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case V.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof kt?e.trackList.forEach(t=>{t.off($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off($.GET_STATS,this.handleGetLocalAudioStats),t.off($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off($.GET_STATS,this.handleGetLocalAudioStats),e.off($.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off($.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off($.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off($.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off($.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off($.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof rl&&t.addListener($.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof il&&t.addListener($.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners($.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Z.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Z.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,i)=>{var n;let o,a,{track:s,type:c}=r;switch(c){case V.LocalAudioTrack:o=be.Audio,a={dtx:s instanceof o_&&s._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case V.LocalVideoTrack:o=Y(n=s._hints).call(n,Ye.SCREEN_TRACK)?be.Screen:be.High,a=qn(qn({},a0(s)),{},{codec:this.store.codec,svc_mode:Sv()});break;case V.LocalVideoLowTrack:o=be.Low,a=qn(qn({},a0(s)),{},{codec:this.store.codec,svc_mode:Sv()})}return{stream_type:o,attributes:a,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let i,[n,{track:o,ssrcs:a,id:s}]=t;switch(n){case V.LocalVideoTrack:i=Y(r=o._hints).call(r,Ye.SCREEN_TRACK)?be.Screen:be.High;break;case V.LocalAudioTrack:i=be.Audio;break;case V.LocalVideoLowTrack:i=be.Low}return{stream_type:i,ssrcs:a,mid:s}})}assignLocalTracks(e,t){e.forEach((r,i)=>{let{track:n,type:o}=r;this.localTrackMap.set(o,{track:n,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(ie.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),w("NEW_ICE_RESTART")){var r;if(Y(r=this._restartStates).call(r,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let i=a=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(f.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(a)),Mi(this,ie.QueryClientConnectionState)==="CONNECTED"&&this.emit(ie.RequestRestartICE,a))},n=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),f.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(ie.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o=w("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(w("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ye().supportPCSetConfiguration)i(ti.RELAY),this._restartTimer=window.setTimeout(n,o);else if(ot())i(ti.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(i(ti.TCP),ye().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{i(ti.RELAY),this._restartTimer=window.setTimeout(n,o)},o));this._restartTimer=window.setTimeout(n,o)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&w("ICE_RESTART")&&Mi(this,ie.QueryClientConnectionState)==="CONNECTED"&&this.emit(ie.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(f.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(ie.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(f.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(ie.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Q.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:nt.TRACER}).onSuccess(),this.emit(ie.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let i=Array.from(ui(r=this.remoteUserMap).call(r)).find(o=>o._audioSSRC===t);var n;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(n=i.audioTrack)===null||n===void 0||n.emit(tl.FIRST_FRAME_DECODED),Q.firstRemoteFrame(this.store.sessionId,Bt.FIRST_AUDIO_DECODE,Ze.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ar.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let i=Array.from(ui(r=this.remoteUserMap).call(r)).find(n=>n._audioSSRC===t);i&&Q.firstRemoteFrame(this.store.sessionId,Bt.FIRST_AUDIO_RECEIVED,Ze.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ar.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,i)=>{this.reportVideoFirstFrameDecoded(t,r,i)},e.onFirstVideoReceived=t=>{var r;let i=Array.from(ui(r=this.remoteUserMap).call(r)).find(n=>n._videoSSRC===t);i&&Q.firstRemoteFrame(this.store.sessionId,Bt.FIRST_VIDEO_RECEIVED,Ze.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ar.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let i=t.candidateType==="relay",n=r.candidateType==="relay";r.candidateType!=="unknown"&&i===n||this.emit(ie.ConnectionTypeChange,i),f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(va(r))," -> ").concat(JSON.stringify(va(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{f.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(va(r))," -> ").concat(JSON.stringify(va(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return qn(qn({},t),r)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(V.LocalAudioTrack);if(e instanceof it&&(r==null?void 0:r.track)instanceof kt)return r.track.isActive||t.push([V.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:o}]=n;return e===o});if(i&&(t.push(i),i[0]===V.LocalVideoTrack)){let n=this.localTrackMap.get(V.LocalVideoLowTrack);n&&t.push([V.LocalVideoLowTrack,n])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(V.LocalAudioTrack);if(e instanceof it&&(r==null?void 0:r.track)instanceof kt)return r.track.isActive&&t.push([V.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:o}]=n;return e===o});if(i)if(i[0]===V.LocalVideoTrack){t.push(i);let n=this.localTrackMap.get(V.LocalVideoLowTrack);n&&t.push([V.LocalVideoLowTrack,n])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var r;let i,[n,{track:o,ssrcs:a,id:s}]=t;switch(n){case V.LocalAudioTrack:i=be.Audio;break;case V.LocalVideoTrack:i=Y(r=o._hints).call(r,Ye.SCREEN_TRACK)?be.Screen:be.High;break;case V.LocalVideoLowTrack:i=be.Low}return{stream_type:i,ssrcs:a,mid:s}})}createUnmuteMessage(e){return e.map(t=>{var r;let i,[n,{track:o,ssrcs:a,id:s}]=t;switch(n){case V.LocalAudioTrack:i=be.Audio;break;case V.LocalVideoTrack:i=Y(r=o._hints).call(r,Ye.SCREEN_TRACK)?be.Screen:be.High;break;case V.LocalVideoLowTrack:i=be.Low}return{stream_type:i,ssrcs:a,mid:s}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let n=i.get(t);if(!n)return r;r.push([e,{kind:t,id:n}])}else Array.from(i.entries()).forEach(n=>{let[o,a]=n;r.push([e,{kind:o,id:a}])});return r}filterTobeUnSubscribedDataChannels(e,t){let r=[];return t.forEach(i=>{var n;(n=this.remoteDataChannelMap.get(e))!==null&&n!==void 0&&n.has(i.id)&&r.push(i)}),r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[i,{kind:n,id:o}]=r;switch(n){case Z.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Z.VIDEO,ssrcId:i._videoSSRC}));case Z.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Z.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(r=>{let[i,{kind:n}]=r;if(t.has(i)){let o=t.get(i);n===Z.VIDEO?o|=Pt.Video:o|=Pt.Audio,t.set(i,o)}else n===Z.VIDEO?t.set(i,Pt.Video):t.set(i,Pt.Audio)}),{users:Array.from(t.entries()).map(r=>{let[i,n]=r;return{stream_id:i.uid,stream_type:n}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:i}]=t,n=this.remoteUserMap.get(r);n&&(n.delete(i),Array.from(n.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(V.LocalVideoTrack),r=this.localTrackMap.get(V.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),r&&e.low_stream_uplink&&await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((r,i)=>{var n;let{stream_type:o}=r;return(n=t.find(a=>{let{stream_type:s}=a;return o===s}))===null||n===void 0?void 0:n.attributes})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof it){var t;let i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(o=>{let[,{id:a}]=o;return a})));let n=this.createUnmuteMessage(i);return void await xe(this,ie.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(ie.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(ie.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await zt(mR(this.dtlsFailedCount,Rt)),this.emit(ie.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await tr(this,ie.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(ie.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(V.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof We)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof We).length>1)throw new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof it).length>1&&(e.some(t=>t instanceof it&&t._bypassWebAudio)||!ye().webAudioMediaStreamDest))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof We&&this.pendingLocalTracks.some(r=>r instanceof We))throw new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof it&&this.pendingLocalTracks.some(r=>r instanceof it)&&(!ye().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof it&&r._bypassWebAudio)))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!w("DISABLE_DUAL_STREAM_USE_ENCODING")&&ye().supportDualStreamEncoding,i=qn(qn({},{width:160,height:120,framerate:15,bitrate:50}),t),n;n=r?e._mediaStreamTrack.clone():Cv(e,i);let o=Fe(8,"track-low-"),a=new We(n,qn(qn({},r&&{scaleResolutionDownBy:dv(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return a.on(Ns.TRANSCEIVER_UPDATED,s=>{e._updateRtpTransceiver(s,vl.LOW_STREAM)}),a._hints.push(Ye.LOW_STREAM),e.on("sei-to-send",s=>{a.emit("sei-to-send",s)}),e.addListener($.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Rn){var n,o,a,s;let c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();Q.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:d,connectionstate:u,intSucc:t?1:2,error:i,selectedLocalCandidateProtocol:(n=h==null?void 0:h.protocol)!==null&&n!==void 0?n:"",selectedLocalCandidateType:(o=h.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:(a=p.protocol)!==null&&a!==void 0?a:"",selectedRemoteCandidateType:(s=p.candidateType)!==null&&s!==void 0?s:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:r,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,t,r,i){var n;let o=Array.from(ui(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===e);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let a=this.store.keyMetrics,s=a.subscribe.find(c=>c.userId===o.uid&&c.type==="video");Q.firstRemoteVideoDecode(this.store.sessionId,Bt.FIRST_VIDEO_DECODE,Ze.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:r,subscribeElapse:ar.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(s==null?void 0:s.subscribeEnd)||0,subscriberStart:(s==null?void 0:s.subscribeStart)||0,videoAddNotify:(s==null?void 0:s.streamAdded)||0,state:i?1:0,firstFrame:(s==null?void 0:s.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let n=i.get(t);if(!n)return!1;let o=await this.connection.getRemoteSSRC(n);return o!==void 0&&o!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===V.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,vl.LOW_STREAM):r._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Rn&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===So.TCP_RESTART&&e===ti.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,So.DISCONNECTED_OR_FAILED)))}},X(he.prototype,"startP2PConnection",[_r],Object.getOwnPropertyDescriptor(he.prototype,"startP2PConnection"),he.prototype),X(he.prototype,"connect",[_r],Object.getOwnPropertyDescriptor(he.prototype,"connect"),he.prototype),X(he.prototype,"updateRemoteRTPCapabilities",[_r],Object.getOwnPropertyDescriptor(he.prototype,"updateRemoteRTPCapabilities"),he.prototype),X(he.prototype,"publishDataChannel",[_r],Object.getOwnPropertyDescriptor(he.prototype,"publishDataChannel"),he.prototype),X(he.prototype,"unpublish",[_r],Object.getOwnPropertyDescriptor(he.prototype,"unpublish"),he.prototype),X(he.prototype,"unpublishDataChannel",[_r],Object.getOwnPropertyDescriptor(he.prototype,"unpublishDataChannel"),he.prototype),X(he.prototype,"unpublishLowStream",[_r],Object.getOwnPropertyDescriptor(he.prototype,"unpublishLowStream"),he.prototype),X(he.prototype,"subscribeDataChannel",[_r],Object.getOwnPropertyDescriptor(he.prototype,"subscribeDataChannel"),he.prototype),X(he.prototype,"subscribe",[_r],Object.getOwnPropertyDescriptor(he.prototype,"subscribe"),he.prototype),X(he.prototype,"massSubscribe",[_r],Object.getOwnPropertyDescriptor(he.prototype,"massSubscribe"),he.prototype),X(he.prototype,"unsubscribe",[_r],Object.getOwnPropertyDescriptor(he.prototype,"unsubscribe"),he.prototype),X(he.prototype,"unsubscribeDataChannel",[_r],Object.getOwnPropertyDescriptor(he.prototype,"unsubscribeDataChannel"),he.prototype),X(he.prototype,"massUnsubscribe",[_r],Object.getOwnPropertyDescriptor(he.prototype,"massUnsubscribe"),he.prototype),X(he.prototype,"muteRemote",[_r],Object.getOwnPropertyDescriptor(he.prototype,"muteRemote"),he.prototype),X(he.prototype,"unmuteRemote",[_r],Object.getOwnPropertyDescriptor(he.prototype,"unmuteRemote"),he.prototype),X(he.prototype,"hasRemoteMediaWithLock",[_r],Object.getOwnPropertyDescriptor(he.prototype,"hasRemoteMediaWithLock"),he.prototype),X(he.prototype,"disconnectForReconnect",[_r],Object.getOwnPropertyDescriptor(he.prototype,"disconnectForReconnect"),he.prototype),X(he.prototype,"updateBitrateLimit",[_r],Object.getOwnPropertyDescriptor(he.prototype,"updateBitrateLimit"),he.prototype),X(he.prototype,"remoteMediaSsrcChanged",[_r],Object.getOwnPropertyDescriptor(he.prototype,"remoteMediaSsrcChanged"),he.prototype),he);function _r(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let n=this.mutex,o=await n.lock("From P2PChannel.".concat(t));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await i.apply(this,s)}finally{o()}},r}var BV={};function _d(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&f.debug("install service ".concat(e.name)),BV[e.name]=e}function Dd(e){let t=BV[e];if(!t)throw new M(R.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function uD(e,t){return Dd("DataStream").create(e,t)}function hD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function pD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var SJ=Date.now(),TJ=20,Av=new Map,_f=new Map;async function jV(e){let t=Av.get(e),r=Array.isArray(t)&&t[t.length-1],i=_f.get(e);if(!r)return void(i.isSyncing=!1);let n={uid:r.uid,payload:r.payload};i.firstRecvTs===0&&(i.firstRecvTs=r.recvTs,i.firstSendTs=r.sendTs);let o=r.sendTs-i.firstSendTs,a=o-(Date.now()-i.firstRecvTs);a>0&&(i.firstRecvTs=Date.now()-o);let s=r.mediaDelay+a;s<=0?(t.pop(),GV(r.context,n),s=0):s=Math.min(s,TJ),setTimeout(()=>t.length&&jV(e),s)}function GV(e,t){e.safeEmit(me.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function vJ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return GV(r,{uid:e.uid,payload:e.payload});let i="".concat(r.id,"-").concat(e.uid),n=Av.get(i)||[],o=n.findIndex(l=>e.sendTs>=l.sendTs),a=pD(pD({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});o===-1?n.push(a):n.splice(o,0,a),Av.set(i,n);let s=!1;var c;_f.has(i)?s=!((c=_f.get(i))===null||c===void 0||!c.isSyncing):_f.set(i,{isSyncing:s,firstRecvTs:0,firstSendTs:0}),s||jV(i)}var yJ=ve().name;function fD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function _D(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fD(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fD(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var al="websdk_ng_cache_parameter",RJ=w("MAX_PRELOAD_ASYNC_LENGTH"),CJ=1e4,ps=new Map,fs=[],$g=null,qg=0,Xg=0,Rp=new Map,IJ=function(e,t){let r=[],i=0,n=async()=>{let o=r.shift();o&&await o(),r.length>0&&i<t?n():i--};return async function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return new K(async(c,l)=>{r.push(async()=>{try{let d=await e(...a);c(d)}catch(d){l(d)}}),i<t&&(i++,n())})}}(WV,RJ),Jg=Vr.CancelToken.source();async function WV(e,t,r,i,n,o){try{if(!w("ENABLE_PRELOAD"))return;if(!ye().supportWebCrypto)return void Wa(()=>{f.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new M(R.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&jt(r,"token",1,2047),jt(e,"appid",1,2047),sm(t),i&&cm(i);let a=jc();f.debug("preload channel ".concat(t,", uid is ").concat(i));let s={appId:e,cname:t,token:r||e,uid:typeof i!="string"?i:null,sid:a,proxyServer:n},c,l;typeof i=="string"?(s.stringUid=i,[l,c]=await K.all([KX(i,{sid:a,appId:e},Jg.token),TN(_D(_D({},s),{},{token:r||e,uid:0}),Jg.token)]),s.uid=l.uid,c.gatewayInfo.uid=s.uid,c.gatewayInfo.res.uid=s.uid):(o&&(s.stringUid=o),c=await TN(s,Jg.token));let d={sid:a,appId:e,cname:t,token:r||e,uid:s.stringUid||i,intUid:s.uid||c.gatewayInfo.uid,stringUid:s.stringUid,ts:Date.now(),sua:l,ap:c};await async function(u){let h;try{u.uid&&HV({appId:u.appId,cname:u.cname,token:u.token,uid:u.uid,stringUid:u.stringUid});let p=YV(u),g=await async function(E,S){try{let T=await window.crypto.subtle.importKey("raw",Rx(S),"AES-GCM",!1,["encrypt"]),y=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},T,Ts(window.btoa(JSON.stringify(E))));return Ma(new Uint8Array(y))}catch{return}}(u,u.token||u.appId);if(!g)return;h=zV(al);let _=h?JSON.parse(h):[];_.push({[p]:g}),_.length>w("AP_CACHE_NUM")&&_.shift(),u_(al,JSON.stringify(_))}catch(p){f.warn("Error caching server parameters:",p.message),u_(al,"")}}(d),qg++}catch(a){throw Xg++,function(s){$g||($g=window.setTimeout(()=>{let l="";Rp.forEach((d,u)=>{l+="".concat(u,": ").concat(d," ;")}),Q.reportApiInvoke(null,{name:wt.PRELOAD,options:{success:qg,failed:Xg,err:l}}).onError(s),qg=0,Xg=0,Rp.clear(),$g=null},CJ));let c=Rp.get(s.code)||0;Rp.set(s.code,c+1)}(a),a}}async function mD(e){try{let t=HV(e);if(!t||e.cloudProxyServer!=="disabled")return;let r=await async function(i,n){try{let o=await window.crypto.subtle.importKey("raw",Rx(n),"AES-GCM",!1,["decrypt"]),a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,Ts(i));return JSON.parse(window.atob(Ma(new Uint8Array(a))))}catch{return}}(t,e.token||e.appId);if(!r||!function(i,n){return i.cname===n.cname&&i.appId===n.appId&&i.token===n.token?n.stringUid?i.stringUid===n.stringUid:typeof n.uid=="number"?i.uid===n.uid:i.uid==n.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<w("AP_CACHE_LIFETIME"))return r}catch(t){f.warn("Error get preloadInfo",t.message)}}function HV(e){let t;try{if(t=zV(al),!t)return;let r=JSON.parse(t),i=YV(e),n=function(a,s){for(let c=a.length-1;c>=0;c--)if(s(a[c]))return c;return-1}(r,a=>i in a);if(n===-1)return;let o=r.splice(n,1)[0];return u_(al,JSON.stringify(r)),o[i]}catch(r){f.warn("Error delete preload info: ".concat(t),r.message),u_(al,"")}}function FR(e){if(e){let t=ps.get(e);t&&(window.clearTimeout(t),t=null,ps.delete(e)),Y(fs).call(fs,e)||e.cloudProxyServer!=="disabled"||fs.push(e)}if(ps.size<w("AP_CACHE_NUM")&&fs.length>0){let t=fs.shift();ps.set(t,window.setTimeout(async()=>{let{appId:r,cname:i,token:n,stringUid:o,uid:a,proxyServer:s}=t;try{await IJ(r,i,n,a,s,o),ps.has(t)&&FR(t)}catch(c){f.warn("update preload failed",c.message),KV(t)}},w("AP_UPDATE_INTERVAL")))}}function KV(e){let t=fs.indexOf(e);t!==-1&&fs.splice(t,1);let r=ps.get(e);r&&(window.clearTimeout(r),r=null,ps.delete(e),FR())}function ED(e,t){let r=e.sua,i=e.ap;t&&r&&Q.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),Q.reportResourceTiming(e.ap.url,e.sid),Q.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(n=>n.ip).join(","),eventType:"disabled",unilbsServerIds:[gt.CHOOSE_SERVER,gt.CLOUD_PROXY_FALLBACK].toString()}),Q.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(n=>n.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[gt.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function zV(e){return window.atob(window.localStorage.getItem(e)||"")}function u_(e,t){window.localStorage.setItem(e,window.btoa(t))}function YV(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),Ix(t)}function wJ(e){let t=function(){let r=bJ.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,i){let n=r.appId;n!==void 0&&(mt(i,10),ra(i,n));let o=r.cid;o!==void 0&&(mt(i,16),mt(i,o));let a=r.cname;a!==void 0&&(mt(i,26),ra(i,a));let s=r.deviceId;s!==void 0&&(mt(i,34),ra(i,s));let c=r.elapse;c!==void 0&&(mt(i,40),ia(i,c));let l=r.fileSize;l!==void 0&&(mt(i,48),ia(i,fc(l)));let d=r.height;d!==void 0&&(mt(i,56),ia(i,fc(d)));let u=r.jpg;u!==void 0&&(mt(i,66),mt(i,u.length),gD(i,u));let h=r.networkType;h!==void 0&&(mt(i,72),ia(i,fc(h)));let p=r.osType;p!==void 0&&(mt(i,80),ia(i,fc(p)));let g=r.requestId;g!==void 0&&(mt(i,90),ra(i,g));let _=r.sdkVersion;_!==void 0&&(mt(i,98),ra(i,_));let E=r.sequence;E!==void 0&&(mt(i,104),ia(i,fc(E)));let S=r.sid;S!==void 0&&(mt(i,114),ra(i,S));let T=r.timestamp;T!==void 0&&(mt(i,120),ia(i,T));let y=r.uid;y!==void 0&&(mt(i,128),mt(i,y));let I=r.vid;I!==void 0&&(mt(i,136),mt(i,I));let O=r.width;O!==void 0&&(mt(i,144),ia(i,fc(O)));let b=r.service;b!==void 0&&(mt(i,152),mt(i,b));let k=r.callbackData;k!==void 0&&(mt(i,162),mt(i,k.length),gD(i,k));let P=r.ticket;P!==void 0&&(mt(i,170),ra(i,P));let j=r.vendorConfigs;j!==void 0&&(mt(i,178),ra(i,j))}(e,t),function(r){let i=r.bytes,n=r.limit;return i.length===n?i:i.subarray(0,n)}(t)}function AJ(e){return function(r){let i={};e:for(;!NJ(r);){let n=Pd(r);switch(n>>>3){case 0:break e;case 1:i.code=Pd(r);break;case 2:i.msg=SD(r,Pd(r));break;case 3:i.requestId=SD(r,Pd(r));break;case 4:i.timestamp=DJ(r,!1);break;default:OJ(r,7&n)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function OJ(e,t){switch(t){case 0:for(;128&en(e););break;case 2:Qg(e,Pd(e));break;case 5:Qg(e,4);break;case 1:Qg(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function fc(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var bJ=[];function Qg(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function NJ(e){return e.offset>=e.limit}function dm(e,t){let r=e.bytes,i=e.offset,n=e.limit,o=i+t;if(o>r.length){let a=new Uint8Array(2*o);a.set(r),e.bytes=a}return e.offset=o,o>n&&(e.limit=o),i}function $V(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function gD(e,t){let r=dm(e,t.length);e.bytes.set(t,r)}function SD(e,t){let r=$V(e,t),i=String.fromCharCode,n=e.bytes,o="",a="";for(let s=0;s<t;s++){let c,l,d,u,h=n[s+r];128&h?(224&h)==192?s+1>=t?a+=o:(c=n[s+r+1],(192&c)!=128?a+=o:(u=(31&h)<<6|63&c,u<128?a+=o:(a+=i(u),s++))):(240&h)==224?s+2>=t?a+=o:(c=n[s+r+1],l=n[s+r+2],(49344&(c|l<<8))!=32896?a+=o:(u=(15&h)<<12|(63&c)<<6|63&l,u<2048||u>=55296&&u<=57343?a+=o:(a+=i(u),s+=2))):(248&h)==240?s+3>=t?a+=o:(c=n[s+r+1],l=n[s+r+2],d=n[s+r+3],(12632256&(c|l<<8|d<<16))!=8421504?a+=o:(u=(7&h)<<18|(63&c)<<12|(63&l)<<6|63&d,u<65536||u>1114111?a+=o:(u-=65536,a+=i(55296+(u>>10),56320+(1023&u)),s+=3))):a+=o:a+=i(h)}return a}function ra(e,t){let r=t.length,i=0;for(let a=0;a<r;a++){let s=t.charCodeAt(a);s>=55296&&s<=56319&&a+1<r&&(s=(s<<10)+t.charCodeAt(++a)-56613888),i+=s<128?1:s<2048?2:s<65536?3:4}mt(e,i);let n=dm(e,i),o=e.bytes;for(let a=0;a<r;a++){let s=t.charCodeAt(a);s>=55296&&s<=56319&&a+1<r&&(s=(s<<10)+t.charCodeAt(++a)-56613888),s<128?o[n++]=s:(s<2048?o[n++]=s>>6&31|192:(s<65536?o[n++]=s>>12&15|224:(o[n++]=s>>18&7|240,o[n++]=s>>12&63|128),o[n++]=s>>6&63|128),o[n++]=63&s|128)}}function en(e){return e.bytes[$V(e,1)]}function TD(e,t){let r=dm(e,1);e.bytes[r]=t}function Pd(e){let t,r=0,i=0;do t=en(e),r<32&&(i|=(127&t)<<r),r+=7;while(128&t);return i}function mt(e,t){for(t>>>=0;t>=128;)TD(e,127&t|128),t>>>=7;TD(e,t)}function DJ(e,t){let r,i=0,n=0,o=0;return r=en(e),i=127&r,128&r&&(r=en(e),i|=(127&r)<<7,128&r&&(r=en(e),i|=(127&r)<<14,128&r&&(r=en(e),i|=(127&r)<<21,128&r&&(r=en(e),n=127&r,128&r&&(r=en(e),n|=(127&r)<<7,128&r&&(r=en(e),n|=(127&r)<<14,128&r&&(r=en(e),n|=(127&r)<<21,128&r&&(r=en(e),o=127&r,128&r&&(r=en(e),o|=(127&r)<<7))))))))),{low:i|n<<28,high:n>>>4|o<<24,unsigned:t}}function ia(e,t){let r=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,o=n===0?i===0?r<16384?r<128?1:2:r<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:n<128?9:10,a=dm(e,o),s=e.bytes;switch(o){case 10:s[a+9]=n>>>7&1;case 9:s[a+8]=o!==9?128|n:127&n;case 8:s[a+7]=o!==8?i>>>21|128:i>>>21&127;case 7:s[a+6]=o!==7?i>>>14|128:i>>>14&127;case 6:s[a+5]=o!==6?i>>>7|128:i>>>7&127;case 5:s[a+4]=o!==5?128|i:127&i;case 4:s[a+3]=o!==4?r>>>21|128:r>>>21&127;case 3:s[a+2]=o!==3?r>>>14|128:r>>>14&127;case 2:s[a+1]=o!==2?r>>>7|128:r>>>7&127;case 1:s[a]=o!==1?128|r:127&r}}var vD={},yD={},h_=4294967296,PJ=h_*h_,RD=PJ/2;qV(0,!0);var CD=qV(0),kJ=ju(0,-2147483648,!1),LJ=ju(-1,2147483647,!1);function qV(e,t){let r,i,n;return t?(n=0<=(e>>>=0)&&e<256)&&(i=yD[e],i)?i:(r=ju(e,0,!0),n&&(yD[e]=r),r):(n=-128<=(e|=0)&&e<128)&&(i=vD[e],i)?i:(r=ju(e,e<0?-1:0,!1),n&&(vD[e]=r),r)}function ju(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function MJ(e,t){if(isNaN(e))return CD;{if(e<=-RD)return kJ;if(e+1>=RD)return LJ}return e<0?CD:ju(e%h_|0,e/h_|0,t)}function ID(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}var UJ=class XV extends tt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(In.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),v(this,"name","AgoraRTCImageModeration"),v(this,"_connectionState",Ai.CONNECTING),v(this,"_sequence",0),v(this,"_moderationStartTime",void 0),v(this,"_workerConnection",void 0),v(this,"_workerMessageLengthLimit",void 0),v(this,"_qualityRatio",void 0),v(this,"_connectInfo",void 0),v(this,"_cancelTokenSource",Vr.CancelToken.source()),v(this,"_retryConfig",void 0),v(this,"_moderationInterval",void 0),v(this,"_moderationTimer",null),v(this,"_moderationMode",1),v(this,"_quality",1),v(this,"_qualityTimer",null),v(this,"_ticket",void 0),v(this,"_moderationIntervalMinimum",void 0),v(this,"_uploadFailedNum",0),v(this,"_uploadNum",0),v(this,"_uploadTimer",null),v(this,"_extraInfo",void 0),v(this,"_vendor",""),v(this,"_encoder",new TextEncoder),v(this,"_moderationId",void 0),v(this,"inspectImage",()=>{if(this.connectionState!==Ai.CONNECTED)throw new D(R.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ai.CONNECTED?this.requestToInspectImage():f.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Fe(5,"image-moderation-"),this._workerMessageLengthLimit=w("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=w("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=w("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Mu("worker-"+this._moderationId,Rt),this.on(In.STATE_CHANGE,(i,n)=>{f.debug("[".concat(this._moderationId,"] Moderation operation :").concat(ac[i]," ").concat(n||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(In.STATE_CHANGE,ac.CONNECT_AP),this._connectInfo=t;let i=this._cancelTokenSource.token;return this._retryConfig=r,new K((n,o)=>{this.on(In.CONNECTION_STATE_CHANGE,(a,s)=>{a===Ai.CONNECTED&&n()}),this.requestAP(t,i,r).then(a=>{this.connectWorker(a)}).catch(a=>{o(a)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),f.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Ai.CONNECTED&&this.inspectImage()}async requestAP(t,r,i){let n=w("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),o=await function(c,l,d,u){let{appId:h,areaCode:p,cname:g,sid:_,token:E,uid:S}=l;nl++;let T="moderation_plugin",y={service_name:T,json_body:JSON.stringify({appId:h,areaCode:p,cname:g,command:"allocateEdge",requestId:nl,seq:nl,sid:_,appToken:E,ts:Date.now(),uid:S+""})},I,O,b=c[0];return Fn(async()=>{I=Date.now();let k=await Bn(b,{data:y,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(O=Date.now()-I,k.code!==0){let G=new D(R.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+k.code,{retry:!0,responseTime:O});throw f.error(G.toString()),G}let P=JSON.parse(k.json_body);if(P.code!==200){let G=new D(R.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(P.code,", reason: ").concat(P.reason),{code:P.code,responseTime:O});throw f.error(G.toString()),G}if(!P.servers||!Array.isArray(P.servers)||P.servers.length===0){let G=new D(R.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:P.code,responseTime:O});throw f.error(G.toString()),G}if(!P.servers.some(G=>!!G.wss)){let G=new D(R.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:P.code,responseTime:O});throw f.error(G.toString()),G}let j=w("IMAGE_MODERATION_WORKER_HOST");return{addressList:P.servers.map(G=>{let{address:ce,wss:pe}=G;if(ce&&pe)return"wss://".concat(ce.replace(/\./g,"-"),".").concat(j,":").concat(pe,"/moderation")}).filter(G=>!!G),workerToken:P.workerToken,vid:P.vid,ticket:P.appTicket,responseTime:O}},(k,P)=>(Q.apworkerEvent(_,{success:!0,sc:200,serviceName:T,responseDetail:JSON.stringify(k.addressList),firstSuccess:P===0,responseTime:O,serverIp:c[P%c.length]}),!1),(k,P)=>(Q.apworkerEvent(_,{success:!1,sc:k.data&&k.data.code||200,serviceName:T,responseTime:O,serverIp:c[P%c.length]}),!!(k.code!==R.OPERATION_ABORTED&&k.code!==R.UNEXPECTED_RESPONSE||k.data&&k.data.retry)&&(b=c[(P+1)%c.length],!0)),u)}(n,t,r,i);this.emit(In.STATE_CHANGE,ac.AP_CONNECTED);let{addressList:a,ticket:s}=o;return this._ticket=s,a}async connectWorker(t){this.emit(In.STATE_CHANGE,ac.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(se.CONNECTED,async()=>{this.emit(In.STATE_CHANGE,ac.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ai.CONNECTED}),this._workerConnection.on(se.CLOSED,()=>{this.connectionState=Ai.CLOSED}),this._workerConnection.on(se.FAILED,()=>{this.connectionState=Ai.CLOSED}),this._workerConnection.on(se.RECONNECTING,()=>{this.connectionState=this.connectionState===Ai.CONNECTED?Ai.RECONNECTING:Ai.CONNECTING}),this._workerConnection.on(se.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let r=AJ(new Uint8Array(t.data));w("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&f.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,f.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Q.reportApiInvoke(this._connectInfo.sid||null,{name:wt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:nt.TRACER}).onError(new D(R.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},w("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else f.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(se.WILL_RECONNECT,(t,r,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(se.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=Mi(this,In.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(w("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&f.debug("Only the track being played can be inspected"));this._sequence++;let i=await this.generateRequestData(t,r);this._workerConnection.sendMessage(i,!0,!0)}else w("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&f.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:i,cname:n,cid:o,vid:a,sid:s,uid:c}=r,l=Date.now(),d=await t.getCurrentFrameImage("image/jpeg",this.quality),u=await cV(d,i,n),h=this._sequence+"-"+o+"-"+c+"-"+l+"-"+Fe(12,""),p={appId:i,cid:o,cname:n,deviceId:"",elapse:XV.intToLong(Number(l-this._moderationStartTime)),fileSize:d.buffer.byteLength,height:d.height,width:d.width,jpg:u,networkType:6,osType:7,requestId:h,sdkVersion:"4.22.0",sequence:this._sequence,sid:s,timestamp:MJ(l),uid:c,vid:a,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete p.callbackData;let g=wJ(p);if(g.byteLength<this._workerMessageLengthLimit){if(w("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let _=function(E){for(var S=1;S<arguments.length;S++){var T=arguments[S]!=null?arguments[S]:{};S%2?ID(Object(T),!0).forEach(function(y){v(E,y,T[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(T)):ID(Object(T)).forEach(function(y){Object.defineProperty(E,y,Object.getOwnPropertyDescriptor(T,y))})}return E}({},p);delete _.jpg,f.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(_))}return g}{let _=this.quality*this._qualityRatio;return this.quality=_,await this.generateRequestData(t,{appId:i,cname:n,cid:o,vid:a,sid:s,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Vr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ai.CLOSED,this.emit(In.STATE_CHANGE,ac.CLOSED)}};function JV(e){if(Me(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new D(R.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new D(R.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}var xJ={name:"ImageModeration",create:function(e){let{config:t}=e;return JV(t),new UJ(t)}},wD,AD,OD,bD,ND,DD,PD,kD,LD,MD,UD,xD,VD,FD,BD,jD,GD,WD,HD,KD,zD,YD,$D,qD,XD,JD,QD,ZD,eP,tP,rP,iP,nP,oP,aP,sP,cP,lP,dP,uP,z;function hP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function An(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hP(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hP(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}cr.setLogger(f);var VJ=(wD=re(),AD=re({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Hc))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),OD=re({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Vl.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),bD=re({argsMap:(e,t,r,i)=>[typeof t=="object"?t.uid:t,r,i]}),ND=re({argsMap:(e,t,r)=>[t,r]}),DD=re({argsMap:(e,t)=>t.map(r=>{let{user:i,mediaType:n}=r;return[i==null?void 0:i.uid,n]})}),PD=re({argsMap:(e,t,r,i)=>[typeof t=="object"?t.uid:t,r,i]}),kD=re({argsMap:(e,t)=>t.map(r=>{let{user:i,mediaType:n}=r;return{uid:i==null?void 0:i.uid,mediaType:n}})}),LD=re(),MD=re(),UD=re(),xD=re(),VD=re(),FD=re(),BD=re(),jD=re(),GD=re(),WD=re(),HD=re(),KD=re(),zD=re(),YD=re(),$D=re({argsMap:(e,t)=>[t]}),qD=re(),XD=re(),JD=re(),QD=re(),ZD=re(),eP=re(),tP=re(),rP=re(),iP=re({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),nP=re(),oP=re(),aP=re(),sP=re(),cP=re(),lP=re(),dP=re({reportResult:!0}),uP=re(),z=class extends tt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),v(this,"store",void 0),v(this,"_uid",void 0),v(this,"_channelName",void 0),v(this,"_uintUid",void 0),v(this,"_users",[]),v(this,"_config",void 0),v(this,"_clientId",void 0),v(this,"_appId",void 0),v(this,"_sessionId",null),v(this,"_key",void 0),v(this,"_rtmConfig",{}),v(this,"_joinInfo",void 0),v(this,"_gateway",void 0),v(this,"_statsCollector",void 0),v(this,"_configDistribute",void 0),v(this,"_leaveMutex",new cr("client-leave")),v(this,"_publishMutex",new cr("client-publish")),v(this,"_renewTokenMutex",new cr("client-renewtoken")),v(this,"_subscribeMutex",new cr("client-subscribe")),v(this,"_encryptionMode","none"),v(this,"_encryptionSecret",null),v(this,"_encryptionSalt",null),v(this,"_encryptDataStream",!1),v(this,"_encryptDataStreamKey",null),v(this,"_encryptDataStreamIv",null),v(this,"_proxyServer",void 0),v(this,"_turnServer",{servers:[],mode:"auto"}),v(this,"_cloudProxyServerMode","disabled"),v(this,"_isDualStreamEnabled",!1),v(this,"_defaultStreamFallbackType",void 0),v(this,"_lowStreamParameter",void 0),v(this,"_streamFallbackTypeCacheMap",new Map),v(this,"_remoteStreamTypeCacheMap",new Map),v(this,"_axiosCancelSource",Vr.CancelToken.source()),v(this,"_audioVolumeIndicationInterval",void 0),v(this,"_networkQualityInterval",void 0),v(this,"_userOfflineTimeout",void 0),v(this,"_streamRemovedTimeout",void 0),v(this,"_liveTranscodeStreamingClient",void 0),v(this,"_liveRawStreamingClient",void 0),v(this,"_channelMediaRelayClient",void 0),v(this,"_networkQualitySensitivity","normal"),v(this,"_p2pChannel",void 0),v(this,"_useLocalAccessPoint",!1),v(this,"_setLocalAPVersion",void 0),v(this,"_joinAndNotLeaveYet",!1),v(this,"_numberOfJoinCount",0),v(this,"_remoteDefaultVideoStreamType",void 0),v(this,"_inspect",void 0),v(this,"_moderation",void 0),v(this,"_license",void 0),v(this,"_pendingPublishedUsers",[]),v(this,"ntpAlignErrorCount",0),v(this,"remoteInboundOffset",0),v(this,"_handleLocalTrackEnable",(r,i,n)=>{this.publish(r,!1).then(i).catch(n)}),v(this,"_handleLocalTrackDisable",(r,i,n)=>{this.unpublish(r).then(i).catch(n)}),v(this,"_handleUserOnline",r=>{if(w("BLOCK_LOCAL_CLIENT")&&es(r.uid,this.channelName))return void f.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&f.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let i=this._users.find(n=>n.uid===r.uid);if(i)i._trust_in_room_=!0,i._is_pre_created&&(i._is_pre_created=!1,this.safeEmit(me.USER_JOINED,i));else{let n=new pa(r.uid,r.uint_id||r.uid);this._users.push(n),f.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(me.USER_JOINED,n)}}),v(this,"_handleUserOffline",r=>{if(w("BLOCK_LOCAL_CLIENT")&&es(r.uid,this.channelName))return;let i=this._users.find(n=>n.uid===r.uid);i&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),i._audio_pre_subscribed||i._video_pre_subscribed?i._is_pre_created=!0:t_(this._users,i),this._remoteStreamTypeCacheMap.delete(i.uid),this._streamFallbackTypeCacheMap.delete(i.uid),f.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(me.USER_LEAVED,i,r.reason))}),v(this,"_handleAddAudioOrVideoStream",(r,i,n,o,a,s,c)=>{if(w("BLOCK_LOCAL_CLIENT")&&es(i,this.channelName))return;let l=this._users.find(u=>u.uid===i);if(!l)return void f.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));f.debug("[".concat(this._clientId,"] stream added with uid ").concat(i,", type ").concat(r)),this.store.subscribe(l.uid,r,void 0,void 0,void 0,Date.now());let d=r==="audio"?l.hasAudio:l.hasVideo;l._uintid||(l._uintid=a||i),r==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,r==="audio"?(l._audio_added_=!0,n!==void 0&&(l._audioSSRC=n),o!==void 0&&(l._cname=o),s&&(l._audioOrtc=s)):(l._video_added_=!0,n!==void 0&&(l._videoSSRC=n),o!==void 0&&(l._cname=o),c!==void 0&&(l._rtxSsrcId=c),s&&(l._videoOrtc=s)),(r==="audio"?l.hasAudio:l.hasVideo)&&!d&&(f.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(r)),this.safeEmit(me.USER_PUBLISHED,l,r)),r==="video"?Q.onGatewayStream(this._sessionId,Bt.ON_ADD_VIDEO_STREAM,Ze.ON_ADD_VIDEO_STREAM,{peer:a||i,ssrc:l._videoSSRC}):Q.onGatewayStream(this._sessionId,Bt.ON_ADD_AUDIO_STREAM,Ze.ON_ADD_AUDIO_STREAM,{peer:a||i,ssrc:l._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(l,r,n).then(u=>{if(u&&(f.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(l.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof yp))return this._p2pChannel.unsubscribe(l,r,!0).then(()=>this._subscribe(l,r,!0).catch(h=>{f.error("[".concat(this._clientId,"] resubscribe error"),h.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(l,r)&&(f.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,r,!0).catch(u=>{f.error("[".concat(this._clientId,"] resubscribe error"),u.toString())}))}),v(this,"_handleRemoveStream",r=>{if(w("BLOCK_LOCAL_CLIENT")&&es(r.uid,this.channelName))return;let i=this._users.find(o=>o.uid===r.uid);if(!i)return void f.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));f.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let n=()=>{};i.hasAudio&&i.hasVideo?n=()=>{f.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.safeEmit(me.USER_UNPUBLISHED,i,"audio"),f.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.safeEmit(me.USER_UNPUBLISHED,i,"video")}:i.hasVideo?n=()=>{f.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.safeEmit(me.USER_UNPUBLISHED,i,"video")}:i.hasAudio&&(n=()=>{f.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.safeEmit(me.USER_UNPUBLISHED,i,"audio")}),i._video_pre_subscribed||i._audio_pre_subscribed||(i._trust_audio_stream_added_state_=!0,i._trust_video_stream_added_state_=!0,i._audio_added_=!1,i._video_added_=!1,this._p2pChannel instanceof yp&&this._p2pChannel.unsubscribe(i).then(o=>{if(o)return this._gateway.unsubscribe(o,i.uid)}),i._audioSSRC=void 0,i._videoSSRC=void 0,i._audioOrtc=void 0,i._videoOrtc=void 0,i._rtxSsrcId=void 0),Q.onGatewayStream(this._sessionId,Bt.ON_REMOVE_STREAM,Ze.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),n()}),v(this,"_handleSetStreamLocalEnable",(r,i,n)=>{if(w("BLOCK_LOCAL_CLIENT")&&es(i,this.channelName))return;let o=this._users.find(c=>c.uid===i);if(!o)return void f.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));f.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(n?"enabled":"disabled"," with uid ").concat(i));let a=r==="audio"?o.hasAudio:o.hasVideo;if(r==="audio"){o._trust_audio_enabled_state_=!0;let c=o._audio_enabled_;if(o._audio_enabled_=n,o._audio_enabled_===c)return;{let l=o._audio_enabled_?"enable-local-audio":"disable-local-audio";f.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(i,", msg: ").concat(l)),this.safeEmit(me.USER_INFO_UPDATED,i,l)}}else{o._trust_video_enabled_state_=!0;let c=o._video_enabled_;if(o._video_enabled_=n,o._video_enabled_===c)return;{let l=o._video_enabled_?"enable-local-video":"disable-local-video";f.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(l)),this.safeEmit(me.USER_INFO_UPDATED,i,l)}}let s=r==="audio"?o.hasAudio:o.hasVideo;return a!==s?!a&&s?(f.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(r)),void this.safeEmit(me.USER_PUBLISHED,o,r)):(r==="video"&&o._videoTrack&&o._videoTrack._destroy(),r==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,r),f.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(r)),void this.safeEmit(me.USER_UNPUBLISHED,o,r)):void 0}),v(this,"_handleMuteStream",(r,i,n)=>{if(w("BLOCK_LOCAL_CLIENT")&&es(r,this.channelName))return;f.debug("[".concat(this._clientId,"] receive mute message"),r,i,n);let o=this._users.find(c=>c.uid===r);if(!o)return void f.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));let a=i==="audio"?o.hasAudio:o.hasVideo;if(i==="audio"){o._trust_audio_mute_state_=!0;let c=o._audio_muted_;if(o._audio_muted_=n,o._audio_muted_===c)return;{let l=o._audio_muted_?"mute-audio":"unmute-audio";f.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(l)),this.safeEmit(me.USER_INFO_UPDATED,r,l)}}else{o._trust_video_mute_state_=!0;let c=o._video_muted_;if(o._video_muted_=n,o._video_muted_===c)return;{let l=o._video_muted_?"mute-video":"unmute-video";f.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(l)),this.safeEmit(me.USER_INFO_UPDATED,r,l)}}let s=i==="audio"?o.hasAudio:o.hasVideo;if(a!==s){if(!a&&s)return(i==="audio"?o._audioSSRC:o._videoSSRC)?(f.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(i)),void this.safeEmit(me.USER_PUBLISHED,o,i)):void f.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(i," unmute message  before add stream message, ").concat(i," SSRC doesn't exist yet."));i==="video"&&o._videoTrack&&!o._video_pre_subscribed&&o._videoTrack._destroy(),i==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,i),f.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(i)),this.safeEmit(me.USER_UNPUBLISHED,o,i)}}),v(this,"_handleP2PLost",async r=>{f.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():f.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),v(this,"_handleTokenWillExpire",()=>{f.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(me.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),v(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),f.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),v(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(me.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(me.NETWORK_QUALITY,r)}),v(this,"_handleP2PAddAudioOrVideoStream",(r,i,n,o)=>{let a=this._users.find(c=>c.uid===i);if(!a)return void f.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));f.debug("[".concat(this._clientId,"] stream added with uid ").concat(i,", type ").concat(r)),this.store.subscribe(a.uid,r,void 0,void 0,void 0,Date.now());let s=r==="audio"?a.hasAudio:a.hasVideo;r==="audio"?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,r==="audio"?(a._audio_added_=!0,n!==void 0&&(a._audioSSRC=n),o!==void 0&&(a._audioMid=o)):(a._video_added_=!0,n!==void 0&&(a._videoSSRC=n),o!==void 0&&(a._videoMid=o)),(r==="audio"?a.hasAudio:a.hasVideo)&&!s&&(f.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(r)),this.safeEmit(me.USER_PUBLISHED,a,r)),this._p2pChannel.hasPendingRemoteMedia(a,r)&&(f.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,r,!0).catch(c=>{f.error("[".concat(this._clientId,"] resubscribe error"),c.toString())}))}),this._config=e,this._clientId=Fe(5,"client-"),this.store=new l9(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),f.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ui," build: ").concat(SR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{MO(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(r){f.warning("[".concat(this._clientId,"] ").concat(r.toString()))}this._statsCollector=new UV(this.store),this._statsCollector.onStatsException=(r,i,n)=>{f.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(i,", uid: ").concat(n)),this.safeEmit(me.EXCEPTION,{code:r,msg:i,uid:n})},this._statsCollector.onUploadPublishDuration=(r,i,n,o)=>{let a=this._users.find(s=>s.uid===r);a&&Q.peerPublishStatus(this._sessionId,{subscribeElapse:o,audioPublishDuration:i,videoPublishDuration:n,peer:a._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new FX(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Rt,httpRetryConfig:e.httpRetryConfig||Rt,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new qX,this.store.useP2P?(this._p2pChannel=new Jr(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new yp(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,i,n){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],a=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Le("JOIN_GATEWAY_USE_443PORT_ONLY",o),Le("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);let s=this._gateway.signal.websocket;return s instanceof vR&&(s.use443PortOnly=o,s.tryDoubleDomain=a),async function(c,l,d){ep.get(c)||ep.set(c,[]),tp.get(c)||tp.set(c,l),Wn.get(c)||Wn.set(c,0);let u=ep.get(c),h=tp.get(c);if(!u||!h)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Wn.get(c)===h){let S=Nu();u.push(S),await S.promise}Wn.set(c,Wn.get(c)+1);for(var p=arguments.length,g=new Array(p>3?p-3:0),_=3;_<p;_++)g[_-3]=arguments[_];let E=await d(...g);return Wn.set(c,Wn.get(c)-1),Wn.get(c)===h-1&&u.length>0&&(u[0].resolve(),u.shift()),Wn.get(c)===0&&(ep.set(c,[]),tp.set(c,0),Wn.set(c,0)),E}("client.join",w("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,i,n)}async join(e,t,r,i,n){let o=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);let a=(ip||ip||(ip=(window.location.protocol.split(":")[0]||"").toUpperCase(),ip))==="HTTPS",s=GO()?window.isSecureContext:"Browser Not Support";(!GO()&&!a||!window.isSecureContext)&&f.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),f.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Q.setAppId(e);try{if(!r&&r!==null)throw new D(R.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&jt(r,"token",1,2047),jt(e,"appid",1,2047),sm(t),i&&cm(i),n&&jt(n,"optionalInfo",1,2047)}catch(_){throw Q.reportApiInvoke(jc(),{name:wt.JOIN,options:[e,t,r,i],states:{isHttps:a,isSecureContext:s},tag:nt.TRACER}).onError(_),_}if(this._leaveMutex.isLocked&&(f.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),f.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let _=new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Q.reportApiInvoke(jc(),{name:wt.JOIN,options:[e,t,r,i],states:{isHttps:a,isSecureContext:s},tag:nt.TRACER}).onError(_),_}this._gateway.state="CONNECTING";let c=await mD({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let l=(c==null?void 0:c.sid)||jc();f.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);let d=Q.reportApiInvoke(l,{name:wt.JOIN,options:[e,t,r,i],states:{isHttps:a,isSecureContext:s},tag:nt.TRACER}),u=An(An({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:n,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(u.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(u.stringUid=i,this._uintUid?(u.uid=this._uintUid,this._uintUid=void 0):u.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(u.aesmode=this._encryptionMode,u.aespassword=await(async _=>{let E=function(I){let O=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),b=new Uint8Array(new ArrayBuffer(O.length));for(let k=0;k<O.length;k+=1)b[k]=O.charCodeAt(k);return b}(),S=await window.crypto.subtle.importKey("spki",E,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),T=_R(_),y=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},S,T);return function(I){let O="";for(let b=0;b<I.length;b+=1)O+=String.fromCharCode(I[b]);return window.btoa(O)}(new Uint8Array(y))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(u.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let _=new TextEncoder,E=w("USE_PURE_ENCRYPTION_MASTER_KEY")?_.encode(u.appId+this._encryptionSecret+this._encryptionSecret):_.encode(u.appId+u.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(S,T,y){let I=await window.crypto.subtle.importKey("raw",T,"PBKDF2",!1,["deriveBits","deriveKey"]),O=S==="aes-128-gcm2"?128:256,b=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:HO,hash:"SHA-256",salt:y},I,O+d9);return new Uint8Array(b).subarray(O/8)}(this._encryptionMode,E,Ts(this._encryptionSalt)),this._encryptDataStreamKey=await async function(S,T,y){let I=await window.crypto.subtle.importKey("raw",T,"PBKDF2",!1,["deriveBits","deriveKey"]),O=S==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:HO,hash:"SHA-256",salt:y},I,{name:"AES-GCM",length:O},!0,["encrypt","decrypt"])}(this._encryptionMode,E,Ts(this._encryptionSalt))}else s?f.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):f.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,f.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:u.stringUid});let h=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&h===this._sessionId&&Q.joinChannelTimeout(this._sessionId,5)},5e3);try{var p;let _,E=u.cloudProxyServer;if(Y(p=["proxy3","proxy4","proxy5"]).call(p,E)){let O=w("PROXY_SERVER_TYPE3");Array.isArray(O)?u.proxyServer=O[0]:u.proxyServer=O}if(Q.setProxyServer(u.proxyServer),f.setProxyServer(u.proxyServer),this.store.requestAPStart(),c){if(f.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(u.stringUid?", ".concat(u.stringUid," => ").concat(c.intUid):""," ")),u.stringUid&&!u.uid&&(u.uid=c.intUid),_={gatewayInfo:c.ap.gatewayInfo},w("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&u.turnServer.mode==="auto")if(c.ap.proxyInfo.addresses.length===0)f.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let O=(await Ux(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map(b=>({turnServerURL:b.address,tcpport:b.tcpport||Xt.tcpport,udpport:b.udpport||Xt.udpport,username:b.username||Xt.username,password:b.password||Xt.password,forceturn:!1,security:!0}));u.turnServer={mode:"manual",servers:O}}ED(c,u.stringUid)}else{if(u.stringUid&&!u.uid){let O;[O,_]=await K.all([AV(u.stringUid,u,this._axiosCancelSource.token,this._config.httpRetryConfig||Rt,this.store),SN(u,this._axiosCancelSource.token,this._config.httpRetryConfig||Rt,!0,this.store)]),f.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(u.stringUid," => ").concat(O)),u.uid=O,_.gatewayInfo.uid=O,_.gatewayInfo.res.uid=O}else _=await SN(u,this._axiosCancelSource.token,this._config.httpRetryConfig||Rt,!0,this.store);if(!this._joinAndNotLeaveYet)throw new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(u,this._axiosCancelSource.token),this._configDistribute.on(lv.UPDATE_BITRATE_LIMIT,O=>{this._p2pChannel.updateBitrateLimit(O)})},0),this._key=r||e;let S=_.gatewayInfo,T=u.uid?u.uid:S.uid;this._joinInfo=An(An({},u),{},{cid:S.cid,uid:T,vid:S.vid,apResponse:S.res,apGatewayAddress:S.apGatewayAddress,uni_lbs_ip:S.uni_lbs_ip,gatewayAddrs:S.gatewayAddrs}),this.store.intUid=T;let y=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));d.onSuccess(y),this._appId=e,this._channelName=u.cname,this._uid=y,this.store.uid=y,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(er()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let I=u.stringUid?"string uid: ".concat(u.stringUid,",uid: ").concat(u.uid):"uid: ".concat(this._uid);return f.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(I)),setTimeout(()=>{f.startUpload()},5e3),this.store.joinEnd(),g=this,Y(ua).call(ua,g)||ua.push(g),this._cloudProxyServerMode==="disabled"&&ye().supportWebCrypto&&w("ENABLE_PRELOAD")&&FR(this._joinInfo),y}catch(_){let E=Array.isArray(_)?_[0]:_;throw E&&E.code===R.OPERATION_ABORTED?f.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),E):f.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),E),E.code!==R.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),d.onError(E),E}var g}_joinGateway(){if(!this._joinInfo||!this._key)throw new D(R.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!w("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){f.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(er()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let r=ua.indexOf(t);r!==-1&&ua.splice(r,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return f.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),f.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Hc))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new D(R.INVALID_PARAMS,"param list is empty");let r=e;if(this._gateway.role==="audience")throw new D(R.INVALID_OPERATION,"audience can not publish stream");for(let n of r){if(!(n instanceof Hc))throw new D(R.INVALID_PARAMS,"parameter is not local track");if(!n._enabled&&t)throw new D(R.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(n.getTrackId()))}f.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(n=>"".concat(n.getTrackId()," "))));let i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(n=>{let o=this._configDistribute.getBitrateLimit();n instanceof We&&o&&n.setBitrateLimit(o.uplink)});try{await this._publishHighStream(r),f.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(n=>"".concat(n.getTrackId()," "))))}catch(n){throw f.error("[".concat(this._clientId,"] publish error"),n.toString()),n}finally{i()}}async _publishDataChannel(e){Me(e.id,"id",0,65535,!0),Po(e.ordered,"ordered"),jt(e.metadata,"metadata",0,512),f.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(n=>n.id===e.id)!==-1)throw new D(R.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new D(R.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&w("FORCE_TURN")&&!w("TURN_ENABLE_TCP")&&!w("TURN_ENABLE_UDP"))throw new D(R.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let r=function(n){return uD(n,!1)}(e),i=await this._p2pChannel.publishDataChannel([r]);if(i.length>0){if(typeof r._originDataChannelId!="number")throw f.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new D(R.CREATE_DATACHANNEL_ERROR);try{await K.all(i.map(n=>this._uid&&this._gateway.publishDataChannel(this._uid,n,!0))),await r._waitTillOpen()}catch(n){if(n.code!==R.DISCONNECT_P2P)throw n}}return f.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw f.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new D(R.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Hc))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);f.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));let r=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Jr){let i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(ut.UNPUBLISH,{unpubMsg:i},!0)}else{let i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),f.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(n=>"".concat(n.getTrackId()))))}}catch(i){throw f.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),f.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));let t=await this._publishMutex.lock();try{let r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),f.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(r){throw f.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof pa)){let i=this.remoteUsers.find(n=>n.uid===e);if(!i)throw new D(R.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(Ot(t,"mediaType",["audio","video"]),this._p2pChannel instanceof Jr)throw new D(R.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new D(R.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r=t===Z.AUDIO,i=t===Z.VIDEO,n=await this._subscribeMutex.lock();try{let{ssrcId:o,ortc:a,rtxSsrcId:s,cname:c,uint_id:l}=await this._gateway.presubscribe(e,t,!0);if(o==null)throw new D(R.UNEXPECTED_RESPONSE,"no ssrc id");let d=this._users.find(h=>h.uid===e);d||(d=new pa(e,l||e),d._is_pre_created=!0,this._users.push(d)),c&&(d._cname=c),d._uintid||(d._uintid=l||e),r&&(d._audioSSRC=o,d._audio_pre_subscribed=!0,a&&(d._audioOrtc=a)),i&&(d._videoSSRC=o,d._video_pre_subscribed=!0,a&&(d._videoOrtc=a),s!=null&&(d._rtxSsrcId=s)),f.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(d,t,o,s,a);let u=r?d._audioTrack:d._videoTrack;if(!u)throw new D(R.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(d._trust_audio_stream_added_state_=!0,d._audio_added_=!0),i&&(d._trust_video_stream_added_state_=!0,d._video_added_=!0),u}catch(o){throw f.error("[".concat(this._clientId,"] presub user ").concat(e," error"),o),o}finally{n()}}async _subscribeDataChannel(e,t){var r;if(Me(t,"channelId",0,65535,!0),!this._joinInfo)throw new D(R.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e))throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new D(R.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new D(R.INVALID_REMOTE_USER,"user is not published");let i=(r=e._dataChannels)===null||r===void 0?void 0:r.find(a=>a.id===t);if(!i)throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new D(R.REMOTE_USER_IS_NOT_PUBLISHED);let n=await this._subscribeMutex.lock();f.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let a=await this._p2pChannel.subscribeDataChannel(e,[i]);if(a&&Y(a).call(a,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new D(R.CREATE_DATACHANNEL_ERROR);let s={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,s,!0),await i._waitTillOpen()}catch(s){if((s==null?void 0:s.code)!==R.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),s;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return f.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{n()}}async _p2pSubscribe(e,t,r){if(Ot(t,"mediaType",["audio","video"]),!this._joinInfo)throw new D(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(n=>n===e)){let n=new D(R.INVALID_REMOTE_USER,"user is not in the channel");throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),n}if(!e.hasAudio&&!e.hasVideo){let n=new D(R.INVALID_REMOTE_USER,"user is not published");throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),n}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let n=new D(R.REMOTE_USER_IS_NOT_PUBLISHED);throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let i=await this._subscribeMutex.lock();f.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let o=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof Jr&&await this._p2pChannel.subscribe(e,t,o,a)}catch(o){throw o}f.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{f.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});let n=t==="audio"?e._audioTrack:e._videoTrack;if(!n)throw new D(R.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(n){throw f.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),n),n}finally{i()}}async _subscribe(e,t,r){if(this._p2pChannel instanceof Jr)return this._p2pSubscribe(e,t);if(Ot(t,"mediaType",["audio","video"]),!this._joinInfo)throw new D(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){let c=new D(R.INVALID_REMOTE_USER,"user is not in the channel");throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){let c=new D(R.INVALID_REMOTE_USER,"user is not published");throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let c=new D(R.REMOTE_USER_IS_NOT_PUBLISHED);throw f.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}let i=t==="audio"?e._audioSSRC:e._videoSSRC,n=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,a={stream_type:t==="audio"?Z.AUDIO:Z.VIDEO,ssrcId:i},s=await this._subscribeMutex.lock();f.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let l=t==="audio"?e._audioSSRC:e._videoSSRC;l!==void 0&&l!==i&&(i=l,n=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,a={stream_type:t==="audio"?Z.AUDIO:Z.VIDEO,ssrcId:i}),ar.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,n);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,a,!0)}catch(d){if((d==null?void 0:d.code)!==R.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),d;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(l){throw this._p2pChannel.reportSubscribeEvent(!1,l==null?void 0:l.code,e,t),l}f.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(l=>{f.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});let c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new D(R.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw f.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{s()}}async massSubscribe(e){if(Oo(e,"subscribeList"),!this._joinInfo)throw new D(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),r=new Map,i=await this._subscribeMutex.lock();f.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(s=>{let{user:c,mediaType:l}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(l)}).join("; ")));let n=(e=[...e]).map(s=>{let{user:c,mediaType:l}=s;return{user:c,mediaType:l}}),o=await this._p2pChannel.globalLock();try{var a;for(let c=e.length-1;c>=0;c--){let l=e[c],{user:d,mediaType:u}=l;if(Ot(u,"mediaType",["audio","video"]),!d){let g=new D(R.INVALID_PARAMS,"user property does not exist in subscribeList item");throw f.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),g}if(!this._users.find(g=>g===d)){let g=new D(R.INVALID_REMOTE_USER,"user is not in the channel");f.error("[".concat(this._clientId,"] can not massSubscribe ").concat(d.uid,", this user is not in the channel")),n[c].error=g,e.splice(c,1);continue}if(u==="audio"&&(!d.hasAudio||d._audioSSRC===void 0)||u==="video"&&(!d.hasVideo||d._videoSSRC===void 0)){let g=new D(R.REMOTE_USER_IS_NOT_PUBLISHED);f.error("[".concat(this._clientId,"] can not subscribe ").concat(d.uid," with mediaType ").concat(u,", remote user is not published")),n[c].error=g,e.splice(c,1);continue}let h=Pt.Video|Pt.LwoVideo,p=r.get(d);if(p){if(u==="video"?p&h:p&Pt.Audio){e.splice(c,1),f.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(d.uid,", mediaType:").concat(u," twice"));continue}r.set(d,p|(u==="video"?h:Pt.Audio))}else r.set(d,u==="video"?h:Pt.Audio)}for(let c=e.length-1;c>=0;c--){let l=e[c],{user:d,mediaType:u}=l,h=Pt.Video|Pt.LwoVideo;if(this._p2pChannel.hasRemoteMedia(d,u)){await this._p2pChannel.unmuteRemoteNoLock(d,u);let p=r.get(d);r.set(d,u==="video"?p^h:p^Pt.Audio),e.splice(c,1)}}this.store.massSubscribe(e.map(c=>({userId:c.user.uid,type:c.mediaType})),t);let s=xn(a=Array.from(r.entries())).call(a,(c,l)=>{let[d,u]=l;if(u===0)return c;let h={stream_id:d.uid,stream_type:u};return u&Pt.Audio&&(h.audio_ssrc=d._audioSSRC),u&Pt.Video&&(h.video_ssrc=d._videoSSRC),c.push(h),c},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(l=>{let{user:d,mediaType:u}=l;return{user:d,mediaType:u,ssrcId:u===Z.VIDEO?d._videoSSRC:d._audioSSRC,rtxSsrcId:u===Z.VIDEO?d._rtxSsrcId:void 0}}));let c=new Map;if(s=s.filter(l=>l.video_ssrc&&!this._p2pChannel.isPreSubScribe(l.video_ssrc)||l.audio_ssrc&&!this._p2pChannel.isPreSubScribe(l.audio_ssrc)||!l.video_ssrc&&!l.audio_ssrc),s.length>0){let l=await this._gateway.subscribeAll(s,!0);((l==null?void 0:l.users)||[]).forEach(d=>{let{stream_id:u,video_error_code:h,audio_error_code:p,error_code:g}=d;(h||p||g)&&c.set(u,{video_error_code:h,audio_error_code:p,error_code:g})})}if(Array.from(c.entries()).length>0){let l=[];Array.from(c.entries()).forEach(d=>{let[u,h]=d,p=this.remoteUsers.find(g=>g.uid===u);if(p){let g;h.error_code||h.video_error_code&&h.audio_error_code?g=void 0:h.video_error_code?g=Z.VIDEO:h.audio_error_code&&(g=Z.AUDIO),l.push({user:p,mediaType:g})}}),l.length>0&&await this._p2pChannel.massUnsubscribeNoLock(l)}for(let l of n){let d=c.get(l.user.uid);if(d){let u=d.error_code||l.mediaType==="audio"&&d.audio_error_code||l.mediaType==="video"&&d.video_error_code;if(u){let h=Lu(u);f.error("user:".concat(l.user.uid," mediaType:").concat(l.mediaType," has massSubscribe error ").concat(h.desc)),l.error=new D(R.SUBSCRIBE_FAILED,"code ".concat(u,": ").concat(h.desc))}}l.error||(l.mediaType==="video"?l.track=l.user.videoTrack:l.track=l.user.audioTrack)}return this.store.massSubscribe(n.filter(l=>!l.error).map(l=>({userId:l.user.uid,type:l.mediaType})),void 0,Date.now()),n.forEach(l=>{var d;Q.subscribe(this.store.sessionId,{succ:!!l.error,ec:((d=l.error)===null||d===void 0?void 0:d.code)||null,video:l.mediaType===Z.VIDEO,audio:l.mediaType===Z.AUDIO,peerid:l.user.uid,subscribeRequestid:l.mediaType===Z.VIDEO?l.user._videoSSRC:l.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(l.user._videoSSRC)},!0)}),f.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(l=>{let{user:d,mediaType:u}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(u)}).join("; "))),n}catch(c){throw await this._p2pChannel.massUnsubscribeNoLock(e),c}}finally{o(),i()}}async unsubscribe(e,t,r){if(!(e instanceof pa)){let n=this.remoteUsers.find(o=>o.uid===e);if(!n)throw new D(R.INVALID_REMOTE_USER,"user is not in the channel");e=n}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&Ot(t,"mediaType",["audio","video"]),!this._joinInfo)throw new D(R.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(n=>n===e)){let n=new D(R.INVALID_REMOTE_USER,"user is not in the channel");throw f.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),n}f.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Jr)await this._p2pChannel.unsubscribe(e,t);else{let n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&t_(this._users,e),f.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(n){if(n.code===R.DISCONNECT_P2P)return void f.warning("disconnecting p2p, abort unsubscribe request.");throw f.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),n.toString()),n}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&Me(t,"id",0,65535,!0),!this._joinInfo)throw new D(R.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){let i=new D(R.INVALID_REMOTE_USER,"user is not in the channel");throw f.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){let i=e._dataChannels.find(n=>n.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){let i=new D(R.REMOTE_USER_IS_NOT_PUBLISHED);throw f.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}f.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{let i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),f.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===R.DISCONNECT_P2P)return void f.warning("disconnecting p2p, abort unsubscribe request.");throw f.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(Oo(e,"unsubscribeList"),!this._joinInfo)throw new D(R.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");f.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:i,mediaType:n}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(n,";")}).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:i,mediaType:n}=e[r];if(!i){let a=new D(R.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw f.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a}if(Ot(n,"mediaType",["video","audio",void 0]),!this._users.find(a=>a===i)){f.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(r,1);continue}let o=Pt.Video|Pt.LwoVideo;if(t.has(i)){let a=t.get(i),s;switch(n){case"video":s=a&o;break;case"audio":s=a&Pt.Audio;break;default:s=a&(Pt.Audio|o)}if(s){f.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(n," twice.")),e.splice(r,1);continue}n?n==="audio"?t.set(i,a|Pt.Audio):n==="video"&&t.set(i,a|o):t.set(i,a|Pt.Audio|o)}else n?n==="audio"?t.set(i,Pt.Audio):n==="video"&&t.set(i,o):t.set(i,Pt.Audio|o)}try{let r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),f.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:n,mediaType:o}=i;return"user: ".concat(n==null?void 0:n.uid,", mediaType: ").concat(o,";")}).join()))}catch(r){if(r.code===R.DISCONNECT_P2P)return void f.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw f.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new M(R.INVALID_PARAMS);Qe(r.width)||ig(r.width,"streamParameter.width"),Qe(r.height)||ig(r.height,"streamParameter.height"),Qe(r.framerate)||ig(r.framerate,"streamParameter.framerate"),Qe(r.bitrate)||Me(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&f.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),f.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,V.LocalVideoLowTrack)}async enableDualStream(){if(!ye().supportDualStream)throw Q.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new D(R.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new D(R.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Q.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Q.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),f.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new D(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(V.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Q.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Q.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),f.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){Ot(r,"role",["audience","host"])}(e),t&&MO(t),this.mode==="rtc"||this.mode==="p2p")throw f.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new D(R.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new D(R.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new D(R.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,f.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(jt(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new D(R.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new D(R.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Q.setProxyServer(this._proxyServer),f.setProxyServer(this._proxyServer),f.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new D(R.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new D(R.INVALID_OPERATION,"You have already set the proxy")}if(im(e))return this._turnServer={servers:e,mode:"original-manual"},void f.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>yx(r)),this._turnServer={servers:e,mode:"manual"},f.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new D(R.INVALID_OPERATION,"you should set license before join channel");if(jt(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new D(R.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,f.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new D(R.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new D(R.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new D(R.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new D(R.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,f.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new D(R.INVALID_OPERATION,"Stop proxy server after leave channel");Q.setProxyServer(),f.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",f.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new D(R.INVALID_PARAMS,"accessPoints is required.");Oo(e.accessPoints.serverList,"accessPoints.serverList"),jt(e.accessPoints.domain,"accessPoints.domain");let t=(h,p)=>{Me(h,p,0,65535,!0)},r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new D(R.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");w("CLOSE_AFB_FOR_LOCAL_AP")&&(Le("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Le("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,n=e.accessPoints.domain,o=e.accessPoints.serverList.map(h=>i.test(h)?"".concat(h.replace(/\./g,"-"),".").concat(n):h),a=o.map(h=>"".concat(h,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Le("WEBCS_DOMAIN",a),Le("WEBCS_DOMAIN_BACKUP_LIST",a),Le("GATEWAY_DOMAINS",[n]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Oo(e.report.hostname,"report.hostname"),Le("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Le("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Le("EVENT_REPORT_DOMAIN",o[0]),Le("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),Le("STATS_COLLECTOR_PORT",s),e.report?Le("ENABLE_EVENT_REPORT",!0):Le("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Oo(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),Le("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Oo(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=o;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),Le("CDS_AP",d.map(h=>"".concat(h,":").concat(u))),e.cds?Le("ENABLE_CONFIG_DISTRIBUTE",!0):Le("ENABLE_CONFIG_DISTRIBUTE",!1),f.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Oo(e,"serverList"),jt(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new D(R.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>r.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Le("WEBCS_DOMAIN",e),Le("WEBCS_DOMAIN_BACKUP_LIST",e),Le("GATEWAY_DOMAINS",[t]),Le("EVENT_REPORT_DOMAIN",e[0]),Le("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Le("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),f.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ot(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw f.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else f.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Ot(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let r=this._users.find(i=>i.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw f.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}f.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Ot(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw f.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}f.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,i){(function(o){Ot(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),jt(t,"secret");let n=["aes-128-gcm2","aes-256-gcm2"];if(Y(n).call(n,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new D(R.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new D(R.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Po(i,"encryptDataStream"),!Y(n).call(n,e))throw new D(R.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||f.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=Ma(r))}async renewToken(e){if(jt(e,"token",1,2047),!this._key||!this._joinInfo)throw new D(R.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let r=await this._renewTokenMutex.lock();try{if(w("USE_NEW_TOKEN")){f.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let i=await $X(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Rt);f.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else f.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});f.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,f.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?f.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(me.VOLUME_INDICATOR,e)},w("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new D(R.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new D(R.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new D(R.LIVE_STREAMING_TASK_CONFLICT);let r=t?Mo.TRANSCODE:Mo.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(Mo.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new D(R.INVALID_PARAMS,"can not find live streaming url to stop");await K.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QN(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QN(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new D(R.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let n=new TextEncoder;e.payload=n.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Y(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(n,o,a){var s;let c=xn(s=Array.from(a)).call(s,(_,E)=>_+E,0),l={serverTs:0,seq:u9++,length:a.length,checkSum:c},d=new Uint8Array(jO(c,2)),u=new ArrayBuffer(oc),h=new DataView(u);h.setUint32(0,l.serverTs),h.setUint16(4,l.seq),h.setUint16(6,l.length),h.setUint16(8,l.checkSum);let p=16-a.length%16;a=xO(a,new Uint8Array(p));let g=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n,tagLength:WO,additionalData:d},o,a);return xO(new Uint8Array(u),new Uint8Array(g))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new D(R.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ne.DATA_STREAM,{payload:Ma(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-SJ},!r)}sendMetadata(e){if(!this._joinInfo)throw new D(R.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new D(R.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ne.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ma(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(p9),!this._joinInfo)throw new D(R.INVALID_OPERATION,"can not send custom report, not joined");await Q.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Ot(t.spatialLayer,"spatialLayer",[0,1,2,3]),Ot(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw f.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:r}=e;if(Po(t,"apRTM"),Me(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,f.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(f.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Vr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&KV(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new cr("client-publish"),this._subscribeMutex=new cr("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;let i=e||jc();e?f.debug("[".concat(this._clientId,"] new Session ").concat(i)):f.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));let n=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i;let o={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:n,clientRole:this.role==="audience"?2:1};Q.sessionInit(this._sessionId,An({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new D(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&w("FORCE_TURN")&&!w("TURN_ENABLE_TCP")&&!w("TURN_ENABLE_UDP"))throw new D(R.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");f.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof Jr){let i=(await r.next()).value;if(i){try{await this._gateway.sendExtensionMessage(ut.PUBLISH,i,!0)}catch(n){throw r.throw(n),n}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let i=(await r.next()).value;if(i){var t;let n;try{n=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==R.DISCONNECT_P2P)throw r.throw(o),o}await r.next(((t=n)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let n of e)n instanceof We&&n._encoderConfig&&this._gateway.setVideoProfile(n._encoderConfig),!n.muted&&n.enabled||await this._p2pChannel.muteLocalTrack(n)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===R.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new D(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new D(R.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));f.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await r.next()).value;if(i){var t;let n;try{n=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==R.DISCONNECT_P2P)throw r.throw(o),o}r.next(((t=n)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===R.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new D(R.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let r=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Dd("LiveStreaming").create(i));var i;return r.onLiveStreamError=(n,o)=>{Q.reportApiInvoke(this._sessionId,{name:wt.ON_LIVE_STREAM_ERROR,options:[n,o],tag:nt.TRACER}).onSuccess(),this.safeEmit(me.LIVE_STREAMING_ERROR,n,o)},r.onLiveStreamWarning=(n,o)=>{Q.reportApiInvoke(this._sessionId,{name:wt.ON_LIVE_STREAM_WARNING,options:[n,o],tag:nt.TRACER}).onSuccess(),this.safeEmit(me.LIVE_STREAMING_WARNING,n,o)},r.on(cv.REQUEST_WORKER_MANAGER_LIST,(n,o,a)=>{if(!this._joinInfo)return a(new D(R.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(s,c,l,d){let u=w("UAP_AP").slice(0,w("AJAX_REQUEST_CONCURRENT")).map(h=>c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap"));return await GX(u,s,c,l,d)})(n,this._joinInfo,this._axiosCancelSource.token,Rt).then(o).catch(a)}),r};return e===Mo.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new D(R.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},Dd("ChannelMediaRelay").create(e));i.on("state",n=>{n===Hr.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(me.CHANNEL_MEDIA_RELAY_STATE,n)}),i.on("event",n=>{this.safeEmit(me.CHANNEL_MEDIA_RELAY_EVENT,n)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(n,o)=>{var a;n==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(o))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:r,deleted:i}=e,n=[];if(t){let o=[];this._users.forEach(a=>{a._dataChannels.forEach(s=>{r.every(c=>c.uid!==a._uintid||c.stream_id!==s.id)&&o.push({uid:a._uintid,stream_id:s.id,ordered:s.ordered,max_retrans_times:s.maxRetransmits,metadata:s.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(r)&&r.length>0&&r.forEach(o=>{let{uid:a,stream_id:s,ordered:c,max_retrans_times:l,metadata:d}=o,u=this._users.find(h=>h._uintid===a);if(!u)return void f.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(f.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(a)),Y(n).call(n,u)||n.push(u),u._uintid||(u._uintid=a),u._dataChannels.findIndex(h=>h.id===o.stream_id)===-1){let h={id:s,ordered:!!c,maxRetransmits:l,metadata:d},p=function(g){return uD(g,!0)}(h);u._dataChannels.push(p),f.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published datachannel")),t||this.safeEmit(me.USER_PUBLISHED,u,"datachannel",h)}this._p2pChannel.hasPendingRemoteDataChannel(u,o.stream_id)&&(f.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(u.uid," after reconnect.")),this._subscribeDataChannel(u,o.stream_id).catch(h=>{f.error("[".concat(this._clientId,"] resubscribe datachannel error"),h.toString())}))}),t&&(this.safeEmit(me.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(o=>{let{uid:a,stream_id:s}=o,c=this._users.find(d=>d._uintid===a);if(!c)return void f.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let l=c._dataChannels.find(d=>d.id===o.stream_id);l&&(f.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(a)),this._p2pChannel.unsubscribeDataChannel(c,[l]).then(d=>{if(c._dataChannels=c._dataChannels.filter(u=>u!==l),d)return this._gateway.unsubscribeDataChannel(d,c.uid)}),f.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished datachannel ,id:").concat(l.id)),this.safeEmit(me.USER_UNPUBLISHED,c,"datachannel",l._config))})}_handleRemoveDataChannels(e){let t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){f.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let r=()=>{f.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(me.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),r()}}else f.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(qt.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(qt.CONNECTION_STATE_CHANGE,(e,t,r)=>{var i;if(r===Pe.FALLBACK)return;let n=()=>{this.safeEmit(me.CONNECTION_STATE_CHANGE,e,t,r)};if(Q.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:wt.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:nt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),f.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void n();if(e==="RECONNECTING")this._users.forEach(a=>{a._trust_in_room_=!1,a._trust_audio_enabled_state_=!1,a._trust_video_enabled_state_=!1,a._trust_audio_mute_state_=!1,a._trust_video_mute_state_=!1,a._trust_audio_stream_added_state_=!1,a._trust_video_stream_added_state_=!1,a._is_pre_created||(a._audio_pre_subscribed||(a._audioSSRC=void 0,a._audioOrtc=void 0),a._video_pre_subscribed||(a._videoSSRC=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),a._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((a,s)=>{this._gateway.setStreamFallbackOption(s,a).catch(c=>{f.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),c)})}),this._remoteStreamTypeCacheMap.forEach((a,s)=>{this._gateway.setRemoteVideoStreamType(s,a).catch(c=>{f.warning("[".concat(this._clientId,"] auto set remote stream type failed"),c)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{f.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(a=>{f.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(a))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(a=>!a._trust_in_room_).forEach(a=>{f.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(a.uid)),this._handleUserOffline({uid:a.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(a=>{a._trust_audio_mute_state_||(f.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,Z.AUDIO,!1)),a._trust_video_mute_state_||(f.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,Z.VIDEO,!1)),a._trust_audio_enabled_state_||(f.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(a.uid)),this._handleSetStreamLocalEnable("audio",a.uid,!0)),a._trust_video_enabled_state_||(f.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(a.uid)),this._handleSetStreamLocalEnable("video",a.uid,!0)),a._trust_video_stream_added_state_||(f.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(a.uid)),this._handleResetAddStream(a,"video")),a._trust_audio_stream_added_state_||(f.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(a.uid)),this._handleResetAddStream(a,"audio")),a._video_added_||a._audio_added_||(f.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(a.uid)),this._handleRemoveStream({uid:a.uid,uint_id:a._uintid}))}))},1e3))}n()}),this._gateway.on(qt.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new D(R.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r,i=await mD(An(An({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(r=i.ap,ED(i),this._joinInfo.preload=!0):(r=await vv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Rt,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);let n=[];r.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:a}=o,[s,c]=a.split(":");this._joinInfo&&this._joinInfo.proxyServer?n.push({proxy:this._joinInfo.proxyServer,host:s,port:c}):n.push({host:s,port:c})}),e(n)}catch(r){t(r)}}),this._gateway.on(qt.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(me.NETWORK_QUALITY,e)}),this._gateway.on(qt.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(me.STREAM_TYPE_CHANGED,e,t),Q.reportApiInvoke(this._sessionId,{name:wt.STREAM_TYPE_CHANGE,options:[e,t],tag:nt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(qt.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(qt.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let i=await this._p2pChannel.getEstablishParams();w("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){r(i)}}),this._gateway.on(qt.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r=hN(e.ortc,t,e.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(r)}),this._gateway.on(qt.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:n,cid:o}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(n),icePwd:"".concat(o,"_").concat(n)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=w("FINGERPRINT"))!==null&&i!==void 0?i:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(_e.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(_e.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(_e.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(_e.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(_e.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(_e.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(_e.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(_e.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(_e.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Z.AUDIO,!0)),this._gateway.signal.on(_e.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Z.AUDIO,!1)),this._gateway.signal.on(_e.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Z.VIDEO,!0)),this._gateway.signal.on(_e.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Z.VIDEO,!1)),this._gateway.signal.on(_e.RECEIVE_METADATA,e=>{let t=Ts(e.metadata);this.safeEmit(me.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(_e.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=Ts(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Y(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<oc)throw new D(R.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(oc));r=await async function(n,o,a){let s=a.subarray(0,oc),c=s.slice(8,oc),l=(c[0]<<8)+c[1],d=(s[6]<<8)+s[7],u=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:n,tagLength:WO,additionalData:new Uint8Array(jO(l,2))},o,a.subarray(oc));return new Uint8Array(u).subarray(0,d)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let i=0;if(e.ordered||e.syncWithAudio){let n=this._p2pChannel.getStats(),o=this.remoteUsers.find(s=>s.uid===e.uid),a=n==null?void 0:n.audioRecv.find(s=>s.ssrc===(o==null?void 0:o._audioSSRC));i=a==null?void 0:a.jitterBufferMs}i==null&&(i=0),vJ(An(An({},e),{},{payload:r}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(_e.ON_CRYPT_ERROR,()=>{Wa(()=>{f.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(me.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(_e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{f.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Pe.TOKEN_EXPIRE),this.safeEmit(me.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(_e.ON_STREAM_FALLBACK_UPDATE,e=>{f.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(me.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(_e.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),f.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(_e.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(_e.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(oe.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ne.PUBLISH:{if(!t)return;let n=t.ortc;if(n){var r,i;let o=n.some(c=>{let{stream_type:l}=c;return l===be.Audio}),a=n.some(c=>{let{stream_type:l}=c;return l!==be.Audio}),s=n.some(c=>{let{stream_type:l}=c;return l===be.Screen||l===be.ScreenLow});t.state==="offer"&&Q.publish(this._joinInfo.sid,{eventElapse:ar.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:R.TIMEOUT,audio:o,video:a,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:s,audioName:o?(r=n.find(c=>{let{stream_type:l}=c;return l===be.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:a?(i=n.find(c=>{let{stream_type:l}=c;return l!==be.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case ne.SUBSCRIBE:t&&Q.subscribe(this._joinInfo.sid,{succ:!1,ec:R.TIMEOUT,audio:t.stream_type===Z.AUDIO,video:t.stream_type===Z.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ar.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(_e.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(_e.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;w("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!es(i.string_id||i.stream_id,this.channelName)));let t=[],r=[];for(let i of e.users){let n=this._users.find(d=>d._uintid===i.stream_id);n?n._trust_in_room_=!0:(n=new pa(i.string_id||i.stream_id,i.stream_id),this._users.push(n),this.getListeners(me.PUBLISHED_USER_LIST).length===0&&(f.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(me.USER_JOINED,n)));let o=Pt.Audio&i.stream_type,a=(Pt.Video|Pt.LwoVideo)&i.stream_type,s=(65280&i.stream_type)!=0,c=o&&n.hasAudio,l=a&&n.hasVideo;a&&(n._trust_video_stream_added_state_=!0,n._video_added_=!0,n._videoSSRC=i.video_ssrc,n._rtxSsrcId=i.video_rtx),o&&(n._trust_audio_stream_added_state_=!0,n._audio_added_=!0,n._audioSSRC=i.audio_ssrc),o&&!c&&this.getListeners(me.PUBLISHED_USER_LIST).length===0&&(f.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published audio")),this.safeEmit(me.USER_PUBLISHED,n,"audio")),a&&!l&&this.getListeners(me.PUBLISHED_USER_LIST).length===0&&(f.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published video")),this.safeEmit(me.USER_PUBLISHED,n,"video")),(o&&!c||a&&!l||s)&&t.push(n),a&&this._p2pChannel.hasPendingRemoteMedia(n,"video")&&r.push({user:n,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(n,"audio")&&r.push({user:n,mediaType:"audio"})}r.length>0&&(f.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(i=>{f.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(me.PUBLISHED_USER_LIST).length>0?w("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(f.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(me.PUBLISHED_USER_LIST,t)):f.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(_e.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof yp&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var i;return Y(i=Object.keys(am)).call(i,r)}))})}_handleP2PEvents(){this._gateway.signal.on(_e.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ut.PUBLISH,(e,t,r)=>{let{uid:i}=e;e.forEach(n=>{let{kind:o,ssrcs:a,mid:s,isMuted:c}=n;this._handleP2PAddAudioOrVideoStream(o,i,a[0].ssrcId,s);let l=this._users.find(d=>d.uid===i);return l&&this._p2pChannel instanceof Jr?this._p2pChannel.mockSubscribe(l,o,a[0].ssrcId,s).then(()=>{t()}).catch(r):t(),this._handleMuteStream(i,o,!!c)})}),this._gateway.signal.on(ut.CALL,async(e,t,r)=>{if(this._p2pChannel instanceof Jr)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(n){r(n)}}),this._gateway.signal.on(oe.P2P_CONNECTION,async e=>{this._p2pChannel instanceof Jr&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(ut.UNPUBLISH,async(e,t,r)=>{if(this._p2pChannel instanceof Jr){let{unpubMsg:i,uid:n}=e,o=this._users.find(a=>a.uid===n);if(!o)return f.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n)),void t();try{i.forEach(async a=>{let{stream_type:s}=a,c=s===be.Audio?Z.AUDIO:Z.VIDEO;await this._p2pChannel.unsubscribe(o,c),this._handleMuteStream(n,c,!0)}),t()}catch(a){r(a)}}}),this._gateway.signal.on(ut.CONTROL,async(e,t)=>{let{action:r}=e;switch(r){case Ta.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Z.VIDEO,!0);break;case Ta.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Z.AUDIO,!0);break;case Ta.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Z.VIDEO,!1);break;case Ta.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Z.AUDIO,!1)}}),this._gateway.signal.on(ut.RESTART_ICE,async(e,t,r)=>{if(this._p2pChannel instanceof Jr)try{let{direction:i,iceParameter:n}=e;i!==wr.SEND_ONLY||n?t(await this._p2pChannel.restartICE(i,n)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){r(i)}}),this._gateway.signal.on(ut.CANDIDATE,e=>{if(this._p2pChannel instanceof Jr){let{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(ie.RequestP2PRestartICE,async(e,t,r)=>{try{let{direction:i}=e;t(await this._gateway.sendExtensionMessage(ut.RESTART_ICE,e,i===wr.SEND_ONLY))}catch(i){r(i)}}),this._p2pChannel.on(ie.LocalCandidate,e=>{this._gateway.sendExtensionMessage(ut.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(ie.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(ut.CONTROL,e,!0),t()}catch(i){r(i)}}),this._p2pChannel.on(ie.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===R.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(ie.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===R.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(ie.StateChange,(e,t)=>{t===Oe.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(ie.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===R.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(ie.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===R.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(ie.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(ie.RequestRePublishDataChannel,(e,t,r)=>{K.all(e.map(async i=>{let n=await this._p2pChannel.publishDataChannel([i]);try{n.forEach(o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)})}catch(o){if(o.code!==R.DISCONNECT_P2P)throw o}})).then(t).catch(r)}),this._p2pChannel.on(ie.RequestReSubscribe,async(e,t,r)=>{try{for(let{user:i,kind:n}of e)n===Z.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){r(i)}}),this._p2pChannel.on(ie.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(ie.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(ie.MediaReconnectStart,e=>{this.safeEmit(me.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(ie.MediaReconnectEnd,e=>{this.safeEmit(me.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(ie.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(ie.RequestRestartICE,async e=>{if(this._p2pChannel instanceof Jr)return;let t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;let i=r.value,n;try{n=await this._gateway.restartICE({iceParameters:i})}catch(a){return void t.throw(a)}let{iceParameters:o}=function(a){let s=a.iceParameters;return{iceParameters:{iceUfrag:s.iceUfrag,icePwd:s.icePwd}}}(n);await t.next({remoteIceParameters:o})}),this._p2pChannel.on(ie.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ie.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:n,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:i}),a=hN(n,o);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ie.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(ie.P2PLost,()=>{this.safeEmit(me.P2P_LOST,this.store.uid)}),this._p2pChannel.on(ie.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(ie.ConnectionTypeChange,e=>{this.safeEmit(me.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(ie.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(ie.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let r=(t={config:e},Dd("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);let{appId:i,cname:n,sid:o,token:a,uid:s,cid:c,vid:l}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:n,sid:o,token:a,uid:s,cid:c,vid:l?Number(l):0},Rt)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(xt.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(me.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===Ji.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(me.CONTENT_INSPECT_ERROR,new D(R.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(xt.INSPECT_RESULT,(t,r)=>{var i;if((r==null?void 0:r.code)===R.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return f.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(me.CONTENT_INSPECT_RESULT,t,r)}),e.on(xt.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Po(e,"enabled"),e){if(!t)throw new D(R.INVALID_PARAMS,"config is required");if(JV(t),!this._joinInfo)throw new D(R.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let i=(r={config:t},Dd("ImageModeration").create(r));this._moderation=i,this.handleImageModerationEvents(i);let{appId:n,cname:o,sid:a,token:s,uid:c,cid:l,vid:d}=this._joinInfo;await i.init({appId:n,areaCode:"",cname:o,sid:a,token:s,uid:c,cid:l,vid:d?Number(d):0},Rt)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var r;if(!this._moderation)throw new D(R.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(In.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(me.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===Ai.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new D(R.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(In.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Ot(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new D(R.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,f.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return f.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Po(e,"enabled"),Le("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},X(z.prototype,"leave",[wD],Object.getOwnPropertyDescriptor(z.prototype,"leave"),z.prototype),X(z.prototype,"publish",[AD],Object.getOwnPropertyDescriptor(z.prototype,"publish"),z.prototype),X(z.prototype,"unpublish",[OD],Object.getOwnPropertyDescriptor(z.prototype,"unpublish"),z.prototype),X(z.prototype,"subscribe",[bD],Object.getOwnPropertyDescriptor(z.prototype,"subscribe"),z.prototype),X(z.prototype,"presubscribe",[ND],Object.getOwnPropertyDescriptor(z.prototype,"presubscribe"),z.prototype),X(z.prototype,"massSubscribe",[DD],Object.getOwnPropertyDescriptor(z.prototype,"massSubscribe"),z.prototype),X(z.prototype,"unsubscribe",[PD],Object.getOwnPropertyDescriptor(z.prototype,"unsubscribe"),z.prototype),X(z.prototype,"massUnsubscribe",[kD],Object.getOwnPropertyDescriptor(z.prototype,"massUnsubscribe"),z.prototype),X(z.prototype,"setLowStreamParameter",[LD],Object.getOwnPropertyDescriptor(z.prototype,"setLowStreamParameter"),z.prototype),X(z.prototype,"enableDualStream",[MD],Object.getOwnPropertyDescriptor(z.prototype,"enableDualStream"),z.prototype),X(z.prototype,"disableDualStream",[UD],Object.getOwnPropertyDescriptor(z.prototype,"disableDualStream"),z.prototype),X(z.prototype,"setClientRole",[xD],Object.getOwnPropertyDescriptor(z.prototype,"setClientRole"),z.prototype),X(z.prototype,"setProxyServer",[VD],Object.getOwnPropertyDescriptor(z.prototype,"setProxyServer"),z.prototype),X(z.prototype,"setTurnServer",[FD],Object.getOwnPropertyDescriptor(z.prototype,"setTurnServer"),z.prototype),X(z.prototype,"setLicense",[BD],Object.getOwnPropertyDescriptor(z.prototype,"setLicense"),z.prototype),X(z.prototype,"startProxyServer",[jD],Object.getOwnPropertyDescriptor(z.prototype,"startProxyServer"),z.prototype),X(z.prototype,"stopProxyServer",[GD],Object.getOwnPropertyDescriptor(z.prototype,"stopProxyServer"),z.prototype),X(z.prototype,"setLocalAccessPointsV2",[WD],Object.getOwnPropertyDescriptor(z.prototype,"setLocalAccessPointsV2"),z.prototype),X(z.prototype,"setLocalAccessPoints",[HD],Object.getOwnPropertyDescriptor(z.prototype,"setLocalAccessPoints"),z.prototype),X(z.prototype,"setRemoteDefaultVideoStreamType",[KD],Object.getOwnPropertyDescriptor(z.prototype,"setRemoteDefaultVideoStreamType"),z.prototype),X(z.prototype,"setRemoteVideoStreamType",[zD],Object.getOwnPropertyDescriptor(z.prototype,"setRemoteVideoStreamType"),z.prototype),X(z.prototype,"setStreamFallbackOption",[YD],Object.getOwnPropertyDescriptor(z.prototype,"setStreamFallbackOption"),z.prototype),X(z.prototype,"setEncryptionConfig",[$D],Object.getOwnPropertyDescriptor(z.prototype,"setEncryptionConfig"),z.prototype),X(z.prototype,"renewToken",[qD],Object.getOwnPropertyDescriptor(z.prototype,"renewToken"),z.prototype),X(z.prototype,"enableAudioVolumeIndicator",[XD],Object.getOwnPropertyDescriptor(z.prototype,"enableAudioVolumeIndicator"),z.prototype),X(z.prototype,"startLiveStreaming",[JD],Object.getOwnPropertyDescriptor(z.prototype,"startLiveStreaming"),z.prototype),X(z.prototype,"setLiveTranscoding",[QD],Object.getOwnPropertyDescriptor(z.prototype,"setLiveTranscoding"),z.prototype),X(z.prototype,"stopLiveStreaming",[ZD],Object.getOwnPropertyDescriptor(z.prototype,"stopLiveStreaming"),z.prototype),X(z.prototype,"startChannelMediaRelay",[eP],Object.getOwnPropertyDescriptor(z.prototype,"startChannelMediaRelay"),z.prototype),X(z.prototype,"updateChannelMediaRelay",[tP],Object.getOwnPropertyDescriptor(z.prototype,"updateChannelMediaRelay"),z.prototype),X(z.prototype,"stopChannelMediaRelay",[rP],Object.getOwnPropertyDescriptor(z.prototype,"stopChannelMediaRelay"),z.prototype),X(z.prototype,"sendCustomReportMessage",[iP],Object.getOwnPropertyDescriptor(z.prototype,"sendCustomReportMessage"),z.prototype),X(z.prototype,"pickSVCLayer",[nP],Object.getOwnPropertyDescriptor(z.prototype,"pickSVCLayer"),z.prototype),X(z.prototype,"setRTMConfig",[oP],Object.getOwnPropertyDescriptor(z.prototype,"setRTMConfig"),z.prototype),X(z.prototype,"enableContentInspect",[aP],Object.getOwnPropertyDescriptor(z.prototype,"enableContentInspect"),z.prototype),X(z.prototype,"disableContentInspect",[sP],Object.getOwnPropertyDescriptor(z.prototype,"disableContentInspect"),z.prototype),X(z.prototype,"setImageModeration",[cP],Object.getOwnPropertyDescriptor(z.prototype,"setImageModeration"),z.prototype),X(z.prototype,"setP2PTransport",[lP],Object.getOwnPropertyDescriptor(z.prototype,"setP2PTransport"),z.prototype),X(z.prototype,"getJoinChannelServiceRecords",[dP],Object.getOwnPropertyDescriptor(z.prototype,"getJoinChannelServiceRecords"),z.prototype),X(z.prototype,"setPublishAudioFilterEnabled",[uP],Object.getOwnPropertyDescriptor(z.prototype,"setPublishAudioFilterEnabled"),z.prototype),z),QV=class Ov{constructor(t,r){v(this,"id",0),v(this,"element",void 0),v(this,"peerPair",void 0),v(this,"context",void 0),v(this,"audioPlayerElement",void 0),v(this,"audioTrack",void 0),Ov.count+=1,this.id=Ov.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;let t=async(i,n)=>{let o=n==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(o),i.iceGatheringState==="complete"?i.localDescription:new K(a=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&a(i.localDescription)}})},r=async(i,n)=>await i.setRemoteDescription(n);try{let i=await t(this.peerPair[0],"offer");await r(this.peerPair[1],i);let n=await t(this.peerPair[1],"answer");await r(this.peerPair[0],n)}catch(i){throw new D(R.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(n){throw new D(R.LOCAL_AEC_ERROR,n.toString()).print()}if(!r)throw new D(R.LOCAL_AEC_ERROR,"no dest node when local aec").print();let i=r.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){f.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}},pP,Cp;v(QV,"count",0);var FJ=window.AudioContext||window.webkitAudioContext,BJ=new(pP=re({report:Q}),X((Cp=class{constructor(){v(this,"units",[]),v(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return f.debug("the system does not need to process local aec"),-1;this.context||(this.context=new FJ);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new QV(e,this.context),this.units.push(t)),t.startEchoCancellation(),f.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return ve().name!==Ne.SAFARI}}).prototype,"processExternalMediaAEC",[pP],Object.getOwnPropertyDescriptor(Cp.prototype,"processExternalMediaAEC"),Cp.prototype),Cp);function fP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function _P(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fP(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fP(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Zg=window||document;function ZV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Zg)return;let r=rt._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);let i=n=>{if(!(n&&n.blockedURI&&(rt.onSecurityPolicyViolation||rt.getListeners(eo.SECURITY_POLICY_VIOLATION).length>0)))return;let o=n.blockedURI;w("CSP_DETECTED_HOSTNAME_LIST").some(a=>Y(o).call(o,a))&&(rt.onSecurityPolicyViolation&&typeof rt.onSecurityPolicyViolation=="function"&&rt.onSecurityPolicyViolation(n),rt.getListeners(eo.SECURITY_POLICY_VIOLATION).length>0&&rt.safeEmit(eo.SECURITY_POLICY_VIOLATION,n))};r&&Zg.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||rt.getListeners(eo.SECURITY_POLICY_VIOLATION).length>0)&&Zg.addEventListener("securitypolicyviolation",i),rt._cspEventHandlerPointer=i}var jJ=Dr,GJ=Q2,mP=RegExp.prototype,WJ=function(e){return e===mP||jJ(mP,e)?GJ(e):e.flags},mr=_t(WJ);function jl(e){let t=e.length;for(;--t>=0;)e[t]=0}var BR=256,eF=286,Jd=30,Qd=15,bv=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),mf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),HJ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),EP=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),No=new Array(576);jl(No);var Zd=new Array(60);jl(Zd);var Gu=new Array(512);jl(Gu);var Wu=new Array(256);jl(Wu);var jR=new Array(29);jl(jR);var p_=new Array(Jd);function eS(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}var gP,SP,TP;function tS(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}jl(p_);var tF=e=>e<256?Gu[e]:Gu[256+(e>>>7)],Hu=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},_i=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,Hu(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},to=(e,t,r)=>{_i(e,r[2*t],r[2*t+1])},rF=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},iF=(e,t,r)=>{let i=new Array(16),n,o,a=0;for(n=1;n<=Qd;n++)a=a+r[n-1]<<1,i[n]=a;for(o=0;o<=t;o++){let s=e[2*o+1];s!==0&&(e[2*o]=rF(i[s]++,s))}},nF=e=>{let t;for(t=0;t<eF;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Jd;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},oF=e=>{e.bi_valid>8?Hu(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},vP=(e,t,r,i)=>{let n=2*t,o=2*r;return e[n]<e[o]||e[n]===e[o]&&i[t]<=i[r]},rS=(e,t,r)=>{let i=e.heap[r],n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&vP(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!vP(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i},yP=(e,t,r)=>{let i,n,o,a,s=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+s++],i+=(255&e.pending_buf[e.sym_buf+s++])<<8,n=e.pending_buf[e.sym_buf+s++],i===0?to(e,n,t):(o=Wu[n],to(e,o+BR+1,t),a=bv[o],a!==0&&(n-=jR[o],_i(e,n,a)),i--,o=tF(i),to(e,o,r),a=mf[o],a!==0&&(i-=p_[o],_i(e,i,a)));while(s<e.sym_next);to(e,256,t)},iS=(e,t)=>{let r=t.dyn_tree,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.elems,a,s,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<o;a++)r[2*a]!==0?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):r[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,r[2*c]=1,e.depth[c]=0,e.opt_len--,n&&(e.static_len-=i[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)rS(e,r,a);c=o;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],rS(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,r[2*c]=r[2*a]+r[2*s],e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,r[2*a+1]=r[2*s+1]=c,e.heap[1]=c++,rS(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((d,u)=>{let h=u.dyn_tree,p=u.max_code,g=u.stat_desc.static_tree,_=u.stat_desc.has_stree,E=u.stat_desc.extra_bits,S=u.stat_desc.extra_base,T=u.stat_desc.max_length,y,I,O,b,k,P,j=0;for(b=0;b<=Qd;b++)d.bl_count[b]=0;for(h[2*d.heap[d.heap_max]+1]=0,y=d.heap_max+1;y<573;y++)I=d.heap[y],b=h[2*h[2*I+1]+1]+1,b>T&&(b=T,j++),h[2*I+1]=b,I>p||(d.bl_count[b]++,k=0,I>=S&&(k=E[I-S]),P=h[2*I],d.opt_len+=P*(b+k),_&&(d.static_len+=P*(g[2*I+1]+k)));if(j!==0){do{for(b=T-1;d.bl_count[b]===0;)b--;d.bl_count[b]--,d.bl_count[b+1]+=2,d.bl_count[T]--,j-=2}while(j>0);for(b=T;b!==0;b--)for(I=d.bl_count[b];I!==0;)O=d.heap[--y],O>p||(h[2*O+1]!==b&&(d.opt_len+=(b-h[2*O+1])*h[2*O],h[2*O+1]=b),I--)}})(e,t),iF(r,l,e.bl_count)},RP=(e,t,r)=>{let i,n,o=-1,a=t[1],s=0,c=7,l=4;for(a===0&&(c=138,l=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=t[2*(i+1)+1],++s<c&&n===a||(s<l?e.bl_tree[2*n]+=s:n!==0?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=n,a===0?(c=138,l=3):n===a?(c=6,l=3):(c=7,l=4))},CP=(e,t,r)=>{let i,n,o=-1,a=t[1],s=0,c=7,l=4;for(a===0&&(c=138,l=3),i=0;i<=r;i++)if(n=a,a=t[2*(i+1)+1],!(++s<c&&n===a)){if(s<l)do to(e,n,e.bl_tree);while(--s!=0);else n!==0?(n!==o&&(to(e,n,e.bl_tree),s--),to(e,16,e.bl_tree),_i(e,s-3,2)):s<=10?(to(e,17,e.bl_tree),_i(e,s-3,3)):(to(e,18,e.bl_tree),_i(e,s-11,7));s=0,o=n,a===0?(c=138,l=3):n===a?(c=6,l=3):(c=7,l=4)}},IP=!1,aF=(e,t,r,i)=>{_i(e,0+(i?1:0),3),oF(e),Hu(e,r),Hu(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},KJ=e=>{IP||((()=>{let t,r,i,n,o,a=new Array(16);for(i=0,n=0;n<28;n++)for(jR[n]=i,t=0;t<1<<bv[n];t++)Wu[i++]=n;for(Wu[i-1]=n,o=0,n=0;n<16;n++)for(p_[n]=o,t=0;t<1<<mf[n];t++)Gu[o++]=n;for(o>>=7;n<Jd;n++)for(p_[n]=o<<7,t=0;t<1<<mf[n]-7;t++)Gu[256+o++]=n;for(r=0;r<=Qd;r++)a[r]=0;for(t=0;t<=143;)No[2*t+1]=8,t++,a[8]++;for(;t<=255;)No[2*t+1]=9,t++,a[9]++;for(;t<=279;)No[2*t+1]=7,t++,a[7]++;for(;t<=287;)No[2*t+1]=8,t++,a[8]++;for(iF(No,287,a),t=0;t<Jd;t++)Zd[2*t+1]=5,Zd[2*t]=rF(t,5);gP=new eS(No,bv,257,eF,Qd),SP=new eS(Zd,mf,0,Jd,Qd),TP=new eS(new Array(0),HJ,0,19,7)})(),IP=!0),e.l_desc=new tS(e.dyn_ltree,gP),e.d_desc=new tS(e.dyn_dtree,SP),e.bl_desc=new tS(e.bl_tree,TP),e.bi_buf=0,e.bi_valid=0,nF(e)},zJ=(e,t,r,i)=>{let n,o,a=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(s=>{let c,l=4093624447;for(c=0;c<=31;c++,l>>>=1)if(1&l&&s.dyn_ltree[2*c]!==0)return 0;if(s.dyn_ltree[18]!==0||s.dyn_ltree[20]!==0||s.dyn_ltree[26]!==0)return 1;for(c=32;c<BR;c++)if(s.dyn_ltree[2*c]!==0)return 1;return 0})(e)),iS(e,e.l_desc),iS(e,e.d_desc),a=(s=>{let c;for(RP(s,s.dyn_ltree,s.l_desc.max_code),RP(s,s.dyn_dtree,s.d_desc.max_code),iS(s,s.bl_desc),c=18;c>=3&&s.bl_tree[2*EP[c]+1]===0;c--);return s.opt_len+=3*(c+1)+5+5+4,c})(e),n=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=n&&(n=o)):n=o=r+5,r+4<=n&&t!==-1?aF(e,t,r,i):e.strategy===4||o===n?(_i(e,2+(i?1:0),3),yP(e,No,Zd)):(_i(e,4+(i?1:0),3),((s,c,l,d)=>{let u;for(_i(s,c-257,5),_i(s,l-1,5),_i(s,d-4,4),u=0;u<d;u++)_i(s,s.bl_tree[2*EP[u]+1],3);CP(s,s.dyn_ltree,c-1),CP(s,s.dyn_dtree,l-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),yP(e,e.dyn_ltree,e.dyn_dtree)),nF(e),i&&oF(e)},YJ=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Wu[r]+BR+1)]++,e.dyn_dtree[2*tF(t)]++),e.sym_next===e.sym_end),$J=e=>{_i(e,2,3),to(e,256,No),(t=>{t.bi_valid===16?(Hu(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},qJ={_tr_init:KJ,_tr_stored_block:aF,_tr_flush_block:zJ,_tr_tally:YJ,_tr_align:$J},Ku=(e,t,r,i)=>{let n=65535&e|0,o=e>>>16&65535|0,a=0;for(;r!==0;){a=r>2e3?2e3:r,r-=a;do n=n+t[i++]|0,o=o+n|0;while(--a);n%=65521,o%=65521}return n|o<<16|0},XJ=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})()),Cr=(e,t,r,i)=>{let n=XJ,o=i+r;e^=-1;for(let a=i;a<o;a++)e=e>>>8^n[255&(e^t[a])];return-1^e},js={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Gl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:JJ,_tr_stored_block:Nv,_tr_flush_block:QJ,_tr_tally:Ua,_tr_align:ZJ}=qJ,{Z_NO_FLUSH:xa,Z_PARTIAL_FLUSH:eQ,Z_FULL_FLUSH:tQ,Z_FINISH:an,Z_BLOCK:wP,Z_OK:Lr,Z_STREAM_END:AP,Z_STREAM_ERROR:co,Z_DATA_ERROR:rQ,Z_BUF_ERROR:nS,Z_DEFAULT_COMPRESSION:iQ,Z_FILTERED:nQ,Z_HUFFMAN_ONLY:Ip,Z_RLE:oQ,Z_FIXED:aQ,Z_DEFAULT_STRATEGY:sQ,Z_UNKNOWN:cQ,Z_DEFLATED:um}=Gl,Dv=286,lQ=30,dQ=19,uQ=2*Dv+1,hQ=15,ys=258,lo=262,Cl=42,Rs=113,kd=666,Cs=(e,t)=>(e.msg=js[t],t),OP=e=>2*e-(e>4?9:0),fa=e=>{let t=e.length;for(;--t>=0;)e[t]=0},pQ=e=>{let t,r,i,n=e.w_size;t=e.hash_size,i=t;do r=e.head[--i],e.head[i]=r>=n?r-n:0;while(--t);t=n,i=t;do r=e.prev[--i],e.prev[i]=r>=n?r-n:0;while(--t)},Va=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,bi=e=>{let t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Pi=(e,t)=>{QJ(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,bi(e.strm)},ct=(e,t)=>{e.pending_buf[e.pending++]=t},md=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Pv=(e,t,r,i)=>{let n=e.avail_in;return n>i&&(n=i),n===0?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),e.state.wrap===1?e.adler=Ku(e.adler,t,n,r):e.state.wrap===2&&(e.adler=Cr(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},sF=(e,t)=>{let r,i,n=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-lo?e.strstart-(e.w_size-lo):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+ys,p=l[o+a-1],g=l[o+a];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do if(r=t,l[r+a]===g&&l[r+a-1]===p&&l[r]===l[o]&&l[++r]===l[o+1]){o+=2,r++;do;while(l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&o<h);if(i=ys-(h-o),o=h-ys,i>a){if(e.match_start=t,a=i,i>=s)break;p=l[o+a-1],g=l[o+a]}}while((t=u[t&d])>c&&--n!=0);return a<=e.lookahead?a:e.lookahead},Il=e=>{let t=e.w_size,r,i,n;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-lo)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),pQ(e),i+=t),e.strm.avail_in===0)break;if(r=Pv(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=Va(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=Va(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<lo&&e.strm.avail_in!==0)},cF=(e,t)=>{let r,i,n,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(r=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n||(n=e.strm.avail_out-n,i=e.strstart-e.block_start,r>i+e.strm.avail_in&&(r=i+e.strm.avail_in),r>n&&(r=n),r<o&&(r===0&&t!==an||t===xa||r!==i+e.strm.avail_in)))break;a=t===an&&r===i+e.strm.avail_in?1:0,Nv(e,0,0,a),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,bi(e.strm),i&&(i>r&&(i=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,r-=i),r&&(Pv(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(a===0);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==xa&&t!==an&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(Pv(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n,o=n>e.w_size?e.w_size:n,i=e.strstart-e.block_start,(i>=o||(i||t===an)&&t!==xa&&e.strm.avail_in===0&&i<=n)&&(r=i>n?n:i,a=t===an&&e.strm.avail_in===0&&r===i?1:0,Nv(e,e.block_start,r,a),e.block_start+=r,bi(e.strm)),a?3:1)},oS=(e,t)=>{let r,i;for(;;){if(e.lookahead<lo){if(Il(e),e.lookahead<lo&&t===xa)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Va(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-lo&&(e.match_length=sF(e,r)),e.match_length>=3)if(i=Ua(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Va(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Va(e,e.ins_h,e.window[e.strstart+1]);else i=Ua(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Pi(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===an?(Pi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Pi(e,!1),e.strm.avail_out===0)?1:2},_c=(e,t)=>{let r,i,n;for(;;){if(e.lookahead<lo){if(Il(e),e.lookahead<lo&&t===xa)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Va(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-lo&&(e.match_length=sF(e,r),e.match_length<=5&&(e.strategy===nQ||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,i=Ua(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=Va(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Pi(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=Ua(e,0,e.window[e.strstart-1]),i&&Pi(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Ua(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===an?(Pi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Pi(e,!1),e.strm.avail_out===0)?1:2};function Xn(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}var Ld=[new Xn(0,0,0,0,cF),new Xn(4,4,8,4,oS),new Xn(4,5,16,8,oS),new Xn(4,6,32,32,oS),new Xn(4,4,16,16,_c),new Xn(8,16,32,32,_c),new Xn(8,16,128,128,_c),new Xn(8,32,128,256,_c),new Xn(32,128,258,1024,_c),new Xn(32,258,258,4096,_c)];function fQ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=um,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*uQ),this.dyn_dtree=new Uint16Array(2*(2*lQ+1)),this.bl_tree=new Uint16Array(2*(2*dQ+1)),fa(this.dyn_ltree),fa(this.dyn_dtree),fa(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(hQ+1),this.heap=new Uint16Array(2*Dv+1),fa(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Dv+1),fa(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var zu=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Cl&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Rs&&t.status!==kd?1:0},lF=e=>{if(zu(e))return Cs(e,co);e.total_in=e.total_out=0,e.data_type=cQ;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Cl:Rs,e.adler=t.wrap===2?0:1,t.last_flush=-2,JJ(t),Lr},dF=e=>{let t=lF(e);return t===Lr&&(r=>{r.window_size=2*r.w_size,fa(r.head),r.max_lazy_match=Ld[r.level].max_lazy,r.good_match=Ld[r.level].good_length,r.nice_match=Ld[r.level].nice_length,r.max_chain_length=Ld[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},bP=(e,t,r,i,n,o)=>{if(!e)return co;let a=1;if(t===iQ&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),n<1||n>9||r!==um||i<8||i>15||t<0||t>9||o<0||o>aQ||i===8&&a!==1)return Cs(e,co);i===8&&(i=9);let s=new fQ;return e.state=s,s.strm=e,s.status=Cl,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=r,dF(e)},_Q=(e,t)=>{if(zu(e)||t>wP||t<0)return e?Cs(e,co):co;let r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===kd&&t!==an)return Cs(e,e.avail_out===0?nS:co);let i=r.last_flush;if(r.last_flush=t,r.pending!==0){if(bi(e),e.avail_out===0)return r.last_flush=-1,Lr}else if(e.avail_in===0&&OP(t)<=OP(i)&&t!==an)return Cs(e,nS);if(r.status===kd&&e.avail_in!==0)return Cs(e,nS);if(r.status===Cl&&r.wrap===0&&(r.status=Rs),r.status===Cl){let n=um+(r.w_bits-8<<4)<<8,o=-1;if(o=r.strategy>=Ip||r.level<2?0:r.level<6?1:r.level===6?2:3,n|=o<<6,r.strstart!==0&&(n|=32),n+=31-n%31,md(r,n),r.strstart!==0&&(md(r,e.adler>>>16),md(r,65535&e.adler)),e.adler=1,r.status=Rs,bi(e),r.pending!==0)return r.last_flush=-1,Lr}if(r.status===57){if(e.adler=0,ct(r,31),ct(r,139),ct(r,8),r.gzhead)ct(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ct(r,255&r.gzhead.time),ct(r,r.gzhead.time>>8&255),ct(r,r.gzhead.time>>16&255),ct(r,r.gzhead.time>>24&255),ct(r,r.level===9?2:r.strategy>=Ip||r.level<2?4:0),ct(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ct(r,255&r.gzhead.extra.length),ct(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Cr(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(ct(r,0),ct(r,0),ct(r,0),ct(r,0),ct(r,0),ct(r,r.level===9?2:r.strategy>=Ip||r.level<2?4:0),ct(r,3),r.status=Rs,bi(e),r.pending!==0)return r.last_flush=-1,Lr}if(r.status===69){if(r.gzhead.extra){let n=r.pending,o=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let s=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>n&&(e.adler=Cr(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex+=s,bi(e),r.pending!==0)return r.last_flush=-1,Lr;n=0,o-=s}let a=new Uint8Array(r.gzhead.extra);r.pending_buf.set(a.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>n&&(e.adler=Cr(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let n,o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(e.adler=Cr(e.adler,r.pending_buf,r.pending-o,o)),bi(e),r.pending!==0)return r.last_flush=-1,Lr;o=0}n=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ct(r,n)}while(n!==0);r.gzhead.hcrc&&r.pending>o&&(e.adler=Cr(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let n,o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(e.adler=Cr(e.adler,r.pending_buf,r.pending-o,o)),bi(e),r.pending!==0)return r.last_flush=-1,Lr;o=0}n=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ct(r,n)}while(n!==0);r.gzhead.hcrc&&r.pending>o&&(e.adler=Cr(e.adler,r.pending_buf,r.pending-o,o))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(bi(e),r.pending!==0))return r.last_flush=-1,Lr;ct(r,255&e.adler),ct(r,e.adler>>8&255),e.adler=0}if(r.status=Rs,bi(e),r.pending!==0)return r.last_flush=-1,Lr}if(e.avail_in!==0||r.lookahead!==0||t!==xa&&r.status!==kd){let n=r.level===0?cF(r,t):r.strategy===Ip?((o,a)=>{let s;for(;;){if(o.lookahead===0&&(Il(o),o.lookahead===0)){if(a===xa)return 1;break}if(o.match_length=0,s=Ua(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,s&&(Pi(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,a===an?(Pi(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(Pi(o,!1),o.strm.avail_out===0)?1:2})(r,t):r.strategy===oQ?((o,a)=>{let s,c,l,d,u=o.window;for(;;){if(o.lookahead<=ys){if(Il(o),o.lookahead<=ys&&a===xa)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(l=o.strstart-1,c=u[l],c===u[++l]&&c===u[++l]&&c===u[++l])){d=o.strstart+ys;do;while(c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&l<d);o.match_length=ys-(d-l),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(s=Ua(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(s=Ua(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),s&&(Pi(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,a===an?(Pi(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(Pi(o,!1),o.strm.avail_out===0)?1:2})(r,t):Ld[r.level].func(r,t);if(n!==3&&n!==4||(r.status=kd),n===1||n===3)return e.avail_out===0&&(r.last_flush=-1),Lr;if(n===2&&(t===eQ?ZJ(r):t!==wP&&(Nv(r,0,0,!1),t===tQ&&(fa(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),bi(e),e.avail_out===0))return r.last_flush=-1,Lr}return t!==an?Lr:r.wrap<=0?AP:(r.wrap===2?(ct(r,255&e.adler),ct(r,e.adler>>8&255),ct(r,e.adler>>16&255),ct(r,e.adler>>24&255),ct(r,255&e.total_in),ct(r,e.total_in>>8&255),ct(r,e.total_in>>16&255),ct(r,e.total_in>>24&255)):(md(r,e.adler>>>16),md(r,65535&e.adler)),bi(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Lr:AP)},mQ=(e,t)=>{let r=t.length;if(zu(e))return co;let i=e.state,n=i.wrap;if(n===2||n===1&&i.status!==Cl||i.lookahead)return co;if(n===1&&(e.adler=Ku(e.adler,t,r,0)),i.wrap=0,r>=i.w_size){n===0&&(fa(i.head),i.strstart=0,i.block_start=0,i.insert=0);let c=new Uint8Array(i.w_size);c.set(t.subarray(r-i.w_size,r),0),t=c,r=i.w_size}let o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Il(i);i.lookahead>=3;){let c=i.strstart,l=i.lookahead-2;do i.ins_h=Va(i,i.ins_h,i.window[c+3-1]),i.prev[c&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=c,c++;while(--l);i.strstart=c,i.lookahead=2,Il(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,i.wrap=n,Lr},eu={deflateInit:(e,t)=>bP(e,t,um,15,8,sQ),deflateInit2:bP,deflateReset:dF,deflateResetKeep:lF,deflateSetHeader:(e,t)=>zu(e)||e.state.wrap!==2?co:(e.state.gzhead=t,Lr),deflate:_Q,deflateEnd:e=>{if(zu(e))return co;let t=e.state.status;return e.state=null,t===Rs?Cs(e,rQ):Lr},deflateSetDictionary:mQ,deflateInfo:"pako deflate (from Nodeca project)"},EQ=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),hm={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let i in r)EQ(r,i)&&(e[i]=r[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;let r=new Uint8Array(t);for(let i=0,n=0,o=e.length;i<o;i++){let a=e[i];r.set(a,n),n+=a.length}return r}},uF=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{uF=!1}var Yu=new Uint8Array(256);for(let e=0;e<256;e++)Yu[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Yu[254]=Yu[254]=1;var $u={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,i,n,o,a=e.length,s=0;for(n=0;n<a;n++)r=e.charCodeAt(n),(64512&r)==55296&&n+1<a&&(i=e.charCodeAt(n+1),(64512&i)==56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),o=0,n=0;o<s;n++)r=e.charCodeAt(n),(64512&r)==55296&&n+1<a&&(i=e.charCodeAt(n+1),(64512&i)==56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},buf2string:(e,t)=>{let r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,n,o=new Array(2*r);for(n=0,i=0;i<r;){let a=e[i++];if(a<128){o[n++]=a;continue}let s=Yu[a];if(s>4)o[n++]=65533,i+=s-1;else{for(a&=s===2?31:s===3?15:7;s>1&&i<r;)a=a<<6|63&e[i++],s--;s>1?o[n++]=65533:a<65536?o[n++]=a:(a-=65536,o[n++]=55296|a>>10&1023,o[n++]=56320|1023&a)}}return((a,s)=>{if(s<65534&&a.subarray&&uF)return String.fromCharCode.apply(null,a.length===s?a:a.subarray(0,s));let c="";for(let l=0;l<s;l++)c+=String.fromCharCode(a[l]);return c})(o,n)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+Yu[e[r]]>t?r:t}},hF=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},pF=Object.prototype.toString,{Z_NO_FLUSH:gQ,Z_SYNC_FLUSH:SQ,Z_FULL_FLUSH:TQ,Z_FINISH:vQ,Z_OK:f_,Z_STREAM_END:yQ,Z_DEFAULT_COMPRESSION:RQ,Z_DEFAULT_STRATEGY:CQ,Z_DEFLATED:IQ}=Gl;function tu(e){this.options=hm.assign({level:RQ,method:IQ,chunkSize:16384,windowBits:15,memLevel:8,strategy:CQ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hF,this.strm.avail_out=0;let r=eu.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==f_)throw new Error(js[r]);if(t.header&&eu.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?$u.string2buf(t.dictionary):pF.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=eu.deflateSetDictionary(this.strm,i),r!==f_)throw new Error(js[r]);this._dict_set=!0}}function aS(e,t){let r=new tu(t);if(r.push(e,!0),r.err)throw r.msg||js[r.err];return r.result}tu.prototype.push=function(e,t){let r=this.strm,i=this.options.chunkSize,n,o;if(this.ended)return!1;for(o=t===~~t?t:t===!0?vQ:gQ,typeof e=="string"?r.input=$u.string2buf(e):pF.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(o===SQ||o===TQ)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(n=eu.deflate(r,o),n===yQ)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=eu.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===f_;if(r.avail_out!==0){if(o>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},tu.prototype.onData=function(e){this.chunks.push(e)},tu.prototype.onEnd=function(e){e===f_&&(this.result=hm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var wQ={Deflate:tu,deflate:aS,deflateRaw:function(e,t){return(t=t||{}).raw=!0,aS(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,aS(e,t)},constants:Gl},wp=16209,AQ=function(e,t){let r,i,n,o,a,s,c,l,d,u,h,p,g,_,E,S,T,y,I,O,b,k,P,j,G=e.state;r=e.next_in,P=e.input,i=r+(e.avail_in-5),n=e.next_out,j=e.output,o=n-(t-e.avail_out),a=n+(e.avail_out-257),s=G.dmax,c=G.wsize,l=G.whave,d=G.wnext,u=G.window,h=G.hold,p=G.bits,g=G.lencode,_=G.distcode,E=(1<<G.lenbits)-1,S=(1<<G.distbits)-1;e:do{p<15&&(h+=P[r++]<<p,p+=8,h+=P[r++]<<p,p+=8),T=g[h&E];t:for(;;){if(y=T>>>24,h>>>=y,p-=y,y=T>>>16&255,y===0)j[n++]=65535&T;else{if(!(16&y)){if(!(64&y)){T=g[(65535&T)+(h&(1<<y)-1)];continue t}if(32&y){G.mode=16191;break e}e.msg="invalid literal/length code",G.mode=wp;break e}I=65535&T,y&=15,y&&(p<y&&(h+=P[r++]<<p,p+=8),I+=h&(1<<y)-1,h>>>=y,p-=y),p<15&&(h+=P[r++]<<p,p+=8,h+=P[r++]<<p,p+=8),T=_[h&S];r:for(;;){if(y=T>>>24,h>>>=y,p-=y,y=T>>>16&255,!(16&y)){if(!(64&y)){T=_[(65535&T)+(h&(1<<y)-1)];continue r}e.msg="invalid distance code",G.mode=wp;break e}if(O=65535&T,y&=15,p<y&&(h+=P[r++]<<p,p+=8,p<y&&(h+=P[r++]<<p,p+=8)),O+=h&(1<<y)-1,O>s){e.msg="invalid distance too far back",G.mode=wp;break e}if(h>>>=y,p-=y,y=n-o,O>y){if(y=O-y,y>l&&G.sane){e.msg="invalid distance too far back",G.mode=wp;break e}if(b=0,k=u,d===0){if(b+=c-y,y<I){I-=y;do j[n++]=u[b++];while(--y);b=n-O,k=j}}else if(d<y){if(b+=c+d-y,y-=d,y<I){I-=y;do j[n++]=u[b++];while(--y);if(b=0,d<I){y=d,I-=y;do j[n++]=u[b++];while(--y);b=n-O,k=j}}}else if(b+=d-y,y<I){I-=y;do j[n++]=u[b++];while(--y);b=n-O,k=j}for(;I>2;)j[n++]=k[b++],j[n++]=k[b++],j[n++]=k[b++],I-=3;I&&(j[n++]=k[b++],I>1&&(j[n++]=k[b++]))}else{b=n-O;do j[n++]=j[b++],j[n++]=j[b++],j[n++]=j[b++],I-=3;while(I>2);I&&(j[n++]=j[b++],I>1&&(j[n++]=j[b++]))}break}}break}}while(r<i&&n<a);I=p>>3,r-=I,p-=I<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=n,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=n<a?a-n+257:257-(n-a),G.hold=h,G.bits=p},Ap=15,OQ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),bQ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),NQ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),DQ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),ru=(e,t,r,i,n,o,a,s)=>{let c=s.bits,l,d,u,h,p,g,_=0,E=0,S=0,T=0,y=0,I=0,O=0,b=0,k=0,P=0,j=null,G=new Uint16Array(16),ce=new Uint16Array(16),pe,Ae,Ge,at=null;for(_=0;_<=Ap;_++)G[_]=0;for(E=0;E<i;E++)G[t[r+E]]++;for(y=c,T=Ap;T>=1&&G[T]===0;T--);if(y>T&&(y=T),T===0)return n[o++]=20971520,n[o++]=20971520,s.bits=1,0;for(S=1;S<T&&G[S]===0;S++);for(y<S&&(y=S),b=1,_=1;_<=Ap;_++)if(b<<=1,b-=G[_],b<0)return-1;if(b>0&&(e===0||T!==1))return-1;for(ce[1]=0,_=1;_<Ap;_++)ce[_+1]=ce[_]+G[_];for(E=0;E<i;E++)t[r+E]!==0&&(a[ce[t[r+E]]++]=E);if(e===0?(j=at=a,g=20):e===1?(j=OQ,at=bQ,g=257):(j=NQ,at=DQ,g=0),P=0,E=0,_=S,p=o,I=y,O=0,u=-1,k=1<<y,h=k-1,e===1&&k>852||e===2&&k>592)return 1;for(;;){pe=_-O,a[E]+1<g?(Ae=0,Ge=a[E]):a[E]>=g?(Ae=at[a[E]-g],Ge=j[a[E]-g]):(Ae=96,Ge=0),l=1<<_-O,d=1<<I,S=d;do d-=l,n[p+(P>>O)+d]=pe<<24|Ae<<16|Ge|0;while(d!==0);for(l=1<<_-1;P&l;)l>>=1;if(l!==0?(P&=l-1,P+=l):P=0,E++,--G[_]==0){if(_===T)break;_=t[r+a[E]]}if(_>y&&(P&h)!==u){for(O===0&&(O=y),p+=S,I=_-O,b=1<<I;I+O<T&&(b-=G[I+O],!(b<=0));)I++,b<<=1;if(k+=1<<I,e===1&&k>852||e===2&&k>592)return 1;u=P&h,n[u]=y<<24|I<<16|p-o|0}}return P!==0&&(n[p+P]=_-O<<24|64<<16|0),s.bits=y,0},{Z_FINISH:NP,Z_BLOCK:PQ,Z_TREES:Op,Z_OK:Ds,Z_STREAM_END:kQ,Z_NEED_DICT:LQ,Z_STREAM_ERROR:sn,Z_DATA_ERROR:fF,Z_MEM_ERROR:_F,Z_BUF_ERROR:MQ,Z_DEFLATED:DP}=Gl,pm=16180,__=16190,yo=16191,sS=16192,cS=16194,bp=16199,Np=16200,lS=16206,Ut=16209,PP=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function UQ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Ps=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<pm||t.mode>16211?1:0},mF=e=>{if(Ps(e))return sn;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=pm,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ds},EF=e=>{if(Ps(e))return sn;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,mF(e)},gF=(e,t)=>{let r;if(Ps(e))return sn;let i=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?sn:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,EF(e))},kP=(e,t)=>{if(!e)return sn;let r=new UQ;e.state=r,r.strm=e,r.window=null,r.mode=pm;let i=gF(e,t);return i!==Ds&&(e.state=null),i},dS,uS,LP=!0,xQ=e=>{if(LP){dS=new Int32Array(512),uS=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ru(1,e.lens,0,288,dS,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ru(2,e.lens,0,32,uS,0,e.work,{bits:5}),LP=!1}e.lencode=dS,e.lenbits=9,e.distcode=uS,e.distbits=5},SF=(e,t,r,i)=>{let n,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(n=o.wsize-o.wnext,n>i&&(n=i),o.window.set(t.subarray(r-i,r-i+n),o.wnext),(i-=n)?(o.window.set(t.subarray(r-i,r),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0},VQ=(e,t)=>{let r,i,n,o,a,s,c,l,d,u,h,p,g,_,E,S,T,y,I,O,b,k,P=0,j=new Uint8Array(4),G,ce,pe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ps(e)||!e.output||!e.input&&e.avail_in!==0)return sn;r=e.state,r.mode===yo&&(r.mode=sS),a=e.next_out,n=e.output,c=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,l=r.hold,d=r.bits,u=s,h=c,k=Ds;e:for(;;)switch(r.mode){case pm:if(r.wrap===0){r.mode=sS;break}for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(2&r.wrap&&l===35615){r.wbits===0&&(r.wbits=15),r.check=0,j[0]=255&l,j[1]=l>>>8&255,r.check=Cr(r.check,j,2,0),l=0,d=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=Ut;break}if((15&l)!==DP){e.msg="unknown compression method",r.mode=Ut;break}if(l>>>=4,d-=4,b=8+(15&l),r.wbits===0&&(r.wbits=b),b>15||b>r.wbits){e.msg="invalid window size",r.mode=Ut;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&l?16189:yo,l=0,d=0;break;case 16181:for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(r.flags=l,(255&mr(r))!==DP){e.msg="unknown compression method",r.mode=Ut;break}if(57344&mr(r)){e.msg="unknown header flags set",r.mode=Ut;break}r.head&&(r.head.text=l>>8&1),512&mr(r)&&4&r.wrap&&(j[0]=255&l,j[1]=l>>>8&255,r.check=Cr(r.check,j,2,0)),l=0,d=0,r.mode=16182;case 16182:for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}r.head&&(r.head.time=l),512&mr(r)&&4&r.wrap&&(j[0]=255&l,j[1]=l>>>8&255,j[2]=l>>>16&255,j[3]=l>>>24&255,r.check=Cr(r.check,j,4,0)),l=0,d=0,r.mode=16183;case 16183:for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&mr(r)&&4&r.wrap&&(j[0]=255&l,j[1]=l>>>8&255,r.check=Cr(r.check,j,2,0)),l=0,d=0,r.mode=16184;case 16184:if(1024&mr(r)){for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}r.length=l,r.head&&(r.head.extra_len=l),512&mr(r)&&4&r.wrap&&(j[0]=255&l,j[1]=l>>>8&255,r.check=Cr(r.check,j,2,0)),l=0,d=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&mr(r)&&(p=r.length,p>s&&(p=s),p&&(r.head&&(b=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(i.subarray(o,o+p),b)),512&mr(r)&&4&r.wrap&&(r.check=Cr(r.check,i,p,o)),s-=p,o+=p,r.length-=p),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&mr(r)){if(s===0)break e;p=0;do b=i[o+p++],r.head&&b&&r.length<65536&&(r.head.name+=String.fromCharCode(b));while(b&&p<s);if(512&mr(r)&&4&r.wrap&&(r.check=Cr(r.check,i,p,o)),s-=p,o+=p,b)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&mr(r)){if(s===0)break e;p=0;do b=i[o+p++],r.head&&b&&r.length<65536&&(r.head.comment+=String.fromCharCode(b));while(b&&p<s);if(512&mr(r)&&4&r.wrap&&(r.check=Cr(r.check,i,p,o)),s-=p,o+=p,b)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&mr(r)){for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(4&r.wrap&&l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Ut;break}l=0,d=0}r.head&&(r.head.hcrc=mr(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=yo;break;case 16189:for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}e.adler=r.check=PP(l),l=0,d=0,r.mode=__;case __:if(r.havedict===0)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=l,r.bits=d,LQ;e.adler=r.check=1,r.mode=yo;case yo:if(t===PQ||t===Op)break e;case sS:if(r.last){l>>>=7&d,d-=7&d,r.mode=lS;break}for(;d<3;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}switch(r.last=1&l,l>>>=1,d-=1,3&l){case 0:r.mode=16193;break;case 1:if(xQ(r),r.mode=bp,t===Op){l>>>=2,d-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Ut}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Ut;break}if(r.length=65535&l,l=0,d=0,r.mode=cS,t===Op)break e;case cS:r.mode=16195;case 16195:if(p=r.length,p){if(p>s&&(p=s),p>c&&(p=c),p===0)break e;n.set(i.subarray(o,o+p),a),s-=p,o+=p,c-=p,a+=p,r.length-=p;break}r.mode=yo;break;case 16196:for(;d<14;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(r.nlen=257+(31&l),l>>>=5,d-=5,r.ndist=1+(31&l),l>>>=5,d-=5,r.ncode=4+(15&l),l>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Ut;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;d<3;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}r.lens[pe[r.have++]]=7&l,l>>>=3,d-=3}for(;r.have<19;)r.lens[pe[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,G={bits:r.lenbits},k=ru(0,r.lens,0,19,r.lencode,0,r.work,G),r.lenbits=G.bits,k){e.msg="invalid code lengths set",r.mode=Ut;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;P=r.lencode[l&(1<<r.lenbits)-1],E=P>>>24,S=P>>>16&255,T=65535&P,!(E<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(T<16)l>>>=E,d-=E,r.lens[r.have++]=T;else{if(T===16){for(ce=E+2;d<ce;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(l>>>=E,d-=E,r.have===0){e.msg="invalid bit length repeat",r.mode=Ut;break}b=r.lens[r.have-1],p=3+(3&l),l>>>=2,d-=2}else if(T===17){for(ce=E+3;d<ce;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=E,d-=E,b=0,p=3+(7&l),l>>>=3,d-=3}else{for(ce=E+7;d<ce;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=E,d-=E,b=0,p=11+(127&l),l>>>=7,d-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Ut;break}for(;p--;)r.lens[r.have++]=b}}if(r.mode===Ut)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Ut;break}if(r.lenbits=9,G={bits:r.lenbits},k=ru(1,r.lens,0,r.nlen,r.lencode,0,r.work,G),r.lenbits=G.bits,k){e.msg="invalid literal/lengths set",r.mode=Ut;break}if(r.distbits=6,r.distcode=r.distdyn,G={bits:r.distbits},k=ru(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,G),r.distbits=G.bits,k){e.msg="invalid distances set",r.mode=Ut;break}if(r.mode=bp,t===Op)break e;case bp:r.mode=Np;case Np:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=l,r.bits=d,AQ(e,h),a=e.next_out,n=e.output,c=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,l=r.hold,d=r.bits,r.mode===yo&&(r.back=-1);break}for(r.back=0;P=r.lencode[l&(1<<r.lenbits)-1],E=P>>>24,S=P>>>16&255,T=65535&P,!(E<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(S&&!(240&S)){for(y=E,I=S,O=T;P=r.lencode[O+((l&(1<<y+I)-1)>>y)],E=P>>>24,S=P>>>16&255,T=65535&P,!(y+E<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=y,d-=y,r.back+=y}if(l>>>=E,d-=E,r.back+=E,r.length=T,S===0){r.mode=16205;break}if(32&S){r.back=-1,r.mode=yo;break}if(64&S){e.msg="invalid literal/length code",r.mode=Ut;break}r.extra=15&S,r.mode=16201;case 16201:if(r.extra){for(ce=r.extra;d<ce;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;P=r.distcode[l&(1<<r.distbits)-1],E=P>>>24,S=P>>>16&255,T=65535&P,!(E<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(!(240&S)){for(y=E,I=S,O=T;P=r.distcode[O+((l&(1<<y+I)-1)>>y)],E=P>>>24,S=P>>>16&255,T=65535&P,!(y+E<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=y,d-=y,r.back+=y}if(l>>>=E,d-=E,r.back+=E,64&S){e.msg="invalid distance code",r.mode=Ut;break}r.offset=T,r.extra=15&S,r.mode=16203;case 16203:if(r.extra){for(ce=r.extra;d<ce;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Ut;break}r.mode=16204;case 16204:if(c===0)break e;if(p=h-c,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Ut;break}p>r.wnext?(p-=r.wnext,g=r.wsize-p):g=r.wnext-p,p>r.length&&(p=r.length),_=r.window}else _=n,g=a-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do n[a++]=_[g++];while(--p);r.length===0&&(r.mode=Np);break;case 16205:if(c===0)break e;n[a++]=r.length,c--,r.mode=Np;break;case lS:if(r.wrap){for(;d<32;){if(s===0)break e;s--,l|=i[o++]<<d,d+=8}if(h-=c,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=mr(r)?Cr(r.check,n,h,a-h):Ku(r.check,n,h,a-h)),h=c,4&r.wrap&&(mr(r)?l:PP(l))!==r.check){e.msg="incorrect data check",r.mode=Ut;break}l=0,d=0}r.mode=16207;case 16207:if(r.wrap&&mr(r)){for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(4&r.wrap&&l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Ut;break}l=0,d=0}r.mode=16208;case 16208:k=kQ;break e;case Ut:k=fF;break e;case 16210:return _F;default:return sn}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=l,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<Ut&&(r.mode<lS||t!==NP))&&SF(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=mr(r)?Cr(r.check,n,h,e.next_out-h):Ku(r.check,n,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===yo?128:0)+(r.mode===bp||r.mode===cS?256:0),(u===0&&h===0||t===NP)&&k===Ds&&(k=MQ),k},Do={inflateReset:EF,inflateReset2:gF,inflateResetKeep:mF,inflateInit:e=>kP(e,15),inflateInit2:kP,inflate:VQ,inflateEnd:e=>{if(Ps(e))return sn;let t=e.state;return t.window&&(t.window=null),e.state=null,Ds},inflateGetHeader:(e,t)=>{if(Ps(e))return sn;let r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,Ds):sn},inflateSetDictionary:(e,t)=>{let r=t.length,i,n,o;return Ps(e)?sn:(i=e.state,i.wrap!==0&&i.mode!==__?sn:i.mode===__&&(n=1,n=Ku(n,t,r,0),n!==i.check)?fF:(o=SF(e,t,r,r),o?(i.mode=16210,_F):(i.havedict=1,Ds)))},inflateInfo:"pako inflate (from Nodeca project)"},FQ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},TF=Object.prototype.toString,{Z_NO_FLUSH:BQ,Z_FINISH:jQ,Z_OK:iu,Z_STREAM_END:hS,Z_NEED_DICT:pS,Z_STREAM_ERROR:GQ,Z_DATA_ERROR:MP,Z_MEM_ERROR:WQ}=Gl;function nu(e){this.options=hm.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hF,this.strm.avail_out=0;let r=Do.inflateInit2(this.strm,t.windowBits);if(r!==iu)throw new Error(js[r]);if(this.header=new FQ,Do.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=$u.string2buf(t.dictionary):TF.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Do.inflateSetDictionary(this.strm,t.dictionary),r!==iu)))throw new Error(js[r])}function fS(e,t){let r=new nu(t);if(r.push(e),r.err)throw r.msg||js[r.err];return r.result}nu.prototype.push=function(e,t){let r=this.strm,i=this.options.chunkSize,n=this.options.dictionary,o,a,s;if(this.ended)return!1;for(a=t===~~t?t:t===!0?jQ:BQ,TF.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),o=Do.inflate(r,a),o===pS&&n&&(o=Do.inflateSetDictionary(r,n),o===iu?o=Do.inflate(r,a):o===MP&&(o=pS));r.avail_in>0&&o===hS&&r.state.wrap>0&&e[r.next_in]!==0;)Do.inflateReset(r),o=Do.inflate(r,a);switch(o){case GQ:case MP:case pS:case WQ:return this.onEnd(o),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(r.avail_out===0||o===hS))if(this.options.to==="string"){let c=$u.utf8border(r.output,r.next_out),l=r.next_out-c,d=$u.buf2string(r.output,c);r.next_out=l,r.avail_out=i-l,l&&r.output.set(r.output.subarray(c,c+l),0),this.onData(d)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(o!==iu||s!==0){if(o===hS)return o=Do.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},nu.prototype.onData=function(e){this.chunks.push(e)},nu.prototype.onEnd=function(e){e===iu&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=hm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var HQ={Inflate:nu,inflate:fS,inflateRaw:function(e,t){return(t=t||{}).raw=!0,fS(e,t)},ungzip:fS,constants:Gl},{Deflate:s1,deflate:KQ,deflateRaw:c1,gzip:l1}=wQ,{Inflate:d1,inflate:zQ,inflateRaw:u1,ungzip:h1}=HQ,YQ=KQ,$Q=zQ,vF=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(vF||{}),qQ=class{constructor(){v(this,"_sequence",0),v(this,"_startTime",Date.now()),v(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){let t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let a=new Uint8Array(4);a.set([1,0,0,0]);let s={id:0,length:4,data:a.buffer},c={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[s]};t.commonPacketHeader.extension=1,t.extension=c,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;w("SHOW_DATASTREAM2_LOG")&&f.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));let r=new ArrayBuffer(t.commonPacketHeader.length),i=new Uint8Array(r),n=new DataView(r),o=0;if(n.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,n.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,n.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){let a=this.serializeExtension(t.extension);i.set(new Uint8Array(a),o),o+=a.byteLength}if(i.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);let t=new DataView(e),r=0,i=t.getUint16(r,!0);r+=2;let n={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:t.getUint16(r+2,!0)<<16|t.getUint16(r,!0)},o,a;if(r+=4,w("SHOW_DATASTREAM2_LOG")&&f.debug("receive data header: ".concat(JSON.stringify(n))),t.getUint16(r,!0),r+=2,n.extension){a=this.deserializeExtension(e.slice(r)),r+=2+a.length,o=e.slice(r);let s=!1;if(a.datas.length>0){let c=a.datas.find(l=>l.id===0);c&&(s=(1&new DataView(c.data).getUint32(0,!0))==1)}o=s?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){let{profile:t,length:r,datas:i}=e,n=new ArrayBuffer(r+2),o=new Uint8Array(n),a=new DataView(n),s=0;if(a.setUint8(s++,t),a.setUint8(s++,r),i.forEach(c=>{t?(a.setUint8(s++,c.id),a.setUint8(s++,c.length),o.set(new Uint8Array(c.data),s),s+=c.data.byteLength):(a.setUint8(s++,c.id|c.length<<4),o.set(new Uint8Array(c.data),s),s+=c.data.byteLength)}),s!==r+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(r+2));return n}deserializeExtension(e){let t=new DataView(e),r=0,i=t.getUint8(r);r++;let n=t.getUint8(r);r++;let o=i===vF.TWO_BYTE,a=[],s=new DataView(e,2),c=0;for(;c<n;){let l=0,d=0,u=new ArrayBuffer(0);o?(l=s.getUint8(c),c++,d=s.getUint8(c),c++):(l=15&s.getUint8(c),d=s.getUint8(c)>>4,c++),d>0&&(u=s.buffer.slice(c+2,c+2+d),c+=u.byteLength),a.push({id:l,length:d,data:u})}if(c!==n)throw Error("parse error");return{profile:i,length:n,datas:a}}decompress(e){return $Q(new Uint8Array(e))}compress(e){return YQ(new Uint8Array(e))}},XQ={name:"DataStream",create:(e,t)=>{let r=t?new MX(e):new UX(e);return r.useDataStream(new qQ),r}},JQ=class extends tt{constructor(e,t,r){super(),v(this,"ws",void 0),v(this,"requestId",1),v(this,"heartBeatTimer",void 0),v(this,"joinInfo",void 0),v(this,"clientId",void 0),v(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),v(this,"onClose",i=>{this.emit("close"),this.dispose()}),v(this,"onMessage",i=>{let n=JSON.parse(i.data);if(!n||n.command!=="serverResponse"||!n.requestId)return n&&n.command==="serverStatus"&&n.serverStatus&&n.serverStatus.command?(this.emit("status",n.serverStatus),void this.emit(n.serverStatus.command,n.serverStatus)):void 0;this.emit("req_".concat(n.requestId),n)}),this.joinInfo=e,this.clientId=t,this.ws=new Mu("cross-channel-".concat(this.clientId),r),this.ws.on(se.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(se.CONNECTED,this.onOpen),this.ws.on(se.ON_MESSAGE,this.onMessage),this.ws.on(se.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new K((t,r)=>{let i=window.setTimeout(()=>{r(new D(R.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,n=>{window.clearTimeout(i),n.state&&n.state!==0?r(new D(R.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new D(R.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new D(R.WS_DISCONNECT);let t=()=>new K((o,a)=>{this.ws.once(se.CLOSED,()=>a(new D(R.WS_ABORT))),this.ws.once(se.CONNECTED,o)});this.ws.state!=="connected"&&await t();let r=this.sendMessage(e),i=new K((o,a)=>{let s=()=>{a(new D(R.WS_ABORT))};this.ws.once(se.RECONNECTING,s),this.ws.once(se.CLOSED,s),this.once("req_".concat(r),o),zt(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(se.RECONNECTING,s),this.ws.off(se.CLOSED,s),a(new D(R.TIMEOUT,"cross channel ws request timeout"))})}),n=await i;if(!n||n.code!==200)throw new D(R.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(n)));return n}async connect(e){this.ws.removeAllListeners(se.REQUEST_NEW_URLS),this.ws.on(se.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}},QQ=class extends tt{set state(e){e!==this._state&&(e!==Hr.RELAY_STATE_FAILURE&&(this.errorCode=Sc.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,r,i,n){super(),v(this,"joinInfo",void 0),v(this,"sid",void 0),v(this,"clientId",void 0),v(this,"cancelToken",Vr.CancelToken.source()),v(this,"workerToken",void 0),v(this,"requestId",0),v(this,"signal",void 0),v(this,"prevChannelMediaConfig",void 0),v(this,"httpRetryConfig",void 0),v(this,"_resolution",void 0),v(this,"_state",Hr.RELAY_STATE_IDLE),v(this,"errorCode",Sc.RELAY_OK),v(this,"onStatus",o=>{f.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",Ro.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",Ro.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Sc.SRC_TOKEN_EXPIRED,this.state=Hr.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Sc.DEST_TOKEN_EXPIRED,this.state=Hr.RELAY_STATE_FAILURE))}),v(this,"onReconnect",async()=>{f.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ro.NETWORK_DISCONNECTED),this.state=Hr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==Hr.RELAY_STATE_IDLE&&(f.error("auto restart channel media relay failed",o.toString()),this.errorCode=Sc.SERVER_CONNECTION_LOST,this.state=Hr.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=jc(),this.signal=new JQ(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=n}async startChannelMediaRelay(e){if(this.state!==Hr.RELAY_STATE_IDLE)throw new D(R.INVALID_OPERATION);this.state=Hr.RELAY_STATE_CONNECTING,await this.connect(),f.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){throw t.data&&t.data.serverResponse&&t.data.serverResponse.command==="SetSourceChannel"?new D(R.CROSS_CHANNEL_FAILED_JOIN_SRC):t.data&&t.data.serverResponse&&t.serverResponse.command==="SetDestChannelStatus"?new D(R.CROSS_CHANNEL_FAILED_JOIN_DEST):t.data&&t.data.serverResponse&&t.serverResponse.command==="StartPacketTransfer"?new D(R.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Hr.RELAY_STATE_RUNNING)throw new D(R.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Hr.RELAY_STATE_RUNNING)throw new D(R.INVALID_OPERATION);let t=this.genMessage(Rr.SetVideoProfile);await this.signal.request(t),f.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),f.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Hr.RELAY_STATE_IDLE,this.dispose()}dispose(){f.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Vr.CancelToken.source(),this.state=Hr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await YX(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Ro.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let t=this.genMessage(Rr.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),f.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let r=this.genMessage(Rr.SetSdkProfile,e);await this.signal.request(r),f.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let i=this.genMessage(Rr.SetSourceChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ro.PACKET_JOINED_SRC_CHANNEL),f.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let n=this.genMessage(Rr.SetSourceUserId,e);await this.signal.request(n),f.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let o=this.genMessage(Rr.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ro.PACKET_JOINED_DEST_CHANNEL),f.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let a=this.genMessage(Rr.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",Ro.PACKET_SENT_TO_DEST_CHANNEL),this.state=Hr.RELAY_STATE_RUNNING,f.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let t=this.genMessage(Rr.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",Ro.PACKET_UPDATE_DEST_CHANNEL),f.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(Rr.StopPacketTransfer);await this.signal.request(e),f.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let r=[],i=[],n=[];this.requestId+=1;let o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ui,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.22.0"&&(o.sdkVersion="0.0.1");let a=null,s=null;switch(e){case Rr.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Rr.SetSourceChannel:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new D(R.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},o;case Rr.SetSourceUserId:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new D(R.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:s.uid+""},o;case Rr.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new D(R.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(c=>{r.push(c.channelName),i.push(c.uid+""),n.push(c.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:n},o;case Rr.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Rr.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Rr.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Rr.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new D(R.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(c=>{r.push(c.channelName),i.push(c.uid+""),n.push(c.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:n},o;case Rr.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}},ZQ={name:"ChannelMediaRelay",create:function(e){return new QQ(e.joinInfo,e.clientId,e.websocketRetryConfig||Rt,e.httpRetryConfig||Rt,e.resolution)}};function UP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Ed(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?UP(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):UP(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var eZ=class extends tt{constructor(e,t,r,i){super(),v(this,"spec",void 0),v(this,"token",void 0),v(this,"websocket",void 0),v(this,"pingpongTimer",void 0),v(this,"reconnectMode","retry"),v(this,"serviceMode",void 0),v(this,"reqId",0),v(this,"commandReqId",0),v(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),v(this,"handleWebSocketMessage",n=>{if(!n.data)return;let o=JSON.parse(n.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(Q.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===Mo.TRANSCODE?1:2}),this.emit(ha.PUBLISH_STREAM_STATUS,o))}),this.spec=t,this.token=e,this.serviceMode=i,this.websocket=new Mu("live-streaming",r),this.websocket.on(se.CONNECTED,this.handleWebSocketOpen),this.websocket.on(se.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(se.REQUEST_NEW_URLS,(n,o)=>{tr(this,ha.REQUEST_NEW_ADDRESS).then(n).catch(o)}),this.websocket.on(se.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,r,i){this.reqId+=1,e==="request"&&(this.commandReqId+=1);let n=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new D(R.UNEXPECTED_ERROR);let a=Ed({command:e,sdkVersion:Ui==="4.22.0"?"0.0.1":Ui,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if(this.websocket.state==="closed")throw new D(R.WS_DISCONNECT);let s=()=>new K((u,h)=>{this.websocket.once(se.CLOSED,()=>h(new D(R.WS_ABORT))),this.websocket.once(se.CONNECTED,u)});this.websocket.state!=="connected"&&await s(),a.clientRequest&&(a.clientRequest.workerToken=this.token);let c=new K((u,h)=>{let p=()=>{h(new D(R.WS_ABORT))};this.websocket.once(se.RECONNECTING,p),this.websocket.once(se.CLOSED,p),this.once("@".concat(o,"-").concat(this.spec.sid),g=>{u(g)})});i&&Q.workerEvent(this.spec.sid,Ed(Ed({},i),{},{requestId:n,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));let l=Date.now();this.websocket.sendMessage(a);let d=null;try{d=await c}catch(u){if(this.websocket.state==="closed")throw u;return await s(),await this.request(e,t,r)}return i&&Q.workerEvent(this.spec.sid,Ed(Ed({},i),{},{requestId:n,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:d.code===200,responseTime:Date.now()-l})),d.code!==200&&this.handleResponseError(d),d}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e=Ui==="4.22.0"?"0.0.1":Ui;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case It.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void f.warning("live stream response already exists stream");case It.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case It.LIVE_STREAM_RESPONSE_BAD_STREAM:case It.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new D(R.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case It.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new D(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case It.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new D(R.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case It.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t=new D(R.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ha.WARNING,t,e.serverResponse.url)}case It.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t=new D(R.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ha.WARNING,t,e.serverResponse.url)}case It.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new D(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case It.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new D(R.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case It.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t=new D(R.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ha.WARNING,t,e.serverResponse.url)}case It.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new D(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case It.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new D(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case It.LIVE_STREAM_RESPONSE_WORKER_LOST:case It.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new D(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case It.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new D(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new D(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case It.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new D(R.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(om)},6e3)}};function xP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Wr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xP(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xP(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var tZ=class extends tt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rt,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Rt;super(),v(this,"onLiveStreamWarning",void 0),v(this,"onLiveStreamError",void 0),v(this,"spec",void 0),v(this,"retryTimeout",1e4),v(this,"connection",void 0),v(this,"httpRetryConfig",void 0),v(this,"wsRetryConfig",void 0),v(this,"streamingTasks",new Map),v(this,"isStartingStreamingTask",!1),v(this,"taskMutex",new cr("live-streaming")),v(this,"cancelToken",Vr.CancelToken.source()),v(this,"transcodingConfig",void 0),v(this,"uapResponse",void 0),v(this,"lastTaskId",1),v(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=r,this.wsRetryConfig=t}async setTranscodingConfig(e){let t=Wr(Wr({},Z9),e);t.videoCodecProfile!==66&&t.videoCodecProfile!==77&&t.videoCodecProfile!==100&&(f.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(o=>Wr(Wr(Wr({},Q9),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){Qe(o.width)||Me(o.width,"config.width",0,1e4),Qe(o.height)||Me(o.height,"config.height",0,1e4),Qe(o.videoBitrate)||Me(o.videoBitrate,"config.videoBitrate",1,1e6),Qe(o.videoFrameRate)||Me(o.videoFrameRate,"config.videoFrameRate"),Qe(o.lowLatency)||Po(o.lowLatency,"config.lowLatency"),Qe(o.audioSampleRate)||Ot(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Qe(o.audioBitrate)||Me(o.audioBitrate,"config.audioBitrate",1,128),Qe(o.audioChannels)||Ot(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Qe(o.videoGop)||Me(o.videoGop,"config.videoGop"),Qe(o.videoCodecProfile)||Ot(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Qe(o.userCount)||Me(o.userCount,"config.userCount",0,17),Qe(o.backgroundColor)||Me(o.backgroundColor,"config.backgroundColor",0,16777215),Qe(o.userConfigExtraInfo)||jt(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Qe(o.transcodingUsers)&&(Oo(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((a,s)=>{cm(a.uid),Qe(a.x)||Me(a.x,"transcodingUser[".concat(s,"].x"),0,1e4),Qe(a.y)||Me(a.y,"transcodingUser[".concat(s,"].y"),0,1e4),Qe(a.width)||Me(a.width,"transcodingUser[".concat(s,"].width"),0,1e4),Qe(a.height)||Me(a.height,"transcodingUser[".concat(s,"].height"),0,1e4),Qe(a.zOrder)||Me(a.zOrder-1,"transcodingUser[".concat(s,"].zOrder"),0,100),Qe(a.alpha)||Me(a.alpha,"transcodingUser[".concat(s,"].alpha"),0,1,!1)})),Qe(o.watermark)||pg(o.watermark,"watermark"),Qe(o.backgroundImage)||pg(o.backgroundImage,"backgroundImage"),o.images&&!Qe(o.images)&&(Oo(o.images,"config.images"),o.images.forEach((a,s)=>{pg(a,"images[".concat(s,"]"))}))}(t);let r=[];t.images&&r.push(...t.images.map(o=>Wr(Wr(Wr({},hg),o),{},{zOrder:255}))),t.backgroundImage&&(r.push(Wr(Wr(Wr({},hg),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(r.push(Wr(Wr(Wr({},hg),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=r,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(o=>Wr({},o)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);let i=(t.userConfigs||[]).map(o=>typeof o.uid=="number"?K.resolve(o.uid):AV(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await K.all(i)).forEach((o,a)=>{t.userConfigs&&t.userConfigs[a]&&(t.userConfigs[a].uid=o)}),this.transcodingConfig=t,this.connection)try{var n;let o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Vo(n=this.streamingTasks).call(n)).map(a=>a.taskId).join("#")});f.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(a=>{f.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,o).then(()=>{f.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(a.url," success"))}).catch(s=>{f.error("[".concat(this.spec.clientId,"] live streaming republish failed"),a.url,s.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,s)})})}}async startLiveStreamingTask(e,t,r){if(!this.transcodingConfig&&t===Mo.TRANSCODE)throw new D(R.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};f.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));let n=await this.taskMutex.lock();if(!this.connection&&r)return void n();if(this.streamingTasks.get(e)&&!r)return n(),new D(R.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(a){throw n(),a}switch(t){case Mo.TRANSCODE:i.transcodingConfig=Wr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let o=this.lastTaskId++;try{let a=new K((c,l)=>{zt(this.retryTimeout).then(()=>{if(r)return l(r);let d=this.statusError.get(e);return d?(this.statusError.delete(e),l(d)):void 0})}),s=await K.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===Mo.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),a]);this.isStartingStreamingTask=!1,f.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:o}),n()}catch(a){if(n(),this.isStartingStreamingTask=!1,!a.data||!a.data.retry||r)throw a;return a.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,a)):await this.startLiveStreamingTask(e,t,a)}}stopLiveStreamingTask(e){return new K((t,r)=>{let i=this.streamingTasks.get(e);if(!i||!this.connection)return new D(R.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let n=i.mode;i.abortTask=()=>{f.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:n===Mo.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{f.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(r)})}resetAllTask(){var e;let t=Array.from(Vo(e=this.streamingTasks).call(e));this.terminate();for(let r of t)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Vr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new D(R.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await tr(this,cv.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new eZ(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(ha.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(ha.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(ha.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new D(R.UNEXPECTED_ERROR,"can not get new live streaming address list"));tr(this,cv.REQUEST_WORKER_MANAGER_LIST,e).then(n=>{this.uapResponse=n,r(n.addressList)}).catch(i)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){let t=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(t),i=e.reason;switch(e.code){case It.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let o=new D(R.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return f.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,o);if(!this.isStartingStreamingTask)return;this.statusError.set(t,o)}case It.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let o=new D(R.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,o)}case It.LIVE_STREAM_RESPONSE_WORKER_LOST:case It.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var n;if(!this.connection)return;this.connection.tryNextAddress();let o=Array.from(Vo(n=this.streamingTasks).call(n));for(let a of o)a.abortTask?a.abortTask():(f.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,new D(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{f.debug("[".concat(this.spec.clientId,"] republish live stream success"),a.url)}).catch(s=>{f.error(s.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,s)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}},rZ={name:"LiveStreaming",create:function(e){return new tZ(e.joinInfo,e.websocketRetryConfig||Rt,e.httpRetryConfig||Rt)}};function iZ(e){let t=VP();return function(r,i){let n=r.appId;n!==void 0&&(De(i,10),Qn(i,n));let o=r.cid;o!==void 0&&(De(i,16),De(i,o));let a=r.cname;a!==void 0&&(De(i,26),Qn(i,a));let s=r.deviceId;s!==void 0&&(De(i,34),Qn(i,s));let c=r.elapse;c!==void 0&&(De(i,40),na(i,c));let l=r.fileSize;l!==void 0&&(De(i,48),na(i,mc(l)));let d=r.height;d!==void 0&&(De(i,56),na(i,mc(d)));let u=r.jpg;u!==void 0&&(De(i,66),De(i,u.length),function(pr,x){let L=Wl(pr,x.length);pr.bytes.set(x,L)}(i,u));let h=r.networkType;h!==void 0&&(De(i,72),na(i,mc(h)));let p=r.osType;p!==void 0&&(De(i,80),na(i,mc(p)));let g=r.requestId;g!==void 0&&(De(i,90),Qn(i,g));let _=r.sdkVersion;_!==void 0&&(De(i,98),Qn(i,_));let E=r.sequence;E!==void 0&&(De(i,104),na(i,mc(E)));let S=r.sid;S!==void 0&&(De(i,114),Qn(i,S));let T=r.timestamp;T!==void 0&&(De(i,120),na(i,T));let y=r.uid;y!==void 0&&(De(i,128),De(i,y));let I=r.vid;I!==void 0&&(De(i,136),De(i,I));let O=r.width;O!==void 0&&(De(i,144),na(i,mc(O)));let b=r.service;b!==void 0&&(De(i,152),De(i,b));let k=r.callbackData;k!==void 0&&(De(i,162),Qn(i,k));let P=r.jpgEncryption;P!==void 0&&(De(i,168),De(i,P));let j=r.requestType;j!==void 0&&(De(i,176),De(i,j));let G=r.scorePorn;G!==void 0&&(De(i,185),ES(i,G));let ce=r.scoreSexy;ce!==void 0&&(De(i,193),ES(i,ce));let pe=r.scoreNeutral;pe!==void 0&&(De(i,201),ES(i,pe));let Ae=r.scene;Ae!==void 0&&(De(i,208),De(i,Ae));let Ge=r.ossFilePrefix;Ge!==void 0&&(De(i,218),Qn(i,Ge));let at=r.serviceVendor;if(at!==void 0)for(let pr of at){De(i,226);let x=VP();aZ(pr,x),De(i,x.limit),dZ(i,x),lZ(x)}}(e,t),function(r){let i=r.bytes,n=r.limit;return i.length===n?i:i.subarray(0,n)}(t)}function nZ(e){return function(r){let i={};e:for(;!CF(r);){let n=ro(r);switch(n>>>3){case 0:break e;case 1:i.code=ro(r);break;case 2:i.msg=IF(r,ro(r));break;case 3:{let o=sZ(r);i.data=oZ(r),r.limit=o;break}default:yF(r,7&n)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function oZ(e){let t={};e:for(;!CF(e);){let r=ro(e);switch(r>>>3){case 0:break e;case 1:t.requestId=IF(e,ro(e));break;case 2:t.requestType=ro(e)>>>0;break;case 3:t.scorePorn=mS(e);break;case 4:t.scoreSexy=mS(e);break;case 5:t.scoreNeutral=mS(e);break;case 6:t.requestScene=ro(e)>>>0;break;case 7:t.scene=ro(e)>>>0;break;default:yF(e,7&r)}}return t}function aZ(e,t){let r=e.service;r!==void 0&&(De(t,8),De(t,r));let i=e.vendor;i!==void 0&&(De(t,16),De(t,i));let n=e.token;n!==void 0&&(De(t,26),Qn(t,n));let o=e.callbackUrl;o!==void 0&&(De(t,34),Qn(t,o))}function sZ(e){let t=ro(e),r=e.limit;return e.limit=e.offset+t,r}function yF(e,t){switch(t){case 0:for(;128&wF(e););break;case 2:_S(e,ro(e));break;case 5:_S(e,4);break;case 1:_S(e,8);break;default:throw new Error("Unimplemented type: "+t)}}var cZ=new Float32Array(1);new Uint8Array(cZ.buffer);var GR=new Float64Array(1),Kr=new Uint8Array(GR.buffer);function mc(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var RF=[];function VP(){let e=RF.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function lZ(e){RF.push(e)}function _S(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function CF(e){return e.offset>=e.limit}function Wl(e,t){let r=e.bytes,i=e.offset,n=e.limit,o=i+t;if(o>r.length){let a=new Uint8Array(2*o);a.set(r),e.bytes=a}return e.offset=o,o>n&&(e.limit=o),i}function WR(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function IF(e,t){let r=WR(e,t),i=String.fromCharCode,n=e.bytes,o="",a="";for(let s=0;s<t;s++){let c,l,d,u,h=n[s+r];128&h?(224&h)==192?s+1>=t?a+=o:(c=n[s+r+1],(192&c)!=128?a+=o:(u=(31&h)<<6|63&c,u<128?a+=o:(a+=i(u),s++))):(240&h)==224?s+2>=t?a+=o:(c=n[s+r+1],l=n[s+r+2],(49344&(c|l<<8))!=32896?a+=o:(u=(15&h)<<12|(63&c)<<6|63&l,u<2048||u>=55296&&u<=57343?a+=o:(a+=i(u),s+=2))):(248&h)==240?s+3>=t?a+=o:(c=n[s+r+1],l=n[s+r+2],d=n[s+r+3],(12632256&(c|l<<8|d<<16))!=8421504?a+=o:(u=(7&h)<<18|(63&c)<<12|(63&l)<<6|63&d,u<65536||u>1114111?a+=o:(u-=65536,a+=i(55296+(u>>10),56320+(1023&u)),s+=3))):a+=o:a+=i(h)}return a}function Qn(e,t){let r=t.length,i=0;for(let a=0;a<r;a++){let s=t.charCodeAt(a);s>=55296&&s<=56319&&a+1<r&&(s=(s<<10)+t.charCodeAt(++a)-56613888),i+=s<128?1:s<2048?2:s<65536?3:4}De(e,i);let n=Wl(e,i),o=e.bytes;for(let a=0;a<r;a++){let s=t.charCodeAt(a);s>=55296&&s<=56319&&a+1<r&&(s=(s<<10)+t.charCodeAt(++a)-56613888),s<128?o[n++]=s:(s<2048?o[n++]=s>>6&31|192:(s<65536?o[n++]=s>>12&15|224:(o[n++]=s>>18&7|240,o[n++]=s>>12&63|128),o[n++]=s>>6&63|128),o[n++]=63&s|128)}}function dZ(e,t){let r=Wl(e,t.limit),i=e.bytes,n=t.bytes;for(let o=0,a=t.limit;o<a;o++)i[o+r]=n[o]}function wF(e){return e.bytes[WR(e,1)]}function FP(e,t){let r=Wl(e,1);e.bytes[r]=t}function mS(e){let t=WR(e,8),r=e.bytes;return Kr[0]=r[t++],Kr[1]=r[t++],Kr[2]=r[t++],Kr[3]=r[t++],Kr[4]=r[t++],Kr[5]=r[t++],Kr[6]=r[t++],Kr[7]=r[t++],GR[0]}function ES(e,t){let r=Wl(e,8),i=e.bytes;GR[0]=t,i[r++]=Kr[0],i[r++]=Kr[1],i[r++]=Kr[2],i[r++]=Kr[3],i[r++]=Kr[4],i[r++]=Kr[5],i[r++]=Kr[6],i[r++]=Kr[7]}function ro(e){let t,r=0,i=0;do t=wF(e),r<32&&(i|=(127&t)<<r),r+=7;while(128&t);return i}function De(e,t){for(t>>>=0;t>=128;)FP(e,127&t|128),t>>>=7;FP(e,t)}function na(e,t){let r=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,o=n===0?i===0?r<16384?r<128?1:2:r<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:n<128?9:10,a=Wl(e,o),s=e.bytes;switch(o){case 10:s[a+9]=n>>>7&1;case 9:s[a+8]=o!==9?128|n:127&n;case 8:s[a+7]=o!==8?i>>>21|128:i>>>21&127;case 7:s[a+6]=o!==7?i>>>14|128:i>>>14&127;case 6:s[a+5]=o!==6?i>>>7|128:i>>>7&127;case 5:s[a+4]=o!==5?128|i:127&i;case 4:s[a+3]=o!==4?r>>>21|128:r>>>21&127;case 3:s[a+2]=o!==3?r>>>14|128:r>>>14&127;case 2:s[a+1]=o!==2?r>>>7|128:r>>>7&127;case 1:s[a]=o!==1?128|r:127&r}}function BP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}var uZ=new Map([["moderation",1],["supervise",2]]);function jP(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var hZ=class extends tt{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(xt.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=xn(t=e.map(r=>uZ.get(r)||0)).call(t,(r,i)=>r+i),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),v(this,"name","AgoraRTCVideoContentInspect"),v(this,"_connectionState",Ji.CONNECTING),v(this,"_innerConnectionState",void 0),v(this,"sequence",0),v(this,"inspectStartTime",void 0),v(this,"workerManagerConnection",void 0),v(this,"workerConnection",void 0),v(this,"workerMessageLengthLimit",void 0),v(this,"inspectIntervalMinimum",void 0),v(this,"qualityRatio",void 0),v(this,"_connectInfo",void 0),v(this,"_cancelTokenSource",Vr.CancelToken.source()),v(this,"_retryConfig",void 0),v(this,"wmSequence",0),v(this,"inspectInterval",void 0),v(this,"inspectTimer",null),v(this,"ossFilePrefix",void 0),v(this,"extraInfo",void 0),v(this,"_inspectType",void 0),v(this,"_inspectMode",void 0),v(this,"_quality",1),v(this,"qualityTimer",null),v(this,"_inspectId",void 0),v(this,"_needWorkUrlOnly",!1),v(this,"inspectImage",()=>{if(this.connectionState!==Ji.CONNECTED)throw new D(R.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ji.CONNECTED?this.requestToInspectImage():f.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Fe(5,"inspect-"),this.workerMessageLengthLimit=w("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=w("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=w("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Mu("worker-manager-"+this._inspectId,Rt),this.on(xt.STATE_CHANGE,(t,r)=>{this._innerConnectionState=t,f.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ki[t]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Mu("worker-"+this._inspectId,Rt),this.handleWorkerEvents()}async init(e,t){this.emit(xt.STATE_CHANGE,Ki.CONNECT_AP),this._connectInfo=e;let r=this._cancelTokenSource.token;return this._retryConfig=t,new K((i,n)=>{this.on(xt.CONNECTION_STATE_CHANGE,(o,a)=>{a===Ji.CONNECTED&&i()}),this.requestAP(e,r,t).then(o=>{this.connectWorkerManager(o)}).catch(o=>{n(o)})})}async requestAP(e,t,r){let i=w("WEBCS_DOMAIN").map(a=>"https://".concat(a,"/api/v1")),n=await function(a,s,c,l){let{appId:d,areaCode:u,cname:h,sid:p,token:g,uid:_}=s;nl++;let E="image_moderation_api",S={service_name:E,json_body:JSON.stringify({appId:d,areaCode:u,cname:h,command:"allocateEdge",requestId:nl,seq:nl,sid:p,token:g,ts:Date.now(),uid:_+""})},T,y,I=a[0];return Fn(async()=>{T=Date.now();let O=await Bn(I,{data:S,cancelToken:c,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(y=Date.now()-T,O.code!==0){let j=new D(R.UNEXPECTED_RESPONSE,"image inspect ap error, code"+O.code,{retry:!0,responseTime:y});throw f.error(j.toString()),j}let b=JSON.parse(O.json_body);if(b.code!==200){let j=new D(R.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(b.code,", reason: ").concat(b.reason),{code:b.code,responseTime:y});throw f.error(j.toString()),j}if(!b.servers||!Array.isArray(b.servers)||b.servers.length===0){let j=new D(R.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:b.code,responseTime:y});throw f.error(j.toString()),j}let k=w("VIDEO_INSPECT_WORKER_MANAGER_HOST"),P=w("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:b.servers.map(j=>{let{address:G,wss:ce}=j;if(G&&ce)return"wss://".concat(G.replace(/\./g,"-"),".").concat(k,":").concat(P||ce)}).filter(j=>!!j),workerToken:b.workerToken,vid:b.vid,responseTime:y}},(O,b)=>(Q.apworkerEvent(p,{success:!0,sc:200,serviceName:E,responseDetail:JSON.stringify(O.addressList),firstSuccess:b===0,responseTime:y,serverIp:a[b%a.length]}),!1),(O,b)=>(Q.apworkerEvent(p,{success:!1,sc:O.data&&O.data.code||200,serviceName:E,responseTime:y,serverIp:a[b%a.length]}),!!(O.code!==R.OPERATION_ABORTED&&O.code!==R.UNEXPECTED_RESPONSE||O.data&&O.data.retry)&&(I=a[(b+1)%a.length],!0)),l)}(i,e,t,r);this.emit(xt.STATE_CHANGE,Ki.AP_CONNECTED);let{addressList:o}=n;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=t,this.emit(xt.STATE_CHANGE,Ki.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(se.CONNECTED,async()=>{this.emit(xt.STATE_CHANGE,Ki.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(se.CLOSED,()=>{this._innerConnectionState<Ki.GET_WORKER_MANAGER_RESPONSE&&f.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(se.FAILED,()=>{this._innerConnectionState<Ki.GET_WORKER_MANAGER_RESPONSE&&f.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(se.RECONNECTING,()=>{this._innerConnectionState<Ki.GET_WORKER_MANAGER_RESPONSE&&f.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(se.ON_MESSAGE,async e=>{this.emit(xt.STATE_CHANGE,Ki.GET_WORKER_MANAGER_RESPONSE);let t=this.workerManagerConnection.url;this.workerManagerConnection.close();let r=JSON.parse(e.data);if(r.code!==200)throw f.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new D(R.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&t))throw f.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new D(R.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{let i=w("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,n=t.replace(/:\d+\/?$/,":".concat(i));this.emit(xt.STATE_CHANGE,Ki.CONNECT_WORKER,n),this._needWorkUrlOnly?this.emit(xt.REQUEST_NEW_WORKER_URL,n):await this.connectWorker(n)}}),this.workerManagerConnection.on(se.WILL_RECONNECT,(e,t,r)=>{r(e)}),this.workerManagerConnection.on(se.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(se.CONNECTED,async()=>{this.emit(xt.STATE_CHANGE,Ki.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ji.CONNECTED}),this.workerConnection.on(se.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let r=nZ(new Uint8Array(e.data));if(w("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&f.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(xt.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var t;let i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},n=xn(t=Object.keys(i)).call(t,(a,s)=>i[a]>i[s]?a:s,"porn"),o=Object.keys(i).find(a=>a===n);this.emit(xt.INSPECT_RESULT,o)}else this.emit(xt.INSPECT_RESULT,void 0,new D(R.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(xt.INSPECT_RESULT,void 0,new D(R.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else f.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(xt.INSPECT_RESULT,void 0,new D(R.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(se.CLOSED,()=>{this.connectionState=Ji.CLOSED}),this.workerConnection.on(se.FAILED,()=>{this.connectionState=Ji.CLOSED}),this.workerConnection.on(se.RECONNECTING,()=>{this.connectionState=this.connectionState===Ji.CONNECTED?Ji.RECONNECTING:Ji.CONNECTING}),this.workerConnection.on(se.WILL_RECONNECT,(e,t,r)=>{e==="recover"&&r(e),r("tryNext")}),this.workerConnection.on(se.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(xt.REQUEST_NEW_WORKER_URL,r=>{e([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{t(r)})})}async requestToInspectImage(){this.sequence++;let e=Mi(this,xt.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(xt.INSPECT_RESULT,void 0,new D(R.INVALID_OPERATION,"Only the track being played can be inspected"));let r=await this.generateRequestData(e,t);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(xt.INSPECT_RESULT,void 0,new D(R.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:r,cname:i,cid:n,vid:o,sid:a,uid:s}=t,c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await cV(l,r,i),u=this.sequence+"-"+n+"-"+s+"-"+c+"-"+Fe(12,""),h={appId:r,cid:n,cname:i,deviceId:"",elapse:jP(Number(c-this.inspectStartTime)),fileSize:d.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.22.0",sequence:this.sequence,sid:a,timestamp:jP(c),uid:s,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete h.callbackData,this.ossFilePrefix===void 0&&delete h.ossFilePrefix;let p=iZ(h);if(p.byteLength<this.workerMessageLengthLimit){if(w("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let g=function(_){for(var E=1;E<arguments.length;E++){var S=arguments[E]!=null?arguments[E]:{};E%2?BP(Object(S),!0).forEach(function(T){v(_,T,S[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(S)):BP(Object(S)).forEach(function(T){Object.defineProperty(_,T,Object.getOwnPropertyDescriptor(S,T))})}return _}({},h);delete g.jpg,f.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(g))}return p}{let g=this.quality*this.qualityRatio;return this.quality=g,await this.generateRequestData(e,{appId:r,cname:i,cid:n,vid:o,sid:a,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Vr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ji.CLOSED,this.emit(xt.STATE_CHANGE,Ki.CLOSED)}},pZ={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new D(R.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new D(R.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let i=[...new Set(r.inspectType)];i.forEach(n=>{var o;if(!Y(o=["supervise","moderation"]).call(o,n))throw new D(R.INVALID_PARAMS,"".concat(n," is not a valid inspect type."))}),r.inspectType=i}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new D(R.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new hZ(t)}};Le("PROCESS_ID","process-".concat(Fe(8,""),"-").concat(Fe(4,""),"-").concat(Fe(4,""),"-").concat(Fe(4,""),"-").concat(Fe(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void f.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();f.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(pt,i)){let{value:n,expires:o}=t[i];if(o&&o<=r)return;Sa[i]=n,pt[i]=n}})}catch(t){f.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Sa.AREAS)&&Sa.AREAS.length>0&&kR(Sa.AREAS,!0);var GP=(e,t,r)=>{f.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Le(e,t,r)};_d(ZQ,!1),_d(rZ,!1),_d(xJ,!1),_d(pZ,!1),_d(XQ,!1);var rt=function(e){let t=new tt,r=e,i={getListeners:t.getListeners.bind(t),on:(n,o)=>(function(a,s){a===eo.SECURITY_POLICY_VIOLATION&&ZV(s,!0)}(n,o),t.on.bind(t)(n,o)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return _P(_P({},r),i)}({__TRACK_LIST__:Tc,VERSION:Ui,BUILD:SR,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:GP,getParameter:w,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,r=await async function(i){let n;return ye().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),n=(await i.createOffer()).sdp):n=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,n}(t);if(!r)return e;t.close(),t=null,e=function(i){let n={video:[],audio:[]};return i.match(/ VP8/i)&&n.video.push("VP8"),i.match(/ VP9/i)&&n.video.push("VP9"),i.match(/ AV1/i)&&n.video.push("AV1"),i.match(/ H264/i)&&n.video.push("H264"),i.match(/ H265/i)&&n.video.push("H265"),i.match(/ opus/i)&&n.audio.push("OPUS"),i.match(/ PCMU/i)&&n.audio.push("PCMU"),i.match(/ PCMA/i)&&n.audio.push("PCMA"),i.match(/ G722/i)&&n.audio.push("G722"),n}(r)}catch(t){throw new D(R.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=Q.reportApiInvoke(null,{name:wt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:nt.TRACER}),t=!1;try{let o=window.RTCPeerConnection,a=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,s=window.WebSocket;t=!!(o&&a&&s),t&&fR()&&px(75)&&new o().close()}catch(o){return f.error("check system requirement failed: ",o),!1}let r=!1,i=ve();i.name===Ne.CHROME&&Number(i.version)>=58&&(Nn.engine.name!=="WebKit"||function(){let o=ve();if(e_()){if(o.os===Lt.MAC_OS)return!0;if(o.os===Lt.IOS){let a=Nn.os.version&&Nn.os.version.split(".");if(a&&Number(a[0])===14&&a[1]&&Number(a[1])>=3||a&&Number(a[0])>14)return!0}}return!1}())&&(r=!0),(i.name===Ne.FIREFOX&&Number(i.version)>=56||i.name===Ne.OPERA&&Number(i.version)>=45||i.name===Ne.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(Or()||un())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||Ex()||ve().name===Ne.QQ)&&(r=!0),f.debug("checkSystemRequirements, api:",t,"browser",r);let n=t&&r;return e.onSuccess(n),n},getDevices:function(e){return gi.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return gi.getRecordingDevices(e)},getCameras:function(e){return gi.getCamerasDevices(e)},getElectronScreenSources:Qx,getPlaybackDevices:function(e){return gi.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},r=Q.reportApiInvoke(null,{name:wt.CREATE_CLIENT,options:[t],tag:nt.TRACER});try{(function(i){Ot(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ot(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&Ot(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&jt(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&yx(i.turnServer),i.httpRetryConfig!==void 0&&LO(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&LO(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(_x(16,0)||mx(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",f.debug("browser not support vp9, force use vp8")),Le("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new VJ(An(An({forceWaitGatewayResponse:!0},t),{},{role:Y(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=w("CAMERA_CAPTURE_CONFIG"),r=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CREATE_CAM_VIDEO_TRACK,options:[qe({},e),t]});t&&(e.encoderConfig=t);let i=n_(e),n=Fe(8,"track-cam-"),o=null;f.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{o=(await fi({video:i},n)).getVideoTracks()[0]||null}catch(s){throw r.onError(s),s}if(!o){let s=new M(R.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(s),s.throw(f)}e.optimizationMode&&Vg(n,o,e,oo(e.encoderConfig));let a=new Ev(o,e,i,e.scalabiltyMode?hp(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(a.getTrackId()),f.info("create camera video success, trackId:",n),a},createCustomVideoTrack:function(e){let t=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new We(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?hp(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,Fe(8,"track-cus-"),[Ye.CUSTOM_TRACK]);return t.onSuccess(r.getTrackId()),f.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",r=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CREATE_SCREEN_VIDEO_TRACK,options:[qe({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let i=function(d){let u={};d.screenSourceType&&(u.mediaSource=d.screenSourceType),d.extensionId&&La()&&(u.extensionId=d.extensionId);let{displaySurface:h,selfBrowserSurface:p,surfaceSwitching:g,systemAudio:_}=d;(tv(107)||OO(107)||bO(93))&&(h&&(Ot(h,"displaySurface",["browser","window","monitor"]),u.displaySurface=h),p?(Ot(p,"selfBrowserSurface",["exclude","include"]),u.selfBrowserSurface=p):u.selfBrowserSurface="include",g&&(Ot(g,"surfaceSwitching",["exclude","include"]),u.surfaceSwitching=g)),(tv(105)||OO(105)||bO(91))&&_&&(Ot(_,"systemAudio",["exclude","include"]),u.systemAudio=_),d.electronScreenSourceId&&(u.sourceId=d.electronScreenSourceId);let E=d.encoderConfig?Lg(d.encoderConfig):null;return u.mandatory={chromeMediaSource:"desktop",maxWidth:E?E.width:void 0,maxHeight:E?E.height:void 0},E&&(E.frameRate&&(typeof E.frameRate=="number"?(u.mandatory.maxFrameRate=E.frameRate,u.mandatory.minFrameRate=E.frameRate):(u.mandatory.maxFrameRate=E.frameRate.max||E.frameRate.ideal||E.frameRate.exact||void 0,u.mandatory.minFrameRate=E.frameRate.min||E.frameRate.ideal||E.frameRate.exact||void 0),u.frameRate=E.frameRate),E.width&&(u.width=E.width),E.height&&(u.height=E.height)),u}(e),n=Fe(8,"track-scr-v-"),o=null,a=null,s=ye();if(!s.supportShareAudio&&t==="enable"){let d=new M(R.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(d),d.throw(f)}f.info("start create screen video track with config",e,"withAudio",t,"trackId",n);try{let d=await fi({screen:i,screenAudio:t==="auto"?s.supportShareAudio:t==="enable"},n);o=d.getVideoTracks()[0]||null,a=d.getAudioTracks()[0]||null}catch(d){throw r.onError(d),d}if(!o){let d=new M(R.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(d),d.throw(f)}if(!a&&t==="enable"){o&&o.stop();let d=new M(R.SHARE_AUDIO_NOT_ALLOWED);return r.onError(d),d.throw(f)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Vg(n,o,e,e.encoderConfig&&Lg(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let c=new We(o,e.encoderConfig?Lg(e.encoderConfig):{},e.scalabiltyMode?hp(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[Ye.SCREEN_TRACK]);if(!a)return r.onSuccess(c.getTrackId()),f.info("create screen video track success","video:",c.getTrackId()),c;let l=new it(a,void 0,Fe(8,"track-scr-a-"),!1);return r.onSuccess([c.getTrackId(),l.getTrackId()]),f.info("create screen video track success","video:",c.getTrackId(),"audio:",l.getTrackId()),[c,l]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=w("CAMERA_CAPTURE_CONFIG"),i=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);let n=n_(t),o=M0(e),a=Fe(8,"track-mic-"),s=Fe(8,"track-cam-"),c=null,l=null;f.info("start create camera video track(".concat(s,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let h=await fi({audio:o,video:n},"".concat(a,"-").concat(s));c=h.getAudioTracks()[0],l=h.getVideoTracks()[0]}catch(h){throw i.onError(h),h}if(!c||!l){let h=new M(R.UNEXPECTED_ERROR,"can not find tracks in media stream");return i.onError(h),h.throw(f)}t.optimizationMode&&Vg(s,l,t,oo(t.encoderConfig));let d=new o_(c,e,o,a),u=new Ev(l,t,n,t.scalabiltyMode?hp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return i.onSuccess([d.getTrackId(),u.getTrackId()]),f.info("create camera video track(".concat(s,") and microphone audio track(").concat(a,") success")),[d,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=M0(e),i=Fe(8,"track-mic-"),n=null;f.info("start create microphone audio track with config",JSON.stringify(e),"trackId",i);try{n=(await fi({audio:r},i)).getAudioTracks()[0]||null}catch(a){throw t.onError(a),a}if(!n){let a=new M(R.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(a),a.throw(f)}let o=new o_(n,e,r,i);return t.onSuccess(o.getTrackId()),f.info("create microphone audio track success, trackId:",i),o},createCustomAudioTrack:function(e){let t=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new it(e.mediaStreamTrack,e.encoderConfig?i_(e.encoderConfig):{},Fe(8,"track-cus-"),!1);return f.info("create custom audio track success with config",e,"trackId",r.getTrackId()),t.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:r,encoderConfig:i}=e,{source:n}=e,o={source:n instanceof AudioBuffer?"AudioBuffer":n instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":n,cacheOnlineFile:r,encoderConfig:i},a=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(w("DISABLE_WEBAUDIO"))throw new M(R.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let s=Fe(8,"track-buf-");f.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",s);let c=n;if(!(n instanceof AudioBuffer))try{n=await async function(u,h){let p=null;if(typeof u=="string"){let _=Sb.get(u);if(_)return f.debug("use cached audio resource: ",u),_;try{p=(await Fn(()=>Vr.get(u,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(E){throw new M(R.FETCH_AUDIO_FILE_FAILED,E.toString())}}else p=await new K((_,E)=>{let S=new FileReader;S.onload=T=>{T.target?_(T.target.result):E(new M(R.READ_LOCAL_AUDIO_FILE_ERROR))},S.onerror=()=>{E(new M(R.READ_LOCAL_AUDIO_FILE_ERROR))},S.readAsArrayBuffer(u)});let g=await function(_){let E=Fl();return new K((S,T)=>{E.decodeAudioData(_,y=>{S(y)},y=>{T(new M(R.DECODE_AUDIO_FILE_FAILED,y.toString()))})})}(p);return typeof u=="string"&&h&&Sb.set(u,g),g}(n,r)}catch(u){return a.onError(u),u.throw(f)}let l=new LX(n),d=new kX(c,l,i?i_(i):{},s);return f.info("create buffer source audio track success, trackId:",s),a.onSuccess(d.getTrackId()),d},setAppType:function(e){if(f.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw f.debug("Invalid appType"),new D(R.INVALID_PARAMS,"invalid app type",e);Le("APP_TYPE",Math.floor(e))},setLogLevel:function(e){f.setLogLevel(e)},enableLogUpload:function(){w("USE_NEW_LOG")?Le("UPLOAD_LOG",!0):f.enableLogUpload()},disableLogUpload:function(){w("USE_NEW_LOG")?Le("UPLOAD_LOG",!1):f.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new xV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof it||e instanceof il)){let c=new D(R.INVALID_TRACK,"the parameter is not a audio track");return r.onError(c),c.throw()}t&&t<1e3&&(t=1e3);let i=e instanceof it?e.getTrackLabel():"remote_track",n=e.getVolumeLevel(),o=n,a=n,s=Date.now();return new K(c=>{let l=setInterval(()=>{let d=e.getVolumeLevel();o=d>o?d:o,a=d<a?d:a;let u=o-a>1e-4,h=Date.now()-s;if(u||h>t){clearInterval(l);let p=u,g={duration:h,deviceLabel:i,maxVolumeLevel:o,result:p};f.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(g))),r.onSuccess(g),c(p)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=Q.reportApiInvoke(null,{tag:nt.TRACER,name:wt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof We||e instanceof rl)){let u=new D(R.INVALID_TRACK,"the parameter is not a video track");return r.onError(u),u.throw()}t&&t<1e3&&(t=1e3);let i=e instanceof We?e.getTrackLabel():"remote_track",n=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(er()||e_())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([n]),o.play();let a=document.createElement("canvas");a.width=160,a.height=120;let s=0,c=0;try{let u=Date.now();s=await function(h,p,g,_){let E,S=0,T=null;return new K((y,I)=>{function O(){S>_&&E&&(E(),y(S));let b=g.getContext("2d");if(!b){let j=new D(R.UNEXPECTED_ERROR,"can not get canvas 2d context.");return f.error(j.toString()),void I(j)}b.drawImage(h,0,0,160,120);let k=b.getImageData(0,0,g.width,g.height),P=Math.floor(k.data.length/3);if(T){for(let j=0;j<P;j+=3)if(k.data[j]!==T[j])return S+=1,void(T=k.data);T=k.data}else T=k.data}setTimeout(()=>{E&&(E(),y(S))},p),E=AR(()=>{O()},30)})}(o,t,a,4),c=Date.now()-u}catch(u){throw r.onError(u),u}yJ===Ne.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;let l=s>4,d={duration:c,changedPicNum:s,deviceLabel:i,result:l};return f.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),r.onSuccess(d),l},setArea:kR,audioElementPlayCenter:Mr,resumeAudioContext:function(){Mr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){BJ.processExternalMediaAEC(e)},registerExtensions:function(e){let t=w("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!Y(t).call(t,r.name)&&t.push(r.name);let i=r;i.__registered__=!0,i.logger.hookLog=f.extLog,i.reporter.hookApiInvoke=Q.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(n=>{i.parameters[n]=w(n)})}),GP("PLUGIN_INFO",t)},ChannelMediaRelayError:Sc,ChannelMediaRelayEvent:Ro,ChannelMediaRelayState:Hr,RemoteStreamFallbackType:wX,RemoteStreamType:IX,ConnectionDisconnectedReason:Pe,AudienceLatencyLevelType:o9,AREAS:we,preload:async function(e,t,r,i){return WV(e,t,r,i)}});Object.defineProperties(rt,{onAudioAutoplayFailed:{get:()=>di.onAudioAutoplayFailed,set:e=>{di.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>di.onAutoplayFailed,set:e=>{di.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>rt._onSecurityPolicyViolation,set(e){rt._onSecurityPolicyViolation=e,ZV(e)}},__CLIENT_LIST__:{get:()=>w("SHOW_GLOBAL_CLIENT_LIST")?ua:[]}}),gi.on(vs.CAMERA_DEVICE_CHANGED,e=>{f.info("camera device changed",JSON.stringify(e)),rt.onCameraChanged&&rt.onCameraChanged(e),rt.safeEmit(eo.CAMERA_CHANGED,e)}),gi.on(vs.RECORDING_DEVICE_CHANGED,e=>{f.info("microphone device changed",JSON.stringify(e)),rt.onMicrophoneChanged&&rt.onMicrophoneChanged(e),rt.safeEmit(eo.MICROPHONE_CHANGED,e)}),gi.on(vs.PLAYOUT_DEVICE_CHANGED,e=>{f.debug("playout device changed",JSON.stringify(e)),rt.onPlaybackDeviceChanged&&rt.onPlaybackDeviceChanged(e),rt.safeEmit(eo.PLAYBACK_DEVICE_CHANGED,e)}),Mr.onAutoplayFailed=()=>{f.info("detect audio element autoplay failed"),di.onAudioAutoplayFailed&&di.onAudioAutoplayFailed()},ke.on("autoplay-failed",()=>{f.info("detect webaudio autoplay failed"),di.onAudioAutoplayFailed&&di.onAudioAutoplayFailed(),rt.safeEmit(eo.AUTOPLAY_FAILED)}),ke.on(Wt.STATE_CHANGE,(e,t)=>{f.info("audio context state changed: ".concat(t," => ").concat(e)),rt.onAudioContextStateChanged&&rt.onAudioContextStateChanged(e,t),rt.safeEmit(eo.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),St.on(Fc.NETWORK_STATE_CHANGE,(e,t)=>{f.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=rt);function Is(e,t,r){return e.on(t,r),()=>e.off(t,r)}function fZ(e){try{return e()}catch(t){console.error(t)}}function fm(e){return()=>e.forEach(fZ)}function _Z(e,t){let r=setTimeout(e,t);return()=>clearTimeout(r)}function HR(){let e,t,r;function i(){if(t){let l=t;t=void 0,l()}}async function n(){if(r){let l=r;r=void 0;try{await l()}catch(d){console.error(d)}}}async function o(l){e=!0,await n();try{r=await l()}catch(d){console.error(d)}e=!1,i()}async function a(){e=!0,await n(),e=!1,i()}function s(l){e?t=()=>o(l):o(l)}function c(){e?t=a:a()}return{run:s,dispose:c}}var AF=typeof document<"u"?H.useLayoutEffect:H.useEffect;function mZ(e){return e!=null&&typeof e.then=="function"}function fh(){let e=H.useRef(!1);return H.useEffect(()=>(e.current=!1,()=>{e.current=!0}),[]),e}function EZ(){let e=fh();function t(r,i){return new Promise(async(n,o)=>{try{let a=await r;e.current||n(a)}catch(a){e.current?i&&i(a):o(a)}})}return H.useCallback(t,[e])}function OF(e){let t=EZ(),[r,i]=H.useState();return AF(()=>{mZ(e)?t(e).then(i):i(e)},[e,t]),r}function _m(e,t){let r=H.useRef();H.useEffect(()=>{let{run:i,dispose:n}=r.current||(r.current=HR());return i(e),n},t)}function gZ(e,t){let r=e.split("."),i=t.split("."),n=Math.max(r.length,i.length);for(let o=0;o<n;o++){let a=parseInt(r[o]||"0"),s=parseInt(i[o]||"0");if(a>s)return 1;if(a<s)return-1}return 0}var bF=H.createContext(null);function SZ({client:e,children:t}){return W.jsx(bF.Provider,{value:e,children:t})}function TZ(e){let t=H.useContext(bF);return e||t}function Hl(e){let t=TZ(e);if(!t)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return t}H.createContext(null);function _h(e){let t=Hl(e),[r,i]=H.useState(t?t.connectionState==="CONNECTED":!1);return H.useEffect(()=>{if(t){i(t.connectionState==="CONNECTED");let n;return fm([Is(t,"connection-state-change",o=>{n==null||n(),n=_Z(()=>i(o==="CONNECTED"),0)}),()=>n==null?void 0:n()])}else i(!1)},[t]),r}var Gs=class extends Error{constructor(t,r){var e=(...Uee)=>(super(...Uee),Kl(this,"rtcMethod"),Kl(this,"rtcError"),Kl(this,"name","AgoraRTCReactException"),this);e(typeof r=="string"?r:r.message),this.rtcMethod=t,this.rtcError=r}log(t){console[t](this)}};function vZ(e,t=!0,r){let i=Hl(r),n=_h(r),o=H.useRef(),[a,s]=H.useState(!1),[c,l]=H.useState(0),[d,u]=H.useState(null),h=fh();return _m(async()=>{if(h.current||(u(null),l(0),s(!1)),t&&i){try{h.current||s(!0);let{appid:g,channel:_,token:E,uid:S}=typeof e=="function"?await e():e,T=await i.join(g,_,E,S);h.current||l(T)}catch(g){console.error(g),h.current||u(new Gs("IAgoraRTCClient.join",g))}h.current||s(!1);let p=o.current||(o.current=HR());return fm([()=>{p.dispose()},()=>{p.run(()=>i.unpublish(i.localTracks))},()=>{for(let g of i.localTracks)g.isPlaying&&g.stop(),g.close();p.run(()=>i.leave())}])}},[t,r]),{data:c,isLoading:a,isConnected:n,error:d}}function yZ(e,t=!0,r){let i=Hl(r),n=_h(r),o=H.useRef([]),[a,s]=H.useState(!1),[c,l]=H.useState(null),d=fh();return _m(async()=>{if(d.current||(s(!1),l(null)),!i||!n||!t)return;let u=e.filter(Boolean),h=_=>{let E=gZ(rt.VERSION,"4.18.2")>=0;return E||new Gs("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),E?i.mode!=="live"||i.role!=="audience":!0},p=_=>o.current.some(E=>E&&E.getTrackId()===_.getTrackId()),g=_=>h()&&_.enabled&&t&&!p(_);for(let _=0;_<u.length;_++){let E=u[_];if(E&&g(E)){await i.unpublish(o.current.filter(S=>(S==null?void 0:S.trackMediaType)===E.trackMediaType));try{d.current||s(!0),await i.publish(E)}catch(S){console.error(S),d.current||l(new Gs("IAgoraRTCClient.publish",S))}d.current||s(!1)}}o.current=u},[n,t,i,e]),{isLoading:a,error:c}}function RZ(e=!0,t={ANS:!0,AEC:!0},r){let i=_h(r),[n,o]=H.useState(null),[a,s]=H.useState(!1),[c,l]=H.useState(null),d=fh();return _m(async()=>{if(d.current||(s(!1),l(null)),i&&e&&!n){try{d.current||s(!0);let u=await rt.createMicrophoneAudioTrack(t);d.current||o(u)}catch(u){console.error(u),d.current||l(new Gs("IAgoraRTC.createMicrophoneAudioTrack",u))}d.current||s(!1)}!i&&!d.current&&o(null)},[i,e]),{localMicrophoneTrack:n,isLoading:a,error:c}}function WP(e,t,r){let i=Hl(r),n=t==="audio"?"audioTrack":"videoTrack",[o,a]=H.useState(e&&e[n]),s=_h(),c=H.useRef(),[l,d]=H.useState(!1),[u,h]=H.useState(null);return H.useEffect(()=>{if(!e||!s)return;let p=!1;p||h(null);let g=t==="audio"?"hasAudio":"hasVideo",_=e.uid,E=async(y,I)=>{if(y[n]&&i.remoteUsers.some(({uid:O})=>y.uid===O))try{p||d(!0),await i.unsubscribe(y,I)}catch(O){p||h(new Gs("IAgoraRTCClient.unsubscribe",O)),console.error(O)}p||(a(void 0),d(!1))},S=async(y,I)=>{try{!y[n]&&i.remoteUsers.some(({uid:O})=>y.uid===O)&&(p||d(!0),await i.subscribe(y,I)),p||a(y[n])}catch(O){p||h(new Gs("IAgoraRTCClient.subscribe",O)),console.error(O)}p||d(!1)},T=c.current||(c.current=HR());return!e[n]&&e[g]?T.run(()=>S(e,t)):a(e[n]),fm([()=>{p=!0,T.dispose()},Is(i,"user-published",(y,I)=>{y.uid===_&&I===t&&T.run(()=>S(y,t))}),Is(i,"user-unpublished",(y,I)=>{y.uid===_&&I===t&&T.run(()=>E(y,t))})])},[s,i,e,t,n]),{track:o,isLoading:l,error:u}}function CZ(e){let t=Hl(e),[r,i]=H.useState(t?t.remoteUsers:[]);return H.useEffect(()=>{if(t){let n=()=>i(t.remoteUsers.slice());return fm([Is(t,"user-joined",n),Is(t,"user-left",n),Is(t,"user-published",n),Is(t,"user-unpublished",n)])}},[t]),r}function IZ(e=!0,t,r,i){let n=_h(i),[o,a]=H.useState(null),[s,c]=H.useState(!1),[l,d]=H.useState(null),u=fh();return _m(async()=>{if(u.current||(c(!1),d(null)),n&&e&&!o){try{u.current||c(!0);let h=await rt.createScreenVideoTrack(t,r);u.current||a(h)}catch(h){console.error(h),u.current||d(new Gs("IAgoraRTC.createScreenVideoTrack",h))}u.current||c(!1)}(!n||!e)&&!u.current&&a(null)},[n,e]),{screenTrack:o,isLoading:s,error:l}}var NF=H.createContext(void 0);function DF(e,t,r,i){let n=H.useContext(NF);H.useEffect(()=>{if(e)return i&&t?e.play(i,r||void 0):e.stop(),n?(n.onMount(e),()=>n.onUnmount(e)):()=>{e.isPlaying&&e.stop()}},[e,i,t,n,r])}function PF(e,t){let r=H.useContext(NF);AF(()=>{if(e)return t?e.play():e.stop(),r?(r.onMount(e),()=>r.onUnmount(e)):()=>{e.isPlaying&&e.stop()}},[e,t,r])}function wZ({track:e,play:t=!1,volume:r,disabled:i,muted:n,children:o}){let a=OF(e);return PF(a,t),H.useEffect(()=>{a&&r!=null&&a.setVolume(r)},[a,r]),H.useEffect(()=>{a&&i!=null&&a.setEnabled(!i).catch(console.warn)},[i,a]),H.useEffect(()=>{a&&n!=null&&a.setMuted(n).catch(console.warn)},[n,a]),o?W.jsx(W.Fragment,{children:o}):null}var kF={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},LF={width:"100%",height:"100%"},KR={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},mm=(e,t)=>H.useMemo(()=>({...e,...t}),[e,t]);function AZ({track:e,play:t,disabled:r,muted:i,style:n,videoPlayerConfig:o,...a}){let s=mm(LF,n),[c,l]=H.useState(null),d=OF(e);return DF(d,t,o,c),H.useEffect(()=>{d&&r!=null&&d.setEnabled(!r).catch(console.warn)},[r,d]),H.useEffect(()=>{d&&i!=null&&d.setMuted(i).catch(console.warn)},[i,d]),W.jsx("div",{...a,ref:l,style:s})}var OZ={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},bZ={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function MF({cover:e}){return W.jsx("div",{style:KR,children:typeof e=="string"?W.jsxs(W.Fragment,{children:[W.jsx("div",{style:{...OZ,backgroundImage:`url(${e})`}}),W.jsx("img",{src:e,style:bZ})]}):e()})}function NZ({micOn:e,cameraOn:t,audioTrack:r,videoTrack:i,playAudio:n,playVideo:o,volume:a,cover:s,children:c,style:l,...d}){let u=mm(kF,l);return o=o??!!t,n=n??!!e,W.jsxs("div",{...d,style:u,children:[W.jsx(AZ,{disabled:!t,play:o,track:i}),W.jsx(wZ,{disabled:!e,play:n,track:r,volume:a}),s&&!t&&W.jsx(MF,{cover:s}),W.jsx("div",{style:KR,children:c})]})}function UF({track:e,play:t=!1,playbackDeviceId:r,volume:i,children:n}){return PF(e,t),H.useEffect(()=>{e&&r!=null&&e.setPlaybackDevice(r).catch(console.warn)},[e,r]),H.useEffect(()=>{e&&i!=null&&e.setVolume(i)},[e,i]),n?W.jsx(W.Fragment,{children:n}):null}function DZ({track:e,play:t,style:r,videoPlayerConfig:i,...n}){let o=mm(LF,r),[a,s]=H.useState(null);return DF(e,t,i,a),W.jsx("div",{...n,ref:s,style:o})}function HP({user:e,playVideo:t,playAudio:r,playbackDeviceId:i,volume:n,cover:o,style:a,children:s,videoPlayerConfig:c,...l}){let d=mm(kF,a),{track:u}=WP(e,"video"),{track:h}=WP(e,"audio");return t=t??(e==null?void 0:e.hasVideo),r=r??(e==null?void 0:e.hasAudio),W.jsxs("div",{...l,style:d,children:[W.jsx(DZ,{play:t,track:u,videoPlayerConfig:c}),W.jsx(UF,{play:r,playbackDeviceId:i,track:h,volume:n}),o&&!t&&W.jsx(MF,{cover:o}),W.jsx("div",{style:KR,children:s})]})}var PZ=class{constructor(){Kl(this,"appType",1001);rt.setAppType(this.appType)}};new PZ;var kZ=rt;const KP="/zerofk/assets/settings-ChOiMAHm.svg",LZ="/zerofk/assets/micro-on-BSq0Cfta.svg",MZ="/zerofk/assets/micro-off-tG7JZa8-.svg",UZ="/zerofk/assets/headphones-on-B0SgjIeR.svg",xZ="/zerofk/assets/headphones-off-sUOTabT-.svg",VZ="/zerofk/assets/screen-on-DwAiA92A.svg",FZ="/zerofk/assets/screen-off-BtyVzZUY.svg",BZ="/zerofk/assets/disconnect-CYP9XKp4.svg",jZ="/zerofk/assets/volumeOn-CA_acbJP.svg",GZ="/zerofk/assets/volumeOff-BUJSkcq4.svg";function kv(){return kv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},kv.apply(null,arguments)}var xF=["shift","alt","meta","mod","ctrl"],WZ={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function Ra(e){return(e&&WZ[e]||e||"").trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function HZ(e){return xF.includes(e)}function gS(e,t){return t===void 0&&(t=","),e.split(t)}function SS(e,t,r){t===void 0&&(t="+");var i=e.toLocaleLowerCase().split(t).map(function(a){return Ra(a)}),n={alt:i.includes("alt"),ctrl:i.includes("ctrl")||i.includes("control"),shift:i.includes("shift"),meta:i.includes("meta"),mod:i.includes("mod")},o=i.filter(function(a){return!xF.includes(a)});return kv({},n,{keys:o,description:r})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&VF([Ra(e.key),Ra(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&FF([Ra(e.key),Ra(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){Ca.clear()})})();var Ca=new Set;function zR(e){return Array.isArray(e)}function KZ(e,t){t===void 0&&(t=",");var r=zR(e)?e:e.split(t);return r.every(function(i){return Ca.has(i.trim().toLowerCase())})}function VF(e){var t=Array.isArray(e)?e:[e];Ca.has("meta")&&Ca.forEach(function(r){return!HZ(r)&&Ca.delete(r.toLowerCase())}),t.forEach(function(r){return Ca.add(r.toLowerCase())})}function FF(e){var t=Array.isArray(e)?e:[e];e==="meta"?Ca.clear():t.forEach(function(r){return Ca.delete(r.toLowerCase())})}function zZ(e,t,r){(typeof r=="function"&&r(e,t)||r===!0)&&e.preventDefault()}function YZ(e,t,r){return typeof r=="function"?r(e,t):r===!0||r===void 0}function $Z(e){return BF(e,["input","textarea","select"])}function BF(e,t){var r=e.target;t===void 0&&(t=!1);var i=r&&r.tagName;return zR(t)?!!(i&&t&&t.some(function(n){return n.toLowerCase()===i.toLowerCase()})):!!(i&&t&&t===!0)}function qZ(e,t){return e.length===0&&t?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):t?e.some(function(r){return t.includes(r)})||e.includes("*"):!0}var XZ=function(t,r,i){i===void 0&&(i=!1);var n=r.alt,o=r.meta,a=r.mod,s=r.shift,c=r.ctrl,l=r.keys,d=t.key,u=t.code,h=t.ctrlKey,p=t.metaKey,g=t.shiftKey,_=t.altKey,E=Ra(u),S=d.toLowerCase();if(!(l!=null&&l.includes(E))&&!(l!=null&&l.includes(S))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(E))return!1;if(!i){if(n===!_&&S!=="alt"||s===!g&&S!=="shift")return!1;if(a){if(!p&&!h)return!1}else if(o===!p&&S!=="meta"&&S!=="os"||c===!h&&S!=="ctrl"&&S!=="control")return!1}return l&&l.length===1&&(l.includes(S)||l.includes(E))?!0:l?KZ(l):!l},JZ=H.createContext(void 0),QZ=function(){return H.useContext(JZ)};function jF(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(r,i){return r&&jF(e[i],t[i])},!0):e===t}var ZZ=H.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),e1=function(){return H.useContext(ZZ)};function t1(e){var t=H.useRef(void 0);return jF(t.current,e)||(t.current=e),t.current}var zP=function(t){t.stopPropagation(),t.preventDefault(),t.stopImmediatePropagation()},r1=typeof window<"u"?H.useLayoutEffect:H.useEffect;function YP(e,t,r,i){var n=H.useState(null),o=n[0],a=n[1],s=H.useRef(!1),c=r instanceof Array?i instanceof Array?void 0:i:r,l=zR(e)?e.join(c==null?void 0:c.splitKey):e,d=r instanceof Array?r:i instanceof Array?i:void 0,u=H.useCallback(t,d??[]),h=H.useRef(u);d?h.current=u:h.current=t;var p=t1(c),g=e1(),_=g.enabledScopes,E=QZ();return r1(function(){if(!((p==null?void 0:p.enabled)===!1||!qZ(_,p==null?void 0:p.scopes))){var S=function(b,k){var P;if(k===void 0&&(k=!1),!($Z(b)&&!BF(b,p==null?void 0:p.enableOnFormTags))){if(o!==null){var j=o.getRootNode();if((j instanceof Document||j instanceof ShadowRoot)&&j.activeElement!==o&&!o.contains(j.activeElement)){zP(b);return}}(P=b.target)!=null&&P.isContentEditable&&!(p!=null&&p.enableOnContentEditable)||gS(l,p==null?void 0:p.splitKey).forEach(function(G){var ce,pe=SS(G,p==null?void 0:p.combinationKey);if(XZ(b,pe,p==null?void 0:p.ignoreModifiers)||(ce=pe.keys)!=null&&ce.includes("*")){if(p!=null&&p.ignoreEventWhen!=null&&p.ignoreEventWhen(b)||k&&s.current)return;if(zZ(b,pe,p==null?void 0:p.preventDefault),!YZ(b,pe,p==null?void 0:p.enabled)){zP(b);return}h.current(b,pe),k||(s.current=!0)}})}},T=function(b){b.key!==void 0&&(VF(Ra(b.code)),((p==null?void 0:p.keydown)===void 0&&(p==null?void 0:p.keyup)!==!0||p!=null&&p.keydown)&&S(b))},y=function(b){b.key!==void 0&&(FF(Ra(b.code)),s.current=!1,p!=null&&p.keyup&&S(b,!0))},I=o||(c==null?void 0:c.document)||document;return I.addEventListener("keyup",y),I.addEventListener("keydown",T),E&&gS(l,p==null?void 0:p.splitKey).forEach(function(O){return E.addHotkey(SS(O,p==null?void 0:p.combinationKey,p==null?void 0:p.description))}),function(){I.removeEventListener("keyup",y),I.removeEventListener("keydown",T),E&&gS(l,p==null?void 0:p.splitKey).forEach(function(O){return E.removeHotkey(SS(O,p==null?void 0:p.combinationKey,p==null?void 0:p.description))})}}},[o,l,p,_]),a}function i1(e){const t=e;return t.sort((r,i)=>(r.hasVideo?1:0)-(i.hasVideo?1:0)),t}const n1=e=>{var pr,x,L,B;const t=e.client,r=t.uid,{channelName:i}=$3(),[n,o]=H.useState(!0),[a,s]=H.useState(!1),[c,l]=H.useState(!0),[d,u]=H.useState(!1),{localMicrophoneTrack:h}=RZ(a,{encoderConfig:"high_quality_stereo",ANS:!0,AGC:!0,AEC:!1}),{screenTrack:p}=IZ(d,{encoderConfig:"1080p_5",optimizationMode:"detail"},"disable"),g=mM();vZ({appid:e.appId,channel:i,token:null},n),yZ([h]),!d&&p?t.unpublish(p).then(()=>{}):d&&p&&t.publish(p).then(()=>{});const _=CZ();a?h==null||h.setMuted(!1):h==null||h.setMuted(!0);const[E,S]=H.useState(!1),[T,y]=H.useState(_[0]),I=N=>{y(N),S(!E)};if(r===void 0){const N=document.getElementById("uid");N&&(N.style.color="#C96868")}else{const N=document.getElementById("uid");N&&(N.style.color="#ffffff")}const[O,b]=H.useState("v"),[k,P]=H.useState("m"),j=H.useCallback(()=>{s(!a)},[a]),G=H.useCallback(()=>{l(!c)},[c]);YP(O,j),YP(k,G);const ce=(N,m)=>{N.key&&(m==="micro"?b(N.key):m==="headphones"&&P(N.key))},[pe,Ae]=H.useState(100),[Ge,at]=H.useState(!1);return Ge?((pr=document.getElementById("body"))==null||pr.classList.add("show-drawer"),(x=document.getElementById("settings-icon"))==null||x.classList.add("active")):((L=document.getElementById("body"))==null||L.classList.remove("show-drawer"),(B=document.getElementById("settings-icon"))==null||B.classList.remove("active")),W.jsxs("div",{id:"body",children:[W.jsxs("div",{className:"navbar",children:[W.jsxs("h2",{style:{display:"flex"},children:[W.jsx("div",{className:"gold",children:"ZeroFK"}),W.jsx("div",{style:{fontFamily:"ruthie-regular",paddingLeft:"5px",color:"#b07dff",textShadow:"0 0 5px #ffffff"},children:"x SpaceBlack"})]}),W.jsxs("div",{className:"navbarData",children:[W.jsx("div",{className:"left-space",children:`Lobby: ${i}`}),W.jsxs("div",{className:"left-space",style:{display:"flex",gap:"4px"},children:[W.jsx("div",{children:"User ID:"}),W.jsx("div",{id:"uid",children:r??"undefined"})]})]}),W.jsxs("button",{className:"btn-settings",style:{display:"flex",gap:"4px",opacity:Ge?"0":"1"},onClick:()=>{at(N=>!N),console.log(Ge)},children:[W.jsx("div",{className:"control-icons",children:W.jsx("img",{src:KP,alt:"settings"})}),W.jsx("div",{children:"Settings"})]})]}),E?W.jsxs("div",{style:{display:"flex"},children:[W.jsx("div",{className:"backBTN",onClick:()=>S(!1),children:"Back"}),W.jsxs("div",{className:"remote-modal-container",style:{width:T.videoTrack?T.videoTrack.getCurrentFrameData().width/2:void 0,height:T.videoTrack?T.videoTrack.getCurrentFrameData().height/2:void 0},children:[W.jsx("div",{id:`user-${T.uid}`,className:"remote-video-modal",children:W.jsx(HP,{user:T,playAudio:c})},T.uid),W.jsx("div",{id:"userUID-modal",children:W.jsx("div",{className:"text-user-modal",children:T.uid})})]}),W.jsx("div",{id:"remoteVideoGrid",children:_.reverse().map(N=>{if(N.uid===T.uid)return W.jsx("div",{children:W.jsx("div",{id:`user-${N.uid}`,children:W.jsx(UF,{play:c,track:N.audioTrack},N.uid)},N.uid)})})})]}):W.jsxs(W.Fragment,{children:[W.jsxs("div",{id:"drawer",children:[W.jsx("div",{className:"nav-modal",children:W.jsxs("button",{className:"btn-settings",style:{display:"flex",gap:"4px"},onClick:()=>{at(N=>!N),console.log(Ge)},children:[W.jsx("div",{className:"control-icons",children:W.jsx("img",{id:"settings-icon",src:KP,alt:"settings"})}),W.jsx("div",{children:"Settings"})]})}),W.jsx("div",{style:{height:"76px",color:"transparent"}}),W.jsxs("div",{style:{position:"relative",backgroundColor:"rgba(103,103,103,0.65)",padding:"1em",paddingBottom:"3em",borderRadius:"15px",border:"1px solid #fff"},children:[W.jsx("h2",{style:{paddingBottom:"1em"},children:"Hotkeys"}),W.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1em"},children:[W.jsx("div",{className:"modal-action-text",children:"(Off/On) MICROPHONE"}),W.jsx("button",{onKeyDown:N=>ce(N,"micro"),children:O})]}),W.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1em",paddingTop:"2em"},children:[W.jsx("div",{className:"modal-action-text",children:"(Off/On) HEADPHONES"}),W.jsx("button",{onKeyDown:N=>ce(N,"headphones"),children:k})]})]})]}),W.jsx("div",{id:"remoteVideoGrid",children:i1(_).reverse().map(N=>W.jsx("div",{className:"remote-full-container",children:W.jsxs("div",{children:[W.jsxs("div",{className:"remote-addition",children:[W.jsx("div",{id:"userUID",children:W.jsx("div",{className:"text-user",children:N.uid})}),W.jsx("input",{id:"range",type:"range",min:0,max:100,step:1,onChange:m=>{Ae(m.target.valueAsNumber)}}),W.jsx("img",{style:{width:"20px"},src:pe>0?jZ:GZ,alt:"volume"}),W.jsx("div",{style:{paddingTop:"3px"},children:pe})]}),W.jsx("div",{id:`user-${N.uid}`,className:"remote-video-container",onClick:()=>{I(N)},children:W.jsx(HP,{user:N,playAudio:c,volume:pe})},N.uid)]})}))})]}),W.jsxs("div",{id:"localVideo",children:[W.jsx(NZ,{videoTrack:p,cameraOn:d,micOn:a,playVideo:d}),W.jsx("div",{children:W.jsx("div",{id:"controlsToolbar",children:W.jsxs("div",{id:"mediaControls",children:[W.jsx("button",{className:a?"buttonOn":"buttonOff",onClick:()=>s(N=>!N),children:W.jsx("div",{className:"control-icons",children:a?W.jsx("img",{src:LZ,alt:"Micro"}):W.jsx("img",{src:MZ,alt:"Micro"})})}),W.jsx("button",{className:c?"buttonOn":"buttonOff",onClick:()=>l(N=>!N),children:W.jsx("div",{className:"control-icons",children:c?W.jsx("img",{src:UZ,alt:"Headphones"}):W.jsx("img",{src:xZ,alt:"Headphones"})})}),W.jsx("button",{className:d?"buttonOn":"buttonOff",onClick:()=>u(N=>!N),children:W.jsx("div",{className:"control-icons",children:d?W.jsx("img",{src:VZ,alt:"ShareScreen"}):W.jsx("img",{src:FZ,alt:"ShareScreen"})})}),W.jsx("button",{id:"endConnection",onClick:()=>{u(!1),o(!1),g("/zerofk/")},children:W.jsx("div",{className:"control-icons",children:W.jsx("img",{src:BZ,alt:"Disconnect",style:{color:"#ffffff"}})})})]})})})]})]})};function o1(){const e=mM(),t=Hl(kZ.createClient({codec:"av1",mode:"rtc"})),[r,i]=H.useState(""),n=(o,a)=>{i(a),e(`/zerofk/via/${o}`)};return W.jsxs(cG,{children:[W.jsx(fT,{path:"/zerofk/",element:W.jsx(pG,{connectToVideo:n})}),W.jsx(fT,{path:"/zerofk/via/:channelName",element:W.jsx(SZ,{client:t,children:W.jsx(n1,{client:t,appId:r})})})]})}TS.createRoot(document.getElementById("root")).render(W.jsx(nk.StrictMode,{children:W.jsx(uG,{children:W.jsx(o1,{})})}));
