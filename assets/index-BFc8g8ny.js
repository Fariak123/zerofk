var YF=Object.defineProperty;var $F=(e,t,r)=>t in e?YF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ru=(e,t,r)=>$F(e,typeof t!="symbol"?t+"":t,r);function qF(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in e)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();function XF(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var rk={exports:{}},bm={},nk={exports:{}},Je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ah=Symbol.for("react.element"),JF=Symbol.for("react.portal"),QF=Symbol.for("react.fragment"),ZF=Symbol.for("react.strict_mode"),ej=Symbol.for("react.profiler"),tj=Symbol.for("react.provider"),rj=Symbol.for("react.context"),nj=Symbol.for("react.forward_ref"),ij=Symbol.for("react.suspense"),oj=Symbol.for("react.memo"),aj=Symbol.for("react.lazy"),rC=Symbol.iterator;function sj(e){return e===null||typeof e!="object"?null:(e=rC&&e[rC]||e["@@iterator"],typeof e=="function"?e:null)}var ik={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ok=Object.assign,ak={};function Ml(e,t,r){this.props=e,this.context=t,this.refs=ak,this.updater=r||ik}Ml.prototype.isReactComponent={};Ml.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ml.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function sk(){}sk.prototype=Ml.prototype;function GT(e,t,r){this.props=e,this.context=t,this.refs=ak,this.updater=r||ik}var WT=GT.prototype=new sk;WT.constructor=GT;ok(WT,Ml.prototype);WT.isPureReactComponent=!0;var nC=Array.isArray,ck=Object.prototype.hasOwnProperty,HT={current:null},lk={key:!0,ref:!0,__self:!0,__source:!0};function uk(e,t,r){var n,i={},o=null,a=null;if(t!=null)for(n in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(o=""+t.key),t)ck.call(t,n)&&!lk.hasOwnProperty(n)&&(i[n]=t[n]);var s=arguments.length-2;if(s===1)i.children=r;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)i[n]===void 0&&(i[n]=s[n]);return{$$typeof:ah,type:e,key:o,ref:a,props:i,_owner:HT.current}}function cj(e,t){return{$$typeof:ah,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function KT(e){return typeof e=="object"&&e!==null&&e.$$typeof===ah}function lj(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var iC=/\/+/g;function b_(e,t){return typeof e=="object"&&e!==null&&e.key!=null?lj(""+e.key):t.toString(36)}function Bp(e,t,r,n,i){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case ah:case JF:a=!0}}if(a)return a=e,i=i(a),e=n===""?"."+b_(a,0):n,nC(i)?(r="",e!=null&&(r=e.replace(iC,"$&/")+"/"),Bp(i,t,r,"",function(l){return l})):i!=null&&(KT(i)&&(i=cj(i,r+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(iC,"$&/")+"/")+e)),t.push(i)),1;if(a=0,n=n===""?".":n+":",nC(e))for(var s=0;s<e.length;s++){o=e[s];var c=n+b_(o,s);a+=Bp(o,t,r,c,i)}else if(c=sj(e),typeof c=="function")for(e=c.call(e),s=0;!(o=e.next()).done;)o=o.value,c=n+b_(o,s++),a+=Bp(o,t,r,c,i);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function bh(e,t,r){if(e==null)return e;var n=[],i=0;return Bp(e,n,"","",function(o){return t.call(r,o,i++)}),n}function uj(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var fn={current:null},Gp={transition:null},dj={ReactCurrentDispatcher:fn,ReactCurrentBatchConfig:Gp,ReactCurrentOwner:HT};function dk(){throw Error("act(...) is not supported in production builds of React.")}Je.Children={map:bh,forEach:function(e,t,r){bh(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return bh(e,function(){t++}),t},toArray:function(e){return bh(e,function(t){return t})||[]},only:function(e){if(!KT(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Je.Component=Ml;Je.Fragment=QF;Je.Profiler=ej;Je.PureComponent=GT;Je.StrictMode=ZF;Je.Suspense=ij;Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dj;Je.act=dk;Je.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=ok({},e.props),i=e.key,o=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,a=HT.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(c in t)ck.call(t,c)&&!lk.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&s!==void 0?s[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){s=Array(c);for(var l=0;l<c;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:ah,type:e.type,key:i,ref:o,props:n,_owner:a}};Je.createContext=function(e){return e={$$typeof:rj,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:tj,_context:e},e.Consumer=e};Je.createElement=uk;Je.createFactory=function(e){var t=uk.bind(null,e);return t.type=e,t};Je.createRef=function(){return{current:null}};Je.forwardRef=function(e){return{$$typeof:nj,render:e}};Je.isValidElement=KT;Je.lazy=function(e){return{$$typeof:aj,_payload:{_status:-1,_result:e},_init:uj}};Je.memo=function(e,t){return{$$typeof:oj,type:e,compare:t===void 0?null:t}};Je.startTransition=function(e){var t=Gp.transition;Gp.transition={};try{e()}finally{Gp.transition=t}};Je.unstable_act=dk;Je.useCallback=function(e,t){return fn.current.useCallback(e,t)};Je.useContext=function(e){return fn.current.useContext(e)};Je.useDebugValue=function(){};Je.useDeferredValue=function(e){return fn.current.useDeferredValue(e)};Je.useEffect=function(e,t){return fn.current.useEffect(e,t)};Je.useId=function(){return fn.current.useId()};Je.useImperativeHandle=function(e,t,r){return fn.current.useImperativeHandle(e,t,r)};Je.useInsertionEffect=function(e,t){return fn.current.useInsertionEffect(e,t)};Je.useLayoutEffect=function(e,t){return fn.current.useLayoutEffect(e,t)};Je.useMemo=function(e,t){return fn.current.useMemo(e,t)};Je.useReducer=function(e,t,r){return fn.current.useReducer(e,t,r)};Je.useRef=function(e){return fn.current.useRef(e)};Je.useState=function(e){return fn.current.useState(e)};Je.useSyncExternalStore=function(e,t,r){return fn.current.useSyncExternalStore(e,t,r)};Je.useTransition=function(){return fn.current.useTransition()};Je.version="18.3.1";nk.exports=Je;var Q=nk.exports;const hk=XF(Q),hj=qF({__proto__:null,default:hk},[Q]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pj=Q,fj=Symbol.for("react.element"),mj=Symbol.for("react.fragment"),_j=Object.prototype.hasOwnProperty,Ej=pj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gj={key:!0,ref:!0,__self:!0,__source:!0};function pk(e,t,r){var n,i={},o=null,a=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(a=t.ref);for(n in t)_j.call(t,n)&&!gj.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:fj,type:e,key:o,ref:a,props:i,_owner:Ej.current}}bm.Fragment=mj;bm.jsx=pk;bm.jsxs=pk;rk.exports=bm;var fe=rk.exports,Ov={},fk={exports:{}},qn={},mk={exports:{}},_k={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(D,W){var L=D.length;D.push(W);e:for(;0<L;){var S=L-1>>>1,I=D[S];if(0<i(I,W))D[S]=W,D[L]=I,L=S;else break e}}function r(D){return D.length===0?null:D[0]}function n(D){if(D.length===0)return null;var W=D[0],L=D.pop();if(L!==W){D[0]=L;e:for(var S=0,I=D.length,O=I>>>1;S<O;){var B=2*(S+1)-1,se=D[B],ge=B+1,ve=D[ge];if(0>i(se,L))ge<I&&0>i(ve,se)?(D[S]=ve,D[ge]=L,S=ge):(D[S]=se,D[B]=L,S=B);else if(ge<I&&0>i(ve,L))D[S]=ve,D[ge]=L,S=ge;else break e}}return W}function i(D,W){var L=D.sortIndex-W.sortIndex;return L!==0?L:D.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var c=[],l=[],u=1,d=null,h=3,p=!1,m=!1,f=!1,_=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(D){for(var W=r(l);W!==null;){if(W.callback===null)n(l);else if(W.startTime<=D)n(l),W.sortIndex=W.expirationTime,t(c,W);else break;W=r(l)}}function R(D){if(f=!1,T(D),!m)if(r(c)!==null)m=!0,oe(w);else{var W=r(l);W!==null&&U(R,W.startTime-D)}}function w(D,W){m=!1,f&&(f=!1,E(P),P=-1),p=!0;var L=h;try{for(T(W),d=r(c);d!==null&&(!(d.expirationTime>W)||D&&!ne());){var S=d.callback;if(typeof S=="function"){d.callback=null,h=d.priorityLevel;var I=S(d.expirationTime<=W);W=e.unstable_now(),typeof I=="function"?d.callback=I:d===r(c)&&n(c),T(W)}else n(c);d=r(c)}if(d!==null)var O=!0;else{var B=r(l);B!==null&&U(R,B.startTime-W),O=!1}return O}finally{d=null,h=L,p=!1}}var A=!1,N=null,P=-1,x=5,G=-1;function ne(){return!(e.unstable_now()-G<x)}function z(){if(N!==null){var D=e.unstable_now();G=D;var W=!0;try{W=N(!0,D)}finally{W?k():(A=!1,N=null)}}else A=!1}var k;if(typeof g=="function")k=function(){g(z)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,K=F.port2;F.port1.onmessage=z,k=function(){K.postMessage(null)}}else k=function(){_(z,0)};function oe(D){N=D,A||(A=!0,k())}function U(D,W){P=_(function(){D(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(D){D.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,oe(w))},e.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<D?Math.floor(1e3/D):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(D){switch(h){case 1:case 2:case 3:var W=3;break;default:W=h}var L=h;h=W;try{return D()}finally{h=L}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(D,W){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var L=h;h=D;try{return W()}finally{h=L}},e.unstable_scheduleCallback=function(D,W,L){var S=e.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?S+L:S):L=S,D){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=L+I,D={id:u++,callback:W,priorityLevel:D,startTime:L,expirationTime:I,sortIndex:-1},L>S?(D.sortIndex=L,t(l,D),r(c)===null&&D===r(l)&&(f?(E(P),P=-1):f=!0,U(R,L-S))):(D.sortIndex=I,t(c,D),m||p||(m=!0,oe(w))),D},e.unstable_shouldYield=ne,e.unstable_wrapCallback=function(D){var W=h;return function(){var L=h;h=W;try{return D.apply(this,arguments)}finally{h=L}}}})(_k);mk.exports=_k;var vj=mk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sj=Q,$n=vj;function ie(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ek=new Set,_d={};function Js(e,t){_l(e,t),_l(e+"Capture",t)}function _l(e,t){for(_d[e]=t,e=0;e<t.length;e++)Ek.add(t[e])}var Qo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nv=Object.prototype.hasOwnProperty,Tj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,oC={},aC={};function yj(e){return Nv.call(aC,e)?!0:Nv.call(oC,e)?!1:Tj.test(e)?aC[e]=!0:(oC[e]=!0,!1)}function Rj(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Cj(e,t,r,n){if(t===null||typeof t>"u"||Rj(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function mn(e,t,r,n,i,o,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var Yr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Yr[e]=new mn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Yr[t]=new mn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Yr[e]=new mn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Yr[e]=new mn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Yr[e]=new mn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Yr[e]=new mn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Yr[e]=new mn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Yr[e]=new mn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Yr[e]=new mn(e,5,!1,e.toLowerCase(),null,!1,!1)});var zT=/[\-:]([a-z])/g;function YT(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(zT,YT);Yr[t]=new mn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(zT,YT);Yr[t]=new mn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(zT,YT);Yr[t]=new mn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Yr[e]=new mn(e,1,!1,e.toLowerCase(),null,!1,!1)});Yr.xlinkHref=new mn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Yr[e]=new mn(e,1,!1,e.toLowerCase(),null,!0,!0)});function $T(e,t,r,n){var i=Yr.hasOwnProperty(t)?Yr[t]:null;(i!==null?i.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Cj(t,r,i,n)&&(r=null),n||i===null?yj(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=r===null?i.type===3?!1:"":r:(t=i.attributeName,n=i.attributeNamespace,r===null?e.removeAttribute(t):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var na=Sj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Oh=Symbol.for("react.element"),Pc=Symbol.for("react.portal"),Dc=Symbol.for("react.fragment"),qT=Symbol.for("react.strict_mode"),Pv=Symbol.for("react.profiler"),gk=Symbol.for("react.provider"),vk=Symbol.for("react.context"),XT=Symbol.for("react.forward_ref"),Dv=Symbol.for("react.suspense"),kv=Symbol.for("react.suspense_list"),JT=Symbol.for("react.memo"),ga=Symbol.for("react.lazy"),Sk=Symbol.for("react.offscreen"),sC=Symbol.iterator;function nu(e){return e===null||typeof e!="object"?null:(e=sC&&e[sC]||e["@@iterator"],typeof e=="function"?e:null)}var tr=Object.assign,O_;function Ou(e){if(O_===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);O_=t&&t[1]||""}return`
`+O_+e}var N_=!1;function P_(e,t){if(!e||N_)return"";N_=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),o=n.stack.split(`
`),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||i[a]!==o[s]){var c=`
`+i[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=a&&0<=s);break}}}finally{N_=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Ou(e):""}function Ij(e){switch(e.tag){case 5:return Ou(e.type);case 16:return Ou("Lazy");case 13:return Ou("Suspense");case 19:return Ou("SuspenseList");case 0:case 2:case 15:return e=P_(e.type,!1),e;case 11:return e=P_(e.type.render,!1),e;case 1:return e=P_(e.type,!0),e;default:return""}}function Lv(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Dc:return"Fragment";case Pc:return"Portal";case Pv:return"Profiler";case qT:return"StrictMode";case Dv:return"Suspense";case kv:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case vk:return(e.displayName||"Context")+".Consumer";case gk:return(e._context.displayName||"Context")+".Provider";case XT:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case JT:return t=e.displayName||null,t!==null?t:Lv(e.type)||"Memo";case ga:t=e._payload,e=e._init;try{return Lv(e(t))}catch{}}return null}function wj(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Lv(t);case 8:return t===qT?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function $a(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Tk(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Aj(e){var t=Tk(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(a){n=""+a,o.call(this,a)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Nh(e){e._valueTracker||(e._valueTracker=Aj(e))}function yk(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=Tk(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Af(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Mv(e,t){var r=t.checked;return tr({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function cC(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=$a(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Rk(e,t){t=t.checked,t!=null&&$T(e,"checked",t,!1)}function Uv(e,t){Rk(e,t);var r=$a(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?xv(e,t.type,r):t.hasOwnProperty("defaultValue")&&xv(e,t.type,$a(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function lC(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function xv(e,t,r){(t!=="number"||Af(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Nu=Array.isArray;function el(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+$a(r),t=null,i=0;i<e.length;i++){if(e[i].value===r){e[i].selected=!0,n&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function Vv(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ie(91));return tr({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function uC(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(ie(92));if(Nu(r)){if(1<r.length)throw Error(ie(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:$a(r)}}function Ck(e,t){var r=$a(t.value),n=$a(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function dC(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Ik(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fv(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Ik(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ph,wk=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,i){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ph=Ph||document.createElement("div"),Ph.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ph.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ed(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var zu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bj=["Webkit","ms","Moz","O"];Object.keys(zu).forEach(function(e){bj.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),zu[t]=zu[e]})});function Ak(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||zu.hasOwnProperty(e)&&zu[e]?(""+t).trim():t+"px"}function bk(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=Ak(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}var Oj=tr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function jv(e,t){if(t){if(Oj[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ie(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ie(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ie(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ie(62))}}function Bv(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Gv=null;function QT(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Wv=null,tl=null,rl=null;function hC(e){if(e=lh(e)){if(typeof Wv!="function")throw Error(ie(280));var t=e.stateNode;t&&(t=km(t),Wv(e.stateNode,e.type,t))}}function Ok(e){tl?rl?rl.push(e):rl=[e]:tl=e}function Nk(){if(tl){var e=tl,t=rl;if(rl=tl=null,hC(e),t)for(e=0;e<t.length;e++)hC(t[e])}}function Pk(e,t){return e(t)}function Dk(){}var D_=!1;function kk(e,t,r){if(D_)return e(t,r);D_=!0;try{return Pk(e,t,r)}finally{D_=!1,(tl!==null||rl!==null)&&(Dk(),Nk())}}function gd(e,t){var r=e.stateNode;if(r===null)return null;var n=km(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(ie(231,t,typeof r));return r}var Hv=!1;if(Qo)try{var iu={};Object.defineProperty(iu,"passive",{get:function(){Hv=!0}}),window.addEventListener("test",iu,iu),window.removeEventListener("test",iu,iu)}catch{Hv=!1}function Nj(e,t,r,n,i,o,a,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(u){this.onError(u)}}var Yu=!1,bf=null,Of=!1,Kv=null,Pj={onError:function(e){Yu=!0,bf=e}};function Dj(e,t,r,n,i,o,a,s,c){Yu=!1,bf=null,Nj.apply(Pj,arguments)}function kj(e,t,r,n,i,o,a,s,c){if(Dj.apply(this,arguments),Yu){if(Yu){var l=bf;Yu=!1,bf=null}else throw Error(ie(198));Of||(Of=!0,Kv=l)}}function Qs(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Lk(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function pC(e){if(Qs(e)!==e)throw Error(ie(188))}function Lj(e){var t=e.alternate;if(!t){if(t=Qs(e),t===null)throw Error(ie(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(i===null)break;var o=i.alternate;if(o===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return pC(i),e;if(o===n)return pC(i),t;o=o.sibling}throw Error(ie(188))}if(r.return!==n.return)r=i,n=o;else{for(var a=!1,s=i.child;s;){if(s===r){a=!0,r=i,n=o;break}if(s===n){a=!0,n=i,r=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===r){a=!0,r=o,n=i;break}if(s===n){a=!0,n=o,r=i;break}s=s.sibling}if(!a)throw Error(ie(189))}}if(r.alternate!==n)throw Error(ie(190))}if(r.tag!==3)throw Error(ie(188));return r.stateNode.current===r?e:t}function Mk(e){return e=Lj(e),e!==null?Uk(e):null}function Uk(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Uk(e);if(t!==null)return t;e=e.sibling}return null}var xk=$n.unstable_scheduleCallback,fC=$n.unstable_cancelCallback,Mj=$n.unstable_shouldYield,Uj=$n.unstable_requestPaint,mr=$n.unstable_now,xj=$n.unstable_getCurrentPriorityLevel,ZT=$n.unstable_ImmediatePriority,Vk=$n.unstable_UserBlockingPriority,Nf=$n.unstable_NormalPriority,Vj=$n.unstable_LowPriority,Fk=$n.unstable_IdlePriority,Om=null,go=null;function Fj(e){if(go&&typeof go.onCommitFiberRoot=="function")try{go.onCommitFiberRoot(Om,e,void 0,(e.current.flags&128)===128)}catch{}}var zi=Math.clz32?Math.clz32:Gj,jj=Math.log,Bj=Math.LN2;function Gj(e){return e>>>=0,e===0?32:31-(jj(e)/Bj|0)|0}var Dh=64,kh=4194304;function Pu(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Pf(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,i=e.suspendedLanes,o=e.pingedLanes,a=r&268435455;if(a!==0){var s=a&~i;s!==0?n=Pu(s):(o&=a,o!==0&&(n=Pu(o)))}else a=r&~i,a!==0?n=Pu(a):o!==0&&(n=Pu(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&i)&&(i=n&-n,o=t&-t,i>=o||i===16&&(o&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-zi(t),i=1<<r,n|=e[r],t&=~i;return n}function Wj(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hj(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-zi(o),s=1<<a,c=i[a];c===-1?(!(s&r)||s&n)&&(i[a]=Wj(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}}function zv(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function jk(){var e=Dh;return Dh<<=1,!(Dh&4194240)&&(Dh=64),e}function k_(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function sh(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-zi(t),e[t]=r}function Kj(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-zi(r),o=1<<i;t[i]=0,n[i]=-1,e[i]=-1,r&=~o}}function ey(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-zi(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}var At=0;function Bk(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Gk,ty,Wk,Hk,Kk,Yv=!1,Lh=[],La=null,Ma=null,Ua=null,vd=new Map,Sd=new Map,Sa=[],zj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function mC(e,t){switch(e){case"focusin":case"focusout":La=null;break;case"dragenter":case"dragleave":Ma=null;break;case"mouseover":case"mouseout":Ua=null;break;case"pointerover":case"pointerout":vd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Sd.delete(t.pointerId)}}function ou(e,t,r,n,i,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[i]},t!==null&&(t=lh(t),t!==null&&ty(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function Yj(e,t,r,n,i){switch(t){case"focusin":return La=ou(La,e,t,r,n,i),!0;case"dragenter":return Ma=ou(Ma,e,t,r,n,i),!0;case"mouseover":return Ua=ou(Ua,e,t,r,n,i),!0;case"pointerover":var o=i.pointerId;return vd.set(o,ou(vd.get(o)||null,e,t,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,Sd.set(o,ou(Sd.get(o)||null,e,t,r,n,i)),!0}return!1}function zk(e){var t=Cs(e.target);if(t!==null){var r=Qs(t);if(r!==null){if(t=r.tag,t===13){if(t=Lk(r),t!==null){e.blockedOn=t,Kk(e.priority,function(){Wk(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Wp(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=$v(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);Gv=n,r.target.dispatchEvent(n),Gv=null}else return t=lh(r),t!==null&&ty(t),e.blockedOn=r,!1;t.shift()}return!0}function _C(e,t,r){Wp(e)&&r.delete(t)}function $j(){Yv=!1,La!==null&&Wp(La)&&(La=null),Ma!==null&&Wp(Ma)&&(Ma=null),Ua!==null&&Wp(Ua)&&(Ua=null),vd.forEach(_C),Sd.forEach(_C)}function au(e,t){e.blockedOn===t&&(e.blockedOn=null,Yv||(Yv=!0,$n.unstable_scheduleCallback($n.unstable_NormalPriority,$j)))}function Td(e){function t(i){return au(i,e)}if(0<Lh.length){au(Lh[0],e);for(var r=1;r<Lh.length;r++){var n=Lh[r];n.blockedOn===e&&(n.blockedOn=null)}}for(La!==null&&au(La,e),Ma!==null&&au(Ma,e),Ua!==null&&au(Ua,e),vd.forEach(t),Sd.forEach(t),r=0;r<Sa.length;r++)n=Sa[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Sa.length&&(r=Sa[0],r.blockedOn===null);)zk(r),r.blockedOn===null&&Sa.shift()}var nl=na.ReactCurrentBatchConfig,Df=!0;function qj(e,t,r,n){var i=At,o=nl.transition;nl.transition=null;try{At=1,ry(e,t,r,n)}finally{At=i,nl.transition=o}}function Xj(e,t,r,n){var i=At,o=nl.transition;nl.transition=null;try{At=4,ry(e,t,r,n)}finally{At=i,nl.transition=o}}function ry(e,t,r,n){if(Df){var i=$v(e,t,r,n);if(i===null)W_(e,t,n,kf,r),mC(e,n);else if(Yj(i,e,t,r,n))n.stopPropagation();else if(mC(e,n),t&4&&-1<zj.indexOf(e)){for(;i!==null;){var o=lh(i);if(o!==null&&Gk(o),o=$v(e,t,r,n),o===null&&W_(e,t,n,kf,r),o===i)break;i=o}i!==null&&n.stopPropagation()}else W_(e,t,n,null,r)}}var kf=null;function $v(e,t,r,n){if(kf=null,e=QT(n),e=Cs(e),e!==null)if(t=Qs(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Lk(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return kf=e,null}function Yk(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xj()){case ZT:return 1;case Vk:return 4;case Nf:case Vj:return 16;case Fk:return 536870912;default:return 16}default:return 16}}var wa=null,ny=null,Hp=null;function $k(){if(Hp)return Hp;var e,t=ny,r=t.length,n,i="value"in wa?wa.value:wa.textContent,o=i.length;for(e=0;e<r&&t[e]===i[e];e++);var a=r-e;for(n=1;n<=a&&t[r-n]===i[o-n];n++);return Hp=i.slice(e,1<n?1-n:void 0)}function Kp(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Mh(){return!0}function EC(){return!1}function Xn(e){function t(r,n,i,o,a){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Mh:EC,this.isPropagationStopped=EC,this}return tr(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Mh)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Mh)},persist:function(){},isPersistent:Mh}),t}var Ul={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},iy=Xn(Ul),ch=tr({},Ul,{view:0,detail:0}),Jj=Xn(ch),L_,M_,su,Nm=tr({},ch,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:oy,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==su&&(su&&e.type==="mousemove"?(L_=e.screenX-su.screenX,M_=e.screenY-su.screenY):M_=L_=0,su=e),L_)},movementY:function(e){return"movementY"in e?e.movementY:M_}}),gC=Xn(Nm),Qj=tr({},Nm,{dataTransfer:0}),Zj=Xn(Qj),e3=tr({},ch,{relatedTarget:0}),U_=Xn(e3),t3=tr({},Ul,{animationName:0,elapsedTime:0,pseudoElement:0}),r3=Xn(t3),n3=tr({},Ul,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),i3=Xn(n3),o3=tr({},Ul,{data:0}),vC=Xn(o3),a3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},s3={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},c3={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function l3(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=c3[e])?!!t[e]:!1}function oy(){return l3}var u3=tr({},ch,{key:function(e){if(e.key){var t=a3[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Kp(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?s3[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:oy,charCode:function(e){return e.type==="keypress"?Kp(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Kp(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),d3=Xn(u3),h3=tr({},Nm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),SC=Xn(h3),p3=tr({},ch,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:oy}),f3=Xn(p3),m3=tr({},Ul,{propertyName:0,elapsedTime:0,pseudoElement:0}),_3=Xn(m3),E3=tr({},Nm,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),g3=Xn(E3),v3=[9,13,27,32],ay=Qo&&"CompositionEvent"in window,$u=null;Qo&&"documentMode"in document&&($u=document.documentMode);var S3=Qo&&"TextEvent"in window&&!$u,qk=Qo&&(!ay||$u&&8<$u&&11>=$u),TC=" ",yC=!1;function Xk(e,t){switch(e){case"keyup":return v3.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jk(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var kc=!1;function T3(e,t){switch(e){case"compositionend":return Jk(t);case"keypress":return t.which!==32?null:(yC=!0,TC);case"textInput":return e=t.data,e===TC&&yC?null:e;default:return null}}function y3(e,t){if(kc)return e==="compositionend"||!ay&&Xk(e,t)?(e=$k(),Hp=ny=wa=null,kc=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return qk&&t.locale!=="ko"?null:t.data;default:return null}}var R3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function RC(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!R3[e.type]:t==="textarea"}function Qk(e,t,r,n){Ok(n),t=Lf(t,"onChange"),0<t.length&&(r=new iy("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var qu=null,yd=null;function C3(e){lL(e,0)}function Pm(e){var t=Uc(e);if(yk(t))return e}function I3(e,t){if(e==="change")return t}var Zk=!1;if(Qo){var x_;if(Qo){var V_="oninput"in document;if(!V_){var CC=document.createElement("div");CC.setAttribute("oninput","return;"),V_=typeof CC.oninput=="function"}x_=V_}else x_=!1;Zk=x_&&(!document.documentMode||9<document.documentMode)}function IC(){qu&&(qu.detachEvent("onpropertychange",eL),yd=qu=null)}function eL(e){if(e.propertyName==="value"&&Pm(yd)){var t=[];Qk(t,yd,e,QT(e)),kk(C3,t)}}function w3(e,t,r){e==="focusin"?(IC(),qu=t,yd=r,qu.attachEvent("onpropertychange",eL)):e==="focusout"&&IC()}function A3(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Pm(yd)}function b3(e,t){if(e==="click")return Pm(t)}function O3(e,t){if(e==="input"||e==="change")return Pm(t)}function N3(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var $i=typeof Object.is=="function"?Object.is:N3;function Rd(e,t){if($i(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!Nv.call(t,i)||!$i(e[i],t[i]))return!1}return!0}function wC(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function AC(e,t){var r=wC(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=wC(r)}}function tL(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?tL(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function rL(){for(var e=window,t=Af();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Af(e.document)}return t}function sy(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function P3(e){var t=rL(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&tL(r.ownerDocument.documentElement,r)){if(n!==null&&sy(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=r.textContent.length,o=Math.min(n.start,i);n=n.end===void 0?o:Math.min(n.end,i),!e.extend&&o>n&&(i=n,n=o,o=i),i=AC(r,o);var a=AC(r,n);i&&a&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var D3=Qo&&"documentMode"in document&&11>=document.documentMode,Lc=null,qv=null,Xu=null,Xv=!1;function bC(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Xv||Lc==null||Lc!==Af(n)||(n=Lc,"selectionStart"in n&&sy(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Xu&&Rd(Xu,n)||(Xu=n,n=Lf(qv,"onSelect"),0<n.length&&(t=new iy("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Lc)))}function Uh(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Mc={animationend:Uh("Animation","AnimationEnd"),animationiteration:Uh("Animation","AnimationIteration"),animationstart:Uh("Animation","AnimationStart"),transitionend:Uh("Transition","TransitionEnd")},F_={},nL={};Qo&&(nL=document.createElement("div").style,"AnimationEvent"in window||(delete Mc.animationend.animation,delete Mc.animationiteration.animation,delete Mc.animationstart.animation),"TransitionEvent"in window||delete Mc.transitionend.transition);function Dm(e){if(F_[e])return F_[e];if(!Mc[e])return e;var t=Mc[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in nL)return F_[e]=t[r];return e}var iL=Dm("animationend"),oL=Dm("animationiteration"),aL=Dm("animationstart"),sL=Dm("transitionend"),cL=new Map,OC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Za(e,t){cL.set(e,t),Js(t,[e])}for(var j_=0;j_<OC.length;j_++){var B_=OC[j_],k3=B_.toLowerCase(),L3=B_[0].toUpperCase()+B_.slice(1);Za(k3,"on"+L3)}Za(iL,"onAnimationEnd");Za(oL,"onAnimationIteration");Za(aL,"onAnimationStart");Za("dblclick","onDoubleClick");Za("focusin","onFocus");Za("focusout","onBlur");Za(sL,"onTransitionEnd");_l("onMouseEnter",["mouseout","mouseover"]);_l("onMouseLeave",["mouseout","mouseover"]);_l("onPointerEnter",["pointerout","pointerover"]);_l("onPointerLeave",["pointerout","pointerover"]);Js("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Js("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Js("onBeforeInput",["compositionend","keypress","textInput","paste"]);Js("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Js("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Js("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Du="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),M3=new Set("cancel close invalid load scroll toggle".split(" ").concat(Du));function NC(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,kj(n,t,void 0,e),e.currentTarget=null}function lL(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var a=n.length-1;0<=a;a--){var s=n[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&i.isPropagationStopped())break e;NC(i,s,l),o=c}else for(a=0;a<n.length;a++){if(s=n[a],c=s.instance,l=s.currentTarget,s=s.listener,c!==o&&i.isPropagationStopped())break e;NC(i,s,l),o=c}}}if(Of)throw e=Kv,Of=!1,Kv=null,e}function Vt(e,t){var r=t[tS];r===void 0&&(r=t[tS]=new Set);var n=e+"__bubble";r.has(n)||(uL(t,e,2,!1),r.add(n))}function G_(e,t,r){var n=0;t&&(n|=4),uL(r,e,n,t)}var xh="_reactListening"+Math.random().toString(36).slice(2);function Cd(e){if(!e[xh]){e[xh]=!0,Ek.forEach(function(r){r!=="selectionchange"&&(M3.has(r)||G_(r,!1,e),G_(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[xh]||(t[xh]=!0,G_("selectionchange",!1,t))}}function uL(e,t,r,n){switch(Yk(t)){case 1:var i=qj;break;case 4:i=Xj;break;default:i=ry}r=i.bind(null,t,r,e),i=void 0,!Hv||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),n?i!==void 0?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):i!==void 0?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function W_(e,t,r,n,i){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var s=n.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(a===4)for(a=n.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;a=a.return}for(;s!==null;){if(a=Cs(s),a===null)return;if(c=a.tag,c===5||c===6){n=o=a;continue e}s=s.parentNode}}n=n.return}kk(function(){var l=o,u=QT(r),d=[];e:{var h=cL.get(e);if(h!==void 0){var p=iy,m=e;switch(e){case"keypress":if(Kp(r)===0)break e;case"keydown":case"keyup":p=d3;break;case"focusin":m="focus",p=U_;break;case"focusout":m="blur",p=U_;break;case"beforeblur":case"afterblur":p=U_;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=gC;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Zj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=f3;break;case iL:case oL:case aL:p=r3;break;case sL:p=_3;break;case"scroll":p=Jj;break;case"wheel":p=g3;break;case"copy":case"cut":case"paste":p=i3;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=SC}var f=(t&4)!==0,_=!f&&e==="scroll",E=f?h!==null?h+"Capture":null:h;f=[];for(var g=l,T;g!==null;){T=g;var R=T.stateNode;if(T.tag===5&&R!==null&&(T=R,E!==null&&(R=gd(g,E),R!=null&&f.push(Id(g,R,T)))),_)break;g=g.return}0<f.length&&(h=new p(h,m,null,r,u),d.push({event:h,listeners:f}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",h&&r!==Gv&&(m=r.relatedTarget||r.fromElement)&&(Cs(m)||m[Zo]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=r.relatedTarget||r.toElement,p=l,m=m?Cs(m):null,m!==null&&(_=Qs(m),m!==_||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=l),p!==m)){if(f=gC,R="onMouseLeave",E="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(f=SC,R="onPointerLeave",E="onPointerEnter",g="pointer"),_=p==null?h:Uc(p),T=m==null?h:Uc(m),h=new f(R,g+"leave",p,r,u),h.target=_,h.relatedTarget=T,R=null,Cs(u)===l&&(f=new f(E,g+"enter",m,r,u),f.target=T,f.relatedTarget=_,R=f),_=R,p&&m)t:{for(f=p,E=m,g=0,T=f;T;T=sc(T))g++;for(T=0,R=E;R;R=sc(R))T++;for(;0<g-T;)f=sc(f),g--;for(;0<T-g;)E=sc(E),T--;for(;g--;){if(f===E||E!==null&&f===E.alternate)break t;f=sc(f),E=sc(E)}f=null}else f=null;p!==null&&PC(d,h,p,f,!1),m!==null&&_!==null&&PC(d,_,m,f,!0)}}e:{if(h=l?Uc(l):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var w=I3;else if(RC(h))if(Zk)w=O3;else{w=A3;var A=w3}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(w=b3);if(w&&(w=w(e,l))){Qk(d,w,r,u);break e}A&&A(e,h,l),e==="focusout"&&(A=h._wrapperState)&&A.controlled&&h.type==="number"&&xv(h,"number",h.value)}switch(A=l?Uc(l):window,e){case"focusin":(RC(A)||A.contentEditable==="true")&&(Lc=A,qv=l,Xu=null);break;case"focusout":Xu=qv=Lc=null;break;case"mousedown":Xv=!0;break;case"contextmenu":case"mouseup":case"dragend":Xv=!1,bC(d,r,u);break;case"selectionchange":if(D3)break;case"keydown":case"keyup":bC(d,r,u)}var N;if(ay)e:{switch(e){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else kc?Xk(e,r)&&(P="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(P="onCompositionStart");P&&(qk&&r.locale!=="ko"&&(kc||P!=="onCompositionStart"?P==="onCompositionEnd"&&kc&&(N=$k()):(wa=u,ny="value"in wa?wa.value:wa.textContent,kc=!0)),A=Lf(l,P),0<A.length&&(P=new vC(P,e,null,r,u),d.push({event:P,listeners:A}),N?P.data=N:(N=Jk(r),N!==null&&(P.data=N)))),(N=S3?T3(e,r):y3(e,r))&&(l=Lf(l,"onBeforeInput"),0<l.length&&(u=new vC("onBeforeInput","beforeinput",null,r,u),d.push({event:u,listeners:l}),u.data=N))}lL(d,t)})}function Id(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Lf(e,t){for(var r=t+"Capture",n=[];e!==null;){var i=e,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=gd(e,r),o!=null&&n.unshift(Id(e,o,i)),o=gd(e,t),o!=null&&n.push(Id(e,o,i))),e=e.return}return n}function sc(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function PC(e,t,r,n,i){for(var o=t._reactName,a=[];r!==null&&r!==n;){var s=r,c=s.alternate,l=s.stateNode;if(c!==null&&c===n)break;s.tag===5&&l!==null&&(s=l,i?(c=gd(r,o),c!=null&&a.unshift(Id(r,c,s))):i||(c=gd(r,o),c!=null&&a.push(Id(r,c,s)))),r=r.return}a.length!==0&&e.push({event:t,listeners:a})}var U3=/\r\n?/g,x3=/\u0000|\uFFFD/g;function DC(e){return(typeof e=="string"?e:""+e).replace(U3,`
`).replace(x3,"")}function Vh(e,t,r){if(t=DC(t),DC(e)!==t&&r)throw Error(ie(425))}function Mf(){}var Jv=null,Qv=null;function Zv(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var eS=typeof setTimeout=="function"?setTimeout:void 0,V3=typeof clearTimeout=="function"?clearTimeout:void 0,kC=typeof Promise=="function"?Promise:void 0,F3=typeof queueMicrotask=="function"?queueMicrotask:typeof kC<"u"?function(e){return kC.resolve(null).then(e).catch(j3)}:eS;function j3(e){setTimeout(function(){throw e})}function H_(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){e.removeChild(i),Td(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);Td(t)}function xa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function LC(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var xl=Math.random().toString(36).slice(2),uo="__reactFiber$"+xl,wd="__reactProps$"+xl,Zo="__reactContainer$"+xl,tS="__reactEvents$"+xl,B3="__reactListeners$"+xl,G3="__reactHandles$"+xl;function Cs(e){var t=e[uo];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Zo]||r[uo]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=LC(e);e!==null;){if(r=e[uo])return r;e=LC(e)}return t}e=r,r=e.parentNode}return null}function lh(e){return e=e[uo]||e[Zo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Uc(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ie(33))}function km(e){return e[wd]||null}var rS=[],xc=-1;function es(e){return{current:e}}function Wt(e){0>xc||(e.current=rS[xc],rS[xc]=null,xc--)}function xt(e,t){xc++,rS[xc]=e.current,e.current=t}var qa={},rn=es(qa),On=es(!1),Gs=qa;function El(e,t){var r=e.type.contextTypes;if(!r)return qa;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in r)i[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Nn(e){return e=e.childContextTypes,e!=null}function Uf(){Wt(On),Wt(rn)}function MC(e,t,r){if(rn.current!==qa)throw Error(ie(168));xt(rn,t),xt(On,r)}function dL(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in t))throw Error(ie(108,wj(e)||"Unknown",i));return tr({},r,n)}function xf(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||qa,Gs=rn.current,xt(rn,e),xt(On,On.current),!0}function UC(e,t,r){var n=e.stateNode;if(!n)throw Error(ie(169));r?(e=dL(e,t,Gs),n.__reactInternalMemoizedMergedChildContext=e,Wt(On),Wt(rn),xt(rn,e)):Wt(On),xt(On,r)}var Bo=null,Lm=!1,K_=!1;function hL(e){Bo===null?Bo=[e]:Bo.push(e)}function W3(e){Lm=!0,hL(e)}function ts(){if(!K_&&Bo!==null){K_=!0;var e=0,t=At;try{var r=Bo;for(At=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Bo=null,Lm=!1}catch(i){throw Bo!==null&&(Bo=Bo.slice(e+1)),xk(ZT,ts),i}finally{At=t,K_=!1}}return null}var Vc=[],Fc=0,Vf=null,Ff=0,fi=[],mi=0,Ws=null,Ko=1,zo="";function fs(e,t){Vc[Fc++]=Ff,Vc[Fc++]=Vf,Vf=e,Ff=t}function pL(e,t,r){fi[mi++]=Ko,fi[mi++]=zo,fi[mi++]=Ws,Ws=e;var n=Ko;e=zo;var i=32-zi(n)-1;n&=~(1<<i),r+=1;var o=32-zi(t)+i;if(30<o){var a=i-i%5;o=(n&(1<<a)-1).toString(32),n>>=a,i-=a,Ko=1<<32-zi(t)+i|r<<i|n,zo=o+e}else Ko=1<<o|r<<i|n,zo=e}function cy(e){e.return!==null&&(fs(e,1),pL(e,1,0))}function ly(e){for(;e===Vf;)Vf=Vc[--Fc],Vc[Fc]=null,Ff=Vc[--Fc],Vc[Fc]=null;for(;e===Ws;)Ws=fi[--mi],fi[mi]=null,zo=fi[--mi],fi[mi]=null,Ko=fi[--mi],fi[mi]=null}var Yn=null,Wn=null,zt=!1,Wi=null;function fL(e,t){var r=vi(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function xC(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Yn=e,Wn=xa(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Yn=e,Wn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Ws!==null?{id:Ko,overflow:zo}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=vi(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Yn=e,Wn=null,!0):!1;default:return!1}}function nS(e){return(e.mode&1)!==0&&(e.flags&128)===0}function iS(e){if(zt){var t=Wn;if(t){var r=t;if(!xC(e,t)){if(nS(e))throw Error(ie(418));t=xa(r.nextSibling);var n=Yn;t&&xC(e,t)?fL(n,r):(e.flags=e.flags&-4097|2,zt=!1,Yn=e)}}else{if(nS(e))throw Error(ie(418));e.flags=e.flags&-4097|2,zt=!1,Yn=e}}}function VC(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Yn=e}function Fh(e){if(e!==Yn)return!1;if(!zt)return VC(e),zt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Zv(e.type,e.memoizedProps)),t&&(t=Wn)){if(nS(e))throw mL(),Error(ie(418));for(;t;)fL(e,t),t=xa(t.nextSibling)}if(VC(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ie(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Wn=xa(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Wn=null}}else Wn=Yn?xa(e.stateNode.nextSibling):null;return!0}function mL(){for(var e=Wn;e;)e=xa(e.nextSibling)}function gl(){Wn=Yn=null,zt=!1}function uy(e){Wi===null?Wi=[e]:Wi.push(e)}var H3=na.ReactCurrentBatchConfig;function cu(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ie(309));var n=r.stateNode}if(!n)throw Error(ie(147,e));var i=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(a){var s=i.refs;a===null?delete s[o]:s[o]=a},t._stringRef=o,t)}if(typeof e!="string")throw Error(ie(284));if(!r._owner)throw Error(ie(290,e))}return e}function jh(e,t){throw e=Object.prototype.toString.call(t),Error(ie(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function FC(e){var t=e._init;return t(e._payload)}function _L(e){function t(E,g){if(e){var T=E.deletions;T===null?(E.deletions=[g],E.flags|=16):T.push(g)}}function r(E,g){if(!e)return null;for(;g!==null;)t(E,g),g=g.sibling;return null}function n(E,g){for(E=new Map;g!==null;)g.key!==null?E.set(g.key,g):E.set(g.index,g),g=g.sibling;return E}function i(E,g){return E=Ba(E,g),E.index=0,E.sibling=null,E}function o(E,g,T){return E.index=T,e?(T=E.alternate,T!==null?(T=T.index,T<g?(E.flags|=2,g):T):(E.flags|=2,g)):(E.flags|=1048576,g)}function a(E){return e&&E.alternate===null&&(E.flags|=2),E}function s(E,g,T,R){return g===null||g.tag!==6?(g=Q_(T,E.mode,R),g.return=E,g):(g=i(g,T),g.return=E,g)}function c(E,g,T,R){var w=T.type;return w===Dc?u(E,g,T.props.children,R,T.key):g!==null&&(g.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===ga&&FC(w)===g.type)?(R=i(g,T.props),R.ref=cu(E,g,T),R.return=E,R):(R=Qp(T.type,T.key,T.props,null,E.mode,R),R.ref=cu(E,g,T),R.return=E,R)}function l(E,g,T,R){return g===null||g.tag!==4||g.stateNode.containerInfo!==T.containerInfo||g.stateNode.implementation!==T.implementation?(g=Z_(T,E.mode,R),g.return=E,g):(g=i(g,T.children||[]),g.return=E,g)}function u(E,g,T,R,w){return g===null||g.tag!==7?(g=Us(T,E.mode,R,w),g.return=E,g):(g=i(g,T),g.return=E,g)}function d(E,g,T){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Q_(""+g,E.mode,T),g.return=E,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Oh:return T=Qp(g.type,g.key,g.props,null,E.mode,T),T.ref=cu(E,null,g),T.return=E,T;case Pc:return g=Z_(g,E.mode,T),g.return=E,g;case ga:var R=g._init;return d(E,R(g._payload),T)}if(Nu(g)||nu(g))return g=Us(g,E.mode,T,null),g.return=E,g;jh(E,g)}return null}function h(E,g,T,R){var w=g!==null?g.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return w!==null?null:s(E,g,""+T,R);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Oh:return T.key===w?c(E,g,T,R):null;case Pc:return T.key===w?l(E,g,T,R):null;case ga:return w=T._init,h(E,g,w(T._payload),R)}if(Nu(T)||nu(T))return w!==null?null:u(E,g,T,R,null);jh(E,T)}return null}function p(E,g,T,R,w){if(typeof R=="string"&&R!==""||typeof R=="number")return E=E.get(T)||null,s(g,E,""+R,w);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Oh:return E=E.get(R.key===null?T:R.key)||null,c(g,E,R,w);case Pc:return E=E.get(R.key===null?T:R.key)||null,l(g,E,R,w);case ga:var A=R._init;return p(E,g,T,A(R._payload),w)}if(Nu(R)||nu(R))return E=E.get(T)||null,u(g,E,R,w,null);jh(g,R)}return null}function m(E,g,T,R){for(var w=null,A=null,N=g,P=g=0,x=null;N!==null&&P<T.length;P++){N.index>P?(x=N,N=null):x=N.sibling;var G=h(E,N,T[P],R);if(G===null){N===null&&(N=x);break}e&&N&&G.alternate===null&&t(E,N),g=o(G,g,P),A===null?w=G:A.sibling=G,A=G,N=x}if(P===T.length)return r(E,N),zt&&fs(E,P),w;if(N===null){for(;P<T.length;P++)N=d(E,T[P],R),N!==null&&(g=o(N,g,P),A===null?w=N:A.sibling=N,A=N);return zt&&fs(E,P),w}for(N=n(E,N);P<T.length;P++)x=p(N,E,P,T[P],R),x!==null&&(e&&x.alternate!==null&&N.delete(x.key===null?P:x.key),g=o(x,g,P),A===null?w=x:A.sibling=x,A=x);return e&&N.forEach(function(ne){return t(E,ne)}),zt&&fs(E,P),w}function f(E,g,T,R){var w=nu(T);if(typeof w!="function")throw Error(ie(150));if(T=w.call(T),T==null)throw Error(ie(151));for(var A=w=null,N=g,P=g=0,x=null,G=T.next();N!==null&&!G.done;P++,G=T.next()){N.index>P?(x=N,N=null):x=N.sibling;var ne=h(E,N,G.value,R);if(ne===null){N===null&&(N=x);break}e&&N&&ne.alternate===null&&t(E,N),g=o(ne,g,P),A===null?w=ne:A.sibling=ne,A=ne,N=x}if(G.done)return r(E,N),zt&&fs(E,P),w;if(N===null){for(;!G.done;P++,G=T.next())G=d(E,G.value,R),G!==null&&(g=o(G,g,P),A===null?w=G:A.sibling=G,A=G);return zt&&fs(E,P),w}for(N=n(E,N);!G.done;P++,G=T.next())G=p(N,E,P,G.value,R),G!==null&&(e&&G.alternate!==null&&N.delete(G.key===null?P:G.key),g=o(G,g,P),A===null?w=G:A.sibling=G,A=G);return e&&N.forEach(function(z){return t(E,z)}),zt&&fs(E,P),w}function _(E,g,T,R){if(typeof T=="object"&&T!==null&&T.type===Dc&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case Oh:e:{for(var w=T.key,A=g;A!==null;){if(A.key===w){if(w=T.type,w===Dc){if(A.tag===7){r(E,A.sibling),g=i(A,T.props.children),g.return=E,E=g;break e}}else if(A.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===ga&&FC(w)===A.type){r(E,A.sibling),g=i(A,T.props),g.ref=cu(E,A,T),g.return=E,E=g;break e}r(E,A);break}else t(E,A);A=A.sibling}T.type===Dc?(g=Us(T.props.children,E.mode,R,T.key),g.return=E,E=g):(R=Qp(T.type,T.key,T.props,null,E.mode,R),R.ref=cu(E,g,T),R.return=E,E=R)}return a(E);case Pc:e:{for(A=T.key;g!==null;){if(g.key===A)if(g.tag===4&&g.stateNode.containerInfo===T.containerInfo&&g.stateNode.implementation===T.implementation){r(E,g.sibling),g=i(g,T.children||[]),g.return=E,E=g;break e}else{r(E,g);break}else t(E,g);g=g.sibling}g=Z_(T,E.mode,R),g.return=E,E=g}return a(E);case ga:return A=T._init,_(E,g,A(T._payload),R)}if(Nu(T))return m(E,g,T,R);if(nu(T))return f(E,g,T,R);jh(E,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,g!==null&&g.tag===6?(r(E,g.sibling),g=i(g,T),g.return=E,E=g):(r(E,g),g=Q_(T,E.mode,R),g.return=E,E=g),a(E)):r(E,g)}return _}var vl=_L(!0),EL=_L(!1),jf=es(null),Bf=null,jc=null,dy=null;function hy(){dy=jc=Bf=null}function py(e){var t=jf.current;Wt(jf),e._currentValue=t}function oS(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function il(e,t){Bf=e,dy=jc=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(An=!0),e.firstContext=null)}function Ri(e){var t=e._currentValue;if(dy!==e)if(e={context:e,memoizedValue:t,next:null},jc===null){if(Bf===null)throw Error(ie(308));jc=e,Bf.dependencies={lanes:0,firstContext:e}}else jc=jc.next=e;return t}var Is=null;function fy(e){Is===null?Is=[e]:Is.push(e)}function gL(e,t,r,n){var i=t.interleaved;return i===null?(r.next=r,fy(t)):(r.next=i.next,i.next=r),t.interleaved=r,ea(e,n)}function ea(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var va=!1;function my(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vL(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function qo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Va(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,ct&2){var i=n.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),n.pending=t,ea(e,r)}return i=n.interleaved,i===null?(t.next=t,fy(n)):(t.next=i.next,i.next=t),n.interleaved=t,ea(e,r)}function zp(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,ey(e,r)}}function jC(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?i=o=a:o=o.next=a,r=r.next}while(r!==null);o===null?i=o=t:o=o.next=t}else i=o=t;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Gf(e,t,r,n){var i=e.updateQueue;va=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,a===null?o=l:a.next=l,a=c;var u=e.alternate;u!==null&&(u=u.updateQueue,s=u.lastBaseUpdate,s!==a&&(s===null?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(o!==null){var d=i.baseState;a=0,u=l=c=null,s=o;do{var h=s.lane,p=s.eventTime;if((n&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=e,f=s;switch(h=t,p=r,f.tag){case 1:if(m=f.payload,typeof m=="function"){d=m.call(p,d,h);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=f.payload,h=typeof m=="function"?m.call(p,d,h):m,h==null)break e;d=tr({},d,h);break e;case 2:va=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,h=i.effects,h===null?i.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(l=u=p,c=d):u=u.next=p,a|=h;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;h=s,s=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(u===null&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,t=i.shared.interleaved,t!==null){i=t;do a|=i.lane,i=i.next;while(i!==t)}else o===null&&(i.shared.lanes=0);Ks|=a,e.lanes=a,e.memoizedState=d}}function BC(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(ie(191,i));i.call(n)}}}var uh={},vo=es(uh),Ad=es(uh),bd=es(uh);function ws(e){if(e===uh)throw Error(ie(174));return e}function _y(e,t){switch(xt(bd,t),xt(Ad,e),xt(vo,uh),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Fv(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Fv(t,e)}Wt(vo),xt(vo,t)}function Sl(){Wt(vo),Wt(Ad),Wt(bd)}function SL(e){ws(bd.current);var t=ws(vo.current),r=Fv(t,e.type);t!==r&&(xt(Ad,e),xt(vo,r))}function Ey(e){Ad.current===e&&(Wt(vo),Wt(Ad))}var Xt=es(0);function Wf(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var z_=[];function gy(){for(var e=0;e<z_.length;e++)z_[e]._workInProgressVersionPrimary=null;z_.length=0}var Yp=na.ReactCurrentDispatcher,Y_=na.ReactCurrentBatchConfig,Hs=0,Zt=null,wr=null,Mr=null,Hf=!1,Ju=!1,Od=0,K3=0;function Xr(){throw Error(ie(321))}function vy(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!$i(e[r],t[r]))return!1;return!0}function Sy(e,t,r,n,i,o){if(Hs=o,Zt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Yp.current=e===null||e.memoizedState===null?q3:X3,e=r(n,i),Ju){o=0;do{if(Ju=!1,Od=0,25<=o)throw Error(ie(301));o+=1,Mr=wr=null,t.updateQueue=null,Yp.current=J3,e=r(n,i)}while(Ju)}if(Yp.current=Kf,t=wr!==null&&wr.next!==null,Hs=0,Mr=wr=Zt=null,Hf=!1,t)throw Error(ie(300));return e}function Ty(){var e=Od!==0;return Od=0,e}function co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mr===null?Zt.memoizedState=Mr=e:Mr=Mr.next=e,Mr}function Ci(){if(wr===null){var e=Zt.alternate;e=e!==null?e.memoizedState:null}else e=wr.next;var t=Mr===null?Zt.memoizedState:Mr.next;if(t!==null)Mr=t,wr=e;else{if(e===null)throw Error(ie(310));wr=e,e={memoizedState:wr.memoizedState,baseState:wr.baseState,baseQueue:wr.baseQueue,queue:wr.queue,next:null},Mr===null?Zt.memoizedState=Mr=e:Mr=Mr.next=e}return Mr}function Nd(e,t){return typeof t=="function"?t(e):t}function $_(e){var t=Ci(),r=t.queue;if(r===null)throw Error(ie(311));r.lastRenderedReducer=e;var n=wr,i=n.baseQueue,o=r.pending;if(o!==null){if(i!==null){var a=i.next;i.next=o.next,o.next=a}n.baseQueue=i=o,r.pending=null}if(i!==null){o=i.next,n=n.baseState;var s=a=null,c=null,l=o;do{var u=l.lane;if((Hs&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:e(n,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(s=c=d,a=n):c=c.next=d,Zt.lanes|=u,Ks|=u}l=l.next}while(l!==null&&l!==o);c===null?a=n:c.next=s,$i(n,t.memoizedState)||(An=!0),t.memoizedState=n,t.baseState=a,t.baseQueue=c,r.lastRenderedState=n}if(e=r.interleaved,e!==null){i=e;do o=i.lane,Zt.lanes|=o,Ks|=o,i=i.next;while(i!==e)}else i===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function q_(e){var t=Ci(),r=t.queue;if(r===null)throw Error(ie(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,o=t.memoizedState;if(i!==null){r.pending=null;var a=i=i.next;do o=e(o,a.action),a=a.next;while(a!==i);$i(o,t.memoizedState)||(An=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function TL(){}function yL(e,t){var r=Zt,n=Ci(),i=t(),o=!$i(n.memoizedState,i);if(o&&(n.memoizedState=i,An=!0),n=n.queue,yy(IL.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||Mr!==null&&Mr.memoizedState.tag&1){if(r.flags|=2048,Pd(9,CL.bind(null,r,n,i,t),void 0,null),jr===null)throw Error(ie(349));Hs&30||RL(r,t,i)}return i}function RL(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Zt.updateQueue,t===null?(t={lastEffect:null,stores:null},Zt.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function CL(e,t,r,n){t.value=r,t.getSnapshot=n,wL(t)&&AL(e)}function IL(e,t,r){return r(function(){wL(t)&&AL(e)})}function wL(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!$i(e,r)}catch{return!0}}function AL(e){var t=ea(e,1);t!==null&&Yi(t,e,1,-1)}function GC(e){var t=co();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Nd,lastRenderedState:e},t.queue=e,e=e.dispatch=$3.bind(null,Zt,e),[t.memoizedState,e]}function Pd(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Zt.updateQueue,t===null?(t={lastEffect:null,stores:null},Zt.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function bL(){return Ci().memoizedState}function $p(e,t,r,n){var i=co();Zt.flags|=e,i.memoizedState=Pd(1|t,r,void 0,n===void 0?null:n)}function Mm(e,t,r,n){var i=Ci();n=n===void 0?null:n;var o=void 0;if(wr!==null){var a=wr.memoizedState;if(o=a.destroy,n!==null&&vy(n,a.deps)){i.memoizedState=Pd(t,r,o,n);return}}Zt.flags|=e,i.memoizedState=Pd(1|t,r,o,n)}function WC(e,t){return $p(8390656,8,e,t)}function yy(e,t){return Mm(2048,8,e,t)}function OL(e,t){return Mm(4,2,e,t)}function NL(e,t){return Mm(4,4,e,t)}function PL(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function DL(e,t,r){return r=r!=null?r.concat([e]):null,Mm(4,4,PL.bind(null,t,e),r)}function Ry(){}function kL(e,t){var r=Ci();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&vy(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function LL(e,t){var r=Ci();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&vy(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function ML(e,t,r){return Hs&21?($i(r,t)||(r=jk(),Zt.lanes|=r,Ks|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,An=!0),e.memoizedState=r)}function z3(e,t){var r=At;At=r!==0&&4>r?r:4,e(!0);var n=Y_.transition;Y_.transition={};try{e(!1),t()}finally{At=r,Y_.transition=n}}function UL(){return Ci().memoizedState}function Y3(e,t,r){var n=ja(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},xL(e))VL(t,r);else if(r=gL(e,t,r,n),r!==null){var i=pn();Yi(r,e,n,i),FL(r,t,n)}}function $3(e,t,r){var n=ja(e),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(xL(e))VL(t,i);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var a=t.lastRenderedState,s=o(a,r);if(i.hasEagerState=!0,i.eagerState=s,$i(s,a)){var c=t.interleaved;c===null?(i.next=i,fy(t)):(i.next=c.next,c.next=i),t.interleaved=i;return}}catch{}finally{}r=gL(e,t,i,n),r!==null&&(i=pn(),Yi(r,e,n,i),FL(r,t,n))}}function xL(e){var t=e.alternate;return e===Zt||t!==null&&t===Zt}function VL(e,t){Ju=Hf=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function FL(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,ey(e,r)}}var Kf={readContext:Ri,useCallback:Xr,useContext:Xr,useEffect:Xr,useImperativeHandle:Xr,useInsertionEffect:Xr,useLayoutEffect:Xr,useMemo:Xr,useReducer:Xr,useRef:Xr,useState:Xr,useDebugValue:Xr,useDeferredValue:Xr,useTransition:Xr,useMutableSource:Xr,useSyncExternalStore:Xr,useId:Xr,unstable_isNewReconciler:!1},q3={readContext:Ri,useCallback:function(e,t){return co().memoizedState=[e,t===void 0?null:t],e},useContext:Ri,useEffect:WC,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,$p(4194308,4,PL.bind(null,t,e),r)},useLayoutEffect:function(e,t){return $p(4194308,4,e,t)},useInsertionEffect:function(e,t){return $p(4,2,e,t)},useMemo:function(e,t){var r=co();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=co();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Y3.bind(null,Zt,e),[n.memoizedState,e]},useRef:function(e){var t=co();return e={current:e},t.memoizedState=e},useState:GC,useDebugValue:Ry,useDeferredValue:function(e){return co().memoizedState=e},useTransition:function(){var e=GC(!1),t=e[0];return e=z3.bind(null,e[1]),co().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Zt,i=co();if(zt){if(r===void 0)throw Error(ie(407));r=r()}else{if(r=t(),jr===null)throw Error(ie(349));Hs&30||RL(n,t,r)}i.memoizedState=r;var o={value:r,getSnapshot:t};return i.queue=o,WC(IL.bind(null,n,o,e),[e]),n.flags|=2048,Pd(9,CL.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=co(),t=jr.identifierPrefix;if(zt){var r=zo,n=Ko;r=(n&~(1<<32-zi(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=Od++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=K3++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},X3={readContext:Ri,useCallback:kL,useContext:Ri,useEffect:yy,useImperativeHandle:DL,useInsertionEffect:OL,useLayoutEffect:NL,useMemo:LL,useReducer:$_,useRef:bL,useState:function(){return $_(Nd)},useDebugValue:Ry,useDeferredValue:function(e){var t=Ci();return ML(t,wr.memoizedState,e)},useTransition:function(){var e=$_(Nd)[0],t=Ci().memoizedState;return[e,t]},useMutableSource:TL,useSyncExternalStore:yL,useId:UL,unstable_isNewReconciler:!1},J3={readContext:Ri,useCallback:kL,useContext:Ri,useEffect:yy,useImperativeHandle:DL,useInsertionEffect:OL,useLayoutEffect:NL,useMemo:LL,useReducer:q_,useRef:bL,useState:function(){return q_(Nd)},useDebugValue:Ry,useDeferredValue:function(e){var t=Ci();return wr===null?t.memoizedState=e:ML(t,wr.memoizedState,e)},useTransition:function(){var e=q_(Nd)[0],t=Ci().memoizedState;return[e,t]},useMutableSource:TL,useSyncExternalStore:yL,useId:UL,unstable_isNewReconciler:!1};function Fi(e,t){if(e&&e.defaultProps){t=tr({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function aS(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:tr({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Um={isMounted:function(e){return(e=e._reactInternals)?Qs(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=pn(),i=ja(e),o=qo(n,i);o.payload=t,r!=null&&(o.callback=r),t=Va(e,o,i),t!==null&&(Yi(t,e,i,n),zp(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=pn(),i=ja(e),o=qo(n,i);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=Va(e,o,i),t!==null&&(Yi(t,e,i,n),zp(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=pn(),n=ja(e),i=qo(r,n);i.tag=2,t!=null&&(i.callback=t),t=Va(e,i,n),t!==null&&(Yi(t,e,n,r),zp(t,e,n))}};function HC(e,t,r,n,i,o,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,a):t.prototype&&t.prototype.isPureReactComponent?!Rd(r,n)||!Rd(i,o):!0}function jL(e,t,r){var n=!1,i=qa,o=t.contextType;return typeof o=="object"&&o!==null?o=Ri(o):(i=Nn(t)?Gs:rn.current,n=t.contextTypes,o=(n=n!=null)?El(e,i):qa),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Um,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function KC(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Um.enqueueReplaceState(t,t.state,null)}function sS(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs={},my(e);var o=t.contextType;typeof o=="object"&&o!==null?i.context=Ri(o):(o=Nn(t)?Gs:rn.current,i.context=El(e,o)),i.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(aS(e,t,o,r),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&Um.enqueueReplaceState(i,i.state,null),Gf(e,r,i,n),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function Tl(e,t){try{var r="",n=t;do r+=Ij(n),n=n.return;while(n);var i=r}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:i,digest:null}}function X_(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function cS(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Q3=typeof WeakMap=="function"?WeakMap:Map;function BL(e,t,r){r=qo(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Yf||(Yf=!0,gS=n),cS(e,t)},r}function GL(e,t,r){r=qo(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var i=t.value;r.payload=function(){return n(i)},r.callback=function(){cS(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){cS(e,t),typeof n!="function"&&(Fa===null?Fa=new Set([this]):Fa.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),r}function zC(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Q3;var i=new Set;n.set(t,i)}else i=n.get(t),i===void 0&&(i=new Set,n.set(t,i));i.has(r)||(i.add(r),e=hB.bind(null,e,t,r),t.then(e,e))}function YC(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function $C(e,t,r,n,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=qo(-1,1),t.tag=2,Va(r,t,1))),r.lanes|=1),e)}var Z3=na.ReactCurrentOwner,An=!1;function ln(e,t,r,n){t.child=e===null?EL(t,null,r,n):vl(t,e.child,r,n)}function qC(e,t,r,n,i){r=r.render;var o=t.ref;return il(t,i),n=Sy(e,t,r,n,o,i),r=Ty(),e!==null&&!An?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,ta(e,t,i)):(zt&&r&&cy(t),t.flags|=1,ln(e,t,n,i),t.child)}function XC(e,t,r,n,i){if(e===null){var o=r.type;return typeof o=="function"&&!Py(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,WL(e,t,o,n,i)):(e=Qp(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&i)){var a=o.memoizedProps;if(r=r.compare,r=r!==null?r:Rd,r(a,n)&&e.ref===t.ref)return ta(e,t,i)}return t.flags|=1,e=Ba(o,n),e.ref=t.ref,e.return=t,t.child=e}function WL(e,t,r,n,i){if(e!==null){var o=e.memoizedProps;if(Rd(o,n)&&e.ref===t.ref)if(An=!1,t.pendingProps=n=o,(e.lanes&i)!==0)e.flags&131072&&(An=!0);else return t.lanes=e.lanes,ta(e,t,i)}return lS(e,t,r,n,i)}function HL(e,t,r){var n=t.pendingProps,i=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xt(Gc,jn),jn|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xt(Gc,jn),jn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,xt(Gc,jn),jn|=n}else o!==null?(n=o.baseLanes|r,t.memoizedState=null):n=r,xt(Gc,jn),jn|=n;return ln(e,t,i,r),t.child}function KL(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function lS(e,t,r,n,i){var o=Nn(r)?Gs:rn.current;return o=El(t,o),il(t,i),r=Sy(e,t,r,n,o,i),n=Ty(),e!==null&&!An?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,ta(e,t,i)):(zt&&n&&cy(t),t.flags|=1,ln(e,t,r,i),t.child)}function JC(e,t,r,n,i){if(Nn(r)){var o=!0;xf(t)}else o=!1;if(il(t,i),t.stateNode===null)qp(e,t),jL(t,r,n),sS(t,r,n,i),n=!0;else if(e===null){var a=t.stateNode,s=t.memoizedProps;a.props=s;var c=a.context,l=r.contextType;typeof l=="object"&&l!==null?l=Ri(l):(l=Nn(r)?Gs:rn.current,l=El(t,l));var u=r.getDerivedStateFromProps,d=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==n||c!==l)&&KC(t,a,n,l),va=!1;var h=t.memoizedState;a.state=h,Gf(t,n,a,i),c=t.memoizedState,s!==n||h!==c||On.current||va?(typeof u=="function"&&(aS(t,r,u,n),c=t.memoizedState),(s=va||HC(t,r,s,n,h,c,l))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),a.props=n,a.state=c,a.context=l,n=s):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,vL(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:Fi(t.type,s),a.props=l,d=t.pendingProps,h=a.context,c=r.contextType,typeof c=="object"&&c!==null?c=Ri(c):(c=Nn(r)?Gs:rn.current,c=El(t,c));var p=r.getDerivedStateFromProps;(u=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==d||h!==c)&&KC(t,a,n,c),va=!1,h=t.memoizedState,a.state=h,Gf(t,n,a,i);var m=t.memoizedState;s!==d||h!==m||On.current||va?(typeof p=="function"&&(aS(t,r,p,n),m=t.memoizedState),(l=va||HC(t,r,l,n,h,m,c)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,m,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,m,c)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=m),a.props=n,a.state=m,a.context=c,n=l):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return uS(e,t,r,n,o,i)}function uS(e,t,r,n,i,o){KL(e,t);var a=(t.flags&128)!==0;if(!n&&!a)return i&&UC(t,r,!1),ta(e,t,o);n=t.stateNode,Z3.current=t;var s=a&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&a?(t.child=vl(t,e.child,null,o),t.child=vl(t,null,s,o)):ln(e,t,s,o),t.memoizedState=n.state,i&&UC(t,r,!0),t.child}function zL(e){var t=e.stateNode;t.pendingContext?MC(e,t.pendingContext,t.pendingContext!==t.context):t.context&&MC(e,t.context,!1),_y(e,t.containerInfo)}function QC(e,t,r,n,i){return gl(),uy(i),t.flags|=256,ln(e,t,r,n),t.child}var dS={dehydrated:null,treeContext:null,retryLane:0};function hS(e){return{baseLanes:e,cachePool:null,transitions:null}}function YL(e,t,r){var n=t.pendingProps,i=Xt.current,o=!1,a=(t.flags&128)!==0,s;if((s=a)||(s=e!==null&&e.memoizedState===null?!1:(i&2)!==0),s?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),xt(Xt,i&1),e===null)return iS(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=n.children,e=n.fallback,o?(n=t.mode,o=t.child,a={mode:"hidden",children:a},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=Fm(a,n,0,null),e=Us(e,n,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=hS(r),t.memoizedState=dS,e):Cy(t,a));if(i=e.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return eB(e,t,a,n,s,i,r);if(o){o=n.fallback,a=t.mode,i=e.child,s=i.sibling;var c={mode:"hidden",children:n.children};return!(a&1)&&t.child!==i?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=Ba(i,c),n.subtreeFlags=i.subtreeFlags&14680064),s!==null?o=Ba(s,o):(o=Us(o,a,r,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,a=e.child.memoizedState,a=a===null?hS(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=e.childLanes&~r,t.memoizedState=dS,n}return o=e.child,e=o.sibling,n=Ba(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function Cy(e,t){return t=Fm({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Bh(e,t,r,n){return n!==null&&uy(n),vl(t,e.child,null,r),e=Cy(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function eB(e,t,r,n,i,o,a){if(r)return t.flags&256?(t.flags&=-257,n=X_(Error(ie(422))),Bh(e,t,a,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,i=t.mode,n=Fm({mode:"visible",children:n.children},i,0,null),o=Us(o,i,a,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&vl(t,e.child,null,a),t.child.memoizedState=hS(a),t.memoizedState=dS,o);if(!(t.mode&1))return Bh(e,t,a,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var s=n.dgst;return n=s,o=Error(ie(419)),n=X_(o,n,void 0),Bh(e,t,a,n)}if(s=(a&e.childLanes)!==0,An||s){if(n=jr,n!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|a)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,ea(e,i),Yi(n,e,i,-1))}return Ny(),n=X_(Error(ie(421))),Bh(e,t,a,n)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=pB.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,Wn=xa(i.nextSibling),Yn=t,zt=!0,Wi=null,e!==null&&(fi[mi++]=Ko,fi[mi++]=zo,fi[mi++]=Ws,Ko=e.id,zo=e.overflow,Ws=t),t=Cy(t,n.children),t.flags|=4096,t)}function ZC(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),oS(e.return,t,r)}function J_(e,t,r,n,i){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=i)}function $L(e,t,r){var n=t.pendingProps,i=n.revealOrder,o=n.tail;if(ln(e,t,n.children,r),n=Xt.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ZC(e,r,t);else if(e.tag===19)ZC(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(xt(Xt,n),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;r!==null;)e=r.alternate,e!==null&&Wf(e)===null&&(i=r),r=r.sibling;r=i,r===null?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),J_(t,!1,i,r,o);break;case"backwards":for(r=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Wf(e)===null){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}J_(t,!0,r,null,o);break;case"together":J_(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qp(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ta(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Ks|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ie(153));if(t.child!==null){for(e=t.child,r=Ba(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Ba(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function tB(e,t,r){switch(t.tag){case 3:zL(t),gl();break;case 5:SL(t);break;case 1:Nn(t.type)&&xf(t);break;case 4:_y(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;xt(jf,n._currentValue),n._currentValue=i;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(xt(Xt,Xt.current&1),t.flags|=128,null):r&t.child.childLanes?YL(e,t,r):(xt(Xt,Xt.current&1),e=ta(e,t,r),e!==null?e.sibling:null);xt(Xt,Xt.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return $L(e,t,r);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),xt(Xt,Xt.current),n)break;return null;case 22:case 23:return t.lanes=0,HL(e,t,r)}return ta(e,t,r)}var qL,pS,XL,JL;qL=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};pS=function(){};XL=function(e,t,r,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,ws(vo.current);var o=null;switch(r){case"input":i=Mv(e,i),n=Mv(e,n),o=[];break;case"select":i=tr({},i,{value:void 0}),n=tr({},n,{value:void 0}),o=[];break;case"textarea":i=Vv(e,i),n=Vv(e,n),o=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Mf)}jv(r,n);var a;r=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(a in s)s.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(_d.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in n){var c=n[l];if(s=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&c!==s&&(c!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in c)c.hasOwnProperty(a)&&s[a]!==c[a]&&(r||(r={}),r[a]=c[a])}else r||(o||(o=[]),o.push(l,r)),r=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,s=s?s.__html:void 0,c!=null&&s!==c&&(o=o||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(_d.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Vt("scroll",e),o||s===c||(o=[])):(o=o||[]).push(l,c))}r&&(o=o||[]).push("style",r);var l=o;(t.updateQueue=l)&&(t.flags|=4)}};JL=function(e,t,r,n){r!==n&&(t.flags|=4)};function lu(e,t){if(!zt)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Jr(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function rB(e,t,r){var n=t.pendingProps;switch(ly(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jr(t),null;case 1:return Nn(t.type)&&Uf(),Jr(t),null;case 3:return n=t.stateNode,Sl(),Wt(On),Wt(rn),gy(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(Fh(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Wi!==null&&(TS(Wi),Wi=null))),pS(e,t),Jr(t),null;case 5:Ey(t);var i=ws(bd.current);if(r=t.type,e!==null&&t.stateNode!=null)XL(e,t,r,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(ie(166));return Jr(t),null}if(e=ws(vo.current),Fh(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[uo]=t,n[wd]=o,e=(t.mode&1)!==0,r){case"dialog":Vt("cancel",n),Vt("close",n);break;case"iframe":case"object":case"embed":Vt("load",n);break;case"video":case"audio":for(i=0;i<Du.length;i++)Vt(Du[i],n);break;case"source":Vt("error",n);break;case"img":case"image":case"link":Vt("error",n),Vt("load",n);break;case"details":Vt("toggle",n);break;case"input":cC(n,o),Vt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Vt("invalid",n);break;case"textarea":uC(n,o),Vt("invalid",n)}jv(r,o),i=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?n.textContent!==s&&(o.suppressHydrationWarning!==!0&&Vh(n.textContent,s,e),i=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&Vh(n.textContent,s,e),i=["children",""+s]):_d.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&Vt("scroll",n)}switch(r){case"input":Nh(n),lC(n,o,!0);break;case"textarea":Nh(n),dC(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=Mf)}n=i,t.updateQueue=n,n!==null&&(t.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Ik(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=a.createElement(r,{is:n.is}):(e=a.createElement(r),r==="select"&&(a=e,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):e=a.createElementNS(e,r),e[uo]=t,e[wd]=n,qL(e,t,!1,!1),t.stateNode=e;e:{switch(a=Bv(r,n),r){case"dialog":Vt("cancel",e),Vt("close",e),i=n;break;case"iframe":case"object":case"embed":Vt("load",e),i=n;break;case"video":case"audio":for(i=0;i<Du.length;i++)Vt(Du[i],e);i=n;break;case"source":Vt("error",e),i=n;break;case"img":case"image":case"link":Vt("error",e),Vt("load",e),i=n;break;case"details":Vt("toggle",e),i=n;break;case"input":cC(e,n),i=Mv(e,n),Vt("invalid",e);break;case"option":i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=tr({},n,{value:void 0}),Vt("invalid",e);break;case"textarea":uC(e,n),i=Vv(e,n),Vt("invalid",e);break;default:i=n}jv(r,i),s=i;for(o in s)if(s.hasOwnProperty(o)){var c=s[o];o==="style"?bk(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&wk(e,c)):o==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&Ed(e,c):typeof c=="number"&&Ed(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(_d.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Vt("scroll",e):c!=null&&$T(e,o,c,a))}switch(r){case"input":Nh(e),lC(e,n,!1);break;case"textarea":Nh(e),dC(e);break;case"option":n.value!=null&&e.setAttribute("value",""+$a(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?el(e,!!n.multiple,o,!1):n.defaultValue!=null&&el(e,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=Mf)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Jr(t),null;case 6:if(e&&t.stateNode!=null)JL(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(ie(166));if(r=ws(bd.current),ws(vo.current),Fh(t)){if(n=t.stateNode,r=t.memoizedProps,n[uo]=t,(o=n.nodeValue!==r)&&(e=Yn,e!==null))switch(e.tag){case 3:Vh(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Vh(n.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[uo]=t,t.stateNode=n}return Jr(t),null;case 13:if(Wt(Xt),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(zt&&Wn!==null&&t.mode&1&&!(t.flags&128))mL(),gl(),t.flags|=98560,o=!1;else if(o=Fh(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(ie(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(ie(317));o[uo]=t}else gl(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Jr(t),o=!1}else Wi!==null&&(TS(Wi),Wi=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Xt.current&1?br===0&&(br=3):Ny())),t.updateQueue!==null&&(t.flags|=4),Jr(t),null);case 4:return Sl(),pS(e,t),e===null&&Cd(t.stateNode.containerInfo),Jr(t),null;case 10:return py(t.type._context),Jr(t),null;case 17:return Nn(t.type)&&Uf(),Jr(t),null;case 19:if(Wt(Xt),o=t.memoizedState,o===null)return Jr(t),null;if(n=(t.flags&128)!==0,a=o.rendering,a===null)if(n)lu(o,!1);else{if(br!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=Wf(e),a!==null){for(t.flags|=128,lu(o,!1),n=a.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)o=r,e=n,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,e=a.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return xt(Xt,Xt.current&1|2),t.child}e=e.sibling}o.tail!==null&&mr()>yl&&(t.flags|=128,n=!0,lu(o,!1),t.lanes=4194304)}else{if(!n)if(e=Wf(a),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),lu(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!zt)return Jr(t),null}else 2*mr()-o.renderingStartTime>yl&&r!==1073741824&&(t.flags|=128,n=!0,lu(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(r=o.last,r!==null?r.sibling=a:t.child=a,o.last=a)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=mr(),t.sibling=null,r=Xt.current,xt(Xt,n?r&1|2:r&1),t):(Jr(t),null);case 22:case 23:return Oy(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?jn&1073741824&&(Jr(t),t.subtreeFlags&6&&(t.flags|=8192)):Jr(t),null;case 24:return null;case 25:return null}throw Error(ie(156,t.tag))}function nB(e,t){switch(ly(t),t.tag){case 1:return Nn(t.type)&&Uf(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Sl(),Wt(On),Wt(rn),gy(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ey(t),null;case 13:if(Wt(Xt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ie(340));gl()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Wt(Xt),null;case 4:return Sl(),null;case 10:return py(t.type._context),null;case 22:case 23:return Oy(),null;case 24:return null;default:return null}}var Gh=!1,tn=!1,iB=typeof WeakSet=="function"?WeakSet:Set,me=null;function Bc(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){ar(e,t,n)}else r.current=null}function fS(e,t,r){try{r()}catch(n){ar(e,t,n)}}var eI=!1;function oB(e,t){if(Jv=Df,e=rL(),sy(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var a=0,s=-1,c=-1,l=0,u=0,d=e,h=null;t:for(;;){for(var p;d!==r||i!==0&&d.nodeType!==3||(s=a+i),d!==o||n!==0&&d.nodeType!==3||(c=a+n),d.nodeType===3&&(a+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===e)break t;if(h===r&&++l===i&&(s=a),h===o&&++u===n&&(c=a),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}r=s===-1||c===-1?null:{start:s,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(Qv={focusedElem:e,selectionRange:r},Df=!1,me=t;me!==null;)if(t=me,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,me=e;else for(;me!==null;){t=me;try{var m=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var f=m.memoizedProps,_=m.memoizedState,E=t.stateNode,g=E.getSnapshotBeforeUpdate(t.elementType===t.type?f:Fi(t.type,f),_);E.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var T=t.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ie(163))}}catch(R){ar(t,t.return,R)}if(e=t.sibling,e!==null){e.return=t.return,me=e;break}me=t.return}return m=eI,eI=!1,m}function Qu(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,o!==void 0&&fS(t,r,o)}i=i.next}while(i!==n)}}function xm(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function mS(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function QL(e){var t=e.alternate;t!==null&&(e.alternate=null,QL(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[uo],delete t[wd],delete t[tS],delete t[B3],delete t[G3])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ZL(e){return e.tag===5||e.tag===3||e.tag===4}function tI(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ZL(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function _S(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Mf));else if(n!==4&&(e=e.child,e!==null))for(_S(e,t,r),e=e.sibling;e!==null;)_S(e,t,r),e=e.sibling}function ES(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(ES(e,t,r),e=e.sibling;e!==null;)ES(e,t,r),e=e.sibling}var Wr=null,ji=!1;function oa(e,t,r){for(r=r.child;r!==null;)eM(e,t,r),r=r.sibling}function eM(e,t,r){if(go&&typeof go.onCommitFiberUnmount=="function")try{go.onCommitFiberUnmount(Om,r)}catch{}switch(r.tag){case 5:tn||Bc(r,t);case 6:var n=Wr,i=ji;Wr=null,oa(e,t,r),Wr=n,ji=i,Wr!==null&&(ji?(e=Wr,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Wr.removeChild(r.stateNode));break;case 18:Wr!==null&&(ji?(e=Wr,r=r.stateNode,e.nodeType===8?H_(e.parentNode,r):e.nodeType===1&&H_(e,r),Td(e)):H_(Wr,r.stateNode));break;case 4:n=Wr,i=ji,Wr=r.stateNode.containerInfo,ji=!0,oa(e,t,r),Wr=n,ji=i;break;case 0:case 11:case 14:case 15:if(!tn&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var o=i,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&fS(r,t,a),i=i.next}while(i!==n)}oa(e,t,r);break;case 1:if(!tn&&(Bc(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){ar(r,t,s)}oa(e,t,r);break;case 21:oa(e,t,r);break;case 22:r.mode&1?(tn=(n=tn)||r.memoizedState!==null,oa(e,t,r),tn=n):oa(e,t,r);break;default:oa(e,t,r)}}function rI(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new iB),t.forEach(function(n){var i=fB.bind(null,e,n);r.has(n)||(r.add(n),n.then(i,i))})}}function Ni(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var o=e,a=t,s=a;e:for(;s!==null;){switch(s.tag){case 5:Wr=s.stateNode,ji=!1;break e;case 3:Wr=s.stateNode.containerInfo,ji=!0;break e;case 4:Wr=s.stateNode.containerInfo,ji=!0;break e}s=s.return}if(Wr===null)throw Error(ie(160));eM(o,a,i),Wr=null,ji=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){ar(i,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)tM(t,e),t=t.sibling}function tM(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ni(t,e),Zi(e),n&4){try{Qu(3,e,e.return),xm(3,e)}catch(f){ar(e,e.return,f)}try{Qu(5,e,e.return)}catch(f){ar(e,e.return,f)}}break;case 1:Ni(t,e),Zi(e),n&512&&r!==null&&Bc(r,r.return);break;case 5:if(Ni(t,e),Zi(e),n&512&&r!==null&&Bc(r,r.return),e.flags&32){var i=e.stateNode;try{Ed(i,"")}catch(f){ar(e,e.return,f)}}if(n&4&&(i=e.stateNode,i!=null)){var o=e.memoizedProps,a=r!==null?r.memoizedProps:o,s=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&Rk(i,o),Bv(s,a);var l=Bv(s,o);for(a=0;a<c.length;a+=2){var u=c[a],d=c[a+1];u==="style"?bk(i,d):u==="dangerouslySetInnerHTML"?wk(i,d):u==="children"?Ed(i,d):$T(i,u,d,l)}switch(s){case"input":Uv(i,o);break;case"textarea":Ck(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?el(i,!!o.multiple,p,!1):h!==!!o.multiple&&(o.defaultValue!=null?el(i,!!o.multiple,o.defaultValue,!0):el(i,!!o.multiple,o.multiple?[]:"",!1))}i[wd]=o}catch(f){ar(e,e.return,f)}}break;case 6:if(Ni(t,e),Zi(e),n&4){if(e.stateNode===null)throw Error(ie(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(f){ar(e,e.return,f)}}break;case 3:if(Ni(t,e),Zi(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Td(t.containerInfo)}catch(f){ar(e,e.return,f)}break;case 4:Ni(t,e),Zi(e);break;case 13:Ni(t,e),Zi(e),i=e.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Ay=mr())),n&4&&rI(e);break;case 22:if(u=r!==null&&r.memoizedState!==null,e.mode&1?(tn=(l=tn)||u,Ni(t,e),tn=l):Ni(t,e),Zi(e),n&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!u&&e.mode&1)for(me=e,u=e.child;u!==null;){for(d=me=u;me!==null;){switch(h=me,p=h.child,h.tag){case 0:case 11:case 14:case 15:Qu(4,h,h.return);break;case 1:Bc(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){n=h,r=h.return;try{t=n,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(f){ar(n,r,f)}}break;case 5:Bc(h,h.return);break;case 22:if(h.memoizedState!==null){iI(d);continue}}p!==null?(p.return=h,me=p):iI(d)}u=u.sibling}e:for(u=null,d=e;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,l?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=d.stateNode,c=d.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,s.style.display=Ak("display",a))}catch(f){ar(e,e.return,f)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(f){ar(e,e.return,f)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Ni(t,e),Zi(e),n&4&&rI(e);break;case 21:break;default:Ni(t,e),Zi(e)}}function Zi(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(ZL(r)){var n=r;break e}r=r.return}throw Error(ie(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(Ed(i,""),n.flags&=-33);var o=tI(e);ES(e,o,i);break;case 3:case 4:var a=n.stateNode.containerInfo,s=tI(e);_S(e,s,a);break;default:throw Error(ie(161))}}catch(c){ar(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function aB(e,t,r){me=e,rM(e)}function rM(e,t,r){for(var n=(e.mode&1)!==0;me!==null;){var i=me,o=i.child;if(i.tag===22&&n){var a=i.memoizedState!==null||Gh;if(!a){var s=i.alternate,c=s!==null&&s.memoizedState!==null||tn;s=Gh;var l=tn;if(Gh=a,(tn=c)&&!l)for(me=i;me!==null;)a=me,c=a.child,a.tag===22&&a.memoizedState!==null?oI(i):c!==null?(c.return=a,me=c):oI(i);for(;o!==null;)me=o,rM(o),o=o.sibling;me=i,Gh=s,tn=l}nI(e)}else i.subtreeFlags&8772&&o!==null?(o.return=i,me=o):nI(e)}}function nI(e){for(;me!==null;){var t=me;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:tn||xm(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!tn)if(r===null)n.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:Fi(t.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&BC(t,o,n);break;case 3:var a=t.updateQueue;if(a!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}BC(t,a,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Td(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ie(163))}tn||t.flags&512&&mS(t)}catch(h){ar(t,t.return,h)}}if(t===e){me=null;break}if(r=t.sibling,r!==null){r.return=t.return,me=r;break}me=t.return}}function iI(e){for(;me!==null;){var t=me;if(t===e){me=null;break}var r=t.sibling;if(r!==null){r.return=t.return,me=r;break}me=t.return}}function oI(e){for(;me!==null;){var t=me;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{xm(4,t)}catch(c){ar(t,r,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var i=t.return;try{n.componentDidMount()}catch(c){ar(t,i,c)}}var o=t.return;try{mS(t)}catch(c){ar(t,o,c)}break;case 5:var a=t.return;try{mS(t)}catch(c){ar(t,a,c)}}}catch(c){ar(t,t.return,c)}if(t===e){me=null;break}var s=t.sibling;if(s!==null){s.return=t.return,me=s;break}me=t.return}}var sB=Math.ceil,zf=na.ReactCurrentDispatcher,Iy=na.ReactCurrentOwner,Ti=na.ReactCurrentBatchConfig,ct=0,jr=null,Tr=null,zr=0,jn=0,Gc=es(0),br=0,Dd=null,Ks=0,Vm=0,wy=0,Zu=null,yn=null,Ay=0,yl=1/0,Fo=null,Yf=!1,gS=null,Fa=null,Wh=!1,Aa=null,$f=0,ed=0,vS=null,Xp=-1,Jp=0;function pn(){return ct&6?mr():Xp!==-1?Xp:Xp=mr()}function ja(e){return e.mode&1?ct&2&&zr!==0?zr&-zr:H3.transition!==null?(Jp===0&&(Jp=jk()),Jp):(e=At,e!==0||(e=window.event,e=e===void 0?16:Yk(e.type)),e):1}function Yi(e,t,r,n){if(50<ed)throw ed=0,vS=null,Error(ie(185));sh(e,r,n),(!(ct&2)||e!==jr)&&(e===jr&&(!(ct&2)&&(Vm|=r),br===4&&Ta(e,zr)),Pn(e,n),r===1&&ct===0&&!(t.mode&1)&&(yl=mr()+500,Lm&&ts()))}function Pn(e,t){var r=e.callbackNode;Hj(e,t);var n=Pf(e,e===jr?zr:0);if(n===0)r!==null&&fC(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&fC(r),t===1)e.tag===0?W3(aI.bind(null,e)):hL(aI.bind(null,e)),F3(function(){!(ct&6)&&ts()}),r=null;else{switch(Bk(n)){case 1:r=ZT;break;case 4:r=Vk;break;case 16:r=Nf;break;case 536870912:r=Fk;break;default:r=Nf}r=uM(r,nM.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function nM(e,t){if(Xp=-1,Jp=0,ct&6)throw Error(ie(327));var r=e.callbackNode;if(ol()&&e.callbackNode!==r)return null;var n=Pf(e,e===jr?zr:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=qf(e,n);else{t=n;var i=ct;ct|=2;var o=oM();(jr!==e||zr!==t)&&(Fo=null,yl=mr()+500,Ms(e,t));do try{uB();break}catch(s){iM(e,s)}while(!0);hy(),zf.current=o,ct=i,Tr!==null?t=0:(jr=null,zr=0,t=br)}if(t!==0){if(t===2&&(i=zv(e),i!==0&&(n=i,t=SS(e,i))),t===1)throw r=Dd,Ms(e,0),Ta(e,n),Pn(e,mr()),r;if(t===6)Ta(e,n);else{if(i=e.current.alternate,!(n&30)&&!cB(i)&&(t=qf(e,n),t===2&&(o=zv(e),o!==0&&(n=o,t=SS(e,o))),t===1))throw r=Dd,Ms(e,0),Ta(e,n),Pn(e,mr()),r;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(ie(345));case 2:ms(e,yn,Fo);break;case 3:if(Ta(e,n),(n&130023424)===n&&(t=Ay+500-mr(),10<t)){if(Pf(e,0)!==0)break;if(i=e.suspendedLanes,(i&n)!==n){pn(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=eS(ms.bind(null,e,yn,Fo),t);break}ms(e,yn,Fo);break;case 4:if(Ta(e,n),(n&4194240)===n)break;for(t=e.eventTimes,i=-1;0<n;){var a=31-zi(n);o=1<<a,a=t[a],a>i&&(i=a),n&=~o}if(n=i,n=mr()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*sB(n/1960))-n,10<n){e.timeoutHandle=eS(ms.bind(null,e,yn,Fo),n);break}ms(e,yn,Fo);break;case 5:ms(e,yn,Fo);break;default:throw Error(ie(329))}}}return Pn(e,mr()),e.callbackNode===r?nM.bind(null,e):null}function SS(e,t){var r=Zu;return e.current.memoizedState.isDehydrated&&(Ms(e,t).flags|=256),e=qf(e,t),e!==2&&(t=yn,yn=r,t!==null&&TS(t)),e}function TS(e){yn===null?yn=e:yn.push.apply(yn,e)}function cB(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],o=i.getSnapshot;i=i.value;try{if(!$i(o(),i))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ta(e,t){for(t&=~wy,t&=~Vm,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-zi(t),n=1<<r;e[r]=-1,t&=~n}}function aI(e){if(ct&6)throw Error(ie(327));ol();var t=Pf(e,0);if(!(t&1))return Pn(e,mr()),null;var r=qf(e,t);if(e.tag!==0&&r===2){var n=zv(e);n!==0&&(t=n,r=SS(e,n))}if(r===1)throw r=Dd,Ms(e,0),Ta(e,t),Pn(e,mr()),r;if(r===6)throw Error(ie(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ms(e,yn,Fo),Pn(e,mr()),null}function by(e,t){var r=ct;ct|=1;try{return e(t)}finally{ct=r,ct===0&&(yl=mr()+500,Lm&&ts())}}function zs(e){Aa!==null&&Aa.tag===0&&!(ct&6)&&ol();var t=ct;ct|=1;var r=Ti.transition,n=At;try{if(Ti.transition=null,At=1,e)return e()}finally{At=n,Ti.transition=r,ct=t,!(ct&6)&&ts()}}function Oy(){jn=Gc.current,Wt(Gc)}function Ms(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,V3(r)),Tr!==null)for(r=Tr.return;r!==null;){var n=r;switch(ly(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Uf();break;case 3:Sl(),Wt(On),Wt(rn),gy();break;case 5:Ey(n);break;case 4:Sl();break;case 13:Wt(Xt);break;case 19:Wt(Xt);break;case 10:py(n.type._context);break;case 22:case 23:Oy()}r=r.return}if(jr=e,Tr=e=Ba(e.current,null),zr=jn=t,br=0,Dd=null,wy=Vm=Ks=0,yn=Zu=null,Is!==null){for(t=0;t<Is.length;t++)if(r=Is[t],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,o=r.pending;if(o!==null){var a=o.next;o.next=i,n.next=a}r.pending=n}Is=null}return e}function iM(e,t){do{var r=Tr;try{if(hy(),Yp.current=Kf,Hf){for(var n=Zt.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}Hf=!1}if(Hs=0,Mr=wr=Zt=null,Ju=!1,Od=0,Iy.current=null,r===null||r.return===null){br=1,Dd=t,Tr=null;break}e:{var o=e,a=r.return,s=r,c=t;if(t=zr,s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=s,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=YC(a);if(p!==null){p.flags&=-257,$C(p,a,s,o,t),p.mode&1&&zC(o,l,t),t=p,c=l;var m=t.updateQueue;if(m===null){var f=new Set;f.add(c),t.updateQueue=f}else m.add(c);break e}else{if(!(t&1)){zC(o,l,t),Ny();break e}c=Error(ie(426))}}else if(zt&&s.mode&1){var _=YC(a);if(_!==null){!(_.flags&65536)&&(_.flags|=256),$C(_,a,s,o,t),uy(Tl(c,s));break e}}o=c=Tl(c,s),br!==4&&(br=2),Zu===null?Zu=[o]:Zu.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var E=BL(o,c,t);jC(o,E);break e;case 1:s=c;var g=o.type,T=o.stateNode;if(!(o.flags&128)&&(typeof g.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Fa===null||!Fa.has(T)))){o.flags|=65536,t&=-t,o.lanes|=t;var R=GL(o,s,t);jC(o,R);break e}}o=o.return}while(o!==null)}sM(r)}catch(w){t=w,Tr===r&&r!==null&&(Tr=r=r.return);continue}break}while(!0)}function oM(){var e=zf.current;return zf.current=Kf,e===null?Kf:e}function Ny(){(br===0||br===3||br===2)&&(br=4),jr===null||!(Ks&268435455)&&!(Vm&268435455)||Ta(jr,zr)}function qf(e,t){var r=ct;ct|=2;var n=oM();(jr!==e||zr!==t)&&(Fo=null,Ms(e,t));do try{lB();break}catch(i){iM(e,i)}while(!0);if(hy(),ct=r,zf.current=n,Tr!==null)throw Error(ie(261));return jr=null,zr=0,br}function lB(){for(;Tr!==null;)aM(Tr)}function uB(){for(;Tr!==null&&!Mj();)aM(Tr)}function aM(e){var t=lM(e.alternate,e,jn);e.memoizedProps=e.pendingProps,t===null?sM(e):Tr=t,Iy.current=null}function sM(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=nB(r,t),r!==null){r.flags&=32767,Tr=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{br=6,Tr=null;return}}else if(r=rB(r,t,jn),r!==null){Tr=r;return}if(t=t.sibling,t!==null){Tr=t;return}Tr=t=e}while(t!==null);br===0&&(br=5)}function ms(e,t,r){var n=At,i=Ti.transition;try{Ti.transition=null,At=1,dB(e,t,r,n)}finally{Ti.transition=i,At=n}return null}function dB(e,t,r,n){do ol();while(Aa!==null);if(ct&6)throw Error(ie(327));r=e.finishedWork;var i=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(ie(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(Kj(e,o),e===jr&&(Tr=jr=null,zr=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||Wh||(Wh=!0,uM(Nf,function(){return ol(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=Ti.transition,Ti.transition=null;var a=At;At=1;var s=ct;ct|=4,Iy.current=null,oB(e,r),tM(r,e),P3(Qv),Df=!!Jv,Qv=Jv=null,e.current=r,aB(r),Uj(),ct=s,At=a,Ti.transition=o}else e.current=r;if(Wh&&(Wh=!1,Aa=e,$f=i),o=e.pendingLanes,o===0&&(Fa=null),Fj(r.stateNode),Pn(e,mr()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(Yf)throw Yf=!1,e=gS,gS=null,e;return $f&1&&e.tag!==0&&ol(),o=e.pendingLanes,o&1?e===vS?ed++:(ed=0,vS=e):ed=0,ts(),null}function ol(){if(Aa!==null){var e=Bk($f),t=Ti.transition,r=At;try{if(Ti.transition=null,At=16>e?16:e,Aa===null)var n=!1;else{if(e=Aa,Aa=null,$f=0,ct&6)throw Error(ie(331));var i=ct;for(ct|=4,me=e.current;me!==null;){var o=me,a=o.child;if(me.flags&16){var s=o.deletions;if(s!==null){for(var c=0;c<s.length;c++){var l=s[c];for(me=l;me!==null;){var u=me;switch(u.tag){case 0:case 11:case 15:Qu(8,u,o)}var d=u.child;if(d!==null)d.return=u,me=d;else for(;me!==null;){u=me;var h=u.sibling,p=u.return;if(QL(u),u===l){me=null;break}if(h!==null){h.return=p,me=h;break}me=p}}}var m=o.alternate;if(m!==null){var f=m.child;if(f!==null){m.child=null;do{var _=f.sibling;f.sibling=null,f=_}while(f!==null)}}me=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,me=a;else e:for(;me!==null;){if(o=me,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Qu(9,o,o.return)}var E=o.sibling;if(E!==null){E.return=o.return,me=E;break e}me=o.return}}var g=e.current;for(me=g;me!==null;){a=me;var T=a.child;if(a.subtreeFlags&2064&&T!==null)T.return=a,me=T;else e:for(a=g;me!==null;){if(s=me,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:xm(9,s)}}catch(w){ar(s,s.return,w)}if(s===a){me=null;break e}var R=s.sibling;if(R!==null){R.return=s.return,me=R;break e}me=s.return}}if(ct=i,ts(),go&&typeof go.onPostCommitFiberRoot=="function")try{go.onPostCommitFiberRoot(Om,e)}catch{}n=!0}return n}finally{At=r,Ti.transition=t}}return!1}function sI(e,t,r){t=Tl(r,t),t=BL(e,t,1),e=Va(e,t,1),t=pn(),e!==null&&(sh(e,1,t),Pn(e,t))}function ar(e,t,r){if(e.tag===3)sI(e,e,r);else for(;t!==null;){if(t.tag===3){sI(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Fa===null||!Fa.has(n))){e=Tl(r,e),e=GL(t,e,1),t=Va(t,e,1),e=pn(),t!==null&&(sh(t,1,e),Pn(t,e));break}}t=t.return}}function hB(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=pn(),e.pingedLanes|=e.suspendedLanes&r,jr===e&&(zr&r)===r&&(br===4||br===3&&(zr&130023424)===zr&&500>mr()-Ay?Ms(e,0):wy|=r),Pn(e,t)}function cM(e,t){t===0&&(e.mode&1?(t=kh,kh<<=1,!(kh&130023424)&&(kh=4194304)):t=1);var r=pn();e=ea(e,t),e!==null&&(sh(e,t,r),Pn(e,r))}function pB(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),cM(e,r)}function fB(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(ie(314))}n!==null&&n.delete(t),cM(e,r)}var lM;lM=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||On.current)An=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return An=!1,tB(e,t,r);An=!!(e.flags&131072)}else An=!1,zt&&t.flags&1048576&&pL(t,Ff,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;qp(e,t),e=t.pendingProps;var i=El(t,rn.current);il(t,r),i=Sy(null,t,n,e,i,r);var o=Ty();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Nn(n)?(o=!0,xf(t)):o=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,my(t),i.updater=Um,t.stateNode=i,i._reactInternals=t,sS(t,n,e,r),t=uS(null,t,n,!0,o,r)):(t.tag=0,zt&&o&&cy(t),ln(null,t,i,r),t=t.child),t;case 16:n=t.elementType;e:{switch(qp(e,t),e=t.pendingProps,i=n._init,n=i(n._payload),t.type=n,i=t.tag=_B(n),e=Fi(n,e),i){case 0:t=lS(null,t,n,e,r);break e;case 1:t=JC(null,t,n,e,r);break e;case 11:t=qC(null,t,n,e,r);break e;case 14:t=XC(null,t,n,Fi(n.type,e),r);break e}throw Error(ie(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Fi(n,i),lS(e,t,n,i,r);case 1:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Fi(n,i),JC(e,t,n,i,r);case 3:e:{if(zL(t),e===null)throw Error(ie(387));n=t.pendingProps,o=t.memoizedState,i=o.element,vL(e,t),Gf(t,n,null,r);var a=t.memoizedState;if(n=a.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){i=Tl(Error(ie(423)),t),t=QC(e,t,n,r,i);break e}else if(n!==i){i=Tl(Error(ie(424)),t),t=QC(e,t,n,r,i);break e}else for(Wn=xa(t.stateNode.containerInfo.firstChild),Yn=t,zt=!0,Wi=null,r=EL(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(gl(),n===i){t=ta(e,t,r);break e}ln(e,t,n,r)}t=t.child}return t;case 5:return SL(t),e===null&&iS(t),n=t.type,i=t.pendingProps,o=e!==null?e.memoizedProps:null,a=i.children,Zv(n,i)?a=null:o!==null&&Zv(n,o)&&(t.flags|=32),KL(e,t),ln(e,t,a,r),t.child;case 6:return e===null&&iS(t),null;case 13:return YL(e,t,r);case 4:return _y(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=vl(t,null,n,r):ln(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Fi(n,i),qC(e,t,n,i,r);case 7:return ln(e,t,t.pendingProps,r),t.child;case 8:return ln(e,t,t.pendingProps.children,r),t.child;case 12:return ln(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,o=t.memoizedProps,a=i.value,xt(jf,n._currentValue),n._currentValue=a,o!==null)if($i(o.value,a)){if(o.children===i.children&&!On.current){t=ta(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var c=s.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=qo(-1,r&-r),c.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),oS(o.return,r,t),s.lanes|=r;break}c=c.next}}else if(o.tag===10)a=o.type===t.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(ie(341));a.lanes|=r,s=a.alternate,s!==null&&(s.lanes|=r),oS(a,r,t),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===t){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}ln(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,il(t,r),i=Ri(i),n=n(i),t.flags|=1,ln(e,t,n,r),t.child;case 14:return n=t.type,i=Fi(n,t.pendingProps),i=Fi(n.type,i),XC(e,t,n,i,r);case 15:return WL(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Fi(n,i),qp(e,t),t.tag=1,Nn(n)?(e=!0,xf(t)):e=!1,il(t,r),jL(t,n,i),sS(t,n,i,r),uS(null,t,n,!0,e,r);case 19:return $L(e,t,r);case 22:return HL(e,t,r)}throw Error(ie(156,t.tag))};function uM(e,t){return xk(e,t)}function mB(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vi(e,t,r,n){return new mB(e,t,r,n)}function Py(e){return e=e.prototype,!(!e||!e.isReactComponent)}function _B(e){if(typeof e=="function")return Py(e)?1:0;if(e!=null){if(e=e.$$typeof,e===XT)return 11;if(e===JT)return 14}return 2}function Ba(e,t){var r=e.alternate;return r===null?(r=vi(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Qp(e,t,r,n,i,o){var a=2;if(n=e,typeof e=="function")Py(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Dc:return Us(r.children,i,o,t);case qT:a=8,i|=8;break;case Pv:return e=vi(12,r,t,i|2),e.elementType=Pv,e.lanes=o,e;case Dv:return e=vi(13,r,t,i),e.elementType=Dv,e.lanes=o,e;case kv:return e=vi(19,r,t,i),e.elementType=kv,e.lanes=o,e;case Sk:return Fm(r,i,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case gk:a=10;break e;case vk:a=9;break e;case XT:a=11;break e;case JT:a=14;break e;case ga:a=16,n=null;break e}throw Error(ie(130,e==null?e:typeof e,""))}return t=vi(a,r,t,i),t.elementType=e,t.type=n,t.lanes=o,t}function Us(e,t,r,n){return e=vi(7,e,n,t),e.lanes=r,e}function Fm(e,t,r,n){return e=vi(22,e,n,t),e.elementType=Sk,e.lanes=r,e.stateNode={isHidden:!1},e}function Q_(e,t,r){return e=vi(6,e,null,t),e.lanes=r,e}function Z_(e,t,r){return t=vi(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function EB(e,t,r,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=k_(0),this.expirationTimes=k_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=k_(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Dy(e,t,r,n,i,o,a,s,c){return e=new EB(e,t,r,s,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=vi(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},my(o),e}function gB(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pc,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function dM(e){if(!e)return qa;e=e._reactInternals;e:{if(Qs(e)!==e||e.tag!==1)throw Error(ie(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Nn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ie(171))}if(e.tag===1){var r=e.type;if(Nn(r))return dL(e,r,t)}return t}function hM(e,t,r,n,i,o,a,s,c){return e=Dy(r,n,!0,e,i,o,a,s,c),e.context=dM(null),r=e.current,n=pn(),i=ja(r),o=qo(n,i),o.callback=t??null,Va(r,o,i),e.current.lanes=i,sh(e,i,n),Pn(e,n),e}function jm(e,t,r,n){var i=t.current,o=pn(),a=ja(i);return r=dM(r),t.context===null?t.context=r:t.pendingContext=r,t=qo(o,a),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Va(i,t,a),e!==null&&(Yi(e,i,a,o),zp(e,i,a)),a}function Xf(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function cI(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function ky(e,t){cI(e,t),(e=e.alternate)&&cI(e,t)}function vB(){return null}var pM=typeof reportError=="function"?reportError:function(e){console.error(e)};function Ly(e){this._internalRoot=e}Bm.prototype.render=Ly.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ie(409));jm(e,t,null,null)};Bm.prototype.unmount=Ly.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;zs(function(){jm(null,e,null,null)}),t[Zo]=null}};function Bm(e){this._internalRoot=e}Bm.prototype.unstable_scheduleHydration=function(e){if(e){var t=Hk();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Sa.length&&t!==0&&t<Sa[r].priority;r++);Sa.splice(r,0,e),r===0&&zk(e)}};function My(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Gm(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function lI(){}function SB(e,t,r,n,i){if(i){if(typeof n=="function"){var o=n;n=function(){var l=Xf(a);o.call(l)}}var a=hM(t,n,e,0,null,!1,!1,"",lI);return e._reactRootContainer=a,e[Zo]=a.current,Cd(e.nodeType===8?e.parentNode:e),zs(),a}for(;i=e.lastChild;)e.removeChild(i);if(typeof n=="function"){var s=n;n=function(){var l=Xf(c);s.call(l)}}var c=Dy(e,0,!1,null,null,!1,!1,"",lI);return e._reactRootContainer=c,e[Zo]=c.current,Cd(e.nodeType===8?e.parentNode:e),zs(function(){jm(t,c,r,n)}),c}function Wm(e,t,r,n,i){var o=r._reactRootContainer;if(o){var a=o;if(typeof i=="function"){var s=i;i=function(){var c=Xf(a);s.call(c)}}jm(t,a,e,i)}else a=SB(r,t,e,i,n);return Xf(a)}Gk=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Pu(t.pendingLanes);r!==0&&(ey(t,r|1),Pn(t,mr()),!(ct&6)&&(yl=mr()+500,ts()))}break;case 13:zs(function(){var n=ea(e,1);if(n!==null){var i=pn();Yi(n,e,1,i)}}),ky(e,1)}};ty=function(e){if(e.tag===13){var t=ea(e,134217728);if(t!==null){var r=pn();Yi(t,e,134217728,r)}ky(e,134217728)}};Wk=function(e){if(e.tag===13){var t=ja(e),r=ea(e,t);if(r!==null){var n=pn();Yi(r,e,t,n)}ky(e,t)}};Hk=function(){return At};Kk=function(e,t){var r=At;try{return At=e,t()}finally{At=r}};Wv=function(e,t,r){switch(t){case"input":if(Uv(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=km(n);if(!i)throw Error(ie(90));yk(n),Uv(n,i)}}}break;case"textarea":Ck(e,r);break;case"select":t=r.value,t!=null&&el(e,!!r.multiple,t,!1)}};Pk=by;Dk=zs;var TB={usingClientEntryPoint:!1,Events:[lh,Uc,km,Ok,Nk,by]},uu={findFiberByHostInstance:Cs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yB={bundleType:uu.bundleType,version:uu.version,rendererPackageName:uu.rendererPackageName,rendererConfig:uu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:na.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Mk(e),e===null?null:e.stateNode},findFiberByHostInstance:uu.findFiberByHostInstance||vB,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hh.isDisabled&&Hh.supportsFiber)try{Om=Hh.inject(yB),go=Hh}catch{}}qn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TB;qn.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!My(t))throw Error(ie(200));return gB(e,t,null,r)};qn.createRoot=function(e,t){if(!My(e))throw Error(ie(299));var r=!1,n="",i=pM;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=Dy(e,1,!1,null,null,r,!1,n,i),e[Zo]=t.current,Cd(e.nodeType===8?e.parentNode:e),new Ly(t)};qn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ie(188)):(e=Object.keys(e).join(","),Error(ie(268,e)));return e=Mk(t),e=e===null?null:e.stateNode,e};qn.flushSync=function(e){return zs(e)};qn.hydrate=function(e,t,r){if(!Gm(t))throw Error(ie(200));return Wm(null,e,t,!0,r)};qn.hydrateRoot=function(e,t,r){if(!My(e))throw Error(ie(405));var n=r!=null&&r.hydratedSources||null,i=!1,o="",a=pM;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),t=hM(t,null,e,1,r??null,i,!1,o,a),e[Zo]=t.current,Cd(e),n)for(e=0;e<n.length;e++)r=n[e],i=r._getVersion,i=i(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new Bm(t)};qn.render=function(e,t,r){if(!Gm(t))throw Error(ie(200));return Wm(null,e,t,!1,r)};qn.unmountComponentAtNode=function(e){if(!Gm(e))throw Error(ie(40));return e._reactRootContainer?(zs(function(){Wm(null,null,e,!1,function(){e._reactRootContainer=null,e[Zo]=null})}),!0):!1};qn.unstable_batchedUpdates=by;qn.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!Gm(r))throw Error(ie(200));if(e==null||e._reactInternals===void 0)throw Error(ie(38));return Wm(e,t,r,!1,n)};qn.version="18.3.1-next-f1338f8080-20240426";function fM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fM)}catch(e){console.error(e)}}fM(),fk.exports=qn;var RB=fk.exports,uI=RB;Ov.createRoot=uI.createRoot,Ov.hydrateRoot=uI.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function kd(){return kd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kd.apply(this,arguments)}var ba;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ba||(ba={}));const dI="popstate";function CB(e){e===void 0&&(e={});function t(n,i){let{pathname:o,search:a,hash:s}=n.location;return yS("",{pathname:o,search:a,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:_M(i)}return wB(t,r,null,e)}function Or(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function mM(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function IB(){return Math.random().toString(36).substr(2,8)}function hI(e,t){return{usr:e.state,key:e.key,idx:t}}function yS(e,t,r,n){return r===void 0&&(r=null),kd({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Vl(t):t,{state:r,key:t&&t.key||n||IB()})}function _M(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Vl(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function wB(e,t,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:o=!1}=n,a=i.history,s=ba.Pop,c=null,l=u();l==null&&(l=0,a.replaceState(kd({},a.state,{idx:l}),""));function u(){return(a.state||{idx:null}).idx}function d(){s=ba.Pop;let _=u(),E=_==null?null:_-l;l=_,c&&c({action:s,location:f.location,delta:E})}function h(_,E){s=ba.Push;let g=yS(f.location,_,E);l=u()+1;let T=hI(g,l),R=f.createHref(g);try{a.pushState(T,"",R)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;i.location.assign(R)}o&&c&&c({action:s,location:f.location,delta:1})}function p(_,E){s=ba.Replace;let g=yS(f.location,_,E);l=u();let T=hI(g,l),R=f.createHref(g);a.replaceState(T,"",R),o&&c&&c({action:s,location:f.location,delta:0})}function m(_){let E=i.location.origin!=="null"?i.location.origin:i.location.href,g=typeof _=="string"?_:_M(_);return g=g.replace(/ $/,"%20"),Or(E,"No window.location.(origin|href) available to create URL for href: "+g),new URL(g,E)}let f={get action(){return s},get location(){return e(i,a)},listen(_){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(dI,d),c=_,()=>{i.removeEventListener(dI,d),c=null}},createHref(_){return t(i,_)},createURL:m,encodeLocation(_){let E=m(_);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:h,replace:p,go(_){return a.go(_)}};return f}var pI;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(pI||(pI={}));function AB(e,t,r){return r===void 0&&(r="/"),bB(e,t,r,!1)}function bB(e,t,r,n){let i=typeof t=="string"?Vl(t):t,o=vM(i.pathname||"/",r);if(o==null)return null;let a=EM(e);OB(a);let s=null;for(let c=0;s==null&&c<a.length;++c){let l=jB(o);s=VB(a[c],l,n)}return s}function EM(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(o,a,s)=>{let c={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};c.relativePath.startsWith("/")&&(Or(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let l=xs([n,c.relativePath]),u=r.concat(c);o.children&&o.children.length>0&&(Or(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),EM(o.children,t,u,l)),!(o.path==null&&!o.index)&&t.push({path:l,score:UB(l,o.index),routesMeta:u})};return e.forEach((o,a)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))i(o,a);else for(let c of gM(o.path))i(o,a,c)}),t}function gM(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,i=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return i?[o,""]:[o];let a=gM(n.join("/")),s=[];return s.push(...a.map(c=>c===""?o:[o,c].join("/"))),i&&s.push(...a),s.map(c=>e.startsWith("/")&&c===""?"/":c)}function OB(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:xB(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const NB=/^:[\w-]+$/,PB=3,DB=2,kB=1,LB=10,MB=-2,fI=e=>e==="*";function UB(e,t){let r=e.split("/"),n=r.length;return r.some(fI)&&(n+=MB),t&&(n+=DB),r.filter(i=>!fI(i)).reduce((i,o)=>i+(NB.test(o)?PB:o===""?kB:LB),n)}function xB(e,t){return e.length===t.length&&e.slice(0,-1).every((n,i)=>n===t[i])?e[e.length-1]-t[t.length-1]:0}function VB(e,t,r){let{routesMeta:n}=e,i={},o="/",a=[];for(let s=0;s<n.length;++s){let c=n[s],l=s===n.length-1,u=o==="/"?t:t.slice(o.length)||"/",d=mI({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},u),h=c.route;if(!d&&l&&r&&!n[n.length-1].route.index&&(d=mI({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},u)),!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:xs([o,d.pathname]),pathnameBase:zB(xs([o,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(o=xs([o,d.pathnameBase]))}return a}function mI(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=FB(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:n.reduce((l,u,d)=>{let{paramName:h,isOptional:p}=u;if(h==="*"){let f=s[d]||"";a=o.slice(0,o.length-f.length).replace(/(.)\/+$/,"$1")}const m=s[d];return p&&!m?l[h]=void 0:l[h]=(m||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:a,pattern:e}}function FB(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),mM(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,c)=>(n.push({paramName:s,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function jB(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return mM(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function vM(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function BB(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:i=""}=typeof e=="string"?Vl(e):e;return{pathname:r?r.startsWith("/")?r:GB(r,t):t,search:YB(n),hash:$B(i)}}function GB(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function eE(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function WB(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function HB(e,t){let r=WB(e);return t?r.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function KB(e,t,r,n){n===void 0&&(n=!1);let i;typeof e=="string"?i=Vl(e):(i=kd({},e),Or(!i.pathname||!i.pathname.includes("?"),eE("?","pathname","search",i)),Or(!i.pathname||!i.pathname.includes("#"),eE("#","pathname","hash",i)),Or(!i.search||!i.search.includes("#"),eE("#","search","hash",i)));let o=e===""||i.pathname==="",a=o?"/":i.pathname,s;if(a==null)s=r;else{let d=t.length-1;if(!n&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),d-=1;i.pathname=h.join("/")}s=d>=0?t[d]:"/"}let c=BB(i,s),l=a&&a!=="/"&&a.endsWith("/"),u=(o||a===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(l||u)&&(c.pathname+="/"),c}const xs=e=>e.join("/").replace(/\/\/+/g,"/"),zB=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),YB=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,$B=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function qB(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const SM=["post","put","patch","delete"];new Set(SM);const XB=["get",...SM];new Set(XB);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ld(){return Ld=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ld.apply(this,arguments)}const Uy=Q.createContext(null),JB=Q.createContext(null),Hm=Q.createContext(null),Km=Q.createContext(null),Zs=Q.createContext({outlet:null,matches:[],isDataRoute:!1}),TM=Q.createContext(null);function zm(){return Q.useContext(Km)!=null}function yM(){return zm()||Or(!1),Q.useContext(Km).location}function RM(e){Q.useContext(Hm).static||Q.useLayoutEffect(e)}function CM(){let{isDataRoute:e}=Q.useContext(Zs);return e?d4():QB()}function QB(){zm()||Or(!1);let e=Q.useContext(Uy),{basename:t,future:r,navigator:n}=Q.useContext(Hm),{matches:i}=Q.useContext(Zs),{pathname:o}=yM(),a=JSON.stringify(HB(i,r.v7_relativeSplatPath)),s=Q.useRef(!1);return RM(()=>{s.current=!0}),Q.useCallback(function(l,u){if(u===void 0&&(u={}),!s.current)return;if(typeof l=="number"){n.go(l);return}let d=KB(l,JSON.parse(a),o,u.relative==="path");e==null&&t!=="/"&&(d.pathname=d.pathname==="/"?t:xs([t,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[t,n,a,o,e])}function ZB(){let{matches:e}=Q.useContext(Zs),t=e[e.length-1];return t?t.params:{}}function e4(e,t){return t4(e,t)}function t4(e,t,r,n){zm()||Or(!1);let{navigator:i}=Q.useContext(Hm),{matches:o}=Q.useContext(Zs),a=o[o.length-1],s=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let l=yM(),u;if(t){var d;let _=typeof t=="string"?Vl(t):t;c==="/"||(d=_.pathname)!=null&&d.startsWith(c)||Or(!1),u=_}else u=l;let h=u.pathname||"/",p=h;if(c!=="/"){let _=c.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(_.length).join("/")}let m=AB(e,{pathname:p}),f=a4(m&&m.map(_=>Object.assign({},_,{params:Object.assign({},s,_.params),pathname:xs([c,i.encodeLocation?i.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?c:xs([c,i.encodeLocation?i.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),o,r,n);return t&&f?Q.createElement(Km.Provider,{value:{location:Ld({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ba.Pop}},f):f}function r4(){let e=u4(),t=qB(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},t),r?Q.createElement("pre",{style:i},r):null,null)}const n4=Q.createElement(r4,null);class i4 extends Q.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?Q.createElement(Zs.Provider,{value:this.props.routeContext},Q.createElement(TM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function o4(e){let{routeContext:t,match:r,children:n}=e,i=Q.useContext(Uy);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),Q.createElement(Zs.Provider,{value:t},n)}function a4(e,t,r,n){var i;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let a=e,s=(i=r)==null?void 0:i.errors;if(s!=null){let u=a.findIndex(d=>d.route.id&&(s==null?void 0:s[d.route.id])!==void 0);u>=0||Or(!1),a=a.slice(0,Math.min(a.length,u+1))}let c=!1,l=-1;if(r&&n&&n.v7_partialHydration)for(let u=0;u<a.length;u++){let d=a[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=u),d.route.id){let{loaderData:h,errors:p}=r,m=d.route.loader&&h[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||m){c=!0,l>=0?a=a.slice(0,l+1):a=[a[0]];break}}}return a.reduceRight((u,d,h)=>{let p,m=!1,f=null,_=null;r&&(p=s&&d.route.id?s[d.route.id]:void 0,f=d.route.errorElement||n4,c&&(l<0&&h===0?(m=!0,_=null):l===h&&(m=!0,_=d.route.hydrateFallbackElement||null)));let E=t.concat(a.slice(0,h+1)),g=()=>{let T;return p?T=f:m?T=_:d.route.Component?T=Q.createElement(d.route.Component,null):d.route.element?T=d.route.element:T=u,Q.createElement(o4,{match:d,routeContext:{outlet:u,matches:E,isDataRoute:r!=null},children:T})};return r&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?Q.createElement(i4,{location:r.location,revalidation:r.revalidation,component:f,error:p,children:g(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):g()},null)}var IM=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(IM||{}),Jf=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Jf||{});function s4(e){let t=Q.useContext(Uy);return t||Or(!1),t}function c4(e){let t=Q.useContext(JB);return t||Or(!1),t}function l4(e){let t=Q.useContext(Zs);return t||Or(!1),t}function wM(e){let t=l4(),r=t.matches[t.matches.length-1];return r.route.id||Or(!1),r.route.id}function u4(){var e;let t=Q.useContext(TM),r=c4(Jf.UseRouteError),n=wM(Jf.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function d4(){let{router:e}=s4(IM.UseNavigateStable),t=wM(Jf.UseNavigateStable),r=Q.useRef(!1);return RM(()=>{r.current=!0}),Q.useCallback(function(i,o){o===void 0&&(o={}),r.current&&(typeof i=="number"?e.navigate(i):e.navigate(i,Ld({fromRouteId:t},o)))},[e,t])}function RS(e){Or(!1)}function h4(e){let{basename:t="/",children:r=null,location:n,navigationType:i=ba.Pop,navigator:o,static:a=!1,future:s}=e;zm()&&Or(!1);let c=t.replace(/^\/*/,"/"),l=Q.useMemo(()=>({basename:c,navigator:o,static:a,future:Ld({v7_relativeSplatPath:!1},s)}),[c,s,o,a]);typeof n=="string"&&(n=Vl(n));let{pathname:u="/",search:d="",hash:h="",state:p=null,key:m="default"}=n,f=Q.useMemo(()=>{let _=vM(u,c);return _==null?null:{location:{pathname:_,search:d,hash:h,state:p,key:m},navigationType:i}},[c,u,d,h,p,m,i]);return f==null?null:Q.createElement(Hm.Provider,{value:l},Q.createElement(Km.Provider,{children:r,value:f}))}function p4(e){let{children:t,location:r}=e;return e4(CS(t),r)}new Promise(()=>{});function CS(e,t){t===void 0&&(t=[]);let r=[];return Q.Children.forEach(e,(n,i)=>{if(!Q.isValidElement(n))return;let o=[...t,i];if(n.type===Q.Fragment){r.push.apply(r,CS(n.props.children,o));return}n.type!==RS&&Or(!1),!n.props.index||!n.props.children||Or(!1);let a={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=CS(n.props.children,o)),r.push(a)}),r}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const f4="6";try{window.__reactRouterVersion=f4}catch{}const m4="startTransition",_I=hj[m4];function _4(e){let{basename:t,children:r,future:n,window:i}=e,o=Q.useRef();o.current==null&&(o.current=CB({window:i,v5Compat:!0}));let a=o.current,[s,c]=Q.useState({action:a.action,location:a.location}),{v7_startTransition:l}=n||{},u=Q.useCallback(d=>{l&&_I?_I(()=>c(d)):c(d)},[c,l]);return Q.useLayoutEffect(()=>a.listen(u),[a,u]),Q.createElement(h4,{basename:t,children:r,location:s.location,navigationType:s.action,navigator:a,future:n})}var EI;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(EI||(EI={}));var gI;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(gI||(gI={}));const E4="/zerofk/assets/logo-CREJmf-S.svg",g4=({connectToVideo:e})=>{const[t,r]=Q.useState(""),[n,i]=Q.useState(""),[o,a]=Q.useState(""),s=c=>{const l=t.trim(),u=n.trim();if(l===""&&u===""){c.preventDefault(),a("App ID and Channel name can't be empty."),r("");return}e(l,u)};return fe.jsxs("form",{onSubmit:s,children:[fe.jsx("img",{src:E4,className:"logo",alt:"logo"}),fe.jsxs("div",{className:"card",children:[fe.jsx("input",{id:"appId",type:"text",placeholder:"App ID",value:n,onChange:c=>{i(c.target.value),a("")}}),fe.jsx("input",{id:"channelName",type:"text",placeholder:"Channel Name",value:t,onChange:c=>{r(c.target.value),a("")}}),fe.jsx("button",{children:"Connect"}),o&&fe.jsxs("p",{style:{color:"red"},children:[" ",o," "]})]})]})};/**
 * @license agora-rtc-react
 * @version 2.3.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */function v4(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(n){if(n!=="default"&&!(n in e)){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}})}),Object.freeze(e)}var al=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Mt=function(e){try{return!!e()}catch{return!0}},Ym=!Mt(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),AM=Ym,bM=Function.prototype,IS=bM.call,S4=AM&&bM.bind.bind(IS,IS),Dt=AM?S4:function(e){return function(){return IS.apply(e,arguments)}},Br=Dt({}.isPrototypeOf),Kh=function(e){return e&&e.Math==Math&&e},ur=Kh(typeof globalThis=="object"&&globalThis)||Kh(typeof window=="object"&&window)||Kh(typeof self=="object"&&self)||Kh(typeof al=="object"&&al)||function(){return this}()||al||Function("return this")(),T4=Ym,OM=Function.prototype,vI=OM.apply,SI=OM.call,xy=typeof Reflect=="object"&&Reflect.apply||(T4?SI.bind(vI):function(){return SI.apply(vI,arguments)}),NM=Dt,y4=NM({}.toString),R4=NM("".slice),Io=function(e){return R4(y4(e),8,-1)},C4=Io,I4=Dt,Md=function(e){if(C4(e)==="Function")return I4(e)},tE=typeof document=="object"&&document.all,$m={all:tE,IS_HTMLDDA:tE===void 0&&tE!==void 0},w4=$m.all,dr=$m.IS_HTMLDDA?function(e){return typeof e=="function"||e===w4}:function(e){return typeof e=="function"},dh={},Jn=!Mt(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),A4=Ym,zh=Function.prototype.call,hr=A4?zh.bind(zh):function(){return zh.apply(zh,arguments)},qm={},PM={}.propertyIsEnumerable,DM=Object.getOwnPropertyDescriptor,b4=DM&&!PM.call({1:2},1);qm.f=b4?function(e){var t=DM(this,e);return!!t&&t.enumerable}:PM;var aa,Zp,rs=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},O4=Mt,N4=Io,rE=Object,P4=Dt("".split),Xm=O4(function(){return!rE("z").propertyIsEnumerable(0)})?function(e){return N4(e)=="String"?P4(e,""):rE(e)}:rE,Fl=function(e){return e==null},D4=Fl,k4=TypeError,jl=function(e){if(D4(e))throw k4("Can't call method on "+e);return e},L4=Xm,M4=jl,ns=function(e){return L4(M4(e))},TI=dr,U4=$m.all,kn=$m.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:TI(e)||e===U4}:function(e){return typeof e=="object"?e!==null:TI(e)},Xi={},nE=Xi,iE=ur,x4=dr,yI=function(e){return x4(e)?e:void 0},_n=function(e,t){return arguments.length<2?yI(nE[e])||yI(iE[e]):nE[e]&&nE[e][t]||iE[e]&&iE[e][t]},ec=typeof navigator<"u"&&String(navigator.userAgent)||"",kM=ur,oE=ec,RI=kM.process,CI=kM.Deno,II=RI&&RI.versions||CI&&CI.version,wI=II&&II.v8;wI&&(Zp=(aa=wI.split("."))[0]>0&&aa[0]<4?1:+(aa[0]+aa[1])),!Zp&&oE&&(!(aa=oE.match(/Edge\/(\d+)/))||aa[1]>=74)&&(aa=oE.match(/Chrome\/(\d+)/))&&(Zp=+aa[1]);var Ys=Zp,AI=Ys,V4=Mt,F4=ur.String,Bl=!!Object.getOwnPropertySymbols&&!V4(function(){var e=Symbol();return!F4(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&AI&&AI<41}),LM=Bl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",j4=_n,B4=dr,G4=Br,W4=Object,hh=LM?function(e){return typeof e=="symbol"}:function(e){var t=j4("Symbol");return B4(t)&&G4(t.prototype,W4(e))},H4=String,Gl=function(e){try{return H4(e)}catch{return"Object"}},K4=dr,z4=Gl,Y4=TypeError,Ii=function(e){if(K4(e))return e;throw Y4(z4(e)+" is not a function")},$4=Ii,q4=Fl,Jm=function(e,t){var r=e[t];return q4(r)?void 0:$4(r)},bI=hr,OI=dr,NI=kn,X4=TypeError,MM={exports:{}},PI=ur,J4=Object.defineProperty,Q4=function(e,t){try{J4(PI,e,{value:t,configurable:!0,writable:!0})}catch{PI[e]=t}return t},DI="__core-js_shared__",Vy=ur[DI]||Q4(DI,{}),kI=Vy;(MM.exports=function(e,t){return kI[e]||(kI[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Wl=MM.exports,Z4=jl,e5=Object,wo=function(e){return e5(Z4(e))},t5=wo,r5=Dt({}.hasOwnProperty),Er=Object.hasOwn||function(e,t){return r5(t5(e),t)},n5=Dt,i5=0,o5=Math.random(),a5=n5(1 .toString),Fy=function(e){return"Symbol("+(e===void 0?"":e)+")_"+a5(++i5+o5,36)},s5=Wl,LI=Er,c5=Fy,l5=Bl,u5=LM,Wc=ur.Symbol,aE=s5("wks"),d5=u5?Wc.for||Wc:Wc&&Wc.withoutSetter||c5,bt=function(e){return LI(aE,e)||(aE[e]=l5&&LI(Wc,e)?Wc[e]:d5("Symbol."+e)),aE[e]},h5=hr,MI=kn,UI=hh,p5=Jm,f5=function(e,t){var r,n;if(OI(r=e.toString)&&!NI(n=bI(r,e))||OI(r=e.valueOf)&&!NI(n=bI(r,e))||t!=="string")return n;throw X4("Can't convert object to primitive value")},m5=TypeError,_5=bt("toPrimitive"),E5=function(e,t){if(!MI(e)||UI(e))return e;var r,n=p5(e,_5);if(n){if(r=h5(n,e,t),!MI(r)||UI(r))return r;throw m5("Can't convert object to primitive value")}return f5(e,t)},g5=hh,Qm=function(e){var t=E5(e,"string");return g5(t)?t:t+""},xI=kn,wS=ur.document,v5=xI(wS)&&xI(wS.createElement),jy=function(e){return v5?wS.createElement(e):{}},S5=jy,UM=!Jn&&!Mt(function(){return Object.defineProperty(S5("div"),"a",{get:function(){return 7}}).a!=7}),T5=Jn,y5=hr,R5=qm,C5=rs,I5=ns,w5=Qm,A5=Er,b5=UM,VI=Object.getOwnPropertyDescriptor;dh.f=T5?VI:function(e,t){if(e=I5(e),t=w5(t),b5)try{return VI(e,t)}catch{}if(A5(e,t))return C5(!y5(R5.f,e,t),e[t])};var O5=Mt,N5=dr,P5=/#|\.prototype\./,ph=function(e,t){var r=k5[D5(e)];return r==M5||r!=L5&&(N5(t)?O5(t):!!t)},D5=ph.normalize=function(e){return String(e).replace(P5,".").toLowerCase()},k5=ph.data={},L5=ph.NATIVE="N",M5=ph.POLYFILL="P",xM=ph,U5=Ii,x5=Ym,V5=Md(Md.bind),is=function(e,t){return U5(e),t===void 0?e:x5?V5(e,t):function(){return e.apply(t,arguments)}},wi={},VM=Jn&&Mt(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),F5=kn,j5=String,B5=TypeError,nn=function(e){if(F5(e))return e;throw B5(j5(e)+" is not an object")},G5=Jn,W5=UM,H5=VM,Yh=nn,FI=Qm,K5=TypeError,sE=Object.defineProperty,z5=Object.getOwnPropertyDescriptor,cE="enumerable",lE="configurable",uE="writable";wi.f=G5?H5?function(e,t,r){if(Yh(e),t=FI(t),Yh(r),typeof e=="function"&&t==="prototype"&&"value"in r&&uE in r&&!r[uE]){var n=z5(e,t);n&&n[uE]&&(e[t]=r.value,r={configurable:lE in r?r[lE]:n[lE],enumerable:cE in r?r[cE]:n[cE],writable:!1})}return sE(e,t,r)}:sE:function(e,t,r){if(Yh(e),t=FI(t),Yh(r),W5)try{return sE(e,t,r)}catch{}if("get"in r||"set"in r)throw K5("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var Y5=wi,$5=rs,os=Jn?function(e,t,r){return Y5.f(e,t,$5(1,r))}:function(e,t,r){return e[t]=r,e},$h=ur,q5=xy,X5=Md,J5=dr,Q5=dh.f,Z5=xM,cc=Xi,e6=is,lc=os,jI=Er,t6=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return q5(e,this,arguments)};return t.prototype=e.prototype,t},ze=function(e,t){var r,n,i,o,a,s,c,l,u,d=e.target,h=e.global,p=e.stat,m=e.proto,f=h?$h:p?$h[d]:($h[d]||{}).prototype,_=h?cc:cc[d]||lc(cc,d,{})[d],E=_.prototype;for(o in t)n=!(r=Z5(h?o:d+(p?".":"#")+o,e.forced))&&f&&jI(f,o),s=_[o],n&&(c=e.dontCallGetSet?(u=Q5(f,o))&&u.value:f[o]),a=n&&c?c:t[o],n&&typeof s==typeof a||(l=e.bind&&n?e6(a,$h):e.wrap&&n?t6(a):m&&J5(a)?X5(a):a,(e.sham||a&&a.sham||s&&s.sham)&&lc(l,"sham",!0),lc(_,o,l),m&&(jI(cc,i=d+"Prototype")||lc(cc,i,{}),lc(cc[i],o,a),e.real&&E&&(r||!E[o])&&lc(E,o,a)))},r6=Math.ceil,n6=Math.floor,i6=Math.trunc||function(e){var t=+e;return(t>0?n6:r6)(t)},o6=i6,By=function(e){var t=+e;return t!=t||t===0?0:o6(t)},a6=By,s6=Math.max,c6=Math.min,Gy=function(e,t){var r=a6(e);return r<0?s6(r+t,0):c6(r,t)},l6=By,u6=Math.min,FM=function(e){return e>0?u6(l6(e),9007199254740991):0},d6=FM,ia=function(e){return d6(e.length)},h6=ns,p6=Gy,f6=ia,BI=function(e){return function(t,r,n){var i,o=h6(t),a=f6(o),s=p6(n,a);if(e&&r!=r){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},Wy={includes:BI(!0),indexOf:BI(!1)},m6=Wy.includes;ze({target:"Array",proto:!0,forced:Mt(function(){return!Array(1).includes()})},{includes:function(e){return m6(this,e,arguments.length>1?arguments[1]:void 0)}});var _6=Xi,Ai=function(e){return _6[e+"Prototype"]},E6=Ai("Array").includes,g6=kn,v6=Io,S6=bt("match"),jM=function(e){var t;return g6(e)&&((t=e[S6])!==void 0?!!t:v6(e)=="RegExp")},T6=jM,y6=TypeError,BM={};BM[bt("toStringTag")]="z";var Hy=String(BM)==="[object z]",R6=Hy,C6=dr,ef=Io,I6=bt("toStringTag"),w6=Object,A6=ef(function(){return arguments}())=="Arguments",Ao=R6?ef:function(e){var t,r,n;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(i,o){try{return i[o]}catch{}}(t=w6(e),I6))=="string"?r:A6?ef(t):(n=ef(t))=="Object"&&C6(t.callee)?"Arguments":n},b6=Ao,O6=String,Qn=function(e){if(b6(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return O6(e)},N6=bt("match"),P6=ze,D6=function(e){if(T6(e))throw y6("The method doesn't accept regular expressions");return e},k6=jl,GI=Qn,L6=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[N6]=!1,"/./"[e](t)}catch{}}return!1},M6=Dt("".indexOf);P6({target:"String",proto:!0,forced:!L6("includes")},{includes:function(e){return!!~M6(GI(k6(this)),GI(D6(e)),arguments.length>1?arguments[1]:void 0)}});var U6=Ai("String").includes,WI=Br,x6=E6,V6=U6,dE=Array.prototype,hE=String.prototype,F6=function(e){var t=e.includes;return e===dE||WI(dE,e)&&t===dE.includes?x6:typeof e=="string"||e===hE||WI(hE,e)&&t===hE.includes?V6:t},q=Tt(F6),j6=Ii,B6=wo,G6=Xm,W6=ia,H6=TypeError,HI=function(e){return function(t,r,n,i){j6(r);var o=B6(t),a=G6(o),s=W6(o),c=e?s-1:0,l=e?-1:1;if(n<2)for(;;){if(c in a){i=a[c],c+=l;break}if(c+=l,e?c<0:s<=c)throw H6("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=l)c in a&&(i=r(i,a[c],c,o));return i}},K6={left:HI(!1),right:HI(!0)},z6=Mt,Zm=function(e,t){var r=[][e];return!!r&&z6(function(){r.call(null,t||function(){return 1},1)})},fh=typeof process<"u"&&Io(process)=="process",Y6=K6.left;ze({target:"Array",proto:!0,forced:!fh&&Ys>79&&Ys<83||!Zm("reduce")},{reduce:function(e){var t=arguments.length;return Y6(this,e,t,t>1?arguments[1]:void 0)}});var $6=Ai("Array").reduce,q6=Br,X6=$6,pE=Array.prototype,J6=function(e){var t=e.reduce;return e===pE||q6(pE,e)&&t===pE.reduce?X6:t},GM=J6,qi=Tt(GM),WM=!0,HM=!0;function qh(e,t,r){let n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function tc(e,t,r){if(!e.RTCPeerConnection)return;let n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(a,s){if(a!==t)return i.apply(this,arguments);let c=l=>{let u=r(l);u&&(s.handleEvent?s.handleEvent(u):s(u))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(s,c),i.apply(this,[a,c])};let o=n.removeEventListener;n.removeEventListener=function(a,s){if(a!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(s))return o.apply(this,arguments);let c=this._eventMap[t].get(s);return this._eventMap[t].delete(s),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function Q6(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(WM=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Z6(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(HM=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function KM(){if(typeof window=="object"){if(WM)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ky(e,t){HM&&console.warn(e+" is deprecated, please use "+t+" instead.")}function KI(e){return Object.prototype.toString.call(e)==="[object Object]"}function zM(e){var t;return KI(e)?qi(t=Object.keys(e)).call(t,function(r,n){let i=KI(e[n]),o=i?zM(e[n]):e[n],a=i&&!Object.keys(o).length;return o===void 0||a?r:Object.assign(r,{[n]:o})},{}):e}function AS(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?AS(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(i=>{AS(e,e.get(i),r)})}))}function zI(e,t,r){let n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;let o=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&o.push(a)}),o.forEach(a=>{e.forEach(s=>{s.type===n&&s.trackId===a.id&&AS(e,s,i)})}),i}var eG=Fy,YI=Wl("keys"),e_=function(e){return YI[e]||(YI[e]=eG(e))},tG=!Mt(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),rG=Er,nG=dr,iG=wo,oG=tG,$I=e_("IE_PROTO"),bS=Object,aG=bS.prototype,zy=oG?bS.getPrototypeOf:function(e){var t=iG(e);if(rG(t,$I))return t[$I];var r=t.constructor;return nG(r)&&t instanceof r?r.prototype:t instanceof bS?aG:null},sG=Dt,cG=Ii,lG=dr,uG=String,dG=TypeError,hG=function(e,t,r){try{return sG(cG(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},pG=nn,fG=function(e){if(typeof e=="object"||lG(e))return e;throw dG("Can't set "+uG(e)+" as a prototype")},mG=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=hG(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(n,i){return pG(n),fG(i),t?e(n,i):n.__proto__=i,n}}():void 0),t_={},r_={},fE=Er,_G=ns,EG=Wy.indexOf,gG=r_,qI=Dt([].push),YM=function(e,t){var r,n=_G(e),i=0,o=[];for(r in n)!fE(gG,r)&&fE(n,r)&&qI(o,r);for(;t.length>i;)fE(n,r=t[i++])&&(~EG(o,r)||qI(o,r));return o},Yy=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],vG=YM,SG=Yy.concat("length","prototype");t_.f=Object.getOwnPropertyNames||function(e){return vG(e,SG)};var mh={};mh.f=Object.getOwnPropertySymbols;var TG=_n,yG=t_,RG=mh,CG=nn,IG=Dt([].concat),wG=TG("Reflect","ownKeys")||function(e){var t=yG.f(CG(e)),r=RG.f;return r?IG(t,r(e)):t},XI=Er,AG=wG,bG=dh,OG=wi,$y={},NG=YM,PG=Yy,n_=Object.keys||function(e){return NG(e,PG)},DG=Jn,kG=VM,LG=wi,MG=nn,UG=ns,xG=n_;$y.f=DG&&!kG?Object.defineProperties:function(e,t){MG(e);for(var r,n=UG(t),i=xG(t),o=i.length,a=0;o>a;)LG.f(e,r=i[a++],n[r]);return e};var Xh,$M=_n("document","documentElement"),VG=nn,FG=$y,JI=Yy,jG=r_,BG=$M,GG=jy,OS="prototype",NS="script",qM=e_("IE_PROTO"),mE=function(){},XM=function(e){return"<"+NS+">"+e+"</"+NS+">"},QI=function(e){e.write(XM("")),e.close();var t=e.parentWindow.Object;return e=null,t},tf=function(){try{Xh=new ActiveXObject("htmlfile")}catch{}var e,t,r;tf=typeof document<"u"?document.domain&&Xh?QI(Xh):(t=GG("iframe"),r="java"+NS+":",t.style.display="none",BG.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(XM("document.F=Object")),e.close(),e.F):QI(Xh);for(var n=JI.length;n--;)delete tf[OS][JI[n]];return tf()};jG[qM]=!0;var _h=Object.create||function(e,t){var r;return e!==null?(mE[OS]=VG(e),r=new mE,mE[OS]=null,r[qM]=e):r=tf(),t===void 0?r:FG.f(r,t)},WG=kn,HG=os,JM=Error,KG=Dt("".replace),zG=String(JM("zxcasd").stack),QM=/\n\s*at [^:]*:[^\n]*/,YG=QM.test(zG),$G=rs,qG=!Mt(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",$G(1,7)),e.stack!==7)}),XG=os,JG=function(e,t){if(YG&&typeof e=="string"&&!JM.prepareStackTrace)for(;t--;)e=KG(e,QM,"");return e},QG=qG,ZI=Error.captureStackTrace,rc={},ZG=rc,e8=bt("iterator"),t8=Array.prototype,ZM=function(e){return e!==void 0&&(ZG.Array===e||t8[e8]===e)},r8=Ao,ew=Jm,n8=Fl,i8=rc,o8=bt("iterator"),i_=function(e){if(!n8(e))return ew(e,o8)||ew(e,"@@iterator")||i8[r8(e)]},a8=hr,s8=Ii,c8=nn,l8=Gl,u8=i_,d8=TypeError,qy=function(e,t){var r=arguments.length<2?u8(e):t;if(s8(r))return c8(a8(r,e));throw d8(l8(e)+" is not iterable")},h8=hr,tw=nn,p8=Jm,e2=function(e,t,r){var n,i;tw(e);try{if(!(n=p8(e,"return"))){if(t==="throw")throw r;return r}n=h8(n,e)}catch(o){i=!0,n=o}if(t==="throw")throw r;if(i)throw n;return tw(n),r},f8=is,m8=hr,_8=nn,E8=Gl,g8=ZM,v8=ia,rw=Br,S8=qy,T8=i_,nw=e2,y8=TypeError,rf=function(e,t){this.stopped=e,this.result=t},iw=rf.prototype,Eh=function(e,t,r){var n,i,o,a,s,c,l,u=r&&r.that,d=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),m=!(!r||!r.INTERRUPTED),f=f8(t,u),_=function(g){return n&&nw(n,"normal",g),new rf(!0,g)},E=function(g){return d?(_8(g),m?f(g[0],g[1],_):f(g[0],g[1])):m?f(g,_):f(g)};if(h)n=e.iterator;else if(p)n=e;else{if(!(i=T8(e)))throw y8(E8(e)+" is not iterable");if(g8(i)){for(o=0,a=v8(e);a>o;o++)if((s=E(e[o]))&&rw(iw,s))return s;return new rf(!1)}n=S8(e,i)}for(c=h?e.next:n.next;!(l=m8(c,n)).done;){try{s=E(l.value)}catch(g){nw(n,"throw",g)}if(typeof s=="object"&&s&&rw(iw,s))return s}return new rf(!1)},R8=Qn,C8=ze,I8=Br,w8=zy,Qf=mG,A8=function(e,t,r){for(var n=AG(t),i=OG.f,o=bG.f,a=0;a<n.length;a++){var s=n[a];XI(e,s)||r&&XI(r,s)||i(e,s,o(t,s))}},t2=_h,_E=os,EE=rs,b8=function(e,t){WG(t)&&"cause"in t&&HG(e,"cause",t.cause)},O8=function(e,t,r,n){QG&&(ZI?ZI(e,t):XG(e,"stack",JG(r,n)))},N8=Eh,P8=function(e,t){return e===void 0?arguments.length<2?"":t:R8(e)},D8=bt("toStringTag"),Zf=Error,k8=[].push,Rl=function(e,t){var r,n=I8(gE,this);Qf?r=Qf(Zf(),n?w8(this):gE):(r=n?this:t2(gE),_E(r,D8,"Error")),t!==void 0&&_E(r,"message",P8(t)),O8(r,Rl,r.stack,1),arguments.length>2&&b8(r,arguments[2]);var i=[];return N8(e,k8,{that:i}),_E(r,"errors",i),r};Qf?Qf(Rl,Zf):A8(Rl,Zf,{name:!0});var gE=Rl.prototype=t2(Zf.prototype,{constructor:EE(1,Rl),message:EE(1,""),name:EE(1,"AggregateError")});C8({global:!0,constructor:!0,arity:2},{AggregateError:Rl});var em,td,tm,L8=dr,ow=ur.WeakMap,M8=L8(ow)&&/native code/.test(String(ow)),r2=ur,U8=kn,x8=os,vE=Er,SE=Vy,V8=e_,F8=r_,aw="Object already initialized",PS=r2.TypeError,j8=r2.WeakMap;M8||SE.state?(Pi=SE.state||(SE.state=new j8),Pi.get=Pi.get,Pi.has=Pi.has,Pi.set=Pi.set,em=function(e,t){if(Pi.has(e))throw PS(aw);return t.facade=e,Pi.set(e,t),t},td=function(e){return Pi.get(e)||{}},tm=function(e){return Pi.has(e)}):(cs=V8("state"),F8[cs]=!0,em=function(e,t){if(vE(e,cs))throw PS(aw);return t.facade=e,x8(e,cs,t),t},td=function(e){return vE(e,cs)?e[cs]:{}},tm=function(e){return vE(e,cs)});var Pi,cs,Vs,sw,cw,nc={set:em,get:td,has:tm,enforce:function(e){return tm(e)?td(e):em(e,{})},getterFor:function(e){return function(t){var r;if(!U8(t)||(r=td(t)).type!==e)throw PS("Incompatible receiver, "+e+" required");return r}}},DS=Jn,B8=Er,n2=Function.prototype,G8=DS&&Object.getOwnPropertyDescriptor,TE=B8(n2,"name"),i2={EXISTS:TE,PROPER:TE&&(function(){}).name==="something",CONFIGURABLE:TE&&(!DS||DS&&G8(n2,"name").configurable)},W8=os,as=function(e,t,r,n){return n&&n.enumerable?e[t]=r:W8(e,t,r),e},H8=Mt,K8=dr,z8=kn,Y8=_h,lw=zy,$8=as,kS=bt("iterator"),o2=!1;[].keys&&("next"in(cw=[].keys())?(sw=lw(lw(cw)))!==Object.prototype&&(Vs=sw):o2=!0);var q8=!z8(Vs)||H8(function(){var e={};return Vs[kS].call(e)!==e});K8((Vs=q8?{}:Y8(Vs))[kS])||$8(Vs,kS,function(){return this});var a2={IteratorPrototype:Vs,BUGGY_SAFARI_ITERATORS:o2},X8=Ao,J8=Hy?{}.toString:function(){return"[object "+X8(this)+"]"},Q8=Hy,Z8=wi.f,eW=os,tW=Er,rW=J8,uw=bt("toStringTag"),ss=function(e,t,r,n){if(e){var i=r?e:e.prototype;tW(i,uw)||Z8(i,uw,{configurable:!0,value:t}),n&&!Q8&&eW(i,"toString",rW)}},nW=a2.IteratorPrototype,iW=_h,oW=rs,aW=ss,sW=rc,cW=function(){return this},Xy=function(e,t,r,n){var i=t+" Iterator";return e.prototype=iW(nW,{next:oW(+!n,r)}),aW(e,i,!1,!0),sW[i]=cW,e},lW=ze,uW=hr,dW=i2,hW=Xy,pW=zy,fW=ss,dw=as,hw=rc,mW=a2,_W=dW.PROPER,Jh=mW.BUGGY_SAFARI_ITERATORS,yE=bt("iterator"),pw="keys",Qh="values",fw="entries",EW=function(){return this},s2=function(e,t,r,n,i,o,a){hW(r,t,n);var s,c,l,u=function(E){if(E===i&&f)return f;if(!Jh&&E in p)return p[E];switch(E){case pw:case Qh:case fw:return function(){return new r(this,E)}}return function(){return new r(this)}},d=t+" Iterator",h=!1,p=e.prototype,m=p[yE]||p["@@iterator"]||i&&p[i],f=!Jh&&m||u(i),_=t=="Array"&&p.entries||m;if(_&&(s=pW(_.call(new e)))!==Object.prototype&&s.next&&(fW(s,d,!0,!0),hw[d]=EW),_W&&i==Qh&&m&&m.name!==Qh&&(h=!0,f=function(){return uW(m,this)}),i)if(c={values:u(Qh),keys:o?f:u(pw),entries:u(fw)},a)for(l in c)(Jh||h||!(l in p))&&dw(p,l,c[l]);else lW({target:t,proto:!0,forced:Jh||h},c);return a&&p[yE]!==f&&dw(p,yE,f,{name:i}),hw[t]=f,c},Jy=function(e,t){return{value:e,done:t}},gW=ns,mw=rc,c2=nc;wi.f;var vW=s2,_w=Jy,l2="Array Iterator",SW=c2.set,TW=c2.getterFor(l2);vW(Array,"Array",function(e,t){SW(this,{type:l2,target:gW(e),index:0,kind:t})},function(){var e=TW(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,_w(void 0,!0)):_w(r=="keys"?n:r=="values"?t[n]:[n,t[n]],!1)},"values"),mw.Arguments=mw.Array;var yW=wi,o_=function(e,t,r){return yW.f(e,t,r)},RW=_n,CW=o_,IW=Jn,Ew=bt("species"),wW=Br,AW=TypeError,Qy=function(e,t){if(wW(t,e))return e;throw AW("Incorrect invocation")},bW=dr,LS=Vy,OW=Dt(Function.toString);bW(LS.inspectSource)||(LS.inspectSource=function(e){return OW(e)});var u2=LS.inspectSource,NW=Dt,PW=Mt,d2=dr,DW=Ao,kW=u2,h2=function(){},LW=[],p2=_n("Reflect","construct"),Zy=/^\s*(?:class|function)\b/,MW=NW(Zy.exec),UW=!Zy.exec(h2),du=function(e){if(!d2(e))return!1;try{return p2(h2,LW,e),!0}catch{return!1}},f2=function(e){if(!d2(e))return!1;switch(DW(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return UW||!!MW(Zy,kW(e))}catch{return!0}};f2.sham=!0;var Ud,uc,gw,RE,a_=!p2||PW(function(){var e;return du(du.call)||!du(Object)||!du(function(){e=!0})||e})?f2:du,xW=a_,VW=Gl,FW=TypeError,vw=nn,jW=function(e){if(xW(e))return e;throw FW(VW(e)+" is not a constructor")},BW=Fl,GW=bt("species"),eR=function(e,t){var r,n=vw(e).constructor;return n===void 0||BW(r=vw(n)[GW])?t:jW(r)},tR=Dt([].slice),WW=TypeError,s_=function(e,t){if(e<t)throw WW("Not enough arguments");return e},m2=/(?:ipad|iphone|ipod).*applewebkit/i.test(ec),Hn=ur,HW=xy,KW=is,Sw=dr,zW=Er,_2=Mt,Tw=$M,YW=tR,yw=jy,$W=s_,qW=m2,XW=fh,MS=Hn.setImmediate,US=Hn.clearImmediate,JW=Hn.process,CE=Hn.Dispatch,QW=Hn.Function,Rw=Hn.MessageChannel,ZW=Hn.String,IE=0,rd={},Cw="onreadystatechange";_2(function(){Ud=Hn.location});var rR=function(e){if(zW(rd,e)){var t=rd[e];delete rd[e],t()}},wE=function(e){return function(){rR(e)}},Iw=function(e){rR(e.data)},ww=function(e){Hn.postMessage(ZW(e),Ud.protocol+"//"+Ud.host)};MS&&US||(MS=function(e){$W(arguments.length,1);var t=Sw(e)?e:QW(e),r=YW(arguments,1);return rd[++IE]=function(){HW(t,void 0,r)},uc(IE),IE},US=function(e){delete rd[e]},XW?uc=function(e){JW.nextTick(wE(e))}:CE&&CE.now?uc=function(e){CE.now(wE(e))}:Rw&&!qW?(RE=(gw=new Rw).port2,gw.port1.onmessage=Iw,uc=KW(RE.postMessage,RE)):Hn.addEventListener&&Sw(Hn.postMessage)&&!Hn.importScripts&&Ud&&Ud.protocol!=="file:"&&!_2(ww)?(uc=ww,Hn.addEventListener("message",Iw,!1)):uc=Cw in yw("script")?function(e){Tw.appendChild(yw("script"))[Cw]=function(){Tw.removeChild(this),rR(e)}}:function(e){setTimeout(wE(e),0)});var E2={set:MS,clear:US},g2=function(){this.head=null,this.tail=null};g2.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var dc,AE,bE,OE,Aw,v2=g2,eH=/ipad|iphone|ipod/i.test(ec)&&typeof Pebble<"u",tH=/web0s(?!.*chrome)/i.test(ec),$s=ur,bw=is,rH=dh.f,NE=E2.set,nH=v2,iH=m2,oH=eH,aH=tH,PE=fh,Ow=$s.MutationObserver||$s.WebKitMutationObserver,Nw=$s.document,Pw=$s.process,Zh=$s.Promise,Dw=rH($s,"queueMicrotask"),xS=Dw&&Dw.value;xS||(hu=new nH,pu=function(){var e,t;for(PE&&(e=Pw.domain)&&e.exit();t=hu.get();)try{t()}catch(r){throw hu.head&&dc(),r}e&&e.enter()},iH||PE||aH||!Ow||!Nw?!oH&&Zh&&Zh.resolve?((OE=Zh.resolve(void 0)).constructor=Zh,Aw=bw(OE.then,OE),dc=function(){Aw(pu)}):PE?dc=function(){Pw.nextTick(pu)}:(NE=bw(NE,$s),dc=function(){NE(pu)}):(AE=!0,bE=Nw.createTextNode(""),new Ow(pu).observe(bE,{characterData:!0}),dc=function(){bE.data=AE=!AE}),xS=function(e){hu.head||dc(),hu.add(e)});var hu,pu,sH=xS,Hl=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},qs=ur.Promise,S2=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",cH=!S2&&!fh&&typeof window=="object"&&typeof document=="object",lH=ur,nd=qs,uH=dr,dH=xM,hH=u2,pH=bt,fH=cH,mH=S2,DE=Ys,kw=nd&&nd.prototype,_H=pH("species"),T2=!1,y2=uH(lH.PromiseRejectionEvent),EH=dH("Promise",function(){var e=hH(nd),t=e!==String(nd);if(!t&&DE===66||!kw.catch||!kw.finally)return!0;if(!DE||DE<51||!/native code/.test(e)){var r=new nd(function(i){i(1)}),n=function(i){i(function(){},function(){})};if((r.constructor={})[_H]=n,!(T2=r.then(function(){})instanceof n))return!0}return!t&&(fH||mH)&&!y2}),gh={CONSTRUCTOR:EH,REJECTION_EVENT:y2,SUBCLASSING:T2},bo={},Lw=Ii,gH=TypeError,vH=function(e){var t,r;this.promise=new e(function(n,i){if(t!==void 0||r!==void 0)throw gH("Bad Promise constructor");t=n,r=i}),this.resolve=Lw(t),this.reject=Lw(r)};bo.f=function(e){return new vH(e)};var kE,Mw,SH=ze,rm=fh,Xa=ur,vh=hr,TH=as,yH=ss,RH=function(e){var t=RW(e);IW&&t&&!t[Ew]&&CW(t,Ew,{configurable:!0,get:function(){return this}})},CH=Ii,VS=dr,IH=kn,wH=Qy,AH=eR,R2=E2.set,nR=sH,bH=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},OH=Hl,NH=v2,C2=nc,FS=qs,I2=gh,w2=bo,nf="Promise",Uw=I2.CONSTRUCTOR,PH=I2.REJECTION_EVENT,LE=C2.getterFor(nf),DH=C2.set,kH=FS&&FS.prototype,fu=FS,ME=kH,A2=Xa.TypeError,jS=Xa.document,iR=Xa.process,BS=w2.f,LH=BS,MH=!!(jS&&jS.createEvent&&Xa.dispatchEvent),b2="unhandledrejection",O2=function(e){var t;return!(!IH(e)||!VS(t=e.then))&&t},N2=function(e,t){var r,n,i,o=t.value,a=t.state==1,s=a?e.ok:e.fail,c=e.resolve,l=e.reject,u=e.domain;try{s?(a||(t.rejection===2&&xH(t),t.rejection=1),s===!0?r=o:(u&&u.enter(),r=s(o),u&&(u.exit(),i=!0)),r===e.promise?l(A2("Promise-chain cycle")):(n=O2(r))?vh(n,r,c,l):c(r)):l(o)}catch(d){u&&!i&&u.exit(),l(d)}},P2=function(e,t){e.notified||(e.notified=!0,nR(function(){for(var r,n=e.reactions;r=n.get();)N2(r,e);e.notified=!1,t&&!e.rejection&&UH(e)}))},D2=function(e,t,r){var n,i;MH?((n=jS.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),Xa.dispatchEvent(n)):n={promise:t,reason:r},!PH&&(i=Xa["on"+e])?i(n):e===b2&&bH("Unhandled promise rejection",r)},UH=function(e){vh(R2,Xa,function(){var t,r=e.facade,n=e.value;if(xw(e)&&(t=OH(function(){rm?iR.emit("unhandledRejection",n,r):D2(b2,r,n)}),e.rejection=rm||xw(e)?2:1,t.error))throw t.value})},xw=function(e){return e.rejection!==1&&!e.parent},xH=function(e){vh(R2,Xa,function(){var t=e.facade;rm?iR.emit("rejectionHandled",t):D2("rejectionhandled",t,e.value)})},Hc=function(e,t,r){return function(n){e(t,n,r)}},sl=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,P2(e,!0))},GS=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw A2("Promise can't be resolved itself");var n=O2(t);n?nR(function(){var i={done:!1};try{vh(n,t,Hc(GS,i,e),Hc(sl,i,e))}catch(o){sl(i,o,e)}}):(e.value=t,e.state=1,P2(e,!1))}catch(i){sl({done:!1},i,e)}}};Uw&&(ME=(fu=function(e){wH(this,ME),CH(e),vh(kE,this);var t=LE(this);try{e(Hc(GS,t),Hc(sl,t))}catch(r){sl(t,r)}}).prototype,(kE=function(e){DH(this,{type:nf,done:!1,notified:!1,parent:!1,reactions:new NH,rejection:!1,state:0,value:void 0})}).prototype=TH(ME,"then",function(e,t){var r=LE(this),n=BS(AH(this,fu));return r.parent=!0,n.ok=!VS(e)||e,n.fail=VS(t)&&t,n.domain=rm?iR.domain:void 0,r.state==0?r.reactions.add(n):nR(function(){N2(n,r)}),n.promise}),Mw=function(){var e=new kE,t=LE(e);this.promise=e,this.resolve=Hc(GS,t),this.reject=Hc(sl,t)},w2.f=BS=function(e){return e===fu||e===void 0?new Mw(e):LH(e)}),SH({global:!0,constructor:!0,wrap:!0,forced:Uw},{Promise:fu}),yH(fu,nf,!1,!0),RH(nf);var k2=bt("iterator"),L2=!1;try{Vw=0,UE={next:function(){return{done:!!Vw++}},return:function(){L2=!0}},UE[k2]=function(){return this},Array.from(UE,function(){throw 2})}catch{}var Vw,UE,VH=qs,FH=function(e,t){if(!L2)return!1;var r=!1;try{var n={};n[k2]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch{}return r},c_=gh.CONSTRUCTOR||!FH(function(e){VH.all(e).then(void 0,function(){})}),jH=hr,BH=Ii,GH=bo,WH=Hl,HH=Eh;ze({target:"Promise",stat:!0,forced:c_},{all:function(e){var t=this,r=GH.f(t),n=r.resolve,i=r.reject,o=WH(function(){var a=BH(t.resolve),s=[],c=0,l=1;HH(e,function(u){var d=c++,h=!1;l++,jH(a,t,u).then(function(p){h||(h=!0,s[d]=p,--l||n(s))},i)}),--l||n(s)});return o.error&&i(o.value),r.promise}});var KH=ze,zH=gh.CONSTRUCTOR;qs&&qs.prototype,KH({target:"Promise",proto:!0,forced:zH,real:!0},{catch:function(e){return this.then(void 0,e)}});var YH=hr,$H=Ii,qH=bo,XH=Hl,JH=Eh;ze({target:"Promise",stat:!0,forced:c_},{race:function(e){var t=this,r=qH.f(t),n=r.reject,i=XH(function(){var o=$H(t.resolve);JH(e,function(a){YH(o,t,a).then(r.resolve,n)})});return i.error&&n(i.value),r.promise}});var QH=hr,ZH=bo;ze({target:"Promise",stat:!0,forced:gh.CONSTRUCTOR},{reject:function(e){var t=ZH.f(this);return QH(t.reject,void 0,e),t.promise}});var e9=nn,t9=kn,r9=bo,M2=function(e,t){if(e9(e),t9(t)&&t.constructor===e)return t;var r=r9.f(e);return(0,r.resolve)(t),r.promise},n9=ze,i9=qs,o9=gh.CONSTRUCTOR,a9=M2,s9=_n("Promise"),c9=!o9;n9({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return a9(c9&&this===s9?i9:this,e)}});var l9=hr,u9=Ii,d9=bo,h9=Hl,p9=Eh;ze({target:"Promise",stat:!0,forced:c_},{allSettled:function(e){var t=this,r=d9.f(t),n=r.resolve,i=r.reject,o=h9(function(){var a=u9(t.resolve),s=[],c=0,l=1;p9(e,function(u){var d=c++,h=!1;l++,l9(a,t,u).then(function(p){h||(h=!0,s[d]={status:"fulfilled",value:p},--l||n(s))},function(p){h||(h=!0,s[d]={status:"rejected",reason:p},--l||n(s))})}),--l||n(s)});return o.error&&i(o.value),r.promise}});var f9=hr,m9=Ii,_9=_n,E9=bo,g9=Hl,v9=Eh,Fw="No one promise resolved";ze({target:"Promise",stat:!0,forced:c_},{any:function(e){var t=this,r=_9("AggregateError"),n=E9.f(t),i=n.resolve,o=n.reject,a=g9(function(){var s=m9(t.resolve),c=[],l=0,u=1,d=!1;v9(e,function(h){var p=l++,m=!1;u++,f9(s,t,h).then(function(f){m||d||(d=!0,i(f))},function(f){m||d||(m=!0,c[p]=f,--u||o(new r(c,Fw)))})}),--u||o(new r(c,Fw))});return a.error&&o(a.value),n.promise}});var S9=ze,WS=qs,T9=Mt,y9=_n,R9=dr,C9=eR,jw=M2,I9=WS&&WS.prototype;S9({target:"Promise",proto:!0,real:!0,forced:!!WS&&T9(function(){I9.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=C9(this,y9("Promise")),r=R9(e);return this.then(r?function(n){return jw(t,e()).then(function(){return n})}:e,r?function(n){return jw(t,e()).then(function(){throw n})}:e)}});var oR=Dt,w9=By,A9=Qn,b9=jl,O9=oR("".charAt),Bw=oR("".charCodeAt),N9=oR("".slice),Gw=function(e){return function(t,r){var n,i,o=A9(b9(t)),a=w9(r),s=o.length;return a<0||a>=s?e?"":void 0:(n=Bw(o,a))<55296||n>56319||a+1===s||(i=Bw(o,a+1))<56320||i>57343?e?O9(o,a):n:e?N9(o,a,a+2):i-56320+(n-55296<<10)+65536}},aR={codeAt:Gw(!1),charAt:Gw(!0)},P9=aR.charAt,D9=Qn,U2=nc,k9=s2,Ww=Jy,x2="String Iterator",L9=U2.set,M9=U2.getterFor(x2);k9(String,"String",function(e){L9(this,{type:x2,string:D9(e),index:0})},function(){var e,t=M9(this),r=t.string,n=t.index;return n>=r.length?Ww(void 0,!0):(e=P9(r,n),t.index+=e.length,Ww(e,!1))});var U9=Xi.Promise,x9={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},V9=ur,F9=Ao,j9=os,Hw=rc,Kw=bt("toStringTag");for(tp in x9)xE=V9[tp],ep=xE&&xE.prototype,ep&&F9(ep)!==Kw&&j9(ep,Kw,tp),Hw[tp]=Hw.Array;var xE,ep,tp,V2=U9,Y=Tt(V2),zw=KM;function F2(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let n=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;let s={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;let l=typeof a[c]=="object"?a[c]:{ideal:a[c]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);let u=function(d,h){return d?d+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(l.ideal!==void 0){s.optional=s.optional||[];let d={};typeof l.ideal=="number"?(d[u("min",c)]=l.ideal,s.optional.push(d),d={},d[u("max",c)]=l.ideal,s.optional.push(d)):(d[u("",c)]=l.ideal,s.optional.push(d))}l.exact!==void 0&&typeof l.exact!="number"?(s.mandatory=s.mandatory||{},s.mandatory[u("",c)]=l.exact):["min","max"].forEach(d=>{l[d]!==void 0&&(s.mandatory=s.mandatory||{},s.mandatory[u(d,c)]=l[d])})}),a.advanced&&(s.optional=(s.optional||[]).concat(a.advanced)),s},i=function(a,s){if(t.version>=61)return s(a);if((a=JSON.parse(JSON.stringify(a)))&&typeof a.audio=="object"){let c=function(l,u,d){u in l&&!(d in l)&&(l[d]=l[u],delete l[u])};c((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=n(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});let l=t.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||l)){let u;if(delete a.video.facingMode,c.exact==="environment"||c.ideal==="environment"?u=["back","rear"]:c.exact!=="user"&&c.ideal!=="user"||(u=["front"]),u)return r.mediaDevices.enumerateDevices().then(d=>{let h=(d=d.filter(p=>p.kind==="videoinput")).find(p=>u.some(m=>{var f;return q(f=p.label.toLowerCase()).call(f,m)}));return!h&&d.length&&q(u).call(u,"back")&&(h=d[d.length-1]),h&&(a.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),a.video=n(a.video),zw("chrome: "+JSON.stringify(a)),s(a)})}a.video=n(a.video)}return zw("chrome: "+JSON.stringify(a)),s(a)},o=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(a,s,c){i(a,l=>{r.webkitGetUserMedia(l,s,u=>{c&&c(o(u))})})}).bind(r),r.mediaDevices.getUserMedia){let a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(s){return i(s,c=>a(c).then(l=>{if(c.audio&&!l.getAudioTracks().length||c.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return l},l=>Y.reject(o(l))))}}}function j2(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function B2(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===n.track.id):{track:n.track};let o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===n.id):{track:n};let o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else tc(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function G2(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,s){let c=i.apply(this,arguments);return c||(c=t(this,a),this._senders.push(c)),c};let o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);let s=this._senders.indexOf(a);s!==-1&&this._senders.splice(s,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(t(this,o))})};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{let a=this._senders.find(s=>s.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function W2(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[r,n,i]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);let o=function(s){let c={};return s.result().forEach(l=>{let u={id:l.id,timestamp:l.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type};l.names().forEach(d=>{u[d]=l.stat(d)}),c[u.id]=u}),c},a=function(s){return new Map(Object.keys(s).map(c=>[c,s[c]]))};if(arguments.length>=2){let s=function(c){n(a(o(c)))};return t.apply(this,[s,r])}return new Y((s,c)=>{t.apply(this,[function(l){s(a(o(l)))},c])}).then(n,i)}}function H2(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){let i=this;return this._pc.getStats().then(o=>zI(o,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),tc(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){let n=this;return this._pc.getStats().then(i=>zI(i,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let r=arguments[0],n,i,o;return this.getSenders().forEach(a=>{a.track===r&&(n?o=!0:n=a)}),this.getReceivers().forEach(a=>(a.track===r&&(i?o=!0:i=a),a.track===r)),o||n&&i?Y.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():Y.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function K2(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let s=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(s)===-1&&this._shimmedLocalStreams[a.id].push(s):this._shimmedLocalStreams[a.id]=[a,s],s};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(l=>l.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});let a=this.getSenders();r.apply(this,arguments);let s=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(s)};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],n.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{let s=this._shimmedLocalStreams[a].indexOf(o);s!==-1&&this._shimmedLocalStreams[a].splice(s,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function z2(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return K2(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let c=r.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(l=>this._reverseStreams[l.id])};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){let l=new e.MediaStream(c.getTracks());this._streams[c.id]=l,this._reverseStreams[l.id]=c,c=l}n.apply(this,[c])};let i=e.RTCPeerConnection.prototype.removeStream;function o(c,l){let u=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{let h=c._reverseStreams[d],p=c._streams[h.id];u=u.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:l.type,sdp:u})}e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let u=[].slice.call(arguments,1);if(u.length!==1||!u[0].getTracks().find(h=>h===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(h=>h.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let d=this._streams[l.id];if(d)d.addTrack(c),Y.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let h=new e.MediaStream([c]);this._streams[l.id]=h,this._reverseStreams[h.id]=l,this.addStream(h)}return this.getSenders().find(h=>h.track===c)},["createOffer","createAnswer"].forEach(function(c){let l=e.RTCPeerConnection.prototype[c],u={[c](){let d=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[h=>{let p=o(this,h);d[0].apply(null,[p])},h=>{d[1]&&d[1].apply(null,h)},arguments[2]]):l.apply(this,arguments).then(h=>o(this,h))}};e.RTCPeerConnection.prototype[c]=u[c]});let a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(c,l){let u=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{let h=c._reverseStreams[d],p=c._streams[h.id];u=u.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:l.type,sdp:u})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};let s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let c=s.get.apply(this);return c.type===""?c:o(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let l;this._streams=this._streams||{},Object.keys(this._streams).forEach(u=>{this._streams[u].getTracks().find(d=>c.track===d)&&(l=this._streams[u])}),l&&(l.getTracks().length===1?this.removeStream(this._reverseStreams[l.id]):l.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function HS(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let n=e.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=i[r]})}function Y2(e,t){tc(e,"negotiationneeded",r=>{let n=r.target;if(!(t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")||n.signalingState==="stable")return r})}var Yw=Object.freeze({__proto__:null,fixNegotiationNeeded:Y2,shimAddTrackRemoveTrack:z2,shimAddTrackRemoveTrackWithNative:K2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(n=>{let i=r.video&&r.video.width,o=r.video&&r.video.height,a=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:a||3}},i&&(r.video.mandatory.maxWidth=i),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:G2,shimGetStats:W2,shimGetUserMedia:F2,shimMediaStream:j2,shimOnTrack:B2,shimPeerConnection:HS,shimSenderReceiverGetStats:H2});function $2(e,t){let r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(i,o,a){Ky("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(o,a)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let i=function(a,s,c){s in a&&!(c in a)&&(a[c]=a[s],delete a[s])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a.audio,"autoGainControl","mozAutoGainControl"),i(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},n&&n.prototype.getSettings){let a=n.prototype.getSettings;n.prototype.getSettings=function(){let s=a.apply(this,arguments);return i(s,"mozAutoGainControl","autoGainControl"),i(s,"mozNoiseSuppression","noiseSuppression"),s}}if(n&&n.prototype.applyConstraints){let a=n.prototype.applyConstraints;n.prototype.applyConstraints=function(s){return this.kind==="audio"&&typeof s=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s,"autoGainControl","mozAutoGainControl"),i(s,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[s])}}}}function q2(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function KS(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let o=e.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=a[i]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,o,a]=arguments;return n.apply(this,[i||null]).then(s=>{if(t.version<53&&!o)try{s.forEach(c=>{c.type=r[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;s.forEach((l,u)=>{s.set(u,Object.assign({},l,{type:r[l.type]||l.type}))})}return s}).then(o,a)}}function X2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let n=r.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Y.resolve(new Map)}}function J2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r}),tc(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Q2(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Ky("removeStream","removeTrack"),this.getSenders().forEach(r=>{var n;r.track&&q(n=t.getTracks()).call(n,r.track)&&this.removeTrack(r)})})}function Z2(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function eU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];let n=r.length>0;n&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let i=t.apply(this,arguments);if(n){let{sender:o}=i,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function tU(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function rU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Y.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function nU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Y.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var $w=Object.freeze({__proto__:null,shimAddTransceiver:eU,shimCreateAnswer:nU,shimCreateOffer:rU,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){let n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Y.reject(n)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:tU,shimGetUserMedia:$2,shimOnTrack:q2,shimPeerConnection:KS,shimRTCDataChannel:Z2,shimReceiverGetStats:J2,shimRemoveStream:Q2,shimSenderGetStats:X2});function iU(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var n;this._localStreams||(this._localStreams=[]),q(n=this._localStreams).call(n,r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach(a=>{var s;this._localStreams?q(s=this._localStreams).call(s,a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);let n=t.getTracks();this.getSenders().forEach(i=>{q(n).call(n,i.track)&&this.removeTrack(i)})})}}function oU(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),q(o=this._remoteStreams).call(o,i))return;this._remoteStreams.push(i);let a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);let o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),t.apply(r,arguments)}}}function aU(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(c,l){let u=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[u]);return l?(d.then(c,l),Y.resolve()):d},t.createAnswer=function(c,l){let u=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[u]);return l?(d.then(c,l),Y.resolve()):d};let s=function(c,l,u){let d=i.apply(this,[c]);return u?(d.then(l,u),Y.resolve()):d};t.setLocalDescription=s,s=function(c,l,u){let d=o.apply(this,[c]);return u?(d.then(l,u),Y.resolve()):d},t.setRemoteDescription=s,s=function(c,l,u){let d=a.apply(this,[c]);return u?(d.then(l,u),Y.resolve()):d},t.addIceCandidate=s}function sU(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=i=>n(cU(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,n,i){t.mediaDevices.getUserMedia(r).then(n,i)}).bind(t))}function cU(e){return e&&e.video!==void 0?Object.assign({},e,{video:zM(e.video)}):e}function lU(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,n){if(r&&r.iceServers){let i=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(Ky("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(r.iceServers[o])}r.iceServers=i}return new t(r,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function uU(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dU(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);let n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio!==!0||n||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);let i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function hU(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var qw=Object.freeze({__proto__:null,shimAudioContext:hU,shimCallbacksAPI:aU,shimConstraints:cU,shimCreateOfferLegacy:dU,shimGetUserMedia:sU,shimLocalStreamsAPI:iU,shimRTCIceServerUrls:lU,shimRemoteStreamsAPI:oU,shimTrackEventTransceiver:uU}),pU=`	
\v\f\r \u2028\u2029\uFEFF`,B9=jl,G9=Qn,zS=pU,Xw=Dt("".replace),W9=RegExp("^["+zS+"]+"),H9=RegExp("(^|[^"+zS+"])["+zS+"]+$"),VE=function(e){return function(t){var r=G9(B9(t));return 1&e&&(r=Xw(r,W9,"")),2&e&&(r=Xw(r,H9,"$1")),r}},K9={start:VE(1),end:VE(2),trim:VE(3)},z9=i2.PROPER,Y9=Mt,Jw=pU,$9=K9.trim;ze({target:"String",proto:!0,forced:function(e){return Y9(function(){return!!Jw[e]()||""[e]()!==""||z9&&Jw[e].name!==e})}("trim")},{trim:function(){return $9(this)}});var q9=Ai("String").trim,X9=Br,J9=q9,FE=String.prototype,Q9=function(e){var t=e.trim;return typeof e=="string"||e===FE||X9(FE,e)&&t===FE.trim?J9:t},Ar=Tt(Q9),fU={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(n=>n.trim())},t.splitSections=function(r){return r.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(r){let n=t.splitSections(r);return n&&n[0]},t.getMediaSections=function(r){let n=t.splitSections(r);return n.shift(),n},t.matchPrefix=function(r,n){return t.splitLines(r).filter(i=>i.indexOf(n)===0)},t.parseCandidate=function(r){let n;n=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");let i={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let o=8;o<n.length;o+=2)switch(n[o]){case"raddr":i.relatedAddress=n[o+1];break;case"rport":i.relatedPort=parseInt(n[o+1],10);break;case"tcptype":i.tcpType=n[o+1];break;case"ufrag":i.ufrag=n[o+1],i.usernameFragment=n[o+1];break;default:i[n[o]]===void 0&&(i[n[o]]=n[o+1])}return i},t.writeCandidate=function(r){let n=[];n.push(r.foundation);let i=r.component;i==="rtp"?n.push(1):i==="rtcp"?n.push(2):n.push(i),n.push(r.protocol.toUpperCase()),n.push(r.priority),n.push(r.address||r.ip),n.push(r.port);let o=r.type;return n.push("typ"),n.push(o),o!=="host"&&r.relatedAddress&&r.relatedPort&&(n.push("raddr"),n.push(r.relatedAddress),n.push("rport"),n.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(n.push("ufrag"),n.push(r.usernameFragment||r.ufrag)),"candidate:"+n.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let n=r.substring(9).split(" "),i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(r){let n=r.payloadType;r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType);let i=r.channels||r.numChannels||1;return"a=rtpmap:"+n+" "+r.name+"/"+r.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(r){let n=r.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){let n={},i,o=r.substring(r.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)i=o[a].trim().split("="),n[i[0].trim()]=i[1];return n},t.writeFmtp=function(r){let n="",i=r.payloadType;if(r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){let o=[];Object.keys(r.parameters).forEach(a=>{r.parameters[a]!==void 0?o.push(a+"="+r.parameters[a]):o.push(a)}),n+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return n},t.parseRtcpFb=function(r){let n=r.substring(r.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},t.writeRtcpFb=function(r){let n="",i=r.payloadType;return r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(o=>{n+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),n},t.parseSsrcMedia=function(r){let n=r.indexOf(" "),i={ssrc:parseInt(r.substring(7,n),10)},o=r.indexOf(":",n);return o>-1?(i.attribute=r.substring(n+1,o),i.value=r.substring(o+1)):i.attribute=r.substring(n+1),i},t.parseSsrcGroup=function(r){let n=r.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(i=>parseInt(i,10))}},t.getMid=function(r){let n=t.matchPrefix(r,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(r){let n=r.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},t.getDtlsParameters=function(r,n){return{role:"auto",fingerprints:t.matchPrefix(r+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,n){let i="a=setup:"+n+`\r
`;return r.fingerprints.forEach(o=>{i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},t.parseCryptoLine=function(r){let n=r.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;let n=r.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,n){return t.matchPrefix(r+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,n){let i=t.matchPrefix(r+n,"a=ice-ufrag:")[0],o=t.matchPrefix(r+n,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(r){let n="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(n+=`a=ice-lite\r
`),n},t.parseRtpParameters=function(r){let n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(r)[0].split(" ");n.profile=i[2];for(let a=3;a<i.length;a++){let s=i[a],c=t.matchPrefix(r,"a=rtpmap:"+s+" ")[0];if(c){let l=t.parseRtpMap(c),u=t.matchPrefix(r,"a=fmtp:"+s+" ");switch(l.parameters=u.length?t.parseFmtp(u[0]):{},l.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),n.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(l.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(a=>{n.headerExtensions.push(t.parseExtmap(a))});let o=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(a=>{o.forEach(s=>{a.rtcpFeedback.find(c=>c.type===s.type&&c.parameter===s.parameter)||a.rtcpFeedback.push(s)})}),n},t.writeRtpDescription=function(r,n){let i="";i+="m="+r+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(a=>{i+=t.writeRtpMap(a),i+=t.writeFmtp(a),i+=t.writeRtcpFb(a)});let o=0;return n.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(a=>{i+=t.writeExtmap(a)}),i},t.parseRtpEncodingParameters=function(r){let n=[],i=t.parseRtpParameters(r),o=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,s=t.matchPrefix(r,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=s.length>0&&s[0].ssrc,l,u=t.matchPrefix(r,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(p=>parseInt(p,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),n.push(p),o&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(p))}}),n.length===0&&c&&n.push({ssrc:c});let d=t.matchPrefix(r,"b=");return d.length&&(d=d[0].indexOf("b=TIAS:")===0?parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach(h=>{h.maxBitrate=d})),n},t.parseRtcpParameters=function(r){let n={},i=t.matchPrefix(r,"a=ssrc:").map(s=>t.parseSsrcMedia(s)).filter(s=>s.attribute==="cname")[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);let o=t.matchPrefix(r,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=o.length===0;let a=t.matchPrefix(r,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(r){let n="";return r.reducedSize&&(n+=`a=rtcp-rsize\r
`),r.mux&&(n+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(n+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),n},t.parseMsid=function(r){let n,i=t.matchPrefix(r,"a=msid:");if(i.length===1)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};let o=t.matchPrefix(r,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");return o.length>0?(n=o[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(r){let n=t.parseMLine(r),i=t.matchPrefix(r,"a=max-message-size:"),o;i.length>0&&(o=parseInt(i[0].substring(19),10)),isNaN(o)&&(o=65536);let a=t.matchPrefix(r,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:n.fmt,maxMessageSize:o};let s=t.matchPrefix(r,"a=sctpmap:");if(s.length>0){let c=s[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},t.writeSctpDescription=function(r,n){let i=[];return i=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,n,i){let o,a=n!==void 0?n:2;return o=r||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,n){let i=t.splitLines(r);for(let o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){let n=t.splitLines(r)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(r){let n=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;let n=t.splitLines(r);for(let i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(fU);var mU=fU.exports,cl=Tt(mU),Z9=v4({__proto__:null,default:cl},[mU]);function of(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){let n=new t(r),i=cl.parseCandidate(r.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,tc(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function YS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||tc(e,"icecandidate",t=>{if(t.candidate){let r=cl.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function af(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let r=function(s){if(!s||!s.sdp)return!1;let c=cl.splitSections(s.sdp);return c.shift(),c.some(l=>{let u=cl.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},n=function(s){let c=s.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;let l=parseInt(c[1],10);return l!=l?-1:l},i=function(s){let c=65536;return t.browser==="firefox"&&(c=t.version<57?s===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),c},o=function(s,c){let l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);let u=cl.matchPrefix(s.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substr(19),10):t.browser==="firefox"&&c!==-1&&(l=2147483637),l},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:s}=this.getConfiguration();s==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let s=n(arguments[0]),c=i(s),l=o(arguments[0],s),u;u=c===0&&l===0?Number.POSITIVE_INFINITY:c===0||l===0?Math.max(c,l):Math.min(c,l);let d={};Object.defineProperty(d,"maxMessageSize",{get:()=>u}),this._sctp=d}return a.apply(this,arguments)}}function sf(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,i){let o=n.send;n.send=function(){let a=arguments[0],s=a.length||a.size||a.byteLength;if(n.readyState==="open"&&i.sctp&&s>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(n,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let n=r.apply(this,arguments);return t(n,this),n},tc(e,"datachannel",n=>(t(n.channel,n.target),n))}function $S(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let n=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{let o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;let a=new Event("connectionstatechange",i);o.dispatchEvent(a)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function qS(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let i=n.sdp.split(`
`).filter(o=>Ar(o).call(o)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return r.apply(this,arguments)}}function cf(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Y.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Y.resolve())})}function lf(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return r.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer"}return n.sdp||n.type!=="offer"&&n.type!=="answer"?r.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>r.apply(this,[i]))})}var eK=Object.freeze({__proto__:null,removeExtmapAllowMixed:qS,shimAddIceCandidateNullOrEmpty:cf,shimConnectionState:$S,shimMaxMessageSize:af,shimParameterlessSetLocalDescription:lf,shimRTCIceCandidate:of,shimRTCIceCandidateRelayProtocol:YS,shimSendThrowTypeError:sf});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=KM,n=function(o){let a={browser:null,version:null};if(o===void 0||!o.navigator)return a.browser="Not a browser.",a;let{navigator:s}=o;if(s.mozGetUserMedia)a.browser="firefox",a.version=qh(s.userAgent,/Firefox\/(\d+)\./,1);else if(s.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)a.browser="chrome",a.version=qh(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!s.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=qh(s.userAgent,/AppleWebKit\/(\d+)\./,1),a.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return a}(e),i={browserDetails:n,commonShim:eK,extractVersion:qh,disableLog:Q6,disableWarnings:Z6,sdp:Z9};switch(n.browser){case"chrome":if(!Yw||!HS||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=Yw,cf(e,n),lf(e),F2(e,n),j2(e),HS(e,n),B2(e),z2(e,n),G2(e),W2(e),H2(e),Y2(e,n),of(e),YS(e),$S(e),af(e,n),sf(e),qS(e,n);break;case"firefox":if(!$w||!KS||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=$w,cf(e,n),lf(e),$2(e,n),KS(e,n),q2(e),Q2(e),X2(e),J2(e),Z2(e),eU(e),tU(e),rU(e),nU(e),of(e),$S(e),af(e,n),sf(e);break;case"safari":if(!qw||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=qw,cf(e,n),lf(e),lU(e),dU(e),aU(e),iU(e),oU(e),uU(e),sU(e),hU(e),of(e),YS(e),af(e,n),sf(e),qS(e,n);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var tK=Ai("Array").keys,rK=Ao,nK=Er,iK=Br,oK=tK,jE=Array.prototype,aK={DOMTokenList:!0,NodeList:!0},sK=function(e){var t=e.keys;return e===jE||iK(jE,e)&&t===jE.keys||nK(aK,rK(e))?oK:t},Tn=Tt(sK),Qw=Gl,cK=TypeError,lK=Qm,uK=wi,dK=rs,l_=function(e,t,r){var n=lK(t);n in e?uK.f(e,n,dK(0,r)):e[n]=r},Zw=Gy,hK=ia,pK=l_,fK=Array,mK=Math.max,sR=function(e,t,r){for(var n=hK(e),i=Zw(t,n),o=Zw(r===void 0?n:r,n),a=fK(mK(o-i,0)),s=0;i<o;i++,s++)pK(a,s,e[i]);return a.length=s,a},e0=sR,_K=Math.floor,XS=function(e,t){var r=e.length,n=_K(r/2);return r<8?EK(e,t):gK(e,XS(e0(e,0,n),t),XS(e0(e,n),t),t)},EK=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},gK=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e},_U=XS,t0=ec.match(/firefox\/(\d+)/i),vK=!!t0&&+t0[1],SK=/MSIE|Trident/.test(ec),r0=ec.match(/AppleWebKit\/(\d+)\./),TK=!!r0&&+r0[1],yK=ze,EU=Dt,RK=Ii,CK=wo,n0=ia,IK=function(e,t){if(!delete e[t])throw cK("Cannot delete property "+Qw(t)+" of "+Qw(e))},i0=Qn,cR=Mt,wK=_U,AK=Zm,o0=vK,bK=SK,a0=Ys,s0=TK,Oa=[],c0=EU(Oa.sort),OK=EU(Oa.push),NK=cR(function(){Oa.sort(void 0)}),PK=cR(function(){Oa.sort(null)}),DK=AK("sort"),l0=!cR(function(){if(a0)return a0<70;if(!(o0&&o0>3)){if(bK)return!0;if(s0)return s0<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)Oa.push({k:t+n,v:r})}for(Oa.sort(function(o,a){return a.v-o.v}),n=0;n<Oa.length;n++)t=Oa[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});yK({target:"Array",proto:!0,forced:NK||!PK||!DK||!l0},{sort:function(e){e!==void 0&&RK(e);var t=CK(this);if(l0)return e===void 0?c0(t):c0(t,e);var r,n,i=[],o=n0(t);for(n=0;n<o;n++)n in t&&OK(i,t[n]);for(wK(i,function(a){return function(s,c){return c===void 0?-1:s===void 0?1:a!==void 0?+a(s,c)||0:i0(s)>i0(c)?1:-1}}(e)),r=n0(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)IK(t,n++);return t}});var BE,GE,kK=Ai("Array").sort,LK=Br,MK=kK,WE=Array.prototype,UK=function(e){var t=e.sort;return e===WE||LK(WE,e)&&t===WE.sort?MK:t},Sh=Tt(UK),JS={exports:{}};BE=JS,GE=JS.exports,function(e,t){var r="function",n="undefined",i="object",o="string",a="major",s="model",c="name",l="type",u="vendor",d="version",h="architecture",p="console",m="mobile",f="tablet",_="smarttv",E="wearable",g="embedded",T="Amazon",R="Apple",w="ASUS",A="BlackBerry",N="Browser",P="Chrome",x="Firefox",G="Google",ne="Huawei",z="LG",k="Microsoft",F="Motorola",K="Opera",oe="Samsung",U="Sharp",D="Sony",W="Xiaomi",L="Zebra",S="Facebook",I="Chromium OS",O="Mac OS",B=function(ot){for(var mt={},Ye=0;Ye<ot.length;Ye++)mt[ot[Ye].toUpperCase()]=ot[Ye];return mt},se=function(ot,mt){return typeof ot===o&&ge(mt).indexOf(ge(ot))!==-1},ge=function(ot){return ot.toLowerCase()},ve=function(ot,mt){if(typeof ot===o)return ot=ot.replace(/^\s\s*/,""),typeof mt===n?ot:ot.substring(0,350)},ut=function(ot,mt){for(var Ye,Pr,ei,qe,Re,gr,ue=0;ue<mt.length&&!Re;){var Ie=mt[ue],Qe=mt[ue+1];for(Ye=Pr=0;Ye<Ie.length&&!Re&&Ie[Ye];)if(Re=Ie[Ye++].exec(ot))for(ei=0;ei<Qe.length;ei++)gr=Re[++Pr],typeof(qe=Qe[ei])===i&&qe.length>0?qe.length===2?typeof qe[1]==r?this[qe[0]]=qe[1].call(this,gr):this[qe[0]]=qe[1]:qe.length===3?typeof qe[1]!==r||qe[1].exec&&qe[1].test?this[qe[0]]=gr?gr.replace(qe[1],qe[2]):t:this[qe[0]]=gr?qe[1].call(this,gr,qe[2]):t:qe.length===4&&(this[qe[0]]=gr?qe[3].call(this,gr.replace(qe[1],qe[2])):t):this[qe]=gr||t;ue+=2}},yt=function(ot,mt){for(var Ye in mt)if(typeof mt[Ye]===i&&mt[Ye].length>0){for(var Pr=0;Pr<mt[Ye].length;Pr++)if(se(mt[Ye][Pr],ot))return Ye==="?"?t:Ye}else if(se(mt[Ye],ot))return Ye==="?"?t:Ye;return ot},Zn={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Nr={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[d,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[d,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,d],[/opios[\/ ]+([\w\.]+)/i],[d,[c,K+" Mini"]],[/\bopr\/([\w\.]+)/i],[d,[c,K]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c,d],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[d,[c,"UC"+N]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[d,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[d,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[d,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[d,[c,"IE"]],[/yabrowser\/([\w\.]+)/i],[d,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+N],d],[/\bfocus\/([\w\.]+)/i],[d,[c,x+" Focus"]],[/\bopt\/([\w\.]+)/i],[d,[c,K+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[d,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[d,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[d,[c,K+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[d,[c,"MIUI "+N]],[/fxios\/([-\w\.]+)/i],[d,[c,x]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+N]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+N],d],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],d],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,d],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,S],d],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,d],[/\bgsa\/([\w\.]+) .*safari\//i],[d,[c,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[d,[c,P+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,P+" WebView"],d],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[d,[c,"Android "+N]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,d],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[d,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[d,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[d,yt,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,d],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],d],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[d,[c,x+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,d],[/(cobalt)\/([\w\.]+)/i],[c,[d,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,ge]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",ge]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,ge]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[u,oe],[l,f]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[u,oe],[l,m]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[u,R],[l,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[u,R],[l,f]],[/(macintosh);/i],[s,[u,R]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[u,U],[l,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[u,ne],[l,f]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[s,[u,ne],[l,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[u,W],[l,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[u,W],[l,f]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[u,"OPPO"],[l,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[u,"Vivo"],[l,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[u,"Realme"],[l,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[u,F],[l,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[u,F],[l,f]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[u,z],[l,f]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[u,z],[l,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[u,"Lenovo"],[l,f]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[u,"Nokia"],[l,m]],[/(pixel c)\b/i],[s,[u,G],[l,f]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[u,G],[l,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[u,D],[l,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[u,D],[l,f]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[u,"OnePlus"],[l,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[u,T],[l,f]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[u,T],[l,m]],[/(playbook);[-\w\),; ]+(rim)/i],[s,u,[l,f]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[u,A],[l,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[u,w],[l,f]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[u,w],[l,m]],[/(nexus 9)/i],[s,[u,"HTC"],[l,f]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[s,/_/g," "],[l,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[u,"Acer"],[l,f]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[u,"Meizu"],[l,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,s,[l,m]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,s,[l,f]],[/(surface duo)/i],[s,[u,k],[l,f]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[u,"Fairphone"],[l,m]],[/(u304aa)/i],[s,[u,"AT&T"],[l,m]],[/\bsie-(\w*)/i],[s,[u,"Siemens"],[l,m]],[/\b(rct\w+) b/i],[s,[u,"RCA"],[l,f]],[/\b(venue[\d ]{2,7}) b/i],[s,[u,"Dell"],[l,f]],[/\b(q(?:mv|ta)\w+) b/i],[s,[u,"Verizon"],[l,f]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[u,"Barnes & Noble"],[l,f]],[/\b(tm\d{3}\w+) b/i],[s,[u,"NuVision"],[l,f]],[/\b(k88) b/i],[s,[u,"ZTE"],[l,f]],[/\b(nx\d{3}j) b/i],[s,[u,"ZTE"],[l,m]],[/\b(gen\d{3}) b.+49h/i],[s,[u,"Swiss"],[l,m]],[/\b(zur\d{3}) b/i],[s,[u,"Swiss"],[l,f]],[/\b((zeki)?tb.*\b) b/i],[s,[u,"Zeki"],[l,f]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],s,[l,f]],[/\b(ns-?\w{0,9}) b/i],[s,[u,"Insignia"],[l,f]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[u,"NextBook"],[l,f]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],s,[l,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],s,[l,m]],[/\b(ph-1) /i],[s,[u,"Essential"],[l,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[u,"Envizen"],[l,f]],[/\b(trio[-\w\. ]+) b/i],[s,[u,"MachSpeed"],[l,f]],[/\btu_(1491) b/i],[s,[u,"Rotor"],[l,f]],[/(shield[\w ]+) b/i],[s,[u,"Nvidia"],[l,f]],[/(sprint) (\w+)/i],[u,s,[l,m]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[u,k],[l,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[u,L],[l,f]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[u,L],[l,m]],[/smart-tv.+(samsung)/i],[u,[l,_]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[u,oe],[l,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,z],[l,_]],[/(apple) ?tv/i],[u,[s,R+" TV"],[l,_]],[/crkey/i],[[s,P+"cast"],[u,G],[l,_]],[/droid.+aft(\w)( bui|\))/i],[s,[u,T],[l,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[s,[u,U],[l,_]],[/(bravia[\w ]+)( bui|\))/i],[s,[u,D],[l,_]],[/(mitv-\w{5}) bui/i],[s,[u,W],[l,_]],[/Hbbtv.*(technisat) (.*);/i],[u,s,[l,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[u,ve],[s,ve],[l,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,s,[l,p]],[/droid.+; (shield) bui/i],[s,[u,"Nvidia"],[l,p]],[/(playstation [345portablevi]+)/i],[s,[u,D],[l,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[u,k],[l,p]],[/((pebble))app/i],[u,s,[l,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[s,[u,R],[l,E]],[/droid.+; (glass) \d/i],[s,[u,G],[l,E]],[/droid.+; (wt63?0{2,3})\)/i],[s,[u,L],[l,E]],[/(quest( 2| pro)?)/i],[s,[u,S],[l,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[l,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[l,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[l,f]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,f]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,m]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[d,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c,d],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[d,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,d],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[d,yt,Zn]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[d,yt,Zn]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[d,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,O],[d,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[d,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,d],[/\(bb(10);/i],[d,[c,A]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[d,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[d,[c,x+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[d,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[d,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[d,[c,P+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,I],d],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,d],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],d],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c,d]]},qr=function(ot,mt){if(typeof ot===i&&(mt=ot,ot=t),!(this instanceof qr))return new qr(ot,mt).getResult();var Ye=typeof e!==n&&e.navigator?e.navigator:t,Pr=ot||(Ye&&Ye.userAgent?Ye.userAgent:""),ei=Ye&&Ye.userAgentData?Ye.userAgentData:t,qe=mt?function(Re,gr){var ue={};for(var Ie in Re)gr[Ie]&&gr[Ie].length%2==0?ue[Ie]=gr[Ie].concat(Re[Ie]):ue[Ie]=Re[Ie];return ue}(Nr,mt):Nr;return this.getBrowser=function(){var Re={};return Re[c]=t,Re[d]=t,ut.call(Re,Pr,qe.browser),Re[a]=function(gr){return typeof gr===o?gr.replace(/[^\d\.]/g,"").split(".")[0]:t}(Re[d]),Ye&&Ye.brave&&typeof Ye.brave.isBrave==r&&(Re[c]="Brave"),Re},this.getCPU=function(){var Re={};return Re[h]=t,ut.call(Re,Pr,qe.cpu),Re},this.getDevice=function(){var Re={};return Re[u]=t,Re[s]=t,Re[l]=t,ut.call(Re,Pr,qe.device),!Re[l]&&ei&&ei.mobile&&(Re[l]=m),Re[s]=="Macintosh"&&Ye&&typeof Ye.standalone!==n&&Ye.maxTouchPoints&&Ye.maxTouchPoints>2&&(Re[s]="iPad",Re[l]=f),Re},this.getEngine=function(){var Re={};return Re[c]=t,Re[d]=t,ut.call(Re,Pr,qe.engine),Re},this.getOS=function(){var Re={};return Re[c]=t,Re[d]=t,ut.call(Re,Pr,qe.os),!Re[c]&&ei&&ei.platform!="Unknown"&&(Re[c]=ei.platform.replace(/chrome os/i,I).replace(/macos/i,O)),Re},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Pr},this.setUA=function(Re){return Pr=typeof Re===o&&Re.length>350?ve(Re,350):Re,this},this.setUA(Pr),this};qr.VERSION="0.7.34",qr.BROWSER=B([c,d,a]),qr.CPU=B([h]),qr.DEVICE=B([s,u,l,p,m,_,f,E,g]),qr.ENGINE=qr.OS=B([c,d]),BE.exports&&(GE=BE.exports=qr),GE.UAParser=qr;var Oi=typeof e!==n&&(e.jQuery||e.Zepto);if(Oi&&!Oi.ua){var No=new qr;Oi.ua=No.getResult(),Oi.ua.get=function(){return No.getUA()},Oi.ua.set=function(ot){No.setUA(ot);var mt=No.getResult();for(var Ye in mt)Oi.ua[Ye]=mt[Ye]}}}(typeof window=="object"?window:al);var xK=Tt(JS.exports),VK=Ao,FK=Er,jK=Fl,BK=rc,GK=bt("iterator"),WK=Object,HK=function(e){if(jK(e))return!1;var t=WK(e);return t[GK]!==void 0||"@@iterator"in t||FK(BK,VK(t))},KK=Tt(HK),HE=ur;ze({global:!0,forced:HE.globalThis!==HE},{globalThis:HE});var u0=Tt(ur);function gU(e,t){return function(){return e.apply(t,arguments)}}var{toString:zK}=Object.prototype,{getPrototypeOf:lR}=Object,nm=(KE=Object.create(null),e=>{let t=zK.call(e);return KE[t]||(KE[t]=t.slice(8,-1).toLowerCase())}),KE,Oo=e=>(e=e.toLowerCase(),t=>nm(t)===e),u_=e=>t=>typeof t===e,{isArray:wc}=Array,ku=u_("undefined"),d0=Oo("ArrayBuffer"),YK=u_("string"),ti=u_("function"),h0=u_("number"),rp=e=>e!==null&&typeof e=="object",np=e=>{if(nm(e)!=="object")return!1;let t=lR(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||KK(e))},$K=Oo("Date"),qK=Oo("File"),XK=Oo("Blob"),JK=Oo("FileList"),QK=Oo("URLSearchParams");function Lu(e,t){let r,n,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),wc(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{let o=i?Object.getOwnPropertyNames(e):Object.keys(e),a=o.length,s;for(r=0;r<a;r++)s=o[r],t.call(null,e[s],s,e)}}function p0(e,t){t=t.toLowerCase();let r=Object.keys(e),n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}var vU=u0!==void 0?u0:typeof self<"u"?self:typeof window<"u"?window:global,f0=e=>!ku(e)&&e!==vU,ZK=(zE=typeof Uint8Array<"u"&&lR(Uint8Array),e=>zE&&e instanceof zE),zE,e7=Oo("HTMLFormElement"),m0=(e=>{let{hasOwnProperty:t}=e;return(r,n)=>t.call(r,n)})(Object.prototype),t7=Oo("RegExp"),_0=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),n={};Lu(r,(i,o)=>{let a;(a=t(i,o,e))!==!1&&(n[o]=a||i)}),Object.defineProperties(e,n)},YE="abcdefghijklmnopqrstuvwxyz",E0="0123456789",g0={DIGIT:E0,ALPHA:YE,ALPHA_DIGIT:YE+YE.toUpperCase()+E0},r7=Oo("AsyncFunction"),J={isArray:wc,isArrayBuffer:d0,isBuffer:function(e){return e!==null&&!ku(e)&&e.constructor!==null&&!ku(e.constructor)&&ti(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ti(e.append)&&((t=nm(e))==="formdata"||t==="object"&&ti(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&d0(e.buffer),t},isString:YK,isNumber:h0,isBoolean:e=>e===!0||e===!1,isObject:rp,isPlainObject:np,isUndefined:ku,isDate:$K,isFile:qK,isBlob:XK,isRegExp:t7,isFunction:ti,isStream:e=>rp(e)&&ti(e.pipe),isURLSearchParams:QK,isTypedArray:ZK,isFileList:JK,forEach:Lu,merge:function e(){let{caseless:t}=f0(this)&&this||{},r={},n=(i,o)=>{let a=t&&p0(r,o)||o;np(r[a])&&np(i)?r[a]=e(r[a],i):np(i)?r[a]=e({},i):wc(i)?r[a]=i.slice():r[a]=i};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&Lu(arguments[i],n);return r},extend:function(e,t,r){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Lu(t,(i,o)=>{r&&ti(i)?e[o]=gU(i,r):e[o]=i},{allOwnKeys:n}),e},trim:e=>Ar(e)?Ar(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,o,a,s={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)a=i[o],n&&!n(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=r!==!1&&lR(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:nm,kindOfTest:Oo,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;let n=e.indexOf(t,r);return n!==-1&&n===r},toArray:e=>{if(!e)return null;if(wc(e))return e;let t=e.length;if(!h0(t))return null;let r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{let r=(e&&e[Symbol.iterator]).call(e),n;for(;(n=r.next())&&!n.done;){let i=n.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let r,n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},isHTMLForm:e7,hasOwnProperty:m0,hasOwnProp:m0,reduceDescriptors:_0,freezeMethods:e=>{_0(e,(t,r)=>{if(ti(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;let n=e[r];ti(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{let r={},n=i=>{i.forEach(o=>{r[o]=!0})};return wc(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,n){return r.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:p0,global:vU,isContextDefined:f0,ALPHABET:g0,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g0.ALPHA_DIGIT,r="",{length:n}=t;for(;e--;)r+=t[Math.random()*n|0];return r},isSpecCompliantForm:function(e){return!!(e&&ti(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),r=(n,i)=>{if(rp(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;let o=wc(n)?[]:{};return Lu(n,(a,s)=>{let c=r(a,i+1);!ku(c)&&(o[s]=c)}),t[i]=void 0,o}}return n};return r(e,0)},isAsyncFn:r7,isThenable:e=>e&&(rp(e)||ti(e))&&ti(e.then)&&ti(e.catch)};function it(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}J.inherits(it,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:J.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var v0=it.prototype,S0={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{S0[e]={value:e}}),Object.defineProperties(it,S0),Object.defineProperty(v0,"isAxiosError",{value:!0}),it.from=(e,t,r,n,i,o)=>{let a=Object.create(v0);return J.toFlatObject(e,a,function(s){return s!==Error.prototype},s=>s!=="isAxiosError"),it.call(a,e.message,t,r,n,i),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};function $E(e){return J.isPlainObject(e)||J.isArray(e)}function SU(e){return J.endsWith(e,"[]")?e.slice(0,-2):e}function T0(e,t,r){return e?e.concat(t).map(function(n,i){return n=SU(n),!r&&i?"["+n+"]":n}).join(r?".":""):t}var n7=J.toFlatObject(J,{},null,function(e){return/^is[A-Z]/.test(e)});function im(e,t,r){if(!J.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let n=(r=J.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,p){return!J.isUndefined(p[h])})).metaTokens,i=r.visitor||l,o=r.dots,a=r.indexes,s=(r.Blob||typeof Blob<"u"&&Blob)&&J.isSpecCompliantForm(t);if(!J.isFunction(i))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(J.isDate(h))return h.toISOString();if(!s&&J.isBlob(h))throw new it("Blob is not supported. Use a Buffer instead.");return J.isArrayBuffer(h)||J.isTypedArray(h)?s&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function l(h,p,m){let f=h;if(h&&!m&&typeof h=="object"){if(J.endsWith(p,"{}"))p=n?p:p.slice(0,-2),h=JSON.stringify(h);else if(J.isArray(h)&&function(_){return J.isArray(_)&&!_.some($E)}(h)||(J.isFileList(h)||J.endsWith(p,"[]"))&&(f=J.toArray(h)))return p=SU(p),f.forEach(function(_,E){!J.isUndefined(_)&&_!==null&&t.append(a===!0?T0([p],E,o):a===null?p:p+"[]",c(_))}),!1}return!!$E(h)||(t.append(T0(m,p,o),c(h)),!1)}let u=[],d=Object.assign(n7,{defaultVisitor:l,convertValue:c,isVisitable:$E});if(!J.isObject(e))throw new TypeError("data must be an object");return function h(p,m){if(!J.isUndefined(p)){if(u.indexOf(p)!==-1)throw Error("Circular reference detected in "+m.join("."));u.push(p),J.forEach(p,function(f,_){(!(J.isUndefined(f)||f===null)&&i.call(t,f,J.isString(_)?Ar(_).call(_):_,m,d))===!0&&h(f,m?m.concat(_):[_])}),u.pop()}}(e),t}function y0(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function uR(e,t){this._pairs=[],e&&im(e,this,t)}var R0=uR.prototype;function i7(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function TU(e,t,r){if(!t)return e;let n=r&&r.encode||i7,i=r&&r.serialize,o;if(o=i?i(t,r):J.isURLSearchParams(t)?t.toString():new uR(t,r).toString(n),o){let a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}R0.append=function(e,t){this._pairs.push([e,t])},R0.toString=function(e){let t=e?function(r){return e.call(this,r,y0)}:y0;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var C0=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){J.forEach(this.handlers,function(t){t!==null&&e(t)})}},yU={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},RU={exports:{}},o7=ze,a7=Jn,I0=wi.f;o7({target:"Object",stat:!0,forced:Object.defineProperty!==I0,sham:!a7},{defineProperty:I0});var CU=Xi.Object,s7=RU.exports=function(e,t,r){return CU.defineProperty(e,t,r)};CU.defineProperty.sham&&(s7.sham=!0);var IU=Tt(RU.exports),c7=Io,Th=Array.isArray||function(e){return c7(e)=="Array"},l7=TypeError,w0=Th,u7=a_,d7=kn,h7=bt("species"),A0=Array,p7=function(e){var t;return w0(e)&&(t=e.constructor,(u7(t)&&(t===A0||w0(t.prototype))||d7(t)&&(t=t[h7])===null)&&(t=void 0)),t===void 0?A0:t},wU=function(e,t){return new(p7(e))(t===0?0:t)},f7=Mt,m7=Ys,_7=bt("species"),AU=function(e){return m7>=51||!f7(function(){var t=[];return(t.constructor={})[_7]=function(){return{foo:1}},t[e](Boolean).foo!==1})},E7=ze,g7=Mt,v7=Th,S7=kn,T7=wo,y7=ia,b0=function(e){if(e>9007199254740991)throw l7("Maximum allowed index exceeded");return e},O0=l_,R7=wU,C7=AU,I7=Ys,bU=bt("isConcatSpreadable"),w7=I7>=51||!g7(function(){var e=[];return e[bU]=!1,e.concat()[0]!==e}),A7=function(e){if(!S7(e))return!1;var t=e[bU];return t!==void 0?!!t:v7(e)};E7({target:"Array",proto:!0,arity:1,forced:!w7||!C7("concat")},{concat:function(e){var t,r,n,i,o,a=T7(this),s=R7(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(A7(o=t===-1?a:arguments[t]))for(i=y7(o),b0(c+i),r=0;r<i;r++,c++)r in o&&O0(s,c,o[r]);else b0(c+1),O0(s,c++,o);return s.length=c,s}});var OU={},b7=Io,O7=ns,N0=t_.f,N7=sR,P0=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];OU.f=function(e){return P0&&b7(e)=="Window"?function(t){try{return N0(t)}catch{return N7(P0)}}(e):N0(O7(e))};var Kl={},P7=bt;Kl.f=P7;var D0=Xi,D7=Er,k7=Kl,L7=wi.f,or=function(e){var t=D0.Symbol||(D0.Symbol={});D7(t,e)||L7(t,e,{value:k7.f(e)})},M7=hr,U7=_n,x7=bt,V7=as,NU=function(){var e=U7("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=x7("toPrimitive");t&&!t[n]&&V7(t,n,function(i){return M7(r,this)},{arity:1})},F7=is,j7=Xm,B7=wo,G7=ia,W7=wU,k0=Dt([].push),sa=function(e){var t=e==1,r=e==2,n=e==3,i=e==4,o=e==6,a=e==7,s=e==5||o;return function(c,l,u,d){for(var h,p,m=B7(c),f=j7(m),_=F7(l,u),E=G7(f),g=0,T=d||W7,R=t?T(c,E):r||a?T(c,0):void 0;E>g;g++)if((s||g in f)&&(p=_(h=f[g],g,m),e))if(t)R[g]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return g;case 2:k0(R,h)}else switch(e){case 4:return!1;case 7:k0(R,h)}return o?-1:n||i?i:R}},PU={forEach:sa(0),map:sa(1),filter:sa(2),some:sa(3),every:sa(4),find:sa(5),findIndex:sa(6),filterReject:sa(7)},ip=ze,dR=ur,hR=hr,H7=Dt,ll=Jn,hc=Bl,K7=Mt,xr=Er,z7=Br,QS=nn,d_=ns,pR=Qm,Y7=Qn,ZS=rs,xd=_h,DU=n_,$7=t_,kU=OU,q7=mh,LU=dh,MU=wi,X7=$y,UU=qm,L0=as,J7=o_,fR=Wl,xU=r_,M0=Fy,Q7=bt,Z7=Kl,ez=or,tz=NU,rz=ss,VU=nc,h_=PU.forEach,Rn=e_("hidden"),om="Symbol",Vd="prototype",nz=VU.set,U0=VU.getterFor(om),Hi=Object[Vd],Kc=dR.Symbol,uf=Kc&&Kc[Vd],iz=dR.TypeError,qE=dR.QObject,FU=LU.f,Ss=MU.f,jU=kU.f,oz=UU.f,BU=H7([].push),ra=fR("symbols"),yh=fR("op-symbols"),az=fR("wks"),XE=!qE||!qE[Vd]||!qE[Vd].findChild,eT=ll&&K7(function(){return xd(Ss({},"a",{get:function(){return Ss(this,"a",{value:7}).a}})).a!=7})?function(e,t,r){var n=FU(Hi,t);n&&delete Hi[t],Ss(e,t,r),n&&e!==Hi&&Ss(Hi,t,n)}:Ss,JE=function(e,t){var r=ra[e]=xd(uf);return nz(r,{type:om,tag:e,description:t}),ll||(r.description=t),r},am=function(e,t,r){e===Hi&&am(yh,t,r),QS(e);var n=pR(t);return QS(r),xr(ra,n)?(r.enumerable?(xr(e,Rn)&&e[Rn][n]&&(e[Rn][n]=!1),r=xd(r,{enumerable:ZS(0,!1)})):(xr(e,Rn)||Ss(e,Rn,ZS(1,{})),e[Rn][n]=!0),eT(e,n,r)):Ss(e,n,r)},QE=function(e,t){QS(e);var r=d_(t),n=DU(r).concat(WU(r));return h_(n,function(i){ll&&!hR(GU,r,i)||am(e,i,r[i])}),e},GU=function(e){var t=pR(e),r=hR(oz,this,t);return!(this===Hi&&xr(ra,t)&&!xr(yh,t))&&(!(r||!xr(this,t)||!xr(ra,t)||xr(this,Rn)&&this[Rn][t])||r)},x0=function(e,t){var r=d_(e),n=pR(t);if(r!==Hi||!xr(ra,n)||xr(yh,n)){var i=FU(r,n);return!i||!xr(ra,n)||xr(r,Rn)&&r[Rn][n]||(i.enumerable=!0),i}},V0=function(e){var t=jU(d_(e)),r=[];return h_(t,function(n){xr(ra,n)||xr(xU,n)||BU(r,n)}),r},WU=function(e){var t=e===Hi,r=jU(t?yh:d_(e)),n=[];return h_(r,function(i){!xr(ra,i)||t&&!xr(Hi,i)||BU(n,ra[i])}),n};hc||(L0(uf=(Kc=function(){if(z7(uf,this))throw iz("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Y7(arguments[0]):void 0,t=M0(e),r=function(n){this===Hi&&hR(r,yh,n),xr(this,Rn)&&xr(this[Rn],t)&&(this[Rn][t]=!1),eT(this,t,ZS(1,n))};return ll&&XE&&eT(Hi,t,{configurable:!0,set:r}),JE(t,e)})[Vd],"toString",function(){return U0(this).tag}),L0(Kc,"withoutSetter",function(e){return JE(M0(e),e)}),UU.f=GU,MU.f=am,X7.f=QE,LU.f=x0,$7.f=kU.f=V0,q7.f=WU,Z7.f=function(e){return JE(Q7(e),e)},ll&&J7(uf,"description",{configurable:!0,get:function(){return U0(this).description}})),ip({global:!0,constructor:!0,wrap:!0,forced:!hc,sham:!hc},{Symbol:Kc}),h_(DU(az),function(e){ez(e)}),ip({target:om,stat:!0,forced:!hc},{useSetter:function(){XE=!0},useSimple:function(){XE=!1}}),ip({target:"Object",stat:!0,forced:!hc,sham:!ll},{create:function(e,t){return t===void 0?xd(e):QE(xd(e),t)},defineProperty:am,defineProperties:QE,getOwnPropertyDescriptor:x0}),ip({target:"Object",stat:!0,forced:!hc},{getOwnPropertyNames:V0}),tz(),rz(Kc,om),xU[Rn]=!0;var HU=Bl&&!!Symbol.for&&!!Symbol.keyFor,sz=ze,cz=_n,lz=Er,uz=Qn,KU=Wl,dz=HU,ZE=KU("string-to-symbol-registry"),hz=KU("symbol-to-string-registry");sz({target:"Symbol",stat:!0,forced:!dz},{for:function(e){var t=uz(e);if(lz(ZE,t))return ZE[t];var r=cz("Symbol")(t);return ZE[t]=r,hz[r]=t,r}});var pz=ze,fz=Er,mz=hh,_z=Gl,Ez=HU,F0=Wl("symbol-to-string-registry");pz({target:"Symbol",stat:!0,forced:!Ez},{keyFor:function(e){if(!mz(e))throw TypeError(_z(e)+" is not a symbol");if(fz(F0,e))return F0[e]}});var j0=Th,gz=dr,B0=Io,vz=Qn,G0=Dt([].push),Sz=ze,zU=_n,YU=xy,Tz=hr,Rh=Dt,$U=Mt,W0=dr,H0=hh,qU=tR,yz=function(e){if(gz(e))return e;if(j0(e)){for(var t=e.length,r=[],n=0;n<t;n++){var i=e[n];typeof i=="string"?G0(r,i):typeof i!="number"&&B0(i)!="Number"&&B0(i)!="String"||G0(r,vz(i))}var o=r.length,a=!0;return function(s,c){if(a)return a=!1,c;if(j0(this))return c;for(var l=0;l<o;l++)if(r[l]===s)return c}}},Rz=Bl,Cz=String,Ga=zU("JSON","stringify"),op=Rh(/./.exec),K0=Rh("".charAt),Iz=Rh("".charCodeAt),wz=Rh("".replace),Az=Rh(1 .toString),bz=/[\uD800-\uDFFF]/g,z0=/^[\uD800-\uDBFF]$/,Y0=/^[\uDC00-\uDFFF]$/,$0=!Rz||$U(function(){var e=zU("Symbol")();return Ga([e])!="[null]"||Ga({a:e})!="{}"||Ga(Object(e))!="{}"}),q0=$U(function(){return Ga("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ga("\uDEAD")!=='"\\udead"'}),Oz=function(e,t){var r=qU(arguments),n=yz(t);if(W0(n)||e!==void 0&&!H0(e))return r[1]=function(i,o){if(W0(n)&&(o=Tz(n,this,Cz(i),o)),!H0(o))return o},YU(Ga,null,r)},Nz=function(e,t,r){var n=K0(r,t-1),i=K0(r,t+1);return op(z0,e)&&!op(Y0,i)||op(Y0,e)&&!op(z0,n)?"\\u"+Az(Iz(e,0),16):e};Ga&&Sz({target:"JSON",stat:!0,arity:3,forced:$0||q0},{stringify:function(e,t,r){var n=qU(arguments),i=YU($0?Oz:Ga,null,n);return q0&&typeof i=="string"?wz(i,bz,Nz):i}});var X0=mh,Pz=wo;ze({target:"Object",stat:!0,forced:!Bl||Mt(function(){X0.f(1)})},{getOwnPropertySymbols:function(e){var t=X0.f;return t?t(Pz(e)):[]}}),or("asyncIterator"),or("hasInstance"),or("isConcatSpreadable"),or("iterator"),or("match"),or("matchAll"),or("replace"),or("search"),or("species"),or("split");var Dz=NU;or("toPrimitive"),Dz();var kz=_n,Lz=ss;or("toStringTag"),Lz(kz("Symbol"),"Symbol"),or("unscopables"),ss(ur.JSON,"JSON",!0);var Mz=Xi.Symbol,Uz=bt,xz=wi.f,J0=Uz("metadata"),Q0=Function.prototype;Q0[J0]===void 0&&xz(Q0,J0,{value:null}),or("dispose"),or("metadata");var Vz=Mz;or("asyncDispose");var Fz=Dt,mR=_n("Symbol"),jz=mR.keyFor,Bz=Fz(mR.prototype.valueOf),XU=mR.isRegisteredSymbol||function(e){try{return jz(Bz(e))!==void 0}catch{return!1}};ze({target:"Symbol",stat:!0},{isRegisteredSymbol:XU});for(Z0=Wl,tg=_n,eA=Dt,tA=hh,rA=bt,mu=tg("Symbol"),tT=mu.isWellKnownSymbol,rT=tg("Object","getOwnPropertyNames"),JU=eA(mu.prototype.valueOf),nT=Z0("wks"),ap=0,rg=rT(mu),nA=rg.length;ap<nA;ap++)try{eg=rg[ap],tA(mu[eg])&&rA(eg)}catch{}var eg,Z0,tg,eA,tA,rA,mu,tT,rT,JU,nT,ap,rg,nA,iA=function(e){if(tT&&tT(e))return!0;try{for(var t=JU(e),r=0,n=rT(nT),i=n.length;r<i;r++)if(nT[n[r]]==t)return!0}catch{}return!1};ze({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:iA}),or("matcher"),or("observable"),ze({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:XU}),ze({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:iA}),or("metadataKey"),or("patternMatch"),or("replaceAll");var zc=Tt(Vz),QU=Tt(Kl.f("iterator"));function id(e){return id=typeof zc=="function"&&typeof QU=="symbol"?function(t){return typeof t}:function(t){return t&&typeof zc=="function"&&t.constructor===zc&&t!==zc.prototype?"symbol":typeof t},id(e)}var Gz=Tt(Kl.f("toPrimitive"));function Wz(e){var t=function(r,n){if(id(r)!=="object"||r===null)return r;var i=r[Gz];if(i!==void 0){var o=i.call(r,n||"default");if(id(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}(e,"string");return id(t)==="symbol"?t:String(t)}function y(e,t,r){return(t=Wz(t))in e?IU(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Hz=Mt,Kz=bt("iterator"),_R=!Hz(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2"),n="";return e.pathname="c%20d",t.forEach(function(i,o){t.delete("b"),n+=o+i}),r.delete("a",2),!e.toJSON||!r.has("a",1)||r.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[Kz]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||n!=="a1c3"||new URL("http://x",void 0).host!=="x"}),zz=as,ng=ze,Cl=ur,sp=hr,Ro=Dt,Yc=Jn,oA=_R,aA=as,Yz=o_,$z=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:zz(e,n,t[n],r);return e},qz=ss,Xz=Xy,ER=nc,ZU=Qy,ig=dr,Jz=Er,Qz=is,Zz=Ao,eY=nn,ex=kn,cn=Qn,tY=_h,sA=rs,iT=qy,rY=i_,pc=s_,nY=_U,iY=bt("iterator"),Fd="URLSearchParams",tx=Fd+"Iterator",rx=ER.set,di=ER.getterFor(Fd),oY=ER.getterFor(tx),aY=Object.getOwnPropertyDescriptor,gR=function(e){if(!Yc)return Cl[e];var t=aY(Cl,e);return t&&t.value},cA=gR("fetch"),sm=gR("Request"),od=gR("Headers"),og=sm&&sm.prototype,lA=od&&od.prototype,sY=Cl.RegExp,cY=Cl.TypeError,nx=Cl.decodeURIComponent,lY=Cl.encodeURIComponent,uY=Ro("".charAt),uA=Ro([].join),As=Ro([].push),oT=Ro("".replace),dY=Ro([].shift),dA=Ro([].splice),hA=Ro("".split),hY=Ro("".slice),pY=/\+/g,pA=Array(4),fY=function(e){return pA[e-1]||(pA[e-1]=sY("((?:%[\\da-f]{2}){"+e+"})","gi"))},mY=function(e){try{return nx(e)}catch{return e}},fA=function(e){var t=oT(e,pY," "),r=4;try{return nx(t)}catch{for(;r;)t=oT(t,fY(r--),mY);return t}},_Y=/[!'()~]|%20/g,EY={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},gY=function(e){return EY[e]},mA=function(e){return oT(lY(e),_Y,gY)},ag=Xz(function(e,t){rx(this,{type:tx,iterator:iT(di(e).entries),kind:t})},"Iterator",function(){var e=oY(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value=t==="keys"?n.key:t==="values"?n.value:[n.key,n.value]),r},!0),ix=function(e){this.entries=[],this.url=null,e!==void 0&&(ex(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?uY(e,0)==="?"?hY(e,1):e:cn(e)))};ix.prototype={type:Fd,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,o,a,s,c=rY(e);if(c)for(r=(t=iT(e,c)).next;!(n=sp(r,t)).done;){if(o=(i=iT(eY(n.value))).next,(a=sp(o,i)).done||(s=sp(o,i)).done||!sp(o,i).done)throw cY("Expected sequence with length 2");As(this.entries,{key:cn(a.value),value:cn(s.value)})}else for(var l in e)Jz(e,l)&&As(this.entries,{key:l,value:cn(e[l])})},parseQuery:function(e){if(e)for(var t,r,n=hA(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=hA(t,"="),As(this.entries,{key:fA(dY(r)),value:fA(uA(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],As(r,mA(e.key)+"="+mA(e.value));return uA(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var cm=function(){ZU(this,Ac);var e=rx(this,new ix(arguments.length>0?arguments[0]:void 0));Yc||(this.size=e.entries.length)},Ac=cm.prototype;$z(Ac,{append:function(e,t){var r=di(this);pc(arguments.length,2),As(r.entries,{key:cn(e),value:cn(t)}),Yc||this.length++,r.updateURL()},delete:function(e){for(var t=di(this),r=pc(arguments.length,1),n=t.entries,i=cn(e),o=r<2?void 0:arguments[1],a=o===void 0?o:cn(o),s=0;s<n.length;){var c=n[s];if(c.key!==i||a!==void 0&&c.value!==a)s++;else if(dA(n,s,1),a!==void 0)break}Yc||(this.size=n.length),t.updateURL()},get:function(e){var t=di(this).entries;pc(arguments.length,1);for(var r=cn(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){var t=di(this).entries;pc(arguments.length,1);for(var r=cn(e),n=[],i=0;i<t.length;i++)t[i].key===r&&As(n,t[i].value);return n},has:function(e){for(var t=di(this).entries,r=pc(arguments.length,1),n=cn(e),i=r<2?void 0:arguments[1],o=i===void 0?i:cn(i),a=0;a<t.length;){var s=t[a++];if(s.key===n&&(o===void 0||s.value===o))return!0}return!1},set:function(e,t){var r=di(this);pc(arguments.length,1);for(var n,i=r.entries,o=!1,a=cn(e),s=cn(t),c=0;c<i.length;c++)(n=i[c]).key===a&&(o?dA(i,c--,1):(o=!0,n.value=s));o||As(i,{key:a,value:s}),Yc||(this.size=i.length),r.updateURL()},sort:function(){var e=di(this);nY(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=di(this).entries,n=Qz(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new ag(this,"keys")},values:function(){return new ag(this,"values")},entries:function(){return new ag(this,"entries")}},{enumerable:!0}),aA(Ac,iY,Ac.entries,{name:"entries"}),aA(Ac,"toString",function(){return di(this).serialize()},{enumerable:!0}),Yc&&Yz(Ac,"size",{get:function(){return di(this).entries.length},configurable:!0,enumerable:!0}),qz(cm,Fd),ng({global:!0,constructor:!0,forced:!oA},{URLSearchParams:cm}),!oA&&ig(od)&&(_A=Ro(lA.has),EA=Ro(lA.set),sg=function(e){if(ex(e)){var t,r=e.body;if(Zz(r)===Fd)return t=e.headers?new od(e.headers):new od,_A(t,"content-type")||EA(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),tY(e,{body:sA(0,cn(r)),headers:sA(0,t)})}return e},ig(cA)&&ng({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return cA(e,arguments.length>1?sg(arguments[1]):{})}}),ig(sm)&&(cp=function(e){return ZU(this,og),new sm(e,arguments.length>1?sg(arguments[1]):{})},og.constructor=cp,cp.prototype=og,ng({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:cp})));var _A,EA,sg,cp,vY={URLSearchParams:cm,getState:di},gA=Tt(Xi.URLSearchParams),SY={isBrowser:!0,classes:{URLSearchParams:gA!==void 0?gA:uR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},ox=typeof window<"u"&&typeof document<"u",TY=(vA=typeof navigator<"u"&&navigator.product,ox&&["ReactNative","NativeScript","NS"].indexOf(vA)<0),vA,yY=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function SA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function TA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SA(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var mo=TA(TA({},Object.freeze({__proto__:null,hasBrowserEnv:ox,hasStandardBrowserEnv:TY,hasStandardBrowserWebWorkerEnv:yY})),SY),RY=nn,CY=hr,IY=Er,wY=Br,AY=function(){var e=RY(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},yA=RegExp.prototype,ax=function(e){var t=e.flags;return t!==void 0||"flags"in yA||IY(e,"flags")||!wY(yA,e)?t:CY(AY,e)},bY=aR.charAt,RA=hr,OY=nn,NY=dr,PY=Io,DY=/./.exec,kY=TypeError,LY=ze,CA=hr,sx=Md,MY=Xy,lp=Jy,IA=jl,cx=FM,jd=Qn,UY=nn,xY=Fl,VY=Io,FY=jM,lx=ax,jY=Jm,BY=Mt,GY=eR,WY=function(e,t,r){return t+(r?bY(e,t).length:1)},HY=function(e,t){var r=e.exec;if(NY(r)){var n=RA(r,e,t);return n!==null&&OY(n),n}if(PY(e)==="RegExp")return RA(DY,e,t);throw kY("RegExp#exec called on incompatible receiver")},ux=nc,KY=bt("matchAll"),dx="RegExp String",hx=dx+" Iterator",zY=ux.set,YY=ux.getterFor(hx),$Y=TypeError,aT=sx("".indexOf),lm=sx("".matchAll),cg=!!lm&&!BY(function(){lm("a",/./)}),qY=MY(function(e,t,r,n){zY(this,{type:hx,regexp:e,string:t,global:r,unicode:n,done:!1})},dx,function(){var e=YY(this);if(e.done)return lp(void 0,!0);var t=e.regexp,r=e.string,n=HY(t,r);return n===null?(e.done=!0,lp(void 0,!0)):e.global?(jd(n[0])===""&&(t.lastIndex=WY(r,cx(t.lastIndex),e.unicode)),lp(n,!1)):(e.done=!0,lp(n,!1))}),wA=function(e){var t,r,n,i=UY(this),o=jd(e),a=GY(i,RegExp),s=jd(lx(i));return t=new a(a===RegExp?i.source:i,s),r=!!~aT(s,"g"),n=!!~aT(s,"u"),t.lastIndex=cx(i.lastIndex),new qY(t,o,r,n)};LY({target:"String",proto:!0,forced:cg},{matchAll:function(e){var t,r,n,i,o=IA(this);if(xY(e)){if(cg)return lm(o,e)}else{if(FY(e)&&(t=jd(IA(lx(e))),!~aT(t,"g")))throw $Y("`.matchAll` does not allow non-global regexes");if(cg)return lm(o,e);if((n=jY(e,KY))===void 0&&VY(e)=="RegExp"&&(n=wA),n)return CA(n,e,o)}return r=jd(o),i=new RegExp(e,"g"),CA(wA,i,r)}});var XY=Ai("String").matchAll,JY=Br,QY=XY,lg=String.prototype,ZY=function(e){var t=e.matchAll;return typeof e=="string"||e===lg||JY(lg,e)&&t===lg.matchAll?QY:t},e$=Tt(ZY);function px(e){function t(r,n,i,o){let a=r[o++];if(a==="__proto__")return!0;let s=Number.isFinite(+a),c=o>=r.length;return a=!a&&J.isArray(i)?i.length:a,c?(J.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!s):(i[a]&&J.isObject(i[a])||(i[a]=[]),t(r,n,i[a],o)&&J.isArray(i[a])&&(i[a]=function(l){let u={},d=Object.keys(l),h,p=d.length,m;for(h=0;h<p;h++)m=d[h],u[m]=l[m];return u}(i[a])),!s)}if(J.isFormData(e)&&J.isFunction(e.entries)){let r={};return J.forEachEntry(e,(n,i)=>{t(function(o){return e$(J).call(J,/\w+|\[(\w*)]/g,o).map(a=>a[0]==="[]"?"":a[1]||a[0])}(n),i,r,0)}),r}return null}var vR={transitional:yU,adapter:["xhr","http"],transformRequest:[function(e,t){let r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=J.isObject(e);if(i&&J.isHTMLForm(e)&&(e=new FormData(e)),J.isFormData(e))return n?JSON.stringify(px(e)):e;if(J.isArrayBuffer(e)||J.isBuffer(e)||J.isStream(e)||J.isFile(e)||J.isBlob(e))return e;if(J.isArrayBufferView(e))return e.buffer;if(J.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(a,s){return im(a,new mo.classes.URLSearchParams,Object.assign({visitor:function(c,l,u,d){return mo.isNode&&J.isBuffer(c)?(this.append(l,c.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)}},s))}(e,this.formSerializer).toString();if((o=J.isFileList(e))||r.indexOf("multipart/form-data")>-1){let a=this.env&&this.env.FormData;return im(o?{"files[]":e}:e,a&&new a,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(a,s,c){if(J.isString(a))try{return(s||JSON.parse)(a),Ar(J).call(J,a)}catch(l){if(l.name!=="SyntaxError")throw l}return(0,JSON.stringify)(a)}(e)):e}],transformResponse:[function(e){let t=this.transitional||vR.transitional,r=t&&t.forcedJSONParsing,n=this.responseType==="json";if(e&&J.isString(e)&&(r&&!this.responseType||n)){let i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(o){if(i)throw o.name==="SyntaxError"?it.from(o,it.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:mo.classes.FormData,Blob:mo.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};J.forEach(["delete","get","head","post","put","patch"],e=>{vR.headers[e]={}});var SR=vR,t$=J.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),AA=Symbol("internals");function _u(e){var t;return e&&Ar(t=String(e)).call(t).toLowerCase()}function df(e){return e===!1||e==null?e:J.isArray(e)?e.map(df):String(e)}function ug(e,t,r,n,i){return J.isFunction(n)?n.call(this,t,r):(i&&(t=r),J.isString(t)?J.isString(n)?t.indexOf(n)!==-1:J.isRegExp(n)?n.test(t):void 0:void 0)}var hf=class{constructor(e){e&&this.set(e)}set(e,t,r){let n=this;function i(s,c,l){let u=_u(c);if(!u)throw new Error("header name must be a non-empty string");let d=J.findKey(n,u);(!d||n[d]===void 0||l===!0||l===void 0&&n[d]!==!1)&&(n[d||c]=df(s))}let o=(s,c)=>J.forEach(s,(l,u)=>i(l,u,c));var a;return J.isPlainObject(e)||e instanceof this.constructor?o(e,t):J.isString(e)&&(e=Ar(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ar(a=e).call(a))?o((s=>{let c={},l,u,d;return s&&s.split(`
`).forEach(function(h){var p,m;d=h.indexOf(":"),l=Ar(p=h.substring(0,d)).call(p).toLowerCase(),u=Ar(m=h.substring(d+1)).call(m),!l||c[l]&&t$[l]||(l==="set-cookie"?c[l]?c[l].push(u):c[l]=[u]:c[l]=c[l]?c[l]+", "+u:u)}),c})(e),t):e!=null&&i(t,e,r),this}get(e,t){if(e=_u(e)){let r=J.findKey(this,e);if(r){let n=this[r];if(!t)return n;if(t===!0)return function(i){let o=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,s;for(;s=a.exec(i);)o[s[1]]=s[2];return o}(n);if(J.isFunction(t))return t.call(this,n,r);if(J.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=_u(e)){let r=J.findKey(this,e);return!(!r||this[r]===void 0||t&&!ug(0,this[r],r,t))}return!1}delete(e,t){let r=this,n=!1;function i(o){if(o=_u(o)){let a=J.findKey(r,o);!a||t&&!ug(0,r[a],a,t)||(delete r[a],n=!0)}}return J.isArray(e)?e.forEach(i):i(e),n}clear(e){let t=Object.keys(this),r=t.length,n=!1;for(;r--;){let i=t[r];e&&!ug(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){let t=this,r={};return J.forEach(this,(n,i)=>{var o;let a=J.findKey(r,i);if(a)return t[a]=df(n),void delete t[i];let s=e?function(c){return Ar(c).call(c).toLowerCase().replace(/([a-z\d])(\w*)/g,(l,u,d)=>u.toUpperCase()+d)}(i):Ar(o=String(i)).call(o);s!==i&&delete t[i],t[s]=df(n),r[s]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.constructor.concat(this,...t)}toJSON(e){let t=Object.create(null);return J.forEach(this,(r,n)=>{r!=null&&r!==!1&&(t[n]=e&&J.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,r]=e;return t+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let t=new this(e);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.forEach(o=>t.set(o)),t}static accessor(e){let t=(this[AA]=this[AA]={accessors:{}}).accessors,r=this.prototype;function n(i){let o=_u(i);t[o]||(function(a,s){let c=J.toCamelCase(" "+s);["get","set","has"].forEach(l=>{Object.defineProperty(a,l+c,{value:function(u,d,h){return this[l].call(this,s,u,d,h)},configurable:!0})})}(r,i),t[o]=!0)}return J.isArray(e)?e.forEach(n):n(e),this}};hf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),J.reduceDescriptors(hf.prototype,(e,t)=>{let{value:r}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(i){this[n]=i}}}),J.freezeMethods(hf);var Xo=hf;function dg(e,t){let r=this||SR,n=t||r,i=Xo.from(n.headers),o=n.data;return J.forEach(e,function(a){o=a.call(r,o,i.normalize(),t?t.status:void 0)}),i.normalize(),o}function fx(e){return!(!e||!e.__CANCEL__)}function Ch(e,t,r){it.call(this,e??"canceled",it.ERR_CANCELED,t,r),this.name="CanceledError"}J.inherits(Ch,it,{__CANCEL__:!0});var r$=mo.hasStandardBrowserEnv?{write(e,t,r,n,i,o){let a=[e+"="+encodeURIComponent(t)];J.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),J.isString(n)&&a.push("path="+n),J.isString(i)&&a.push("domain="+i),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function mx(e,t){return e&&!function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}(t)?function(r,n){return n?r.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):r}(e,t):t}var n$=mo.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),r;function n(i){let o=i;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=n(window.location.href),function(i){let o=J.isString(i)?n(i):i;return o.protocol===r.protocol&&o.host===r.host}}():function(){return!0};function bA(e,t){let r=0,n=function(i,o){i=i||10;let a=new Array(i),s=new Array(i),c,l=0,u=0;return o=o!==void 0?o:1e3,function(d){let h=Date.now(),p=s[u];c||(c=h),a[l]=d,s[l]=h;let m=u,f=0;for(;m!==l;)f+=a[m++],m%=i;if(l=(l+1)%i,l===u&&(u=(u+1)%i),h-c<o)return;let _=p&&h-p;return _?Math.round(1e3*f/_):void 0}}(50,250);return i=>{let o=i.loaded,a=i.lengthComputable?i.total:void 0,s=o-r,c=n(s);r=o;let l={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:c||void 0,estimated:c&&a&&o<=a?(a-o)/c:void 0,event:i};l[t?"download":"upload"]=!0,e(l)}}var i$=typeof XMLHttpRequest<"u"&&function(e){return new Y(function(t,r){let n=e.data,i=Xo.from(e.headers).normalize(),o,a,{responseType:s,withXSRFToken:c}=e;function l(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}if(J.isFormData(n)){if(mo.hasStandardBrowserEnv||mo.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((a=i.getContentType())!==!1){let[m,...f]=a?a.split(";").map(_=>Ar(_).call(_)).filter(Boolean):[];i.setContentType([m||"multipart/form-data",...f].join("; "))}}let u=new XMLHttpRequest;if(e.auth){let m=e.auth.username||"",f=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(m+":"+f))}let d=mx(e.baseURL,e.url);function h(){if(!u)return;let m=Xo.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());(function(f,_,E){let g=E.config.validateStatus;E.status&&g&&!g(E.status)?_(new it("Request failed with status code "+E.status,[it.ERR_BAD_REQUEST,it.ERR_BAD_RESPONSE][Math.floor(E.status/100)-4],E.config,E.request,E)):f(E)})(function(f){t(f),l()},function(f){r(f),l()},{data:s&&s!=="text"&&s!=="json"?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:m,config:e,request:u}),u=null}if(u.open(e.method.toUpperCase(),TU(d,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=h:u.onreadystatechange=function(){u&&u.readyState===4&&(u.status!==0||u.responseURL&&u.responseURL.indexOf("file:")===0)&&setTimeout(h)},u.onabort=function(){u&&(r(new it("Request aborted",it.ECONNABORTED,e,u)),u=null)},u.onerror=function(){r(new it("Network Error",it.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let m=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",f=e.transitional||yU;e.timeoutErrorMessage&&(m=e.timeoutErrorMessage),r(new it(m,f.clarifyTimeoutError?it.ETIMEDOUT:it.ECONNABORTED,e,u)),u=null},mo.hasStandardBrowserEnv&&(c&&J.isFunction(c)&&(c=c(e)),c||c!==!1&&n$(d))){let m=e.xsrfHeaderName&&e.xsrfCookieName&&r$.read(e.xsrfCookieName);m&&i.set(e.xsrfHeaderName,m)}n===void 0&&i.setContentType(null),"setRequestHeader"in u&&J.forEach(i.toJSON(),function(m,f){u.setRequestHeader(f,m)}),J.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),s&&s!=="json"&&(u.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&u.addEventListener("progress",bA(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",bA(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=m=>{u&&(r(!m||m.type?new Ch(null,e,u):m),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));let p=function(m){let f=/^([-+\w]{1,25})(:?\/\/|:)/.exec(m);return f&&f[1]||""}(d);p&&mo.protocols.indexOf(p)===-1?r(new it("Unsupported protocol "+p+":",it.ERR_BAD_REQUEST,e)):u.send(n||null)})},sT={http:null,xhr:i$};J.forEach(sT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});var OA=e=>"- ".concat(e),o$=e=>J.isFunction(e)||e===null||e===!1,_x={getAdapter:e=>{e=J.isArray(e)?e:[e];let{length:t}=e,r,n,i={};for(let o=0;o<t;o++){let a;if(r=e[o],n=r,!o$(r)&&(n=sT[(a=String(r)).toLowerCase()],n===void 0))throw new it("Unknown adapter '".concat(a,"'"));if(n)break;i[a||"#"+o]=n}if(!n){let o=Object.entries(i).map(a=>{let[s,c]=a;return"adapter ".concat(s," ")+(c===!1?"is not supported by the environment":"is not available in the build")});throw new it("There is no suitable adapter to dispatch the request "+(t?o.length>1?`since :
`+o.map(OA).join(`
`):" "+OA(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n},adapters:sT};function hg(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ch(null,e)}function NA(e){return hg(e),e.headers=Xo.from(e.headers),e.data=dg.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),_x.getAdapter(e.adapter||SR.adapter)(e).then(function(t){return hg(e),t.data=dg.call(e,e.transformResponse,t),t.headers=Xo.from(t.headers),t},function(t){return fx(t)||(hg(e),t&&t.response&&(t.response.data=dg.call(e,e.transformResponse,t.response),t.response.headers=Xo.from(t.response.headers))),Y.reject(t)})}function PA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}var DA=e=>e instanceof Xo?function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?PA(Object(n),!0).forEach(function(i){y(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):PA(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}({},e):e;function Il(e,t){t=t||{};let r={};function n(l,u,d){return J.isPlainObject(l)&&J.isPlainObject(u)?J.merge.call({caseless:d},l,u):J.isPlainObject(u)?J.merge({},u):J.isArray(u)?u.slice():u}function i(l,u,d){return J.isUndefined(u)?J.isUndefined(l)?void 0:n(void 0,l,d):n(l,u,d)}function o(l,u){if(!J.isUndefined(u))return n(void 0,u)}function a(l,u){return J.isUndefined(u)?J.isUndefined(l)?void 0:n(void 0,l):n(void 0,u)}function s(l,u,d){return d in t?n(l,u):d in e?n(void 0,l):void 0}let c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(l,u)=>i(DA(l),DA(u),!0)};return J.forEach(Object.keys(Object.assign({},e,t)),function(l){let u=c[l]||i,d=u(e[l],t[l],l);J.isUndefined(d)&&u!==s||(r[l]=d)}),r}var Ex="1.6.8",TR={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{TR[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});var kA={};TR.transitional=function(e,t,r){function n(i,o){return"[Axios v"+Ex+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return(i,o,a)=>{if(e===!1)throw new it(n(o," has been removed"+(t?" in "+t:"")),it.ERR_DEPRECATED);return t&&!kA[o]&&(kA[o]=!0,console.warn(n(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,o,a)}};var cT={assertOptions:function(e,t,r){if(typeof e!="object")throw new it("options must be an object",it.ERR_BAD_OPTION_VALUE);let n=Object.keys(e),i=n.length;for(;i-- >0;){let o=n[i],a=t[o];if(a){let s=e[o],c=s===void 0||a(s,o,e);if(c!==!0)throw new it("option "+o+" must be "+c,it.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new it("Unknown option "+o,it.ERR_BAD_OPTION)}},validators:TR},ca=cT.validators,pf=class{constructor(e){this.defaults=e,this.interceptors={request:new C0,response:new C0}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;let i=n.stack?n.stack.replace(/^.+\n/,""):"";r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Il(this.defaults,t);let{transitional:r,paramsSerializer:n,headers:i}=t;r!==void 0&&cT.assertOptions(r,{silentJSONParsing:ca.transitional(ca.boolean),forcedJSONParsing:ca.transitional(ca.boolean),clarifyTimeoutError:ca.transitional(ca.boolean)},!1),n!=null&&(J.isFunction(n)?t.paramsSerializer={serialize:n}:cT.assertOptions(n,{encode:ca.function,serialize:ca.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&J.merge(i.common,i[t.method]);i&&J.forEach(["delete","get","head","post","put","patch","common"],p=>{delete i[p]}),t.headers=Xo.concat(o,i);let a=[],s=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(s=s&&p.synchronous,a.unshift(p.fulfilled,p.rejected))});let c=[],l;this.interceptors.response.forEach(function(p){c.push(p.fulfilled,p.rejected)});let u,d=0;if(!s){let p=[NA.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,c),u=p.length,l=Y.resolve(t);d<u;)l=l.then(p[d++],p[d++]);return l}u=a.length;let h=t;for(d=0;d<u;){let p=a[d++],m=a[d++];try{h=p(h)}catch(f){m.call(this,f);break}}try{l=NA.call(this,h)}catch(p){return Y.reject(p)}for(d=0,u=c.length;d<u;)l=l.then(c[d++],c[d++]);return l}getUri(e){return TU(mx((e=Il(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};J.forEach(["delete","get","head","options"],function(e){pf.prototype[e]=function(t,r){return this.request(Il(r||{},{method:e,url:t,data:(r||{}).data}))}}),J.forEach(["post","put","patch"],function(e){function t(r){return function(n,i,o){return this.request(Il(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}pf.prototype[e]=t(),pf.prototype[e+"Form"]=t(!0)});var ff=pf,a$=class gx{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Y(function(i){r=i});let n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o,a=new Y(s=>{n.subscribe(s),o=s}).then(i);return a.cancel=function(){n.unsubscribe(o)},a},t(function(i,o,a){n.reason||(n.reason=new Ch(i,o,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}static source(){let t;return{token:new gx(function(r){t=r}),cancel:t}}},s$=a$,lT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(lT).forEach(e=>{let[t,r]=e;lT[r]=t});var c$=lT,vr=function e(t){let r=new ff(t),n=gU(ff.prototype.request,r);return J.extend(n,ff.prototype,r,{allOwnKeys:!0}),J.extend(n,r,null,{allOwnKeys:!0}),n.create=function(i){return e(Il(t,i))},n}(SR);vr.Axios=ff,vr.CanceledError=Ch,vr.CancelToken=s$,vr.isCancel=fx,vr.VERSION=Ex,vr.toFormData=im,vr.AxiosError=it,vr.Cancel=vr.CanceledError,vr.all=function(e){return Y.all(e)},vr.spread=function(e){return function(t){return e.apply(null,t)}},vr.isAxiosError=function(e){return J.isObject(e)&&e.isAxiosError===!0},vr.mergeConfig=Il,vr.AxiosHeaders=Xo,vr.formToJSON=e=>px(J.isHTMLForm(e)?new FormData(e):e),vr.getAdapter=_x.getAdapter,vr.HttpStatusCode=c$,vr.default=vr;var $r=vr,l$=()=>{};function Bd(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:l$};return e.promise=new Y((t,r)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=n=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(n))}}),e}var up=new Map,dp=new Map,eo=new Map,Gt=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ue=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),vx=new xK,Bi=vx.getResult(),pg=null;function Ne(e){if(!pg){Bi=vx.getResult();let t=function(s){if(s.engine.name==="Blink"&&s.browser.name!=="WeChat")return Ue.CHROME;switch(s.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ue.CHROME;case"Safari":case"Mobile Safari":return Ue.SAFARI;case"Edge":return Ue.EDGE;case"Firefox":return Ue.FIREFOX;case"QQ":case"QQBrowser":return Ue.QQ;case"Opera":return Ue.OPERA;case"WeChat":return Ue.WECHAT;default:return s.browser.name||""}}(Bi),r=LA(Bi),n=function(s){return s.os.name==="Windows"?s.os.version?s.os.name+" "+s.os.version:s.os.name:s.os.name||""}(Bi),i=Bi.os.version,o=LA(Bi,!1),a=Bi.device.type;if(!(t&&r&&n&&i))return{name:t,version:r,os:n,osVersion:i,browserVersion:o,deviceType:a};pg={name:t,version:r,os:n,osVersion:i,browserVersion:o,deviceType:a}}return pg}function LA(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function p_(){return Ne().os}function MA(){let e=Ne();return"".concat(e.os," ").concat(e.osVersion)}function um(){let e=Ne();return!!(Bi.engine.name==="WebKit"&&e.os===Gt.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ue.SAFARI||Vr()&&e.name!==Ue.SAFARI)}function Wa(){return Ne().name===Ue.CHROME}function cr(){return Ne().name===Ue.SAFARI}function Sx(){return Ne().name===Ue.EDGE}function ft(){return Ne().name===Ue.FIREFOX}function Vr(){return Ne().os===Gt.IOS}function uT(e){let t=Ne();return!(t.name!==Ue.CHROME||!t.osVersion)&&Number(t.version)>=e}function Tx(e){let t=Ne();return!(t.name!==Ue.CHROME||!t.osVersion)&&Number(t.version)<e}function UA(e){let t=Ne();return!(t.name!==Ue.EDGE||!t.osVersion)&&Number(t.version)>=e}function yx(e){let t=Ne();return!(t.name!==Ue.SAFARI||!t.osVersion)&&Number(t.version)>=e}function Rx(e,t,r){let n=Ne();if(n.os!==Gt.IOS||!n.osVersion)return!1;let i=n.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function Cx(e,t,r){let n=Ne();if(n.name!==Ue.SAFARI||!n.osVersion||!n.browserVersion)return!1;let i=n.browserVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function xA(e){let t=Ne();return!(t.name!==Ue.OPERA||!t.osVersion)&&Number(t.version)>=e}function VA(){let e=Ne();if(e.os!==Gt.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function wl(){let e=Ne();if(e.os!==Gt.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function dT(){let e=Ne();if(e.os!==Gt.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function FA(){let e=Ne();if(e.os!==Gt.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function yi(){return cr()&&navigator.maxTouchPoints>0}function Ix(){return Ne().name===Ue.WECHAT}function wx(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function yR(){let e=p_();return function(){let{deviceType:t}=Ne();return t==="mobile"||t==="tablet"}()||e===Gt.ANDROID||e===Gt.IOS||e===Gt.HARMONY_OS}function Ja(){let e=Ne();return e.name!==Ue.EDGE&&e.name!==Ue.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function f_(){return p_()===Gt.ANDROID}function Gd(){let e=Ne();return f_()&&(e.name===Ue.CHROME||e.name===Ue.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ze(e,t,r){return(t=function(n){var i=function(o,a){if(typeof o!="object"||!o)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var c=s.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jA(Object(r),!0).forEach(function(n){Ze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var C=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),V=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),Ze(this,"code",void 0),Ze(this,"message",void 0),Ze(this,"data",void 0),Ze(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Ho(e,t){if(typeof e!="boolean")throw new V(C.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Ut(e,t,r){if(!q(r).call(r,e))throw new V(C.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Be(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>n||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new V(C.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(n,"]. integer only"))}function fg(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new V(C.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Be(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Be(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Be(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Be(e.ideal,"".concat(t,".ideal"),1,1/0)}else Be(e,t,1,1/0)}function qt(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new V(C.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Ax(e,r,n,i))throw new V(C.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(n,"].").concat(i?" ASCII characters only.":""))}function jo(e,t){if(!Array.isArray(e))throw new V(C.INVALID_PARAMS,"".concat(t," should be an array"))}function at(e){return e==null}function Ax(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,n=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!n||function(i){if(typeof i!="string")return!1;for(let o=0;o<i.length;o+=1){let a=i.charCodeAt(o);if(a<0||a>255)return!1}return!0}(e))}var Mu=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Mu||{}),hT=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(hT||{}),bx=new class{constructor(){Ze(this,"_clientSize",null),Ze(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ze(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ze(this,"getStyle",e=>window.getComputedStyle(e,null)),Ze(this,"checkCssVisibleProperty",e=>{var t;let r=!0,n=this.getStyle(e),{display:i,visibility:o,opacity:a,filter:s}=n;return(i==="none"||q(t=["hidden","collapse"]).call(t,o)||Number(a)<.1)&&(r=!1),!!r&&(s&&s.split(" ").filter(c=>{var l;let u=c.split("(")[0];return q(l=["brightness","blur","opacity"]).call(l,u)}).map(c=>{let[l,u]=c.split(/\(|\)/);return[l,Number(u.match(/^[0-9\.]+/))]}).forEach(c=>{let[l,u]=c;switch(l){case"brightness":(u<.1||u>3)&&(r=!1);break;case"blur":u>3&&(r=!1);break;case"opacity":u<.1&&(r=!1)}}),r)}),Ze(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,n=!0,i=a=>t(a),o=e;for(;o&&n;)i(o)||(r=!1,n=!1),o=o.parentElement,o||(n=!1);return r}),Ze(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ze(this,"getSizeAboutClient",e=>{let{width:t,height:r,left:n,right:i,top:o,bottom:a}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:r,left:n,right:i,top:o,bottom:a,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}}),Ze(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),Ze(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Ze(this,"checkCoverForAPoint",(e,t,r)=>{let n=this.elementFromPoint(e,t);return n!==null&&n!==r}),Ze(this,"getPointPositionList",()=>{let{width:e,height:t,left:r,top:n}=this._clientSize,i=e/6,o=t/6,a=[],s=10**6;for(let c=0;c<5;c++)for(let l=0;l<5;l++){let u=(r*s+(c===0?.1:c===4?(i*c*s-1e5)/s:i*c)*s)/s,d=(n*s+(l===0?.1:l===4?(o*l*s-1e5)/s:o*l)*s)/s;a.push({x:u,y:d})}return[...a]}),Ze(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Ze(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),Ze(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:r,bottom:n,clientHeight:i,clientWidth:o,clientMin:a}=this._clientSize,s,c,l,u;if(e<0)s=0;else{if(!(e<o))return!1;s=e}if(t<0)return!1;if(c=t<o?t:o,r<0)l=0;else{if(!(r<i))return!1;l=r}if(n<0)return!1;u=n<i?n:i;let d=c-s,h=u-l;return this.checkSizeIsVisible(d,h,a)}),Ze(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ze(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Mu.COVERED);{let t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(Mu.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Mu.SIZE)}}return this.returnHiddenResult(Mu.STYLE)}return this.returnHiddenResult(hT.UNMOUNTED)}return this.returnHiddenResult(hT.INVALID_HTML_ELEMENT)}),Ze(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function RR(e){return new TextEncoder().encode(e)}var BA=function(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},pT=async e=>function(t,r){let n="";return new Uint8Array(t).forEach(i=>{n+=i.toString(r).padStart(2,"0")}),n}(await crypto.subtle.digest("SHA-256",RR(e)),16),lt=class{constructor(){Ze(this,"_events",{}),Ze(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],n=this._indexOfListener(r,t);n!==-1&&r.splice(n,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(o=>o);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(let o=0;o<t.length;o+=1){let a=t[o];a.once&&this.off(e,a.listener),a.listener.apply(this,n||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];[...this._events[e]||[]].forEach(i=>{i.once&&this.off(e,i.listener);try{i.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(e," error ").concat(o==null?void 0:o.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},Eu=null;function Ox(){if(Eu)return Eu;if(window.electron)return Eu=window.electron;if(!window.require)return null;try{return Eu=window.require("electron"),Eu}catch{return null}}var Lt=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),pt=function(e){return e.TRACER="tracer",e}({});function GA(e){return Be(e.timeout,"config.timeout",0,1e5),Be(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Be(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Be(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}var u$=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ve=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function m_(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function Nx(e){return qt(e.turnServerURL,"turnServerURL"),qt(e.username,"username"),qt(e.password,"password"),e.udpport&&Be(e.udpport,"udpport",1,99999,!0),e.forceturn&&Ho(e.forceturn,"forceturn"),e.security&&Ho(e.security,"security"),e.tcpport&&Be(e.tcpport,"tcpport",1,99999,!0),!0}function WA(e){return e.level!==void 0&&Ut(e.level,"level",[1,2,3]),e.delay!==void 0&&Be(e.delay,"delay",0,3e3,!0),!0}var Ce=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),sr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),un=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),$c=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function lr(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return e.getListeners(t).length===0?Y.reject(new V(C.UNEXPECTED_ERROR,"can not emit promise")):new Y((o,a)=>{e.emit(t,...n,o,a)})}function We(e,t){if(e.getListeners(t).length===0)return Y.resolve();for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return lr(e,t,...n)}function Kn(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return Wd(e,t,...n)}function Wd(e,t){let r=null,n=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];if(e.emit(t,...o,s=>{r=s},s=>{n=s}),n!==null)throw n;if(r===null)throw new V(C.UNEXPECTED_ERROR,"handler is not sync");return r}var wt=new class extends lt{set networkState(e){this.emit($c.NETWORK_STATE_CHANGE,e,this._networkState),e===un.ONLINE?this.emit($c.ONLINE):e===un.OFFLINE&&(this.onlineWaiter=new Y(t=>{this.once($c.ONLINE,()=>{this.onlineWaiter=void 0,t(un.ONLINE)})}),this.emit($c.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===un.ONLINE}constructor(){super(),Ze(this,"_moduleName","network-indicator"),Ze(this,"_networkState",un.ONLINE),Ze(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=un.ONLINE}),window.addEventListener("offline",()=>{this.networkState=un.OFFLINE})}};function dm(e,t){let r=e.indexOf(t);r!==-1&&e.splice(r,1)}function qc(e){let t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function __(e){Y!==void 0?Y.resolve().then(e):setTimeout(e,0)}function Ct(e){return JSON.parse(JSON.stringify(e))}function bs(e){try{return Ct(e)}catch{return e}}var HA={};function Qa(e,t){HA[t]||(HA[t]=!0,e())}function Os(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let n=0;n<t.length;n+=1)r[n]=t.charCodeAt(n);return r}function Ha(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function Px(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){let n=new Uint8Array(t);n.set(r),r=n}return r}function KA(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=qi(t).call(t,(a,s)=>a+s.length,0),i=new Uint8Array(new ArrayBuffer(n)),o=0;return t.forEach(a=>{i.set(a,o),o+=a.length}),i}function _o(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function Dx(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?_o(r):r.size}),t+138}function d$(e){let t=new V(C.TIMEOUT,"timeout");return new Y((r,n)=>{window.setTimeout(()=>n(t),e)})}function er(e){return new Y(t=>{window.setTimeout(t,e)})}function Ke(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+Ke(e-r.length,"")}function Xc(){return Ke(32,"").toUpperCase()}var E_=()=>{},zA=new class{constructor(){Ze(this,"fnMap",new Map)}throttleByKey(e,t,r,n){for(var i=arguments.length,o=new Array(i>4?i-4:0),a=4;a<i;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){let s=this.fnMap.get(t);if(s.threshold!==r){s.fn(...s.args),clearTimeout(s.timer);let c=window.setTimeout(()=>{let l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:c,args:o,skipFn:n})}else s.skipFn&&s.skipFn(...s.args),this.fnMap.set(t,ee(ee({},s),{},{fn:e,args:o,skipFn:n}))}else{let s=window.setTimeout(()=>{let c=this.fnMap.get(t);c&&c.fn(...c.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:s,args:o,skipFn:n})}}},YA=zA.throttleByKey.bind(zA);function $A(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function fT(e,t){if(!$A(e)||!$A(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let r=[...e];for(let n=0;n<t.length;n++)r[n]=fT(e[n],t[n]);return r}{let r=ee({},e);for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)?r[n]=fT(e[n],t[n]):r[n]=t[n]);return r}}function qA(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let n=0;for(;e>0&&(r[n]=255&e,e>>=8,n++,n!==t););return r}function mg(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function kx(e){let t="0123456789abcdef";function r(T){let R,w="";for(R=0;R<=3;R++)w+=t.charAt(T>>8*R+4&15)+t.charAt(T>>8*R&15);return w}function n(T,R){let w=(65535&T)+(65535&R);return(T>>16)+(R>>16)+(w>>16)<<16|65535&w}function i(T,R,w,A,N,P){return n(function(x,G){return x<<G|x>>>32-G}(n(n(R,T),n(A,P)),N),w)}function o(T,R,w,A,N,P,x){return i(R&w|~R&A,T,R,N,P,x)}function a(T,R,w,A,N,P,x){return i(R&A|w&~A,T,R,N,P,x)}function s(T,R,w,A,N,P,x){return i(R^w^A,T,R,N,P,x)}function c(T,R,w,A,N,P,x){return i(w^(R|~A),T,R,N,P,x)}let l=function(T){let R,w=1+(T.length+8>>6),A=new Array(16*w);for(R=0;R<16*w;R++)A[R]=0;for(R=0;R<T.length;R++)A[R>>2]|=T.charCodeAt(R)<<R%4*8;return A[R>>2]|=128<<R%4*8,A[16*w-2]=8*T.length,A}(e),u,d,h,p,m,f=1732584193,_=-271733879,E=-1732584194,g=271733878;for(u=0;u<l.length;u+=16)d=f,h=_,p=E,m=g,f=o(f,_,E,g,l[u+0],7,-680876936),g=o(g,f,_,E,l[u+1],12,-389564586),E=o(E,g,f,_,l[u+2],17,606105819),_=o(_,E,g,f,l[u+3],22,-1044525330),f=o(f,_,E,g,l[u+4],7,-176418897),g=o(g,f,_,E,l[u+5],12,1200080426),E=o(E,g,f,_,l[u+6],17,-1473231341),_=o(_,E,g,f,l[u+7],22,-45705983),f=o(f,_,E,g,l[u+8],7,1770035416),g=o(g,f,_,E,l[u+9],12,-1958414417),E=o(E,g,f,_,l[u+10],17,-42063),_=o(_,E,g,f,l[u+11],22,-1990404162),f=o(f,_,E,g,l[u+12],7,1804603682),g=o(g,f,_,E,l[u+13],12,-40341101),E=o(E,g,f,_,l[u+14],17,-1502002290),_=o(_,E,g,f,l[u+15],22,1236535329),f=a(f,_,E,g,l[u+1],5,-165796510),g=a(g,f,_,E,l[u+6],9,-1069501632),E=a(E,g,f,_,l[u+11],14,643717713),_=a(_,E,g,f,l[u+0],20,-373897302),f=a(f,_,E,g,l[u+5],5,-701558691),g=a(g,f,_,E,l[u+10],9,38016083),E=a(E,g,f,_,l[u+15],14,-660478335),_=a(_,E,g,f,l[u+4],20,-405537848),f=a(f,_,E,g,l[u+9],5,568446438),g=a(g,f,_,E,l[u+14],9,-1019803690),E=a(E,g,f,_,l[u+3],14,-187363961),_=a(_,E,g,f,l[u+8],20,1163531501),f=a(f,_,E,g,l[u+13],5,-1444681467),g=a(g,f,_,E,l[u+2],9,-51403784),E=a(E,g,f,_,l[u+7],14,1735328473),_=a(_,E,g,f,l[u+12],20,-1926607734),f=s(f,_,E,g,l[u+5],4,-378558),g=s(g,f,_,E,l[u+8],11,-2022574463),E=s(E,g,f,_,l[u+11],16,1839030562),_=s(_,E,g,f,l[u+14],23,-35309556),f=s(f,_,E,g,l[u+1],4,-1530992060),g=s(g,f,_,E,l[u+4],11,1272893353),E=s(E,g,f,_,l[u+7],16,-155497632),_=s(_,E,g,f,l[u+10],23,-1094730640),f=s(f,_,E,g,l[u+13],4,681279174),g=s(g,f,_,E,l[u+0],11,-358537222),E=s(E,g,f,_,l[u+3],16,-722521979),_=s(_,E,g,f,l[u+6],23,76029189),f=s(f,_,E,g,l[u+9],4,-640364487),g=s(g,f,_,E,l[u+12],11,-421815835),E=s(E,g,f,_,l[u+15],16,530742520),_=s(_,E,g,f,l[u+2],23,-995338651),f=c(f,_,E,g,l[u+0],6,-198630844),g=c(g,f,_,E,l[u+7],10,1126891415),E=c(E,g,f,_,l[u+14],15,-1416354905),_=c(_,E,g,f,l[u+5],21,-57434055),f=c(f,_,E,g,l[u+12],6,1700485571),g=c(g,f,_,E,l[u+3],10,-1894986606),E=c(E,g,f,_,l[u+10],15,-1051523),_=c(_,E,g,f,l[u+1],21,-2054922799),f=c(f,_,E,g,l[u+8],6,1873313359),g=c(g,f,_,E,l[u+15],10,-30611744),E=c(E,g,f,_,l[u+6],15,-1560198380),_=c(_,E,g,f,l[u+13],21,1309151649),f=c(f,_,E,g,l[u+4],6,-145523070),g=c(g,f,_,E,l[u+11],10,-1120210379),E=c(E,g,f,_,l[u+2],15,718787259),_=c(_,E,g,f,l[u+9],21,-343485551),f=n(f,d),_=n(_,h),E=n(E,p),g=n(g,m);return r(f)+r(_)+r(E)+r(g)}var h$=1,hp=console,_r=class{static setLogger(e){hp=e}constructor(e){Ze(this,"lockingPromise",Y.resolve()),Ze(this,"locks",0),Ze(this,"name",""),Ze(this,"lockId",void 0),this.lockId=h$++,e&&(this.name=e),hp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,hp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));let r=new Y(i=>{t=()=>{this.locks-=1,hp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),i()}}),n=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),n}};function Al(e,t){return function(r,n,i){let o=i.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this[t];if(!a)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let s=await a.lock("From ".concat(e,".").concat(n));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await o.apply(this,l)}finally{s()}},i}}var Pt={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function CR(e,t){let r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function Ji(e,t,r,n){let i=Object.assign({},Pt,n),o=i.timeout,a=async()=>{await function(l){return new Y(u=>{window.setTimeout(u,l)})}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)},s=!1,c=new Y(async(l,u)=>{t=t||(()=>!1),r=r||(()=>!0);for(let d=0;d<i.maxRetryCount;d+=1){if(s)return u(new V(C.OPERATION_ABORTED));try{let h=await e();if(!t(h,d)||d+1===i.maxRetryCount)return l(h);await a()}catch(h){if(!r(h,d)||d+1===i.maxRetryCount)return u(h);await a()}}});return c.cancel=()=>s=!0,c}var Lx=class{constructor(e){Ze(this,"input",[]),Ze(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:qi(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},pp,fp=0,_g=0;function mT(e,t,r,n){return new Y((i,o)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),fp+=_o(t.data)):r&&(t.data.size?fp+=t.data.size:t.data instanceof FormData?fp+=Dx(t.data):fp+=_o(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,$r.request(t).then(a=>{typeof a.data=="string"?_g+=_o(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?_g+=a.data.byteLength:_g+=_o(JSON.stringify(a.data)),i(a.data)}).catch(a=>{$r.isCancel(a)?o(new V(C.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?o(new V(C.NETWORK_TIMEOUT,a.message)):a.response?o(new V(C.NETWORK_RESPONSE_ERROR,a.response.status)):o(new V(C.NETWORK_ERROR,a.message))})})}async function p$(e,t){let r=new Blob([t.data],{type:"buffer"});return await mT(e,ee(ee({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}var XA=()=>window.isSecureContext!==void 0,zn=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){let n=t[1],i=t[2];return"".concat(n,".").concat(i)}let r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){let n=r[1],i=r[2];return"".concat(n,".").concat(100*(Number(i)+1))}return"4.0.0.999"}("4.22.0"),IR=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),_s=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),wR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},AR="v4.22.0-0-g8569241d-dirty(8/15/2024, 7:04:06 PM)",vt=ee(ee({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:wR,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1});function je(e,t,r){var n,i,o;q(n=Object.keys(vt)).call(n,e)&&(!r&&q(i=Object.keys(Na)).call(i,e)||(vt[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(vt.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(o=!!t,vt.USE_NEW_NETWORK_CONFIG=o,o&&(vt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],vt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],vt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],vt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],vt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",vt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",vt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(vt.ENABLE_INSTANT_VIDEO=!0,vt.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(vt.ENABLE_AUT_CC=!0)))}function b(e){return vt[e]}var Na={},Te=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Te||{}),f$=class{constructor(e,t,r,n){Ze(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:r,clientId:n,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:_s.Default}}dispatch(e){this.state=function(t,r){switch(r.type){case Te.SET_SESSION_ID:return ee(ee({},t),{},{sessionId:r.sessionId});case Te.SET_P2P_ID:return ee(ee({},t),{},{p2pId:r.p2pId});case Te.SET_UID:return ee(ee({},t),{},{uid:r.uid});case Te.SET_INT_UID:return ee(ee({},t),{},{intUid:r.intUid});case Te.SET_PUB_ID:return ee(ee({},t),{},{pubId:r.pubId});case Te.KEY_METRIC_CLIENT_CREATED:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{clientCreated:r.metric})});case Te.KEY_METRIC_JOIN_START:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{joinStart:r.metric})});case Te.AVOID_JOIN_START:return ee(ee({},t),{},{avoidJoinStart:r.avoidJoinStart});case Te.KEY_METRIC_JOIN_END:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{joinEnd:r.metric})});case Te.KEY_METRIC_REQUEST_AP_START:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{requestAPStart:r.metric})});case Te.KEY_METRIC_REQUEST_AP_END:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{requestAPEnd:r.metric})});case Te.KEY_METRIC_JOIN_GATEWAY_START:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{joinGatewayStart:r.metric})});case Te.KEY_METRIC_JOIN_GATEWAY_END:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{joinGatewayEnd:r.metric})});case Te.KEY_METRIC_PEER_CONNECTION_START:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{peerConnectionStart:r.metric})});case Te.KEY_METRIC_PEER_CONNECTION_END:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{peerConnectionEnd:r.metric})});case Te.KEY_METRIC_DESCRIPTION_START:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{descriptionStart:r.metric})});case Te.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{signalChannelOpen:r.metric})});case Te.KEY_METRIC_ICE_CONNECTION_END:return ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{iceConnectionEnd:r.metric})});case Te.KEY_METRIC_PUBLISH:{let n=t.keyMetrics.publish,i=n.findIndex(o=>o.trackId===r.metric.trackId);return i!==-1?(n[i]=ee(ee({},n[i]),r.metric),ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{publish:[...n]})})):ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{publish:[...t.keyMetrics.publish,r.metric]})})}case Te.KEY_METRIC_SUBSCRIBE:{let n=t.keyMetrics.subscribe,i=n.findIndex(o=>o.userId===r.metric.userId&&o.type===r.metric.type);return i!==-1?(n[i]=ee(ee({},n[i]),r.metric),ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{subscribe:[...n]})})):ee(ee({},t),{},{keyMetrics:ee(ee({},t.keyMetrics),{},{subscribe:[...t.keyMetrics.subscribe,r.metric]})})}case Te.SET_CLOUD_PROXY_SERVER_MODE:return t.cloudProxyServerMode=r.mode,t;case Te.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?t.joinChannelServiceRecords=[...t.joinChannelServiceRecords,r.record]:(t.joinChannelServiceRecords[r.index]=ee(ee({},t.joinChannelServiceRecords[r.index]),r.record),t.joinChannelServiceRecords=[...t.joinChannelServiceRecords]),t;case Te.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t.joinChannelServiceRecords=[],t;case Te.RESET_KEY_METRICS:return t.keyMetrics={publish:[],subscribe:[]},t;case Te.SET_USE_P2P:return ee(ee({},t),{},{useP2P:r.val});case Te.SET_TRANSPORT_TYPE:return ee(ee({},t),{},{p2pTransport:r.val});default:return t}}(this.state,e)}set sessionId(e){this.dispatch({type:Te.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:Te.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:Te.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:Te.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:Te.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:Te.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:Te.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:Te.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:Te.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Te.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Te.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Te.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Te.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Te.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Te.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Te.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Te.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Te.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Te.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Te.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Te.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,r,n){this.dispatch({type:Te.KEY_METRIC_PUBLISH,metric:ee(ee({trackId:e,type:t},r&&{publishStart:r}),n&&{publishEnd:n})})}subscribe(e,t,r,n,i,o,a){this.dispatch({type:Te.KEY_METRIC_SUBSCRIBE,metric:ee(ee(ee(ee(ee({userId:e,type:t},r&&{subscribeStart:r}),n&&{subscribeEnd:n}),i&&{firstFrame:i}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,t,r,n){e.forEach(i=>{this.dispatch({type:Te.KEY_METRIC_SUBSCRIBE,metric:ee(ee(ee({userId:i.userId,type:i.type},t&&{subscribeStart:t}),r&&{subscribeEnd:r}),n&&{firstFrame:n})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof t!="number"?(this.dispatch({type:Te.RECORD_JOIN_CHANNEL_SERVICE,record:ee(ee({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Te.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Te.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Te.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:Te.AVOID_JOIN_START,avoidJoinStart:e})}},g_=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});var JA=128,m$=96,QA=1e3,fc=10,_$=0;function gt(e,t,r){return(t=function(n){var i=function(o,a){if(typeof o!="object"||!o)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var c=s.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZA(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Mx=new class extends lt{constructor(){super(...arguments),gt(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}},E$=class{constructor(e){gt(this,"logger",void 0),gt(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}};function Eg(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function eb(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var Vn={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},mp=Date.now(),gu=e=>{for(let t in Vn)if(Object.prototype.hasOwnProperty.call(Vn,t)&&Vn[t]===e)return t;return"DEFAULT"},v=new class{constructor(){gt(this,"proxyServerURL",void 0),gt(this,"logLevel",Vn.DEBUG),gt(this,"uploadState","collecting"),gt(this,"uploadLogWaitingList",[]),gt(this,"uploadLogUploadingList",[]),gt(this,"uploadErrorCount",0),gt(this,"currentLogID",0),gt(this,"url",void 0),gt(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[Vn.DEBUG].concat(t);this.log.apply(this,n)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[Vn.INFO].concat(t);this.log.apply(this,n)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[Vn.WARNING].concat(t);this.log.apply(this,n)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[Vn.ERROR].concat(t);this.log.apply(this,n)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[Vn.DEBUG].concat(t);this.uploadLog.apply(this,n)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){je("UPLOAD_LOG",!0)}disableLogUpload(){je("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new E$(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-mp<100)return void setTimeout(()=>{this.log(...t)},Date.now()-mp);let n=Math.max(0,Math.min(4,t[0]));if(t[0]=Eg()+" Agora-SDK [".concat(gu(n),"]:"),this.appendLogToWaitingList(n,...t),n<this.logLevel)return;let i=Eg()+" %cAgora-SDK [".concat(gu(n),"]:"),o=[];if(!b("USE_NEW_LOG"))switch(n){case Vn.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case Vn.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case Vn.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case Vn.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-mp<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-mp);let n=Math.max(0,Math.min(4,t[0]));t[0]=Eg()+" Agora-SDK [".concat(gu(n),"]:"),this.appendLogToWaitingList(n,...t)}appendLogToWaitingList(e){if(!b("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];Array.isArray(r[0])?r[0][0]=eb()+" Agora-SDK [".concat(gu(e),"]:"):r[0]=eb()+" Agora-SDK [".concat(gu(e),"]:");let i="";r.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),i+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:zn,process_id:b("PROCESS_ID"),payload:JSON.stringify(e)};return Ji(async()=>{let r=await $r.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(b("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(b("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){let n=new Error("unexpected upload log response");throw n.response=r,n}},()=>(this.uploadLogUploadingList=[],!1),r=>{let n={status:-1,message:r.message,errorRange:e.map(i=>i.log_item_id)};return r.response?(n.status=r.response.status,n.data=r.response.data,n.headers=r.response.headers):r.request&&(n.status=r.request.status),Mx.reportLogUploadError(n),!0},{timeout:b("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:b("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,b("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),b("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),b("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),b("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},tb;function g$(e){return qt(e.reportId,"params.reportId",0,100,!1),qt(e.category,"params.category",0,100,!1),qt(e.event,"params.event",0,100,!1),qt(e.label,"params.label",0,100,!1),Be(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(tb={}).FREE="free",tb.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});var v$={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},$t=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),st=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});var S$=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({}),bR=class Ux{constructor(){gt(this,"baseInfoMap",new Map),gt(this,"proxyServer",void 0),gt(this,"eventUploadTimer",void 0),gt(this,"setSessionIdTimer",void 0),gt(this,"url",void 0),gt(this,"backupUrl",void 0),gt(this,"_appId",void 0),gt(this,"keyEventUploadPendingItems",[]),gt(this,"normalEventUploadPendingItems",[]),gt(this,"apiInvokeUploadPendingItems",[]),gt(this,"apiInvokeCount",0),gt(this,"ltsList",[]),gt(this,"lastSendNormalEventTime",Date.now()),gt(this,"customReportCounterTimer",void 0),gt(this,"customReportCount",0),gt(this,"extApiInvoke",async t=>{for(let r of t){let n=_e(_e({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:pt.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),b("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),b("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void v.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));let r=this.baseInfoMap.get(t),n=Date.now(),i=r.startTime;r.startTime=n,v.debug("rewrite session ".concat(t," startTime: ").concat(n," , ").concat(n-i,"ms")),this.baseInfoMap.set(t,r)}setAppId(t){this._appId=t}reportApiInvoke(t,r,n){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;let i=Date.now();this.apiInvokeCount+=1;let o=this.apiInvokeCount,a=()=>({tag:r.tag,invokeId:o,sid:t,name:r.name,apiInvokeTime:i,options:r.options,states:r.states||null}),s=!!b("SHOW_REPORT_INVOKER_LOG");s&&v.info("".concat(r.name," start"),r.options);let c=!1;er(r.timeout).then(()=>{c||(this.sendApiInvoke(_e(_e({},a()),{},{error:C.API_INVOKE_TIMEOUT,success:!1})),v.debug("".concat(r.name," timeout")))});let l=new V(C.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:u=>{let d=()=>{if(c)throw l;return c=!0,this.sendApiInvoke(_e(_e({},a()),{},{success:!0},r.reportResult&&{result:u})),s&&v.info("".concat(r.name," onSuccess")),u};return n?YA(d,r.name+"Success",n,()=>c=!0):d()},onError:u=>{let d=()=>{if(c)throw u;c=!0,this.sendApiInvoke(_e(_e({},a()),{},{success:!1,error:u})),s&&v.info("".concat(r.name," onFailure"),u.toString())};return n?YA(d,r.name+"Error",n,()=>c=!0):d()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;let n=Date.now(),i=this.createBaseInfo(t,n);i.cname=r.cname;let o=Object.assign({},{willUploadConsoleLog:b("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:IR?"global":"oversea",areas:b("AREAS")&&b("AREAS").join(",")},r.extend),{stringUid:a,channelProfile:s,channelMode:c,isABTestSuccess:l,lsid:u,clientRole:d}=r,h=Date.now(),p=_e(_e({},i),{},{eventType:$t.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:AR,lts:h,elapse:h-n,extend:JSON.stringify(o),mode:r.mode,process:b("PROCESS_ID"),appType:b("APP_TYPE"),success:!0,version:zn,stringUid:a,channelProfile:s,channelMode:c,isABTestSuccess:l,lsid:u,clientType:q(m=window.navigator.userAgent).call(m,"AgoraWebView")?42:20,clientRole:d,serviceId:b("PROCESS_ID"),extensionID:b("PLUGIN_INFO").join(",")||""});var m;this.send({type:st.SESSION,data:p},!0)}joinChooseServer(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e({},i),{},{eventType:$t.JOIN_CHOOSE_SERVER,lts:o,eventElapse:r.elapse||o-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:o-n.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:st.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e({},i),{},{eventType:$t.REQ_USER_ACCOUNT,lts:o,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||o-n.startTime,eventElapse:o-r.lts,extend:JSON.stringify(r.extend)});this.send({type:st.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info;r.vid&&(i.vid=r.vid),i.uid=r.uid,i.cid=r.cid;let o=Date.now(),{firstSuccess:a,avoidJoinStartTime:s}=r,c=o-(a&&s?s:n.startTime),l=_e(_e({},i),{},{eventType:$t.JOIN_GATEWAY,lts:o,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:c,eventElapse:o-r.lts,firstSuccess:a,signalChannel:r.signalChannel,preload:r.preload?1:0});r.succ&&(n.lastJoinSuccessTime=o),this.send({type:st.JOIN_GATEWAY,data:l},!0)}joinChannelTimeout(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=Date.now(),o=_e(_e({},n.info),{},{lts:i,timeout:r,elapse:i-n.startTime});this.send({type:st.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e({},i),{},{eventType:$t.PUBLISH,lts:o,eventElapse:r.eventElapse,elapse:o-n.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:st.PUBLISH,data:a},!0)}subscribe(t,r,n){let i=this.baseInfoMap.get(t);if(!i)return;let o=i.info,a=Date.now(),s=_e(_e({},o),{},{eventType:$t.SUBSCRIBE,lts:a,eventElapse:r.eventElapse,elapse:a-i.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?s.peerSuid=r.peerid:s.peer=r.peerid,this.send({type:st.SUBSCRIBE,data:s},!0)}wsCompressorInit(t){var r;let n=[...Tn(r=this.baseInfoMap).call(r)],i=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(i);if(!o)return;let a=o.info,s=Date.now(),c=_e(_e({},a),{},{eventType:$t.WS_COMPRESSOR_INIT,lts:s,eventElapse:t.eventElapse,elapse:s-o.startTime,status:t.status?1:2});this.send({type:st.WS_COMPRESSOR_INIT,data:c},!0)}firstRemoteVideoDecode(t,r,n,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,s=Date.now(),c=_e(_e(_e({},a),i),{},{elapse:s-o.startTime,eventType:r,lts:s,firstDecodeFrame:Math.max((i.firstFrame||s)-o.startTime,0),apEnd:Math.max(i.apEnd-o.startTime,0),apStart:Math.max(i.apStart-o.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-o.startTime,0),joinGwStart:Math.max(i.joinGwStart-o.startTime,0),pcEnd:Math.max(i.pcEnd-o.startTime,0),pcStart:Math.max(i.pcStart-o.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-o.startTime,0),subscriberStart:Math.max(i.subscriberStart-o.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-o.startTime,0)});this.send({type:n,data:c},!0)}firstRemoteFrame(t,r,n,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,s=Date.now(),c=_e(_e(_e({},a),i),{},{elapse:s-o.startTime,eventType:r,lts:s});this.send({type:n,data:c},!0)}pcStats(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e(_e({},i),r),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:$t.PC_STATS,lts:o,preallocation:r.preallocation?1:0});this.send({type:st.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(t,r){if(t){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e(_e({},i),r),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:$t.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:st.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(t,r,n,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,s=Date.now(),c=_e(_e(_e({},a),i),{},{eventType:r,lts:s});this.send({type:n,data:c},!0)}streamSwitch(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e({},i),{},{eventType:$t.STREAM_SWITCH,lts:o,isDual:r.isdual,elapse:o-n.startTime,success:r.succ});this.send({type:st.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e({},i),{},{eventType:$t.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-r.lts,elapse:o-n.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:st.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e({},i),{},{eventType:$t.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-r.lts,elapse:o-n.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:st.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(t){this.proxyServer=t,t?v.debug("reportProxyServerurl: ".concat(t)):v.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e({},i),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:st.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now();(function(a,s,c){let l=a[s];if(!l||typeof l!="string")return[a];a[s]="";let u=_o(JSON.stringify(a)),d=0,h=[],p=0;for(let m=0;m<l.length;m++)p+=l.charCodeAt(m)<=127?1:3,p<=c-u||(h[h.length]=ee(ee({},a),{},{[s]:l.substring(d,m)}),d=m,p=l.charCodeAt(m)<=127?1:3);return d!==l.length-1&&(h[h.length]=ee(ee({},a),{},{[s]:l.substring(d)})),h})(_e(_e(_e({},i),r),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:st.WORKER_EVENT,data:a},!0))}apworkerEvent(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e(_e({},i),r),{},{elapse:o-n.startTime,lts:o});this.send({type:st.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e(_e({},i),r),{},{elapse:o-n.startTime,lts:o,extend:r.extend||void 0});this.send({type:st.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(t,r){let n=this.baseInfoMap.get(t);if(!n)return;let i=n.info,o=Date.now(),a=_e(_e(_e({},i),r),{},{elapse:o-n.startTime,lts:o});this.send({type:st.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>b("CUSTOM_REPORT_LIMIT"))throw new V(C.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let n=Date.now(),i=r.map(o=>({type:st.USER_ANALYTICS,data:_e(_e({sid:t},o),{},{lts:n})}));try{b("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(o){throw v.error("send custom report message failed",o.toString()),new V(C.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(t){let r=b("NOT_REPORT_EVENT");if(t.tag&&q(r)&&q(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;let n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;let{cname:i,uid:o,cid:a}=n.info,s;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof V){let{code:l,message:u}=t.error;s=l||u||t.error.toString()}else s=t.error.toString();let c={invokeId:t.invokeId,sid:t.sid,cname:i,cid:a,uid:o,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?s:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:st.API_INVOKE,data:c},!1),!0}appendSessionId(){Ux.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){let r=this.apiInvokeUploadPendingItems.length;for(let n=0;n<r;n++){let i=this.apiInvokeUploadPendingItems.shift();i&&(i.sid=t._sessionId,this.sendApiInvoke(Object.assign({},i)))}}})}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>b("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){let n=[],i=[];for(;t.length;){let a=t.shift();n.length<20?n.push(a):i.push(a)}t.push(...i);for(let a of[...n]){var o;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),Sh(o=this.ltsList).call(o,(s,c)=>s-c))}return r||(this.lastSendNormalEventTime=Date.now()),b("ENABLE_EVENT_REPORT")&&n.length&&(b("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((a=>s=>{b("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>b("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-b("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){wt.networkState===un.OFFLINE&&await Y.race([wt.onlineWaiter,er(2*Pt.maxRetryTimeout)]);let r=o=>{let a=new Uint8Array;return o.forEach(s=>{let c=RR(JSON.stringify(s.data)),l=new ArrayBuffer(5),u=(h=>{let p=0;return Object.entries(st).forEach(m=>{let[f,_]=m;_===h.type&&(p=S$[f])}),p})(s),d=new DataView(l);d.setUint16(0,c.byteLength,!0),d.setUint8(2,255&u),d.setUint8(3,u>>>8&255),d.setUint8(4,u>>>16&255),a=BA(a,new Uint8Array(l)),a=BA(a,c)}),a},n="event",i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(b("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(b("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(b("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(b("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await mT(i,{timeout:1e4,data:r(t),headers:_e(_e({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(o===1)throw a;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(a=>JSON.stringify(a)),vid:(a=>{let s=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return s&&s.info.vid&&+s.info.vid||0})(t[0])};wt.networkState===un.OFFLINE&&await Y.race([wt.onlineWaiter,er(2*Pt.maxRetryTimeout)]);let i=r?"/events/proto-raws":"/events/messages",o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(b("EVENT_REPORT_DOMAIN"),"&p=").concat(b("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(b("EVENT_REPORT_DOMAIN"),":").concat(b("STATS_COLLECTOR_PORT")).concat(i));for(let a=0;a<2;a+=1){a===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(b("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(b("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(b("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(b("STATS_COLLECTOR_PORT")).concat(i)));try{r?await p$(o,{timeout:1e4,data:n}):await mT(o,{timeout:1e4,data:n})}catch(s){if(a===1)throw s;continue}return}}createBaseInfo(t,r){let n=Object.assign({},v$);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:r}),n}reportResourceTiming(t,r){let n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:i,tag:pt.TRACER}).onSuccess()}};function ce(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,n){let i=n.value;if(typeof i=="function"){let o=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);n.value=function(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];let l=s;if(e.argsMap)try{l=e.argsMap(this,...s)}catch(d){v.warning(d),l=[]}try{JSON.stringify(l)}catch{v.warning("arguments for method ".concat(o,".").concat(String(r)," not serializable for apiInvoke.")),l=[]}let u=(e.report||te).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(r)),options:l,tag:pt.TRACER,reportResult:e.reportResult},e.throttleTime);try{let d=i.apply(this,s);return d instanceof Y?d.then(h=>(u.onSuccess(e.reportResult&&h),h)).catch(h=>{throw u.onError(h),h}):(u.onSuccess(e.reportResult&&d),d)}catch(d){throw u.onError(d),d}}}return n}}gt(bR,"__CLIENT_LIST__",[]);var te=new bR;Mx.on("REPORT_LOG_UPLOAD",e=>{e.networkState=wt.networkState,te.reportApiInvoke(null,{name:"logUploadError",options:e,tag:pt.TRACER}).onSuccess("logUploadError")});var T$=["CHINA","GLOBAL"],ir=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");let n=r.join(""),i=[];for(let s=0;s<6;s++)i.push("1");let o=i.join(""),a={};return a[e]=n,a[t]=o,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ir,IR||(vt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],vt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],vt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],vt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],vt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],vt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],vt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",vt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",vt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",vt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",vt.AREAS=["NORTH_AMERICA","OVERSEA"]);var xx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ya=[];function ls(e,t){return!!t&&ya.some(r=>r.uid===e&&r.channelName===t)}bR.__CLIENT_LIST__=ya;var y$=PU.forEach,rb=Zm("forEach")?[].forEach:function(e){return y$(this,e,arguments.length>1?arguments[1]:void 0)};ze({target:"Array",proto:!0,forced:[].forEach!=rb},{forEach:rb});var R$=Ai("Array").forEach,C$=Ao,I$=Er,w$=Br,A$=R$,gg=Array.prototype,b$={DOMTokenList:!0,NodeList:!0},O$=function(e){var t=e.forEach;return e===gg||w$(gg,e)&&t===gg.forEach||I$(b$,C$(e))?A$:t},N$=Tt(O$),P$=wo,nb=n_;ze({target:"Object",stat:!0,forced:Mt(function(){nb(1)})},{keys:function(e){return nb(P$(e))}});var Vx=Tt(Xi.Object.keys),D$=Tt(GM),k$=ze,L$=Th,M$=Dt([].reverse),ib=[1,2];k$({target:"Array",proto:!0,forced:String(ib)===String(ib.reverse())},{reverse:function(){return L$(this)&&(this.length=this.length),M$(this)}});var U$=Ai("Array").reverse,x$=Br,V$=U$,vg=Array.prototype,F$=function(e){var t=e.reverse;return e===vg||x$(vg,e)&&t===vg.reverse?V$:t},Fx=F$,j$=Tt(Fx),B$=ze,ob=Th,G$=a_,W$=kn,ab=Gy,H$=ia,K$=ns,z$=l_,Y$=bt,$$=tR,q$=AU("slice"),X$=Y$("species"),Sg=Array,J$=Math.max;B$({target:"Array",proto:!0,forced:!q$},{slice:function(e,t){var r,n,i,o=K$(this),a=H$(o),s=ab(e,a),c=ab(t===void 0?a:t,a);if(ob(o)&&(r=o.constructor,(G$(r)&&(r===Sg||ob(r.prototype))||W$(r)&&(r=r[X$])===null)&&(r=void 0),r===Sg||r===void 0))return $$(o,s,c);for(n=new(r===void 0?Sg:r)(J$(c-s,0)),i=0;s<c;s++,i++)s in o&&z$(n,i,o[s]);return n.length=i,n}});var Q$=Ai("Array").slice,Z$=Br,eq=Q$,Tg=Array.prototype,tq=function(e){var t=e.slice;return e===Tg||Z$(Tg,e)&&t===Tg.slice?eq:t},rq=Tt(tq);function Z(e,t,r,n,i){var o,a,s,c={};return N$(o=Vx(n)).call(o,function(l){c[l]=n[l]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=D$(a=j$(s=rq(r).call(r)).call(s)).call(a,function(l,u){return u(e,t,l)||l},c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0&&(IU(e,t,c),c=null),c}var _T=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),En=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),mf=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),yg=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ri=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Dr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),ae=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),He=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),he=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),de=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Hd=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),ye=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Ur=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),pe=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({}),M=class extends V{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),y(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,v)}throw(){super.throw(v)}};function v_(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw v.error("Invalid Channel Name ".concat(e)),new M(C.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function S_(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!Ax(e,1,255))throw new M(C.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&v.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}var Yo=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),nq={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Rg={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Cg(e,t){qt(e.url,"".concat(t,".url"),1,1e3,!1),at(e.x)||Be(e.x,"".concat(t,".x"),0,1e4),at(e.y)||Be(e.y,"".concat(t,".y"),0,1e4),at(e.width)||Be(e.width,"".concat(t,".width"),0,1e4),at(e.height)||Be(e.height,"".concat(t,".height"),0,1e4),at(e.zOrder)||Be(e.zOrder,"".concat(t,".zOrder"),0,255),at(e.alpha)||Be(e.alpha,"".concat(t,".alpha"),0,1,!1)}var iq={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Ra=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),ET=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),kt=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function sb(e){if(!e.channelName)throw new M(C.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new M(C.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&qt(e.token,"info.token",1,2047),S_(e.uid),v_(e.channelName),!0}var kr=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Mo=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Zr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),bc=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Me=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),nr=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),_f=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),jt=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),ke=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),cb=[ke.AFRICA,ke.ASIA,ke.CHINA,ke.EUROPE,ke.GLOBAL,ke.INDIA,ke.JAPAN,ke.NORTH_AMERICA,ke.OCEANIA,ke.OVERSEA,ke.SOUTH_AMERICA],pr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),T_={CHINA:{},ASIA:{CODE:pr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:pr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:pr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:pr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:pr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:pr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:pr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:pr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:pr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:pr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:pr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:pr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:pr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};IR&&(T_.CHINA={CODE:pr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});var gT=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({}),jx=class extends lt{constructor(e,t){super(),y(this,"onICEConnectionStateChange",void 0),y(this,"onConnectionStateChange",void 0),y(this,"onDTLSTransportStateChange",void 0),y(this,"onDTLSTransportError",void 0),y(this,"onICETransportStateChange",void 0),y(this,"onFirstAudioReceived",void 0),y(this,"onFirstVideoReceived",void 0),y(this,"onFirstAudioDecoded",void 0),y(this,"onFirstVideoDecoded",void 0),y(this,"onFirstVideoDecodedTimeout",void 0),y(this,"onSelectedLocalCandidateChanged",void 0),y(this,"onSelectedRemoteCandidateChanged",void 0),y(this,"getLocalVideoStats",void 0)}},Bx=class extends jx{constructor(e,t){super(e,t),y(this,"establishPromise",void 0)}},re=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),dn=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Po=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),H=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Le=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),le=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),li=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ni=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Kt=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Gx=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),ho=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),xn=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ui=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),mc=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Et=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),_c=function(e){return e.ABORT="abort",e}({}),Pa=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),oq=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),aq={[mf.ACCESS_POINT]:{[Dr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Dr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Dr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Dr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Dr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Dr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Dr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[mf.UNILBS]:{[ri.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ri.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ri.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ri.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ri.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ri.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ri.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ri.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ri.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ri.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ri.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ri.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[mf.STRING_UID_ALLOCATOR]:{[yg.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[yg.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[yg.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function bl(e){let t=aq[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===mf.ACCESS_POINT){let n=e%1e4;if(n.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(n.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}var sq={[ae.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ae.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ae.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ae.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ae.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ae.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ae.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ae.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ae.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ae.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ae.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ae.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[ae.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ae.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ae.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ae.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ae.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ae.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ae.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ae.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ae.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ae.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ae.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ae.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ae.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ae.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ae.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ae.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ae.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ae.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ae.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ae.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ae.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ae.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ae.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ae.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ae.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ae.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ae.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ae.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ae.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ae.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ae.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ae.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ae.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ae.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ae.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ae.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ae.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ae.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ae.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ae.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ae.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ae.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ae.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ae.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ae.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ae.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ae.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ae.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ae.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ae.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Kd(e){return sq[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function lb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ig(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lb(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ub(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function db(e,t){if(typeof e=="string")return e;let{proxy:r,host:n,port:i}=e;if(t){let o=b("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(n,"/ws/?p=").concat(Number(i)+150):"wss://".concat(n,":").concat(o,"/ws/?p=").concat(Number(i)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(n,"&p=").concat(i):"wss://".concat(n,":").concat(i)}var cq=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,lq=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,uq=/wss:\/\/(.+):([0-9]+)\/?/,dq=/wss:\/\/(.[^\/]+)\/?/,hq=0,pq=class{constructor(e,t){y(this,"id",0),y(this,"store",void 0),y(this,"recordIndex",void 0),y(this,"websockets",[]),y(this,"try443PortDuration",2e3),y(this,"forceCloseWSDuration",5e3),y(this,"try443PortTimeout",null),y(this,"forceCloseTimeout",null),y(this,"isTry443PortFailed",!1),y(this,"isNormalPortFailed",!1),y(this,"useDoubleDomain",!1),y(this,"useProxy",!1),y(this,"startTime",Date.now()),this.id=++hq,this.try443PortDuration=b("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;let t=Date.now()-this.startTime;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];v.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...n)}createWebSocket(e,t,r){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:r});let n=b("GATEWAY_DOMAINS"),i=Date.now(),o=[],a=n.find(l=>{var u;return q(u=e.host).call(u,l)});a||(this.useDoubleDomain=!1);let s=[];if(this.useDoubleDomain)n.forEach(l=>{s.push(db(Ig(Ig({},e),{},{host:e.host.replace(a,l)}),t))});else{let l=Ig({},e);if(t&&a){let u=n.find(d=>d!==a);u&&(l.host=l.host.replace(a,u))}s.push(db(l,t))}try{s.forEach(l=>{let u=new WebSocket(l);u.binaryType="arraybuffer",o.push(u),this.logger("ws is connecting:",u.url)})}catch(l){if(this.logger("ws create failed"),o.forEach(u=>u.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,r);if(!t&&Number(e.port)!==443)return this.createWebSocket(e,!0,r);throw new M(C.WS_ERR,"init websocket failed! Error: ".concat(l.toString()))}let c=Bd();return this.store&&this.store.recordJoinChannelService({urls:o.map(l=>l.url),service:"gateway"},this.recordIndex),o.forEach(l=>{l.onopen=()=>{this.logger("onopen: ws ".concat(l.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach(u=>{u!==l&&(u.onopen=null,u.onclose=null,u.onmessage=null,u.close(),this.logger("close backup websocket: ".concat(u.url)))}),this.websockets.length=0,c.resolve(l)},l.onclose=u=>{this.logger("onclose: ws ".concat(l.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(l.readyState)),t?this.isTry443PortFailed=ub(o):this.isNormalPortFailed=ub(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(u.reason)),c.reject({code:u.code,reason:_f.A_ROUND_WS_FAILED}))},l.onmessage=u=>this.logger("".concat(l.url," onmessage: ").concat(u.data))}),this.websockets.push(...o),r||(()=>{let l=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.websockets.forEach(u=>u.readyState!==WebSocket.OPEN&&u.close())};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(l,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",c.isResolved),c.isResolved)return l();Ne().os===Gt.MAC_OS&&ft()&&l(),this.createWebSocket(e,!0,!0).then(u=>c.resolve(u)).catch(u=>{this.isNormalPortFailed&&c.reject(u),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(l,this.forceCloseWSDuration)},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,r,n){return this.useDoubleDomain=!!t,typeof e=="string"&&(e=function(i){let o,a,s;return[,o,a,s]=i.match(cq)||[],o||([,a,s]=i.match(lq)||[]),a&&s||([,a,s]=i.match(uq)||[]),a&&s||([,a]=i.match(dq)||[]),a||v.warning("un-destructible url: ",i),{proxy:o,host:a,port:s||"443"}}(e)),this.recordIndex=n,this.useProxy=!!e.proxy,r&&this.useProxy&&(v.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(e,!!r,!1).finally(()=>this.clearTimeout())}};function hb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}var Wx=class extends lt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;q(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(pe.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pe.CONNECTED):this._state==="closed"?this.emit(pe.CLOSED):this._state==="failed"&&this.emit(pe.FAILED))}resetReconnectCount(e){v.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],n=arguments.length>3&&arguments[3]!==void 0&&arguments[3],i=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),y(this,"connectionID",0),y(this,"currentURLIndex",0),y(this,"urls",[]),y(this,"_reconnectMode","tryNext"),y(this,"reconnectReason",void 0),y(this,"_initMutex",new _r("websocket")),y(this,"name",void 0),y(this,"_state","closed"),y(this,"reconnectInterrupter",void 0),y(this,"websocket",void 0),y(this,"retryConfig",void 0),y(this,"reconnectCount",0),y(this,"forceCloseTimeout",5e3),y(this,"onlineReconnectListener",void 0),y(this,"useCompress",void 0),y(this,"tryDoubleDomain",!1),y(this,"use443PortOnly",!1),y(this,"wsInflateLength",0),y(this,"wsDeflateLength",0),y(this,"closeEstablishingWs",()=>{}),y(this,"store",void 0),y(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(u){for(var d=1;d<arguments.length;d++){var h=arguments[d]!=null?arguments[d]:{};d%2?hb(Object(h),!0).forEach(function(p){y(u,p,h[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(h)):hb(Object(h)).forEach(function(p){Object.defineProperty(u,p,Object.getOwnPropertyDescriptor(h,p))})}return u}({},t),this.useCompress=r,this.tryDoubleDomain=n,this.use443PortOnly=i;let{timeout:a,timeoutFactor:s}=t,c=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*s)/10);un.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),wt.on($c.NETWORK_STATE_CHANGE,(u,d)=>{u!==d&&(this.resetReconnectCount("network state change: ".concat(d," -> ").concat(u)),u===un.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=s))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{let n=Bd(),i=this.urls[this.currentURLIndex];b("ENABLE_PREALLOC_PC")&&this.emit(Gx.PRE_CONNECT_PC),this.createWebSocketConnection(i).then(n.resolve).catch(n.reject),this.once(pe.CLOSED,()=>{n.reject(new V(C.WS_DISCONNECT))}),this.once(pe.CONNECTED,n.resolve),await n.promise}catch{}finally{r()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let r=this.websocket;t?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);let r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new V(C.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(r){throw new V(C.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;let r=Bd();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let n=l=>{var u;(u=this.store)===null||u===void 0||u.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),l),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},i=async l=>{var u;if(v.debug("[".concat(this.name,"] websocket close ").concat((u=this.websocket)===null||u===void 0?void 0:u.url,", code: ").concat(l.code,", reason: ").concat(l.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new V(C.WS_DISCONNECT,"websocket close: ".concat(l.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=l.reason,this.state="reconnecting");let d=Kn(this,pe.WILL_RECONNECT,this.reconnectMode,l.reason)||this.reconnectMode,h=await this.reconnectWithAction(d);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!h)return r.reject(new V(C.WS_DISCONNECT,"websocket reconnect failed: ".concat(l.code))),this.close(!0);r.resolve()}},o=l=>{this.emit(pe.ON_MESSAGE,l)},a=l=>{v.warn("[".concat(this.connectionID,"] ws open error ").concat(l))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),b("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=b("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url:"),e);let s=(t=this.store)===null||t===void 0?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;let l=await this.chooseBestWebsocketConnection(e);this.websocket=l,n&&n(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=o,this.websocket.onerror=a,(c=this.store)===null||c===void 0||c.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this.joinGatewayRecordIndex=s}catch(l){let u=this.state==="closed",d=l instanceof V,h=d&&l.code===C.WS_ABORT,p=d&&l.code===C.WS_ERR,m=d?l.message:l&&(l.reason||l.toString());v.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(m)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:h?"aborted":"error",errors:[l]},s),u||p?(r.reject(u?new V(C.WS_DISCONNECT,"websocket is closed: ".concat(m)):new V(C.WS_ERR,"init websocket failed: ".concat(m))),p&&v.error("[".concat(this.name,"] init websocket failed: ").concat(m))):i&&i(l)}return r.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;v.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||wt.isOnline||!wt.onlineWaiter||(this.onlineReconnectListener=wt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,t){let o=CR(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(e)),await Y.race([er(o),this.onlineReconnectListener||new Y(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;let n=async(o,a)=>{this.emit(pe.RECONNECT_CREATE_CONNECTION,a),await this.createWebSocketConnection(o)};try{if(e==="retry")this.emit(pe.RECONNECT_WAITTING_FINISH,e),await n(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(pe.RECONNECT_WAITTING_FINISH,e),await n(this.urls[this.currentURLIndex],e)}else e==="recover"&&(v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(pe.RECONNECT_WAITTING_FINISH,e),this.urls=await lr(this,pe.REQUEST_NEW_URLS),this.currentURLIndex=0,await n(this.urls[this.currentURLIndex],e))}catch(o){var i;v.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));let a=o==null||(i=o.data)===null||i===void 0?void 0:i.desc;return Array.isArray(a)&&q(a).call(a,"dynamic key expired")?(this.emit(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}},OR=class extends Wx{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){let r=Bd(),n=function(o,a){return new pq(o,a)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),n.closeAllWebsockets(),r.reject(new V(C.WS_ABORT,"choose best websocket aborted"))};let i=b("GATEWAY_DOMAINS");return v.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),n.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}},zd=class extends Wx{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new Y((r,n)=>{let i=!1,o=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),o.forEach(p=>{p.onclose=null,p.onopen=null,p.onmessage=null,p.close()}),n(new V(C.WS_ABORT,"choose best websocket aborted"))};let a=b("GATEWAY_DOMAINS"),s,c=e.indexOf("?h="),l=a.find(p=>c!==-1?q(e).call(e,p,c):q(e).call(e,p));v.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let u=!this.tryDoubleDomain||!l;if(!u&&l){var d;let p=Date.now();try{a.forEach(m=>{let f=c===-1?e.replace(l,m):e.substr(0,c)+e.substr(c).replace(l,m),_=new WebSocket(f);_.binaryType="arraybuffer",o.push(_),v.debug("[choose-best-ws] ws is connecting:",_.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(m=>m.close());o.length;)o.pop();u=!0}(d=this.store)===null||d===void 0||d.recordJoinChannelService({urls:o.map(m=>m.url),service:"gateway"},t),o.forEach(m=>{m.onopen=()=>{if(i)return;let f=Date.now()-p;v.debug("[choose-best-ws] ws open cost ".concat(f,"ms")),o.filter(_=>_!==m).forEach(_=>{v.debug("[choose-best-ws]close backup websocket: ".concat(_.url)),_.close()}),i=!0,r(m)},m.onclose=f=>{s=f,!i&&(o.find(_=>!(_.readyState===WebSocket.CLOSED||_.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),i=!0,n(s)))},m.onmessage=f=>{v.debug("[choose-best-ws]".concat(m.url," onmessage: ").concat(f.data))}}),er(this.forceCloseTimeout).then(()=>{o.forEach(m=>{m.readyState!==WebSocket.OPEN&&m.close()})})}if(u){var h;let p;v.debug("[choose-best-ws] use single url: ",e),(h=this.store)===null||h===void 0||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{p=new WebSocket(e),o.push(p),p.binaryType="arraybuffer"}catch(m){let f=new V(C.WS_ERR,"init websocket failed! Error: ".concat(m.toString()));return v.error("[".concat(this.name,"]").concat(f)),void n(f)}p.onopen=()=>{r(p)},p.onclose=m=>{n(m)},p.onmessage=m=>{v.debug("[choose-best-ws]".concat(p.url," onmessage: ").concat(m.data))},er(this.forceCloseTimeout).then(()=>{p&&p.readyState!==WebSocket.OPEN&&p.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}},fq=class extends lt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===He.CONNECTED?this.emit(he.WS_CONNECTED):e===He.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):e===He.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),y(this,"_disconnectedReason",void 0),y(this,"_websocketReconnectReason",void 0),y(this,"_connectionState",He.CLOSED),y(this,"reconnectToken",void 0),y(this,"websocket",void 0),y(this,"openConnectionTime",void 0),y(this,"clientId",void 0),y(this,"lastMsgTime",Date.now()),y(this,"uploadCache",[]),y(this,"uploadCacheInterval",void 0),y(this,"rttRolling",new Lx(5)),y(this,"pingpongTimer",void 0),y(this,"wsInflateDataTimer",void 0),y(this,"pingpongTimeoutCount",0),y(this,"joinResponse",void 0),y(this,"multiIpOption",void 0),y(this,"initError",void 0),y(this,"spec",void 0),y(this,"store",void 0),y(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,r.data);let n=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n,"_id")){let i="res-@".concat(n._id);this.emit(i,n._result,n._message)}else if(Object.prototype.hasOwnProperty.call(n,"_type")){if(this.emit(n._type,n._message),n._type===ye.ON_NOTIFICATION&&this.handleNotification(n._message),n._type===ye.ON_USER_BANNED)switch(n._message.error_code){case 14:this.close(Ve.UID_BANNED);break;case 15:this.close(Ve.IP_BANNED);break;case 16:this.close(Ve.CHANNEL_BANNED)}if(n._type===ye.ON_USER_LICENSE_BANNED)switch(n._message.error_code){case ae.ERR_LICENSE_MISSING:this.close(Ve.LICENSE_MISSING);break;case ae.ERR_LICENSE_EXPIRED:this.close(Ve.LICENSE_EXPIRED);break;case ae.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ve.LICENSE_MINUTES_EXCEEDED);break;case ae.ERR_LICENSE_PERIOD_INVALID:this.close(Ve.LICENSE_PERIOD_INVALID);break;case ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ve.LICENSE_MULTIPLE_SDK_SERVICE);break;case ae.ERR_LICENSE_ILLEGAL:this.close(Ve.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new OR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,b("JOIN_GATEWAY_USE_DUAL_DOMAIN"),b("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===He.CONNECTED&&this.reconnect("retry",sr.OFFLINE)})}async request(e,t,r,n){let i=Ke(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new Y((p,m)=>{if(this.connectionState===He.CONNECTED)return p();let f=()=>{this.off(he.WS_CLOSED,_),p()},_=()=>{this.off(he.WS_CONNECTED,f),m(new M(C.WS_ABORT))};this.once(he.WS_CONNECTED,f),this.once(he.WS_CLOSED,_),e!==de.PUBLISH&&e!==de.PUBLISH_DATASTREAM&&e!==de.SUBSCRIBE&&e!==de.SUBSCRIBE_DATASTREAM&&e!==de.UNSUBSCRIBE&&e!==de.UNSUBSCRIBE_DATASTREAM&&e!==de.UNPUBLISH&&e!==de.UNPUBLISH_DATASTREAM&&e!==de.CONTROL&&e!==de.RESTART_ICE||this.once(he.DISCONNECT_P2P,()=>{m(new M(C.DISCONNECT_P2P))}),e!==de.PUBLISH&&e!==de.RESTART_ICE||this.once(he.ABORT_P2P_EXECUTION,()=>{m(new M(C.DISCONNECT_P2P))})});if(this.connectionState!==He.CONNECTING&&this.connectionState!==He.RECONNECTING||e===de.JOIN||e===de.REJOIN||await s(),this.websocket.sendMessage(o,!0),n)return;let c=new Y((p,m)=>{let f=!1,_=(g,T)=>{f=!0,p({isSuccess:g==="success",message:T||{}}),this.off(he.WS_CLOSED,E),this.off(he.WS_RECONNECTING,E),this.emit(he.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),_);let E=()=>{m(new M(C.WS_ABORT,"type: ".concat(e))),this.off(he.WS_CLOSED,E),this.off(he.WS_RECONNECTING,E),this.off("res-@".concat(i),_)};this.once(he.WS_CLOSED,E),this.once(he.WS_RECONNECTING,E),er(b("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||f||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(he.REQUEST_TIMEOUT,e,t))})}),l=null;try{l=await c}catch(p){if(this.connectionState===He.CLOSED||e===de.LEAVE)throw new M(C.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?p.throw():e===de.JOIN||e===de.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;let u=Number(l.message.error_code||l.message.code),d=Kd(u),h=new M(C.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message,desc:d.desc});return d.action==="success"?l.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===ae.ERR_TOO_MANY_BROADCASTERS?((e===de.JOIN||e===de.REJOIN)&&(this.initError=h,this.close()),h.throw()):d.action==="failed"?h.throw():d.action==="quit"?(this.initError=h,this.close(),h.throw()):(u===ae.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",sr.MULTI_IP)):this.reconnect(d.action,sr.SERVER_ERROR),e===de.JOIN||e===de.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Y(r=>{let n=i=>{(!t||t(i))&&(this.off(e,n),r(i))};this.on(e,n)})}uploadWRTCStats(e){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Hd.WRTC_STATS,t)}upload(e,t){let r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch{let n=b("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>n&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==He.CONNECTED)return;let i=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(i._type,i._message)},b("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let r={_type:e,_message:t};this.websocket.sendMessage(r)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Y((r,n)=>{this.once(he.WS_CONNECTED,()=>r(this.joinResponse)),this.once(he.WS_CLOSED,()=>n(this.initError||new M(C.WS_ABORT))),this.connectionState=He.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Ve.LEAVE,this.connectionState=He.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(he.ABORT_P2P_EXECUTION);let e=await lr(this,he.REQUEST_JOIN_INFO),t=await this.request(de.JOIN,e);if(!t)return this.emit(he.REPORT_JOIN_GATEWAY,_f.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(he.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=He.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new M(C.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=Wd(this,he.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(de.REJOIN,e);return!!t&&(this.connectionState=He.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(r=>{this.emit(ye.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(ye.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(ye.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(ye.MUTE_AUDIO,{uid:r.uid}):this.emit(ye.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(ye.MUTE_VIDEO,{uid:r.uid}):this.emit(ye.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(ye.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(ye.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(ye.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(ye.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(ye.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){v.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Kd(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ve.UID_BANNED),void this.close()):void this.reconnect(t.action,sr.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=b("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(v.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>b("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sr.TIMEOUT):this.request(de.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-t;this.rttRolling.add(r),b("REPORT_STATS")&&this.send(de.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();e!==0&&t!==0&&this.upload(Hd.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(pe.RECONNECT_WAITTING_FINISH,e=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(pe.RECONNECT_CREATE_CONNECTION,e=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(pe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pe.CLOSED,()=>{this.connectionState=He.CLOSED}),this.websocket.on(pe.FAILED,()=>{this._disconnectedReason=Ve.NETWORK_ERROR,this.connectionState=He.CLOSED}),this.websocket.on(pe.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===He.CONNECTED?this.connectionState=He.RECONNECTING:this.connectionState=He.CONNECTING}),this.websocket.on(pe.WILL_RECONNECT,(e,t,r)=>{let n=Wd(this,he.IS_P2P_DISCONNECTED),i=n||e!=="retry";n&&e==="retry"&&(v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=_f.P2P_DISCONNECTED),i&&(v.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(he.REPORT_JOIN_GATEWAY,t||_f.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(he.DISCONNECT_P2P)),r(e)}),this.websocket.on(pe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",sr.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(he.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof M){if(e.code===C.UNEXPECTED_RESPONSE&&e.data.code===ae.ERR_NO_AUTHORIZED)return this.initError=new M(C.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",sr.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sr.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(pe.REQUEST_NEW_URLS,(e,t)=>{lr(this,he.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Gx.PRE_CONNECT_PC,()=>{this.emit(he.PRE_CONNECT_PC)})}},It=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function pb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function _p(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pb(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jc(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(b("TURN_DOMAIN")):(v.info("Unidentified as ip: ".concat(e,", use as host")),e)}function NR(e,t){e.addresses||(e.addresses=[]);let r=function(s,c){if(b("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return s.map(d=>{let{ip:h,port:p}=d;return{address:"".concat(h,":").concat(p)}});let l=b("GATEWAY_DOMAINS"),u=l[1]&&q(c).call(c,l[1])?1:0;return s.map(d=>{let{domain_prefix:h,port:p,ip:m}=d;if(h)return{address:"".concat(h,".").concat(l[u++%l.length],":").concat(p)};let f=/^[\.\:\d]+$/.test(m),_=f?"".concat(m.replace(/[^\d]/g,"-"),".").concat(l[u++%l.length],":").concat(p):"".concat(m,":").concat(p);return f||v.info("Unidentified as ip: ".concat(m,", use as host")),{ip:m,port:p,address:_}})}(e.addresses,t),n=Array.isArray(e.detail)&&e.detail[18];if(n&&typeof n=="string"){let s=n.split(";");for(let c=0;c<s.length;c++){var i;let l=Ar(i=s[c]).call(i);r[c]&&l&&(r[c].ip6=l)}}let o=e.detail&&e.detail.candidate,a;if(o){let[s,c]=o.split(":");s&&c&&(a={port:Number(c),ip:s,address:"".concat(s,":").concat(c)})}return{gatewayAddrs:r,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function hn(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function fb(e){let t=e._encoderConfig;if(!t)return{};let r={resolution:t.width&&t.height?"".concat(hn(t.width),"x").concat(hn(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function mb(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Yd(e,t){let r,n,i;switch(t){case It.CHOOSE_SERVER:n=4096,i="choose server";break;case It.CLOUD_PROXY:n=1048576,i="proxy";break;case It.CLOUD_PROXY_5:n=4194304,i="proxy5";break;case It.CLOUD_PROXY_FALLBACK:n=4194310,i="proxy fallback";break;default:throw new M(C.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(o=>{o.buffer&&o.buffer.flag===n&&(r={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(a=>_p(_p({},a),{},{ticket:o.buffer.cert})),server_ts:e.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:_p(_p({},o.buffer.detail),e.detail),flag:o.buffer.flag,opid:e.opid,cert:o.buffer.cert})}),!r)throw new M(C.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function Hx(e,t){return await Y.all(e.addresses.map(async r=>({address:Jc(r.ip),tcpport:r.port,udpport:r.port,username:t&&b("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ir.username,password:t&&b("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await pT(t.toString()):ir.password})))}function vT(e,t){let r=t.getMediaStreamTrack(!0).getSettings(),n=t.videoHeight||r.height,i=t.videoWidth||r.width;return n&&i?Math.max(Math.min(n,i)/Math.min(hn(e.height),hn(e.width)),1):(v.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Da(e){let{candidateType:t,relayProtocol:r,type:n,address:i,port:o,protocol:a}=e;return n==="local-candidate"?{candidateType:t,relayProtocol:r,protocol:a}:{candidateType:t,relayProtocol:r,address:i,port:o,protocol:a}}var ii,mq=Tt(Fx),_q=Ai("Array").values,Eq=Ao,gq=Er,vq=Br,Sq=_q,wg=Array.prototype,Tq={DOMTokenList:!0,NodeList:!0},yq=function(e){var t=e.values;return e===wg||vq(wg,e)&&t===wg.values||gq(Tq,Eq(e))?Sq:t},Jo=Tt(yq),_b=Jn,Rq=Dt,Cq=hr,Iq=Mt,Ag=n_,wq=mh,Aq=qm,bq=wo,Oq=Xm,Ec=Object.assign,Eb=Object.defineProperty,Nq=Rq([].concat),Pq=!Ec||Iq(function(){if(_b&&Ec({b:1},Ec(Eb({},"a",{enumerable:!0,get:function(){Eb(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(i){t[i]=i}),Ec({},e)[r]!=7||Ag(Ec({},t)).join("")!=n})?function(e,t){for(var r=bq(e),n=arguments.length,i=1,o=wq.f,a=Aq.f;n>i;)for(var s,c=Oq(arguments[i++]),l=o?Nq(Ag(c),o(c)):Ag(c),u=l.length,d=0;u>d;)s=l[d++],_b&&!Cq(a,c,s)||(r[s]=c[s]);return r}:Ec,Dq=nn,kq=e2,Lq=is,Mq=hr,Uq=wo,xq=function(e,t,r,n){try{return n?t(Dq(r)[0],r[1]):t(r)}catch(i){kq(e,"throw",i)}},Vq=ZM,Fq=a_,jq=ia,gb=l_,Bq=qy,Gq=i_,vb=Array,ic=Dt,bg=2147483647,Wq=/[^\0-\u007E]/,Kx=/[.\u3002\uFF0E\uFF61]/g,Sb="Overflow: input needs wider integers to process",Tb=RangeError,Hq=ic(Kx.exec),Qc=Math.floor,Og=String.fromCharCode,yb=ic("".charCodeAt),zx=ic([].join),_a=ic([].push),Kq=ic("".replace),zq=ic("".split),Yq=ic("".toLowerCase),Rb=function(e){return e+22+75*(e<26)},$q=function(e,t,r){var n=0;for(e=r?Qc(e/700):e>>1,e+=Qc(e/t);e>455;)e=Qc(e/35),n+=36;return Qc(n+36*e/(e+38))},qq=function(e){var t=[];e=function(E){for(var g=[],T=0,R=E.length;T<R;){var w=yb(E,T++);if(w>=55296&&w<=56319&&T<R){var A=yb(E,T++);(64512&A)==56320?_a(g,((1023&w)<<10)+(1023&A)+65536):(_a(g,w),T--)}else _a(g,w)}return g}(e);var r,n,i=e.length,o=128,a=0,s=72;for(r=0;r<e.length;r++)(n=e[r])<128&&_a(t,Og(n));var c=t.length,l=c;for(c&&_a(t,"-");l<i;){var u=bg;for(r=0;r<e.length;r++)(n=e[r])>=o&&n<u&&(u=n);var d=l+1;if(u-o>Qc((bg-a)/d))throw Tb(Sb);for(a+=(u-o)*d,o=u,r=0;r<e.length;r++){if((n=e[r])<o&&++a>bg)throw Tb(Sb);if(n==o){for(var h=a,p=36;;){var m=p<=s?1:p>=s+26?26:p-s;if(h<m)break;var f=h-m,_=36-m;_a(t,Og(Rb(m+f%_))),h=Qc(f/_),p+=36}_a(t,Og(Rb(h))),s=$q(a,d,l==c),a=0,l++}}a++,o++}return zx(t,"")},Xq=ze,PR=Jn,Jq=_R,DR=ur,Cb=is,bi=Dt,Ep=as,oi=o_,Qq=Qy,ST=Er,kR=Pq,gc=function(e){var t=Uq(e),r=Fq(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=i!==void 0;o&&(i=Lq(i,n>2?arguments[2]:void 0));var a,s,c,l,u,d,h=Gq(t),p=0;if(!h||this===vb&&Vq(h))for(a=jq(t),s=r?new this(a):vb(a);a>p;p++)d=o?i(t[p],p):t[p],gb(s,p,d);else for(u=(l=Bq(t,h)).next,s=r?new this:[];!(c=Mq(u,l)).done;p++)d=o?xq(l,i,[c.value,p],!0):c.value,gb(s,p,d);return s.length=p,s},Di=sR,Zq=aR.codeAt,eX=function(e){var t,r,n=[],i=zq(Kq(Yq(e),Kx,"."),".");for(t=0;t<i.length;t++)r=i[t],_a(n,Hq(Wq,r)?"xn--"+qq(r):r);return zx(n,".")},Uo=Qn,tX=ss,rX=s_,Yx=vY,$x=nc,nX=$x.set,hm=$x.getterFor("URL"),iX=Yx.URLSearchParams,oX=Yx.getState,vu=DR.URL,TT=DR.TypeError,gp=DR.parseInt,aX=Math.floor,Ib=Math.pow,pi=bi("".charAt),Mi=bi(/./.exec),Uu=bi([].join),sX=bi(1 .toString),cX=bi([].pop),vc=bi([].push),Ng=bi("".replace),lX=bi([].shift),uX=bi("".split),xu=bi("".slice),Ef=bi("".toLowerCase),dX=bi([].unshift),Pg="Invalid scheme",Su="Invalid host",wb="Invalid port",qx=/[a-z]/i,hX=/[\d+-.a-z]/i,Dg=/\d/,pX=/^0x/i,fX=/^[0-7]+$/,mX=/^\d+$/,Ab=/^[\da-f]+$/i,_X=/[\0\t\n\r #%/:<>?@[\\\]^|]/,EX=/[\0\t\n\r #/:<>?@[\\\]^|]/,gX=/^[\u0000-\u0020]+/,vX=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,SX=/[\t\n\r]/g,Tu=function(e){var t,r,n,i;if(typeof e=="number"){for(t=[],r=0;r<4;r++)dX(t,e%256),e=aX(e/256);return Uu(t,".")}if(typeof e=="object"){for(t="",n=function(o){for(var a=null,s=1,c=null,l=0,u=0;u<8;u++)o[u]!==0?(l>s&&(a=c,s=l),c=null,l=0):(c===null&&(c=u),++l);return l>s&&(a=c,s=l),a}(e),r=0;r<8;r++)i&&e[r]===0||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=sX(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},gf={},Xx=kR({},gf,{" ":1,'"':1,"<":1,">":1,"`":1}),Jx=kR({},Xx,{"#":1,"?":1,"{":1,"}":1}),kg=kR({},Jx,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),la=function(e,t){var r=Zq(e,0);return r>32&&r<127&&!ST(t,e)?e:encodeURIComponent(e)},vp={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Vu=function(e,t){var r;return e.length==2&&Mi(qx,pi(e,0))&&((r=pi(e,1))==":"||!t&&r=="|")},bb=function(e){var t;return e.length>1&&Vu(xu(e,0,2))&&(e.length==2||(t=pi(e,2))==="/"||t==="\\"||t==="?"||t==="#")},TX=function(e){return e==="."||Ef(e)==="%2e"},Lg={},Ob={},Mg={},Nb={},Pb={},Ug={},Db={},kb={},Sp={},Tp={},xg={},Vg={},Fg={},jg={},Lb={},Bg={},Sc={},to={},Mb={},us={},Do={},LR=function(e,t,r){var n,i,o,a=Uo(e);if(t){if(i=this.parse(a))throw TT(i);this.searchParams=null}else{if(r!==void 0&&(n=new LR(r,!0)),i=this.parse(a,null,n))throw TT(i);(o=oX(new iX)).bindURL(this),this.searchParams=o}};LR.prototype={type:"URL",parse:function(e,t,r){var n,i,o,a,s,c=this,l=t||Lg,u=0,d="",h=!1,p=!1,m=!1;for(e=Uo(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=Ng(e,gX,""),e=Ng(e,vX,"$1")),e=Ng(e,SX,""),n=gc(e);u<=n.length;){switch(i=n[u],l){case Lg:if(!i||!Mi(qx,i)){if(t)return Pg;l=Mg;continue}d+=Ef(i),l=Ob;break;case Ob:if(i&&(Mi(hX,i)||i=="+"||i=="-"||i=="."))d+=Ef(i);else{if(i!=":"){if(t)return Pg;d="",l=Mg,u=0;continue}if(t&&(c.isSpecial()!=ST(vp,d)||d=="file"&&(c.includesCredentials()||c.port!==null)||c.scheme=="file"&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&vp[c.scheme]==c.port&&(c.port=null));d="",c.scheme=="file"?l=jg:c.isSpecial()&&r&&r.scheme==c.scheme?l=Nb:c.isSpecial()?l=kb:n[u+1]=="/"?(l=Pb,u++):(c.cannotBeABaseURL=!0,vc(c.path,""),l=Mb)}break;case Mg:if(!r||r.cannotBeABaseURL&&i!="#")return Pg;if(r.cannotBeABaseURL&&i=="#"){c.scheme=r.scheme,c.path=Di(r.path),c.query=r.query,c.fragment="",c.cannotBeABaseURL=!0,l=Do;break}l=r.scheme=="file"?jg:Ug;continue;case Nb:if(i!="/"||n[u+1]!="/"){l=Ug;continue}l=Sp,u++;break;case Pb:if(i=="/"){l=Tp;break}l=to;continue;case Ug:if(c.scheme=r.scheme,i==ii)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Di(r.path),c.query=r.query;else if(i=="/"||i=="\\"&&c.isSpecial())l=Db;else if(i=="?")c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Di(r.path),c.query="",l=us;else{if(i!="#"){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Di(r.path),c.path.length--,l=to;continue}c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Di(r.path),c.query=r.query,c.fragment="",l=Do}break;case Db:if(!c.isSpecial()||i!="/"&&i!="\\"){if(i!="/"){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,l=to;continue}l=Tp}else l=Sp;break;case kb:if(l=Sp,i!="/"||pi(d,u+1)!="/")continue;u++;break;case Sp:if(i!="/"&&i!="\\"){l=Tp;continue}break;case Tp:if(i=="@"){h&&(d="%40"+d),h=!0,o=gc(d);for(var f=0;f<o.length;f++){var _=o[f];if(_!=":"||m){var E=la(_,kg);m?c.password+=E:c.username+=E}else m=!0}d=""}else if(i==ii||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()){if(h&&d=="")return"Invalid authority";u-=gc(d).length+1,d="",l=xg}else d+=i;break;case xg:case Vg:if(t&&c.scheme=="file"){l=Bg;continue}if(i!=":"||p){if(i==ii||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()){if(c.isSpecial()&&d=="")return Su;if(t&&d==""&&(c.includesCredentials()||c.port!==null))return;if(a=c.parseHost(d))return a;if(d="",l=Sc,t)return;continue}i=="["?p=!0:i=="]"&&(p=!1),d+=i}else{if(d=="")return Su;if(a=c.parseHost(d))return a;if(d="",l=Fg,t==Vg)return}break;case Fg:if(!Mi(Dg,i)){if(i==ii||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()||t){if(d!=""){var g=gp(d,10);if(g>65535)return wb;c.port=c.isSpecial()&&g===vp[c.scheme]?null:g,d=""}if(t)return;l=Sc;continue}return wb}d+=i;break;case jg:if(c.scheme="file",i=="/"||i=="\\")l=Lb;else{if(!r||r.scheme!="file"){l=to;continue}if(i==ii)c.host=r.host,c.path=Di(r.path),c.query=r.query;else if(i=="?")c.host=r.host,c.path=Di(r.path),c.query="",l=us;else{if(i!="#"){bb(Uu(Di(n,u),""))||(c.host=r.host,c.path=Di(r.path),c.shortenPath()),l=to;continue}c.host=r.host,c.path=Di(r.path),c.query=r.query,c.fragment="",l=Do}}break;case Lb:if(i=="/"||i=="\\"){l=Bg;break}r&&r.scheme=="file"&&!bb(Uu(Di(n,u),""))&&(Vu(r.path[0],!0)?vc(c.path,r.path[0]):c.host=r.host),l=to;continue;case Bg:if(i==ii||i=="/"||i=="\\"||i=="?"||i=="#"){if(!t&&Vu(d))l=to;else if(d==""){if(c.host="",t)return;l=Sc}else{if(a=c.parseHost(d))return a;if(c.host=="localhost"&&(c.host=""),t)return;d="",l=Sc}continue}d+=i;break;case Sc:if(c.isSpecial()){if(l=to,i!="/"&&i!="\\")continue}else if(t||i!="?")if(t||i!="#"){if(i!=ii&&(l=to,i!="/"))continue}else c.fragment="",l=Do;else c.query="",l=us;break;case to:if(i==ii||i=="/"||i=="\\"&&c.isSpecial()||!t&&(i=="?"||i=="#")){if((s=Ef(s=d))===".."||s==="%2e."||s===".%2e"||s==="%2e%2e"?(c.shortenPath(),i=="/"||i=="\\"&&c.isSpecial()||vc(c.path,"")):TX(d)?i=="/"||i=="\\"&&c.isSpecial()||vc(c.path,""):(c.scheme=="file"&&!c.path.length&&Vu(d)&&(c.host&&(c.host=""),d=pi(d,0)+":"),vc(c.path,d)),d="",c.scheme=="file"&&(i==ii||i=="?"||i=="#"))for(;c.path.length>1&&c.path[0]==="";)lX(c.path);i=="?"?(c.query="",l=us):i=="#"&&(c.fragment="",l=Do)}else d+=la(i,Jx);break;case Mb:i=="?"?(c.query="",l=us):i=="#"?(c.fragment="",l=Do):i!=ii&&(c.path[0]+=la(i,gf));break;case us:t||i!="#"?i!=ii&&(i=="'"&&c.isSpecial()?c.query+="%27":c.query+=i=="#"?"%23":la(i,gf)):(c.fragment="",l=Do);break;case Do:i!=ii&&(c.fragment+=la(i,Xx))}u++}},parseHost:function(e){var t,r,n;if(pi(e,0)=="["){if(pi(e,e.length-1)!="]"||(t=function(i){var o,a,s,c,l,u,d,h=[0,0,0,0,0,0,0,0],p=0,m=null,f=0,_=function(){return pi(i,f)};if(_()==":"){if(pi(i,1)!=":")return;f+=2,m=++p}for(;_();){if(p==8)return;if(_()!=":"){for(o=a=0;a<4&&Mi(Ab,_());)o=16*o+gp(_(),16),f++,a++;if(_()=="."){if(a==0||(f-=a,p>6))return;for(s=0;_();){if(c=null,s>0){if(!(_()=="."&&s<4))return;f++}if(!Mi(Dg,_()))return;for(;Mi(Dg,_());){if(l=gp(_(),10),c===null)c=l;else{if(c==0)return;c=10*c+l}if(c>255)return;f++}h[p]=256*h[p]+c,++s!=2&&s!=4||p++}if(s!=4)return;break}if(_()==":"){if(f++,!_())return}else if(_())return;h[p++]=o}else{if(m!==null)return;f++,m=++p}}if(m!==null)for(u=p-m,p=7;p!=0&&u>0;)d=h[p],h[p--]=h[m+u-1],h[m+--u]=d;else if(p!=8)return;return h}(xu(e,1,-1)),!t))return Su;this.host=t}else if(this.isSpecial()){if(e=eX(e),Mi(_X,e)||(t=function(i){var o,a,s,c,l,u,d,h=uX(i,".");if(h.length&&h[h.length-1]==""&&h.length--,(o=h.length)>4)return i;for(a=[],s=0;s<o;s++){if((c=h[s])=="")return i;if(l=10,c.length>1&&pi(c,0)=="0"&&(l=Mi(pX,c)?16:8,c=xu(c,l==8?1:2)),c==="")u=0;else{if(!Mi(l==10?mX:l==8?fX:Ab,c))return i;u=gp(c,l)}vc(a,u)}for(s=0;s<o;s++)if(u=a[s],s==o-1){if(u>=Ib(256,5-o))return null}else if(u>255)return null;for(d=cX(a),s=0;s<a.length;s++)d+=a[s]*Ib(256,3-s);return d}(e),t===null))return Su;this.host=t}else{if(Mi(EX,e))return Su;for(t="",r=gc(e),n=0;n<r.length;n++)t+=la(r[n],gf);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return ST(vp,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&Vu(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,l=t+":";return i!==null?(l+="//",e.includesCredentials()&&(l+=r+(n?":"+n:"")+"@"),l+=Tu(i),o!==null&&(l+=":"+o)):t=="file"&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+Uu(a,"/"):"",s!==null&&(l+="?"+s),c!==null&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw TT(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Ol(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+Tu(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Uo(e)+":",Lg)},getUsername:function(){return this.username},setUsername:function(e){var t=gc(Uo(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=la(t[r],kg)}},getPassword:function(){return this.password},setPassword:function(e){var t=gc(Uo(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=la(t[r],kg)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Tu(e):Tu(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,xg)},getHostname:function(){var e=this.host;return e===null?"":Tu(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Vg)},getPort:function(){var e=this.port;return e===null?"":Uo(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Uo(e))==""?this.port=null:this.parse(e,Fg))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Uu(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Sc))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Uo(e))==""?this.query=null:(pi(e,0)=="?"&&(e=xu(e,1)),this.query="",this.parse(e,us)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Uo(e))!=""?(pi(e,0)=="#"&&(e=xu(e,1)),this.fragment="",this.parse(e,Do)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ol=function(e){var t=Qq(this,on),r=rX(arguments.length,1)>1?arguments[1]:void 0,n=nX(t,new LR(e,!1,r));PR||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},on=Ol.prototype,ai=function(e,t){return{get:function(){return hm(this)[e]()},set:t&&function(r){return hm(this)[t](r)},configurable:!0,enumerable:!0}};PR&&(oi(on,"href",ai("serialize","setHref")),oi(on,"origin",ai("getOrigin")),oi(on,"protocol",ai("getProtocol","setProtocol")),oi(on,"username",ai("getUsername","setUsername")),oi(on,"password",ai("getPassword","setPassword")),oi(on,"host",ai("getHost","setHost")),oi(on,"hostname",ai("getHostname","setHostname")),oi(on,"port",ai("getPort","setPort")),oi(on,"pathname",ai("getPathname","setPathname")),oi(on,"search",ai("getSearch","setSearch")),oi(on,"searchParams",ai("getSearchParams")),oi(on,"hash",ai("getHash","setHash"))),Ep(on,"toJSON",function(){return hm(this).serialize()},{enumerable:!0}),Ep(on,"toString",function(){return hm(this).serialize()},{enumerable:!0}),vu&&(Gg=vu.createObjectURL,Wg=vu.revokeObjectURL,Gg&&Ep(Ol,"createObjectURL",Cb(Gg,vu)),Wg&&Ep(Ol,"revokeObjectURL",Cb(Wg,vu)));var Gg,Wg;tX(Ol,"URL"),Xq({global:!0,constructor:!0,forced:!Jq,sham:!PR},{URL:Ol});var yX=ze,RX=Mt,CX=s_,Ub=Qn,IX=_R,xb=_n("URL");yX({target:"URL",stat:!0,forced:!(IX&&RX(function(){xb.canParse()}))},{canParse:function(e){var t=CX(arguments.length,1),r=Ub(e),n=t<2||arguments[1]===void 0?void 0:Ub(arguments[1]);try{return!!new xb(r,n)}catch{return!1}}});var Vb=Tt(Xi.URL),Yt={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Pe(){return Yt}function Qx(){return"setSinkId"in HTMLAudioElement.prototype&&(!b("RESTRICTION_SET_PLAYBACK_DEVICE")||(Wa()||Sx())&&!yR())}function Fb(){return!Yt.supportUnifiedPlan||b("CHROME_FORCE_PLAN_B")&&Ja()}var Jt=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Tc(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function be(e,t,r,n,i){return{width:e,height:t,frameRate:r,bitrateMin:n,bitrateMax:i}}function si(e,t,r,n,i){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:n,bitrateMax:i}}function Hg(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}var wX={"90p":be(160,90),"90p_1":be(160,90),"120p":be(160,120,15,30,65),"120p_1":be(160,120,15,30,65),"120p_3":be(120,120,15,30,50),"120p_4":be(212,120),"180p":be(320,180,15,30,140),"180p_1":be(320,180,15,30,140),"180p_3":be(180,180,15,30,100),"180p_4":be(240,180,15,30,120),"240p":be(320,240,15,40,200),"240p_1":be(320,240,15,40,200),"240p_3":be(240,240,15,40,140),"240p_4":be(424,240,15,40,220),"360p":be(640,360,15,80,400),"360p_1":be(640,360,15,80,400),"360p_3":be(360,360,15,80,260),"360p_4":be(640,360,30,80,600),"360p_6":be(360,360,30,80,400),"360p_7":be(480,360,15,80,320),"360p_8":be(480,360,30,80,490),"360p_9":be(640,360,15,80,800),"360p_10":be(640,360,24,80,800),"360p_11":be(640,360,24,80,1e3),"480p":be(640,480,15,100,500),"480p_1":be(640,480,15,100,500),"480p_2":be(640,480,30,100,1e3),"480p_3":be(480,480,15,100,400),"480p_4":be(640,480,30,100,750),"480p_6":be(480,480,30,100,600),"480p_8":be(848,480,15,100,610),"480p_9":be(848,480,30,100,930),"480p_10":be(640,480,10,100,400),"720p":be(1280,720,15,120,1130),"720p_auto":be(1280,720,30,900,3e3),"720p_1":be(1280,720,15,120,1130),"720p_2":be(1280,720,30,120,2e3),"720p_3":be(1280,720,30,120,1710),"720p_5":be(960,720,15,120,910),"720p_6":be(960,720,30,120,1380),"1080p":be(1920,1080,15,120,2080),"1080p_1":be(1920,1080,15,120,2080),"1080p_2":be(1920,1080,30,120,3e3),"1080p_3":be(1920,1080,30,120,3150),"1080p_5":be(1920,1080,60,120,4780),"1440p":be(2560,1440,30,120,4850),"1440p_1":be(2560,1440,30,120,4850),"1440p_2":be(2560,1440,60,120,7350),"4k":be(3840,2160,30,120,8910),"4k_1":be(3840,2160,30,120,8910),"4k_3":be(3840,2160,60,120,13500)},AX={"480p":si(640,480,5),"480p_1":si(640,480,5),"480p_2":si(640,480,30),"480p_3":si(640,480,15),"720p":si(1280,720,5),"720p_auto":be(1280,720,30,900,3e3),"720p_1":si(1280,720,5),"720p_2":si(1280,720,30),"720p_3":si(1280,720,15),"1080p":si(1920,1080,5),"1080p_1":si(1920,1080,5),"1080p_2":si(1920,1080,30),"1080p_3":si(1920,1080,15)},bX={"1SL1TL":Hg(1,1),"3SL3TL":Hg(3,3),"2SL3TL":Hg(2,3)};function Eo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},wX[e]):e}function Kg(e){return typeof e=="string"?Object.assign({},AX[e]):e}function yp(e){return typeof e=="string"?Object.assign({},bX[e]):e}var OX={speech_low_quality:Tc(16e3,!1),speech_standard:Tc(32e3,!1,18),music_standard:Tc(48e3,!1),standard_stereo:Tc(48e3,!0,56),high_quality:Tc(48e3,!1,128),high_quality_stereo:Tc(48e3,!0,192)};function pm(e){return typeof e=="string"?Object.assign({},OX[e]):e}var Oc=[];function jb(e){return Ut(e,"mediaSource",["screen","window","application"]),!0}var X=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),et=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),Nl=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),NX=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),PX=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),Fs=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),zl=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),ul=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Yl=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),wn=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});var yT={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},RT={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Zx={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},DX={uplinkNetworkQuality:0,downlinkNetworkQuality:0},eV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Fr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Dn=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),yu=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Ns=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Ir=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ro=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),zg={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},vf=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Oe(e,t,r,n,i){var o,a,s={};return Object.keys(n).forEach(function(c){s[c]=n[c]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=qi(o=mq(a=r.slice()).call(a)).call(o,function(c,l){return l(e,t,c)||c},s),i&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,t,s),s=null),s}function j(e,t,r){return(t=function(n){var i=function(o,a){if(typeof o!="object"||!o)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var c=s.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function rt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Bb(Object(r),!0).forEach(function(n){j(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var tV=class extends lt{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Fs.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),j(this,"trackMediaType",void 0),j(this,"_ID",void 0),j(this,"_rtpTransceiver",void 0),j(this,"_lowRtpTransceiver",void 0),j(this,"_hints",[]),j(this,"_isClosed",!1),j(this,"_originMediaStreamTrack",void 0),j(this,"mediaStreamTrack",void 0),j(this,"_external",{}),this._ID=t||Ke(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(r){q(Oc).call(Oc,r)||Oc.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Qa(()=>{var t;te.reportApiInvoke(null,{name:Lt.GET_MEDIA_STREAM_TRACK,options:[],tag:pt.TRACER}).onSuccess(((t=this._mediaStreamTrack)===null||t===void 0?void 0:t.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Nl.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){let t=Oc.indexOf(e);t!==-1&&Oc.splice(t,1)}(this),this.emit(zl.CLOSED),this.removeAllListeners(Fs.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===Nl.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Fs.TRANSCEIVER_UPDATED,e,t)}},Zc=class extends tV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),j(this,"_enabled",!0),j(this,"_muted",!1),j(this,"_isExternalTrack",!1),j(this,"_isClosed",!1),j(this,"_enabledMutex",void 0),j(this,"processor",void 0),j(this,"_processorContext",void 0),j(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new _r("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return(e=(t=this._originMediaStreamTrack)===null||t===void 0?void 0:t.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(X.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await We(this,X.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(zl.TRACK_ENDED)}stateCheck(e,t){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),Ho(t,e),this._enabled&&this._muted&&e==="enabled"&&t===!1)throw new V(C.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",v);if(!this._enabled&&!this._muted&&e==="muted"&&t===!0)throw new V(C.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",v)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Y.resolve([])}},Gb=window.AudioContext||window.webkitAudioContext,vn=null,Fe=new class extends lt{constructor(){super(...arguments),j(this,"prevState",void 0),j(this,"curState",void 0),j(this,"currentTime",void 0),j(this,"currentTimeStuckAt",void 0),j(this,"interruptDetectorTrack",void 0),j(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit(Jt.IOS_15_16_INTERRUPTION_START)}),j(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(vn&&await vn.suspend(),this.emit(Jt.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){v.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){v.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function $l(){if(!vn){if(function(){if(!Gb)return void v.error("your browser is not support web audio");v.info("create audio context");let e=rt({},b("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(e)),vn=new Gb(e),Fe.curState=vn.state,vn.onstatechange=()=>{Fe.prevState=Fe.curState,Fe.curState=vn?vn.state:void 0;let{prevState:t,curState:r}=Fe,n=r==="running",i=r==="interrupted",o=t==="running",a=t==="suspended",s=t==="interrupted",c=Ne().osVersion;(Vr()||yi())&&o&&i&&(v.info("ios".concat(c,"-interruption-start")),Fe.emit(Jt.IOS_INTERRUPTION_START)),(Vr()||yi())&&(a||s)&&n&&(v.info("ios".concat(c,"-interruption-end")),Fe.emit(Jt.IOS_INTERRUPTION_END)),t!==r&&Fe.emit(Jt.STATE_CHANGE,r,t)},setInterval(()=>{var t;let r=(t=vn)===null||t===void 0?void 0:t.currentTime;Fe.currentTime!==r?(Fe.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(r)),Fe.currentTimeStuckAt=void 0),Fe.currentTime=r):(r!==Fe.currentTimeStuckAt&&(te.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:pt.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(r))),Fe.currentTimeStuckAt=r)},5e3),async function(t){let r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],n,i=!1,o=!1,a=!1;function s(f){t.state==="running"?c(!1):Vr()||yi()?t.state==="suspended"&&(c(!0),f&&t.resume().then(l,l)):t.state!=="closed"&&(c(!0),f&&t.resume().then(l,l))}function c(f){if(i!==f){i=f;for(let _=0,E=r;_<E.length;_+=1){let g=E[_];f?window.addEventListener(g,u,{capture:!0,passive:!0}):window.removeEventListener(g,u,{capture:!0,passive:!0})}}}function l(){s(!1)}function u(){s(!0)}function d(f){if(!a)if(n.paused)if(f){let _;h(!1),a=!0;try{_=n.play(),_?_.then(p,p):(n.addEventListener("playing",p),n.addEventListener("abort",p),n.addEventListener("error",p))}catch{p()}}else h(!0);else h(!1)}function h(f){if(o!==f){o=f;for(let _=0,E=r;_<E.length;_++){let g=E[_];f?window.addEventListener(g,m,{capture:!0,passive:!0}):window.removeEventListener(g,m,{capture:!0,passive:!0})}}}function p(){n.removeEventListener("playing",p),n.removeEventListener("abort",p),n.removeEventListener("error",p),a=!1,d(!1)}function m(){d(!0)}if(Vr()){let f=t.createMediaStreamDestination(),_=document.createElement("div");_.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=_.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=f.stream,d(!0)}Fe.on(Jt.STATE_CHANGE,function(){s(!0)}),s(!1)}(vn)}(),!vn)throw new V(C.NOT_SUPPORTED,"can not create audio context");return vn}return vn}function Es(e){if(function(){if(Yg!==null)return Yg;let n=$l(),i=n.createBufferSource(),o=n.createGain(),a=n.createGain();i.connect(o),i.connect(a),i.disconnect(o);let s=!1;try{i.disconnect(o)}catch{s=!0}return i.disconnect(),Yg=s,s}())return;let t=e.connect,r=e.disconnect;e.connect=(n,i,o)=>{var a;return e._inputNodes||(e._inputNodes=[]),q(a=e._inputNodes).call(a,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,i,o)):t.call(e,n,i)),e},e.disconnect=(n,i,o)=>{r.call(e),n?dm(e._inputNodes,n):e._inputNodes=[];for(let a of e._inputNodes)t.call(e,a)}}var Yg=null;function MR(e,t){let r=!1,n=1/t;if(b("DISABLE_WEBAUDIO")){let i=window.setInterval(()=>{r?window.clearInterval(i):e(performance.now()/1e3)},1e3*n)}else{let i=$l(),o=i.createGain();o.gain.value=0,o.connect(i.destination);let a=()=>{if(r)return void(o=null);let s=i.createOscillator();s.onended=a,s.connect(o),s.start(0),s.stop(i.currentTime+n),e(i.currentTime)};a()}return()=>{r=!0}}var rV=class{constructor(){j(this,"context",void 0),j(this,"analyserNode",void 0),j(this,"sourceNode",void 0),this.context=$l(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Vr()||yi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let n=0;n<e.length;++n)e[n]=r[n]/128-1}let t=qi(e).call(e,(r,n)=>r+n*n,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(t=this.sourceNode)===null||t===void 0||t.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}},nV=class extends lt{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(t=this._processedNode)===null||t===void 0||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),j(this,"outputNode",void 0),j(this,"outputTrack",void 0),j(this,"isPlayed",!1),j(this,"sourceNode",void 0),j(this,"context",void 0),j(this,"audioBufferNode",void 0),j(this,"destNode",void 0),j(this,"audioOutputLevel",0),j(this,"volumeLevelAnalyser",void 0),j(this,"_processedNode",void 0),j(this,"playNode",void 0),j(this,"isDestroyed",!1),j(this,"onNoAudioInput",void 0),j(this,"isNoAudioInput",!1),j(this,"_noAudioInputCount",0),this.context=$l(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Es(this.outputNode),this.volumeLevelAnalyser=new rV}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t=>{this.emit(wn.ON_AUDIO_BUFFER,function(r){for(let n=0;n<r.outputBuffer.numberOfChannels;n+=1){let i=r.outputBuffer.getChannelData(n);for(let o=0;o<i.length;o+=1)i[o]=0}return r.inputBuffer}(t))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Pe().webAudioMediaStreamDest)throw new V(C.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&__(()=>{Fe.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Vr()||yi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let t=this.volumeLevelAnalyser.getAnalyserNode(),r;t.getFloatTimeDomainData?(r=new Float32Array(t.fftSize),t.getFloatTimeDomainData(r)):(r=new Uint8Array(t.fftSize),t.getByteTimeDomainData(r));let n=!1;for(let i=0;i<r.length;i++)r[i]!==0&&(n=!0);return n?(this.isNoAudioInput=!1,!0):(await er(200),await this.checkHasAudioInput(e?e+1:1)&&n)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;(e=this.processedNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}},iV=class extends nV{get isFreeze(){return!1}constructor(e,t,r){var n;if(super(),j(this,"sourceNode",void 0),j(this,"track",void 0),j(this,"clonedTrack",void 0),j(this,"audioElement",void 0),j(this,"isCurrentTrackCloned",!1),j(this,"isRemoteTrack",!1),j(this,"originVolumeLevelAnalyser",void 0),j(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let a=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?a.stop():this.isCurrentTrackCloned=!0;let s=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(s),Es(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let c=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(c,this.context.currentTime),Es(this.outputNode),this.emit(wn.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=s,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new V(C.UNEXPECTED_ERROR);this.track=e;let i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),Es(this.sourceNode),r){let a=r.clone();a.enabled=!0,this.clonedTrack=a,v.debug("create an unmuted track ".concat(a.id," from the original track ").concat(r.id," to get the volume"));let s=this.context.createMediaStreamSource(new MediaStream([a]));Es(s),this.originVolumeLevelAnalyser=new rV,this.originVolumeLevelAnalyser.updateSource(s)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;let o=Ne();t&&o.os===Gt.IOS&&Number((n=o.osVersion)===null||n===void 0?void 0:n.split(".")[0])<15&&(Fe.on(Jt.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(a=>{a||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),Es(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(wn.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Fe.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),v.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let r=this.context.createMediaStreamSource(new MediaStream([t]));Es(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}};async function oV(e,t,r){let n=(o,a)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||a:o:a,i={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function kX(e,t){let r=await aV(e.mediaSource),{sourceId:n,audio:i}=await function(o){let a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Y((s,c)=>{let l=document.createElement("div");l.innerText="share screen",l.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let u=document.createElement("div");u.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let d=document.createElement("div");d.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",d.setAttribute("style","height: 12%;");let h=document.createElement("div");h.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let p=document.createElement("div");p.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let m=document.createElement("button");m.innerHTML="cancel",m.setAttribute("style","width: 85px;"),m.onclick=()=>{document.body.removeChild(E);let g=new Error("NotAllowedError");g.name="NotAllowedError",c(g)};let f=a,_=document.createElement("div");if(a){let g=document.createElement("input");g.setAttribute("type","checkbox");let T=document.createElement("span");g.setAttribute("style","margin-right: 6px;"),T.innerText="Share audio",g.checked=f,g.onchange=()=>{f=g.checked},_.appendChild(g),_.appendChild(T)}p.appendChild(_),p.appendChild(m),u.appendChild(d),u.appendChild(h),u.appendChild(p);let E=document.createElement("div");E.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),E.appendChild(l),E.appendChild(u),document.body.appendChild(E),o.map(g=>{if(g.id){let T=document.createElement("div");T.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let R=g.thumbnail;try{let{width:w}=R.getSize();w>1920&&(R=R.resize({width:1920}))}catch(w){throw w&&w.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),w}T.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+R.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+g.name.replace(/[\u00A0-\u9999<>\&]/g,function(w){return"&#"+w.charCodeAt(0)+";"})+"</span>",T.onclick=()=>{document.body.removeChild(E),s({sourceId:g.id,audio:f})},h.appendChild(T)}})})}(r,t);return await oV(n,e,i)}async function aV(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let r=Ox();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new V(C.ELECTRON_IS_NULL);let n=null;try{var i;n=((i=r.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{n=null}n&&n.then||(n=new Y((o,a)=>{r.desktopCapturer.getSources({types:t},(s,c)=>{s?a(s):o(c)})}));try{return await n}catch(o){throw new V(C.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}var CT=new _r("safari"),sV=!1,cV=!1;async function Cn(e,t){let r=0,n=null;for(;r<2;)try{n=await LX(e,t,r>0);break}catch(i){if(i instanceof V)throw v.error("[".concat(t,"] ").concat(i.toString())),i;let o=Sf(i.name||i.code||i,i.message);if(o.code===C.MEDIA_OPTION_INVALID){v.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await er(500);continue}throw v.error("[".concat(t,"] ").concat(o.toString())),o}if(!n)throw new V(C.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n}async function LX(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new V(C.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let n=Pe(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return v.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(Ox())e.screen.sourceId?yc(i,await oV(e.screen.sourceId,e.screen,e.screenAudio)):yc(i,await kX(e.screen,e.screenAudio));else if(Wa()&&e.screen.extensionId&&e.screen.mandatory){if(!n.getStreamFromExtension)throw new V(C.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let h=await(a=e.screen.extensionId,s=t,new Y((p,m)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},f=>{if(!f||!f.streamId)return v.error("[".concat(s,"] No response from Chrome Plugin. Plugin not installed properly"),f),void m(new V(C.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));p(f.streamId)})}catch(f){v.error("[".concat(s,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),f.toString()),m(new V(C.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=h,yc(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(n.getDisplayMedia){var o;e.screen.mediaSource&&jb(e.screen.mediaSource);let h={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(o=e.screen.displaySurface)!==null&&o!==void 0?o:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:p,surfaceSwitching:m,systemAudio:f}=e.screen,_={selfBrowserSurface:p,surfaceSwitching:m,systemAudio:f};!p&&delete _.selfBrowserSurface,!m&&delete _.surfaceSwitching,!f&&delete _.systemAudio,v.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:h,audio:!!e.screenAudio,controls:_})),yc(i,await navigator.mediaDevices.getDisplayMedia(rt({video:h,audio:!!e.screenAudio},_)))}else{if(!ft())throw v.error("[".concat(t,"] This browser does not support screenSharing")),new V(C.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&jb(e.screen.mediaSource);let h={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};v.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(h))),yc(i,await navigator.mediaDevices.getUserMedia(h))}}var a,s;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},l=b("MEDIA_DEVICE_CONSTRAINTS");if(l)try{typeof l=="string"&&(l=JSON.parse(l)),c=fT(c,l)}catch{}v.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),Ne();let u,d=null;(cr()||Vr()||um())&&(d=await CT.lock());try{u=await navigator.mediaDevices.getUserMedia(c)}catch(h){throw d&&d(),h}return c.audio&&(sV=!0),c.video&&(cV=!0),yc(i,u),d&&d(),i}function Sf(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new V(C.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new V(C.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new V(C.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new V(C.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new V(C.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new V(C.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return v.error("getUserMedia unexpected error",e),new V(C.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function yc(e,t){let r=e.getVideoTracks()[0],n=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(n&&e.removeTrack(n),e.addTrack(o)),i&&(r&&e.removeTrack(r),e.addTrack(i))}var bn=new class extends lt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Ns.STATE_CHANGE,e),this._state=e)}constructor(){super(),j(this,"_state",yu.IDLE),j(this,"isAccessMicrophonePermission",!1),j(this,"isAccessCameraPermission",!1),j(this,"lastAccessMicrophonePermission",!1),j(this,"lastAccessCameraPermission",!1),j(this,"checkdeviceMatched",!1),j(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(b("ENUMERATE_DEVICES_INTERVAL")||(f_()||p_()===Gt.HARMONY_OS)&&Ja())&&this.updateDevicesInfo()},b("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>v.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new V(C.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let n=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(n),o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(a=!1);let s=null,c=null,l=null;if(!r&&(o||a)){if(CT.isLocked&&(v.debug("[device manager] wait GUM lock"),(await CT.lock())(),v.debug("[device manager] GUM unlock")),sV&&(o=!1,this.isAccessMicrophonePermission=!0),cV&&(a=!1,this.isAccessCameraPermission=!0),v.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(u){let d=Sf(u.name||u.code||u,u.message);if(d.code===C.PERMISSION_DENIED)throw d;v.warning("getUserMedia failed in getDevices",d)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(u){let d=Sf(u.name||u.code||u,u.message);if(d.code===C.PERMISSION_DENIED)throw d;v.warning("getUserMedia failed in getDevices",d)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(u){let d=Sf(u.name||u.code||u,u.message);if(d.code===C.PERMISSION_DENIED)throw d;v.warning("getUserMedia failed in getDevices",d)}this.isAccessCameraPermission=!0}v.debug("[device manager] mic permission",e,"cam permission",t)}try{let u=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach(d=>d.stop()),c&&c.getTracks().forEach(d=>d.stop()),l&&l.getTracks().forEach(d=>d.stop()),s=null,c=null,l=null,u}catch(u){return s&&s.getTracks().forEach(d=>d.stop()),c&&c.getTracks().forEach(d=>d.stop()),l&&l.getTracks().forEach(d=>d.stop()),s=null,c=null,l=null,new V(C.ENUMERATE_DEVICES_FAILED,u.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new V(C.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=yu.INITING;try{await this.updateDevicesInfo(),this.state=yu.INITEND}catch(e){throw v.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=yu.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new V(C.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let i=e.find(a=>a.kind==="audioinput"&&a.deviceId==="default"),o=e.find(a=>a.kind==="audiooutput"&&a.deviceId==="default");i&&o?o.groupId===i.groupId?v.debug("[device-check] default input ".concat(i.label," and output ").concat(o.label," is the same group")):v.warning("[device-check] default input ".concat(i.label," and output ").concat(o.label," is not the same group")):v.debug("[device-check] default input or output not found")}let n=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;let o=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){let a={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),a),r.push(a)}o&&(o.updateAt=t)}),this.deviceInfoMap.forEach((i,o)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",r.push(i))}),this.state!==yu.INITEND)return n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Ns.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Ns.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Ns.PLAYOUT_DEVICE_CHANGED,i)}}),n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(i=>i.kind==="audioinput"),r=e.filter(i=>i.kind==="videoinput"),n={audio:!1,video:!1};for(let i of t)if(i.label&&i.deviceId){n.audio=!0;break}for(let i of r)if(i.label&&i.deviceId){n.video=!0;break}return n}},$g=!1,Sn=new class extends lt{constructor(){super(...arguments),j(this,"onAutoplayFailed",void 0),j(this,"onAudioAutoplayFailed",void 0)}};function lV(){if(Ne(),!$g){let e=t=>{t.preventDefault(),$g=!1,Gd()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};$g=!0,Gd()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Sn.onAutoplayFailed?Sn.onAutoplayFailed():Sn.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Sn.emit("autoplay-failed")}}function uV(e,t,r,n){if(!e)return;let i=te.getBaseInfoBySessionId(e);if(!i)return;let o=i.info,a=Date.now(),s=rt(rt({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:a,elapse:a-i.startTime,cbRegistered:Sn.onAutoplayFailed||Sn.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:n,extend:void 0});te.send({type:st.AUTOPLAY_FAILED,data:s},!0)}var MX=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Kr=new class{constructor(){j(this,"onAutoplayFailed",void 0),j(this,"elementMap",new Map),j(this,"elementStateMap",new Map),j(this,"elementsNeedToResume",[]),j(this,"sinkIdMap",new Map),j(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,n]=t,i=this.elementStateMap.get(r),o=n.srcObject.getAudioTracks()[0],a=o&&o.readyState;if(v.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(a," ").concat(e)),a==="live"){if(e)return n.pause(),void n.play();if(Fe.curState==="running")return wl()?(n.pause(),void n.play()):void(i&&i==="paused"&&n.play())}})}),j(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e,n=r.srcObject.getAudioTracks()[0];n&&n.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Fe.on(Jt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fe.on(Jt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Fe.on(Jt.STATE_CHANGE,()=>{Vr()&&Fe.prevState==="suspended"&&Fe.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(n){throw new V(C.PERMISSION_DENIED,"can not set sink id: "+n.toString())}}play(e,t,r,n){if(this.elementMap.has(t))return;let i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Ir.INIT),this.setVolume(t,r);let o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch(s=>{v.warning("[".concat(t,"] set sink id failed"),s.toString())})}catch(s){v.warning("[".concat(t,"] set sink id failed"),s.toString())}let a=i.play();a&&a.then&&a.catch(s=>{n&&uV(n,"audio",s.message,t),v.warning("audio element play warning",s.toString()),this.elementMap.has(t)&&s.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),__(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),lV()}))})}updateTrack(e,t){let r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){MX.forEach(r=>{t.addEventListener(r,n=>{let i=this.elementStateMap.get(e),o=n.type==="pause"?"paused":n.type;if(v.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(o)),n.type==="error"){let a=t==null?void 0:t.error;a&&v.error("[".concat(e,"] media error, code: ").concat(a.code,", message: ").concat(a.message))}this.elementStateMap.set(e,o)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{v.debug("Auto resume audio element success")}).catch(r=>{v.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new Y(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Gd()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function St(){return function(e,t,r){let n=r.value;return typeof n=="function"&&(r.value=function(){this._isClosed&&new V(C.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",v);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];let s=n.apply(this,o);return s instanceof Y?new Y((c,l)=>{s.then(c).catch(l)}):s}),r}}var dV=class extends lt{constructor(e){super(),j(this,"name","VideoProcessorDestination"),j(this,"ID","0"),j(this,"_source",void 0),j(this,"videoContext",void 0),j(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new V(C.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new V(C.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Fr.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Fr.ON_TRACK,void 0)}},hV=class extends lt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),j(this,"constraintsMap",new Map),j(this,"statsRegistry",[]),j(this,"usageRegistry",[]),j(this,"trackId",void 0),j(this,"direction",void 0),j(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await lr(this,Dn.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var r;return v.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),We(this,Dn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Jo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return v.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),We(this,Dn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Jo(t=this.constraintsMap).call(t)))}registerStats(e,t,r){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:r})}unregisterStats(e,t){let r=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:r,type:n,cb:i}of this.statsRegistry)try{let o=i();e.push({processorID:t,processorName:r,type:n,stats:o})}catch(o){v.error(new V(C.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,t){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let r=t();r instanceof Y&&(r=await r),e.push(rt(rt({},r),{},{direction:this.direction}))}catch(r){v.error("gather extension usage error",r)}return e}getDirection(){return this.direction}},pV=class extends lt{constructor(e){super(),j(this,"name","AudioProcessorDestination"),j(this,"ID","0"),j(this,"inputTrack",void 0),j(this,"inputNode",void 0),j(this,"audioProcessorContext",void 0),j(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new V(C.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new V(C.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Fr.ON_TRACK,void 0),this.emit(Fr.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Fr.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Fr.ON_NODE,this.inputNode))}},fV=class extends lt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,r){super(),j(this,"constraintsMap",new Map),j(this,"statsRegistry",[]),j(this,"audioContext",void 0),j(this,"trackId",void 0),j(this,"direction",void 0),j(this,"usageRegistry",[]),j(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=r}async getConstraints(){return lr(this,Dn.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var r;return v.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),We(this,Dn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Jo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),We(this,Dn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Jo(t=this.constraintsMap).call(t)))}registerStats(e,t,r){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:r})}unregisterStats(e,t){let r=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:r,type:n,cb:i}of this.statsRegistry)try{let o=i();e.push({processorID:t,processorName:r,type:n,stats:o})}catch(o){v.error(new V(C.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,t){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let r=t();r instanceof Y&&(r=await r),e.push(rt(rt({},r),{},{direction:this.direction}))}catch(r){v.error("gather extension usage error",r)}return e}getDirection(){return this.direction}},IT=class extends lt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),j(this,"context",void 0),j(this,"processSourceNode",void 0),j(this,"outputTrack",void 0),j(this,"processedNode",void 0),j(this,"clonedTrack",void 0),j(this,"outputNode",void 0),this.outputNode=new UX}setVolume(){}createOutputTrack(){throw new V(C.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}},UX=class{disconnect(){}connect(){}};function mV(e){return new Y((t,r)=>{let n=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);let o=Vr()?"canplay":"playing";i.addEventListener(o,()=>{let a=i.videoWidth,s=i.videoHeight;!a&&ft()||(n=!0,i.srcObject=null,i.remove(),t([a,s]))}),i.srcObject=new MediaStream([e]),i.play().catch(E_),setTimeout(()=>{n||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function fm(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let r=Eo(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!wx()&&r.frameRate&&(t.frameRate=r.frameRate),Sx()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),ft()&&(t.frameRate={ideal:30,max:30}),t}function Wb(e){let t={};if(wx()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Wa()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){let r=pm(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),f_()&&(t.sampleRate=void 0),t}var xX=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:r,width:n,height:i}=e.getMediaStreamTrackSettings(),{frameRate:o=r,width:a=n,height:s=i}=t;if(!o||!a||!s)return;a=mg(a),s=mg(s),o=mg(o);let{max:c,min:l}=function(p,m,f){let _=200*Math.pow(f/15,.6)*Math.pow(p*m/640/360,.75);return{min:Math.floor(_),max:Math.floor(4*_)}}(a,s,o),{bitrateMax:u,bitrateMin:d}=t||{};u||v.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(u,", brMin: ").concat(d,"]"));let{maxFramerate:h}=b("ENCODER_CONFIG_LIMIT");return h&&typeof h=="number"&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:u||c,bitrateMin:d||l,scaleResolutionDownBy:1,scale:0}},_V=async(e,t,r)=>await(async(n,i,o)=>{let a=function(l){let u=[];for(let d=0;d<l.length;d+=2)u.push(parseInt(l.slice(d,d+2),16));return Uint8Array.from(u)}(kx(""+i+o)).slice(0,16),s=a.slice(0,12),c=await window.crypto.subtle.importKey("raw",a,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},c,n))})(e.buffer,t,r),UR=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new Y((r,n)=>{t.toBlob(async i=>{if(t.remove(),i){let o=await EV(i);r({buffer:o,width:t.width,height:t.height})}else n(new V(C.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},EV=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)},Hb,Kb,zb,Yb,$b,qb,Xb,Jb,Qb,Zb,eO,tO,rO,nO,iO,oO,aO,sO,nt,cO,lO,uO,dO,hO,pO,no,fO,mO,_O,EO,gO,vO,SO,TO,yO,RO,CO,IO,wO,rr,ht=(Hb=ce({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Kb=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),zb=St(),Yb=Al("LocalAudioTrack","_enabledMutex"),$b=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),qb=St(),Xb=Al("LocalAudioTrack","_enabledMutex"),Jb=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),Qb=St(),Zb=St(),eO=St(),tO=ce({argsMap:e=>[e.getTrackId()]}),rO=St(),nO=ce({argsMap:e=>[e.getTrackId()]}),iO=St(),oO=ce({argsMap:e=>[e.getTrackId()]}),aO=ce({argsMap:(e,t)=>[e.getTrackId(),t.name]}),sO=ce({argsMap:e=>[e.getTrackId()]}),Oe((nt=class extends Zc{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Kr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,n){super(e,r),j(this,"trackMediaType",Yl.AUDIO),j(this,"_encoderConfig",void 0),j(this,"_trackSource",void 0),j(this,"_enabled",!0),j(this,"_volume",100),j(this,"_useAudioElement",!0),j(this,"_bypassWebAudio",!1),j(this,"processor",void 0),j(this,"_processorContext",void 0),j(this,"_processorDestination",void 0),j(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!n,this._trackSource=new IT,b("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),b("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),cr()&&!vn?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Be(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Kr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,We(this,X.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!Qx())throw new V(C.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Kr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await We(this,X.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(n){throw r||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await We(this,X.NEED_DISABLE_TRACK,this)}catch(n){throw r||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await We(this,X.NEED_MUTE_TRACK,this):await We(this,X.NEED_UNMUTE_TRACK,this))}getStats(){return Qa(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Kn(this,X.GET_STATS)||rt({},yT)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(wn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(wn.ON_AUDIO_BUFFER),this._source.on(wn.ON_AUDIO_BUFFER,r=>e(r))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Kr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Kr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Kr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await We(this,X.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Y.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new V(C.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new V(C.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Fr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await We(this,X.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await We(this,X.NEED_REPLACE_TRACK,this))}),e.on(Fr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Fr.ON_TRACK),e.removeAllListeners(Fr.ON_NODE)}bindProcessorContextEvents(e){e.on(Dn.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Dn.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof IT&&(this._trackSource=new iV(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new fV(this._source.context,this.getTrackId(),"local"),t=new pV(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(wn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Kr.stop(this.getTrackId()),this._source.play()),We(this,X.NEED_REPLACE_MIXING_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{v.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[Hb],Object.getOwnPropertyDescriptor(nt.prototype,"setVolume"),nt.prototype),Oe(nt.prototype,"setPlaybackDevice",[Kb,zb],Object.getOwnPropertyDescriptor(nt.prototype,"setPlaybackDevice"),nt.prototype),Oe(nt.prototype,"setEnabled",[Yb,$b,qb],Object.getOwnPropertyDescriptor(nt.prototype,"setEnabled"),nt.prototype),Oe(nt.prototype,"setMuted",[Xb,Jb,Qb],Object.getOwnPropertyDescriptor(nt.prototype,"setMuted"),nt.prototype),Oe(nt.prototype,"getStats",[Zb],Object.getOwnPropertyDescriptor(nt.prototype,"getStats"),nt.prototype),Oe(nt.prototype,"setAudioFrameCallback",[eO],Object.getOwnPropertyDescriptor(nt.prototype,"setAudioFrameCallback"),nt.prototype),Oe(nt.prototype,"play",[tO,rO],Object.getOwnPropertyDescriptor(nt.prototype,"play"),nt.prototype),Oe(nt.prototype,"stop",[nO,iO],Object.getOwnPropertyDescriptor(nt.prototype,"stop"),nt.prototype),Oe(nt.prototype,"close",[oO],Object.getOwnPropertyDescriptor(nt.prototype,"close"),nt.prototype),Oe(nt.prototype,"pipe",[aO],Object.getOwnPropertyDescriptor(nt.prototype,"pipe"),nt.prototype),Oe(nt.prototype,"unpipe",[sO],Object.getOwnPropertyDescriptor(nt.prototype,"unpipe"),nt.prototype),nt),mm=(cO=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),lO=St(),uO=Al("MicrophoneAudioTrack","_enabledMutex"),dO=ce({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),hO=St(),pO=ce({argsMap:e=>[e.getTrackId()]}),Oe((no=class extends ht{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,n){super(e,t.encoderConfig?pm(t.encoderConfig):{},n,b("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),j(this,"_config",void 0),j(this,"_deviceName","default"),j(this,"_constraints",void 0),j(this,"_originalConstraints",void 0),j(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(wl()||dT())&&Fe.bindInterruptDetectorTrack(this)}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await bn.getDeviceById(e),r={};r.audio=rt({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let n=null;try{n=await Cn(r,this.getTrackId())}catch(i){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),n=await Cn({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await bn.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),b("AUTO_RESET_AUDIO_ROUTE")&&(Vr()||yi())){let a=navigator.audioSession;a&&(e||(a.type="playback"),a.type="auto")}if(!e){var n;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(n=this._source.clonedTrack)===null||n===void 0||n.stop(),r||(this._enabled=!1);try{await We(this,X.NEED_DISABLE_TRACK,this)}catch(a){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),a.toString()),a}return}let i=rt({},this._constraints),o=bn.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{r||(this._enabled=!0);let a=await Cn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),await We(this,X.NEED_ENABLE_TRACK,this)}catch(a){throw r||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),a.toString()),a}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(wl()||dT())&&Fe.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Vr()||yi())&&this._enabled&&!this._isClosed&&Fe.duringInterruption){let e=async()=>{Fe.off(Jt.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Fe.on(Jt.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(zl.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=bn.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let n=await Cn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Dn.REQUEST_UPDATE_CONSTRAINTS,async(t,r,n)=>{try{let i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),r()}catch(i){n(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Dn.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[cO,lO],Object.getOwnPropertyDescriptor(no.prototype,"setDevice"),no.prototype),Oe(no.prototype,"setEnabled",[uO,dO,hO],Object.getOwnPropertyDescriptor(no.prototype,"setEnabled"),no.prototype),Oe(no.prototype,"close",[pO],Object.getOwnPropertyDescriptor(no.prototype,"close"),no.prototype),no),VX=(fO=ce({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),mO=St(),_O=ce({argsMap:e=>[e.getTrackId()]}),EO=St(),gO=ce({argsMap:e=>[e.getTrackId()]}),vO=St(),SO=ce({argsMap:e=>[e.getTrackId()]}),TO=St(),yO=ce({argsMap:e=>[e.getTrackId()]}),RO=St(),CO=ce({argsMap:e=>[e.getTrackId()]}),IO=ce({argsMap:e=>[e.getTrackId()]}),wO=St(),Oe((rr=class extends ht{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,n){super(t.createOutputTrack(),r,n),j(this,"source",void 0),j(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(wn.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(zl.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Be(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[fO,mO],Object.getOwnPropertyDescriptor(rr.prototype,"startProcessAudioBuffer"),rr.prototype),Oe(rr.prototype,"pauseProcessAudioBuffer",[_O,EO],Object.getOwnPropertyDescriptor(rr.prototype,"pauseProcessAudioBuffer"),rr.prototype),Oe(rr.prototype,"seekAudioBuffer",[gO,vO],Object.getOwnPropertyDescriptor(rr.prototype,"seekAudioBuffer"),rr.prototype),Oe(rr.prototype,"resumeProcessAudioBuffer",[SO,TO],Object.getOwnPropertyDescriptor(rr.prototype,"resumeProcessAudioBuffer"),rr.prototype),Oe(rr.prototype,"stopProcessAudioBuffer",[yO,RO],Object.getOwnPropertyDescriptor(rr.prototype,"stopProcessAudioBuffer"),rr.prototype),Oe(rr.prototype,"close",[CO],Object.getOwnPropertyDescriptor(rr.prototype,"close"),rr.prototype),Oe(rr.prototype,"setAudioBufferPlaybackSpeed",[IO,wO],Object.getOwnPropertyDescriptor(rr.prototype,"setAudioBufferPlaybackSpeed"),rr.prototype),rr),Bt=class gV extends ht{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=$l().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Ke(8,"track-mix-")),j(this,"trackList",void 0),j(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(v.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):v.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){v.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}dm(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof gV?r.emit(Fs.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}},FX=class extends nV{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(wn.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),j(this,"audioBuffer",void 0),j(this,"sourceNode",void 0),j(this,"startPlayTime",0),j(this,"startPlayOffset",0),j(this,"pausePlayTime",0),j(this,"options",void 0),j(this,"currentLoopCount",0),j(this,"currentPlaybackSpeed",100),j(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}},AO=new Map,xR=class{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,(t=this.onVideoStateChanged)===null||t===void 0||t.call(this,this.videoState))}constructor(e){j(this,"trackId",void 0),j(this,"config",void 0),j(this,"onFirstVideoFrameDecoded",void 0),j(this,"onVideoStateChanged",void 0),j(this,"freezeTimeCounterList",[]),j(this,"renderFreezeAccTime",0),j(this,"isKeepLastFrame",!1),j(this,"timeUpdatedCount",0),j(this,"freezeTime",0),j(this,"playbackTime",0),j(this,"lastTimeUpdatedTime",0),j(this,"autoplayFailed",!1),j(this,"videoTrack",void 0),j(this,"videoElement",void 0),j(this,"cacheVideoElement",void 0),j(this,"renderStats",void 0),j(this,"_videoState",ro.VideoStateStopped),j(this,"videoElementCheckInterval",void 0),j(this,"videoElementFreezeTimeout",void 0),j(this,"_videoElementStatus",Ir.NONE),j(this,"isGettingVideoDimensions",!1),j(this,"startGetVideoDimensions",()=>{let t=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t,500)};!this.isGettingVideoDimensions&&t()}),j(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Fe.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(MA())),FA()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),j(this,"handleVideoEvents",t=>{switch(t.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Ir.PLAYING;break;case"loadeddata":if(this.videoState=ro.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Ir.CANPLAY;break;case"stalled":this.videoElementStatus=Ir.STALLED;break;case"suspend":this.videoElementStatus=Ir.SUSPEND;break;case"pause":this.videoElementStatus=Ir.PAUSED,Vr()||yi()||cr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Ir.WAITING;break;case"abort":this.videoElementStatus=Ir.ABORT;break;case"ended":this.videoElementStatus=Ir.ENDED;break;case"emptied":this.videoElementStatus=Ir.EMPTIED;break;case"error":{let r=this.videoElement.error;r?(this.videoElementStatus=Ir.ERROR,v.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")"))):v.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);let n=r-this.lastTimeUpdatedTime,i=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,xo.lastVisibleTime<xo.lastHiddenTime||i<xo.lastHiddenTime||i<xo.lastVisibleTime)return;for(n>b("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=n),this.playbackTime+=n;this.playbackTime>=6e3;){this.playbackTime-=6e3;let o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),j(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(MA())),FA()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Fe.on(Jt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fe.on(Jt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch(n=>{e&&uV(e,"video",n.message,this.trackId),n.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",n),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),n)});let r=Ne();if((r.name==="Safari"&&Number(r.version)===15||wl())&&t&&t.then){let n=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(n).catch(n)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return v.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let r=t.getImageData(0,0,e.width,e.height);return e.remove(),r}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;let n=r.getContext("2d");return n?(n.drawImage(this.videoElement,0,0,r.width,r.height),new Y((i,o)=>{r.toBlob(async a=>{if(r.remove(),a){let s=await EV(a);i({buffer:s,width:r.width,height:r.height})}else o(new V(C.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await UR(e)}destroy(){this.renderStats=void 0,Fe.off(Jt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fe.off(Jt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ro.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Ir.INIT,!this.videoElementCheckInterval&&(bO.forEach(i=>{this.videoElement.addEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(i){return i!==document.body&&document.body.contains(i)})(this.videoElement)||(this.videoElementStatus=Ir.DESTROYED)},1e3),b("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let i,o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(a,b("VIDEO_FREEZE_DURATION")))},a=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ro.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ro.VideoStateFrozen:document.addEventListener("visibilitychange",o))},s=(c,l)=>{if(this.videoElementStatus===Ir.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=l.mediaTime):this.renderStats={lastTs:l.mediaTime,curTs:l.mediaTime,lastRenderNum:0,renderNum:0},i){let h=l.presentationTime-i.presentationTime;this.videoState===ro.VideoStateStarting&&(this.videoState=ro.VideoStateDecoding),this.videoState===ro.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a,b("VIDEO_FREEZE_DURATION"))),h<b("VIDEO_FREEZE_DURATION")&&this.videoState===ro.VideoStateFrozen&&(this.videoState=ro.VideoStateDecoding),h>b("VIDEO_FREEZE_DURATION")&&xo.lastVisibleTime>=xo.lastHiddenTime&&i.timestamp>xo.lastVisibleTime&&i.timestamp>xo.lastHiddenTime&&(this.renderFreezeAccTime+=h)}i=rt(rt({},l),{},{timestamp:c})}var u,d;b("ENABLE_VIDEO_FRAME_CALLBACK")&&((u=(d=this.videoElement).requestVideoFrameCallback)===null||u===void 0||u.call(d,s))};(e=(t=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(t,s)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),f_()&&!b("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let r=Ne();r.name==="Safari"&&Number(r.version)===15||wl()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ft()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ft()&&this.videoElement.load());let n=this.videoElement.play();n!==void 0&&n.catch(i=>{v.debug("[".concat(this.trackId,"] playback interrupted"),i.toString())})}resetVideoElement(){bO.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Ir.NONE}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{v.error(r)}),this.autoplayFailed=!1,Gd()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Gd()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),lV()}},bO=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],vV=class extends xR{constructor(e){super(e),j(this,"container",void 0),j(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,r):await UR(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",b("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}},OO,NO,PO,DO,kO,LO,MO,UO,xO,VO,FO,jO,BO,GO,WO,HO,KO,zO,YO,$O,qO,XO,JO,QO,we,ZO,eN,tN,rN,nN,iN,oN,aN,gn,Xe=(OO=ce({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),NO=St(),PO=ce({argsMap:e=>[e.getTrackId()]}),DO=Al("LocalVideoTrack","_enabledMutex"),kO=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),LO=St(),MO=Al("LocalVideoTrack","_enabledMutex"),UO=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),xO=St(),VO=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),FO=St(),jO=St(),BO=ce({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),GO=St(),WO=St(),HO=St(),KO=St(),zO=St(),YO=St(),$O=St(),qO=ce({argsMap:(e,t)=>[e.getTrackId(),t.name]}),XO=ce({argsMap:e=>[e.getTrackId()]}),JO=ce({argsMap:e=>[e.getTrackId()]}),QO=ce({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),we=class SV extends Zc{get videoHeight(){if(cr()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(cr()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ir.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,n,i,o,a){if(super(t,o),j(this,"trackMediaType",Yl.VIDEO),j(this,"_player",void 0),j(this,"isUseScaleResolutionDownBy",!1),j(this,"_videoVisibleTimer",null),j(this,"_previousVideoVisibleStatus",void 0),j(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),j(this,"_encoderConfig",void 0),j(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),j(this,"_optimizationMode",void 0),j(this,"_videoHeight",void 0),j(this,"_videoWidth",void 0),j(this,"_forceBitrateLimit",void 0),j(this,"_enabled",!0),j(this,"_processorDestination",void 0),j(this,"_processorContext",void 0),cr()){let{width:s,height:c}=t.getSettings();this._videoWidth=s,this._videoHeight=c}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=n,this._optimizationMode=i,this._hints=a||[],this._hints.indexOf(et.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(s,c,l){let u=Ne();return!(u.name!==s||!u.osVersion)&&Number(u.version)===c}(Ue.CHROME,115)&&p_().indexOf("Windows")!==-1){let s=function(c,l){if("VideoFrame"in window&&"TransformStream"in window&&Pe().supportWebRTCInsertableStream){let u=new MediaStreamTrackProcessor(c),d=new MediaStreamTrackGenerator({kind:"video"}),h,p,m=Date.now(),f=()=>{_&&(clearInterval(_),_=void 0),h&&(h.close(),h=void 0),c.stop(),p=void 0,d.removeEventListener("ended",f)},_=window.setInterval(()=>{if(p&&h&&Date.now()-m>1e3)try{d.readyState==="live"?p.enqueue(h.clone()):f()}catch{f()}},1e3),E=new TransformStream({transform:(g,T)=>{d.readyState==="live"?(p=T,m=Date.now(),h===void 0?(h=g,T.enqueue(g.clone())):(T.enqueue(h),h=g)):g.close()}});return d.addEventListener("ended",f),u.readable.pipeThrough(E).pipeTo(d.writable),d}}(t);s&&(v.info("local screen video track begin to inject frame"),this._mediaStreamTrack=s)}r&&this._hints.indexOf(et.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new hV(this.getTrackId(),"local"),this._processorDestination=new dV(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let i=document.getElementById(t);i?t=i:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));let n=rt(rt(rt({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new xR(n):this._player=new vV(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i=this.getVideoElementVisibleStatus();this.safeEmit(zl.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},b("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await We(this,X.NEED_DISABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}return r||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await We(this,X.NEED_ENABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await We(this,X.NEED_MUTE_TRACK,this):await We(this,X.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,r){if(!this._enabled)throw new V(C.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Eo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let n=fm({encoderConfig:t});(cr()||Vr()||yi())&&(n.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(i){let o=new V(C.UNEXPECTED_ERROR,i.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=t,this._hints.indexOf(et.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await We(this,X.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(v)}}getStats(){return Qa(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Kn(this,X.GET_STATS)||rt({},RT)}async setBeautyEffect(t){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await UR(t)}async setBitrateLimit(t){if(v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await We(this,X.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(v)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void v.error(C.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let r=this._optimizationMode;try{this._optimizationMode=t,await We(this,X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n){throw this._optimizationMode=r,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n.toString()),n}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return v.error(C.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){mV(this._originMediaStreamTrack).then(t=>{let[r,n]=t;this._videoHeight=n,this._videoWidth=r}).catch(E_)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new V(C.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");v.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Eo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(et.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await We(this,X.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(v)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:r,frameRate:n}=this.getMediaStreamTrackSettings();if(!t||!r||!n)return;let{bitrateMax:i,bitrateMin:o}=this._encoderConfig;if(o==null||i==null){let{max:a,min:s}=function(c,l,u,d,h){let p=b("BITRATE_ADAPTER_TYPE");if(p==="DEFAULT_BITRATE")return{min:d,max:h};if(h===void 0){var m;let _=Math.floor(200*Math.pow(u/15,.6)*Math.pow(c*l/640/360,.75));h=p==="STANDARD_BITRATE"?4*_:2*_,d=(m=d)!==null&&m!==void 0?m:_}else{var f;d=(f=d)!==null&&f!==void 0?f:Math.floor(h/10)}return{min:d,max:h}}(t,r,n,o,i);this._encoderConfig.bitrateMin=s,this._encoderConfig.bitrateMax=a,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(n,"] => [brMax: ").concat(a,", brMin: ").concat(s,"]"))}}getVideoElementVisibleStatus(){try{var t,r;let n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:a}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&a instanceof HTMLElement){let s=bx.checkOneElementVisible(o),c=Object.assign({},s);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;let l=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(n){throw new V(C.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new V(C.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;t&&(n=rt(rt({},n),Eo(t))),n=bs(n);let i=Ke(8,"track-video-cloned-"),o=new SV(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,bs(this._scalabilityMode),this._optimizationMode,i,bs(this._hints));return t&&n&&o.setEncoderConfiguration(n),v.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(r)),o}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new V(C.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new V(C.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Qa(()=>{te.reportApiInvoke(null,{name:Lt.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:pt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!b("ENABLE_VIDEO_SEI")||!b("ENABLE_ENCODED_TRANSFORM"))return void v.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new V(C.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let r=this.getRTCRtpTransceiver();if(!r)return void v.warning("Video track is not published, SEI can not be send");let n=r.sender.getParameters();if(n.codecs.length===0)return;let i=n.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"?this.safeEmit("sei-to-send",t):v.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(Fr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await We(this,X.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await We(this,X.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Dn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Dn.REQUEST_CONSTRAINTS)}},Oe(we.prototype,"play",[OO,NO],Object.getOwnPropertyDescriptor(we.prototype,"play"),we.prototype),Oe(we.prototype,"stop",[PO],Object.getOwnPropertyDescriptor(we.prototype,"stop"),we.prototype),Oe(we.prototype,"setEnabled",[DO,kO,LO],Object.getOwnPropertyDescriptor(we.prototype,"setEnabled"),we.prototype),Oe(we.prototype,"setMuted",[MO,UO,xO],Object.getOwnPropertyDescriptor(we.prototype,"setMuted"),we.prototype),Oe(we.prototype,"setEncoderConfiguration",[VO,FO],Object.getOwnPropertyDescriptor(we.prototype,"setEncoderConfiguration"),we.prototype),Oe(we.prototype,"getStats",[jO],Object.getOwnPropertyDescriptor(we.prototype,"getStats"),we.prototype),Oe(we.prototype,"setBeautyEffect",[BO,GO],Object.getOwnPropertyDescriptor(we.prototype,"setBeautyEffect"),we.prototype),Oe(we.prototype,"getCurrentFrameData",[WO],Object.getOwnPropertyDescriptor(we.prototype,"getCurrentFrameData"),we.prototype),Oe(we.prototype,"getCurrentFrameImage",[HO],Object.getOwnPropertyDescriptor(we.prototype,"getCurrentFrameImage"),we.prototype),Oe(we.prototype,"setBitrateLimit",[KO],Object.getOwnPropertyDescriptor(we.prototype,"setBitrateLimit"),we.prototype),Oe(we.prototype,"setOptimizationMode",[zO],Object.getOwnPropertyDescriptor(we.prototype,"setOptimizationMode"),we.prototype),Oe(we.prototype,"setScalabiltyMode",[YO],Object.getOwnPropertyDescriptor(we.prototype,"setScalabiltyMode"),we.prototype),Oe(we.prototype,"updateMediaStreamTrackResolution",[$O],Object.getOwnPropertyDescriptor(we.prototype,"updateMediaStreamTrackResolution"),we.prototype),Oe(we.prototype,"pipe",[qO],Object.getOwnPropertyDescriptor(we.prototype,"pipe"),we.prototype),Oe(we.prototype,"unpipe",[XO],Object.getOwnPropertyDescriptor(we.prototype,"unpipe"),we.prototype),Oe(we.prototype,"close",[JO],Object.getOwnPropertyDescriptor(we.prototype,"close"),we.prototype),Oe(we.prototype,"replaceTrack",[QO],Object.getOwnPropertyDescriptor(we.prototype,"replaceTrack"),we.prototype),we),wT=(ZO=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),eN=St(),tN=Al("CameraVideoTrack","_enabledMutex"),rN=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),nN=St(),iN=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),oN=St(),aN=ce({argsMap:e=>[e.getTrackId()]}),gn=class TV extends Xe{get __className__(){return"CameraVideoTrack"}constructor(t,r,n,i,o,a){super(t,Eo(r.encoderConfig),i,o,a),j(this,"_config",void 0),j(this,"_originalConstraints",void 0),j(this,"_constraints",void 0),j(this,"_enabled",!0),j(this,"_deviceName","default"),j(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(wl()||dT())&&!function(){let s=Ne();if(s.os!==Gt.IOS||!s.osVersion)return!1;let c=s.osVersion.split(".");return Number(c[0])===15&&Number(c[1])>=2}()&&Ix()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=n,this._constraints=n,this._deviceName=t.label,this._encoderConfig=Eo(this._config.encoderConfig),Fe.on(Jt.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Fe.on(Jt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let r=await bn.getDeviceById(t),n={};n.video=rt({},this._constraints),n.video.deviceId={exact:t},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Cn(n,this.getTrackId())}catch(o){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Cn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{let r=await bn.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){v.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let r={video:rt(rt({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let n=null;try{n=await Cn(r,this.getTrackId())}catch(i){throw v.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),n=await Cn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=rt({},r.video),v.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let n=await Cn({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await We(this,X.NEED_ENABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await We(this,X.NEED_DISABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new V(C.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Eo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let n=Ct(this._config);n.encoderConfig=t;let i=fm(n);(cr()||Vr()||yi())&&(i.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){let a=new V(C.UNEXPECTED_ERROR,o.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(et.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await We(this,X.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(v)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Vr()||yi())&&this._enabled&&!this._isClosed&&Fe.duringInterruption){let t=async()=>{Fe.off(Jt.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Fe.on(Jt.IOS_INTERRUPTION_END,t)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(zl.TRACK_ENDED)}async renewMediaStreamTrack(t){let r=t||this._constraints,n=bn.searchDeviceIdByName(this._deviceName);if(n&&!r.deviceId&&(r.deviceId={exact:n}),this._enabled){let i=await Cn({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Fe.off(Jt.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Fe.off(Jt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;t&&(n=rt(rt({},n),Eo(t))),n=bs(n);let i=Ke(8,"track-cam-cloned-"),o=new TV(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,bs(rt(rt({},this._config),{},{encoderConfig:n})),bs(this._constraints),bs(this._scalabilityMode),this._optimizationMode,i);return t&&n&&o.setEncoderConfiguration(n),v.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(r)),o}bindProcessorContextEvents(){this.processorContext.on(Dn.REQUEST_UPDATE_CONSTRAINTS,async(t,r,n)=>{try{let i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),r()}catch(i){n(i)}}),this.processorContext.on(Dn.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Oe(gn.prototype,"setDevice",[ZO,eN],Object.getOwnPropertyDescriptor(gn.prototype,"setDevice"),gn.prototype),Oe(gn.prototype,"setEnabled",[tN,rN,nN],Object.getOwnPropertyDescriptor(gn.prototype,"setEnabled"),gn.prototype),Oe(gn.prototype,"setEncoderConfiguration",[iN,oN],Object.getOwnPropertyDescriptor(gn.prototype,"setEncoderConfiguration"),gn.prototype),Oe(gn.prototype,"close",[aN],Object.getOwnPropertyDescriptor(gn.prototype,"close"),gn.prototype),gn);function qg(e,t,r,n){r.optimizationMode&&(n&&n.width&&n.height?(r.encoderConfig=rt(rt({},n),{},{bitrateMin:n.bitrateMin,bitrateMax:n.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?v.debug("[".concat(e,"] set content hint to"),r.optimizationMode):v.debug("[".concat(e,"] set content hint failed")))):v.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var sN,cN,lN,uN,Mn,dN,hN,pN,fN,mN,_N,yr,yV=class extends tV{getUserId(){return this._userId}constructor(e,t,r,n){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(n.clientId,"_").concat(Ke(5,""))),j(this,"_userId",void 0),j(this,"_uintId",void 0),j(this,"_isDestroyed",!1),j(this,"store",void 0),j(this,"processor",void 0),j(this,"processorContext",void 0),this._userId=t,this._uintId=r,this.store=n}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}},dl=(sN=ce({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),cN=ce({argsMap:e=>[e.getTrackId()]}),lN=ce({argsMap:(e,t)=>[e.getTrackId(),t.name]}),uN=ce({argsMap:e=>[e.getTrackId()]}),Oe((Mn=class extends yV{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ir.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,n){super(e,t,r,n),j(this,"_videoVisibleTimer",null),j(this,"_previousVideoVisibleStatus",void 0),j(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),j(this,"trackMediaType",Yl.VIDEO),j(this,"_videoWidth",void 0),j(this,"_videoHeight",void 0),j(this,"_player",void 0),j(this,"processorDestination",void 0),j(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new hV(this.getTrackId(),"remote"),this.processorDestination=new dV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Qa(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Kn(this,X.GET_STATS)||rt({},eV)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let n=document.getElementById(e);n?e=n:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=rt(rt({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new xR(r):this._player=new vV(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ul.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=n=>{this.safeEmit(ul.VIDEO_STATE_CHANGED,n)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let n=this.getVideoElementVisibleStatus();this.safeEmit(ul.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},b("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){mV(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(E_)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),n={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:i,slot:o}=n;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){let a=bx.checkOneElementVisible(i),s=Object.assign({},a);if(s.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=s.visible;let c=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});s.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(s.reason))}return s}return}catch(r){throw new V(C.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new V(C.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Fr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Fs.SEI_RECEIVED,e)}}).prototype,"play",[sN],Object.getOwnPropertyDescriptor(Mn.prototype,"play"),Mn.prototype),Oe(Mn.prototype,"stop",[cN],Object.getOwnPropertyDescriptor(Mn.prototype,"stop"),Mn.prototype),Oe(Mn.prototype,"pipe",[lN],Object.getOwnPropertyDescriptor(Mn.prototype,"pipe"),Mn.prototype),Oe(Mn.prototype,"unpipe",[uN],Object.getOwnPropertyDescriptor(Mn.prototype,"unpipe"),Mn.prototype),Mn),hl=(dN=ce({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),hN=ce({argsMap:(e,t)=>[e.getTrackId(),t]}),pN=ce({argsMap:e=>[e.getTrackId()]}),fN=ce({argsMap:e=>[e.getTrackId()]}),mN=ce({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_N=ce({argsMap:e=>[e.getTrackId()]}),Oe((yr=class extends yV{get isPlaying(){return this._useAudioElement?Kr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,n){super(e,t,r,n),j(this,"trackMediaType",Yl.AUDIO),j(this,"_source",void 0),j(this,"_useAudioElement",!0),j(this,"_volume",100),j(this,"processorContext",void 0),j(this,"processorDestination",void 0),j(this,"_played",!1),j(this,"_bypassWebAudio",!1),b("DISABLE_WEBAUDIO")?(this._source=new IT,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new iV(e,!0),b("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(wn.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ul.FIRST_FRAME_DECODED)}),this.processorContext=new fV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new pV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(wn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(wn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(wn.ON_AUDIO_BUFFER),this._source.on(wn.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?Kr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!Qx())throw new V(C.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Kr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Qa(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Kn(this,X.GET_STATS)||rt({},Zx)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),Kr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Kr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Kr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new V(C.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new V(C.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new V(C.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Fr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Fr.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fr.ON_TRACK),this.processorDestination.removeAllListeners(Fr.ON_NODE)}}).prototype,"setVolume",[dN],Object.getOwnPropertyDescriptor(yr.prototype,"setVolume"),yr.prototype),Oe(yr.prototype,"setPlaybackDevice",[hN],Object.getOwnPropertyDescriptor(yr.prototype,"setPlaybackDevice"),yr.prototype),Oe(yr.prototype,"play",[pN],Object.getOwnPropertyDescriptor(yr.prototype,"play"),yr.prototype),Oe(yr.prototype,"stop",[fN],Object.getOwnPropertyDescriptor(yr.prototype,"stop"),yr.prototype),Oe(yr.prototype,"pipe",[mN],Object.getOwnPropertyDescriptor(yr.prototype,"pipe"),yr.prototype),Oe(yr.prototype,"unpipe",[_N],Object.getOwnPropertyDescriptor(yr.prototype,"unpipe"),yr.prototype),yr),xo=new class extends lt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),j(this,"_lastHiddenTime",0),j(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}},RV=class extends lt{constructor(e,t){super(),j(this,"trackMediaType",Yl.DATA),j(this,"_version",1),j(this,"_type",3),j(this,"_config",void 0),j(this,"_originDataChannel",void 0),j(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),j(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),j(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return b("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Y((e,t)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();let r=setTimeout(()=>{var n;t(new V(C.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((n=this._originDataChannel)===null||n===void 0?void 0:n.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new V(C.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new V(C.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[vf.OPEN,vf.CLOSE,vf.ERROR].forEach(t=>{let r=()=>{this.emit(t)};this._datachannelEventMap.set(t,r),e.addEventListener(t,r)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[r,n]=t;e.removeEventListener(r,n)}),this._datachannelEventMap.clear()}},jX=class extends RV{constructor(e){super(e),j(this,"_messageListener",void 0),this._messageListener=t=>{if(t.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let r=t.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(r).getUint8(3);if(n!==this.id)return void(b("SHOW_DATASTREAM2_LOG")&&v.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let i=t.data.slice(this._dataStreamPacketHeader.byteLength);i=this._dataStreamPacketHandler.deserialize(i),this.emit(vf.MESSAGE,i)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}},BX=class extends RV{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);let r=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}};function Tf(){let e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>Vb.revokeObjectURL(e),0),new Worker(Vb.createObjectURL(e))}var Rp=new Map,Cp=new Map;function GX(e,t,r){let n=new Uint8Array(e,t,r),i=[],o=0;for(;i.length<r;)o+3<r&&n[o]===0&&n[o+1]===0&&n[o+2]===3&&(n[o+3]===0||n[o+3]===1||n[o+3]===2||n[o+3]===3)?(i.push(n[o],n[o+1],n[o+3]),o+=4):(i.push(n[o]),o++);return new Uint8Array(i)}var Ip=new Map;async function WX(e,t){if(!Pe().supportWebRTCEncodedTransform)return void v.warning("browser not support video encoded transform");if(Ip.has(e)||!e.track)return;let r={track:e.track};if(Wa()){if(!e.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(s){return void v.error("create video-encoded-streams error",s&&s.message)}let o=[];t.on("sei-to-send",s=>{o.push(s)});let a=new TransformStream({transform(s,c){r.controller||(r.controller=c),e.track&&e.track.id!==r.track.id&&(v.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n));let l=o.shift();l&&(s.data=function(u,d){let h=function(g){let T=g.length,R=[],w=0;for(;w<T;)w+2<T&&g[w]===0&&g[w+1]===0&&(g[w+2]===0||g[w+2]===1||g[w+2]===2||g[w+2]===3)?(R.push(g[w],g[w+1],3,g[w+2]),w+=3):(R.push(g[w]),w++);return new Uint8Array(R)}(d),p=h.length,m=Math.floor(p/255),f=p%255,_=new Uint8Array(6+m+1+p+u.byteLength);_[0]=0,_[1]=0,_[2]=0,_[3]=1,_[4]=6,_[5]=101;let E=0;for(;E<m;)_[6+E]=255,E++;return _[6+E]=f,E++,_.set(h,6+E),_.set(new Uint8Array(u),6+E+p),_.buffer}(s.data,l)),c.enqueue(s)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else{if(!cr())return;{if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");let i=Tf(),o=new MessageChannel;await new Y(s=>i.onmessage=c=>{c.data==="registered"&&s(void 0)});let a=new RTCRtpScriptTransform(i,{name:"tx",port:o.port2},[o.port2]);e.transform=a,await new Y(s=>i.onmessage=c=>{c.data==="started"&&s(void 0)}),t.on("sei-to-send",s=>{o.port1.postMessage({sei:s})}),o.port1.onmessage=s=>{var c;s.data.transformed&&e.track&&((c=e.track)===null||c===void 0?void 0:c.id)!==r.track.id&&(v.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n))},r.worker=i}}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}let i=Ip.get(e);if(i){Ip.delete(e);try{var o,a;(o=i.controller)===null||o===void 0||o.terminate(),(a=i.worker)===null||a===void 0||a.terminate()}catch(s){v.warning(s&&s.message)}}}Ip.set(e,r),e.track.addEventListener("ended",n)}var Ru=new Map;(function(){let e=Ne();Yt.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Yt.getStreamFromExtension=e.name===Ue.CHROME&&Number(e.version)>34,Yt.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),Yt.supportMinBitrate=e.name===Ue.CHROME||e.name===Ue.EDGE,Yt.supportSetRtpSenderParameters=function(){let t=Ne();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ja()||!(!cr()&&!um())||t.name===Ue.FIREFOX&&Number(t.version)>=64)}(),e.name===Ue.SAFARI&&(Number(e.version)>=14?Yt.supportDualStream=!0:Yt.supportDualStream=!1),Yt.webAudioMediaStreamDest=function(){let t=Ne();return!(t.name===Ue.SAFARI&&Number(t.version)<12)}(),Yt.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Yt.supportWebGL=typeof WebGLRenderingContext<"u",Yt.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ja()||(Yt.webAudioWithAEC=!0),Yt.supportShareAudio=function(){let t=Ne();return(t.os===Gt.WIN_10||t.os===Gt.WIN_81||t.os===Gt.WIN_7||t.os===Gt.LINUX||t.os===Gt.MAC_OS||t.os===Gt.CHROMIUM_OS)&&t.name===Ue.CHROME&&Number(t.version)>=74}(),Yt.supportDataChannel=!!(uT(76)||function(t){let r=Ne();return!(r.name!==Ue.FIREFOX||!r.osVersion)&&Number(r.version)>=t}(68)||yx(14)),Yt.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!ft()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Yt.supportWebRTCEncodedTransform=function(){let t=Ne();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),Yt.supportWebRTCInsertableStream=function(){let t=Ne();return(t.name===Ue.CHROME||t.name===Ue.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Yt.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Yt.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,__(()=>{Yt.supportDualStreamEncoding=function(){let t=Ne();return!!b("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&b("CHROME_DUAL_STREAM_USE_ENCODING"))}(),v.info("browser compatibility",JSON.stringify(Yt),JSON.stringify(e))})})();var _m=class AT extends lt{constructor(t,r){super(),y(this,"signal",void 0),y(this,"token",void 0),y(this,"tokenTimeout",void 0),y(this,"tokenInterval",void 0),y(this,"_sequence",0),y(this,"userMap",new Map),y(this,"encoder",new TextEncoder),this.signal=t,this.token=r;let n=()=>{this.signal.connectionState===He.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*b("P2P_TOKEN_INTERVAL"))};n()}async send(t,r,n,i,o){var a,s,c;if(this.userMap.size===0)return;let l=Array.from(Jo(a=this.userMap).call(a))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),i=(s=i)!==null&&s!==void 0?s:Ke(6,""),o=(c=o)!==null&&c!==void 0?c:this._sequence++;let u={_id:i,_type:t,_seq:o,_message:r,token:"".concat(this.token,"_").concat(l)};b("SHOW_P2P_LOG")&&v.debug("send message",u,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(u)).forEach(h=>{this.signal.request(de.DATA_STREAM,{payload:Ha(this.encoder.encode(h))})});let d=new Y((h,p)=>{let m=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),f),this.off("res-@".concat(i),E),this.off(_c.ABORT,_),v.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?p(new V(C.INVALID_REMOTE_USER)):p(new V(C.TIMEOUT))},b("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),f=()=>{m&&window.clearTimeout(m),this.off(_c.ABORT,_),n&&h()},_=()=>{m&&window.clearTimeout(m),this.off("res-@".concat(i,"_ack"),f),this.off("res-@".concat(i),E),p(new V(C.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(_c.ABORT,_),this.once("res-@".concat(i,"_ack"),f);let E=(T,R)=>{g=!0,m&&window.clearTimeout(m),this.off("res-@".concat(i,"_ack"),f),this.off(_c.ABORT,_),T==="success"?h(R):p(new V(C.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))},g=!1;n||(this.once("res-@".concat(i),E),er(b("SIGNAL_REQUEST_TIMEOUT")).then(()=>{g||v.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(u))}))});try{return await d}catch(h){if(h.code===C.TIMEOUT)return await this.send(t,r,n,i,o);throw h}}onMessage(t){var r;let{_uid:n}=t,i,o=this.userMap.get(n);if(o)i=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Et.CHECK)return;let{token:l}=t;i=new Map,o={uid:n,isStart:!0,token:l,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,o),this.signal.emit(ye.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in t&&"total"in t){var a;let{id:l,total:u}=t,d=(a=i.get(l))!==null&&a!==void 0?a:[];if(d.push(t),i.has(l)||i.set(l,d),d.length!==u)return;{let h=Sh(d).call(d,(p,m)=>p.index-m.index).map(p=>p.payload).join("");i.delete(l),(t=JSON.parse(h))._uid=n}}let{_type:s,token:c}=t;if(q(r=[Et.ACK,Et.CHECK]).call(r,s))return s===Et.CHECK&&this.handleCheckToken(o,c),void this.receiveMessage(t);c==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(t):v.debug('Receive unexpected message", '.concat(c,", cur_token: ").concat(o.token,"_").concat(this.token),t)}check(){let t={_id:Ke(6,""),token:this.token,_type:Et.CHECK};b("SHOW_P2P_LOG")&&v.debug("send message",t),this.signal.request(de.DATA_STREAM,{payload:Ha(this.encoder.encode(JSON.stringify(t)))})}ack(t){let r={_id:t,_type:Et.ACK,token:this.token};b("SHOW_P2P_LOG")&&v.debug("send message",r),this.signal.request(de.DATA_STREAM,{payload:Ha(this.encoder.encode(JSON.stringify(r)))})}response(t,r,n){this.send(Et.RESPONSE,JSON.stringify({success:!n,message:r}),!0,t)}handleReceivedMessage(t){let r=()=>{this.userMap.forEach(l=>{let{receivedMessagesMap:u,nextExpectedSequenceNumber:d}=l;for(;u.has(d);){let h=u.get(d);u.delete(d),this.receiveMessage(h),l.nextExpectedSequenceNumber++}})};if(!t)return void r();let{_uid:n,_seq:i}=t,o=this.userMap.get(n),{receivedMessagesMap:a,isStart:s,nextExpectedSequenceNumber:c}=o;if(i<c)return this.ack(t._id),void v.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));a.set(i,t),s&&i===c&&(this.receiveMessage(t),a.delete(c),o.nextExpectedSequenceNumber++,r())}receiveMessage(t){let{_id:r,_type:n,_message:i,_uid:o}=t;if(b("SHOW_P2P_LOG")&&v.debug("receive message",t),r){let a;switch(t._type!==Et.ACK&&(i&&(a=JSON.parse(i)),this.ack(t._id)),t._type){case Et.CANDIDATE:case Et.CONTROL:this.signal.emit(n,a,o);break;case Et.PUBLISH:case Et.UNPUBLISH:case Et.RESTART_ICE:case Et.CALL:a.uid=o,lr(this.signal,n,a).then(s=>{this.response(t._id,s)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Et.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case Et.RESPONSE:{let{success:s,message:c}=a;this.emit("res-@".concat(r),s?"success":"failed",c);break}}}}splitMessage(t){if(t.length<AT.MAX_MESSAGE_SIZE)return[t];let r=[],{remoteToken:n}=JSON.parse(t),i=Ke(6,""),o=0,a=800,s=Math.ceil(t.length/a);for(;t.length>0;){o++;let c={id:i,index:o,total:s,payload:t.slice(0,a),token:"".concat(this.token,"_").concat(n)};JSON.stringify(c).length>AT.MAX_MESSAGE_SIZE?a-=50:(r.push(c),t=t.slice(a))}return r.map(c=>JSON.stringify(c))}handleCheckToken(t,r){return t.token!==r?(v.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{v.debug("token timeout, ".concat(r)),this.reset(t.uid)},b("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await lr(this.signal,Et.CALL,void 0),r=await this.send(Et.CALL,t);this.signal.emit(he.P2P_CONNECTION,r,!0)}async reset(t,r){let n=this.userMap.get(t);n&&(this.emit(_c.ABORT),this.signal.emit(ye.ON_USER_OFFLINE,{uid:n.uid,reason:oq.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(v.debug("change local token from ".concat(r," to ").concat(r)),this.token=Ke(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(_c.ABORT)}};y(_m,"MAX_SIZE",1),y(_m,"MAX_MESSAGE_SIZE",1024);var EN=class extends lt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===He.CONNECTED?this.emit(he.WS_CONNECTED):e===He.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):e===He.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),y(this,"_disconnectedReason",void 0),y(this,"_websocketReconnectReason",void 0),y(this,"_connectionState",He.CLOSED),y(this,"reconnectToken",void 0),y(this,"p2pToken",void 0),y(this,"websocket",void 0),y(this,"openConnectionTime",void 0),y(this,"clientId",void 0),y(this,"lastMsgTime",Date.now()),y(this,"uploadCache",[]),y(this,"uploadCacheInterval",void 0),y(this,"rttRolling",new Lx(5)),y(this,"pingpongTimer",void 0),y(this,"pingpongTimeoutCount",0),y(this,"joinResponse",void 0),y(this,"multiIpOption",void 0),y(this,"initError",void 0),y(this,"spec",void 0),y(this,"store",void 0),y(this,"_external_signal",void 0),y(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,r.data);let n=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n,"_id")){let i="res-@".concat(n._id);this.emit(i,n._result,n._message)}else if(Object.prototype.hasOwnProperty.call(n,"_type")){switch(n._type){case ye.ON_DATA_STREAM:return void this.handleDataStream(n._message);case ye.MUTE_AUDIO:case ye.MUTE_VIDEO:case ye.ON_P2P_LOST:case ye.ON_USER_ONLINE:return;case ye.ON_USER_OFFLINE:let{uid:i}=n._message;return v.debug("[".concat(this.clientId,"] user-offline uid: ").concat(i)),void this._external_signal.reset(i)}if(this.emit(n._type,n._message),n._type===ye.ON_NOTIFICATION&&this.handleNotification(n._message),n._type===ye.ON_USER_BANNED)switch(n._message.error_code){case 14:this.close(Ve.UID_BANNED);break;case 15:this.close(Ve.IP_BANNED);break;case 16:this.close(Ve.CHANNEL_BANNED)}if(n._type===ye.ON_USER_LICENSE_BANNED)switch(n._message.error_code){case ae.ERR_LICENSE_MISSING:this.close(Ve.LICENSE_MISSING);break;case ae.ERR_LICENSE_EXPIRED:this.close(Ve.LICENSE_EXPIRED);break;case ae.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ve.LICENSE_MINUTES_EXCEEDED);break;case ae.ERR_LICENSE_PERIOD_INVALID:this.close(Ve.LICENSE_PERIOD_INVALID);break;case ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ve.LICENSE_MULTIPLE_SDK_SERVICE);break;case ae.ERR_LICENSE_ILLEGAL:this.close(Ve.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new OR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,b("JOIN_GATEWAY_USE_DUAL_DOMAIN"),b("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===He.CONNECTED&&this.reconnect("retry",sr.OFFLINE)}),this.p2pToken=Ke(6,""),this._external_signal=new _m(this,this.p2pToken)}async request(e,t,r,n){let i=Ke(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new Y((p,m)=>{if(this.connectionState===He.CONNECTED)return p();let f=()=>{this.off(he.WS_CLOSED,_),p()},_=()=>{this.off(he.WS_CONNECTED,f),m(new V(C.WS_ABORT))};this.once(he.WS_CONNECTED,f),this.once(he.WS_CLOSED,_)});if(this.connectionState!==He.CONNECTING&&this.connectionState!==He.RECONNECTING||e===de.JOIN||e===de.REJOIN||await s(),this.websocket.sendMessage(o,!0),n)return;let c=new Y((p,m)=>{let f=!1,_=(g,T)=>{f=!0,p({isSuccess:g==="success",message:T||{}}),this.off(he.WS_CLOSED,E),this.off(he.WS_RECONNECTING,E),this.emit(he.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),_);let E=()=>{m(new V(C.WS_ABORT,"type: ".concat(e))),this.off(he.WS_CLOSED,E),this.off(he.WS_RECONNECTING,E),this.off("res-@".concat(i),_)};this.once(he.WS_CLOSED,E),this.once(he.WS_RECONNECTING,E),er(b("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||f||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(he.REQUEST_TIMEOUT,e,t))})}),l=null;try{l=await c}catch(p){if(this.connectionState===He.CLOSED||e===de.LEAVE)throw new V(C.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?p.throw():e===de.JOIN||e===de.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;let u=Number(l.message.error_code||l.message.code),d=Kd(u),h=new V(C.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message,desc:d.desc});return d.action==="success"?l.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===ae.ERR_TOO_MANY_BROADCASTERS?((e===de.JOIN||e===de.REJOIN)&&(this.initError=h,this.close()),h.throw()):d.action==="failed"?h.throw():d.action==="quit"?(this.initError=h,this.close(),h.throw()):(u===ae.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",sr.MULTI_IP)):this.reconnect(d.action,sr.SERVER_ERROR),e===de.JOIN||e===de.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Y(r=>{let n=i=>{(!t||t(i))&&(this.off(e,n),r(i))};this.on(e,n)})}uploadWRTCStats(e){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Hd.WRTC_STATS,t)}upload(e,t){let r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch{let n=b("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>n&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==He.CONNECTED)return;let i=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(i._type,i._message)},b("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let r={_type:e,_message:t};this.websocket.sendMessage(r)}async sendExtensionMessage(e,t,r){return await this._external_signal.send(e,t,r)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Y((t,r)=>{this.once(he.WS_CONNECTED,()=>t(this.joinResponse)),this.once(he.WS_CLOSED,()=>r(this.initError||new V(C.WS_ABORT))),this.connectionState=He.CONNECTING,this.websocket.init(e).catch(r)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Ve.LEAVE,this.connectionState=He.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ke(6,""),this._external_signal.clear(),this._external_signal=new _m(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(he.ABORT_P2P_EXECUTION);let e=await lr(this,he.REQUEST_JOIN_INFO),t=await this.request(de.JOIN,e);if(!t)return this.emit(he.REPORT_JOIN_GATEWAY,C.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(he.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=He.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;let r=Os(e.payload),n=new TextDecoder().decode(r),i=JSON.parse(n);"total"in i&&"id"in i||q(t=Object.values(Et)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(ye.ON_DATA_STREAM,e)}catch{this.emit(ye.ON_DATA_STREAM,e)}}handleNotification(e){v.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Kd(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ve.UID_BANNED),void this.close()):void this.reconnect(t.action,sr.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=b("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>b("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sr.TIMEOUT):this.request(de.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-t;this.rttRolling.add(r),b("REPORT_STATS")&&this.send(de.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(pe.RECONNECT_WAITTING_FINISH,e=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(pe.RECONNECT_CREATE_CONNECTION,e=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(pe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pe.CLOSED,()=>{this.connectionState=He.CLOSED}),this.websocket.on(pe.FAILED,()=>{this._disconnectedReason=Ve.NETWORK_ERROR,this.connectionState=He.CLOSED}),this.websocket.on(pe.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===He.CONNECTED?this.connectionState=He.RECONNECTING:this.connectionState=He.CONNECTING}),this.websocket.on(pe.WILL_RECONNECT,(e,t,r)=>{e!=="retry"?(v.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):v.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(e)}),this.websocket.on(pe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(he.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof V&&e.code===C.UNEXPECTED_RESPONSE&&e.data.code===ae.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",sr.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sr.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(pe.REQUEST_NEW_URLS,(e,t)=>{lr(this,he.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}},CV={exports:{}};CV.exports=(()=>{var e={8:(n,i,o)=>{o.r(i),o.d(i,{Parser:()=>x,Printer:()=>F,parse:()=>D,print:()=>W});let a=`
`,s="".concat("\r").concat(a),c=" ",l;function u(L){return L>="0"&&L<="9"}function d(L){return L>="!"&&L<="~"}function h(L){return d(L)||L>=""&&L<=""}function p(L){return L==="!"||L>="#"&&L<="'"||L>="*"&&L<="+"||L>="-"&&L<="."||L>="0"&&L<="9"||L>="A"&&L<="Z"||L>="^"&&L<="~"}function m(L){return L>="1"&&L<="9"}function f(L){return L>="A"&&L<="Z"||L>="a"&&L<="z"}function _(L){return L==="d"||L==="h"||L==="m"||L==="s"}function E(L){return L>""&&L<"	"||L>"\v"&&L<"\f"||L>""&&L<""}function g(L){return f(L)||u(L)||L==="+"||L==="/"}function T(L){return u(L)||f(L)||L==="+"||L==="/"||L==="-"||L==="_"}function R(L){return f(L)||u(L)||L==="+"||L==="/"}function w(L,S){var I=Object.keys(L);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(L);S&&(O=O.filter(function(B){return Object.getOwnPropertyDescriptor(L,B).enumerable})),I.push.apply(I,O)}return I}function A(L){for(var S=1;S<arguments.length;S++){var I=arguments[S]!=null?arguments[S]:{};S%2?w(Object(I),!0).forEach(function(O){N(L,O,I[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(I)):w(Object(I)).forEach(function(O){Object.defineProperty(L,O,Object.getOwnPropertyDescriptor(I,O))})}return L}function N(L,S,I){return S in L?Object.defineProperty(L,S,{value:I,enumerable:!0,configurable:!0,writable:!0}):L[S]=I,L}(function(L){L.VERSION="v",L.ORIGIN="o",L.SESSION_NAME="s",L.INFORMATION="i",L.URI="u",L.EMAIL="e",L.PHONE="p",L.CONNECTION="c",L.BANDWIDTH="b",L.TIME="t",L.REPEAT="r",L.ZONE_ADJUSTMENTS="z",L.KEY="k",L.ATTRIBUTE="a",L.MEDIA="m"})(l||(l={}));class P{consumeText(S,I){let O=I;for(;O<S.length;){let B=S[O];if(B==="\0"||B==="\r"||B===a)break;O+=1}if(O-I==0)throw new Error("Invalid text, at ".concat(S));return O}consumeUnicastAddress(S,I,O){return this.consumeTill(S,I,c)}consumeOneOrMore(S,I,O){let B=I;for(;O(S[B]);)B++;if(B-I==0)throw new Error("Invalid rule at ".concat(I,"."));return B}consumeSpace(S,I){if(S[I]===c)return I+1;throw new Error("Invalid space at ".concat(I,"."))}consumeIP4Address(S,I){let O=I;for(let B=0;B<4;B++)if(O=this.consumeDecimalUChar(S,O),B!==3){if(S[O]!==".")throw new Error("Invalid IP4 address.");O++}return O}consumeDecimalUChar(S,I){let O=I;for(let se=0;se<3&&u(S[O]);se++,O++);if(O-I==0)throw new Error("Invalid decimal uchar.");let B=parseInt(S.slice(I,O));if(B>=0&&B<=255)return O;throw new Error("Invalid decimal uchar")}consumeIP6Address(S,I){let O=this.consumeHexpart(S,I);return S[O]===":"&&(O+=1,O=this.consumeIP4Address(S,O)),O}consumeHexpart(S,I){let O=I;if(S[O]===":"&&S[O+1]===":"){O+=2;try{O=this.consumeHexseq(S,O)}catch{}return O}if(O=this.consumeHexseq(S,O),S[O]===":"&&S[O+1]===":"){O+=2;try{O=this.consumeHexseq(S,O)}catch{}return O}return O}consumeHexseq(S,I){let O=I;for(;O=this.consumeHex4(S,O),S[O]===":"&&S[O+1]!==":";)O+=1;return O}consumeHex4(S,I){let O=0;for(;O<4;O++)if(!((B=S[I+O])>="0"&&B<="9"||B>="a"&&B<="f"||B>="A"&&B<="F")){if(O===0)throw new Error("Invalid hex 4");break}var B;return I+O}consumeFQDN(S,I){let O=I;for(;u(S[O])||f(S[O])||S[O]==="-"||S[O]===".";)O+=1;if(O-I<4)throw new Error("Invalid FQDN");return O}consumeExtnAddr(S,I){return this.consumeOneOrMore(S,I,h)}consumeMulticastAddress(S,I,O){switch(O){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(S,I);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(S,I);default:try{return this.consumeFQDN(S,I)}catch{return this.consumeExtnAddr(S,I)}}}consumeIP6MulticastAddress(S,I){let O=this.consumeHexpart(S,I);return S[O]==="/"?this.consumeInteger(S,O+1):O}consumeIP4MulticastAddress(S,I){let O=I+3,B=S.slice(I,O),se=parseInt(B);if(se<224||se>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ge=0;ge<3;ge++){if(S[O]!==".")throw new Error("Invalid IP4 multicast address.");O+=1,O=this.consumeDecimalUChar(S,O)}return S[O]==="/"&&(O+=1),O=this.consumeTTL(S,O),S[O]==="/"&&(O=this.consumeInteger(S,O)),O}consumeInteger(S,I){if(!m(S[I]))throw new Error("Invalid integer.");for(I+=1;u(S[I]);)I+=1;return I}consumeTTL(S,I){if(S[I]==="0")return I+1;if(!m(S[I]))throw new Error("Invalid TTL.");I+=1;for(let O=0;O<2&&u(S[I]);O++)I+=1;return I}consumeToken(S,I){return this.consumeOneOrMore(S,I,p)}consumeTime(S,I){let O=I;if(S[O]==="0")return O+1;for(m(S[O])&&(O+=1);u(S[O]);)O++;if(O-I<10)throw new Error("Invalid time");return O}consumeAddress(S,I){return this.consumeTill(S,I,c)}consumeTypedTime(S,I){let O=I;return O=this.consumeOneOrMore(S,O,u),_(S[O])?O+1:O}consumeRepeatInterval(S,I){if(!m(S[I]))throw new Error("Invalid repeat interval");for(I+=1;u(S[I]);)I+=1;return _(S[I])&&(I+=1),I}consumePort(S,I){return this.consumeOneOrMore(S,I,u)}consume(S,I,O){for(let B=0;B<O.length;B++){if(I+B>=S.length)throw new Error("consume exceeding value length");if(S[I+B]!==O[B])throw new Error("consume ".concat(O," failed at ").concat(B))}return I+O.length}consumeTill(S,I,O){let B=I;for(;B<S.length&&(typeof O!="string"||S[B]!==O)&&(typeof O!="function"||!O(S[B]));)B++;return B}}class x extends P{constructor(){super(),N(this,"records",[]),N(this,"currentLine",0)}parse(S){let I=this.probeEOL(S);this.records=S.split(I).filter(mt=>!!Ar(mt).call(mt)).map(this.parseLine),this.currentLine=0;let O=this.parseVersion(),B=this.parseOrigin(),se=this.parseSessionName(),ge=this.parseInformation(),ve=this.parseUri(),ut=this.parseEmail(),yt=this.parsePhone(),Zn=this.parseConnection(),Nr=this.parseBandWidth(),qr=this.parseTimeFields(),Oi=this.parseKey(),No=this.parseSessionAttribute(),ot=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:O,origin:B,sessionName:se,information:ge,uri:ve,emails:ut,phones:yt,connection:Zn,bandwidths:Nr,timeFields:qr,key:Oi,attributes:No,mediaDescriptions:ot}}getCurrentRecord(){let S=this.records[this.currentLine];if(!S)throw new Error("Record doesn't exit.");return S}probeEOL(S){for(let I=0;I<S.length;I++)if(S[I]===a)return S[I-1]==="\r"?s:a;throw new Error("Invalid newline character.")}parseLine(S,I){if(S.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let O=S[0];if(S[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:O,value:S.slice(2),line:I,cur:0}}parseSessionAttribute(){let S=new ne;for(;this.currentLine<this.records.length;){let I=this.getCurrentRecord();if(I.type!==l.ATTRIBUTE)break;let O={attField:this.extractOneOrMore(I,B=>p(B)&&B!==":"),_cur:0};I.value[I.cur]===":"&&(I.cur+=1,O.attValue=this.extractOneOrMore(I,E)),S.parse(O),this.currentLine++}return S.digest()}parseMediaAttributes(S){let I=new z(S);for(;this.currentLine<this.records.length;){let O=this.getCurrentRecord();if(O.type!==l.ATTRIBUTE)break;let B={attField:this.extractOneOrMore(O,se=>p(se)&&se!==":"),_cur:0};O.value[O.cur]===":"&&(O.cur+=1,B.attValue=this.extractOneOrMore(O,E)),I.parse(B),this.currentLine++}return I.digest()}parseKey(){let S=this.getCurrentRecord();if(S.type===l.KEY){if(S.value==="prompt"||S.value==="clear:"||S.value==="base64:"||S.value==="uri:")return S.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let S=this.getCurrentRecord();if(S.type===l.ZONE_ADJUSTMENTS){let I=[];for(;;)try{let O=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);let B=!1;S.value[S.cur]==="-"&&(B=!0,S.cur+=1);let se=this.extract(S,this.consumeTypedTime);I.push({time:O,typedTime:se,back:B})}catch{break}if(I.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,I}return[]}parseRepeat(){let S=[];for(;;){let I=this.getCurrentRecord();if(I.type!==l.REPEAT)break;{let O=this.extract(I,this.consumeRepeatInterval),B=this.parseTypedTime(I);S.push({repeatInterval:O,typedTimes:B}),this.currentLine++}}return S}parseTypedTime(S){let I=[];for(;;)try{this.consumeSpaceForRecord(S),I.push(this.extract(S,this.consumeTypedTime))}catch{break}if(I.length===0)throw new Error("Invalid typed time.");return I}parseTime(){let S=this.getCurrentRecord(),I=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);let O=this.extract(S,this.consumeTime);return this.currentLine++,{startTime:I,stopTime:O}}parseBandWidth(){let S=[];for(;this.currentLine<this.records.length;){let I=this.getCurrentRecord();if(I.type!==l.BANDWIDTH)break;{let O=this.extractOneOrMore(I,p);if(I.value[I.cur]!==":")throw new Error("Invalid bandwidth field.");I.cur++;let B=this.extractOneOrMore(I,u);S.push({bwtype:O,bandwidth:B}),this.currentLine++}}return S}parseVersion(){let S=this.getCurrentRecord();if(S.type!==l.VERSION)throw new Error("first sdp record must be version");let I=S.value.slice(0,this.consumeOneOrMore(S.value,0,u));if(I.length!==S.value.length)throw new Error('invalid proto version, "v='.concat(S.value,'"'));return this.currentLine++,I}parseOrigin(){let S=this.getCurrentRecord();if(S.type!==l.ORIGIN)throw new Error("second line of sdp must be origin");let I=this.extractOneOrMore(S,h);this.consumeSpaceForRecord(S);let O=this.extractOneOrMore(S,u);this.consumeSpaceForRecord(S);let B=this.extractOneOrMore(S,u);this.consumeSpaceForRecord(S);let se=this.extractOneOrMore(S,p);this.consumeSpaceForRecord(S);let ge=this.extractOneOrMore(S,p);this.consumeSpaceForRecord(S);let ve=this.extract(S,this.consumeUnicastAddress);return this.currentLine++,{username:I,sessId:O,sessVersion:B,nettype:se,addrtype:ge,unicastAddress:ve}}parseSessionName(){let S=this.getCurrentRecord();if(S.type===l.SESSION_NAME){let I=this.extract(S,this.consumeText);return this.currentLine++,I}}parseInformation(){let S=this.getCurrentRecord();if(S.type!==l.INFORMATION)return;let I=this.extract(S,this.consumeText);return this.currentLine++,I}parseUri(){let S=this.getCurrentRecord();if(S.type===l.URI)return this.currentLine++,S.value}parseEmail(){let S=[];for(;;){let I=this.getCurrentRecord();if(I.type!==l.EMAIL)break;S.push(I.value),this.currentLine++}return S}parsePhone(){let S=[];for(;;){let I=this.getCurrentRecord();if(I.type!==l.PHONE)break;S.push(I.value),this.currentLine++}return S}parseConnection(){let S=this.getCurrentRecord();if(S.type===l.CONNECTION){let I=this.extractOneOrMore(S,p);this.consumeSpaceForRecord(S);let O=this.extractOneOrMore(S,p);this.consumeSpaceForRecord(S);let B=this.extract(S,this.consumeAddress);return this.currentLine++,{nettype:I,addrtype:O,address:B}}}parseMedia(){let S=this.getCurrentRecord(),I=this.extract(S,this.consumeToken);this.consumeSpaceForRecord(S);let O=this.extract(S,this.consumePort);S.value[S.cur]==="/"&&(S.cur+=1,O+=this.extract(S,this.consumeInteger)),this.consumeSpaceForRecord(S);let B=[];for(B.push(this.extract(S,this.consumeToken));S.value[S.cur]==="/";)S.cur+=1,B.push(this.extract(S,this.consumeToken));if(B.length===0)throw new Error("Invalid proto");let se=this.parseFmt(S);return this.currentLine++,{mediaType:I,port:O,protos:B,fmts:se}}parseTimeFields(){let S=[];for(;this.getCurrentRecord().type===l.TIME;){let I=this.parseTime(),O=this.parseRepeat(),B=this.parseZone();S.push({time:I,repeats:O,zones:B})}return S}parseMediaDescription(){let S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.MEDIA;){let I=this.parseMedia(),O=this.parseInformation(),B=this.parseConnections(),se=this.parseBandWidth(),ge=this.parseKey(),ve=this.parseMediaAttributes(I);S.push({media:I,information:O,connections:B,bandwidths:se,key:ge,attributes:ve})}return S}parseConnections(){let S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.CONNECTION;)S.push(this.parseConnection());return S}parseFmt(S){let I=[];for(;;)try{this.consumeSpaceForRecord(S),I.push(this.extract(S,this.consumeToken))}catch{break}if(I.length===0)throw new Error("Invalid fmts");return I}extract(S,I){for(var O=arguments.length,B=new Array(O>2?O-2:0),se=2;se<O;se++)B[se-2]=arguments[se];let ge=I.call(this,S.value,S.cur,...B),ve=S.value.slice(S.cur,ge);return S.cur=ge,ve}extractOneOrMore(S,I){let O=this.consumeOneOrMore(S.value,S.cur,I),B=S.value.slice(S.cur,O);return S.cur=O,B}consumeSpaceForRecord(S){if(S.value[S.cur]!==c)throw new Error("Invalid space at ".concat(S.cur,"."));S.cur+=1}}class G extends P{constructor(){super(...arguments),N(this,"attributes",void 0),N(this,"digested",!1)}extractOneOrMore(S,I,O){let B=this.consumeOneOrMore(S.attValue,S._cur,I),se=S.attValue.slice(S._cur,B),[ge,ve]=O||[];if(typeof ge=="number"&&se.length<ge)throw new Error("error in length, should be more or equal than ".concat(ge," characters."));if(typeof ve=="number"&&se.length>ve)throw new Error("error in length, should be less or equal than ".concat(ve," characters."));return S._cur=B,se}consumeAttributeSpace(S){if(S.attValue[S._cur]!==c)throw new Error("Invalid space at ".concat(S._cur,"."));S._cur+=1}extract(S,I){if(!S.attValue)throw new Error("Nothing to extract from attValue.");for(var O=arguments.length,B=new Array(O>2?O-2:0),se=2;se<O;se++)B[se-2]=arguments[se];let ge=I.call(this,S.attValue,S._cur,...B),ve=S.attValue.slice(S._cur,ge);return S._cur=ge,ve}atEnd(S){if(!S.attValue)throw new Error;return S._cur>=S.attValue.length}peekChar(S){if(!S.attValue)throw new Error;return S.attValue[S._cur]}peek(S,I){if(!S.attValue)throw new Error;for(let O=0;O<I.length;O++)if(I[O]!==S.attValue[S._cur+O])return!1;return!0}parseIceUfrag(S){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(S,g,[4,256])}parseIcePwd(S){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(S,g,[22,256])}parseIceOptions(S){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let I=[];for(;!this.atEnd(S);){I.push(this.extractOneOrMore(S,g));try{this.consumeAttributeSpace(S)}catch(O){if(this.atEnd(S))break;throw O}}this.attributes.iceOptions=I}parseFingerprint(S){let I=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);let O=this.extract(S,this.consumeTill);this.attributes.fingerprints.push({hashFunction:I,fingerprint:O})}parseExtmap(S){let I=this.extractOneOrMore(S,u),O;this.peekChar(S)==="/"&&(this.extract(S,this.consume,"/"),O=this.extract(S,this.consumeToken)),this.consumeAttributeSpace(S);let B=this.extract(S,this.consumeTill,c),se=A(A({entry:parseInt(I,10)},O&&{direction:O}),{},{extensionName:B});this.peekChar(S)===c&&(this.consumeAttributeSpace(S),se.extensionAttributes=this.extract(S,this.consumeTill)),this.attributes.extmaps.push(se)}parseSetup(S){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let I=this.extract(S,this.consumeTill);if(I!=="active"&&I!=="passive"&&I!=="actpass"&&I!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=I}}class ne extends G{constructor(){super(...arguments),N(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"group":this.parseGroup(S);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"fingerprint":this.parseFingerprint(S);break;case"setup":this.parseSetup(S);break;case"tls-id":this.parseTlsId(S);break;case"identity":this.parseIdentity(S);break;case"extmap":this.parseExtmap(S);break;case"msid-semantic":this.parseMsidSemantic(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(I){throw console.error("parsing session attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),I}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(S){let I=this.extract(S,this.consumeToken),O=[];for(;!this.atEnd(S)&&this.peekChar(S)===c;)this.consumeAttributeSpace(S),O.push(this.extract(S,this.consumeToken));this.attributes.groups.push({semantic:I,identificationTag:O})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(S){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(S,T)}parseIdentity(S){let I=this.extractOneOrMore(S,R),O=[];for(;!this.atEnd(S)&&this.peekChar(S)===c;){this.consumeAttributeSpace(S);let B=this.extract(S,this.consumeToken);this.extract(S,this.consume,"=");let se=this.extractOneOrMore(S,ge=>ge!==c&&E(ge));O.push({name:B,value:se})}this.attributes.identities.push({assertionValue:I,extensions:O})}parseMsidSemantic(S){this.peekChar(S)===c&&this.consumeAttributeSpace(S);let I={semantic:this.extract(S,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(S)}catch{break}if(this.peekChar(S)==="*"){this.extract(S,this.consume,"*"),I.applyForAll=!0;break}{let O=this.extract(S,this.consumeTill,c);I.identifierList.push(O)}}this.attributes.msidSemantic=I}}class z extends G{constructor(S){super(),N(this,"attributes",void 0),S.protos.indexOf("RTP")!==-1||S.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"extmap":this.parseExtmap(S);break;case"setup":this.parseSetup(S);break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"candidate":this.parseCandidate(S);break;case"remote-candidate":this.parseRemoteCandidate(S);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(S);break;case"rtpmap":this.parseRtpmap(S);break;case"ptime":this.parsePtime(S);break;case"maxptime":this.parseMaxPtime(S);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(S);break;case"ssrc":this.parseSSRC(S);break;case"fmtp":this.parseFmtp(S);break;case"rtcp-fb":this.parseRtcpFb(S);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(S);break;case"mid":this.parseMid(S);break;case"msid":this.parseMsid(S);break;case"imageattr":this.parseImageAttr(S);break;case"rid":this.parseRid(S);break;case"simulcast":this.parseSimulcast(S);break;case"sctp-port":this.parseSctpPort(S);break;case"max-message-size":this.parseMaxMessageSize(S);break;case"ssrc-group":this.parseSSRCGroup(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(I){throw console.error("parsing media attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),I}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}parseCandidate(S){let I=this.extractOneOrMore(S,g,[1,32]);this.consumeAttributeSpace(S);let O=this.extractOneOrMore(S,u,[1,5]);this.consumeAttributeSpace(S);let B=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);let se=this.extractOneOrMore(S,u,[1,10]);this.consumeAttributeSpace(S);let ge=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);let ve=this.extract(S,this.consumePort);this.consumeAttributeSpace(S),this.extract(S,this.consume,"typ"),this.consumeAttributeSpace(S);let ut={foundation:I,componentId:O,transport:B,priority:se,connectionAddress:ge,port:ve,type:this.extract(S,this.consumeToken),extension:{}};for(this.peek(S," raddr")&&(this.extract(S,this.consume," raddr"),this.consumeAttributeSpace(S),ut.relAddr=this.extract(S,this.consumeAddress)),this.peek(S," rport")&&(this.extract(S,this.consume," rport"),this.consumeAttributeSpace(S),ut.relPort=this.extract(S,this.consumePort));this.peekChar(S)===c;){this.consumeAttributeSpace(S);let yt=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S),ut.extension[yt]=this.extractOneOrMore(S,d)}this.attributes.candidates.push(ut)}parseRemoteCandidate(S){let I=[];for(;;){let O=this.extractOneOrMore(S,u,[1,5]);this.consumeAttributeSpace(S);let B=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);let se=this.extract(S,this.consumePort);I.push({componentId:O,connectionAddress:B,port:se});try{this.consumeAttributeSpace(S)}catch{break}}this.attributes.remoteCandidatesList.push(I)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(S){let I=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);let O=this.extract(S,this.consumeTill,"/");this.extract(S,this.consume,"/");let B={encodingName:O,clockRate:this.extractOneOrMore(S,u)};this.atEnd(S)||this.peekChar(S)!=="/"||(this.extract(S,this.consume,"/"),B.encodingParameters=parseInt(this.extract(S,this.consumeTill),10));let se=this.attributes.payloads.find(ge=>ge.payloadType===parseInt(I,10));se?se.rtpMap=B:this.attributes.payloads.push({payloadType:parseInt(I,10),rtpMap:B,rtcpFeedbacks:[]})}parsePtime(S){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(S,this.consumeTill)}parseMaxPtime(S){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(S,this.consumeTill)}parseDirection(S){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=S.attField}parseSSRC(S){let I=this.extractOneOrMore(S,u);this.consumeAttributeSpace(S);let O=this.extract(S,this.consumeTill,":"),B;this.peekChar(S)===":"&&(this.extract(S,this.consume,":"),B=this.extract(S,this.consumeTill));let se=this.attributes.ssrcs.find(ge=>ge.ssrcId===parseInt(I,10));se?se.attributes[O]=B:this.attributes.ssrcs.push({ssrcId:parseInt(I,10),attributes:{[O]:B}})}parseFmtp(S){let I=this.extract(S,this.consumeTill,c);this.consumeAttributeSpace(S);let O=this.extract(S,this.consumeTill),B={};O.split(";").forEach(ge=>{let[ve,ut]=ge.split("=");ve=Ar(ve).call(ve);let yt=typeof ut=="string"?Ar(ut).call(ut):null;typeof ve=="string"&&ve.length>0&&(B[ve]=yt)});let se=this.attributes.payloads.find(ge=>ge.payloadType===parseInt(I,10));se?se.fmtp={parameters:B}:this.attributes.payloads.push({payloadType:parseInt(I,10),rtcpFeedbacks:[],fmtp:{parameters:B}})}parseFmtParameters(S){let I={},O=this.extract(S,this.consumeTill,"=");S._cur++;let B=this.extract(S,this.consumeTill,";");for(I[O]=B;S.attValue[S._cur]===";";){let se=this.extract(S,this.consumeTill,"=");S._cur++;let ge=this.extract(S,this.consumeTill,";");I[se]=ge}return I}parseRtcpFb(S){let I="";I=this.peekChar(S)==="*"?this.extract(S,this.consume,"*"):this.extract(S,this.consumeTill,c),this.consumeAttributeSpace(S);let O=this.extract(S,this.consumeTill,c),B;if(O==="trr-int")B={type:O,interval:this.extract(S,this.consumeTill)};else{let se={type:O};this.peekChar(S)===c&&(this.consumeAttributeSpace(S),se.parameter=this.extract(S,this.consumeToken),this.peekChar(S)===c&&(se.additional=this.extract(S,this.consumeTill))),B=se}if(I==="*")this.attributes.rtcpFeedbackWildcards.push(B);else{let se=this.attributes.payloads.find(ge=>ge.payloadType===parseInt(I,10));se?se.rtcpFeedbacks.push(B):this.attributes.payloads.push({payloadType:parseInt(I,10),rtcpFeedbacks:[B]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(S){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let I={port:this.extract(S,this.consumePort)};this.peekChar(S)===c&&(this.consumeAttributeSpace(S),I.netType=this.extractOneOrMore(S,p),this.consumeAttributeSpace(S),I.addressType=this.extractOneOrMore(S,p),this.consumeAttributeSpace(S),I.address=this.extract(S,this.consumeAddress)),this.attributes.rtcp=I}parseMsid(S){let I={id:this.extractOneOrMore(S,p,[1,64])};this.peekChar(S)===c&&(this.consumeAttributeSpace(S),I.appdata=this.extractOneOrMore(S,p,[1,64])),this.attributes.msids.push(I)}parseImageAttr(S){this.attributes.imageattr.push(S.attValue)}parseRid(S){let I=this.extractOneOrMore(S,B=>f(B)||u(B)||B==="_"||B==="-");this.consumeAttributeSpace(S);let O={id:I,direction:this.extract(S,this.consumeToken),params:[]};if(this.peekChar(S)===c){if(this.consumeAttributeSpace(S),this.peek(S,"pt=")){this.extract(S,this.consume,"pt=");let B=[];for(;;){let se=this.extract(S,this.consumeToken);B.push(se);try{this.extract(S,this.consume,",")}catch{break}}O.payloads=B,this.peekChar(S)===c&&this.extract(S,this.consume,c)}for(;;){let B=this.extract(S,this.consumeToken);switch(B){case"depend":{let se={type:B,rids:this.extract(S,this.consume,"=").split(",")};O.params.push(se);break}default:{let se={type:B};this.peekChar(S)==="="&&(this.extract(S,this.consume,"="),se.val=this.extract(S,this.consumeTill,";")),O.params.push(se)}}try{this.extract(S,this.consume,";")}catch{break}}}this.attributes.rids.push(O)}parseSimulcast(S){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=S.attValue,this.extract(S,this.consumeTill)}parseSctpPort(S){this.attributes.sctpPort=this.extractOneOrMore(S,u,[1,5])}parseMaxMessageSize(S){this.attributes.maxMessageSize=this.extractOneOrMore(S,u,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(S){this.attributes.mid=this.extract(S,this.consumeToken)}parseSSRCGroup(S){let I=this.extract(S,this.consumeToken),O=[];for(;;)try{this.consumeAttributeSpace(S);let B=this.extract(S,this.consumeInteger);O.push(parseInt(B,10))}catch{break}this.attributes.ssrcGroups.push({semantic:I,ssrcIds:O})}}function k(L,S,I){return S in L?Object.defineProperty(L,S,{value:I,enumerable:!0,configurable:!0,writable:!0}):L[S]=I,L}class F{constructor(){k(this,"eol",s)}print(S,I){let O="";return I&&(this.eol=I),O+=this.printVersion(S.version),O+=this.printOrigin(S.origin),O+=this.printSessionName(S.sessionName),O+=this.printInformation(S.information),O+=this.printUri(S.uri),O+=this.printEmail(S.emails),O+=this.printPhone(S.phones),O+=this.printConnection(S.connection),O+=this.printBandwidth(S.bandwidths),O+=this.printTimeFields(S.timeFields),O+=this.printKey(S.key),O+=this.printSessionAttributes(S.attributes),O+=this.printMediaDescription(S.mediaDescriptions),O}printVersion(S){return"v=".concat(S).concat(this.eol)}printOrigin(S){return"o=".concat(S.username," ").concat(S.sessId," ").concat(S.sessVersion," ").concat(S.nettype," ").concat(S.addrtype," ").concat(S.unicastAddress).concat(this.eol)}printSessionName(S){return S?"s=".concat(S).concat(this.eol):""}printInformation(S){return S?"i=".concat(S).concat(this.eol):""}printUri(S){return S?"u=".concat(S).concat(this.eol):""}printEmail(S){let I="";for(let O of S)I+="e=".concat(O).concat(this.eol);return I}printPhone(S){let I="";for(let O of S)I+="e=".concat(O).concat(this.eol);return I}printConnection(S){return S?"c=".concat(S.nettype," ").concat(S.addrtype," ").concat(S.address).concat(this.eol):""}printBandwidth(S){let I="";for(let O of S)I+="b=".concat(O.bwtype,":").concat(O.bandwidth).concat(this.eol);return I}printTimeFields(S){let I="";for(let O of S){I+="t=".concat(O.time.startTime," ").concat(O.time.startTime).concat(this.eol);for(let B of O.repeats)I+="r=".concat(B.repeatInterval," ").concat(B.typedTimes.join(" ")).concat(this.eol);O.zoneAdjustments&&(I+="z=",I+="z=".concat(O.zoneAdjustments.map(B=>"".concat(B.time," ").concat(B.back?"-":""," ").concat(B.typedTime)).join(" ")).concat(this.eol),I+=this.eol)}return I}printKey(S){return S?"k=".concat(S).concat(this.eol):""}printAttributes(S){let I="";for(let O of S)I+="a=".concat(O.attField).concat(O.attValue?":".concat(O.attValue):"").concat(this.eol);return I}printMediaDescription(S){let I="";for(let O of S)I+=this.printMedia(O.media),I+=this.printInformation(O.information),I+=this.printConnections(O.connections),I+=this.printBandwidth(O.bandwidths),I+=this.printKey(O.key),I+=this.printMediaAttributes(O);return I}printConnections(S){let I="";for(let O of S)I+=this.printConnection(O);return I}printMedia(S){return"m=".concat(S.mediaType," ").concat(S.port," ").concat(S.protos.join("/")," ").concat(S.fmts.join(" ")).concat(this.eol)}printSessionAttributes(S){return new oe(this.eol).print(S)}printMediaAttributes(S){return new U(this.eol).print(S)}}class K{constructor(S){k(this,"eol",void 0),this.eol=S}printIceUfrag(S){return S===void 0?"":"a=ice-ufrag:".concat(S).concat(this.eol)}printIcePwd(S){return S===void 0?"":"a=ice-pwd:".concat(S).concat(this.eol)}printIceOptions(S){return S===void 0?"":"a=ice-options:".concat(S.join(c)).concat(this.eol)}printFingerprints(S){return S.length>0?S.map(I=>"a=fingerprint:".concat(I.hashFunction).concat(c).concat(I.fingerprint)).join(this.eol)+this.eol:""}printExtmap(S){return S.map(I=>"a=extmap:".concat(I.entry).concat(I.direction?"/".concat(I.direction):"").concat(c).concat(I.extensionName).concat(I.extensionAttributes?"".concat(c).concat(I.extensionAttributes):"").concat(this.eol)).join("")}printSetup(S){return S===void 0?"":"a=setup:".concat(S).concat(this.eol)}printUnrecognized(S){return S.map(I=>"a=".concat(I.attField).concat(I.attValue?":".concat(I.attValue):"").concat(this.eol)).join("")}}class oe extends K{print(S){let I="";return I+=this.printGroups(S.groups),I+=this.printMsidSemantic(S.msidSemantic),I+=this.printIceLite(S.iceLite),I+=this.printIceUfrag(S.iceUfrag),I+=this.printIcePwd(S.icePwd),I+=this.printIceOptions(S.iceOptions),I+=this.printFingerprints(S.fingerprints),I+=this.printSetup(S.setup),I+=this.printTlsId(S.tlsId),I+=this.printIdentity(S.identities),I+=this.printExtmap(S.extmaps),I+=this.printUnrecognized(S.unrecognized),I}printGroups(S){let I="";return S.length>0&&(I+=S.map(O=>"a=group:".concat(O.semantic).concat(O.identificationTag.map(B=>"".concat(c).concat(B)).join("")).concat(this.eol)).join("")),I}printIceLite(S){return S===void 0?"":"a=ice-lite"+this.eol}printTlsId(S){return S?"a=tls-id:".concat(S).concat(this.eol):""}printIdentity(S){return S.length===0?"":S.map(I=>"a=identity:".concat(I.assertionValue).concat(I.extensions.map(O=>"".concat(c).concat(O.name).concat(O.value?"=".concat(O.value):"")))).join(this.eol)+this.eol}printMsidSemantic(S){if(!S)return"";let I="a=msid-semantic:".concat(S.semantic);return S.applyForAll?I+="".concat(c,"*"):S.identifierList.length>0&&(I+=S.identifierList.map(O=>"".concat(c).concat(O))),I+this.eol}}class U extends K{print(S){let I=S.attributes,O="";return O+=this.printRTCP(I.rtcp),O+=this.printIceUfrag(I.iceUfrag),O+=this.printIcePwd(I.icePwd),O+=this.printIceOptions(I.iceOptions),O+=this.printCandidates(I.candidates),O+=this.printRemoteCandidatesList(I.remoteCandidatesList),O+=this.printEndOfCandidates(I.endOfCandidates),O+=this.printFingerprints(I.fingerprints),O+=this.printSetup(I.setup),O+=this.printMid(I.mid),O+=this.printExtmap(I.extmaps),O+=this.printRTPRelated(I),O+=this.printPtime(I.ptime),O+=this.printMaxPtime(I.maxPtime),O+=this.printDirection(I.direction),O+=this.printSSRCGroups(I.ssrcGroups),O+=this.printSSRC(I.ssrcs),O+=this.printRTCPMux(I.rtcpMux),O+=this.printRTCPMuxOnly(I.rtcpMuxOnly),O+=this.printRTCPRsize(I.rtcpRsize),O+=this.printMSId(I.msids),O+=this.printImageattr(I.imageattr),O+=this.printRid(I.rids),O+=this.printSimulcast(I.simulcast),O+=this.printSCTPPort(I.sctpPort),O+=this.printMaxMessageSize(I.maxMessageSize),O+=this.printUnrecognized(I.unrecognized),O}printCandidates(S){return S.map(I=>"a=candidate:".concat(I.foundation).concat(c).concat(I.componentId).concat(c).concat(I.transport).concat(c).concat(I.priority).concat(c).concat(I.connectionAddress).concat(c).concat(I.port).concat(c,"typ").concat(c).concat(I.type).concat(I.relAddr?"".concat(c,"raddr").concat(c).concat(I.relAddr):"").concat(I.relPort?"".concat(c,"rport").concat(c).concat(I.relPort):"").concat(Object.keys(I.extension).map(O=>"".concat(c).concat(O).concat(c).concat(I.extension[O])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(S){return S.map(I=>"a=remote-candidates:".concat(I.join(c)).concat(this.eol)).join("")}printEndOfCandidates(S){return S===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(S){if(!S.payloads)return"";let I=S.payloads,O="";O+=S.rtcpFeedbackWildcards.map(B=>this.printRTCPFeedback("*",B)).join("");for(let B of I)O+=this.printRtpMap(B.payloadType,B.rtpMap),O+=this.printFmtp(B.payloadType,B.fmtp),O+=B.rtcpFeedbacks.map(se=>this.printRTCPFeedback(B.payloadType,se)).join("");return O}printFmtp(S,I){if(!I)return"";let O=Object.keys(I.parameters);return O.length===1&&I.parameters[O[0]]===null?"a=fmtp:".concat(S).concat(c).concat(O[0]).concat(this.eol):"a=fmtp:".concat(S).concat(c).concat(Object.keys(I.parameters).map(B=>"".concat(B,"=").concat(I.parameters[B])).join(";")).concat(this.eol)}printRtpMap(S,I){return I?"a=rtpmap:".concat(S).concat(c).concat(I.encodingName,"/").concat(I.clockRate).concat(I.encodingParameters?"/".concat(I.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(S,I){let O="a=rtcp-fb:".concat(S).concat(c),B=I;return B.type==="trr-int"?O+="ttr-int".concat(c).concat(B.interval):(O+="".concat(B.type),B.parameter&&(O+="".concat(c).concat(B.parameter),B.additional&&(O+="".concat(c).concat(B.additional)))),O+this.eol}printPtime(S){return S===void 0?"":"a=ptime:".concat(S).concat(this.eol)}printMaxPtime(S){return S===void 0?"":"a=maxptime:".concat(S).concat(this.eol)}printDirection(S){return S===void 0?"":"a=".concat(S).concat(this.eol)}printSSRC(S){return S.map(I=>Object.keys(I.attributes).map(O=>"a=ssrc:".concat(I.ssrcId.toString(10)).concat(c).concat(O).concat(I.attributes[O]?":".concat(I.attributes[O]):"").concat(this.eol)).join("")).join("")}printRTCPMux(S){return S===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(S){return S===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(S){return S===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(S){if(S===void 0)return"";let I="a=rtcp:".concat(S.port);return S.netType&&(I+="".concat(c).concat(S.netType)),S.addressType&&(I+="".concat(c).concat(S.addressType)),S.address&&(I+="".concat(c).concat(S.address)),I+this.eol}printMSId(S){return S.map(I=>"a=msid:".concat(I.id).concat(I.appdata?"".concat(c).concat(I.appdata):"").concat(this.eol)).join("")}printImageattr(S){return S.map(I=>"a=imageattr:".concat(I).concat(this.eol)).join("")}printRid(S){return S.map(I=>{let O="a=rid:".concat(I.id).concat(c).concat(I.direction);return I.payloads&&(O+="".concat(c,"pt=").concat(I.payloads.join(","))),I.params.length>0&&(O+="".concat(c).concat(I.params.map(B=>B.type==="depend"?"depend=".concat(B.rids.join(",")):"".concat(B.type,"=").concat(B.val)).join(";"))),O+this.eol}).join("")}printSimulcast(S){return S===void 0?"":"a=simulcast:".concat(S).concat(this.eol)}printSCTPPort(S){return S===void 0?"":"a=sctp-port:".concat(S).concat(this.eol)}printMaxMessageSize(S){return S===void 0?"":"a=max-message-size:".concat(S).concat(this.eol)}printMid(S){return S===void 0?"":"a=mid:".concat(S).concat(this.eol)}printSSRCGroups(S){return S.map(I=>"a=ssrc-group:".concat(I.semantic).concat(I.ssrcIds.map(O=>"".concat(c).concat(O.toString(10))).join("")).concat(this.eol)).join("")}}function D(L){return new x().parse(L)}function W(L,S){return new F().print(L,S)}}},t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}return r.d=(n,i)=>{for(var o in i)r.o(i,o)&&!r.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:i[o]})},r.o=(n,i)=>Object.prototype.hasOwnProperty.call(n,i),r.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r(8)})();var Qt=CV.exports;function bT(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:b("SVC_MODE");if(b("ENABLE_SVC"))return function(t){return t in _T}(e)?e:_T.L1T3}function gN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function vN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gN(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $d(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,{filterRTX:i,filterVideoFec:o,filterAudioFec:a,filterAudioCodec:s,filterVideoCodec:c}=t,{useXR:l}=r,u=[],d=[],h=[],p=[],m=!1,f=!1;if(Qt.parse(e).mediaDescriptions.forEach(E=>{n&&n!==E.attributes.direction||(E.media.mediaType!=="video"||m||(d=E.attributes.payloads,p=E.attributes.extmaps,m=!0),E.media.mediaType!=="audio"||f||(u=E.attributes.payloads,h=E.attributes.extmaps,f=!0))}),!p||d.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!h||u.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(d.forEach(E=>{var g;(g=E.rtpMap)!==null&&g!==void 0&&g.clockRate&&(E.rtpMap.clockRate=parseInt(E.rtpMap.clockRate)),l&&E.rtcpFeedbacks.push({type:"rrtr"})}),u.forEach(E=>{var g;(g=E.rtpMap)!==null&&g!==void 0&&g.clockRate&&(E.rtpMap.clockRate=parseInt(E.rtpMap.clockRate)),l&&E.rtcpFeedbacks.push({type:"rrtr"})}),i&&(u=u.filter(E=>{var g;return((g=E.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())!=="rtx"}),d=d.filter(E=>{var g;return((g=E.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())!=="rtx"})),o&&(d=d.filter(E=>{var g;return!/(red)|(ulpfec)|(flexfec)/i.test(((g=E.rtpMap)===null||g===void 0?void 0:g.encodingName)||"")})),a&&(u=u.filter(E=>{var g;return!/(red)|(ulpfec)|(flexfec)/i.test(((g=E.rtpMap)===null||g===void 0?void 0:g.encodingName)||"")})),s&&(s==null?void 0:s.length)>0&&(u=u.filter(E=>{var g;return q(s).call(s,((g=E.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())||"")})),c&&(c==null?void 0:c.length)>0){let E=d.filter(g=>{var T;return q(c).call(c,((T=g.rtpMap)===null||T===void 0?void 0:T.encodingName.toLowerCase())||"")});d=E.concat(i?[]:jR(E,d))}let _=b("UNSUPPORTED_VIDEO_CODEC");return _&&_.length>0&&(d=d.filter(E=>!(E.rtpMap&&q(_).call(_,E.rtpMap.encodingName.toLowerCase())))),{audioCodecs:u,videoCodecs:d,audioExtensions:h,videoExtensions:p}}function ka(e){let t=Qt.parse(e),r,n;for(let i of t.mediaDescriptions){if(!r){let o=i.attributes.iceUfrag,a=i.attributes.icePwd;if(!o||!a)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:o,icePwd:a}}if(!n){let o=i.attributes.fingerprints;o.length>0&&(n={fingerprints:o})}}if(!n&&t.attributes.fingerprints.length>0&&(n={fingerprints:t.attributes.fingerprints}),!n||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:n}}function IV(e,t){let r=[],n=e.attributes.ssrcGroups.filter(a=>a.semantic==="FID"),i=e.attributes.ssrcGroups.find(a=>a.semantic==="SIM"),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(a=>{var s;let c=(s=n.find(l=>l.ssrcIds[0]===a))===null||s===void 0?void 0:s.ssrcIds[1];r.push({ssrcId:a,rtx:t?c:void 0})});else if(n.length>0){let a=n[0].ssrcIds[0],s=n[0].ssrcIds[1];r.push({ssrcId:a,rtx:t?s:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:o[0].ssrcId})}return r}function SN(e,t,r){let{cname:n}=e,i;t?i=wV(t):(i=e.iceParameters.candidates.map(u=>({foundation:u.foundation,componentId:"1",transport:u.protocol,priority:u.priority.toString(),connectionAddress:u.ip,port:u.port.toString(),type:u.type,extension:{}})),v.debug("Using candidates from gateway."));let o={fingerprints:e.dtlsParameters.fingerprints.map(u=>({hashFunction:u.algorithm,fingerprint:u.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},s;switch(e.dtlsParameters.role){case"server":s="passive";break;case"client":s="active";break;case"auto":s="actpass"}let c=gm(e.rtpCapabilities),l=[];return Array.isArray(r)&&r.length>0&&r.forEach(u=>{l.push({kind:re.VIDEO,ssrcId:u.v,rtx:u.v_rtx,mslabel:"".concat(u.v,"_").concat(u.a)},{kind:re.AUDIO,ssrcId:u.a,mslabel:"".concat(u.v,"_").concat(u.a)})}),{dtlsParameters:o,iceParameters:a,candidates:i,rtpCapabilities:c,setup:s,cname:n,preSSRCs:l}}function wV(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function Ts(e,t,r){let n=[],i=[];return e.forEach(o=>{let{ssrcId:a,rtx:s}=o,c=Ke(8,"track-"),l={ssrcId:a,attributes:vN({label:c,mslabel:r=r||Ke(10,""),msid:"".concat(r," ").concat(c)},t&&{cname:t})};if(n.push(l),s!==void 0){let u={ssrcId:s,attributes:vN({label:c,mslabel:r,msid:"".concat(r," ").concat(c)},t&&{cname:t})};n.push(u),i.push({semantic:"FID",ssrcIds:[a,s]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(o=>{let{ssrcId:a}=o;return a})}),{ssrcs:n,ssrcGroups:i}}function Pl(e,t){t instanceof ht&&e.attributes.payloads.forEach(r=>{var n;let i=(n=r.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";let o=t._encoderConfig;o&&i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(o.bitrate&&!ft()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function VR(e){let t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function FR(e,t){var r;if(!(t instanceof Xe&&t._encoderConfig&&t._hints.indexOf(et.SCREEN_TRACK)===-1))return;let n=t._encoderConfig;Pe().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(i=>{var o,a;q(o=["h264","h265","vp8","vp9","av1"]).call(o,((a=i.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),Pe().supportMinBitrate&&!q(r=t._hints).call(r,et.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(i=>{var o,a;q(o=["h264","h265","vp8","vp9","av1"]).call(o,((a=i.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(b("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function AV(e){if(e.media.mediaType!=="video")return;let t=Ne();if(t.name!==Ue.SAFARI&&t.os!==Gt.IOS)return;let r=e.attributes.extmaps.findIndex(n=>/video-orientation/g.test(n.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function Em(e,t,r){if(!t)return;let n,i;if(e.media.mediaType==="video"?(n=r.videoExtensions,i=r.videoCodecs):(n=r.audioExtensions,i=r.audioCodecs),t.twcc===!0){let o=n.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&(e.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a,s){return s.filter(c=>!!a.find(l=>l.payloadType===c.payloadType&&!!l.rtcpFeedbacks.find(u=>u.type==="transport-cc")))}(i,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(s=>s.type==="transport-cc")||a.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){let o=e.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(a=>{let s=a.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");s!==-1&&a.rtcpFeedbacks.splice(s,1)})}if(t.remb===!0){let o=n.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o&&(e.attributes.extmaps.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a,s){return s.filter(c=>!!a.find(l=>l.payloadType===c.payloadType&&!!l.rtcpFeedbacks.find(u=>u.type==="goog-remb")))}(i,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(s=>s.type==="goog-remb")||a.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){let o=e.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(a=>{let s=a.rtcpFeedbacks.findIndex(c=>c.type==="goog-remb");s!==-1&&a.rtcpFeedbacks.splice(s,1)})}}function bV(e,t,r){if(ft()||e.media.mediaType!=="video"||!(t instanceof Xe)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!b("SIMULCAST")||r==="vp9"&&b("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let n=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(s=>s.semantic==="FID"&&s.ssrcIds[0]===i.ssrcId),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let s=1;s<n;s++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+s,attributes:Ct(i.attributes)}),a.ssrcIds.push(i.ssrcId+s),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+s,attributes:Ct(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+s,o.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(a)}async function OV(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});let n=(await r.createOffer()).sdp,{send:i,recv:o,sendrecv:a}=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0,u=$d(l,s,c,"sendonly"),d=$d(l,s,c,"recvonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Si(u,d,"videoExtensions",h,p,m),Si(u,d,"videoCodecs",h,p,m),Si(u,d,"audioExtensions",h,p,m),Si(u,d,"audioCodecs",h,p,m),b("RAISE_H264_BASELINE_PRIORITY")){let f=m.videoCodecs.findIndex(_=>{var E,g;return((E=_.rtpMap)===null||E===void 0?void 0:E.encodingName.toLocaleLowerCase())==="h264"&&((g=_.fmtp)===null||g===void 0?void 0:g.parameters["profile-level-id"])==="42001f"});if(f!==-1){let _=m.videoCodecs.findIndex(E=>{var g;return((g=E.rtpMap)===null||g===void 0?void 0:g.encodingName.toLocaleLowerCase())==="h264"});if(_<f){v.debug("raising H264 baseline profile priority");let E=m.videoCodecs[f];m.videoCodecs.splice(f,1),m.videoCodecs.splice(_,0,E)}_!==-1&&(p.videoCodecs=p.videoCodecs.filter(E=>{var g,T;return!(((g=E.rtpMap)===null||g===void 0?void 0:g.encodingName.toLocaleLowerCase())==="h264"&&((T=E.fmtp)===null||T===void 0?void 0:T.parameters["profile-level-id"])!=="42001f")})),_!==-1&&b("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(E=>{var g,T;return!(((g=E.rtpMap)===null||g===void 0?void 0:g.encodingName.toLocaleLowerCase())==="h264"&&((T=E.fmtp)===null||T===void 0?void 0:T.parameters["profile-level-id"])!=="42001f")}))}}return{send:h,recv:p,sendrecv:m}}(e,t,n);try{r.close()}catch{}return{send:i,recv:o,sendrecv:a}}function TN(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=$d(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Si(e,t,"videoExtensions",r,n,i),Si(e,t,"videoCodecs",r,n,i),Si(e,t,"audioExtensions",r,n,i),Si(e,t,"audioCodecs",r,n,i),b("RAISE_H264_BASELINE_PRIORITY")){let o=i.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){let a=i.videoCodecs.findIndex(s=>s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(a<o){v.debug("raising H264 baseline profile priority");let s=i.videoCodecs[o];i.videoCodecs.splice(o,1),i.videoCodecs.splice(a,0,s)}a!==-1&&(n.videoCodecs=n.videoCodecs.filter(s=>!(s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&s.fmtp&&s.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:n,sendrecv:i}}function Si(e,t,r,n,i,o){if(r==="videoExtensions"||r==="audioExtensions"){let a=[];return e[r].forEach(s=>{t[r].some((c,l)=>{if(s.entry===c.entry&&s.extensionName===c.extensionName)return a.push(l),!0})?o[r].push(s):n[r].push(s)}),void t[r].forEach((s,c)=>{a.indexOf(c)===-1&&i[r].push(s)})}if(r==="videoCodecs"||r==="audioCodecs"){let a=[];return e[r].forEach(s=>{t[r].some((c,l)=>{if(s.payloadType===c.payloadType&&JSON.stringify(s)===JSON.stringify(c))return a.push(l),!0})?o[r].push(s):n[r].push(s)}),void t[r].forEach((s,c)=>{a.indexOf(c)===-1&&i[r].push(s)})}}function gm(e){let{send:t,recv:r,sendrecv:n}=e;if(!n){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...n.audioCodecs],i.videoCodecs=[...t.videoCodecs,...n.videoCodecs],i.audioExtensions=[...t.audioExtensions,...n.audioExtensions],i.videoExtensions=[...t.videoExtensions,...n.videoExtensions]):i=n,r?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...r.audioCodecs,...n.audioCodecs],o.videoCodecs=[...r.videoCodecs,...n.videoCodecs],o.audioExtensions=[...r.audioExtensions,...n.audioExtensions],o.videoExtensions=[...r.videoExtensions,...n.videoExtensions]):o=n,{send:i,recv:o}}function Dl(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function ad(e,t,r,n){let i=[];if(e===re.VIDEO){if(b("H264_PROFILE_LEVEL_ID")&&n==="h264"&&(i=t.videoCodecs.filter(o=>{var a;return q(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,n)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===b("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let o=[],a=[],s=[],c=[];if(r.videoCodecs.forEach(l=>{let u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"";q(u).call(u,n)?o.push(l):q(u).call(u,"vp9")?a.push(l):q(u).call(u,"vp8")?s.push(l):q(u).call(u,"h264")&&c.push(l)}),o.length===0){let l="";a.length!==0?(o=a,l="vp9"):s.length!==0?(o=s,l="vp8"):c.length!==0&&(o=c,l="h264"),v.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(l))}o.length!==0&&(i=t.videoCodecs.filter(l=>o.some(u=>u.payloadType===l.payloadType)))}if(i.length===0&&(v.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),b("USE_PUB_RTX")||b("USE_SUB_RTX")){let o=jR(i,t.videoCodecs);i=[...i,...o]}}else i=t.audioCodecs.filter(o=>{var a;return q(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,n)}),i.length===0&&(v.warning("codec ".concat(n," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(o=>{var a;return q(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,"opus")}));return i}function jR(e,t){let r=e.map(n=>n.payloadType.toString());return t.filter(n=>n.rtpMap&&n.rtpMap.encodingName==="rtx"&&n.fmtp&&n.fmtp.parameters.apt&&q(r).call(r,n.fmtp&&n.fmtp.parameters.apt))}async function wp(e,t,r){let n=t.toString(),i=PV(n,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:n});let o=await e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let a=o.sdp;a=NV(a,r||{}),i==null||i(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function NV(e,t,r){let n=Qt.parse(e),{useXR:i}=t;return n.mediaDescriptions.forEach(o=>{var a;o.attributes.mid&&(Array.isArray(r)&&!q(r).call(r,o.attributes.mid)||(o.media.mediaType==="audio"&&Dl(o),i&&q(a=["audio","video"]).call(a,o.media.mediaType)&&o.attributes.payloads.forEach(s=>{s.rtcpFeedbacks.findIndex(c=>c.type==="rrtr")===-1&&s.rtcpFeedbacks.push({type:"rrtr"})})))}),Qt.print(n)}function PV(e,t,r,n){if(b("SDP_LOGGING"))return v.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(n,`
`),e),t==="offer"?i=>{PV(i,"answer",r==="local"?"remote":"local",n)}:void 0}function io(e,t){return typeof b(e)===t?b(e):void 0}function yN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ua(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yN(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Xg=new Map,HX=class extends lt{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(nr.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(nr.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),y(this,"store",void 0),y(this,"joinInfo",void 0),y(this,"key",void 0),y(this,"ntpOffset",0),y(this,"signal",void 0),y(this,"role",void 0),y(this,"inChannelInfo",{joinAt:null,duration:0}),y(this,"spec",void 0),y(this,"_state","DISCONNECTED"),y(this,"_statsCollector",void 0),y(this,"_disconnectedReason",void 0),y(this,"isSignalRecover",!1),y(this,"hasChangeBGPAddress",!1),y(this,"trafficStatsInterval",void 0),y(this,"networkQualityInterval",void 0),y(this,"_joinGatewayStartTime",0),y(this,"_signalTimeout",!1),y(this,"_clientRoleOptions",void 0),y(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new EN(ua(ua({},t),{},{retryConfig:t.websocketRetryConfig}),e):new fq(ua(ua({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,r){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let n=Date.now(),i=Xg.get(e.cname);if(i||(i=new Map,Xg.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){let c=new M(C.UID_CONFLICT);throw te.joinGateway(e.sid,{lts:n,succ:!1,ec:c.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,c}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=n;let a=e.proxyServer;try{v.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));let c=e.gatewayAddrs.map(l=>{let{address:u}=l,[d,h]=u.split(":"),p={host:d,port:h};return e.proxyServer&&(p.proxy=e.proxyServer),p});o=(await this.signal.init(c,r)).uid,v.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(c){var s;throw v.error("[".concat(this.store.clientId,"] User join failed"),c.toString()),te.joinGateway(e.sid,{lts:n,succ:!1,ec:((s=c.data)===null||s===void 0?void 0:s.desc)||c.code,errorMsg:c.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,i.delete(e.uid),this.signal.close(),c}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(c=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),c.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(nr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(nr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(nr.NETWORK_QUALITY,{uplinkNetworkQuality:mb(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:mb(this._statsCollector.trafficStats.B_dnq)}):this.emit(nr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){t!==Ve.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==He.CONNECTED||await function(r,n){return n===1/0?r:Y.race([r,d$(n)])}(this.signal.request(de.LEAVE,void 0,!0),3e3)}catch(r){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(t),t!==Ve.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let n={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:b("PUB_EXTEND"),twcc:!!b("PUBLISH_TWCC"),rtx:!!b("USE_PUB_RTX")};try{return(await this.signal.request(de.PUBLISH,n,!0))._message}catch(i){if(r&&i.data&&i.data.code===ae.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),i.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw i}}async publishDataChannel(e,t,r){var n;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:(n=t.maxRetransmits)!==null&&n!==void 0?n:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(de.PUBLISH_DATASTREAM,i,!0)}catch(o){if(r&&o.data&&o.data.code===ae.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw o}}async unpublish(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(de.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(r){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Y.all(e.map(t=>this.signal.request(de.UNPUBLISH_DATASTREAM,{channel_id:t},!0)))}catch(t){v.warning("unpublish datachannels warning: ",t)}}async presubscribe(e,t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let n={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!b("SUBSCRIBE_TWCC"),rtx:!!b("USE_SUB_RTX")||void 0,extend:b("SUB_EXTEND"),svc:Array.isArray(b("SVC"))&&b("SVC").length!==0?b("SVC"):void 0};try{return await this.signal.request(de.PRE_SUBSCRIBE,n,!0)}catch(i){if(r&&i.data&&i.data.code===ae.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),i.toString()),this.presubscribe(e,t,!1);throw i}}async subscribe(e,t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let n={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!b("SUBSCRIBE_TWCC"),rtx:!!b("USE_SUB_RTX"),extend:b("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(b("SVC"))&&b("SVC").length!==0?b("SVC"):void 0};try{return(await this.signal.request(de.SUBSCRIBE,n,!0))._message}catch(i){if(r&&i.data&&i.data.code===ae.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),i.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw i}}async subscribeDataChannel(e,t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let n={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(de.SUBSCRIBE_DATASTREAM,n,!0)}catch(i){if(r&&i.data&&i.data.code===ae.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),i.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw i}}async subscribeAll(e,t){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!b("USE_SUB_RTX"),twcc:!!b("SUBSCRIBE_TWCC"),svc:Array.isArray(b("SVC"))&&b("SVC").length!==0?b("SVC"):void 0};try{return await this.signal.request(de.SUBSCRIBE_STREAMS,r,!0)}catch(n){if(t&&n.data&&n.data.code===ae.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){let t=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let n=r.frameRate,i=r.width,o=r.height,a=!0;return typeof n!="number"&&(n=n.exact||n.ideal||n.max||n.min||0,n||(a=!1)),typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(a=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,n||(a=!1)),a?{stream_type:0,width:i,height:o,fps:n,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(e);if(t)return this.signal.request(de.SET_VIDEO_PROFILE,t);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(de.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(r){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Y.all(e.map(r=>this.signal.request(de.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:t},!0)))}catch(r){v.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(e){try{await this.signal.request(de.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:r,rtpCapabilities:n}=e;return{gatewayEstablishParams:await this.signal.request(de.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:r,rtpCapabilities:n}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(de.GATEWAY_INFO)}async renewToken(e){await this.signal.request(de.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),this.state!=="CONNECTED")return void(this.role=e);let r,n=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,n=1):n=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:n=0,await this.signal.request(de.SET_CLIENT_ROLE,{role:e,level:n,delay:r,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(de.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(de.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(de.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(de.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(de.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,r){if(this.signal instanceof EN)return this.signal.sendExtensionMessage(e,t,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ua({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(de.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=Xg.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e=function(t){let r;return r=t.startsWith("dc")?t.match(/(dc\:\/\/)?([^:]+):(\d+)/):t.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:ir.username,password:ir.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ua(ua({},ir),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let e=await this.signal.request(de.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(t=>{let r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(n=>n.peer_uid===t.peer_uid);r&&r.B_st!==t.B_st&&__(()=>{this.emit(nr.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new M(C.UNEXPECTED_ERROR,"can not generate join message, no join info");let t=Object.assign({},this.joinInfo.apResponse),r=b("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);let n=!(ft()||Tx(87)||Fb())&&typeof b("ENABLE_PRE_SUB")=="boolean"&&b("ENABLE_PRE_SUB"),i=!Fb()&&io("ENABLE_PREALLOC_PC","boolean"),o=ua({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:zn,browser:navigator.userAgent,process_id:b("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:b("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:b("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:b("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof b("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?b("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof b("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?b("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof b("ENABLE_USER_LICENSE_CHECK")=="boolean"?b("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:b("USE_PUB_RTX")===!0||b("USE_SUB_RTX")===!0||void 0,disableFEC:b("DISABLE_FEC"),enableNTPReport:!!b("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!b("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!b("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:io("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!b("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!b("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:io("USE_XR","boolean"),enableLossbasedBwe:io("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!b("ENABLE_AUT_CC")||void 0,enableCCFallback:io("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:i,preSubNum:n?io("PRE_SUB_NUM","number"):void 0,enablePubTWCC:io("PUBLISH_TWCC","boolean"),enableSubTWCC:io("SUBSCRIBE_TWCC","boolean"),enablePubRTX:io("USE_PUB_RTX","boolean"),enableSubRTX:io("USE_SUB_RTX","boolean"),enableSubSVC:b("ENABLE_SVC")?b("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(b("SVC"))&&b("SVC").length!==0?b("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,b("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new M(C.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(he.WS_RECONNECT_WAITTING_FINISH,e=>{var t;q(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&te.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(he.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(he.WS_RECONNECTING,e=>{this.joinInfo&&te.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||sr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",te.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(he.WS_CLOSED,e=>{let t;switch(e){case Ve.LEAVE:t=sr.LEAVE;break;case Ve.UID_BANNED:case Ve.IP_BANNED:case Ve.CHANNEL_BANNED:case Ve.SERVER_ERROR:t=sr.SERVER_ERROR;break;case Ve.FALLBACK:t=sr.FALLBACK;break;case Ve.LICENSE_MISSING:case Ve.LICENSE_EXPIRED:case Ve.LICENSE_MINUTES_EXCEEDED:case Ve.LICENSE_PERIOD_INVALID:case Ve.LICENSE_MULTIPLE_SDK_SERVICE:case Ve.LICENSE_ILLEGAL:case Ve.TOKEN_EXPIRE:t=e;break;default:t=sr.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+sr.NETWORK_ERROR)),this.joinInfo&&te.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Ve.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==Ve.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(he.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),te.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));je("EVENT_REPORT_DOMAIN",e[1]),je("EVENT_REPORT_BACKUP_DOMAIN",e[1]),je("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(ye.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(he.REQUEST_RECOVER,(e,t,r)=>{if(!this.joinInfo)return r(new M(C.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,lr(this,nr.REQUEST_NEW_GATEWAY_LIST).then(t).catch(r)}),this.signal.on(he.REQUEST_JOIN_INFO,async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let{iceParameters:r,dtlsParameters:n,rtpCapabilities:i}=await lr(this,nr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(t=this.joinInfo)===null||t===void 0?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:n,rtpCapabilities:i,version:"2"}}))}),this.signal.on(he.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(he.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let r,n="";var i;e instanceof M?(r=((i=e.data)===null||i===void 0?void 0:i.desc)||e.code,n=e.message):r=e,te.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:n,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(he.IS_P2P_DISCONNECTED,e=>{e(Wd(this,nr.IS_P2P_DISCONNECTED))}),this.signal.on(he.DISCONNECT_P2P,()=>{this.emit(nr.DISCONNECT_P2P)}),this.signal.on(he.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(he.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(he.JOIN_RESPONSE,e=>{let t=this.getCurrentGatewayAddress();this.emit(nr.JOIN_RESPONSE,e,t)}),this.signal.on(he.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let e=this.getCurrentGatewayAddress(),t=b("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){let r=wV(e);this.emit(nr.PRE_CONNECT_PC,{candidates:r,fingerprint:t})}}})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(de.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(de.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(r){throw v.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(de.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(de.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(r){throw v.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(e){let t={users:e.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(de.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(e,t){let r={action:e.find(n=>n.stream_type===Me.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(de.CONTROL,r,!0,!0)}catch(n){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),n),n}}async unmuteLocal(e,t){let r={action:e.find(n=>n.stream_type===Me.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(de.CONTROL,r,!0,!0)}catch(n){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),n),n}}async muteRemote(e,t){let r={action:e===re.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(de.CONTROL,r,!0,!0)}catch(n){throw v.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),n),n}}async unmuteRemote(e,t){let r={action:e===re.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(de.CONTROL,r,!0,!0)}catch(n){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),n),n}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(de.RESTART_ICE,t,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,sr.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!b("GATEWAY_WSS_ADDRESS"))return b("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(v.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(de.SET_PARAMETER,{enablePublishAudioFilter:e})}},Ap=0,Jg=0;function Qi(e,t,r,n){return new Y((i,o)=>{t.timeout=t.timeout||b("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),Ap+=_o(t.data)):r&&(t.data.size?Ap+=t.data.size:t.data instanceof FormData?Ap+=Dx(t.data):Ap+=_o(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,$r.request(t).then(a=>{typeof a.data=="string"?Jg+=_o(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?Jg+=a.data.byteLength:Jg+=_o(JSON.stringify(a.data)),n&&i({data:a.data,headers:a.headers}),i(a.data)}).catch(a=>{$r.isCancel(a)?o(new M(C.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?o(new M(C.NETWORK_TIMEOUT,a.message)):a.response?o(new M(C.NETWORK_RESPONSE_ERROR,a.response.status)):o(new M(C.NETWORK_ERROR,a.message))})})}(function(){var e;function t(U){var D=0;return function(){return D<U.length?{done:!1,value:U[D++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(U,D,W){return U==Array.prototype||U==Object.prototype||(U[D]=W.value),U},n,i=function(U){U=[typeof globalThis=="object"&&globalThis,U,typeof window=="object"&&window,typeof self=="object"&&self,typeof al=="object"&&al];for(var D=0;D<U.length;++D){var W=U[D];if(W&&W.Math==Math)return W}throw Error("Cannot find global object")}(this);function o(U,D){if(D)e:{var W=i;U=U.split(".");for(var L=0;L<U.length-1;L++){var S=U[L];if(!(S in W))break e;W=W[S]}(D=D(L=W[U=U[U.length-1]]))!=L&&D!=null&&r(W,U,{configurable:!0,writable:!0,value:D})}}function a(U){return(U={next:U})[Symbol.iterator]=function(){return this},U}function s(U){var D=typeof Symbol<"u"&&Symbol.iterator&&U[Symbol.iterator];return D?D.call(U):{next:t(U)}}if(o("Symbol",function(U){function D(S,I){this.A=S,r(this,"description",{configurable:!0,writable:!0,value:I})}if(U)return U;D.prototype.toString=function(){return this.A};var W="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",L=0;return function S(I){if(this instanceof S)throw new TypeError("Symbol is not a constructor");return new D(W+(I||"")+"_"+L++,I)}}),o("Symbol.iterator",function(U){if(U)return U;U=Symbol("Symbol.iterator");for(var D="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),W=0;W<D.length;W++){var L=i[D[W]];typeof L=="function"&&typeof L.prototype[U]!="function"&&r(L.prototype,U,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return U}),typeof Object.setPrototypeOf=="function")n=Object.setPrototypeOf;else{var c;e:{var l={};try{l.__proto__={a:!0},c=l.a;break e}catch{}c=!1}n=c?function(U,D){if(U.__proto__=D,U.__proto__!==D)throw new TypeError(U+" is not extensible");return U}:null}var u=n;function d(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(U){if(U.m)throw new TypeError("Generator is already running");U.m=!0}function p(U,D){return U.h=3,{value:D}}function m(U){this.g=new d,this.G=U}function f(U,D,W,L){try{var S=D.call(U.g.j,W);if(!(S instanceof Object))throw new TypeError("Iterator result "+S+" is not an object");if(!S.done)return U.g.m=!1,S;var I=S.value}catch(O){return U.g.j=null,U.g.s(O),_(U)}return U.g.j=null,L.call(U.g,I),_(U)}function _(U){for(;U.g.h;)try{var D=U.G(U.g);if(D)return U.g.m=!1,{value:D.value,done:!1}}catch(W){U.g.v=void 0,U.g.s(W)}if(U.g.m=!1,U.g.l){if(D=U.g.l,U.g.l=null,D.F)throw D.D;return{value:D.return,done:!0}}return{value:void 0,done:!0}}function E(U){this.next=function(D){return U.o(D)},this.throw=function(D){return U.s(D)},this.return=function(D){return function(W,L){h(W.g);var S=W.g.j;return S?f(W,"return"in S?S.return:function(I){return{value:I,done:!0}},L,W.g.return):(W.g.return(L),_(W))}(U,D)},this[Symbol.iterator]=function(){return this}}function g(U,D){return D=new E(new m(D)),u&&U.prototype&&u(D,U.prototype),D}if(d.prototype.o=function(U){this.v=U},d.prototype.s=function(U){this.l={D:U,F:!0},this.h=this.C||this.u},d.prototype.return=function(U){this.l={return:U},this.h=this.u},m.prototype.o=function(U){return h(this.g),this.g.j?f(this,this.g.j.next,U,this.g.o):(this.g.o(U),_(this))},m.prototype.s=function(U){return h(this.g),this.g.j?f(this,this.g.j.throw,U,this.g.o):(this.g.s(U),_(this))},o("Array.prototype.entries",function(U){return U||function(){return function(D,W){D instanceof String&&(D+="");var L=0,S=!1,I={next:function(){if(!S&&L<D.length){var O=L++;return{value:W(O,D[O]),done:!1}}return S=!0,{done:!0,value:void 0}}};return I[Symbol.iterator]=function(){return I},I}(this,function(D,W){return[D,W]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var T=function(U,D){for(var W=0;W<U.length;W++)D(U[W])},R=function(U){return U.replace(/\r?\n|\r/g,`\r
`)},w=function(U,D,W){return D instanceof Blob?(W=W!==void 0?W+"":typeof D.name=="string"?D.name:"blob",D.name===W&&Object.prototype.toString.call(D)!=="[object Blob]"||(D=new File([D],W)),[String(U),D]):[String(U),String(D)]},A=function(U,D){if(U.length<D)throw new TypeError(D+" argument required, but only "+U.length+" present.")},N=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,P=N.FormData,x=N.XMLHttpRequest&&N.XMLHttpRequest.prototype.send,G=N.Request&&N.fetch,ne=N.navigator&&N.navigator.sendBeacon,z=N.Element&&N.Element.prototype,k=N.Symbol&&Symbol.toStringTag;k&&(Blob.prototype[k]||(Blob.prototype[k]="Blob"),"File"in N&&!File.prototype[k]&&(File.prototype[k]="File"));try{new File([],"")}catch{N.File=function(U,D,W){return U=new Blob(U,W||{}),Object.defineProperties(U,{name:{value:D},lastModified:{value:+(W&&W.lastModified!==void 0?new Date(W.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),k&&Object.defineProperty(U,k,{value:"File"}),U}}var F=function(U){return U.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},K=function(U){this.i=[];var D=this;U&&T(U.elements,function(W){if(W.name&&!W.disabled&&W.type!=="submit"&&W.type!=="button"&&!W.matches("form fieldset[disabled] *"))if(W.type==="file"){var L=W.files&&W.files.length?W.files:[new File([],"",{type:"application/octet-stream"})];T(L,function(S){D.append(W.name,S)})}else W.type==="select-multiple"||W.type==="select-one"?T(W.options,function(S){!S.disabled&&S.selected&&D.append(W.name,S.value)}):W.type==="checkbox"||W.type==="radio"?W.checked&&D.append(W.name,W.value):(L=W.type==="textarea"?R(W.value):W.value,D.append(W.name,L))})};if((e=K.prototype).append=function(U,D,W){A(arguments,2),this.i.push(w(U,D,W))},e.delete=function(U){A(arguments,1);var D=[];U=String(U),T(this.i,function(W){W[0]!==U&&D.push(W)}),this.i=D},e.entries=function U(){var D,W=this;return g(U,function(L){if(L.h==1&&(D=0),L.h!=3)return D<W.i.length?L=p(L,W.i[D]):(L.h=0,L=void 0),L;D++,L.h=2})},e.forEach=function(U,D){A(arguments,1);for(var W=s(this),L=W.next();!L.done;L=W.next()){var S=s(L.value);L=S.next().value,S=S.next().value,U.call(D,S,L,this)}},e.get=function(U){A(arguments,1);var D=this.i;U=String(U);for(var W=0;W<D.length;W++)if(D[W][0]===U)return D[W][1];return null},e.getAll=function(U){A(arguments,1);var D=[];return U=String(U),T(this.i,function(W){W[0]===U&&D.push(W[1])}),D},e.has=function(U){A(arguments,1),U=String(U);for(var D=0;D<this.i.length;D++)if(this.i[D][0]===U)return!0;return!1},e.keys=function U(){var D,W,L,S,I=this;return g(U,function(O){if(O.h==1&&(D=s(I),W=D.next()),O.h!=3)return W.done?void(O.h=0):(L=W.value,S=s(L),p(O,S.next().value));W=D.next(),O.h=2})},e.set=function(U,D,W){A(arguments,2),U=String(U);var L=[],S=w(U,D,W),I=!0;T(this.i,function(O){O[0]===U?I&&(I=!L.push(S)):L.push(O)}),I&&L.push(S),this.i=L},e.values=function U(){var D,W,L,S,I=this;return g(U,function(O){if(O.h==1&&(D=s(I),W=D.next()),O.h!=3)return W.done?void(O.h=0):(L=W.value,(S=s(L)).next(),p(O,S.next().value));W=D.next(),O.h=2})},K.prototype._asNative=function(){for(var U=new P,D=s(this),W=D.next();!W.done;W=D.next()){var L=s(W.value);W=L.next().value,L=L.next().value,U.append(W,L)}return U},K.prototype._blob=function(){var U="----formdata-polyfill-"+Math.random(),D=[],W="--"+U+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(L,S){return typeof L=="string"?D.push(W+F(R(S))+`"\r
\r
`+R(L)+`\r
`):D.push(W+F(R(S))+'"; filename="'+F(L.name)+`"\r
Content-Type: `+(L.type||"application/octet-stream")+`\r
\r
`,L,`\r
`)}),D.push("--"+U+"--"),new Blob(D,{type:"multipart/form-data; boundary="+U})},K.prototype[Symbol.iterator]=function(){return this.entries()},K.prototype.toString=function(){return"[object FormData]"},z&&!z.matches&&(z.matches=z.matchesSelector||z.mozMatchesSelector||z.msMatchesSelector||z.oMatchesSelector||z.webkitMatchesSelector||function(U){for(var D=(U=(this.document||this.ownerDocument).querySelectorAll(U)).length;0<=--D&&U.item(D)!==this;);return-1<D}),k&&(K.prototype[k]="FormData"),x){var oe=N.XMLHttpRequest.prototype.setRequestHeader;N.XMLHttpRequest.prototype.setRequestHeader=function(U,D){oe.call(this,U,D),U.toLowerCase()==="content-type"&&(this.B=!0)},N.XMLHttpRequest.prototype.send=function(U){U instanceof K?(U=U._blob(),this.B||this.setRequestHeader("Content-Type",U.type),x.call(this,U)):x.call(this,U)}}G&&(N.fetch=function(U,D){return D&&D.body&&D.body instanceof K&&(D.body=D.body._blob()),G.call(this,U,D)}),ne&&(N.navigator.sendBeacon=function(U,D){return D instanceof K&&(D=D._asNative()),ne.call(this,U,D)}),N.FormData=K}})();var qd=()=>{let e=b("AREAS");return e.length===0&&e.push(ke.GLOBAL),qi(e).call(e,(t,r,n)=>{let i=DV(r);return i?n===0?i:"".concat(t,",").concat(i):t},"")},DV=e=>e===ke.OVERSEA?"".concat(pr.ASIA,",").concat(pr.EUROPE,",").concat(pr.AFRICA,",").concat(pr.NORTH_AMERICA,",").concat(pr.SOUTH_AMERICA,",").concat(pr.OCEANIA):pr[e],KX=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{let n=T_[r],i=Object.keys(n);i&&i.map(o=>{o!=="CODE"&&(t[o]=t[o].concat(n[o]))})}),t},yf={GLOBAL:{ASIA:[ke.CHINA,ke.JAPAN,ke.INDIA,ke.KOREA,ke.HKMC],EUROPE:[],NORTH_AMERICA:[ke.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},bp=Object.keys(yf[ke.GLOBAL]),Qg=[ke.CHINA,ke.NORTH_AMERICA,ke.EUROPE,ke.ASIA,ke.JAPAN,ke.INDIA,ke.OCEANIA,ke.SOUTH_AMERICA,ke.AFRICA,ke.KOREA,ke.HKMC,ke.US],zX=function(e,t){let r=[];if(q(e).call(e,ke.GLOBAL)){let o=[ke.GLOBAL,ke.OVERSEA],a=Object.keys(T_);if(t===ke.GLOBAL)throw new M(C.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===ke.CHINA)r=[ke.OVERSEA];else if(i=t,q(bp).call(bp,i)){let s=(n=t,yf[ke.GLOBAL][n]||[]),c=[...o,t,...s];r=a.filter(l=>!q(c).call(c,l))}else if(function(s){let c=!1;return bp.forEach(l=>{var u;q(u=yf[ke.GLOBAL][l]).call(u,s)&&(c=!0)}),c}(t)){let s=function(l){let u;return bp.forEach(d=>{var h;q(h=yf[ke.GLOBAL][d]).call(h,l)&&(u=d)}),u}(t),c=[...o,s,t];r=a.filter(l=>!q(c).call(c,l))}else r=e;r=function(s){let c=[];return Qg.forEach(l=>{q(s).call(s,l)&&c.push(l)}),c.concat(s.filter(l=>!q(Qg).call(Qg,l)))}(r)}else r=e;var n,i;return r};function RN(e){var t,r;if(!e&&q(t=b("AREAS")).call(t,ke.EXTENSIONS))return v.debug("update area from ap : reset"),void BR(T$,!0);if(!q(r=b("AREAS")).call(r,ke.GLOBAL)||!e)return;let n=T_.EXTENSIONS;n&&(n={CODE:DV(ke.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},v.debug("update area from ap success: ".concat(e,",config is "),n),je("AREAS",[ke.EXTENSIONS],!0),Object.keys(n).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?je(i,n[i][0]):je(i,n[i])}))}function BR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=te.reportApiInvoke(null,{name:Lt.SET_AREA,options:e,tag:pt.TRACER});try{let n=[];if(typeof e=="string"&&(n=[e]),Array.isArray(e)&&(e.forEach(o=>{if(!q(cb).call(cb,o))throw new M(C.INVALID_PARAMS,"invalid area code")}),n=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:o,excludedArea:a}=e;if(!o)throw new M(C.INVALID_PARAMS,"area code is needed");let s=o;typeof o=="string"&&(s=[o]),n=a?zX(s,a):s}if(!t){if(Na.AREAS){let o=new M(C.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(o),void v.warning("setArea is prohibited because of config-distribute")}if(q(n).call(n,ke.GLOBAL)&&b("AREAS")===ke.EXTENSIONS){let o=new M(C.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(o),void v.warning("setArea is prohibited because of ap extensions")}}je("AREAS",n,t);let i=KX(n);Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?je(o,i[o][0]):je(o,i[o])}),v.debug("set area success:",n.join(","))}catch(n){throw r.onError(n),n}r.onSuccess()}function CN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function OT(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CN(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Zg=1;function YX(e,t,r,n,i){Zg+=1;let o={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:Zg,requestId:Zg,version:zn,cname:r.cname},a={service_name:t,json_body:JSON.stringify(o)},s,c,l=e[0];return Ji(async()=>{s=Date.now();let u=await Qi(l,{data:a,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-s,u.code!==0){let p=new M(C.UNEXPECTED_RESPONSE,"live streaming ap error, code"+u.code,{retry:!0,responseTime:c});throw v.error(p.toString()),p}let d=JSON.parse(u.json_body);if(d.code!==200){let p=new M(C.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(d.code,", reason: ").concat(d.reason),{code:d.code,responseTime:c});throw v.error(p.toString()),p}if(!d.servers||d.servers.length===0){let p=new M(C.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:d.code,responseTime:c});throw v.error(p.toString()),p}let h=function(p,m){return{addressList:p.servers.map(f=>"wss://".concat(f.address.replace(/\./g,"-"),".").concat(b("WORKER_DOMAIN"),":").concat(f.wss,"?serviceName=").concat(encodeURIComponent(m))),workerToken:p.workerToken,vid:p.vid}}(d,t);return b("LIVE_STREAMING_ADDRESS")&&(h.addressList=b("LIVE_STREAMING_ADDRESS")instanceof Array?b("LIVE_STREAMING_ADDRESS"):[b("LIVE_STREAMING_ADDRESS")]),OT(OT({},h),{},{responseTime:c})},(u,d)=>(te.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(u.addressList),firstSuccess:d===0,responseTime:c,serverIp:e[d%e.length]}),!1),(u,d)=>(te.apworkerEvent(r.sid,{success:!1,sc:u.data&&u.data.code||200,serviceName:t,responseTime:c,serverIp:e[d%e.length]}),!!(u.code!==C.OPERATION_ABORTED&&u.code!==C.UNEXPECTED_RESPONSE||u.data&&u.data.retry)&&(l=e[(d+1)%e.length],!0)),i)}var ev=1;function IN(e,t,r,n){let{url:i,areaCode:o}=e,{clientId:a,sid:s}=t,c=Date.now(),l,[u,d]=WR(t,o,[It.CHOOSE_SERVER]),h=wt.networkState;return Ji(async()=>{h&&wt.networkState===un.OFFLINE&&wt.onlineWaiter&&await Y.race([wt.onlineWaiter,er(n&&n.maxRetryTimeout||Pt.maxRetryTimeout)]),h=wt.networkState;let{data:p,headers:m}=await Qi(i,{data:u,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=m.http3==="1"?1:-1,te.reportResourceTiming(i,s),kV(p,i,t,c,[It.CHOOSE_SERVER],l);let f=Yd(p,It.CHOOSE_SERVER);return GR(f),NR(f,i)},p=>(p&&te.joinChooseServer(s,{lts:c,succ:!0,csAddr:i,opid:d,serverList:p.gatewayAddrs.map(m=>m.address),ec:null,cid:p.cid.toString(),uid:p.uid.toString(),csIp:p.csIp,unilbsServerIds:[It.CHOOSE_SERVER].toString(),isHttp3:l}),!1),p=>p.code!==C.OPERATION_ABORTED&&(p.code===C.CAN_NOT_GET_GATEWAY_SERVER?p.data.retry:(te.joinChooseServer(s,{lts:c,succ:!1,csAddr:i,serverList:null,opid:d,ec:p.code,csIp:p.data&&p.data.csIp,unilbsServerIds:[It.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:l}),v.warning("[".concat(a||"sid-".concat(s.slice(0,6)),"] Choose server network error, retry"),p),!0)),n)}function wN(e,t,r,n){let i,{url:o,areaCode:a,serviceIds:s}=e,c=Date.now(),[l,u]=WR(t,a,s),d;return Ji(async()=>{d&&wt.networkState===un.OFFLINE&&wt.onlineWaiter&&await Y.race([wt.onlineWaiter,er(n&&n.maxRetryTimeout||Pt.maxRetryTimeout)]),d=wt.networkState;let{data:h,headers:p}=await Qi(o,{data:l,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=p.http3==="1"?1:-1,te.reportResourceTiming(o,t.sid),kV(h,o,t,c,s,i);let m=Yd(h,It.CHOOSE_SERVER),f=Yd(h,t.cloudProxyServer==="proxy5"?It.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?It.CLOUD_PROXY:It.CLOUD_PROXY_FALLBACK);return GR(m),{gatewayInfo:NR(m,o),proxyInfo:f,url:o}},h=>(h.gatewayInfo&&te.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,serverList:h.gatewayInfo.gatewayAddrs.map(p=>p.address),ec:null,opid:u,cid:h.gatewayInfo.cid.toString(),uid:h.gatewayInfo.uid.toString(),csIp:h.gatewayInfo.csIp,unilbsServerIds:s.toString(),isHttp3:i}),h.proxyInfo&&te.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:h.proxyInfo.addresses.map(p=>p.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:s.toString()}),!1),h=>h.code!==C.OPERATION_ABORTED&&(h.code===C.CAN_NOT_GET_GATEWAY_SERVER?h.data.retry:(te.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:h.code,eventType:t.cloudProxyServer,unilbsServerIds:s.toString(),extend:JSON.stringify({networkState:d})}),v.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),h),!0)),n)}var kV=(e,t,r,n,i,o)=>{let{sid:a,clientId:s,cloudProxyServer:c}=r,l=[],u=d=>{d.flag===4096?te.joinChooseServer(a,{lts:n,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:d.error.message,csIp:d.error.data&&d.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o}):d.flag!==1048576&&d.flag!==4194304&&d.flag!==4194310||te.joinWebProxyAP(a,{lts:n,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:d.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach(d=>{let h=d.buffer.code;if(d.uri===23&&h===0&&!d.buffer.edges_services)if(d.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),d.buffer.edges_services=[];else{let p={error:new M(C.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:d.buffer.flag};l.push(p),u(p)}if(h!==0){let p=bl(h),m={error:new M(C.CAN_NOT_GET_GATEWAY_SERVER,p.desc,{desc:p.desc,retry:p.retry,csIp:e.detail[502]}),flag:d.buffer.flag};d.buffer.flag===4194310?v.warning(m.error.toString()):l.push(m),u(m)}}),l.length)throw v.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map(d=>"flag: ".concat(d.flag,", message: ").concat(d.error.message,", retry: ").concat(d.error.data.retry)).join(" | "))),new M(C.CAN_NOT_GET_GATEWAY_SERVER,l.map(d=>"flag: ".concat(d.flag,", message: ").concat(d.error.message)).join(" | "),{retry:!!l.find(d=>d.error.data.retry),csIp:e.detail[502],desc:[...new Set(l.map(d=>{var h;return d==null||(h=d.error)===null||h===void 0||(h=h.data)===null||h===void 0?void 0:h.desc}).filter(d=>!!d))]})},GR=e=>{var t,r,n,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new M(C.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(b("AP_AREA")&&((n=e.detail)!==null&&n!==void 0&&n[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?RN(e.detail[23].toLowerCase()):RN()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){let a=e.detail[19],s=a==null?void 0:a.split(";");for(let c=0;c<s.length;c++){var o;let l=Ar(o=s[c]).call(o);e.addresses[c]&&s&&(e.addresses[c].fingerprint=l)}}if(b("GATEWAY_ADDRESS")&&b("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",b("GATEWAY_ADDRESS"));let a=b("GATEWAY_ADDRESS").map(s=>{var c,l;let u=(c=(l=e.addresses.find(d=>d.ip===s.ip&&d.port===s.port))===null||l===void 0?void 0:l.fingerprint)!==null&&c!==void 0?c:"";return{ip:s.ip,port:s.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:u}});e.addresses=a}},$X=(e,t)=>{if(e.response_body&&e.response_body.length){let r=e.response_body[0];if(r.buffer.code!==0){let n=bl(r.buffer.code);throw new M(C.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(n.desc),{retry:n.retry})}return r.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",t),new M(C.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},WR=(e,t,r)=>{let n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:OT({6:e.stringUid,11:t,12:b("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};i.request_bodies.forEach(a=>{e.multiIP&&e.multiIP.gateway_ip&&(a.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let o=new FormData;return o.append("request",JSON.stringify(i)),[o,n]},qX=(e,t)=>{let r=Math.floor(Math.random()*1e12),n={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(n)),[i,r]},pl=0;function ql(e){return Y.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}var Xd=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:n,allFailedhandler:i,promisesCollector:o}=e,a=0,s=t,c,l=0,u=async()=>{let d=(()=>{let h=a*s,p=h+s;return r.slice(h,p).map(n)})();o&&o.push(...d);try{c=await ql(d)}catch(h){if(l+=s,a++,!(l>=r.length))return void await u();i(h)}d.forEach(h=>h.cancel())};return await u(),c},LV=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:n}=e,i=t.length,o=0,a=async()=>{let s=r(t.shift());try{return await s}catch(c){if(o++,o>=i||n!=null&&n(c))throw c;return a()}};return a()};async function NT(e,t,r,n){return{gatewayInfo:await async function(i,o,a,s){let c=null,l=[],u=async()=>{let h=b("WEBCS_DOMAIN").slice(0,b("AJAX_REQUEST_CONCURRENT")).map(f=>({url:i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(f+"/api/v2/transpond/webrtc?v=2"):"https://".concat(f,"/api/v2/transpond/webrtc?v=2"),areaCode:qd()})),p=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:h.map(f=>f.url)}),m=await Xd({fragementLength:b("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:f=>(v.debug("[".concat(i.clientId,"] Connect to choose_server:"),f.url),IN(f,i,o,a)),allFailedhandler:f=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:f},p),f[0]},promisesCollector:l});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},p),m},d=async()=>{if(await er(1e3),c!==null)return c;let h=b("WEBCS_DOMAIN_BACKUP_LIST").map(f=>({url:i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(f+"/api/v2/transpond/webrtc?v=2"):"https://".concat(f,"/api/v2/transpond/webrtc?v=2"),areaCode:qd()})),p=s.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:h.map(f=>f.url)}),m=await Xd({fragementLength:b("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:f=>(v.debug("[".concat(i.clientId,"] Connect to backup choose_server:"),f.url),IN(f,i,o,a)),allFailedhandler:f=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:f},p),f[0]},promisesCollector:l});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},p),m};try{return c=await ql([u(),d()]),l.length&&l.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),c}catch(h){throw h[0]}}(e,t,r,n)}}async function AN(e,t,r,n,i){let o=e.cloudProxyServer;if(o==="disabled"){if(e.useLocalAccessPoint)return await NT(e,t,r,i);if(b("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:h,proxyInfo:p}=await ON(e,t,r,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:h};let m=p.map(f=>({turnServerURL:f.address,tcpport:f.tcpport||ir.tcpport,udpport:f.udpport||ir.udpport,username:f.username||ir.username,password:f.password||ir.password,forceturn:!1,security:!0}));if(i.useP2P){var a;let f=(a=e.uid)!==null&&a!==void 0?a:h.uid,_="glb:".concat(f.toString()),E=await pT(_),g=p.map(T=>({turnServerURL:T.address,tcpport:T.tcpport||ir.tcpport,udpport:T.udpport||ir.udpport,username:_,password:E,forceturn:!1,security:!0}));m.push(...g)}return e.turnServer={mode:"manual",servers:m},{gatewayInfo:h}}return await NT(e,t,r,i)}let{proxyInfo:s,gatewayInfo:c}=await ON(e,t,r,i),l={gatewayInfo:c},u=s.map(h=>({turnServerURL:h.address,tcpport:o==="proxy3"?void 0:h.tcpport?h.tcpport:ir.tcpport,udpport:o==="proxy4"?void 0:h.udpport?h.udpport:ir.udpport,username:h.username||ir.username,password:h.password||ir.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(i.useP2P){var d;let h=(d=e.uid)!==null&&d!==void 0?d:c.uid,p="glb:".concat(h.toString()),m=await pT(p),f=s.map(_=>({turnServerURL:_.address,tcpport:o==="proxy3"?void 0:_.tcpport||ir.tcpport,udpport:o==="proxy4"?void 0:_.udpport||ir.udpport,username:p,password:m,forceturn:o!=="proxy4",security:o==="proxy5"}));u.push(...f)}return e.turnServer={mode:"manual",servers:u},v.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),l}async function MV(e,t,r,n,i){let o=b("ACCOUNT_REGISTER").slice(0,b("AJAX_REQUEST_CONCURRENT")),a=[];a=t.proxyServer?o.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):o.map(c=>"https://".concat(c,"/api/v1"));let s=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{let c=await async function(l,u,d,h,p){let m=Date.now(),f={sid:d.sid,opid:10,appid:d.appId,string_uid:u},_=l[0],E=await Ji(()=>Qi(_+"".concat(_.indexOf("?")===-1?"?":"&","action=stringuid"),{data:f,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(g,T)=>{if(g.code===0){if(g.uid<=0||g.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(u," => ").concat(g.uid),g),te.reqUserAccount(f.sid,{lts:m,success:!1,serverAddr:_,stringUid:f.string_uid,uid:g.uid,errorCode:C.INVALID_UINT_UID_FROM_STRING_UID,extend:f}),new M(C.INVALID_UINT_UID_FROM_STRING_UID);return te.reqUserAccount(f.sid,{lts:m,success:!0,serverAddr:_,stringUid:f.string_uid,uid:g.uid,errorCode:null,extend:f}),!1}let R=bl(g.code);return R.retry&&(_=l[(T+1)%l.length]),te.reqUserAccount(f.sid,{lts:m,success:!1,serverAddr:_,stringUid:f.string_uid,uid:g.uid,errorCode:R.desc,extend:f}),R.retry},(g,T)=>g.code!==C.OPERATION_ABORTED&&(te.reqUserAccount(f.sid,{lts:m,success:!1,serverAddr:_,stringUid:f.string_uid,uid:null,errorCode:g.code,extend:f}),_=l[(T+1)%l.length],!0),p);if(E.code!==0){let g=bl(E.code);throw new M(C.UNEXPECTED_RESPONSE,g.desc)}return E}(a,e,t,r,n);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},s),c.uid}catch(c){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c]},s),c}}async function XX(e,t,r){let n=b("ACCOUNT_REGISTER"),i=[];i=t.proxyServer?n.map(o=>"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1")):n.map(o=>"https://".concat(o,"/api/v1"));try{return await LV({referenceList:i,asyncMapHandler:o=>async function(a,s,c,l){let u=Date.now(),d={sid:c.sid,opid:10,appid:c.appId,string_uid:s};try{let h=await Qi(a+"".concat(a.indexOf("?")===-1?"?":"&","action=stringuid"),{data:d,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(h.code!==0){let p=bl(h.code);throw new M(C.UNEXPECTED_RESPONSE,"preload sua error:".concat(p.desc),p)}if(h.uid<=0||h.uid>=Math.pow(2,32))throw new M(C.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:u,url:a,req:d,uid:h.uid,elapse:Date.now()-u}}catch(h){throw h}}(o,e,t,r),closeFn:o=>o.code===C.OPERATION_ABORTED||o.code===C.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(o){throw o}}async function JX(e,t,r){let n=b("CDS_AP").slice(0,b("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1"):"https://".concat(c,"/api/v1?action=config")),i=n.map(c=>function(l,u,d,h){let p=Ne(),m={flag:64,cipher_method:0,features:{device:p.name,system:p.os,system_general:navigator.userAgent,vendor:u.appId,version:zn,cname:u.cname,sid:u.sid,session_id:u.sid,detail:"",proxyServer:u.proxyServer}};return Ji(()=>Qi(l,{data:m,timeout:1e3,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,f=>f.code!==C.OPERATION_ABORTED,h)}(c,e,t,r)),o=null,a=null,s={};try{o=await ql(i)}catch(c){if(c.code===C.OPERATION_ABORTED)throw c;a=c}if(i.forEach(c=>c.cancel()),te.reportApiInvoke(e.sid,{name:Lt.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{s=function(c){if(!c.test_tags)return{};let l=c.test_tags,u=Object.keys(l),d={};return u.forEach(h=>{var p;let m=Ar(p=h.slice(4)).call(p),f=JSON.parse(l[h])[1];d[m]=f}),d}(o)}catch{}return s}async function bN(e,t){let r=b("WEBCS_DOMAIN").concat(b("WEBCS_DOMAIN_BACKUP_LIST")).map(n=>({url:"https://".concat(n,"/api/v2/transpond/webrtc?v=2"),areaCode:qd(),serviceIds:[It.CHOOSE_SERVER,It.CLOUD_PROXY_FALLBACK]}));try{return await LV({referenceList:r,asyncMapHandler:n=>async function(i,o,a){let s,{url:c,areaCode:l,serviceIds:u}=i,d=Date.now(),[h,p]=WR(o,l,u),m=wt.networkState;try{m&&wt.networkState===un.OFFLINE&&wt.onlineWaiter&&await Y.race([wt.onlineWaiter,er(Pt.maxRetryTimeout)]),m=wt.networkState;let{data:f,headers:_}=await Qi(c,{data:h,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=_.http3==="1"?1:-1,(T=>{let R=[];if(T.response_body.forEach(w=>{let A=w.buffer.code;if(w.uri===23&&A===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)w.buffer.edges_services=[];else{let N={error:new M(C.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:T.detail[502]}),flag:w.buffer.flag};R.push(N)}if(A!==0){let N=bl(A),P={error:new M(C.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:T.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?v.warning(P.error.toString()):R.push(P)}}),R.length)throw new M(C.CAN_NOT_GET_GATEWAY_SERVER,R.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!R.find(w=>w.error.data.retry),csIp:T.detail[502],desc:[...new Set(R.map(w=>{var A;return w==null||(A=w.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc}).filter(w=>!!w))]})})(f);let E=Yd(f,It.CHOOSE_SERVER),g=Yd(f,It.CLOUD_PROXY_FALLBACK);return GR(E),{gatewayInfo:NR(E,c),proxyInfo:g,opid:p,requestTime:d,url:c,isHttp3:s,elapse:Date.now()-d}}catch(f){throw f}}(n,e,t),closeFn:n=>n.code===C.OPERATION_ABORTED||n.code===C.CAN_NOT_GET_GATEWAY_SERVER&&!n.data.retry})}catch(n){throw n}}async function ON(e,t,r,n){let i=b("PROXY_SERVER_TYPE3"),o=(p,m,f)=>{let _=f||i;return Array.isArray(_)&&(_=m%2==0?i[1]:i[0]),"https://".concat(_,"/ap/?url=").concat(p)},a=null,s=[],c=async()=>{let p=b("WEBCS_DOMAIN").slice(0,b("AJAX_REQUEST_CONCURRENT")).map((_,E)=>{let g;return g=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(_,"/api/v2/transpond/webrtc?v=2"),E,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(_,"/api/v2/transpond/webrtc?v=2"):o("".concat(_,"/api/v2/transpond/webrtc?v=2"),E),{url:g,areaCode:qd(),serviceIds:[It.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?It.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?It.CLOUD_PROXY:It.CLOUD_PROXY_FALLBACK]}}),m=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(_=>_.url)}),f=await Xd({fragementLength:b("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:_=>(v.debug("[".concat(e.clientId,"] Connect to choose_server:"),_.url),wN(_,e,t,r)),allFailedhandler:_=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_},m),_[0]},promisesCollector:s});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},m),f},l=async()=>{if(await er(1e3),a!==null)return a;let p=b("WEBCS_DOMAIN_BACKUP_LIST").map((_,E)=>{let g;return g=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(_,"/api/v2/transpond/webrtc?v=2"),E,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(_,"/api/v2/transpond/webrtc?v=2"):o("".concat(_,"/api/v2/transpond/webrtc?v=2"),E),{url:g,areaCode:qd(),serviceIds:[It.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?It.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?It.CLOUD_PROXY:It.CLOUD_PROXY_FALLBACK]}}),m=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(_=>_.url)}),f=await Xd({fragementLength:b("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:_=>(v.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),_.url),wN(_,e,t,r)),allFailedhandler:_=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_},m),_[0]},promisesCollector:s});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},m),f},u,d,h;try{({gatewayInfo:u,proxyInfo:d,url:h}=await ql([c(),l()]))}catch(p){throw p[0]}if(s.length&&s.forEach(p=>p.cancel&&typeof p.cancel=="function"&&p.cancel()),!u||!d)throw new M(C.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&h){let p=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];q(i).call(i,p)&&(e.proxyServer=p,v.setProxyServer(p),te.setProxyServer(p))}return a={gatewayInfo:u,proxyInfo:await Hx(d,u.uid)},a}async function QX(e,t,r){let n=b("UAP_AP").slice(0,b("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),i=n.map(o=>function(a,s,c,l){let u={command:"convergeAllocateEdge",sid:s.sid,appId:s.appId,token:s.token,ts:Date.now(),version:zn,cname:s.cname,uid:s.uid.toString(),requestId:ev,seq:ev};ev+=1;let d={service_name:"tele_channel",json_body:JSON.stringify(u)};return Ji(async()=>{let h=await Qi(a,{data:d,cancelToken:c,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(h.code!==0){let m=new M(C.UNEXPECTED_RESPONSE,"cross channel ap error, code"+h.code,{retry:!0});throw v.error(m.toString()),m}let p=JSON.parse(h.json_body);if(p.code!==200){let m=new M(C.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(p.code,", reason: ").concat(p.reason));throw v.error(m.toString()),m}if(!p.servers||p.servers.length===0){let m=new M(C.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(m.toString()),m}return{vid:p.vid,workerToken:p.workerToken,addressList:(b("CHANNEL_MEDIA_RELAY_SERVERS")||p.servers).map(m=>"wss://".concat(m.address.replace(/\./g,"-"),".").concat(b("WORKER_DOMAIN"),":").concat(m.wss))}},void 0,h=>!!(h.code!==C.OPERATION_ABORTED&&h.code!==C.UNEXPECTED_RESPONSE||h.data&&h.data.retry),l)}(o,e,t,r));try{let o=await ql(i);return i.forEach(a=>a.cancel()),o}catch(o){throw o[0]}}async function ZX(e,t,r){let n=null,i=[],o=async a=>{let s=b(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v2/transpond/webrtc?v=2"):"https://".concat(c,"/api/v2/transpond/webrtc?v=2"));return a&&(await er(1e3),n!==null)?n:await Xd({fragementLength:b("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:c=>(v.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),c),function(l,u,d,h){let[p]=qX(u,[It.CHOOSE_SERVER]),m=wt.networkState;return Ji(async()=>{m&&wt.networkState===un.OFFLINE&&wt.onlineWaiter&&await Y.race([wt.onlineWaiter,er(h&&h.maxRetryTimeout||Pt.maxRetryTimeout)]),m=wt.networkState;let f=await Qi(l,{data:p,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0);return $X(f,l)},()=>!1,f=>f.code!==C.OPERATION_ABORTED&&(f.code===C.UPDATE_TICKET_FAILED?f.data.retry:(v.warning("[".concat(u.clientId,"] update ticket network error, retry"),f),!0)),h)}(c,e,t,r)),allFailedhandler:c=>{throw c[0]},promisesCollector:i})};try{return n=await ql([o(!1),o(!0)]),i.length&&i.forEach(a=>a.cancel&&typeof a.cancel=="function"&&a.cancel()),n}catch(a){throw a[0]}}function NN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function PN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NN(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var eJ=class extends lt{get isSuccess(){return!!this.configs}constructor(){super(),y(this,"configs",void 0),y(this,"joinInfo",void 0),y(this,"cancelToken",void 0),y(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),y(this,"interval",void 0),y(this,"mutex",new _r("config-distribute")),y(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),b("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},b("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,te.reportApiInvoke(null,{options:void 0,name:Lt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:pt.TRACER}).onSuccess(JSON.stringify(Na))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let e,t=await this.mutex.lock();try{e=await JX(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(r){let n=new M(C.NETWORK_RESPONSE_ERROR,r);v.warning("[config-distribute] ".concat(n.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(gT.UPDATE_BITRATE_LIMIT,e):this.emit(gT.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&PN({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;let r=Sh(t=Object.keys(e).filter(i=>/^webrtc_ng_global_parameter/.test(i))).call(t);for(let i=0;i<r.length;i++)for(let o=r.length-1;o>i;o--){let a=r[o];if(typeof e[a].__priority=="number"){let s=e[a].__priority,c=r[o-1];if(typeof e[c].__priority=="number"){if(!(s>e[c].__priority))continue;{let l=a;r[o]=r[o-1],r[o-1]=l}}else{let l=a;r[o]=r[o-1],r[o-1]=l}}}let n={};r.forEach(i=>{let o=e[i],a=o.__expires;Object.keys(o).forEach(s=>{s==="__priority"||s==="__expires"||Object.prototype.hasOwnProperty.call(n,s)||(n[s]=PN({value:o[s]},a&&{expires:a}))})});try{(function(a){try{let s=Date.now();Object.keys(a).forEach(c=>{switch(c){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(vt,c)){let{value:l,expires:u}=a[c];if(u&&u<=s)return;Na[c]=l,vt[c]=l,v.debug("Update global parameters from config distribute",c,l)}}})}catch(s){v.error("Error update config immediately: ".concat(a),s.message)}})(n);let i=JSON.stringify(n),o=window.btoa(i);window.localStorage.setItem("websdk_ng_global_parameter",o),v.debug("Caching global parameters ".concat(i))}catch(i){v.error("Error caching global parameters:",i.message)}}},tJ=class extends lt{constructor(){super(...arguments),y(this,"resultStorage",new Map)}setLocalAudioStats(e,t,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(r,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(r,t))}setLocalVideoStats(e,t,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(r,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(r,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(r))}setRemoteAudioStats(e,t){let r=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let r=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(t))}record(e,t,r){if(b("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let n=this.resultStorage.get(e);if(n&&(n.result.push(r),n.result.length>=5)){var i;let o=q(i=n.result).call(i,!0);n.isPrevNormal&&!o&&this.emit("exception",DN[e],e,t),!n.isPrevNormal&&o&&this.emit("exception",DN[e]+2e3,e+"_RECOVER",t),n.isPrevNormal=o,n.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,t){return t instanceof Bt&&!t.isActive||!!t.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,t){let r=null;t._encoderConfig&&t._encoderConfig.frameRate&&(r=hn(t._encoderConfig.frameRate));let n=e.captureFrameRate;return!r||!n||!(r>10&&n<5||r<10&&r>=5&&n<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,t){return t instanceof Bt&&!t.isActive||!!t.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}},DN={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},fr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){let n=r[r.length-1];return Math.round(performance.now()-n.startTime)}return 0}measureFromPublishStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){let n=r[r.length-1];return Math.round(performance.now()-n.startTime)}return 0}};function HR(e,t){this.v=e,this.k=t}function De(e){return new HR(e,0)}var rJ=V2,nJ=bo;ze({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=nJ.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var iJ=bo,oJ=Hl;ze({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=iJ.f(this),r=oJ(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var PT=Tt(rJ),UV=Kl.f("asyncIterator"),aJ=Tt(UV);function Fu(e){var t,r;function n(o,a){try{var s=e[o](a),c=s.value,l=c instanceof HR;PT.resolve(l?c.v:c).then(function(u){if(l){var d=o==="return"?"return":"next";if(!c.k||u.done)return n(d,u);u=e[d](u).value}i(s.done?"return":"normal",u)},function(u){n("throw",u)})}catch(u){i("throw",u)}}function i(o,a){switch(o){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(o,a){return new PT(function(s,c){var l={key:o,arg:a,resolve:s,reject:c,next:null};r?r=r.next=l:(t=r=l,n(o,a))})},typeof e.return!="function"&&(this.return=void 0)}function Ki(e){return function(){return new Fu(e.apply(this,arguments))}}Fu.prototype[typeof zc=="function"&&aJ||"@@asyncIterator"]=function(){return this},Fu.prototype.next=function(e){return this._invoke("next",e)},Fu.prototype.throw=function(e){return this._invoke("throw",e)},Fu.prototype.return=function(e){return this._invoke("return",e)};var kN=Tt(Xi.Object.getOwnPropertySymbols),sJ=ze,cJ=Wy.indexOf,lJ=Zm,DT=Md([].indexOf),LN=!!DT&&1/DT([1],1,-0)<0;sJ({target:"Array",proto:!0,forced:LN||!lJ("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return LN?DT(this,e,t)||0:cJ(this,e,t)}});var uJ=Ai("Array").indexOf,dJ=Br,hJ=uJ,tv=Array.prototype,pJ=function(e){var t=e.indexOf;return e===tv||dJ(tv,e)&&t===tv.indexOf?hJ:t},MN=Tt(pJ);function fJ(e,t){if(e==null)return{};var r,n,i=function(a,s){if(a==null)return{};var c,l,u={},d=Vx(a);for(l=0;l<d.length;l++)c=d[l],MN(s).call(s,c)>=0||(u[c]=a[c]);return u}(e,t);if(kN){var o=kN(e);for(n=0;n<o.length;n++)r=o[n],MN(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _i(e){if(Array.isArray(e))return e.map(r=>r);if(!UN(e))return e;let t={};for(let r in e){let n=e[r];UN(n)||Array.isArray(n)?t[r]=_i(n):t[r]=n}return t}function UN(e){return!(typeof e!="object"||Array.isArray(e)||!e)}var rv=class{constructor(e){y(this,"input",[]),y(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},Co={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Jd={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Co,remoteCandidate:Co}},xV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},VV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},FV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},jV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function xN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function VN(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xN(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var KR=class{constructor(e,t){y(this,"onFirstVideoReceived",void 0),y(this,"onFirstVideoDecoded",void 0),y(this,"onFirstAudioReceived",void 0),y(this,"onFirstVideoDecodedTimeout",void 0),y(this,"onFirstAudioDecoded",void 0),y(this,"onSelectedLocalCandidateChanged",void 0),y(this,"onSelectedRemoteCandidateChanged",void 0),y(this,"videoIsReady",!1),y(this,"videoIsReady2",{}),y(this,"pc",void 0),y(this,"options",void 0),y(this,"intervalTimer",void 0),y(this,"stats",_i(Jd)),y(this,"isFirstVideoReceived",{}),y(this,"isFirstVideoDecoded",{}),y(this,"isFirstAudioReceived",{}),y(this,"isFirstAudioDecoded",{}),y(this,"isFirstVideoDecodedTimeout",{}),y(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Y(e=>{e({local:VN({},Co),remote:VN({},Co)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"],n=0,i=0,o=0,a=0;for(let s of r)e[s].forEach((c,l)=>{if(!this.lossRateWindowStats[t-1][s][l]||!this.lossRateWindowStats[0][s][l])return;let u=this.lossRateWindowStats[t-1][s][l].packets-this.lossRateWindowStats[0][s][l].packets,d=this.lossRateWindowStats[t-1][s][l].packetsLost-this.lossRateWindowStats[0][s][l].packetsLost;s==="videoSend"||s==="audioSend"?(n+=u,o+=d):(i+=u,a+=d),Number.isNaN(u)||Number.isNaN(u)?c.packetLostRate=0:c.packetLostRate=u<=0||d<=0?0:d/(u+d)});e.sendPacketLossRate=n<=0||o<=0?0:o/(n+o),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}};function FN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function mJ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FN(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var _J=class extends KR{constructor(){super(...arguments),y(this,"_stats",Jd),y(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=_i(Jd);let r=t.filter(i=>i.type==="ssrc");this.processSSRCStats(r);let n=t.find(i=>i.type==="VideoBwe");n&&this.processBandwidthStats(n),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;let n=q(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(n?"send":"recv")){case"video_send":{let i=_i(VV);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{let i=_i(xV),o=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),o){let a=o.stats,s=Date.now()-o.lts;i.framesDecodeFreezeTime=a.framesDecodeFreezeTime,i.framesDecodeInterval=a.framesDecodeInterval,i.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(o.lts=Date.now(),i.framesDecodeInterval=s,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<o.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:mJ({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{let i=_i(jV);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{let i=_i(FV);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new Y((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(r=>{let n={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(i=>{n[i]=r.stat(i)}),t.push(n)}),t}};function jN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ds(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jN(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var BN=class extends KR{constructor(){super(...arguments),y(this,"_stats",Jd),y(this,"report",void 0),y(this,"lastDecodeVideoReceiverStats",new Map),y(this,"lastVideoFramesRecv",new Map),y(this,"lastVideoFramesSent",new Map),y(this,"lastVideoFramesDecode",new Map),y(this,"lastVideoFramesOutput",new Map),y(this,"lastVideoJBDelay",new Map),y(this,"lastAudioJBDelay",new Map),y(this,"mediaBytesSent",new Map),y(this,"mediaBytesRetransmit",new Map),y(this,"mediaBytesTargetEncode",new Map),y(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=_i(Jd),this.report.forEach(e=>{switch(e.type){case En.OUTBOUND:case En.INBOUND:{let t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,n=!t&&!("frameWidth"in e);e.type===En.OUTBOUND?t==="audio"||n?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===En.INBOUND&&(t==="audio"||n?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case En.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case En.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:ds({},Co),remote:ds({},Co)};return e.forEach(r=>{let n;if(r.type===En.TRANSPORT&&(n=e.get(r.selectedCandidatePairId)),r.type===En.CANDIDATE_PAIR&&r.selected&&(n=r),n){let i=(o,a)=>{o.type=a.type,o.id=a.id,a.address&&(o.address=a.address),a.candidateType&&(o.candidateType=a.candidateType),a.port&&(o.port=a.port),a.priority&&(o.priority=a.priority),a.protocol&&(o.protocol=a.protocol),a.relayProtocol&&(o.relayProtocol=a.relayProtocol)};if(n.localCandidateId){let o=e.get(n.localCandidateId);o&&i(t.local,o)}if(n.remoteCandidateId){let o=e.get(n.remoteCandidateId);o&&i(t.remote,o)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===En.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===En.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===En.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ds({},t),ds({},this.stats.selectedCandidatePair.localCandidate)),e.type===En.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ds({},t),ds({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=_i(jV),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find(a=>a.ssrc===e.ssrc);t||(t=_i(xV),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration;let r=this.lastDecodeVideoReceiverStats.get(t.ssrc),n=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let a=t.decodedFrame?t.decodedFrame.width:0,s=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,a,s),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){let a=r.stats,s=o-r.lts;t.framesDecodeFreezeTime=a.framesDecodeFreezeTime,t.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&s>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=s,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<a.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}n&&o-n.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-n.count)/((o-n.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):n?t.decodeFrameRate=n.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&o-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ds({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(n=>n.ssrc===e.ssrc);t||(t=_i(VV),this._stats.videoSend.push(t));let r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{let n=new rv(10);n.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,n)}if(e.retransmittedBytesSent!==void 0){let n=this.mediaBytesRetransmit.get(e.ssrc);if(n)n.add(e.retransmittedBytesSent);else{let i=new rv(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){let n=this.mediaBytesTargetEncode.get(e.ssrc);if(n)n.add(e.totalEncodedBytesTarget);else{let i=new rv(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){let n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let i=e.framesEncoded-n.lastFrameCount,o=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*o/i}}if(e.framesEncoded&&e.qpSum){let n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,En.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=_i(FV),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,En.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;let n=Array.from(Jo(r=this.report).call(r)).find(i=>i.type===t&&i.ssrc===e);return n?n.id:null}processVideoMediaSource(e,t){let r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){let r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var n,i,o,a;let s=t?this.report.get(t):void 0,c=(n=s==null?void 0:s.framesSent)!==null&&n!==void 0?n:e.framesSent;if(typeof c!="number")return;let l=(i=s==null?void 0:s.frameWidth)!==null&&i!==void 0?i:e.frameWidth,u=(o=s==null?void 0:s.frameHeight)!==null&&o!==void 0?o:e.frameHeight,d=(a=s==null?void 0:s.framesPerSecond)!==null&&a!==void 0?a:e.framesPerSecond;if(typeof l=="number"&&typeof u=="number"||(l=0,u=0),d==null){let h=Date.now(),p=this.lastVideoFramesSent.get(r.ssrc);p&&h-p.lts>=800?(d=Math.round((c-p.count)/((h-p.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:h,rate:d})):p?d=p.rate:this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:h,rate:0})}r.sentFrame={width:l,height:u,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(e,t,r){var n,i,o,a,s;let c=t?this.report.get(t):void 0,l=(n=c==null?void 0:c.framesReceived)!==null&&n!==void 0?n:e.framesReceived,u=(i=c==null?void 0:c.frameWidth)!==null&&i!==void 0?i:e.frameWidth,d=(o=c==null?void 0:c.frameHeight)!==null&&o!==void 0?o:e.frameHeight,h=(a=c==null?void 0:c.jitterBufferDelay)!==null&&a!==void 0?a:e.jitterBufferDelay,p=(s=c==null?void 0:c.jitterBufferEmittedCount)!==null&&s!==void 0?s:e.jitterBufferEmittedCount;if(typeof l=="number"){let m=this.lastVideoFramesRecv.get(r.ssrc),f=Date.now();r.framesReceivedCount=l;let _=0;m&&f-m.lts>=800?(_=Math.round((l-m.count)/((f-m.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:l,lts:f,rate:_})):m?_=m.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:l,lts:f,rate:0}),r.receivedFrame={width:u||0,height:d||0,frameRate:_||0},r.decodedFrame={width:u||0,height:d||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:u||0,height:d||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(h&&p){let m=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},f=m.jitterBufferMs,_=p-m.jitterBufferEmittedCount;_>0&&(f=1e3*(h-m.jitterBufferDelay)/_),r.jitterBufferMs=f,r.currentDelayMs=Math.round(f),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var n,i,o,a;let s=t?this.report.get(t):void 0,c=(n=(i=s==null?void 0:s.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&n!==void 0?n:0,l=(o=(a=s==null?void 0:s.echoReturnLossEnhancement)!==null&&a!==void 0?a:e.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;r.aecReturnLoss=c,r.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,r){var n,i,o,a,s,c,l;let u=t?this.report.get(t):void 0,d=(n=u==null?void 0:u.removedSamplesForAcceleration)!==null&&n!==void 0?n:e.removedSamplesForAcceleration,h=(i=u==null?void 0:u.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,p=(o=u==null?void 0:u.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,m=(a=u==null?void 0:u.jitterBufferEmittedCount)!==null&&a!==void 0?a:e.jitterBufferEmittedCount,f=(s=u==null?void 0:u.audioLevel)!==null&&s!==void 0?s:e==null?void 0:e.audioLevel,_=(c=u==null?void 0:u.totalSamplesDuration)!==null&&c!==void 0?c:e==null?void 0:e.totalSamplesDuration,E=(l=u==null?void 0:u.concealedSamples)!==null&&l!==void 0?l:e.concealedSamples;if(d&&h&&(r.accelerateRate=d/h),p&&m){let T=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},R=T.jitterBufferMs,w=m-T.jitterBufferEmittedCount;w>0&&(R=1e3*(p-T.jitterBufferDelay)/w),r.jitterBufferMs=Math.round(R),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:m,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=f;let g=1920;_&&h&&(g=h/_/50,r.receivedFrames=Math.round(h/g)),E&&(r.droppedFrames=Math.round(E/g))}processRemoteInboundStats(e,t){let r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{r=r===null?i.diffMean():r+i.diffMean()});let n=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*n/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},EJ=class extends KR{updateStats(){return Y.resolve()}};function zR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,o=function(){let a=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return a&&a[0]?Number(a[0].split("/")[1]):null}();return o?o<76?new _J(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new BN(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):function(a){if(!window.RTCStatsReport)return!1;let s=a.getStats();return!!(s instanceof Y||function(c){return!!c&&(typeof c=="object"||typeof c=="function")&&typeof c.then=="function"}(s))}(e)?new BN(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new EJ(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i})}var GN=class{get localCapabilities(){return Ct(this._localCapabilities)}get rtpCapabilities(){return Ct(this._rtpCapabilities)}get candidates(){return Ct(this._candidates)}get iceParameters(){return Ct(this._iceParameters)}get dtlsParameters(){return Ct(this._dtlsParameters)}constructor(e){y(this,"sessionDesc",void 0),y(this,"_localCapabilities",void 0),y(this,"_rtpCapabilities",void 0),y(this,"_candidates",void 0),y(this,"_iceParameters",void 0),y(this,"_dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname","o/i14u9pJrxRKAsu"),y(this,"firefoxSsrcMidMap",new Map),e=Ct(e);let{remoteIceParameters:t,remoteDtlsParameters:r,candidates:n,remoteRTPCapabilities:i,localCapabilities:o,direction:a,setup:s,videoCodec:c,audioCodec:l}=e,u;this.setup=s,u=a===Ur.RECEIVE_ONLY?Qt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Qt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=n,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=o;let d=a===Ur.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=a===Ur.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=a===Ur.RECEIVE_ONLY?i.send.videoCodecs:ad(re.VIDEO,d,h,c),m=a===Ur.RECEIVE_ONLY?i.send.audioCodecs:ad(re.AUDIO,d,h,l);for(let f of u.mediaDescriptions)f.attributes.iceUfrag=t.iceUfrag,f.attributes.icePwd=t.icePwd,f.attributes.fingerprints=r.fingerprints,f.attributes.candidates=n,f.attributes.setup=this.setup,f.media.mediaType==="application"&&(f.attributes.sctpPort="5000"),f.media.mediaType==="video"&&(f.media.fmts=p.map(_=>_.payloadType.toString(10)),f.attributes.payloads=p,f.attributes.extmaps=d.videoExtensions),f.media.mediaType==="audio"&&(f.media.fmts=m.map(_=>_.payloadType.toString(10)),f.attributes.payloads=m,f.attributes.extmaps=d.audioExtensions,Dl(f));this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}toString(){return Qt.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,n,i){r=r.replace(/ /g,"-");let{ssrcs:o,ssrcGroups:a}=Ts(t,this.cname,b("SYNC_GROUP")?r:void 0),s=this.findPreloadMediaDesc(o);if(s){if(ft()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,s.attributes.mid),i&&(i.twcc||i.remb)){let c=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(s,i),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{let c=this.findAvailableMediaIndex(e,o,n),l;return c===-1?(l=this.createOrRecycleSendMedia(e,o,a,"sendonly",n,i),this.updateBundleMids()):(l=Ct(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="sendonly",l.attributes.ssrcs=o,l.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(l,i)),ft()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,l.attributes.mid),{needExchangeSDP:!0,mid:l.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){let n=[];return e.forEach(i=>{let o=i._mediaStreamTrack.kind,a=this.findAvailableRecvMediaIndex(o),s,c=!1;a===-1?(c=!0,s=this.createOrRecycleRecvMedia(i,[],"recvonly",t,r),this.updateBundleMids()):(s=Ct(this.sessionDesc.mediaDescriptions[a]),s.attributes.direction="recvonly"),n.push({mid:s.attributes.mid,needCreateTransceiver:c})}),n}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:r,address:n,port:i,type:o,relatedAddress:a,relatedPort:s,priority:c}=new RTCIceCandidate(e),l={foundation:t??"",componentId:"1",transport:r??"",priority:c?c+"":"",connectionAddress:n??"",port:i?i+"":"",type:o?o+"":"",relAddr:a??"",relPort:s?s+"":"",extension:{}};this.candidates.some(u=>u.priority===l.priority&&u.connectionAddress===l.connectionAddress&&u.port===l.port)||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach(u=>{u.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,n,i){let o=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,s=ad(o,a,this.localCapabilities.send,o===re.AUDIO?i:n),c=o===re.VIDEO?a.videoExtensions:a.audioExtensions,l="".concat(++this.currentMidIndex),u={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};u=this.mungRecvMediaDsec(u,e);let d=this.findFirstClosedMedia(o);if(d){let h=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[h]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>q(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>q(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(n=>{let i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(ft()){if(i){let o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!o||o!==n.attributes.mid)}return!1}return i&&n.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Ct(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,n,i,o){let a=this.rtpCapabilities.send,s=e===re.VIDEO?a.videoCodecs:a.audioCodecs,c=e===re.VIDEO?a.videoExtensions:a.audioExtensions;ft()&&(i="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map(d=>d.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:i}};l=this.mungSendMediaDesc(l,o);let u=this.findFirstClosedMedia(e);if(u){let d=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[d]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,r){let n=Ct(e);return VR(n),Pl(n,t),FR(n,t),AV(n),Em(n,r,this.localCapabilities.send),n}mungSendMediaDesc(e,t){let r=Ct(e);return Em(r,t,this.localCapabilities.recv),Dl(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===e);if(r!==-1){let n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=n}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>ft()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},gJ=["sdp"],$e;function WN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function da(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?WN(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WN(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var HN=($e=class Nc extends jx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,n){super(t,r),y(this,"direction",void 0),y(this,"name",void 0),y(this,"store",void 0),y(this,"spec",void 0),y(this,"peerConnection",void 0),y(this,"initialOffer",void 0),y(this,"transport",void 0),y(this,"statsFilter",void 0),y(this,"localCandidateCount",0),y(this,"_isInRestartIce",!1),y(this,"mutex",new _r("P2PConnection-mutex")),y(this,"onLocalCandidate",void 0),y(this,"remoteSDP",void 0),y(this,"pendingCandidates",[]),y(this,"localCapabilities",void 0),y(this,"isReady",!1),y(this,"restartCnt",0),y(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.peerConnection=new RTCPeerConnection(Nc.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=n??Ur.SEND_ONLY,this.name=this.direction===Ur.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=zR(this.peerConnection,b("STATS_UPDATE_INTERVAL"),void 0,ft()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let r=await OV();if(this.localCapabilities=gm(r),t){let{sdp:n}=t,i=fJ(t,gJ),o=function(){let u={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},d=$d(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Si(d,u,"videoExtensions",h,p,m),Si(d,u,"videoCodecs",h,p,m),Si(d,u,"audioExtensions",h,p,m),Si(d,u,"audioCodecs",h,p,m),b("RAISE_H264_BASELINE_PRIORITY")){let f=m.videoCodecs.findIndex(_=>_.rtpMap&&_.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&_.fmtp&&_.fmtp.parameters["profile-level-id"]==="42001f");if(f!==-1){let _=m.videoCodecs.findIndex(E=>E.rtpMap&&E.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(_<f){v.debug("raising H264 baseline profile priority");let E=m.videoCodecs[f];m.videoCodecs.splice(f,1),m.videoCodecs.splice(_,0,E)}_!==-1&&b("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(E=>!(E.rtpMap&&E.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&E.fmtp&&E.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:h,recv:p,sendrecv:m}}({},{},n);this.remoteSDP=new GN({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let a=await this.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let s=ka(a.sdp);await this.peerConnection.setLocalDescription(a);let c=await TN({},{},a.sdp);this.localCapabilities=gm(c);let l=this.peerConnection.getTransceivers()[0];return l!=null&&l.receiver&&l.receiver.transport&&this.tryBindTransportEvents(l.receiver.transport),da(da({},s),{},{sdp:a.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=ka(n.sdp);return this.initialOffer=n,da(da({},i),{},{sdp:n.sdp})}}catch(r){throw new V(C.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:r,iceParameters:n,dtlsParameters:i}=t,o=await TN({},{},r);this.remoteSDP=new GN({remoteIceParameters:n,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let a=this.peerConnection.getTransceivers()[0];a!=null&&a.sender&&a.sender.transport&&this.tryBindTransportEvents(a.sender.transport)}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new V(C.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,n){var i=this;return Ki(function*(){let o=yield De(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let a=[],s=i.remoteSDP.receive(t,r,n);t.forEach((_,E)=>{if(s[E].needCreateTransceiver){let g=i.peerConnection.addTransceiver(_._mediaStreamTrack,{direction:"sendonly"});a.push(g),_._updateRtpTransceiver(g)}else{let g=i.peerConnection.getTransceivers().find(T=>T.mid===s[E].mid);if(!g)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(s[E].mid));a.push(g),_._updateRtpTransceiver(g)}}),ft()&&b("SIMULCAST")===!0&&(yield De(i.applySimulcastForFirefox(a,t)));let c=s.map(_=>_.mid),l=yield De(i.peerConnection.createOffer()),u=i.mungSendOfferSDP(l.sdp,t,c),d=Qt.parse(u),h=c.map(_=>{let E=d.mediaDescriptions.find(g=>g.attributes.mid===_);if(!E)throw new Error("Cannot extract ssrc from mediaDescription.");return IV(E,b("USE_PUB_RTX"))}),p=a.map((_,E)=>{let g=c[E];return{localSSRC:h[E],id:g}});yield De(i.peerConnection.setLocalDescription({type:"offer",sdp:u}));try{yield p}catch(_){let E=i.remoteSDP.toString();throw yield De(i.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield De(i.peerConnection.setRemoteDescription({type:"answer",sdp:E})),yield De(i.stopSending(c,!0)),_}yield De(i.applySimulcastEncodings(a,t)),yield De(i.applySendEncodings(a,t));let m=i.remoteSDP.toString(),f=i.logSDPExchange(u,"offer","local","send");return f==null||f(m),yield De(i.setRemoteDescription({type:"answer",sdp:m})),a.map((_,E)=>{let g=c[E];return{localSSRC:h[E],id:g}})}catch(a){throw a instanceof V?a:new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(t,r){let n=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(c=>t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(c=>{var l;c.direction="inactive",(l=c.stop)===null||l===void 0||l.call(c)});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let s=this.remoteSDP.toString();a==null||a(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,r,n,i);if(a){let c=this.remoteSDP.toString(),l=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});let u=await this.peerConnection.createAnswer(),d=this.mungReceiveAnswerSDP(u.sdp,o,t);l==null||l(d||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:d}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let s=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!s||s.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,mid:s.mid,transceiver:s}}catch(o){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,r,n,i);if(a){let s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:s});let l=await this.peerConnection.createAnswer(),u=this.mungReceiveAnswerSDP(l.sdp,o,t);c==null||c(u||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:u}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(o){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();n==null||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===_s.Auto&&(this.store.p2pTransport=_s.SdRtn,Pe().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Nc.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Pe().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Nc.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:n}=ka(r.sdp);return this.store.descriptionStart(),this.direction===Ur.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),n}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ur.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:n}=ka(r.sdp);return await this.peerConnection.setLocalDescription(r),n}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let o=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new V(C.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){let n=this.peerConnection.getTransceivers().filter(i=>i.mid===t);n.length===1&&(this.isVP8Simulcast(r)?ft()||await this.applySimulcastEncodings(n,[r]):await this.applySendEncodings(n,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let n=this.peerConnection.getTransceivers().find(i=>i.mid===r);n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:n,remote:i}=r.getSelectedCandidatePair();return{local:da(da({},Co),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:da(da({},Co),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;q(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i={iceServers:[]};var o;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(m_(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...Nc.turnServerConfigToIceServers(t.turnServer.servers,r,n)),b("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...Nc.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,n)),q(o=[_s.Relay,_s.SdRtn]).call(o,r)&&(i.iceTransportPolicy="relay"),b("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(i.iceTransportPolicy="relay")}))),b("ENABLE_ENCODED_TRANSFORM")&&Pe().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),v.debug("P2PConnection p2pTransport is ".concat(r)),i}static turnServerConfigToIceServers(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=[],o=t.filter(s=>s.tcpport);v.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(n));let a=o.length>n?o[n]:o[0];switch(r){case _s.SdRtn:let s=t.filter(l=>{var u;return q(u=l.username).call(u,"glb:")&&l.turnServerURL==l.turnServerURL}),c=s.length>n?s[n]:s[0];c&&(i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(Jc(c.turnServerURL),":").concat(c.tcpport,"?transport=udp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Jc(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;case _s.Relay:a&&(i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Jc(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}));break;default:a&&(i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Jc(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var n;t!=null&&t.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,t.state))},t.onerror=n=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in n?n.error:n)};let r=t.iceTransport;r&&(r.onstatechange=()=>{let n=t==null?void 0:t.iceTransport.state;var i;n&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,n))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:n,remote:i}=r.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var n;if(r||(r=this.peerConnection.getSenders().find(u=>u.track===t._mediaStreamTrack)),!r)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Pe().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let i={},o={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var a;let{bitrateMax:u,frameRate:d,scaleResolutionDownBy:h}=t._encoderConfig;u&&(o.maxBitrate=1e3*u),q(a=t._hints).call(a,et.LOW_STREAM)&&(d&&(o.maxFramerate=hn(d)),h&&h>=1&&(o.scaleResolutionDownBy=h))}if(b("DSCP_TYPE")&&Ja()){var s;let u=b("DSCP_TYPE");q(s=["very-low","low","medium","high"]).call(s,u)&&(o.networkPriority=u)}let c=r.getParameters(),l=(n=c.encodings)===null||n===void 0?void 0:n[0];ft()&&!l&&(i.encodings=[o]),l&&Object.assign(l,o),Object.assign(c,i),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await r.setParameters(c)}async applySendEncodings(t,r){try{if(!Pe().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){let i=t[n],o=r[n];o instanceof Xe&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,i.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,n){let i=Qt.parse(t);return r.forEach((o,a)=>{let s=n[a],c=i.mediaDescriptions.find(l=>l.attributes.mid===s);c&&(Pl(c,o),bV(c,o,this.store.codec))}),Qt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let c=0;c<t.length;c++){var n,i,o,a,s;let l=t[c],u=r[c];if(u instanceof Xe&&!q(n=u._hints).call(n,et.LOW_STREAM)&&(i=u._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=u._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=u._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((s=u._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1&&this.store.codec==="vp8"){let d={},h={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}];let p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,d))}}}async applySimulcastEncodings(t,r){if(!ft()&&t.length===r.length)for(let n=0;n<t.length;n++){let i=r[n];if(i instanceof Xe&&this.isVP8Simulcast(i)){let o=t[n],a={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];let c=o.sender.getParameters();await o.sender.setParameters(Object.assign(c,a))}}}isVP8Simulcast(t){var r,n,i,o,a;return!!(t instanceof Xe&&b("SIMULCAST")&&this.store.codec==="vp8"&&!q(r=t._hints).call(r,et.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,r,n,i){if(b("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(r," SDP during P2PConnection.").concat(i,`
`),t),r==="offer"?o=>{this.logSDPExchange(o,"answer",n==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(a=>{a.direction="inactive"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();i==null||i(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async a=>{a.direction="sendonly"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t);let o=this.remoteSDP.toString();i==null||i(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var n,i;if(r=(n=r)!==null&&n!==void 0?n:(i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp){var o;let a=(o=Qt.parse(r).mediaDescriptions.find(s=>s.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs;return a==null?void 0:a[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),q(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,n){let i=Qt.parse(t),o=i.mediaDescriptions.find(a=>a.attributes.mid===r);return o&&n===re.AUDIO&&o.media.mediaType==="audio"&&Dl(o),Qt.print(i)}},Z($e.prototype,"establish",[ci],Object.getOwnPropertyDescriptor($e.prototype,"establish"),$e.prototype),Z($e.prototype,"connect",[ci],Object.getOwnPropertyDescriptor($e.prototype,"connect"),$e.prototype),Z($e.prototype,"receive",[ci],Object.getOwnPropertyDescriptor($e.prototype,"receive"),$e.prototype),Z($e.prototype,"mockReceive",[ci],Object.getOwnPropertyDescriptor($e.prototype,"mockReceive"),$e.prototype),Z($e.prototype,"stopReceiving",[ci],Object.getOwnPropertyDescriptor($e.prototype,"stopReceiving"),$e.prototype),Z($e.prototype,"restartICE",[ci],Object.getOwnPropertyDescriptor($e.prototype,"restartICE"),$e.prototype),Z($e.prototype,"close",[ci],Object.getOwnPropertyDescriptor($e.prototype,"close"),$e.prototype),Z($e.prototype,"updateEncoderConfig",[ci],Object.getOwnPropertyDescriptor($e.prototype,"updateEncoderConfig"),$e.prototype),Z($e.prototype,"updateSendParameters",[ci],Object.getOwnPropertyDescriptor($e.prototype,"updateSendParameters"),$e.prototype),Z($e.prototype,"replaceTrack",[ci],Object.getOwnPropertyDescriptor($e.prototype,"replaceTrack"),$e.prototype),Z($e.prototype,"muteLocal",[ci],Object.getOwnPropertyDescriptor($e.prototype,"muteLocal"),$e.prototype),Z($e.prototype,"unmuteLocal",[ci],Object.getOwnPropertyDescriptor($e.prototype,"unmuteLocal"),$e.prototype),$e);function ci(e,t,r){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let i=this.mutex,o=await i.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await n.apply(this,s)}finally{o()}},r}function kT(e,t){let r=document.createElement("video"),n=document.createElement("canvas");r.setAttribute("style","display:none"),n.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),n.width=hn(t.width),n.height=hn(t.height);let i=hn(t.framerate||15);document.body.append(r),document.body.append(n);let o=e._mediaStreamTrack;r.srcObject=new MediaStream([o]),r.play();let a=n.getContext("2d");if(!a)throw new M(C.UNEXPECTED_ERROR,"can not get canvas context");let s=Pe(),c=n.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=n),n.startCapture=()=>{if(!r)return n.stopCapture&&n.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){let u=r.videoWidth,d=r.videoHeight/u,h=n.width*d;Math.abs(h-n.height)>=2&&(v.debug("adjust low stream resolution","".concat(n.width,"x").concat(n.height," -> ").concat(n.width,"x").concat(h)),n.height=h)}a.drawImage(r,0,0,n.width,n.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,r.srcObject=new MediaStream([o]))},n.stopCapture=MR(()=>n.startCapture&&n.startCapture(),i);let l=c.stop;return c.stop=()=>{l.call(c),r&&(r.remove(),r.srcObject=null,r=null),n&&(n.width=0,n.remove(),n.stopCapture&&n.stopCapture(),n.startCapture=void 0,n.stopCapture=void 0,n=null),v.debug("clean low stream renderer")},c}var Rf=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Rf||{}),Ft=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(Ft||{}),gs=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(gs||{}),Sr=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(Sr||{}),vs=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(vs||{}),BV=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(BV||{}),Ea=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(Ea||{}),ui=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(ui||{}),GV=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(GV||{}),Bn=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Bn||{}),ko=1e3,hs=3;function Ee(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function KN(e){let t={[Bn.CONN_TYPE]:0,[Bn.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[Bn.CONN_TYPE]=1),r==="tcp"&&(t[Bn.CONN_TYPE]=3),r==="tls"&&(t[Bn.CONN_TYPE]=4);break}case"srflx":t[Bn.CONN_TYPE]=2}return t}function zN(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}var WV=class extends lt{constructor(e){super(),y(this,"store",void 0),y(this,"uploadWRTCStatsTimer",void 0),y(this,"uploadOutboundDenoiserStatsTimer",void 0),y(this,"uploadExtStatsTimer",void 0),y(this,"uploadExtUsageStatsTimer",void 0),y(this,"uploadInboundExtStatsTimer",void 0),y(this,"requestStats",void 0),y(this,"requestTransportStats",void 0),y(this,"requestLocalMedia",void 0),y(this,"requestRemoteMedia",void 0),y(this,"requestAllTracks",void 0),y(this,"requestVideoIsReady",void 0),y(this,"requestUploadStats",void 0),y(this,"requestUpload",void 0),y(this,"uploadOutboundStarted",!1),y(this,"uploadInboundStarted",!1),y(this,"uploadTransportStarted",!1),y(this,"uploadExtensionUsageStarted",!1),y(this,"lastRecvStats",void 0),y(this,"lastSendStats",void 0),y(this,"lastFullRecvStats",void 0),y(this,"lastFullSendStats",void 0),y(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,r;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),t||r){let n={};if(this.uploadTransportStarted&&t){let i=this.getTransportStats(t,r,e);i&&(n.misc=[i])}if(this.uploadOutboundStarted&&t){let i=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);i&&(n.outbound=[i])}if(this.uploadInboundStarted&&r){let i=this.getInboundStats(r,e?this.lastRecvStats:this.lastFullRecvStats,e);i&&(n.inbound=i)}this.requestUploadStats(n)}this.lastRecvStats=r,this.lastSendStats=t,e||(this.lastFullRecvStats=r,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==hs),++e===hs+1&&(e=1)},ko)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,r){if(!this.requestStats)return;if(r)return e.rtt==null?void 0:{addition:{[Bn.RTT]:e.rtt,[Bn.CONN_TYPE]:void 0}};let n=KN(e);if(this.store.useP2P){if(t){let i=KN(t);n[Bn.CONN_TYPE]+=i[Bn.CONN_TYPE]<<3}n[Bn.CONN_TYPE]+=110}else n[Bn.CONN_TYPE]+=100;return{addition:n}}getOutboundStats(e,t,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;let n=this.requestLocalMedia();if(!n||n.length===0)return;let i,o,a;return n.forEach(s=>{let[c,{track:l,ssrcs:u}]=s;switch(c){case H.LocalVideoLowTrack:case H.LocalVideoTrack:if(c===H.LocalVideoTrack){let d=function(m,f,_,E,g){let T=f.videoSend.find(x=>x.ssrc===m);if(!T)return;let R={},{sentFrame:w,inputFrame:A}=T;if(A&&w){let x=A.frameRate,G=w.frameRate;R[Ft.FREEZE]=function(ne,z){let k=!0;return k=!(ne<=5)&&(ne<=10?z<3:ne<=20?z<4:z<5),k}(x,G)?1:0}if(Ee(R,Ft.QP_SUM,T.qpSumPerFrame),g)return R;switch(w&&(Ee(R,Ft.HEIGHT,w.height),Ee(R,Ft.WIDTH,w.width),Ee(R,Ft.FRAME_RATE,w.frameRate)),R[Ft.DISABLED]=E._originMediaStreamTrack&&!E._originMediaStreamTrack.enabled||E._mediaStreamTrack&&!E._mediaStreamTrack.enabled?1:0,T.adaptionChangeReason){case"none":R[Ft.ADAPTATION]=0;break;case"cpu":R[Ft.ADAPTATION]=1;break;case"bandwidth":R[Ft.ADAPTATION]=2;break;case"other":R[Ft.ADAPTATION]=3}let N=0;T.adaptionChangeReason&&(N+=zN(T.adaptionChangeReason)),f.qualityLimitationReason&&(N+=zN(f.qualityLimitationReason)<<3),R[Ft.ADAPTATION]=N,R[Ft.PLAYER_STATUS]=zg[E._player?E._player.videoElementStatus:"uninit"],Ee(R,Ft.NACKS,T.nacksCount),Ee(R,Ft.PLIS,T.plisCount),Ee(R,Ft.FIRS,T.firsCount),Ee(R,Ft.AVG_ENCODE,T.avgEncodeMs);let P=_&&_.videoSend.find(x=>x.ssrc===m);if(P){let x=g?ko:ko*hs;P.timestamp&&T.timestamp&&(x=T.timestamp-P.timestamp),P.packets!=null&&T.packets!=null&&Ee(R,Ft.PACKAGE_RATE,1e3*(T.packets-P.packets)/x),T.packetsLost!=null&&P.packetsLost!=null&&Ee(R,Ft.PACKAGE_LOST,T.packetsLost-P.packetsLost),P.bytes!=null&&T.bytes!=null&&Ee(R,Ft.BITRATE,8*(T.bytes-P.bytes)/x)}return R}(u[0].ssrcId,e,t,l,r),h=r?null:function(m,f,_){let E=f.videoSend.find(N=>N.ssrc===m);if(!E)return null;let g={},T=E.inputFrame,R=T&&T.height||_&&_.videoHeight||0,w=T&&T.width||_&&_.videoWidth||0,A=T&&T.frameRate||0;return Ee(g,Rf.HEIGHT,R),Ee(g,Rf.WIDTH,w),Ee(g,Rf.FRAME_RATE,A),g}(u[0].ssrcId,e,l),p=r?null:function(m){let f={};return Ee(f,Ft.RETRANSMIT,m.bitrate.retransmit),Ee(f,Ft.TARGET_ENCODED,m.bitrate.targetEncoded),Ee(f,Ft.ACTUAL_ENCODED,m.bitrate.actualEncoded),Ee(f,Ft.TRANSMIT,m.bitrate.transmit),Ee(f,Ft.BANDWIDTH,m.sendBandwidth),f}(e);o=Object.assign({},d,h,p)}else a=r?void 0:function(d,h,p){let m=h.videoSend.find(E=>E.ssrc===d);if(!m)return;let f={},_=m.sentFrame;if(_&&(Ee(f,gs.HEIGHT,_.height),Ee(f,gs.WIDTH,_.width),Ee(f,gs.FRAME_RATE,_.frameRate)),p){let E=p.videoSend.find(g=>g.ssrc===d);if(E){let g=ko*hs;E.timestamp&&m.timestamp&&(g=m.timestamp-E.timestamp),E.packets!=null&&m.packets!=null&&Ee(f,gs.PACKAGE_RATE,1e3*(m.packets-E.packets)/g),m.packetsLost!=null&&E.packetsLost!=null&&Ee(f,gs.PACKAGE_LOST,m.packetsLost-E.packetsLost),E.bytes!=null&&m.bytes!=null&&Ee(f,gs.BITRATE,8*(m.bytes-E.bytes)/g)}}return f}(u[0].ssrcId,e,t);break;case H.LocalAudioTrack:i=r?void 0:function(d,h,p,m){let f=h.audioSend.find(R=>R.ssrc===d);if(!f)return;let _={};_[Ea.DISABLED]=m._originMediaStreamTrack&&!m._originMediaStreamTrack.enabled||m._mediaStreamTrack&&!m._mediaStreamTrack.enabled?1:0;let E=100*m._source.getAccurateVolumeLevel(),g=f.inputLevel;if(g!=null){let R=Math.ceil(50*Math.log10(100*g+1));Ee(_,Ea.LEVEL,R)}Ee(_,BV.PCM_LEVEL,E),Ee(_,Ea.AEC_RETURN_LOSS,f.aecReturnLoss),Ee(_,Ea.AEC_RETURN_LOSS_ENH,f.aecReturnLossEnhancement),_[Ea.FREEZE]=0;let T=p&&p.audioSend.find(R=>R.ssrc===d);if(T){let R=ko*hs;T.timestamp&&f.timestamp&&(R=f.timestamp-T.timestamp),T.bytes!=null&&f.bytes!=null&&Ee(_,Ea.BITRATE,8*(f.bytes-T.bytes)/R),T.packets!=null&&f.packets!=null&&Ee(_,Ea.PACKAGE_RATE,1e3*(f.packets-T.packets)/R)}return _}(u[0].ssrcId,e,t,l)}}),{high:o,low:a,audio:i}}getInboundStats(e,t,r){if(!this.requestRemoteMedia)return;let n=this.requestRemoteMedia()||[],i=[];return n.forEach(o=>{let[a,s]=o,c={peer:a.uid};if(s.has(re.VIDEO)&&a.videoTrack){let l=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,u=a.videoTrack?function(d,h,p,m,f,_,E){var g;let T=h.videoRecv.find(G=>G.ssrc===d);if(!T)return;let R={},{receivedFrame:w,outputFrame:A,decodeFrameRate:N}=T,P=p&&p.videoRecv.find(G=>G.ssrc===d);if(R[Sr.FREEZE]=f&&HV.isRemoteVideoFreeze(m,T,P)?1:0,Ee(R,vs.FRAME_RATE_DECODE,N),Ee(R,Sr.QP_SUM,T.qpSumPerFrame),T.framesRateFirefox&&Ee(R,Sr.FRAME_RATE,T.framesRateFirefox),w&&Ee(R,Sr.FRAME_RATE,w.frameRate),P){let G=h.timestamp-p.timestamp||(E?ko:hs*ko);T.packetsLost!=null&&P.packetsLost!=null&&Ee(R,Sr.PACKAGE_LOST,T.packetsLost-P.packetsLost),P.bytes!=null&&T.bytes!=null&&Ee(R,Sr.BITRATE,8*(T.bytes-P.bytes)/G),P.packets!=null&&T.packets!=null&&Ee(R,Sr.PACKAGE_RATE,1e3*(T.packets-P.packets)/G)}if(E)return R;w?(Ee(R,Sr.HEIGHT,w.height),Ee(R,Sr.WIDTH,w.width)):m&&(Ee(R,Sr.HEIGHT,m._videoHeight||0),Ee(R,Sr.WIDTH,m._videoWidth||0)),A&&Ee(R,vs.FRAME_RATE_OUTPUT,A.frameRate);let x=(g=m._player)===null||g===void 0?void 0:g.rendFrameRate.toFixed(0);if(x&&Ee(R,vs.FRAME_RATE_RENDER,+x),Ee(R,Sr.JITTER_BUFFER,T.jitterBufferMs),Ee(R,Sr.CURRENT_DELAY,T.currentDelayMs),Ee(R,Sr.FIRS,T.firsCount),Ee(R,Sr.NACKS,T.nacksCount),Ee(R,Sr.PLIS,T.plisCount),m){R[Sr.DISABLED]=m._originMediaStreamTrack.enabled&&m._mediaStreamTrack.enabled?0:1;let G=m._player;if(G){let{freezeTimeCounterList:ne,renderFreezeAccTime:z,videoElementStatus:k}=G;if(ne&&ne.length>0&&Ee(R,vs.FREEZE_TIME,ne.splice(0,1)[0]),_&&xo.visibility==="visible"&&k===Ir.PLAYING&&Pe().supportRequestVideoFrameCallback){let F=Math.min(6e3,z);G.renderFreezeAccTime=Math.max(0,z-F),Ee(R,vs.FREEZE_TIME_RENDER,F)}if(typeof T.totalFreezesDuration=="number"){let F=P&&P.totalFreezesDuration?T.totalFreezesDuration-P.totalFreezesDuration:T.totalFreezesDuration;Ee(R,vs.FREEZE_DURATION,1e3*F)}}}if(R[Sr.PLAYER_STATUS]=zg[m._player?m._player.videoElementStatus:"uninit"],P&&T.totalInterFrameDelay!==void 0&&T.totalSquaredInterFrameDelay!==void 0&&P.totalInterFrameDelay!==void 0&&P.totalSquaredInterFrameDelay!==void 0){let G=T.totalInterFrameDelay-P.totalInterFrameDelay,ne=T.totalSquaredInterFrameDelay-P.totalSquaredInterFrameDelay,z=T.framesDecodeCount-P.framesDecodeCount,k=G/z*1e3,F=Math.round(1e3*Math.sqrt((ne-Math.pow(G,2)/z)/z));!isNaN(F)&&k+F>Math.max(3*k,k+150)&&(R[Sr.I_FRAME_DELAY]=F)}return R}(a._videoSSRC,e,t,a.videoTrack,l===!0,this.needUploadRenderFreezeTime,r):void 0;u&&(c.video=u)}if(s.has(re.AUDIO)&&a.audioTrack){let l=a.audioTrack?function(u,d,h,p,m){let f=d.audioRecv.find(P=>P.ssrc===u);if(!f)return;let _={},E=h&&h.audioRecv.find(P=>P.ssrc===u),{receivedFrames:g,droppedFrames:T}=f;var R,w;if(Ee(_,ui.JITTER,f.jitterMs),g!=null&&T!=null&&(_[ui.FREEZE]=(w=T,(R=g)===0||100*w/R>20?1:0)),E){let P=d.timestamp-h.timestamp||(m?ko:ko*hs);f.packets!=null&&E.packets!=null&&Ee(_,ui.PACKAGE_RATE,1e3*(f.packets-E.packets)/P),E.bytes!=null&&f.bytes!=null&&Ee(_,ui.BITRATE,8*(f.bytes-E.bytes)/P),f.packetsLost!=null&&E.packetsLost!=null&&Ee(_,ui.PACKAGE_LOST,f.packetsLost-E.packetsLost)}if(m)return _;let A=100*p._source.getAccurateVolumeLevel(),N=f.outputLevel;if(N!=null){let P=Math.ceil(50*Math.log10(100*N+1));Ee(_,GV.LEVEL,P)}if(Ee(_,ui.PCM_LEVEL,A),p&&(_[ui.DISABLED]=p._originMediaStreamTrack.enabled&&p._mediaStreamTrack.enabled?0:1),Ee(_,ui.JITTER_BUFFER,f.jitterBufferMs),Ee(_,ui.CURRENT_DELAY,f.jitterBufferMs),_[ui.PLAYER_STATUS]=zg[Kr.getPlayerState(p.getTrackId())],E){let P=f.concealedSamples-E.concealedSamples;P>0&&Ee(_,ui.CONCEALED_SAMPLES,P)}return _}(a._audioSSRC,e,t,a.audioTrack,r):void 0;l&&(c.audio=l)}(c.video||c.audio)&&i.push(c)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,i}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find(t=>t instanceof mm);if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(Hd.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(t=>{this.requestUpload&&this.requestUpload(t.type,t.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[t,r]=e;r.has(re.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)}),r.has(re.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let t=Date.now(),r={connectionInterval:b("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t},n=[],i=this.requestAllTracks&&this.requestAllTracks()||[];for(let c of i)!c.muted&&c.enabled&&(n=n.concat(await c.getProcessorUsage()));let o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[c,l]of o)l.has(re.VIDEO)&&c.videoTrack&&(n=n.concat(await c.videoTrack.getProcessorUsage())),l.has(re.AUDIO)&&c.audioTrack&&(n=n.concat(await c.audioTrack.getProcessorUsage()));if(n.length===0)return;r.details=function(c,l){let u={};for(let{id:m,value:f,level:_,direction:E}of c){var d;let g=(d=l.get(m))!==null&&d!==void 0?d:0,T=f===2?g+b("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:g;var h,p;l.set(m,T),u[m]?(f===2&&(u[m].value=f),_>u[m].level&&(u[m].level=_),E==="remote"&&(u[m].remoteUidCount+=1),u[m].totalTs=(h=l.get(m))!==null&&h!==void 0?h:0):u[m]={value:f,level:_,remoteUidCount:E==="local"?0:1,totalTs:(p=l.get(m))!==null&&p!==void 0?p:0}}return Object.keys(u).map(m=>{let{level:f,value:_,totalTs:E}=u[m];return{id:m,level:f,value:_,totalTs:E}})}(n,e);let a=Date.now(),s=a>t?a:t+1;this.requestUpload&&this.requestUpload(Hd.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:s})},b("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}},Ca=class{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){y(this,"uid",void 0),y(this,"_uintid",void 0),y(this,"_trust_in_room_",!0),y(this,"_trust_audio_enabled_state_",!0),y(this,"_trust_video_enabled_state_",!0),y(this,"_trust_audio_mute_state_",!0),y(this,"_trust_video_mute_state_",!0),y(this,"_audio_muted_",!1),y(this,"_video_muted_",!1),y(this,"_audio_enabled_",!0),y(this,"_video_enabled_",!0),y(this,"_audio_added_",!1),y(this,"_video_added_",!1),y(this,"_is_pre_created",!1),y(this,"_video_pre_subscribed",!1),y(this,"_audio_pre_subscribed",!1),y(this,"_trust_video_stream_added_state_",!0),y(this,"_trust_audio_stream_added_state_",!0),y(this,"_audioTrack",void 0),y(this,"_videoTrack",void 0),y(this,"_dataChannels",[]),y(this,"_audioSSRC",void 0),y(this,"_videoSSRC",void 0),y(this,"_audioOrtc",void 0),y(this,"_videoOrtc",void 0),y(this,"_cname",void 0),y(this,"_rtxSsrcId",void 0),y(this,"_videoMid",void 0),y(this,"_audioMid",void 0),this.uid=e,this._uintid=t}},xi=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function vJ(e,t){var r;let n;switch(t){case H.LocalAudioTrack:n=Me.Audio;break;case H.LocalVideoTrack:n=q(r=e._hints).call(r,et.SCREEN_TRACK)?Me.Screen:Me.High;break;case H.LocalVideoLowTrack:n=Me.Low}return n}function LT(e){let t=Pe();if(e.some(r=>r._bypassWebAudio))throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function nv(e,t){LT(e);let r=new Bt;return e.forEach(n=>r.addAudioTrack(n)),r}var YN,$N,qN,XN,JN,QN,ZN,eP,tP,rP,nP,tt;function iP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Op(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var an=(YN=ki(xi.SEND_ONLY),$N=ki(xi.SEND_ONLY),qN=ki(),XN=ki(xi.RECEIVE_ONLY),JN=ki(xi.RECEIVE_ONLY),QN=ki(xi.RECEIVE_ONLY),ZN=ki(xi.RECEIVE_ONLY),eP=ki(xi.RECEIVE_ONLY),tP=ki(xi.RECEIVE_ONLY),rP=ki(),nP=ki(xi.RECEIVE_ONLY),tt=class extends lt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(le.StateChange,t,this._state)}constructor(e,t){super(),y(this,"isPlanB",!1),y(this,"store",void 0),y(this,"statsUploader",void 0),y(this,"sendConnection",void 0),y(this,"recvConnection",void 0),y(this,"localTrackMap",new Map),y(this,"remoteUserMap",new Map),y(this,"localDataChannels",[]),y(this,"pendingLocalTracks",[]),y(this,"pendingRemoteTracks",[]),y(this,"statsCollector",void 0),y(this,"dtlsFailedCount",0),y(this,"sendMutex",new _r("P2PChannel2-send-mutex")),y(this,"recvMutex",new _r("P2PChannel2-recv-mutex")),y(this,"_state",Le.Disconnected),y(this,"_restartStates",["disconnected","failed"]),y(this,"reconnectInterval",void 0),y(this,"uploadUnplinkStarted",!1),y(this,"uploadDownlinkStarted",!1),y(this,"uplinkStateUploadInterval",void 0),y(this,"downlinkStatsUploadInterval",void 0),y(this,"handleMuteLocalTrack",async(r,n,i)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Le.Connected)return void i(new V(C.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let c=this.filterTobeMutedTracks(r);if(c.length===0)return void n();let l=c.find(p=>p[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(c.map(p=>{let[,{id:m}]=p;return m}));let u=!1;var a,s;r.trackMediaType==="video"?u=!((a=this.localTrackMap.get(H.LocalAudioTrack))===null||a===void 0||!a.track._muted):u=((s=this.localTrackMap.get(H.LocalVideoTrack))===null||s===void 0?void 0:s.id)===void 0;let d=this.createMuteMessage(c);await We(this,le.RequestMuteLocal,d);let h=r.trackMediaType==="video"?Pa.MUTE_LOCAL_VIDEO:Pa.MUTE_LOCAL_AUDIO;await We(this,le.RequestP2PMuteLocal,{action:h,message:d,isMuteAll:u}),n()}catch(c){i(c)}finally{o()}}),y(this,"handleUnmuteLocalTrack",async(r,n,i)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Le.Connected)return void i(new V(C.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let a=this.filterTobeUnmutedTracks(r);if(a.length===0)return void n();await this.sendConnection.unmuteLocal(a.map(l=>{let[,{id:u}]=l;return u}));let s=this.createUnmuteMessage(a),c=r.trackMediaType==="video"?Pa.UNMUTE_LOCAL_VIDEO:Pa.UNMUTE_LOCAL_AUDIO;await We(this,le.RequestP2PMuteLocal,{action:c,message:s}),n()}catch(a){i(a)}finally{o()}}),y(this,"handleUpdateVideoEncoder",async(r,n,i)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let a=this.localTrackMap.get(H.LocalVideoTrack);if(!this.sendConnection||!a||a.track!==r||this.state!==Le.Connected)return void n();let{id:s,track:c}=a;s&&(await this.sendConnection.updateSendParameters(s,c),await this.sendConnection.updateEncoderConfig(s,c),this.emit(le.UpdateVideoEncoder,c)),n()}catch(a){i(a)}finally{o()}}),y(this,"handleUpdateVideoSendParameters",async(r,n,i)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let a=this.localTrackMap.get(H.LocalVideoTrack);if(!this.sendConnection||!a||a.track!==r||this.state!==Le.Connected)return void n();let{id:s,track:c}=a;s&&await this.sendConnection.updateSendParameters(s,c),n()}catch(a){i(a)}finally{o()}}),y(this,"handleReplaceTrack",async(r,n,i,o)=>{let a;v.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof o=="boolean"&&o||(a=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var s;let l=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:d}]=u;return r===d});if(!this.sendConnection||!l||l[1].id===void 0||this.state!==Le.Connected)return void n();if(await((s=this.sendConnection)===null||s===void 0?void 0:s.replaceTrack(r,l[1].id)),l[0]===H.LocalVideoTrack&&Pe().supportDualStreamEncoding){let u=this.localTrackMap.get(H.LocalVideoLowTrack);if(u){let d=r._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=d,u.track._originMediaStreamTrack=d,await new Y((h,p)=>{this.handleReplaceTrack(u.track,h,p,!0)})}}n()}catch(l){i(l)}finally{var c;(c=a)===null||c===void 0||c()}}),y(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),y(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),y(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),y(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new WV(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},b("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new V(C.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new V(C.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new HN(e,this.store,Ur.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let n=await this.recvConnection.establish(t);return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}{this.state=Le.New,this.sendConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new HN(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let n=await this.sendConnection.establish();return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new V(C.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Le.Connected}async addRemoteCandidate(e,t){if(t===Ur.RECEIVE_ONLY){if(!this.sendConnection)throw new V(C.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new V(C.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var n=this;return Ki(function*(){let i=yield De(n.sendMutex.lock("From P2PChannel.publish"));try{if(!n.sendConnection||n.state!==Le.Connected){n.throwIfTrackTypeNotMatch(e);let l=e.filter(u=>n.pendingLocalTracks.indexOf(u)===-1);return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(l))}n.store.pubId=n.store.pubId+1,fr.markPublishStart(n.store.clientId,n.store.pubId);let o=n.filterTobePublishedTracks(e,t,r);if(o.length===0)return void(yield De(n.tryToUnmuteAudio(e)));o.forEach(l=>{let{track:u,type:d}=l,h=Date.now();n.store.publish(u.getTrackId(),d===H.LocalAudioTrack?"audio":"video",h)}),n.bindLocalTrackEvents(o);let a=yield De(n.sendConnection.send(o.map(l=>{let{track:u}=l;return u}),n.store.codec,n.store.audioCodec)),s=(yield De(a.next())).value,c=n.createGatewayPublishMessage(o,s);try{yield c}catch(l){throw a.throw(l),(l==null?void 0:l.code)===C.WS_ABORT&&o.forEach(u=>{let{track:d}=u;n.pendingLocalTracks.indexOf(d)===-1&&n.pendingLocalTracks.push(d)}),n.unbindLocalTrackEvents(o),l}yield De(a.next()),o.forEach(l=>{let{type:u}=l;n.statsCollector.addLocalStats(u)}),n.statsUploader.startUploadOutboundStats(),n.assignLocalTracks(o,s),o.forEach(l=>{let{track:u,type:d}=l,h=Date.now();n.store.publish(u.getTrackId(),d===H.LocalAudioTrack?"audio":"video",void 0,h)}),n.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Le.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!q(e).call(e,i)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(i=>i[0]==="videoLowTrack");r&&r[1].track.close();let n=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[o,{track:a}]=i;return{type:o,track:a}})),t.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Le.Connected)return r&&r[1].track.close(),n;e.forEach(i=>{let o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:o,ssrcs:a}]=n,s={stream_type:vJ(o,i),ssrcs:a};o._muted||!o._enabled?t.push(s):r.push(s)}),t.length>0&&t.forEach(n=>{We(this,le.RequestMuteLocal,[n])}),r.length>0&&r.forEach(n=>{We(this,le.RequestUnmuteLocal,[n])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Ki(function*(){throw new V(C.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await lr(this,le.RequestRePublish,this.pendingLocalTracks),this.emit(le.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new V(C.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,n){var i;if(!this.recvConnection)throw new V(C.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;let{track:o,mid:a,transceiver:s}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),n);t===re.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new hl(o,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),s&&e._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new dl(o,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),s&&e._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._videoTrack));let c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let l=this.pendingRemoteTracks.findIndex(u=>{let{user:d,kind:h}=u;return d.uid===e.uid&&t===h});l!==-1&&(this.pendingRemoteTracks.splice(l,1),this.emit(le.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,n){if(!this.recvConnection)throw new V(C.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),n)}async unsubscribe(e,t,r){let n=this.pendingRemoteTracks.filter(o=>{let{user:a,kind:s}=o;return t!==void 0?a.uid===e.uid&&t===s:a.uid===e.uid});if(n.forEach(o=>{let a=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(a,1)}),this.recvConnection||r||n.forEach(o=>{let{kind:a}=o;var s;if(a===re.AUDIO)(s=e._audioTrack)===null||s===void 0||s._destroy(),e._audioTrack=void 0;else if(a===re.VIDEO){var c;(c=e._videoTrack)===null||c===void 0||c._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(o=>{let[,{id:a}]=o;return a})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(o=>{let[a,{kind:s}]=o;var c,l;if(s===re.VIDEO&&a._videoSSRC&&((c=this.recvConnection)===null||c===void 0||c.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),s===re.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),r||((l=a._videoTrack)===null||l===void 0||l._destroy(),a._videoTrack=void 0);else if(s===re.AUDIO){var u;this.unbindRemoteTrackEvents(a._audioTrack),!r&&((u=a._audioTrack)===null||u===void 0||u._destroy(),a._audioTrack=void 0)}}),i.forEach(o=>{let[,{kind:a}]=o;We(this,le.RequestP2PMuteRemote,a)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[re.VIDEO,re.AUDIO].forEach(n=>{r.has(n)?We(this,le.RequestP2PUnmuteRemote,n):We(this,le.RequestP2PMuteRemote,n)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new V(C.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new V(C.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new V(C.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new V(C.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let n=t===re.VIDEO?e._videoSSRC:e._audioSSRC;n!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(H.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Bt){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==H.LocalAudioTrack}).filter(n=>{let[i]=n;return!(e&&i===H.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return!(e&&n===H.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n})}reportPublishEvent(e,t,r,n,i){if(e){let a=this.localTrackMap.get(H.LocalAudioTrack),s=n?this.localTrackMap.get(H.LocalVideoLowTrack):this.localTrackMap.get(H.LocalVideoTrack);te.publish(this.store.sessionId,{eventElapse:fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:s==null?void 0:s.track.getTrackLabel(),screenshare:(s==null?void 0:s.track._hints.indexOf(et.SCREEN_TRACK))!==-1,audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;r||(r=[]);let a=r.find(c=>c instanceof ht),s=n?(o=this.localTrackMap.get(H.LocalVideoTrack))===null||o===void 0?void 0:o.track:r.find(c=>c instanceof Xe);te.publish(this.store.sessionId,{eventElapse:fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:s==null?void 0:s.getTrackLabel(),screenshare:(s==null?void 0:s._hints.indexOf(et.SCREEN_TRACK))!==-1,audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,r,n){let i=n===re.VIDEO?r._videoSSRC:r._audioSSRC;i&&te.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===re.VIDEO,audio:n===re.AUDIO,peerid:r.uid,subscribeRequestid:n===re.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:fr.measureFromSubscribeStart(this.store.clientId,i)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new _r("P2PChannel2-send-mutex"),this.sendMutex=new _r("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(H.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Bt){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Le.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(H.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(H.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof Xe||t&&t.track instanceof ht?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(Tn(t=this.remoteUserMap).call(t)).find(n=>n.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[n]=r;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(H.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Sh(e).call(e,(r,n)=>r.level-n.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Le.Reconnecting,b("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:n}]=e;switch(r){case H.LocalVideoTrack:q(t=n._hints).call(t,et.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case H.LocalAudioTrack:n instanceof Bt?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case H.LocalVideoLowTrack:}}),this.emit(le.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Tn(r).call(r)).forEach(n=>{this.setPendingRemoteMedia(t,n)}),this.emit(le.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:n,kind:i}=r;if((e instanceof Ca?e.uid:e)===n.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,n;if(e===Ur.SEND_ONLY){if(!this.sendConnection)throw new V(C.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),n=this.sendConnection}else{if(!this.recvConnection)throw new V(C.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),n=this.recvConnection}try{if(t){let i=await n.restartICE(t);return n.isInRestartIce=!1,i}{let i=await n.restartICE();if(i){let o=await lr(this,le.RequestP2PRestartICE,{direction:Ur.RECEIVE_ONLY,iceParameter:i});await n.restartICE(o),n.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(H.LocalVideoTrack),r=this.localTrackMap.get(H.LocalAudioTrack),n=e.videoSend.find(p=>{var m;return p.ssrc===(t==null||(m=t.ssrcs)===null||m===void 0?void 0:m[0].ssrcId)}),i=e.audioSend.find(p=>{var m;return p.ssrc===(r==null||(m=r.ssrcs)===null||m===void 0?void 0:m[0].ssrcId)});if(!n||!i)return 1;let o=Kn(this,le.NeedSignalRTT),a=n?n.rttMs:void 0,s=i?i.rttMs:void 0,c=a&&s?(a+s)/2:a||s,l=(c&&o?(c+o)/2:c||o)||0,u=100*e.sendPacketLossRate*.7/50+.3*l/1500,d=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,h=t==null?void 0:t.track;if(h&&h._encoderConfig&&h._hints.indexOf(et.SCREEN_TRACK)===-1){let p=h._encoderConfig.bitrateMax,m=e.bitrate.actualEncoded;if(p&&m){let f=(1e3*p-m)/(1e3*p);return xx[f<.15?0:f<.3?1:f<.45?2:f<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[n]=r,i=n._audioSSRC,o=n._videoSSRC,a=e.audioRecv.find(m=>m.ssrc===i),s=e.videoRecv.find(m=>m.ssrc===o);if(!a&&!s)return void(t+=1);let c=Kn(this,le.NeedSignalRTT),l=e.rtt,u=(l&&c?(l+c)/2:l||c)||0,d=a?a.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*u/1500;d&&(p=.6*h*100/50+.2*u/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Y((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){let n=[],i=Pe(),o=this.getAllTracks();e=qc(e=e.filter(c=>o.indexOf(c)===-1));let a=!1,s=!1;for(let c of e){if(c instanceof Xe&&(this.localTrackMap.has(H.LocalVideoTrack)||a?new V(C.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:c,type:H.LocalVideoTrack}),a=!0),t)){let l=this.getLowVideoTrack(c,r);n.push({track:l,type:H.LocalVideoLowTrack})}if(c instanceof ht){let l=this.localTrackMap.get(H.LocalAudioTrack);if(l){if(!(l.track instanceof Bt))throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(s){let u=n.find(d=>{let{type:h}=d;return h===H.LocalAudioTrack});if(!(u.track instanceof Bt))throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof Bt||c._bypassWebAudio)n.push({track:c,type:H.LocalAudioTrack});else{let u=new Bt;u.addAudioTrack(c),n.push({track:u,type:H.LocalAudioTrack})}s=!0}}}return n}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=qc(e=e.filter(n=>r.indexOf(n)!==-1));for(let n of e){if(n instanceof ht){let i=this.localTrackMap.get(H.LocalAudioTrack);if(!i)continue;i.track instanceof Bt?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(t.push([H.LocalAudioTrack,i]),i.track.close())):t.push([H.LocalAudioTrack,i])}if(n instanceof Xe){let i=this.localTrackMap.get(H.LocalVideoTrack);if(!i)continue;t.push([H.LocalVideoTrack,i]);let o=this.localTrackMap.get(H.LocalVideoLowTrack);o&&t.push([H.LocalVideoLowTrack,o])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:n}=t;switch(n){case H.LocalVideoTrack:r.addListener(X.GET_STATS,this.handleGetLocalVideoStats),r.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(X.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case H.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case H.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Bt?e.trackList.forEach(r=>{r.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(X.GET_STATS,this.handleGetLocalAudioStats),r.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(X.GET_STATS,this.handleGetLocalAudioStats),e.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(X.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:n}]=t;return{track:n,type:r}})),e.forEach(t=>{let{track:r,type:n}=t;switch(n){case H.LocalVideoTrack:r.off(X.GET_STATS,this.handleGetLocalVideoStats),r.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(X.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case H.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case H.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Bt?e.trackList.forEach(t=>{t.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(X.GET_STATS,this.handleGetLocalAudioStats),t.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(X.GET_STATS,this.handleGetLocalAudioStats),e.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof dl&&t.addListener(X.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof hl&&t.addListener(X.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(X.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(re.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(re.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,n)=>{var i;let o,{track:a,type:s}=r;switch(s){case H.LocalAudioTrack:o=Me.Audio;break;case H.LocalVideoTrack:o=q(i=a._hints).call(i,et.SCREEN_TRACK)?Me.Screen:Me.High;break;case H.LocalVideoLowTrack:o=Me.Low}return{kind:s===H.LocalAudioTrack?re.AUDIO:re.VIDEO,stream_type:o,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:a.muted||!a.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:a,id:s}]=t;switch(i){case H.LocalVideoTrack:n=q(r=o._hints).call(r,et.SCREEN_TRACK)?Me.Screen:Me.High;break;case H.LocalAudioTrack:n=Me.Audio;break;case H.LocalVideoLowTrack:n=Me.Low}return{stream_type:n,ssrcs:a,mid:s}})}assignLocalTracks(e,t){e.forEach((r,n)=>{let{track:i,type:o}=r;this.localTrackMap.set(o,{track:i,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(le.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),q(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await er(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),te.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:pt.TRACER}).onSuccess(),this.emit(le.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let n=Array.from(Tn(r=this.remoteUserMap).call(r)).find(o=>o._audioSSRC===t);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(ul.FIRST_FRAME_DECODED),te.firstRemoteFrame(this.store.sessionId,$t.FIRST_AUDIO_DECODE,st.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let n=Array.from(Tn(r=this.remoteUserMap).call(r)).find(i=>i._audioSSRC===t);n&&te.firstRemoteFrame(this.store.sessionId,$t.FIRST_AUDIO_RECEIVED,st.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,n)=>{this.reportVideoFirstFrameDecoded(t,r,n)},e.onFirstVideoReceived=t=>{var r;let n=Array.from(Tn(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===t);n&&te.firstRemoteFrame(this.store.sessionId,$t.FIRST_VIDEO_RECEIVED,st.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let n=t.candidateType==="relay",i=r.candidateType==="relay";r.candidateType!=="unknown"&&n===i||this.emit(le.ConnectionTypeChange,n),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Da(r))," -> ").concat(JSON.stringify(Da(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Da(r))," -> ").concat(JSON.stringify(Da(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(le.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===Ur.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,v.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ur.SEND_ONLY?this.restartICE(e):lr(this,le.RequestP2PRestartICE,{direction:Ur.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(H.LocalAudioTrack);if(e instanceof ht&&(r==null?void 0:r.track)instanceof Bt)return r.track.isActive||t.push([H.LocalAudioTrack,r]),t;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return e===o});if(n&&(t.push(n),n[0]===H.LocalVideoTrack)){let i=this.localTrackMap.get(H.LocalVideoLowTrack);i&&t.push([H.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(H.LocalAudioTrack);if(e instanceof ht&&(r==null?void 0:r.track)instanceof Bt)return r.track.isActive&&t.push([H.LocalAudioTrack,r]),t;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return e===o});if(n)if(n[0]===H.LocalVideoTrack){t.push(n);let i=this.localTrackMap.get(H.LocalVideoLowTrack);i&&t.push([H.LocalVideoLowTrack,i])}else t.push(n);return t}createMuteMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:a,id:s}]=t;switch(i){case H.LocalAudioTrack:n=Me.Audio;break;case H.LocalVideoTrack:n=q(r=o._hints).call(r,et.SCREEN_TRACK)?Me.Screen:Me.High;break;case H.LocalVideoLowTrack:n=Me.Low}return{stream_type:n,ssrcs:a,mid:s}})}createUnmuteMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:a,id:s}]=t;switch(i){case H.LocalAudioTrack:n=Me.Audio;break;case H.LocalVideoTrack:n=q(r=o._hints).call(r,et.SCREEN_TRACK)?Me.Screen:Me.High;break;case H.LocalVideoLowTrack:n=Me.Low}return{stream_type:n,ssrcs:a,mid:s}})}filterTobeUnSubscribedTracks(e,t){let r=[],n=this.remoteUserMap.get(e);if(!n)return r;if(t){let i=n.get(t);if(!i)return r;r.push([e,{kind:t,id:i}])}else Array.from(n.entries()).forEach(i=>{let[o,a]=i;r.push([e,{kind:o,id:a}])});return r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[n,{kind:i,id:o}]=r;switch(i){case re.VIDEO:return void(n._videoSSRC&&t.push({stream_type:re.VIDEO,ssrcId:n._videoSSRC}));case re.AUDIO:return void(n._audioSSRC&&t.push({stream_type:re.AUDIO,ssrcId:n._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:n}]=t,i=this.remoteUserMap.get(r);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(H.LocalVideoTrack),r=this.localTrackMap.get(H.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),r&&e.low_stream_uplink&&await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof ht){let r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;let n=this.createUnmuteMessage(r);return void await We(this,le.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(le.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(le.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await er(CR(this.dtlsFailedCount,Pt)),this.emit(le.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(H.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Xe)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Xe).length>1)throw new V(C.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof ht).length>1&&(e.some(t=>t instanceof ht&&t._bypassWebAudio)||!Pe().webAudioMediaStreamDest))throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof Xe&&this.pendingLocalTracks.some(r=>r instanceof Xe))throw new V(C.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof ht&&this.pendingLocalTracks.some(r=>r instanceof ht)&&(!Pe().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof ht&&r._bypassWebAudio)))throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!b("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pe().supportDualStreamEncoding,n=Op(Op({},{width:160,height:120,framerate:15,bitrate:50}),t),i;i=r?e._mediaStreamTrack.clone():kT(e,n);let o=Ke(8,"track-low-"),a=new Xe(i,Op(Op({},r&&{scaleResolutionDownBy:vT(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,o);return a.on(Fs.TRANSCEIVER_UPDATED,s=>{e._updateRtpTransceiver(s,Nl.LOW_STREAM)}),a._hints.push(et.LOW_STREAM),e.addListener(X.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,n){var i;let o=Array.from(Tn(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===e);if(o){n||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let a=this.store.keyMetrics,s=a.subscribe.find(c=>c.userId===o.uid&&c.type==="video");te.firstRemoteVideoDecode(this.store.sessionId,$t.FIRST_VIDEO_DECODE,st.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:r,subscribeElapse:fr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(s==null?void 0:s.subscribeEnd)||0,subscriberStart:(s==null?void 0:s.subscribeStart)||0,videoAddNotify:(s==null?void 0:s.streamAdded)||0,state:n?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;let n=this.remoteUserMap.get(e);if(!n)return!1;let i=n.get(t);if(!i)return!1;let o=await this.recvConnection.getRemoteSSRC(i);return o!==void 0&&o!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new V(C.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new V(C.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new V(C.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new V(C.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new V(C.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new V(C.NOT_SUPPORTED)}async preConnect(e){throw new V(C.NOT_SUPPORTED)}getEstablishParams(){throw new V(C.NOT_SUPPORTED)}async reSubscribe(e){throw new V(C.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new V(C.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===H.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Nl.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Z(tt.prototype,"p2pConnect",[YN],Object.getOwnPropertyDescriptor(tt.prototype,"p2pConnect"),tt.prototype),Z(tt.prototype,"unpublish",[$N],Object.getOwnPropertyDescriptor(tt.prototype,"unpublish"),tt.prototype),Z(tt.prototype,"unpublishLowStream",[qN],Object.getOwnPropertyDescriptor(tt.prototype,"unpublishLowStream"),tt.prototype),Z(tt.prototype,"subscribe",[XN],Object.getOwnPropertyDescriptor(tt.prototype,"subscribe"),tt.prototype),Z(tt.prototype,"mockSubscribe",[JN],Object.getOwnPropertyDescriptor(tt.prototype,"mockSubscribe"),tt.prototype),Z(tt.prototype,"unsubscribe",[QN],Object.getOwnPropertyDescriptor(tt.prototype,"unsubscribe"),tt.prototype),Z(tt.prototype,"muteRemote",[ZN],Object.getOwnPropertyDescriptor(tt.prototype,"muteRemote"),tt.prototype),Z(tt.prototype,"unmuteRemote",[eP],Object.getOwnPropertyDescriptor(tt.prototype,"unmuteRemote"),tt.prototype),Z(tt.prototype,"hasRemoteMediaWithLock",[tP],Object.getOwnPropertyDescriptor(tt.prototype,"hasRemoteMediaWithLock"),tt.prototype),Z(tt.prototype,"disconnectForReconnect",[rP],Object.getOwnPropertyDescriptor(tt.prototype,"disconnectForReconnect"),tt.prototype),Z(tt.prototype,"remoteMediaSsrcChanged",[nP],Object.getOwnPropertyDescriptor(tt.prototype,"remoteMediaSsrcChanged"),tt.prototype),tt);function ki(e){return function(t,r,n){let i=t[r];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];switch(e){case xi.SEND_ONLY:{let c=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,a)}finally{c()}}case xi.RECEIVE_ONLY:{let c=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,a)}finally{c()}}default:{let c=await this.sendMutex.lock("From P2PChannel2.".concat(r)),l=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,a)}finally{c(),l()}}}},n}}function oP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ps(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var HV=class MT{constructor(t){y(this,"store",void 0),y(this,"onStatsException",void 0),y(this,"onUploadPublishDuration",void 0),y(this,"onStatsChanged",void 0),y(this,"localStats",new Map),y(this,"remoteStats",new Map),y(this,"updateStatsInterval",void 0),y(this,"trafficStats",void 0),y(this,"trafficStatsPeerList",[]),y(this,"uplinkStats",void 0),y(this,"exceptionMonitor",void 0),y(this,"p2pChannel",void 0),y(this,"scalabilityMode",_T.L1T1),y(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new tJ,this.exceptionMonitor.on("exception",(r,n,i)=>{this.onStatsException&&this.onStatsException(r,n,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(H.LocalAudioTrack)||ps({},yT)}getLocalVideoTrackStats(){return this.localStats.get(H.LocalVideoTrack)||ps({},RT)}getRemoteAudioTrackStats(t){let r=(o,a)=>{if(!this.trafficStats)return a;let s=this.trafficStats.peer_delay.find(c=>c.peer_uid===o);return s&&(a.publishDuration=s.B_ppad+(Date.now()-this.trafficStats.timestamp)),a},n={};if(t){var i;let o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;o&&(n[t]=r(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{audioStats:s}]=o;s&&(n[a]=r(a,s))});return n}getRemoteNetworkQualityStats(t){let r={};if(t){var n;let i=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.networkStats;i&&(r[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[o,{networkStats:a}]=i;a&&(r[o]=a)});return r}getRemoteVideoTrackStats(t){let r=(o,a)=>{if(!this.trafficStats)return a;let s=this.trafficStats.peer_delay.find(c=>c.peer_uid===o);return s&&(a.publishDuration=s.B_ppvd+(Date.now()-this.trafficStats.timestamp)),a},n={};if(t){var i;let o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;o&&(n[t]=r(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{videoStats:s}]=o;s&&(n[a]=r(a,s))});return n}getRTCStats(){let t=0,r=0,n=0,i=0,o=this.localStats.get(H.LocalAudioTrack);o&&(t+=o.sendBytes,r+=o.sendBitrate);let a=this.localStats.get(H.LocalVideoTrack);a&&(t+=a.sendBytes,r+=a.sendBitrate);let s=this.localStats.get(H.LocalVideoLowTrack);s&&(t+=s.sendBytes,r+=s.sendBitrate),this.remoteStats.forEach(l=>{let{audioStats:u,videoStats:d}=l;u&&(n+=u.receiveBytes,i+=u.receiveBitrate),d&&(n+=d.receiveBytes,i+=d.receiveBitrate)});let c=1;return this.trafficStats&&(c+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c,SendBitrate:r,SendBytes:t,RecvBytes:n,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var n;let i=(n=this.p2pChannel)===null||n===void 0?void 0:n.getRemoteMedia(r.peer_uid),o=i!=null&&i.videoSSRC?fr.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,a=i!=null&&i.audioSSRC?fr.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,o>a?o:a),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,n){if(!t)return!1;let i=!!n&&r.framesDecodeFreezeTime>n.framesDecodeFreezeTime,o=!n||r.framesDecodeCount>n.framesDecodeCount;return i||!o}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[n,i]=r;switch(n){case H.LocalVideoTrack:case H.LocalVideoLowTrack:{let a=i,s=ps({},RT),c=t.getStats(),l=t.getLocalMedia(n);if(c){let u=c.videoSend.find(d=>d.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId));if(u){let d=t.getLocalVideoSize(),h=t.getEncoderConfig(H.LocalVideoTrack);u.codec!=="H264"&&u.codec!=="H265"&&u.codec!=="VP8"&&u.codec!=="VP9"&&u.codec!=="AV1X"&&u.codec!=="AV1"||(s.codecType=u.codec),s.sendBytes=u.bytes,s.sendBitrate=a?8*Math.max(0,s.sendBytes-a.sendBytes):0,u.inputFrame?(s.captureFrameRate=u.inputFrame.frameRate,s.captureResolutionHeight=u.inputFrame.height,s.captureResolutionWidth=u.inputFrame.width):d&&(s.captureResolutionWidth=d.width,s.captureResolutionHeight=d.height),u.sentFrame?(s.sendFrameRate=u.sentFrame.frameRate,s.sendResolutionHeight=u.sentFrame.height,s.sendResolutionWidth=u.sentFrame.width):d&&(s.sendResolutionWidth=d.width,s.sendResolutionHeight=d.height),u.avgEncodeMs&&(s.encodeDelay=u.avgEncodeMs),h&&h.bitrateMax&&(s.targetSendBitrate=1e3*h.bitrateMax),s.sendPackets=u.packets,s.sendPacketsLost=u.packetsLost,s.sendJitterMs=u.jitterMs,s.sendRttMs=u.rttMs,s.totalDuration=a?a.totalDuration+1:1,s.totalFreezeTime=a?a.totalFreezeTime:0,this.isLocalVideoFreeze(u)&&(s.totalFreezeTime+=1),u.scalabilityMode&&this.scalabilityMode!==u.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(u.scalabilityMode)),this.scalabilityMode=u.scalabilityMode)}this.trafficStats&&(s.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(n,s),((a==null?void 0:a.sendResolutionWidth)!==s.sendResolutionWidth||(a==null?void 0:a.sendResolutionHeight)!==s.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:s.sendResolutionWidth,height:s.sendResolutionHeight})),s&&l&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,l.track,s);break}case H.LocalAudioTrack:{let a=i,s=ps({},yT),c=t.getStats(),l=t.getLocalMedia(n);if(c){let u=c.audioSend.find(d=>d.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId));if(u){if(u.codec!=="opus"&&u.codec!=="aac"&&u.codec!=="PCMU"&&u.codec!=="PCMA"&&u.codec!=="G722"||(s.codecType=u.codec),u.inputLevel)s.sendVolumeLevel=Math.round(32767*u.inputLevel);else{let d=t.getLocalAudioVolume();d&&(s.sendVolumeLevel=Math.round(32767*d))}s.sendBytes=u.bytes,s.sendPackets=u.packets,s.sendPacketsLost=u.packetsLost,s.sendJitterMs=u.jitterMs,s.sendRttMs=u.rttMs,s.sendBitrate=a?8*Math.max(0,s.sendBytes-a.sendBytes):0}}this.trafficStats&&(s.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(H.LocalAudioTrack,s),s&&l&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,l.track,s);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var n,i;let[o,{videoStats:a,audioStats:s,videoPcStats:c}]=r,l=s,u=a,d=c,h=ps({},Zx),p=ps({},eV),m=ps({},DX),{audioTrack:f,videoTrack:_,audioSSRC:E,videoSSRC:g}=t.getRemoteMedia(o),T;T=t instanceof an?t.getStats(!0):t.getStats();let R=(n=T)===null||n===void 0?void 0:n.audioRecv.find(N=>N.ssrc===E),w=(i=T)===null||i===void 0?void 0:i.videoRecv.find(N=>N.ssrc===g),A=this.trafficStats&&this.trafficStats.peer_delay.find(N=>N.peer_uid===o);if(R&&(R.codec!=="opus"&&R.codec!=="aac"&&R.codec!=="PCMU"&&R.codec!=="PCMA"&&R.codec!=="G722"||(h.codecType=R.codec),R.outputLevel?h.receiveLevel=Math.round(32767*R.outputLevel):f&&(h.receiveLevel=Math.round(32767*f.getVolumeLevel())),h.receiveBytes=R.bytes,h.receivePackets=R.packets,h.receivePacketsLost=R.packetsLost,h.receivePacketsDiscarded=R.packetsDiscarded,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=l?l.totalFreezeTime:0,h.freezeRate=h.totalFreezeTime/h.totalDuration,h.receiveDelay=R.jitterBufferMs,h.totalDuration>10&&MT.isRemoteAudioFreeze(f)&&(h.totalFreezeTime+=1)),w){w.codec!=="H264"&&w.codec!=="H265"&&w.codec!=="VP8"&&w.codec!=="VP9"&&w.codec!=="AV1X"&&w.codec!=="AV1"||(p.codecType=w.codec),p.receiveBytes=w.bytes,p.receiveBitrate=u?8*Math.max(0,p.receiveBytes-u.receiveBytes):0,p.decodeFrameRate=w.decodeFrameRate<0?0:w.decodeFrameRate,p.renderFrameRate=w.decodeFrameRate<0?0:w.decodeFrameRate,w.outputFrame&&(p.renderFrameRate=w.outputFrame.frameRate),w.receivedFrame?(p.receiveFrameRate=w.receivedFrame.frameRate,p.receiveResolutionHeight=w.receivedFrame.height,p.receiveResolutionWidth=w.receivedFrame.width):_&&(p.receiveResolutionHeight=_._videoHeight||0,p.receiveResolutionWidth=_._videoWidth||0),w.framesRateFirefox!==void 0&&(p.receiveFrameRate=Math.round(w.framesRateFirefox)),p.receivePackets=w.packets,p.receivePacketsLost=w.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.totalDuration=u?u.totalDuration+1:1,p.totalFreezeTime=u?u.totalFreezeTime:0,p.receiveDelay=w.jitterBufferMs||0;let N=!!g&&t.getRemoteVideoIsReady(g);_&&N&&MT.isRemoteVideoFreeze(_,w,d)&&(p.totalFreezeTime+=1),p.freezeRate=p.totalFreezeTime/p.totalDuration}A&&(h.end2EndDelay=A.B_ad,p.end2EndDelay=A.B_vd,h.transportDelay=A.B_ed,p.transportDelay=A.B_ed,h.currentPacketLossRate=A.B_ealr4/100,p.currentPacketLossRate=A.B_evlr4/100,m.uplinkNetworkQuality=A.B_punq?A.B_punq:0,m.downlinkNetworkQuality=A.B_pdnq?A.B_pdnq:0),this.remoteStats.set(o,{audioStats:h,videoStats:p,videoPcStats:w,networkStats:m}),f&&this.exceptionMonitor.setRemoteAudioStats(f,h),_&&this.exceptionMonitor.setRemoteVideoStats(_,p)})}},KV=class{constructor(){y(this,"destChannelMediaInfos",new Map),y(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){sb(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){sb(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){v_(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}};function aP(e){if(!(e instanceof KV))return new M(C.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new M(C.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new M(C.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function sP(e){var t={},r=!1;function n(i,o){return r=!0,{done:!1,value:new HR(o=new PT(function(a){a(e[i](o))}),1)}}return t[zc!==void 0&&QU||"@@iterator"]=function(){return this},t.next=function(i){return r?(r=!1,i):n("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(r)throw r=!1,i;return n("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return r?(r=!1,i):n("return",i)}),t}var SJ=Tt(UV);function cP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function lP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ge;function uP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Np(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Cu=(Ge=class ju extends Bx{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return q(r=Object.keys(g_)).call(r,t)}))]}constructor(t,r){super(t,r),y(this,"store",void 0),y(this,"peerConnection",void 0),y(this,"remoteSDP",void 0),y(this,"initialOffer",void 0),y(this,"statsFilter",void 0),y(this,"useRTX",!1),y(this,"localCapabilities",void 0),y(this,"localCandidateCount",0),y(this,"allCandidatesReceived",!1),y(this,"establishPromise",void 0),y(this,"mutex",new _r("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(ju.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=zR(this.peerConnection,b("STATS_UPDATE_INTERVAL"),void 0,ft()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=ka(t.sdp),n=$d(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:b("FILTER_VIDEO_FEC"),filterAudioFec:b("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=t,Np(Np({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:t.sdp})}catch(t){throw new V(C.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(n){y(this,"sessionDesc",void 0),y(this,"localCapabilities",void 0),y(this,"rtpCapabilities",void 0),y(this,"candidates",void 0),y(this,"iceParameters",void 0),y(this,"dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname",void 0),n=Ct(n);let{iceParameters:i,dtlsParameters:o,candidates:a,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:u,cname:d}=n,h=Qt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=a,this.iceParameters=i,this.dtlsParameters=o,this.setup=c,this.localCapabilities=l,this.cname=d;for(let p=0;p<h.mediaDescriptions.length;p++){let m=h.mediaDescriptions[p];if(m.attributes.iceUfrag=i.iceUfrag,m.attributes.icePwd=i.icePwd,m.attributes.fingerprints=o.fingerprints,m.attributes.candidates=a,m.attributes.setup=c,m.media.mediaType==="video"){m.media.fmts=s.videoCodecs.map(_=>_.payloadType.toString(10));let f=s.videoCodecs.filter(_=>{var E,g;return(E=_.rtpMap)===null||E===void 0?void 0:q(g=E.encodingName.toLowerCase()).call(g,u)});f.length===0&&(f=s.videoCodecs),m.attributes.payloads=f,m.attributes.extmaps=s.videoExtensions}m.media.mediaType==="audio"&&(m.media.fmts=s.audioCodecs.map(f=>f.payloadType.toString(10)),m.attributes.payloads=s.audioCodecs,m.attributes.extmaps=s.audioExtensions),h.mediaDescriptions[p]=this.mungMediaDesc(m)}this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1}toString(){return Qt.print(this.sessionDesc)}send(n,i,o){let{ssrcs:a,ssrcGroups:s}=Ts(i,this.cname),c=this.sessionDesc.mediaDescriptions.find(d=>n===re.VIDEO?d.media.mediaType==="video":d.media.mediaType==="audio"),l=a[0].attributes.label,u=a[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(a),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:u}}batchSend(n){return n.map(i=>{let{kind:o,ssrcMsg:a}=i;return this.send(o,a,void 0)})}stopSending(n){this.sessionDesc.mediaDescriptions.forEach(i=>{let o=[],a=[],s=[];i.attributes.ssrcs.forEach(c=>{q(n).call(n,c.attributes.label||"")?s.push(c):o.push(c)}),i.attributes.ssrcGroups.forEach(c=>{var l;q(l=s.map(u=>u.ssrcId)).call(l,c.ssrcIds[0])||a.push(c)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=a})}mute(n){let i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){let i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(n,i,o){n.forEach((a,s)=>{let c=a._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(d=>d.attributes.mid===c.kind),u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],a);this.sessionDesc.mediaDescriptions[l]=u})}stopReceiving(n){}updateCandidates(n){n===dn.TCP?this.candidates.forEach(i=>{this.candidates.findIndex(o=>o.transport==="tcp"&&o.connectionAddress===i.connectionAddress&&o.port===i.port)===-1&&this.candidates.push(lP(lP({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this.candidates=this.candidates.filter(i=>i.transport!=="tcp");for(let i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(n){n=Ct(n),this.iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){let i=[];for(let o=0;o<n;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(n,i){let o=Ct(n);return Pl(o,i),FR(o,i),o}updateRecvMedia(n,i){let o=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===n);if(o!==-1){let a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=a}}bumpMid(n){this.currentMidIndex+=n}updateTrackLabel(n,i,o){let a=this.sessionDesc.mediaDescriptions.find(c=>n===re.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(a){let c=a.attributes.ssrcs.find(l=>l.attributes.label===i);var s;c&&(c.attributes.label=o,(s=c.attributes.msid)===null||s===void 0||s.replace(i,o))}}mungMediaDesc(n){let i=Ct(n);return VR(i),function(o){let a=o.attributes.extmaps.find(s=>s.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(a),1),o.attributes.payloads.forEach(s=>{let c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}(i),i}getSSRC(n){for(let i of this.sessionDesc.mediaDescriptions)for(let o of i.attributes.ssrcs)if(o.attributes.label===n)return[o]}}(Np(Np({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new V(C.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var n=this;return Ki(function*(){let i=yield De(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let o=t.map(h=>n.peerConnection.addTrack(h._mediaStreamTrack)),a=yield De(n.peerConnection.createOffer()),s=Qt.parse(a.sdp),c=t.map(h=>{let p=h._mediaStreamTrack,m=s.mediaDescriptions.find(f=>f.attributes.mid===p.kind);if(!m)throw new Error("Cannot extract ssrc from mediaDescription.");return function(f,_,E){let g=f.attributes.ssrcs.filter(R=>R.attributes.label===_),T=f.attributes.ssrcGroups;if(g.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(T&&g.length>1){let R=T.find(w=>w.ssrcIds.indexOf(g[0].ssrcId)!==-1);return R?[{ssrcId:R.ssrcIds[0],rtx:E?R.ssrcIds[1]:void 0}]:[{ssrcId:g[0].ssrcId}]}return[{ssrcId:g[0].ssrcId}]}(m,p.id,n.useRTX)}),l;try{l=yield c}catch(h){throw o.forEach(p=>{cr()&&p.replaceTrack(null),n.peerConnection.removeTrack(p)}),h}let u=n.mungSendOfferSDP(a.sdp,t);n.remoteSDP.receive(t,r,l);let d=n.remoteSDP.toString();return yield De(n.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield De(n.applySendEncodings(o,t)),yield De(n.peerConnection.setRemoteDescription({type:"answer",sdp:d})),t.map((h,p)=>{let m=h._mediaStreamTrack.id;return{localSSRC:c[p],id:m}})}catch(o){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getSenders().filter(o=>{var a;return t.indexOf(((a=o.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(o=>{cr()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(t);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:o,mslabel:a}=this.remoteSDP.send(t,r,i),s=new Y((u,d)=>{let h=setTimeout(()=>{d(new Error("Cannot receive track, id: ".concat(o)))},1e4),p=m=>{let f=Ne();if((f.name==="Safari"&&Number(f.version)===11||Vr())&&m.track.id!==o&&m.streams[0].id===a){var _;let E=m.streams[0].getTracks()[0];return(_=this.remoteSDP)===null||_===void 0||_.updateTrackLabel(t,o,m.track.id),this.peerConnection.removeEventListener("track",p),clearTimeout(h),void u(E)}if(m.track.id===o)return this.peerConnection.removeEventListener("track",p),clearTimeout(h),void u(m.track)};this.peerConnection.addEventListener("track",p)}),c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});let l=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(l),{track:await s,id:o}}catch(o){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(n=>{var i;return t.indexOf(((i=n.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(n=>{if(cr()&&n.track)n.track.enabled=!1;else{let i=n.getParameters();i.encodings.forEach(o=>o.active=!1),n.setParameters(i)}})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(o=>{var a;return t.indexOf(((a=o.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async o=>{if(cr()&&o.track)o.track.enabled=!0;else{let a=o.getParameters();a.encodings.forEach(s=>s.active=!0),await o.setParameters(a)}});let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Ki(function*(){let n=yield De(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Pe().supportPCSetConfiguration){let c=r.peerConnection.getConfiguration(),l=t===dn.RELAY?"relay":"all";c.iceTransportPolicy!==l&&(v.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(c.iceTransportPolicy,"] to [").concat(l,"]")),c.iceTransportPolicy=l,r.peerConnection.setConfiguration(c))}else if(t===dn.RELAY)return;t!==dn.RELAY&&r.remoteSDP.updateCandidates(t);let i=yield De(r.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=ka(i.sdp),{remoteIceParameters:a}=yield o.iceParameters;r.remoteSDP.restartICE(a);let s=r.remoteSDP.toString();yield De(r.peerConnection.setLocalDescription(i)),yield De(r.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(i){v.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);let o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new V(C.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){let n=this.peerConnection.getSenders().filter(i=>{var o;return((o=i.track)===null||o===void 0?void 0:o.id)===t});n.length===1&&await this.applySendEncodings(n,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let n=this.peerConnection.getSenders().find(i=>{var o;return((o=i.track)===null||o===void 0?void 0:o.id)===r});n&&await n.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new V(C.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new V(C.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},b("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(m_(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...ju.turnServerConfigToIceServers(t.turnServer.servers)),b("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...ju.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(n=>{n.security?n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var n;if(r||(r=this.peerConnection.getSenders().find(l=>{var u;return((u=l.track)===null||u===void 0?void 0:u.id)===t._mediaStreamTrack.id})),!r)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Pe().supportSetRtpSenderParameters)return v.warn("Browser not support set rtp-sender parameters");let i={},o={};if(t instanceof Xe)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(b("DSCP_TYPE")&&Ja()){var a;let l=b("DSCP_TYPE");q(a=["very-low","low","medium","high"]).call(a,l)&&(o.networkPriority=l)}let s=r.getParameters(),c=(n=s.encodings)===null||n===void 0?void 0:n[0];c&&Object.assign(c,o),Object.assign(s,i),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await r.setParameters(s)}async applySendEncodings(t,r){try{if(!Pe().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){let i=t[n],o=r[n];i&&o&&await this.updateRtpSenderEncodings(o,i)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){let n=Qt.parse(t);return r.forEach((i,o)=>{let a=i._mediaStreamTrack,s=n.mediaDescriptions.find(c=>c.attributes.mid===a.kind);s&&Pl(s,i)}),Qt.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let r=this.remoteSDP.batchSend(t).map((o,a)=>{let{id:s,mslabel:c}=o,{kind:l}=t[a];return new Y((u,d)=>{let h=setTimeout(()=>{d(new Error("Cannot receive track, id: ".concat(s)))},1e4),p=m=>{let f=Ne();if(f.name==="Safari"&&Number(f.version)===11&&m.track.id!==s&&m.streams[0].id===c){var _;let E=m.streams[0].getTracks()[0];return(_=this.remoteSDP)===null||_===void 0||_.updateTrackLabel(l,s,m.track.id),this.peerConnection.removeEventListener("track",p),clearTimeout(h),void u({track:E,id:s})}if(m.track.id===s)return this.peerConnection.removeEventListener("track",p),clearTimeout(h),void u({track:m.track,id:s})};this.peerConnection.addEventListener("track",p)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await Y.all(r)}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(Pe().supportPCSetConfiguration){let r=ju.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},Z(Ge.prototype,"connect",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"connect"),Ge.prototype),Z(Ge.prototype,"stopSending",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"stopSending"),Ge.prototype),Z(Ge.prototype,"receive",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"receive"),Ge.prototype),Z(Ge.prototype,"stopReceiving",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"stopReceiving"),Ge.prototype),Z(Ge.prototype,"muteRemote",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"muteRemote"),Ge.prototype),Z(Ge.prototype,"unmuteRemote",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"unmuteRemote"),Ge.prototype),Z(Ge.prototype,"muteLocal",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"muteLocal"),Ge.prototype),Z(Ge.prototype,"unmuteLocal",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"unmuteLocal"),Ge.prototype),Z(Ge.prototype,"close",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"close"),Ge.prototype),Z(Ge.prototype,"updateEncoderConfig",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"updateEncoderConfig"),Ge.prototype),Z(Ge.prototype,"updateSendParameters",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"updateSendParameters"),Ge.prototype),Z(Ge.prototype,"replaceTrack",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"replaceTrack"),Ge.prototype),Z(Ge.prototype,"getRemoteSSRC",[Un],Object.getOwnPropertyDescriptor(Ge.prototype,"getRemoteSSRC"),Ge.prototype),Ge);function Un(e,t,r){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let i=this.mutex,o=await i.lock("Locking from P2PConnection.".concat(t));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await n.apply(this,s)}finally{o()}},r}function dP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ha(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Iu="9",hP=4e4,TJ=class{get localCapabilities(){return Ct(this._localCapabilities)}get rtpCapabilities(){return Ct(this._rtpCapabilities)}get candidates(){return Ct(this._candidates)}get iceParameters(){return Ct(this._iceParameters)}get dtlsParameters(){return Ct(this._dtlsParameters)}constructor(e){y(this,"sessionDesc",void 0),y(this,"_localCapabilities",void 0),y(this,"_rtpCapabilities",void 0),y(this,"_candidates",void 0),y(this,"_iceParameters",void 0),y(this,"_dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname",void 0),y(this,"firefoxSsrcMidMap",new Map),e=Ct(e);let{iceParameters:t,dtlsParameters:r,candidates:n,rtpCapabilities:i,setup:o,localCapabilities:a,cname:s}=e;this._rtpCapabilities=i,this._candidates=n,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=a,this.setup=o,this.cname=s,this.sessionDesc=this.updateRemoteRTPCapabilities(i),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){let t=this.candidates,r=this.dtlsParameters,n=this.iceParameters,i=this.rtpCapabilities.send,o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){let s=2*a+2e4,c=2*a+hP,{ssrcs:l,ssrcGroups:u}=Ts([{ssrcId:s}],this.cname),{ssrcs:d,ssrcGroups:h}=Ts([{ssrcId:c,rtx:b("USE_SUB_RTX")?c+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Iu,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:n.iceUfrag,icePwd:n.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:h,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Iu,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:n.iceUfrag,icePwd:n.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Qt.print(this.sessionDesc)}send(e,t,r,n){let{ssrcs:i,ssrcGroups:o}=Ts(t,this.cname,b("SYNC_GROUP")?r:void 0),a=this.findPreloadMediaDesc(i);if(a){if(ft()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),n&&(n.twcc||n.remb)){let s=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[s]=this.mungSendMediaDesc(a,n),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{let s=this.findAvailableMediaIndex(e,i),c;return s===-1||s===1&&(cr()||function(){let l=Ne();return!(l.name!==Ue.CHROME||!l.osVersion)&&Number(l.version)<=90}())||s===0&&b("USE_SUB_RTX")||VA()?(c=this.createOrRecycleSendMedia(e,i,o,"sendonly",n),this.updateBundleMids()):(c=Ct(this.sessionDesc.mediaDescriptions[s]),c.attributes.direction="sendonly",c.attributes.ssrcs=i,c.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[s]=this.mungSendMediaDesc(c,n)),ft()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,c.attributes.mid),{mid:c.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(i=>{let{kind:o,ssrcMsg:a,mslabel:s}=i;return this.send(o,a,s)}),r=[],n=!1;return t.forEach(i=>{let{mid:o,needExchangeSDP:a}=i;a&&(n=!0),r.push(o)}),{mids:r,needExchangeSDP:n}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.mid==="0"||ft()||VA()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>q(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>q(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}receive(e,t,r,n){e.forEach((i,o)=>{this.createOrRecycleRecvMedia(i,[],"recvonly",t,r,n[o])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let t=this.sessionDesc||Qt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e;let r=this.rtpCapabilities.send,n=this.localCapabilities.send;for(let i of t.mediaDescriptions){if(i.attributes.iceUfrag=this._iceParameters.iceUfrag,i.attributes.icePwd=this._iceParameters.icePwd,i.attributes.fingerprints=this._dtlsParameters.fingerprints,i.attributes.candidates=this._candidates,i.attributes.setup=this.setup,i.media.mediaType==="application"&&(i.attributes.sctpPort="5000"),i.media.mediaType==="video"){if(r.videoCodecs.length===0){let o=n.videoCodecs.filter(a=>{var s,c;return(s=a.rtpMap)===null||s===void 0?void 0:q(c=s.encodingName.toLowerCase()).call(c,"vp8")})||[n.videoCodecs[0]];i.media.fmts=o.map(a=>a.payloadType.toString(10)),i.attributes.payloads=o,i.attributes.extmaps=[]}else if(i.media.fmts=r.videoCodecs.map(o=>o.payloadType.toString(10)),i.attributes.payloads=r.videoCodecs,i.attributes.extmaps=r.videoExtensions,b("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:o,ssrcGroups:a}=Ts([{ssrcId:hP,rtx:b("USE_SUB_RTX")?40001:void 0}],this.cname);i.attributes.ssrcs=o,i.attributes.ssrcGroups=a}}if(i.media.mediaType==="audio"){if(r.audioCodecs.length===0){let o=n.audioCodecs.filter(a=>{var s,c;return(s=a.rtpMap)===null||s===void 0?void 0:q(c=s.encodingName.toLowerCase()).call(c,"opus")})||[n.audioCodecs[0]];i.media.fmts=o.map(a=>a.payloadType.toString(10)),i.attributes.payloads=o,i.attributes.extmaps=[]}else if(i.media.fmts=r.audioCodecs.map(o=>o.payloadType.toString(10)),i.attributes.payloads=r.audioCodecs,i.attributes.extmaps=r.audioExtensions,Dl(i),b("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:o,ssrcGroups:a}=Ts([{ssrcId:2e4}],this.cname);i.attributes.ssrcs=o,i.attributes.ssrcGroups=a}}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){let t=this._candidates.filter(r=>r.transport==="udp");if(e===dn.TCP){if(t.length===0)return;if(b("TCP_CANDIDATE_ONLY")){let r=this._candidates.filter(n=>n.transport==="tcp");t.forEach(n=>{r.findIndex(i=>i.connectionAddress===n.connectionAddress)===-1&&r.push(ha(ha({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}),this._candidates=r}else{let r=[];t.forEach(n=>{r.push(ha(ha({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}),this._candidates=[...t,...r]}}else if(e===dn.RELAY){if(t.length!==0)return;{let r=this._candidates.filter(n=>n.transport==="tcp");r.forEach(n=>{t.push(ha(ha({},n),{},{foundation:"udpcandidate",priority:Number(n.priority)+1+"",transport:"udp",port:Number(n.port)-90+""}))}),this._candidates=[...t,...r]}}else t.length===0?(this._candidates.filter(r=>r.transport==="tcp").forEach(r=>{t.push(ha(ha({},r),{},{foundation:"udpcandidate",priority:Number(r.priority)+1+"",transport:"udp",port:Number(r.port)-90+""}))}),this._candidates=t):this._candidates=this._candidates.filter(r=>r.transport!=="tcp");for(let r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(e){e=Ct(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let n=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(ft()){if(n){let i=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(i||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!i||i!==r.attributes.mid)}return!1}return n})}createOrRecycleDataChannel(){for(let r of this.sessionDesc.mediaDescriptions)if(r.media.mediaType==="application")return{mediaDesc:r,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:Iu,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,r,n,i,o){let a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=ad(a,s,this.localCapabilities.send,a===re.VIDEO?n:i),l=a===re.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;let u="".concat(this.currentMidIndex),d={media:{mediaType:a,port:Iu,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungRecvMediaDsec(d,e,o);let h=this.findFirstClosedMedia(a);if(h){let p=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[p]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,r){let n=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(d=>d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").filter(d=>{var h;return q(h=Object.keys(g_)).call(h,d)}))],i=new Set(t);if(n.every(d=>i.has(d)))return v.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let o=this._rtpCapabilities.recv.videoCodecs.filter(d=>t.some(h=>{var p;return q(p=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(p,h)}));if(o.length===0)return v.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(n," codecs: ").concat(t)),!1;let a=[...new Set(o.map(d=>d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||""))],s;if(v.debug("updateRemoteCodec, from ".concat(n," to ").concat(a)),e.length===0)s=this.sessionDesc.mediaDescriptions.filter(d=>d.media.mediaType==="video"&&d.attributes.direction==="recvonly");else if(s=this.sessionDesc.mediaDescriptions.filter(d=>d.attributes.mid&&q(e).call(e,d.attributes.mid)&&d.attributes.direction==="recvonly"),s.length!==e.length)return v.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(b("USE_PUB_RTX")||b("USE_SUB_RTX")){let d=jR(o,this.rtpCapabilities.recv.videoCodecs);o.push(...d)}this._rtpCapabilities.recv.videoCodecs=o;let c=this.localCapabilities.send,l=this.rtpCapabilities.recv,u=ad(re.VIDEO,l,c,r);return s.forEach(d=>{let h=u.map(p=>p.payloadType.toString(10));v.debug("updateRemoteCodec mid: ".concat(d.attributes.mid,", from ").concat(d.attributes.payloads," to ").concat(u)),d.attributes.payloads=u,d.media.fmts=h}),!0}createOrRecycleSendMedia(e,t,r,n,i){let o=this.rtpCapabilities.send,a=e===re.VIDEO?o.videoCodecs:o.audioCodecs,s=e===re.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;let c="".concat(this.currentMidIndex),l={media:{mediaType:e,port:Iu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(d=>d.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,i);let u=this.findFirstClosedMedia(e);if(u){let d=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[d]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,r){let n=Ct(e);return VR(n),Pl(n,t),FR(n,t),AV(n),Em(n,r,this.localCapabilities.send),n}mungSendMediaDesc(e,t){let r=Ct(e);return Em(r,t,this.localCapabilities.recv),Dl(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===e);if(r!==-1){let n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=n}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>ft()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function pP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Vo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var sd=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),fl=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(fl||{}),vm=new Map;function fP(e,t,r,n){let{scale:i}=e;if(i===0&&n===fl.UP||i>=t.length-1&&n===fl.DOWN)return e;let o=Vo(Vo({},e),{},{scale:n===fl.DOWN?++i:--i});switch(r){case"maintain-framerate":o=Vo(Vo({},o),t[i].motion);break;case"maintain-resolution":o=Vo(Vo({},o),t[i].detail);break;case"balanced":o=Vo(Vo({},o),t[i].balanced)}return o}function zV(e,t){if(t){let r={overUse:0,underUse:0,adaptationList:YV(t)};vm.set(e,r)}else vm.delete(e)}function YV(e){let t=Vo({},e),{bitrateMax:r,frameRate:n,scaleResolutionDownBy:i,bitrateMin:o}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:u,BWE_SCALE_UP_THRESHOLD:d,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:m,BALANCE_BITRATE_FACTOR:f,BALANCE_FRAMERATE_FACTOR:_,BALANCE_RESOLUTION_FACTOR:E,MOTION_RESOLUTION_FACTOR:g,MOTION_BITRATE_FACTOR:T,DETAIL_FRAMERATE_FACTOR:R,DETAIL_BITRATE_FACTOR:w}=wR,A=Math.min(t.frameRate,s),N=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(p,1)*A),fps_up:n},balanced:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o}}];for(let P=1;P<=c;P++){let x={bwe_up:Math.round(Math.pow(d,P)*r),bwe_down:Math.round(Math.pow(h,P+1)*r),fps_up:Math.round(Math.pow(m,P)*A),fps_down:Math.round(Math.pow(p,P+1)*A)},G={scaleResolutionDownBy:i/Math.pow(E,P),frameRate:Math.max(Math.round(Math.pow(_,P)*n),a),bitrateMax:Math.max(Math.round(Math.pow(f,P)*r),u),bitrateMin:Math.max(Math.round(Math.pow(f,P)*o),l)},ne={scaleResolutionDownBy:i/Math.pow(g,P),frameRate:n,bitrateMax:Math.max(Math.round(Math.pow(T,P)*r),u),bitrateMin:Math.max(Math.round(Math.pow(T,P)*o),l)},z={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(R,P)*n),a),bitrateMax:Math.max(Math.round(Math.pow(w,P)*r),u),bitrateMin:Math.max(Math.round(Math.pow(w,P)*o),l)};N.push({scale:P,threshold:x,balanced:G,motion:ne,detail:z})}return N}function yJ(e,t,r,n,i,o){let a=vm.get(e)||{overUse:0,underUse:0,adaptationList:YV(i)},{adaptationList:s}=a;vm.set(e,a);let{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=wR,{scale:u}=n,d,h;return typeof t=="number"&&t>0&&function(p,m,f,_){if(m>=f.length)return!1;let{threshold:{fps_down:E}}=f[m];return b("FORCE_AG_HIGH_FRAMERATE")&&_==="maintain-framerate"&&(E=f[0].threshold.fps_down),p<E}(t,u,s,o)&&(a.overUse++,h=sd.CPU,a.overUse>c)||typeof r=="number"&&r>0&&function(p,m,f){if(m>=f.length)return!1;let{threshold:{bwe_down:_}}=f[m];return p<_}(r,u,s)&&(a.overUse++,h=sd.BANDWIDTH,a.overUse>c)?(a.overUse=0,a.underUse=0,d=fP(n,s,o,fl.DOWN),[d,h]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(p,m,f,_){if(m===0)return;let{threshold:{fps_up:E}}=f[m];return b("FORCE_AG_HIGH_FRAMERATE")&&_==="maintain-framerate"&&(E=f[1].threshold.fps_up),p>E}(t,u,s,o)&&function(p,m,f){if(m===0)return;let{threshold:{bwe_up:_}}=f[m];return p>_}(r,u,s)&&(a.underUse++,a.underUse>l&&(a.overUse=0,a.underUse=0,d=fP(n,s,o,fl.UP),d.scale===0&&(h=sd.NONE))),[d,h])}function mP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function iv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RJ(e){var t;return!!b("ENABLE_AG_ADAPTATION")&&!!(e instanceof wT||q(t=e._hints).call(t,et.CUSTOM_TRACK))&&(!!b("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r){let n=Ne();if(n.os!==Gt.IOS||!n.osVersion)return!1;let i=n.osVersion.split(".");return Number(i[0])>=r}(14)&&Rx(17,4)||yx(14)&&Cx(17,4)))}var Sm=new Map;function Pp(e,t){let r=Sm.get(e);if(r){let{timer:n}=r;window.clearTimeout(n),Sm.delete(e)}t.qualityLimitationReason=sd.NONE,zV(e)}var Ae;function _P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function oo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_P(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_P(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Li=(Ae=class Bu extends Bx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return q(r=Object.keys(g_)).call(r,t)}))]}constructor(t,r){super(t,r),y(this,"store",void 0),y(this,"peerConnection",void 0),y(this,"id",Ke(5,"connection-")),y(this,"remoteSDP",void 0),y(this,"initialOffer",void 0),y(this,"transportEventReceiver",void 0),y(this,"statsFilter",void 0),y(this,"extension",{useXR:b("USE_XR")}),y(this,"localCapabilities",void 0),y(this,"remoteCodecs",void 0),y(this,"localCandidateCount",0),y(this,"allCandidatesReceived",!1),y(this,"isPreallocation",!1),y(this,"preSSRCMap",new Map),y(this,"dataStreamChannelMap",new Map),y(this,"establishPromise",void 0),y(this,"recoveredDataChannelIds",[]),y(this,"currentDataChannelId",1),y(this,"mutex",new _r("P2PConnection-mutex")),y(this,"qualityLimitationReason",sd.NONE),this.store=r,this.peerConnection=new RTCPeerConnection(Bu.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=zR(this.peerConnection,b("STATS_UPDATE_INTERVAL"),void 0,ft()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){let r=this.preSSRCMap.get(t);if(r!==void 0){let n=this.peerConnection.getTransceivers().find(i=>i.mid===r);if(n)return{transceiver:n,track:n.receiver.track,id:r}}}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void v.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n);let o=this.remoteSDP.toString();i==null||i(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else v.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=ka(t.sdp),n=await OV({filterRTX:!b("USE_PUB_RTX")&&!b("USE_SUB_RTX"),filterVideoFec:b("FILTER_VIDEO_FEC"),filterAudioFec:b("FILTER_AUDIO_FEC"),filterVideoCodec:b("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=gm(n),this.initialOffer=t,oo(oo({},r),{},{rtpCapabilities:n,offerSDP:t.sdp})}catch(t){throw new V(C.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new TJ(oo(oo({},t),{},{localCapabilities:this.localCapabilities})),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let r=this.remoteSDP.toString(),n=NV(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(n||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),i==null||i(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});let o=this.peerConnection.getTransceivers()[0];if(o!=null&&o.receiver&&this.tryBindTransportEvents(o.receiver),b("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(b("PRELOAD_MEDIA_COUNT"));let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c)}let{preSSRCs:a}=t;if(Array.isArray(a)&&a.length>0){let{mids:s}=this.remoteSDP.batchSend(a.map(c=>({kind:c.kind,ssrcMsg:[{ssrcId:c.ssrcId,rtx:c.rtx}],mslabel:c.mslabel})));s.forEach((c,l)=>{this.preSSRCMap.set(a[l].ssrcId,c)}),await wp(this.peerConnection,this.remoteSDP,this.extension),v.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:r}=t;this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:n}=t;if(Array.isArray(n)&&n.length>0){let{mids:i}=this.remoteSDP.batchSend(n.map(o=>Object.assign({},{kind:o.kind,ssrcMsg:[{ssrcId:o.ssrcId,rtx:o.rtx}],mslabel:o.mslabel})));i.forEach((o,a)=>{this.preSSRCMap.set(n[a].ssrcId,o)})}await wp(this.peerConnection,this.remoteSDP,this.extension),v.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,n){var i=this;return Ki(function*(){let o=yield De(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let a=[];t.forEach(f=>{let _=i.peerConnection.addTransceiver(f._mediaStreamTrack,{direction:"sendonly"});a.push(_),f._updateRtpTransceiver(_)}),ft()&&b("SIMULCAST")===!0&&(yield De(i.applySimulcastForFirefox(a,t)));let s=yield De(i.peerConnection.createOffer()),c=i.remoteSDP.predictReceivingMids(t.length),l=i.mungSendOfferSDP(s.sdp,t,c),u=Qt.parse(l),d=c.map(f=>{let _=u.mediaDescriptions.find(E=>E.attributes.mid===f);if(!_)throw new Error("Cannot extract ssrc from mediaDescription.");return IV(_,b("USE_PUB_RTX"))}),h;try{h=yield d}catch(f){h=[],i.remoteSDP.receive(t,r,n,h);let _=i.remoteSDP.toString();throw yield De(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield De(i.peerConnection.setRemoteDescription({type:"answer",sdp:_})),yield De(i.stopSending(c,!0)),f}i.remoteSDP.receive(t,r,n,h);let p=i.remoteSDP.toString(),m=i.logSDPExchange(l,"offer","local","send");return yield De(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield De(i.applySimulcastEncodings(a,t)),yield De(i.applySendEncodings(a,t)),m==null||m(p),yield De(i.peerConnection.setRemoteDescription({type:"answer",sdp:p})),a.map((f,_)=>{let E=c[_];return{localSSRC:d[_],id:E,transceiver:f}})}catch(a){throw a instanceof V?a:new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(t);if(n&&n.readyState==="open")v.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:b("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,n)}r.forEach(o=>{o._updateOriginDataChannel(n)});let{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){let o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),v.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else v.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n){throw n instanceof V?n:new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n.toString()))}}async stopDataChannels(t){try{let r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof V?r:new V(C.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){let n=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(c=>t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(c=>{var l;Pp(this.id+c.mid,this),c.direction="inactive",(l=c.stop)===null||l===void 0||l.call(c)});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let s=this.remoteSDP.toString();a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,r,n,i);a&&(await wp(this.peerConnection,this.remoteSDP,this.extension),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let s=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:o,transceiver:s}}catch(o){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:r,needExchangeSDP:n}=this.remoteSDP.batchSend(t);return n&&(await wp(this.peerConnection,this.remoteSDP,this.extension),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(i=>{let o=this.peerConnection.getTransceivers().find(a=>a.mid===i);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:i,transceiver:o}})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(o=>{Array.from(this.preSSRCMap.entries()).some(a=>{let[s,c]=a;if(c===o)return this.preSSRCMap.delete(s),!0})}),this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();n==null||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();n==null||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();n==null||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(a=>{a.direction="inactive"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();i==null||i(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(a,s)=>{a.direction="sendonly"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t);let o=this.remoteSDP.toString();i==null||i(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new V(C.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Ki(function*(){let n=yield De(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Pe().supportPCSetConfiguration){let l=r.peerConnection.getConfiguration(),u=t===dn.RELAY?"relay":"all";l.iceTransportPolicy!==u&&(v.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(l.iceTransportPolicy,"] to [").concat(u,"]")),l.iceTransportPolicy=u,r.peerConnection.setConfiguration(l))}else if(t===dn.RELAY)return;r.remoteSDP.updateCandidates(t);let i=yield De(r.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=ka(i.sdp),{remoteIceParameters:a}=yield o.iceParameters;r.remoteSDP.restartICE(a);let s=r.remoteSDP.toString(),c=r.logSDPExchange(i.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield De(r.peerConnection.setLocalDescription(i)),c==null||c(s),yield De(r.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(i){v.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{Pp(this.id+r.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return oo(oo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let o=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new V(C.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){let n=this.peerConnection.getTransceivers().filter(i=>i.mid===t);n.length===1&&(this.isVP8Simulcast(r)?ft()||await this.applySimulcastEncodings(n,[r]):await this.applySendEncodings(n,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let n=this.peerConnection.getTransceivers().find(i=>i.mid===r);n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:n,remote:i}=r.getSelectedCandidatePair();return{local:oo(oo({},Co),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:oo(oo({},Co),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},b("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(m_(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Bu.turnServerConfigToIceServers(t.turnServer.servers)),b("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Bu.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),b("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(r.iceTransportPolicy="relay")}))),b("ENABLE_ENCODED_TRANSFORM")&&Pe().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(n=>{n.security?n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(Jc(n.turnServerURL),":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&!b("FORCE_TURN_TCP")&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(t){let r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var i;r!=null&&r.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,r.state))},r.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};let n=r.iceTransport;n&&(n.onstatechange=()=>{let i=r==null?void 0:r.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:i,remote:o}=n.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var n,i;if(r||(r=this.peerConnection.getSenders().find(f=>f.track===t._mediaStreamTrack)),!r)return v.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Pe().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let o={},a={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}let s=function(f,_){return f.getTransceivers().find(E=>E.sender.track===_||E.receiver.track===_)}(this.peerConnection,t._mediaStreamTrack),c=xX(t);if(RJ(t)&&s&&r&&c&&this.getLocalVideoStats&&q(n=["vp8","vp9"]).call(n,this.store.codec)){var l;let f=o.degradationPreference||(q(l=t._hints).call(l,et.CUSTOM_TRACK)?b("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(_,E,g,T,R,w){if(Pp(_,g),R(E),T!=="balanced"&&T!=="maintain-framerate"&&T!=="maintain-resolution")return;let A=-1;zV(_,E);let N=window.setInterval(()=>{let x=Sm.get(_);if(!b("ENABLE_AG_ADAPTATION")||!x)return Pp(_,g),void R(E);let G=w();if(G.sendPackets>0&&G.OutgoingAvailableBandwidth>0){if(A===-1)return void(A=Date.now());if(Date.now()-A<1e3)return;let ne=G.sendFrameRate,z=G.OutgoingAvailableBandwidth,[k,F]=yJ(_,ne,z,x.adaptationConfig,E,T);F&&(g.qualityLimitationReason=F),k&&x.adaptationConfig.scale!==k.scale&&(v.debug("[".concat(_,"] applyAdaptation: ").concat(g.qualityLimitationReason,`
           sendFps `).concat(ne,", bwe ").concat(z,", switch from ").concat(x.adaptationConfig.scale," to ").concat(k.scale," ")),x.adaptationConfig=iv(iv({},x.adaptationConfig),k),R(k))}},b("CHECK_LOCAL_STATS_INTERVAL")),P=iv({},E);Sm.set(_,{timer:N,adaptationConfig:P,originConfig:E,adaptationFunc:R}),v.debug("[".concat(_,"] start adaptation, originConfig: ").concat(JSON.stringify(E),", degradationPreference: ").concat(T))})(this.id+s.mid,c,this,f,_=>{r&&this.updateAdaptation(r,_)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var u;let{bitrateMax:f,frameRate:_,scaleResolutionDownBy:E}=t._encoderConfig;f&&(a.maxBitrate=1e3*f),(q(u=t._hints).call(u,et.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(_&&(a.maxFramerate=hn(_)),E&&E>=1&&(a.scaleResolutionDownBy=E))}let{maxFramerate:d}=b("ENCODER_CONFIG_LIMIT");if(d&&typeof d=="number"&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,d):d),b("DSCP_TYPE")&&Ja()){var h;let f=b("DSCP_TYPE");q(h=["very-low","low","medium","high"]).call(h,f)&&(a.networkPriority=f)}let p=r.getParameters(),m=(i=p.encodings)===null||i===void 0?void 0:i[0];ft()&&!m&&(o.encodings=[a]),m&&Object.assign(m,a),Object.assign(p,o),v.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await r.setParameters(p),await async function(f,_,E){try{var g;if(!Pe().supportSetRtpSenderParameters||!function(N){return N==="vp9"}(f)||!b("ENABLE_SVC"))return;let T={},R={},w=_.getParameters(),A=(g=w.encodings)===null||g===void 0?void 0:g[0];R.scalabilityMode=bT(E),A&&Object.assign(A,R),Object.assign(w,T),await _.setParameters(w),v.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(w.encodings)))}catch(T){v.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",T)}}(this.store.codec,r,b("SVC_MODE"))}async updateAdaptation(t,r){var n,i;if(!t)return v.debug("[updateAdaptation] no rtpSender found");if(!Pe().supportSetRtpSenderParameters)return v.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let o={},{bitrateMax:a,frameRate:s,scaleResolutionDownBy:c}=r;a&&(o.maxBitrate=1e3*a),s&&(o.maxFramerate=hn(s)),c&&c>=1&&q(n=["vp8","vp9"]).call(n,this.store.codec)&&(o.scaleResolutionDownBy=c);let l=t.getParameters(),u=(i=l.encodings)===null||i===void 0?void 0:i[0];u&&Object.assign(u,o),Object.assign(l,{});try{await t.setParameters(l),v.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(l.encodings)))}catch(d){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?v.debug("[updateAdaptation] peerConnection not connected}"):v.debug("[updateAdaptation] updateRtpSenderEncodings failed",d):v.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!Pe().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){let i=t[n],o=r[n];o instanceof Xe&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,i.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,n){let i=Qt.parse(t);return r.forEach((o,a)=>{let s=n[a],c=i.mediaDescriptions.find(l=>l.attributes.mid===s);c&&(Pl(c,o),bV(c,o,this.store.codec))}),Qt.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let c=0;c<t.length;c++){var n,i,o,a,s;let l=t[c],u=r[c];if(u instanceof Xe&&!q(n=u._hints).call(n,et.LOW_STREAM)&&(i=u._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=u._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=u._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((s=u._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1&&this.store.codec==="vp8"){let d={},h={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}];let p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,d))}}}async applySimulcastEncodings(t,r){if(!ft()&&t.length===r.length)for(let n=0;n<t.length;n++){let i=r[n];if(i instanceof Xe&&this.isVP8Simulcast(i)){let o=t[n],a={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];let c=o.sender.getParameters();await o.sender.setParameters(Object.assign(c,a))}}}isVP8Simulcast(t){var r,n,i,o,a;return!!(t instanceof Xe&&b("SIMULCAST")&&this.store.codec==="vp8"&&!q(r=t._hints).call(r,et.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,r,n,i){if(b("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(r," SDP during P2PConnection.").concat(i,`
`),t),r==="offer"?o=>{this.logSDPExchange(o,"answer",n==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(Pe().supportPCSetConfiguration){let r=Bu.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},Z(Ae.prototype,"updateRemoteRTPCapabilities",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"updateRemoteRTPCapabilities"),Ae.prototype),Z(Ae.prototype,"connect",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"connect"),Ae.prototype),Z(Ae.prototype,"updateRemoteConnect",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"updateRemoteConnect"),Ae.prototype),Z(Ae.prototype,"createDataChannels",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"createDataChannels"),Ae.prototype),Z(Ae.prototype,"receive",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"receive"),Ae.prototype),Z(Ae.prototype,"batchReceive",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"batchReceive"),Ae.prototype),Z(Ae.prototype,"stopReceiving",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"stopReceiving"),Ae.prototype),Z(Ae.prototype,"muteRemote",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"muteRemote"),Ae.prototype),Z(Ae.prototype,"unmuteRemote",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"unmuteRemote"),Ae.prototype),Z(Ae.prototype,"muteLocal",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"muteLocal"),Ae.prototype),Z(Ae.prototype,"unmuteLocal",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"unmuteLocal"),Ae.prototype),Z(Ae.prototype,"close",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"close"),Ae.prototype),Z(Ae.prototype,"updateEncoderConfig",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"updateEncoderConfig"),Ae.prototype),Z(Ae.prototype,"updateSendParameters",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"updateSendParameters"),Ae.prototype),Z(Ae.prototype,"replaceTrack",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"replaceTrack"),Ae.prototype),Z(Ae.prototype,"updateAdaptation",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"updateAdaptation"),Ae.prototype),Z(Ae.prototype,"getRemoteSSRC",[Gr],Object.getOwnPropertyDescriptor(Ae.prototype,"getRemoteSSRC"),Ae.prototype),Ae);function Gr(e,t,r){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let i=this.mutex,o=await i.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await n.apply(this,s)}finally{o()}},r}var Se;function EP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ao(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gP(e){var t,r,n,i=2;for(typeof Symbol<"u"&&(r=SJ,n=Symbol.iterator);i--;){if(r&&(t=e[r])!=null)return t.call(e);if(n&&(t=e[n])!=null)return new Cf(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Cf(e){function t(r){if(Object(r)!==r)return Y.reject(new TypeError(r+" is not an object."));var n=r.done;return Y.resolve(r.value).then(function(i){return{value:i,done:n}})}return Cf=function(r){this.s=r,this.n=r.next},Cf.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?Y.resolve({value:r,done:!0}):t(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?Y.reject(r):t(n.apply(this.s,arguments))}},new Cf(e)}var Dp=(Se=class extends lt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(le.StateChange,t,this._state)}constructor(e,t){super(),y(this,"isPlanB",void 0),y(this,"store",void 0),y(this,"statsUploader",void 0),y(this,"connection",void 0),y(this,"localTrackMap",new Map),y(this,"remoteUserMap",new Map),y(this,"localDataChannels",[]),y(this,"remoteDataChannelMap",new Map),y(this,"pendingLocalTracks",[]),y(this,"pendingRemoteTracks",[]),y(this,"pendingLocalDataChannels",[]),y(this,"pendingRemoteDataChannels",[]),y(this,"statsCollector",void 0),y(this,"shouldForwardP2PCreation",void 0),y(this,"iceFailedCount",0),y(this,"dtlsFailedCount",0),y(this,"mutex",new _r("P2PChannel-mutex")),y(this,"_state",Le.Disconnected),y(this,"_pcStatsUploadType",b("NEW_ICE_RESTART")?Po.FIRST_CONNECTION:Po.OLD_FIRST_CONNECTION),y(this,"_isInRestartIce",!1),y(this,"_isStartRestartIce",!1),y(this,"_restartStates",["disconnected","failed"]),y(this,"_restartTimer",void 0),y(this,"_isFirstConnected",!0),y(this,"handleMuteLocalTrack",async(r,n,i)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Le.Connected)return void i(new V(C.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let a=this.filterTobeMutedTracks(r);if(a.length===0)return void n();let s=a.find(l=>l[0]==="videoLowTrack");s&&s[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(a.map(l=>{let[,{id:u}]=l;return u}));let c=this.createMuteMessage(a);await We(this,le.RequestMuteLocal,c),n()}catch(a){i(a)}finally{o()}}),y(this,"handleUnmuteLocalTrack",async(r,n,i)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Le.Connected)return void i(new V(C.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let a=this.filterTobeUnmutedTracks(r);if(a.length===0)return void n();let s=a.find(l=>l[0]==="videoLowTrack");if(s){let l=s[1];if(l.track._originMediaStreamTrack.stop(),!b("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pe().supportDualStreamEncoding){let u=r._mediaStreamTrack.clone();l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u}else{let u=kT(r,Wd(this,le.RequestLowStreamParameter));l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u}await new Y((u,d)=>{this.handleReplaceTrack(l.track,u,d,!0)})}await this.connection.unmuteLocal(a.map(l=>{let[,{id:u}]=l;return u}));let c=this.createUnmuteMessage(a);await We(this,le.RequestUnmuteLocal,c),n()}catch(a){i(a)}finally{o()}}),y(this,"handleUpdateVideoEncoder",async(r,n,i)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let a=this.localTrackMap.get(H.LocalVideoTrack);if(!this.connection||!a||a.track!==r||this.state!==Le.Connected)return void n();let{id:s,track:c}=a;await this.connection.updateSendParameters(s,c),await this.connection.updateEncoderConfig(s,c),this.emit(le.UpdateVideoEncoder,c),n()}catch(a){i(a)}finally{o()}}),y(this,"handleUpdateVideoSendParameters",async(r,n,i)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let a=this.localTrackMap.get(H.LocalVideoTrack);if(!this.connection||!a||a.track!==r||this.state!==Le.Connected)return void n();let{id:s,track:c}=a;await this.connection.updateSendParameters(s,c),n()}catch(a){i(a)}finally{o()}}),y(this,"handleReplaceMixingTrack",async(r,n,i,o)=>{if(!this.connection||this.state!==Le.Connected)return void n();let a=nv([r]),s;v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(a.getTrackId(),"]")),typeof o=="boolean"&&o||(s=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,a),n()}catch(l){i(l)}finally{var c;(c=s)===null||c===void 0||c()}}),y(this,"handleReplaceTrack",async(r,n,i,o)=>{let a;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof o=="boolean"&&o||(a=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var s;let l=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:d}]=u;return r===d});if(!this.connection||!l||this.state!==Le.Connected)return void n();if(await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,l[1].id)),this.isPlanB){let u=l[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(l[0],u)}if(l[0]===H.LocalVideoTrack&&!b("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pe().supportDualStreamEncoding){let u=this.localTrackMap.get(H.LocalVideoLowTrack);if(u){let d=r._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=d,u.track._originMediaStreamTrack=d,await new Y((h,p)=>{this.handleReplaceTrack(u.track,h,p,!0)})}}n()}catch(l){i(l)}finally{var c;(c=a)===null||c===void 0||c()}}),y(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),y(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),y(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),y(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),y(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new WV(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Pe().supportUnifiedPlan||b("CHROME_FORCE_PLAN_B")&&Ja(),this.shouldForwardP2PCreation=b("FORWARD_P2P_CREATION")&&Pe().supportPCSetConfiguration&&yR(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Cu({},this.store):new Li({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=Le.New;let r=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new Cu(e,this.store):new Li(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new V(C.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=b("NEW_ICE_RESTART")?Po.FIRST_CONNECTION:Po.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new V(C.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");b("ENABLE_PREALLOC_PC")&&this.state===Le.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Le.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(i=>{var o;let[a]=i;return q(o=[H.LocalVideoLowTrack,H.LocalVideoTrack]).call(o,a)}),r=t.map(i=>{let[,{id:o}]=i;return o}),n=t.map(i=>{let[o]=i;return o});if(this.connection instanceof Li){if(te.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!q(e).call(e,this.store.codec)){let i=["vp9","vp8","h264"].find(o=>q(e).call(e,o));i&&(this.store.codec=i,v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof Li&&this.connection.peerConnectionState!=="closed"&&q(e=[Le.New,Le.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Le.Connected){if(this.state===Le.Disconnected)throw new V(C.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var n;q(n=this.pendingLocalDataChannels).call(n,r)||this.pendingLocalDataChannels.push(r)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{let n=Date.now();this.store.publish(r.id.toString(),"datachannel",n)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);let n=Date.now();this.store.publish(r.id+"","datachannel",void 0,n)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var n=this;return Ki(function*(){let i=yield De(n.mutex.lock("From P2PChannel.publish"));try{if(!n.connection||n.state!==Le.Connected){if(n.state===Le.Disconnected)throw new V(C.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n.throwIfTrackTypeNotMatch(e);let a=e.filter(s=>n.pendingLocalTracks.indexOf(s)===-1);return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(a))}n.store.pubId=n.store.pubId+1,fr.markPublishStart(n.store.clientId,n.store.pubId);let o=n.filterTobePublishedTracks(e,t,r);if(o.length===0)return void(yield De(n.tryToUnmuteAudio(e)));yield*sP(gP(n.doPublish(n.connection,o)))}finally{i()}})()}doPublish(e,t){var r=this;return Ki(function*(){t.forEach(d=>{let{track:h,type:p}=d,m=Date.now();r.store.publish(h.getTrackId(),p===H.LocalAudioTrack?"audio":"video",m)}),r.bindLocalTrackEvents(t);let n=t.map(d=>{let{track:h}=d;return h}),i=yield De(e.send(t.map(d=>{let{track:h}=d;return h}),r.store.codec,r.store.audioCodec)),o=(yield De(i.next())).value,a=r.createGatewayPublishMessage(t,o),s;try{s=yield a}catch(d){throw i.throw(d),(d==null?void 0:d.code)===C.WS_ABORT&&t.forEach(h=>{let{track:p}=h;r.pendingLocalTracks.indexOf(p)===-1&&r.pendingLocalTracks.push(p)}),r.unbindLocalTrackEvents(t),d}let c=r.mapPubResToRemoteConfig(a,s),l=(yield De(i.next(c))).value,u=b("ENABLE_VIDEO_SEI");n.forEach(async d=>{let h=d.getRTCRtpTransceiver();h&&u&&(d.trackMediaType===re.VIDEO?await WX(h.sender,d):d.trackMediaType===re.AUDIO&&await async function(p){if(!Pe().supportWebRTCEncodedTransform)return void v.warning("browser not support audio encoded transform");if(Rp.has(p)||!p.track)return;let m={track:p.track};if(Wa()){if(!p.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let _=null;try{_=p.createEncodedStreams()}catch(g){return void v.error("create audio-encoded-streams error",g&&g.message)}let E=new TransformStream({transform(g,T){m.controller||(m.controller=T),p.track&&p.track.id!==m.track.id&&(v.debug("audio track changed: ".concat(m.track.id," => ").concat(p.track.id)),m.track.removeEventListener("ended",f),m.track=p.track,m.track.addEventListener("ended",f)),T.enqueue(g)}});_.readable.pipeThrough(E).pipeTo(_.writable)}else if(cr()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");let _=Tf(),E=new MessageChannel;await new Y(T=>_.onmessage=R=>{R.data==="registered"&&T(void 0)});let g=new RTCRtpScriptTransform(_,{name:"tx",port:E.port2},[E.port2]);p.transform=g,await new Y(T=>_.onmessage=R=>{R.data==="started"&&T(void 0)}),E.port1.onmessage=T=>{var R;T.data.transformed&&p.track&&((R=p.track)===null||R===void 0?void 0:R.id)!==m.track.id&&(v.debug("audio track changed: ".concat(m.track.id," => ").concat(p.track.id)),m.track.removeEventListener("ended",f),m.track=p.track,m.track.addEventListener("ended",f))},m.worker=_}function f(){if(p.track){if(this.id!==p.track.id)return;p.track.removeEventListener("ended",f)}let _=Rp.get(p);if(_){Rp.delete(p);try{var E,g;(E=_.controller)===null||E===void 0||E.terminate(),(g=_.worker)===null||g===void 0||g.terminate()}catch(T){v.warning(T&&T.message)}}}Rp.set(p,m),p.track.addEventListener("ended",f)}(h.sender))}),t.forEach(d=>{let{type:h}=d;r.statsCollector.addLocalStats(h)}),r.assignLocalTracks(t,l),r.statsUploader.startUploadOutboundStats(),t.forEach(d=>{let{track:h,type:p}=d,m=Date.now();r.store.publish(h.getTrackId(),p===H.LocalAudioTrack?"audio":"video",void 0,m)})})()}async updateVideoStreamParameter(e,t){let r=this.localTrackMap.get(t);if(!r)return;if(!(r.track instanceof Xe))return v.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Li||this.connection instanceof Cu))return v.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:n}=r,i=function(o,a){let s={};return o.height&&o.width&&(s.scaleResolutionDownBy=vT(o,a)),s.maxFramerate=o.framerate?hn(o.framerate):void 0,s.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,s}(e,n);if(n._encoderConfig||(n._encoderConfig={}),t!==H.LocalVideoLowTrack||!b("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pe().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(n._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{let o=n._originMediaStreamTrack;if(!o.canvas)return v.warn("[".concat(n.getTrackId(),"] no canvas on track"));(function(a,s){let c=a.canvas;s.width&&(c.width=hn(s.width)),s.height&&(c.height=hn(s.height)),s.framerate&&(c.stopCapture&&c.stopCapture(),c.stopCapture=MR(()=>{!c.startCapture&&c.stopCapture&&c.stopCapture(),c.startCapture&&c.startCapture()},hn(s.framerate)))})(o,e)}i.maxBitrate!=null&&(n._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(n._encoderConfig.frameRate&&typeof n._encoderConfig.frameRate=="object"?n._encoderConfig.frameRate.max=i.maxFramerate:n._encoderConfig.frameRate={max:i.maxFramerate}),v.debug("[".concat(n.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n._encoderConfig))),await this.connection.updateRtpSenderEncodings(n)}publishLowStream(e){var t=this;return Ki(function*(){if(!t.connection||t.state!==Le.Connected)return;let r=yield De(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let i=t.localTrackMap.get(H.LocalVideoTrack);if(!i)throw new V(C.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(H.LocalVideoLowTrack))throw new V(C.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let o=[{track:t.getLowVideoTrack(i.track,e),type:H.LocalVideoLowTrack}];if(yield*sP(gP(t.doPublish(t.connection,o))),i.track.muted||!i.track.enabled){var n;let a=(n=t.localTrackMap.get(H.LocalVideoLowTrack))===null||n===void 0?void 0:n.id;a!==void 0&&(yield De(t.connection.muteLocal([a])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await lr(this,le.RequestRePublish,this.pendingLocalTracks),this.emit(le.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(v.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await lr(this,le.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:r,kind:n}=this.pendingRemoteTracks[t];(n!==re.AUDIO||r._audio_added_&&r._audioSSRC)&&(n!==re.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await lr(this,le.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===re.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(le.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Le.Connected)return void e.forEach(n=>{let i=this.pendingLocalTracks.indexOf(n);i!==-1&&this.pendingLocalTracks.splice(i,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(n=>n[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Le.Connected)return void e.forEach(r=>{let n=this.pendingLocalDataChannels.indexOf(r);n!==-1&&this.pendingLocalDataChannels.splice(n,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{let n=this.localDataChannels.indexOf(r);n!==-1&&this.localDataChannels.splice(n,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Le.Connected)return;let e=this.localTrackMap.get(H.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[H.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(n=>{let[,{id:i}]=n;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(n=>{let[i,{track:o}]=n;return{type:i,track:o}})),t.forEach(n=>{let[i]=n;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Le.Connected)throw new V(C.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r=t.filter(n=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(n.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(n=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(n.id,n):this.remoteDataChannelMap.set(e,new Map([[n.id,n]]));let o=this.pendingRemoteDataChannels.findIndex(a=>{let{user:s,id:c}=a;return s.uid===e.uid&&c===n.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),r.map(n=>n.id)}async subscribe(e,t,r,n,i){var o;if(!this.connection||this.state!==Le.Connected)throw new V(C.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;let a,s,c,l=this.connection.getPreMedia(r);if(l)v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),c=l.transceiver,a=l.track,s=l.id;else if(i){let h=i.find(m=>{let{stream_type:f}=m;return f===t});if(!h)throw new V(C.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let p=await this.connection.receive(t,h.ssrcs,String(e._uintid),h.attributes);this.connection instanceof Li&&(c=p.transceiver),a=p.track,s=p.id}else{let h=await this.connection.receive(t,[{ssrcId:r,rtx:n}],String(e._uintid),void 0);this.connection instanceof Li&&(c=h.transceiver),a=h.track,s=h.id}t===re.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new hl(a,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new dl(a,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),b("ENABLE_VIDEO_SEI")&&c&&(t==re.VIDEO?await async function(h){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Pe().supportWebRTCEncodedTransform)return void v.warning("browser not support video encoded transform");if(!h.track)return;if(Ru.has(h)){let _=Ru.get(h);return void(_&&(_.onSei=p.onSei))}let m={track:h.track,onSei:p.onSei};if(Wa()){if(!h.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let _=null;try{_=h.createEncodedStreams()}catch(g){return void v.error("create video-encoded-streams error",g&&g.message)}let E=new TransformStream({transform(g,T){m.controller||(m.controller=T),h.track&&h.track.id!==m.track.id&&(v.debug("video track changed: ".concat(m.track.id," => ").concat(h.track.id)),m.track.removeEventListener("ended",f),m.track=h.track,m.track.addEventListener("ended",f));let R=function(w){let A=new DataView(w.data),N=0;for(;N+4<w.data.byteLength;){if(A.getUint8(N+0)===0&&A.getUint8(N+1)===0&&A.getUint8(N+2)===0&&A.getUint8(N+3)===1&&A.getUint8(N+4)===6){let P=N+6,x=0,G=0;for(;(G=A.getUint8(P++))===255;)x+=255;x+=G;let ne=GX(w.data,P,x);return new Uint8Array(ne)}N++}return null}(g);R&&m.onSei&&m.onSei(R),T.enqueue(g)}});_.readable.pipeThrough(E).pipeTo(_.writable)}else if(cr()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");let _=Tf(),E=new MessageChannel;await new Y(T=>_.onmessage=R=>{R.data==="registered"&&T(void 0)});let g=new RTCRtpScriptTransform(_,{name:"rx",port:E.port2},[E.port2]);h.transform=g,await new Y(T=>_.onmessage=R=>{R.data==="started"&&T(void 0)}),E.port1.onmessage=T=>{var R;T.data.transformed&&h.track&&((R=h.track)===null||R===void 0?void 0:R.id)!==m.track.id?(v.debug("video track changed: ".concat(m.track.id," => ").concat(h.track.id)),m.track.removeEventListener("ended",f),m.track=h.track,m.track.addEventListener("ended",f)):T.data.sei&&m.onSei&&m.onSei(T.data.sei)},m.worker=_}function f(){if(h.track){if(this.id!==h.track.id)return;h.track.removeEventListener("ended",f)}(function(_){let E=Ru.get(_);if(E){Ru.delete(_);try{var g,T;(g=E.controller)===null||g===void 0||g.terminate(),(T=E.worker)===null||T===void 0||T.terminate()}catch(R){v.warning(R&&R.message)}}})(h)}Ru.set(h,m),h.track.addEventListener("ended",f)}(c.receiver,{onSei:h=>{var p;(p=e._videoTrack)===null||p===void 0||p._onSei(h)}}):t==re.AUDIO&&await async function(h){if(!Pe().supportWebRTCEncodedTransform)return void v.warning("browser not support audio encoded transform");if(Cp.has(h))return;let p={track:h.track};if(Wa()){if(!h.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let f=null;try{f=h.createEncodedStreams()}catch(E){return void v.error("create audio-encoded-streams error",E&&E.message)}let _=new TransformStream({transform(E,g){p.controller||(p.controller=g),h.track&&h.track.id!==p.track.id&&(v.debug("audio track changed: ".concat(p.track.id," => ").concat(h.track.id)),p.track.removeEventListener("ended",m),p.track=h.track,p.track.addEventListener("ended",m)),g.enqueue(E)}});f.readable.pipeThrough(_).pipeTo(f.writable)}else if(cr()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");let f=Tf(),_=new MessageChannel;await new Y(g=>f.onmessage=T=>{T.data==="registered"&&g(void 0)});let E=new RTCRtpScriptTransform(f,{name:"rx",port:_.port2},[_.port2]);h.transform=E,await new Y(g=>f.onmessage=T=>{T.data==="started"&&g(void 0)}),_.port1.onmessage=g=>{var T;g.data.transformed&&h.track&&((T=h.track)===null||T===void 0?void 0:T.id)!==p.track.id&&(v.debug("audio track changed: ".concat(p.track.id," => ").concat(h.track.id)),p.track.removeEventListener("ended",m),p.track=h.track,p.track.addEventListener("ended",m))},p.worker=f}function m(){h.track.removeEventListener("ended",m),function(f){let _=Cp.get(f);if(_){Cp.delete(f);try{var E,g;(E=_.controller)===null||E===void 0||E.terminate(),(g=_.worker)===null||g===void 0||g.terminate()}catch(T){v.warning(T&&T.message)}}}(h)}Cp.set(h,p),h.track.addEventListener("ended",m)}(c.receiver));let u=this.remoteUserMap.get(e);u?u.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let d=this.pendingRemoteTracks.findIndex(h=>{let{user:p,kind:m}=h;return p.uid===e.uid&&t===m});d!==-1&&(this.pendingRemoteTracks.splice(d,1),this.emit(le.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Le.Connected)throw new V(C.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var o;let{user:a,mediaType:s}=i;return!((o=this.remoteUserMap.get(a))!==null&&o!==void 0&&o.has(s))});let t=[],r=new Map;e.forEach(i=>{if(!this.connection)return;let o=this.connection.getPreMedia(i.ssrcId);o?r.set(i.ssrcId,o):t.push(i)});let n=await this.connection.batchReceive(t.map(i=>{let{user:o,mediaType:a,ssrcId:s,rtxSsrcId:c}=i;return{kind:a,ssrcMsg:[{ssrcId:s,rtx:c}],mslabel:String(o._uintid)}}));t.forEach((i,o)=>{r.set(i.ssrcId,n[o])}),e.forEach(i=>{let{user:o,mediaType:a,ssrcId:s}=i,c=r.get(s);if(!c)return void v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(a,", ").concat(s));let{track:l,id:u,transceiver:d}=c;a===re.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(l):(o._audioTrack=new hl(l,o.uid,o._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),d&&o._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(l):(o._videoTrack=new dl(l,o.uid,o._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),d&&o._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(o,o._videoTrack));let h=this.remoteUserMap.get(o);h?h.set(a,u):this.remoteUserMap.set(o,new Map([[a,u]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();let p=this.pendingRemoteTracks.findIndex(m=>{let{user:f,kind:_}=m;return f.uid===o.uid&&a===_});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(le.MediaReconnectEnd,o.uid))})}async unsubscribe(e,t,r){let n=this.pendingRemoteTracks.filter(a=>{let{user:s,kind:c}=a;return t!==void 0?s.uid===e.uid&&t===c:s.uid===e.uid});if(n.forEach(a=>{let s=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(s,1)}),this.connection&&this.state===Le.Connected||r||n.forEach(a=>{let{kind:s}=a;var c;if(s===re.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(s===re.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Le.Connected)return;let i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(a=>{let[,{id:s}]=a;return s}));let o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(a=>{let[s,{kind:c}]=a;var l,u;if(c===re.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===re.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),r||((u=s._videoTrack)===null||u===void 0||u._destroy(),s._videoTrack=void 0);else if(c===re.AUDIO){var d;this.unbindRemoteTrackEvents(s._audioTrack),!r&&((d=s._audioTrack)===null||d===void 0||d._destroy(),s._audioTrack=void 0)}}),o}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{let o=this.pendingRemoteDataChannels.findIndex(a=>a.id===i.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;let r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(i=>{i._close()});let n=this.remoteDataChannelMap.get(e);return r.forEach(i=>{n&&n.delete(i.id)}),n&&n.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:i,mediaType:o}of e){let a=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return o!==void 0?c.uid===i.uid&&o===l:c.uid===i.uid});a.forEach(s=>{let c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),t=t.concat(a)}if(!this.connection||this.state!==Le.Connected)return void t.forEach(i=>{let{user:o,kind:a}=i;var s;if(a===re.AUDIO)(s=o._audioTrack)===null||s===void 0||s._destroy(),o._audioTrack=void 0;else if(a===re.VIDEO){var c;(c=o._videoTrack)===null||c===void 0||c._destroy(),o._videoTrack=void 0}});let r=qi(e).call(e,(i,o)=>{let{user:a,mediaType:s}=o,c=this.filterTobeUnSubscribedTracks(a,s);return i.concat(c)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(i=>{let[,{id:o}]=i;return o}));let n=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(i=>{let[o,{kind:a}]=i;var s,c;if(a===re.VIDEO&&o._videoSSRC&&((s=this.connection)===null||s===void 0||s.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===re.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(c=o._videoTrack)===null||c===void 0||c._destroy(),o._videoTrack=void 0;else if(a===re.AUDIO){var l;this.unbindRemoteTrackEvents(o._audioTrack),(l=o._audioTrack)===null||l===void 0||l._destroy(),o._audioTrack=void 0}}),n}isPreSubScribe(e){return!this.connection||this.state!==Le.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let n=t===re.VIDEO?e._videoSSRC:e._audioSSRC;n!==void 0&&this.connection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(H.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Bt){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==H.LocalAudioTrack}).filter(n=>{let[i]=n;return!(e&&i===H.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return!(e&&n===H.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,n,i){if(e){let a=this.localTrackMap.get(H.LocalAudioTrack),s=n?this.localTrackMap.get(H.LocalVideoLowTrack):this.localTrackMap.get(H.LocalVideoTrack);te.publish(this.store.sessionId,{eventElapse:fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:s==null?void 0:s.track.getTrackLabel(),screenshare:(s==null?void 0:s.track._hints.indexOf(et.SCREEN_TRACK))!==-1,audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;r||(r=[]);let a=r.find(c=>c instanceof ht),s=n?(o=this.localTrackMap.get(H.LocalVideoTrack))===null||o===void 0?void 0:o.track:r.find(c=>c instanceof Xe);te.publish(this.store.sessionId,{eventElapse:fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:s==null?void 0:s.getTrackLabel(),screenshare:(s==null?void 0:s._hints.indexOf(et.SCREEN_TRACK))!==-1,audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,r,n){let i=n===re.VIDEO?r._videoSSRC:r._audioSSRC;i&&te.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===re.VIDEO,audio:n===re.AUDIO,peerid:r.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:fr.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new _r("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Cu({},this.store):new Li({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(H.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Bt){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Le.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(H.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(H.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof Xe||t&&t.track instanceof ht?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(Tn(t=this.remoteUserMap).call(t)).find(n=>n.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[n]=r;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(H.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Sh(e).call(e,(r,n)=>r.level-n.level),e}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Le.Reconnecting,b("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Cu({},this.store):new Li({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:n}]=e;switch(r){case H.LocalVideoTrack:q(t=n._hints).call(t,et.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case H.LocalAudioTrack:n instanceof Bt?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case H.LocalVideoLowTrack:}}),this.emit(le.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Tn(r).call(r)).forEach(n=>{this.setPendingRemoteMedia(t,n)}),this.emit(le.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Tn(r).call(r)).forEach(n=>{this.setPendingRemoteDataChannel(t,n)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let r of this.pendingRemoteDataChannels){let{user:n,id:i}=r;if((e instanceof Ca?e.uid:e)===n.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:n,kind:i}=r;if((e instanceof Ca?e.uid:e)===n.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Ki(function*(){if(!t.connection||t.state!==Le.Connected)return;let r=yield De(t.mutex.lock("From P2PChannel.restartICE")),n;try{n=yield De(t.connection.restartICE(e));let o=yield De(n.next());if(o.done)return;let a=o.value,s=yield a;switch(t.reportPCDisconnectedOrFailed(e),e){case dn.TCP:t._pcStatsUploadType=Po.TCP_RESTART;break;case dn.RELAY:t._pcStatsUploadType=Po.RELAY_RESTART;break;default:t._pcStatsUploadType=Po.OLD_RESTART}t._isInRestartIce=!0,n.next(s)}catch(o){var i;(i=n)===null||i===void 0||i.throw(o)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(H.LocalVideoTrack),r=this.localTrackMap.get(H.LocalAudioTrack),n=e.videoSend.find(p=>p.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(p=>p.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!n||!i)return 1;let o=Kn(this,le.NeedSignalRTT),a=n?n.rttMs:void 0,s=i?i.rttMs:void 0,c=a&&s?(a+s)/2:a||s,l=(c&&o?(c+o)/2:c||o)||0,u=100*e.sendPacketLossRate*.7/50+.3*l/1500,d=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,h=t==null?void 0:t.track;if(h&&h._encoderConfig&&h._hints.indexOf(et.SCREEN_TRACK)===-1){let p=h._encoderConfig.bitrateMax,m=e.bitrate.actualEncoded;if(p&&m){let f=(1e3*p-m)/(1e3*p);return xx[f<.15?0:f<.3?1:f<.45?2:f<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[n]=r,i=n._audioSSRC,o=n._videoSSRC,a=e.audioRecv.find(m=>m.ssrc===i),s=e.videoRecv.find(m=>m.ssrc===o);if(!a&&!s)return void(t+=1);let c=Kn(this,le.NeedSignalRTT),l=e.rtt,u=(l&&c?(l+c)/2:l||c)||0,d=a?a.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*u/1500;d&&(p=.6*h*100/50+.2*u/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Y((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(v.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Le.Connected)return;let n=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(!n)return;let i=n[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),n[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,n[1].id)),this.isPlanB){let o=n[1];o.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,o)}if(i===H.LocalVideoTrack&&!b("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pe().supportDualStreamEncoding){let o=this.localTrackMap.get(H.LocalVideoLowTrack);if(o){let a=e._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=a,o.track._originMediaStreamTrack=a,await new Y((s,c)=>{this.handleReplaceTrack(o.track,s,c,!0)})}}}filterTobePublishedTracks(e,t,r){let n=[],i=this.getAllTracks();e=qc(e=e.filter(c=>i.indexOf(c)===-1));let o,a=!1,s=this.localTrackMap.get(H.LocalAudioTrack);for(let c of e){if(c instanceof Xe&&(this.localTrackMap.has(H.LocalVideoTrack)||a?new V(C.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:c,type:H.LocalVideoTrack}),a=!0),t)){let l=this.getLowVideoTrack(c,r);n.push({track:l,type:H.LocalVideoLowTrack})}if(c instanceof ht)if(s){let l=s.track;if(l instanceof Bt)LT([c]),l.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{let u=nv([l,c]);v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(u.getTrackId(),"]")),this.replaceTrack(l,u)}}else o instanceof Bt?(LT([c]),o.addAudioTrack(c)):o||!c._useAudioElement&&Pe().webAudioMediaStreamDest&&!c._bypassWebAudio?o=nv(o?[c,o]:[c]):o=c}return o&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),n.push({track:o,type:H.LocalAudioTrack})),n}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=qc(e=e.filter(n=>r.indexOf(n)!==-1));for(let n of e){if(n instanceof ht){let i=this.localTrackMap.get(H.LocalAudioTrack);if(!i)continue;i.track instanceof Bt?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(t.push([H.LocalAudioTrack,i]),i.track.close())):t.push([H.LocalAudioTrack,i])}if(n instanceof Xe){let i=this.localTrackMap.get(H.LocalVideoTrack);if(!i)continue;t.push([H.LocalVideoTrack,i]);let o=this.localTrackMap.get(H.LocalVideoLowTrack);o&&t.push([H.LocalVideoLowTrack,o])}}return t}filterTobePublishedDataChannels(e){return e=(e=qc(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=qc(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:n}=t;switch(n){case H.LocalVideoTrack:r.addListener(X.GET_STATS,this.handleGetLocalVideoStats),r.addListener(X.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(X.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case H.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case H.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Bt?e.trackList.forEach(r=>{r.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(X.GET_STATS,this.handleGetLocalAudioStats),r.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(X.GET_STATS,this.handleGetLocalAudioStats),e.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(X.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:n}]=t;return{track:n,type:r}})),e.forEach(t=>{let{track:r,type:n}=t;switch(n){case H.LocalVideoTrack:r.off(X.GET_STATS,this.handleGetLocalVideoStats),r.off(X.GET_RTC_STATS,this.handleGetRTCStats),r.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(X.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case H.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case H.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Bt?e.trackList.forEach(t=>{t.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(X.GET_STATS,this.handleGetLocalAudioStats),t.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(X.GET_STATS,this.handleGetLocalAudioStats),e.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(X.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof dl&&t.addListener(X.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof hl&&t.addListener(X.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(X.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(re.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(re.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,n)=>{var i;let o,a,{track:s,type:c}=r;switch(c){case H.LocalAudioTrack:o=Me.Audio,a={dtx:s instanceof mm&&s._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case H.LocalVideoTrack:o=q(i=s._hints).call(i,et.SCREEN_TRACK)?Me.Screen:Me.High,a=ao(ao({},fb(s)),{},{codec:this.store.codec,svc_mode:bT()});break;case H.LocalVideoLowTrack:o=Me.Low,a=ao(ao({},fb(s)),{},{codec:this.store.codec,svc_mode:bT()})}return{stream_type:o,attributes:a,ssrcs:t[n]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:a,id:s}]=t;switch(i){case H.LocalVideoTrack:n=q(r=o._hints).call(r,et.SCREEN_TRACK)?Me.Screen:Me.High;break;case H.LocalAudioTrack:n=Me.Audio;break;case H.LocalVideoLowTrack:n=Me.Low}return{stream_type:n,ssrcs:a,mid:s}})}assignLocalTracks(e,t){e.forEach((r,n)=>{let{track:i,type:o}=r;this.localTrackMap.set(o,{track:i,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(le.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),b("NEW_ICE_RESTART")){var r;if(q(r=this._restartStates).call(r,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let n=a=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(a)),Kn(this,le.QueryClientConnectionState)==="CONNECTED"&&this.emit(le.RequestRestartICE,a))},i=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(le.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o=b("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(b("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Pe().supportPCSetConfiguration)n(dn.RELAY),this._restartTimer=window.setTimeout(i,o);else if(ft())n(dn.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(n(dn.TCP),Pe().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{n(dn.RELAY),this._restartTimer=window.setTimeout(i,o)},o));this._restartTimer=window.setTimeout(i,o)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&b("ICE_RESTART")&&Kn(this,le.QueryClientConnectionState)==="CONNECTED"&&this.emit(le.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(le.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(le.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),te.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:pt.TRACER}).onSuccess(),this.emit(le.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let n=Array.from(Tn(r=this.remoteUserMap).call(r)).find(o=>o._audioSSRC===t);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(ul.FIRST_FRAME_DECODED),te.firstRemoteFrame(this.store.sessionId,$t.FIRST_AUDIO_DECODE,st.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let n=Array.from(Tn(r=this.remoteUserMap).call(r)).find(i=>i._audioSSRC===t);n&&te.firstRemoteFrame(this.store.sessionId,$t.FIRST_AUDIO_RECEIVED,st.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,n)=>{this.reportVideoFirstFrameDecoded(t,r,n)},e.onFirstVideoReceived=t=>{var r;let n=Array.from(Tn(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===t);n&&te.firstRemoteFrame(this.store.sessionId,$t.FIRST_VIDEO_RECEIVED,st.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let n=t.candidateType==="relay",i=r.candidateType==="relay";r.candidateType!=="unknown"&&n===i||this.emit(le.ConnectionTypeChange,n),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Da(r))," -> ").concat(JSON.stringify(Da(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Da(r))," -> ").concat(JSON.stringify(Da(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return ao(ao({},t),r)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(H.LocalAudioTrack);if(e instanceof ht&&(r==null?void 0:r.track)instanceof Bt)return r.track.isActive||t.push([H.LocalAudioTrack,r]),t;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return e===o});if(n&&(t.push(n),n[0]===H.LocalVideoTrack)){let i=this.localTrackMap.get(H.LocalVideoLowTrack);i&&t.push([H.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(H.LocalAudioTrack);if(e instanceof ht&&(r==null?void 0:r.track)instanceof Bt)return r.track.isActive&&t.push([H.LocalAudioTrack,r]),t;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return e===o});if(n)if(n[0]===H.LocalVideoTrack){t.push(n);let i=this.localTrackMap.get(H.LocalVideoLowTrack);i&&t.push([H.LocalVideoLowTrack,i])}else t.push(n);return t}createMuteMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:a,id:s}]=t;switch(i){case H.LocalAudioTrack:n=Me.Audio;break;case H.LocalVideoTrack:n=q(r=o._hints).call(r,et.SCREEN_TRACK)?Me.Screen:Me.High;break;case H.LocalVideoLowTrack:n=Me.Low}return{stream_type:n,ssrcs:a,mid:s}})}createUnmuteMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:a,id:s}]=t;switch(i){case H.LocalAudioTrack:n=Me.Audio;break;case H.LocalVideoTrack:n=q(r=o._hints).call(r,et.SCREEN_TRACK)?Me.Screen:Me.High;break;case H.LocalVideoLowTrack:n=Me.Low}return{stream_type:n,ssrcs:a,mid:s}})}filterTobeUnSubscribedTracks(e,t){let r=[],n=this.remoteUserMap.get(e);if(!n)return r;if(t){let i=n.get(t);if(!i)return r;r.push([e,{kind:t,id:i}])}else Array.from(n.entries()).forEach(i=>{let[o,a]=i;r.push([e,{kind:o,id:a}])});return r}filterTobeUnSubscribedDataChannels(e,t){let r=[];return t.forEach(n=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(n.id)&&r.push(n)}),r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[n,{kind:i,id:o}]=r;switch(i){case re.VIDEO:return void(n._videoSSRC&&t.push({stream_type:re.VIDEO,ssrcId:n._videoSSRC}));case re.AUDIO:return void(n._audioSSRC&&t.push({stream_type:re.AUDIO,ssrcId:n._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(r=>{let[n,{kind:i}]=r;if(t.has(n)){let o=t.get(n);i===re.VIDEO?o|=jt.Video:o|=jt.Audio,t.set(n,o)}else i===re.VIDEO?t.set(n,jt.Video):t.set(n,jt.Audio)}),{users:Array.from(t.entries()).map(r=>{let[n,i]=r;return{stream_id:n.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:n}]=t,i=this.remoteUserMap.get(r);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(H.LocalVideoTrack),r=this.localTrackMap.get(H.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),r&&e.low_stream_uplink&&await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((r,n)=>{var i;let{stream_type:o}=r;return(i=t.find(a=>{let{stream_type:s}=a;return o===s}))===null||i===void 0?void 0:i.attributes})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof ht){var t;let n=this.filterTobeUnmutedTracks(e[r]);if(n.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(n.map(o=>{let[,{id:a}]=o;return a})));let i=this.createUnmuteMessage(n);return void await We(this,le.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(le.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(le.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await er(CR(this.dtlsFailedCount,Pt)),this.emit(le.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await lr(this,le.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(le.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(H.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Xe)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Xe).length>1)throw new V(C.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof ht).length>1&&(e.some(t=>t instanceof ht&&t._bypassWebAudio)||!Pe().webAudioMediaStreamDest))throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof Xe&&this.pendingLocalTracks.some(r=>r instanceof Xe))throw new V(C.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof ht&&this.pendingLocalTracks.some(r=>r instanceof ht)&&(!Pe().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof ht&&r._bypassWebAudio)))throw new V(C.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!b("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pe().supportDualStreamEncoding,n=ao(ao({},{width:160,height:120,framerate:15,bitrate:50}),t),i;i=r?e._mediaStreamTrack.clone():kT(e,n);let o=Ke(8,"track-low-"),a=new Xe(i,ao(ao({},r&&{scaleResolutionDownBy:vT(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,o);return a.on(Fs.TRANSCEIVER_UPDATED,s=>{e._updateRtpTransceiver(s,Nl.LOW_STREAM)}),a._hints.push(et.LOW_STREAM),e.on("sei-to-send",s=>{a.emit("sei-to-send",s)}),e.addListener(X.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Li){var i,o,a,s;let c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:u,peerConnectionState:d}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();te.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:u,connectionstate:d,intSucc:t?1:2,error:n,selectedLocalCandidateProtocol:(i=h==null?void 0:h.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(o=h.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:(a=p.protocol)!==null&&a!==void 0?a:"",selectedRemoteCandidateType:(s=p.candidateType)!==null&&s!==void 0?s:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:r,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,t,r,n){var i;let o=Array.from(Tn(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===e);if(o){n||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let a=this.store.keyMetrics,s=a.subscribe.find(c=>c.userId===o.uid&&c.type==="video");te.firstRemoteVideoDecode(this.store.sessionId,$t.FIRST_VIDEO_DECODE,st.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:r,subscribeElapse:fr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(s==null?void 0:s.subscribeEnd)||0,subscriberStart:(s==null?void 0:s.subscribeStart)||0,videoAddNotify:(s==null?void 0:s.streamAdded)||0,state:n?1:0,firstFrame:(s==null?void 0:s.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;let n=this.remoteUserMap.get(e);if(!n)return!1;let i=n.get(t);if(!i)return!1;let o=await this.connection.getRemoteSSRC(i);return o!==void 0&&o!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===H.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Nl.LOW_STREAM):r._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Li&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Po.TCP_RESTART&&e===dn.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Po.DISCONNECTED_OR_FAILED)))}},Z(Se.prototype,"startP2PConnection",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"startP2PConnection"),Se.prototype),Z(Se.prototype,"connect",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"connect"),Se.prototype),Z(Se.prototype,"updateRemoteRTPCapabilities",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"updateRemoteRTPCapabilities"),Se.prototype),Z(Se.prototype,"publishDataChannel",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"publishDataChannel"),Se.prototype),Z(Se.prototype,"unpublish",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"unpublish"),Se.prototype),Z(Se.prototype,"unpublishDataChannel",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"unpublishDataChannel"),Se.prototype),Z(Se.prototype,"unpublishLowStream",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"unpublishLowStream"),Se.prototype),Z(Se.prototype,"subscribeDataChannel",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"subscribeDataChannel"),Se.prototype),Z(Se.prototype,"subscribe",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"subscribe"),Se.prototype),Z(Se.prototype,"massSubscribe",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"massSubscribe"),Se.prototype),Z(Se.prototype,"unsubscribe",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"unsubscribe"),Se.prototype),Z(Se.prototype,"unsubscribeDataChannel",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"unsubscribeDataChannel"),Se.prototype),Z(Se.prototype,"massUnsubscribe",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"massUnsubscribe"),Se.prototype),Z(Se.prototype,"muteRemote",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"muteRemote"),Se.prototype),Z(Se.prototype,"unmuteRemote",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"unmuteRemote"),Se.prototype),Z(Se.prototype,"hasRemoteMediaWithLock",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"hasRemoteMediaWithLock"),Se.prototype),Z(Se.prototype,"disconnectForReconnect",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"disconnectForReconnect"),Se.prototype),Z(Se.prototype,"updateBitrateLimit",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"updateBitrateLimit"),Se.prototype),Z(Se.prototype,"remoteMediaSsrcChanged",[Rr],Object.getOwnPropertyDescriptor(Se.prototype,"remoteMediaSsrcChanged"),Se.prototype),Se);function Rr(e,t,r){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let i=this.mutex,o=await i.lock("From P2PChannel.".concat(t));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await n.apply(this,s)}finally{o()}},r}var $V={};function wu(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&v.debug("install service ".concat(e.name)),$V[e.name]=e}function Gu(e){let t=$V[e];if(!t)throw new V(C.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function vP(e,t){return Gu("DataStream").create(e,t)}function SP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function TP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var CJ=Date.now(),IJ=20,UT=new Map,If=new Map;async function qV(e){let t=UT.get(e),r=Array.isArray(t)&&t[t.length-1],n=If.get(e);if(!r)return void(n.isSyncing=!1);let i={uid:r.uid,payload:r.payload};n.firstRecvTs===0&&(n.firstRecvTs=r.recvTs,n.firstSendTs=r.sendTs);let o=r.sendTs-n.firstSendTs,a=o-(Date.now()-n.firstRecvTs);a>0&&(n.firstRecvTs=Date.now()-o);let s=r.mediaDelay+a;s<=0?(t.pop(),XV(r.context,i),s=0):s=Math.min(s,IJ),setTimeout(()=>t.length&&qV(e),s)}function XV(e,t){e.safeEmit(Ce.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function wJ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return XV(r,{uid:e.uid,payload:e.payload});let n="".concat(r.id,"-").concat(e.uid),i=UT.get(n)||[],o=i.findIndex(l=>e.sendTs>=l.sendTs),a=TP(TP({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});o===-1?i.push(a):i.splice(o,0,a),UT.set(n,i);let s=!1;var c;If.has(n)?s=!((c=If.get(n))===null||c===void 0||!c.isSyncing):If.set(n,{isSyncing:s,firstRecvTs:0,firstSendTs:0}),s||qV(n)}var AJ=Ne().name;function yP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function RP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yP(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ml="websdk_ng_cache_parameter",bJ=b("MAX_PRELOAD_ASYNC_LENGTH"),OJ=1e4,ys=new Map,Rs=[],ov=null,av=0,sv=0,kp=new Map,NJ=function(e,t){let r=[],n=0,i=async()=>{let o=r.shift();o&&await o(),r.length>0&&n<t?i():n--};return async function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return new Y(async(c,l)=>{r.push(async()=>{try{let u=await e(...a);c(u)}catch(u){l(u)}}),n<t&&(n++,i())})}}(JV,bJ),cv=$r.CancelToken.source();async function JV(e,t,r,n,i,o){try{if(!b("ENABLE_PRELOAD"))return;if(!Pe().supportWebCrypto)return void Qa(()=>{v.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new V(C.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&qt(r,"token",1,2047),qt(e,"appid",1,2047),v_(t),n&&S_(n);let a=Xc();v.debug("preload channel ".concat(t,", uid is ").concat(n));let s={appId:e,cname:t,token:r||e,uid:typeof n!="string"?n:null,sid:a,proxyServer:i},c,l;typeof n=="string"?(s.stringUid=n,[l,c]=await Y.all([XX(n,{sid:a,appId:e},cv.token),bN(RP(RP({},s),{},{token:r||e,uid:0}),cv.token)]),s.uid=l.uid,c.gatewayInfo.uid=s.uid,c.gatewayInfo.res.uid=s.uid):(o&&(s.stringUid=o),c=await bN(s,cv.token));let u={sid:a,appId:e,cname:t,token:r||e,uid:s.stringUid||n,intUid:s.uid||c.gatewayInfo.uid,stringUid:s.stringUid,ts:Date.now(),sua:l,ap:c};await async function(d){let h;try{d.uid&&QV({appId:d.appId,cname:d.cname,token:d.token,uid:d.uid,stringUid:d.stringUid});let p=tF(d),m=await async function(_,E){try{let g=await window.crypto.subtle.importKey("raw",Px(E),"AES-GCM",!1,["encrypt"]),T=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},g,Os(window.btoa(JSON.stringify(_))));return Ha(new Uint8Array(T))}catch{return}}(d,d.token||d.appId);if(!m)return;h=eF(ml);let f=h?JSON.parse(h):[];f.push({[p]:m}),f.length>b("AP_CACHE_NUM")&&f.shift(),Tm(ml,JSON.stringify(f))}catch(p){v.warn("Error caching server parameters:",p.message),Tm(ml,"")}}(u),av++}catch(a){throw sv++,function(s){ov||(ov=window.setTimeout(()=>{let l="";kp.forEach((u,d)=>{l+="".concat(d,": ").concat(u," ;")}),te.reportApiInvoke(null,{name:Lt.PRELOAD,options:{success:av,failed:sv,err:l}}).onError(s),av=0,sv=0,kp.clear(),ov=null},OJ));let c=kp.get(s.code)||0;kp.set(s.code,c+1)}(a),a}}async function CP(e){try{let t=QV(e);if(!t||e.cloudProxyServer!=="disabled")return;let r=await async function(n,i){try{let o=await window.crypto.subtle.importKey("raw",Px(i),"AES-GCM",!1,["decrypt"]),a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,Os(n));return JSON.parse(window.atob(Ha(new Uint8Array(a))))}catch{return}}(t,e.token||e.appId);if(!r||!function(n,i){return n.cname===i.cname&&n.appId===i.appId&&n.token===i.token?i.stringUid?n.stringUid===i.stringUid:typeof i.uid=="number"?n.uid===i.uid:n.uid==i.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<b("AP_CACHE_LIFETIME"))return r}catch(t){v.warn("Error get preloadInfo",t.message)}}function QV(e){let t;try{if(t=eF(ml),!t)return;let r=JSON.parse(t),n=tF(e),i=function(a,s){for(let c=a.length-1;c>=0;c--)if(s(a[c]))return c;return-1}(r,a=>n in a);if(i===-1)return;let o=r.splice(i,1)[0];return Tm(ml,JSON.stringify(r)),o[n]}catch(r){v.warn("Error delete preload info: ".concat(t),r.message),Tm(ml,"")}}function YR(e){if(e){let t=ys.get(e);t&&(window.clearTimeout(t),t=null,ys.delete(e)),q(Rs).call(Rs,e)||e.cloudProxyServer!=="disabled"||Rs.push(e)}if(ys.size<b("AP_CACHE_NUM")&&Rs.length>0){let t=Rs.shift();ys.set(t,window.setTimeout(async()=>{let{appId:r,cname:n,token:i,stringUid:o,uid:a,proxyServer:s}=t;try{await NJ(r,n,i,a,s,o),ys.has(t)&&YR(t)}catch(c){v.warn("update preload failed",c.message),ZV(t)}},b("AP_UPDATE_INTERVAL")))}}function ZV(e){let t=Rs.indexOf(e);t!==-1&&Rs.splice(t,1);let r=ys.get(e);r&&(window.clearTimeout(r),r=null,ys.delete(e),YR())}function IP(e,t){let r=e.sua,n=e.ap;t&&r&&te.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),te.reportResourceTiming(e.ap.url,e.sid),te.joinWebProxyAP(e.sid,{lts:n.requestTime,elapse:n.elapse,sucess:1,apServerAddr:n.url,turnServerAddrList:n.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[It.CHOOSE_SERVER,It.CLOUD_PROXY_FALLBACK].toString()}),te.joinChooseServer(e.sid,{lts:n.requestTime,elapse:n.elapse,succ:!0,csAddr:n.url,opid:n.opid,serverList:n.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:n.gatewayInfo.cid.toString(),uid:n.gatewayInfo.uid.toString(),csIp:n.gatewayInfo.csIp,unilbsServerIds:[It.CHOOSE_SERVER].toString(),isHttp3:n.isHttp3})}function eF(e){return window.atob(window.localStorage.getItem(e)||"")}function Tm(e,t){window.localStorage.setItem(e,window.btoa(t))}function tF(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),kx(t)}function PJ(e){let t=function(){let r=LJ.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,n){let i=r.appId;i!==void 0&&(Rt(n,10),pa(n,i));let o=r.cid;o!==void 0&&(Rt(n,16),Rt(n,o));let a=r.cname;a!==void 0&&(Rt(n,26),pa(n,a));let s=r.deviceId;s!==void 0&&(Rt(n,34),pa(n,s));let c=r.elapse;c!==void 0&&(Rt(n,40),fa(n,c));let l=r.fileSize;l!==void 0&&(Rt(n,48),fa(n,Rc(l)));let u=r.height;u!==void 0&&(Rt(n,56),fa(n,Rc(u)));let d=r.jpg;d!==void 0&&(Rt(n,66),Rt(n,d.length),wP(n,d));let h=r.networkType;h!==void 0&&(Rt(n,72),fa(n,Rc(h)));let p=r.osType;p!==void 0&&(Rt(n,80),fa(n,Rc(p)));let m=r.requestId;m!==void 0&&(Rt(n,90),pa(n,m));let f=r.sdkVersion;f!==void 0&&(Rt(n,98),pa(n,f));let _=r.sequence;_!==void 0&&(Rt(n,104),fa(n,Rc(_)));let E=r.sid;E!==void 0&&(Rt(n,114),pa(n,E));let g=r.timestamp;g!==void 0&&(Rt(n,120),fa(n,g));let T=r.uid;T!==void 0&&(Rt(n,128),Rt(n,T));let R=r.vid;R!==void 0&&(Rt(n,136),Rt(n,R));let w=r.width;w!==void 0&&(Rt(n,144),fa(n,Rc(w)));let A=r.service;A!==void 0&&(Rt(n,152),Rt(n,A));let N=r.callbackData;N!==void 0&&(Rt(n,162),Rt(n,N.length),wP(n,N));let P=r.ticket;P!==void 0&&(Rt(n,170),pa(n,P));let x=r.vendorConfigs;x!==void 0&&(Rt(n,178),pa(n,x))}(e,t),function(r){let n=r.bytes,i=r.limit;return n.length===i?n:n.subarray(0,i)}(t)}function DJ(e){return function(r){let n={};e:for(;!MJ(r);){let i=Wu(r);switch(i>>>3){case 0:break e;case 1:n.code=Wu(r);break;case 2:n.msg=AP(r,Wu(r));break;case 3:n.requestId=AP(r,Wu(r));break;case 4:n.timestamp=UJ(r,!1);break;default:kJ(r,7&i)}}return n}({bytes:t=e,offset:0,limit:t.length});var t}function kJ(e,t){switch(t){case 0:for(;128&hi(e););break;case 2:lv(e,Wu(e));break;case 5:lv(e,4);break;case 1:lv(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Rc(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var LJ=[];function lv(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function MJ(e){return e.offset>=e.limit}function y_(e,t){let r=e.bytes,n=e.offset,i=e.limit,o=n+t;if(o>r.length){let a=new Uint8Array(2*o);a.set(r),e.bytes=a}return e.offset=o,o>i&&(e.limit=o),n}function rF(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function wP(e,t){let r=y_(e,t.length);e.bytes.set(t,r)}function AP(e,t){let r=rF(e,t),n=String.fromCharCode,i=e.bytes,o="",a="";for(let s=0;s<t;s++){let c,l,u,d,h=i[s+r];128&h?(224&h)==192?s+1>=t?a+=o:(c=i[s+r+1],(192&c)!=128?a+=o:(d=(31&h)<<6|63&c,d<128?a+=o:(a+=n(d),s++))):(240&h)==224?s+2>=t?a+=o:(c=i[s+r+1],l=i[s+r+2],(49344&(c|l<<8))!=32896?a+=o:(d=(15&h)<<12|(63&c)<<6|63&l,d<2048||d>=55296&&d<=57343?a+=o:(a+=n(d),s+=2))):(248&h)==240?s+3>=t?a+=o:(c=i[s+r+1],l=i[s+r+2],u=i[s+r+3],(12632256&(c|l<<8|u<<16))!=8421504?a+=o:(d=(7&h)<<18|(63&c)<<12|(63&l)<<6|63&u,d<65536||d>1114111?a+=o:(d-=65536,a+=n(55296+(d>>10),56320+(1023&d)),s+=3))):a+=o:a+=n(h)}return a}function pa(e,t){let r=t.length,n=0;for(let a=0;a<r;a++){let s=t.charCodeAt(a);s>=55296&&s<=56319&&a+1<r&&(s=(s<<10)+t.charCodeAt(++a)-56613888),n+=s<128?1:s<2048?2:s<65536?3:4}Rt(e,n);let i=y_(e,n),o=e.bytes;for(let a=0;a<r;a++){let s=t.charCodeAt(a);s>=55296&&s<=56319&&a+1<r&&(s=(s<<10)+t.charCodeAt(++a)-56613888),s<128?o[i++]=s:(s<2048?o[i++]=s>>6&31|192:(s<65536?o[i++]=s>>12&15|224:(o[i++]=s>>18&7|240,o[i++]=s>>12&63|128),o[i++]=s>>6&63|128),o[i++]=63&s|128)}}function hi(e){return e.bytes[rF(e,1)]}function bP(e,t){let r=y_(e,1);e.bytes[r]=t}function Wu(e){let t,r=0,n=0;do t=hi(e),r<32&&(n|=(127&t)<<r),r+=7;while(128&t);return n}function Rt(e,t){for(t>>>=0;t>=128;)bP(e,127&t|128),t>>>=7;bP(e,t)}function UJ(e,t){let r,n=0,i=0,o=0;return r=hi(e),n=127&r,128&r&&(r=hi(e),n|=(127&r)<<7,128&r&&(r=hi(e),n|=(127&r)<<14,128&r&&(r=hi(e),n|=(127&r)<<21,128&r&&(r=hi(e),i=127&r,128&r&&(r=hi(e),i|=(127&r)<<7,128&r&&(r=hi(e),i|=(127&r)<<14,128&r&&(r=hi(e),i|=(127&r)<<21,128&r&&(r=hi(e),o=127&r,128&r&&(r=hi(e),o|=(127&r)<<7))))))))),{low:n|i<<28,high:i>>>4|o<<24,unsigned:t}}function fa(e,t){let r=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=i===0?n===0?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,a=y_(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=o!==9?128|i:127&i;case 8:s[a+7]=o!==8?n>>>21|128:n>>>21&127;case 7:s[a+6]=o!==7?n>>>14|128:n>>>14&127;case 6:s[a+5]=o!==6?n>>>7|128:n>>>7&127;case 5:s[a+4]=o!==5?128|n:127&n;case 4:s[a+3]=o!==4?r>>>21|128:r>>>21&127;case 3:s[a+2]=o!==3?r>>>14|128:r>>>14&127;case 2:s[a+1]=o!==2?r>>>7|128:r>>>7&127;case 1:s[a]=o!==1?128|r:127&r}}var OP={},NP={},ym=4294967296,xJ=ym*ym,PP=xJ/2;nF(0,!0);var DP=nF(0),VJ=Qd(0,-2147483648,!1),FJ=Qd(-1,2147483647,!1);function nF(e,t){let r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=NP[e],n)?n:(r=Qd(e,0,!0),i&&(NP[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=OP[e],n)?n:(r=Qd(e,e<0?-1:0,!1),i&&(OP[e]=r),r)}function Qd(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function jJ(e,t){if(isNaN(e))return DP;{if(e<=-PP)return VJ;if(e+1>=PP)return FJ}return e<0?DP:Qd(e%ym|0,e/ym|0,t)}function kP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}var BJ=class iF extends lt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(Ui.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),y(this,"name","AgoraRTCImageModeration"),y(this,"_connectionState",xn.CONNECTING),y(this,"_sequence",0),y(this,"_moderationStartTime",void 0),y(this,"_workerConnection",void 0),y(this,"_workerMessageLengthLimit",void 0),y(this,"_qualityRatio",void 0),y(this,"_connectInfo",void 0),y(this,"_cancelTokenSource",$r.CancelToken.source()),y(this,"_retryConfig",void 0),y(this,"_moderationInterval",void 0),y(this,"_moderationTimer",null),y(this,"_moderationMode",1),y(this,"_quality",1),y(this,"_qualityTimer",null),y(this,"_ticket",void 0),y(this,"_moderationIntervalMinimum",void 0),y(this,"_uploadFailedNum",0),y(this,"_uploadNum",0),y(this,"_uploadTimer",null),y(this,"_extraInfo",void 0),y(this,"_vendor",""),y(this,"_encoder",new TextEncoder),y(this,"_moderationId",void 0),y(this,"inspectImage",()=>{if(this.connectionState!==xn.CONNECTED)throw new M(C.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===xn.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ke(5,"image-moderation-"),this._workerMessageLengthLimit=b("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=b("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=b("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new zd("worker-"+this._moderationId,Pt),this.on(Ui.STATE_CHANGE,(n,i)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(mc[n]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(Ui.STATE_CHANGE,mc.CONNECT_AP),this._connectInfo=t;let n=this._cancelTokenSource.token;return this._retryConfig=r,new Y((i,o)=>{this.on(Ui.CONNECTION_STATE_CHANGE,(a,s)=>{a===xn.CONNECTED&&i()}),this.requestAP(t,n,r).then(a=>{this.connectWorker(a)}).catch(a=>{o(a)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===xn.CONNECTED&&this.inspectImage()}async requestAP(t,r,n){let i=b("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),o=await function(c,l,u,d){let{appId:h,areaCode:p,cname:m,sid:f,token:_,uid:E}=l;pl++;let g="moderation_plugin",T={service_name:g,json_body:JSON.stringify({appId:h,areaCode:p,cname:m,command:"allocateEdge",requestId:pl,seq:pl,sid:f,appToken:_,ts:Date.now(),uid:E+""})},R,w,A=c[0];return Ji(async()=>{R=Date.now();let N=await Qi(A,{data:T,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(w=Date.now()-R,N.code!==0){let G=new M(C.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+N.code,{retry:!0,responseTime:w});throw v.error(G.toString()),G}let P=JSON.parse(N.json_body);if(P.code!==200){let G=new M(C.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(P.code,", reason: ").concat(P.reason),{code:P.code,responseTime:w});throw v.error(G.toString()),G}if(!P.servers||!Array.isArray(P.servers)||P.servers.length===0){let G=new M(C.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:P.code,responseTime:w});throw v.error(G.toString()),G}if(!P.servers.some(G=>!!G.wss)){let G=new M(C.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:P.code,responseTime:w});throw v.error(G.toString()),G}let x=b("IMAGE_MODERATION_WORKER_HOST");return{addressList:P.servers.map(G=>{let{address:ne,wss:z}=G;if(ne&&z)return"wss://".concat(ne.replace(/\./g,"-"),".").concat(x,":").concat(z,"/moderation")}).filter(G=>!!G),workerToken:P.workerToken,vid:P.vid,ticket:P.appTicket,responseTime:w}},(N,P)=>(te.apworkerEvent(f,{success:!0,sc:200,serviceName:g,responseDetail:JSON.stringify(N.addressList),firstSuccess:P===0,responseTime:w,serverIp:c[P%c.length]}),!1),(N,P)=>(te.apworkerEvent(f,{success:!1,sc:N.data&&N.data.code||200,serviceName:g,responseTime:w,serverIp:c[P%c.length]}),!!(N.code!==C.OPERATION_ABORTED&&N.code!==C.UNEXPECTED_RESPONSE||N.data&&N.data.retry)&&(A=c[(P+1)%c.length],!0)),d)}(i,t,r,n);this.emit(Ui.STATE_CHANGE,mc.AP_CONNECTED);let{addressList:a,ticket:s}=o;return this._ticket=s,a}async connectWorker(t){this.emit(Ui.STATE_CHANGE,mc.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(pe.CONNECTED,async()=>{this.emit(Ui.STATE_CHANGE,mc.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=xn.CONNECTED}),this._workerConnection.on(pe.CLOSED,()=>{this.connectionState=xn.CLOSED}),this._workerConnection.on(pe.FAILED,()=>{this.connectionState=xn.CLOSED}),this._workerConnection.on(pe.RECONNECTING,()=>{this.connectionState=this.connectionState===xn.CONNECTED?xn.RECONNECTING:xn.CONNECTING}),this._workerConnection.on(pe.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let r=DJ(new Uint8Array(t.data));b("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{te.reportApiInvoke(this._connectInfo.sid||null,{name:Lt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:pt.TRACER}).onError(new M(C.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},b("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(pe.WILL_RECONNECT,(t,r,n)=>{t==="recover"&&n(t),n("tryNext")}),this._workerConnection.on(pe.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=Kn(this,Ui.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(b("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;let n=await this.generateRequestData(t,r);this._workerConnection.sendMessage(n,!0,!0)}else b("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:n,cname:i,cid:o,vid:a,sid:s,uid:c}=r,l=Date.now(),u=await t.getCurrentFrameImage("image/jpeg",this.quality),d=await _V(u,n,i),h=this._sequence+"-"+o+"-"+c+"-"+l+"-"+Ke(12,""),p={appId:n,cid:o,cname:i,deviceId:"",elapse:iF.intToLong(Number(l-this._moderationStartTime)),fileSize:u.buffer.byteLength,height:u.height,width:u.width,jpg:d,networkType:6,osType:7,requestId:h,sdkVersion:"4.22.0",sequence:this._sequence,sid:s,timestamp:jJ(l),uid:c,vid:a,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete p.callbackData;let m=PJ(p);if(m.byteLength<this._workerMessageLengthLimit){if(b("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let f=function(_){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?kP(Object(g),!0).forEach(function(T){y(_,T,g[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(g)):kP(Object(g)).forEach(function(T){Object.defineProperty(_,T,Object.getOwnPropertyDescriptor(g,T))})}return _}({},p);delete f.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(f))}return m}{let f=this.quality*this._qualityRatio;return this.quality=f,await this.generateRequestData(t,{appId:n,cname:i,cid:o,vid:a,sid:s,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=$r.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=xn.CLOSED,this.emit(Ui.STATE_CHANGE,mc.CLOSED)}};function oF(e){if(Be(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new M(C.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new M(C.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}var GJ={name:"ImageModeration",create:function(e){let{config:t}=e;return oF(t),new BJ(t)}},LP,MP,UP,xP,VP,FP,jP,BP,GP,WP,HP,KP,zP,YP,$P,qP,XP,JP,QP,ZP,eD,tD,rD,nD,iD,oD,aD,sD,cD,lD,uD,dD,hD,pD,fD,mD,_D,ED,gD,vD,$;function SD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Vi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SD(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SD(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}_r.setLogger(v);var WJ=(LP=ce(),MP=ce({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Zc))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),UP=ce({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Yl.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),xP=ce({argsMap:(e,t,r,n)=>[typeof t=="object"?t.uid:t,r,n]}),VP=ce({argsMap:(e,t,r)=>[t,r]}),FP=ce({argsMap:(e,t)=>t.map(r=>{let{user:n,mediaType:i}=r;return[n==null?void 0:n.uid,i]})}),jP=ce({argsMap:(e,t,r,n)=>[typeof t=="object"?t.uid:t,r,n]}),BP=ce({argsMap:(e,t)=>t.map(r=>{let{user:n,mediaType:i}=r;return{uid:n==null?void 0:n.uid,mediaType:i}})}),GP=ce(),WP=ce(),HP=ce(),KP=ce(),zP=ce(),YP=ce(),$P=ce(),qP=ce(),XP=ce(),JP=ce(),QP=ce(),ZP=ce(),eD=ce(),tD=ce(),rD=ce({argsMap:(e,t)=>[t]}),nD=ce(),iD=ce(),oD=ce(),aD=ce(),sD=ce(),cD=ce(),lD=ce(),uD=ce(),dD=ce({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),hD=ce(),pD=ce(),fD=ce(),mD=ce(),_D=ce(),ED=ce(),gD=ce({reportResult:!0}),vD=ce(),$=class extends lt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),y(this,"store",void 0),y(this,"_uid",void 0),y(this,"_channelName",void 0),y(this,"_uintUid",void 0),y(this,"_users",[]),y(this,"_config",void 0),y(this,"_clientId",void 0),y(this,"_appId",void 0),y(this,"_sessionId",null),y(this,"_key",void 0),y(this,"_rtmConfig",{}),y(this,"_joinInfo",void 0),y(this,"_gateway",void 0),y(this,"_statsCollector",void 0),y(this,"_configDistribute",void 0),y(this,"_leaveMutex",new _r("client-leave")),y(this,"_publishMutex",new _r("client-publish")),y(this,"_renewTokenMutex",new _r("client-renewtoken")),y(this,"_subscribeMutex",new _r("client-subscribe")),y(this,"_encryptionMode","none"),y(this,"_encryptionSecret",null),y(this,"_encryptionSalt",null),y(this,"_encryptDataStream",!1),y(this,"_encryptDataStreamKey",null),y(this,"_encryptDataStreamIv",null),y(this,"_proxyServer",void 0),y(this,"_turnServer",{servers:[],mode:"auto"}),y(this,"_cloudProxyServerMode","disabled"),y(this,"_isDualStreamEnabled",!1),y(this,"_defaultStreamFallbackType",void 0),y(this,"_lowStreamParameter",void 0),y(this,"_streamFallbackTypeCacheMap",new Map),y(this,"_remoteStreamTypeCacheMap",new Map),y(this,"_axiosCancelSource",$r.CancelToken.source()),y(this,"_audioVolumeIndicationInterval",void 0),y(this,"_networkQualityInterval",void 0),y(this,"_userOfflineTimeout",void 0),y(this,"_streamRemovedTimeout",void 0),y(this,"_liveTranscodeStreamingClient",void 0),y(this,"_liveRawStreamingClient",void 0),y(this,"_channelMediaRelayClient",void 0),y(this,"_networkQualitySensitivity","normal"),y(this,"_p2pChannel",void 0),y(this,"_useLocalAccessPoint",!1),y(this,"_setLocalAPVersion",void 0),y(this,"_joinAndNotLeaveYet",!1),y(this,"_numberOfJoinCount",0),y(this,"_remoteDefaultVideoStreamType",void 0),y(this,"_inspect",void 0),y(this,"_moderation",void 0),y(this,"_license",void 0),y(this,"_pendingPublishedUsers",[]),y(this,"ntpAlignErrorCount",0),y(this,"remoteInboundOffset",0),y(this,"_handleLocalTrackEnable",(r,n,i)=>{this.publish(r,!1).then(n).catch(i)}),y(this,"_handleLocalTrackDisable",(r,n,i)=>{this.unpublish(r).then(n).catch(i)}),y(this,"_handleUserOnline",r=>{if(b("BLOCK_LOCAL_CLIENT")&&ls(r.uid,this.channelName))return void v.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let n=this._users.find(i=>i.uid===r.uid);if(n)n._trust_in_room_=!0,n._is_pre_created&&(n._is_pre_created=!1,this.safeEmit(Ce.USER_JOINED,n));else{let i=new Ca(r.uid,r.uint_id||r.uid);this._users.push(i),v.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(Ce.USER_JOINED,i)}}),y(this,"_handleUserOffline",r=>{if(b("BLOCK_LOCAL_CLIENT")&&ls(r.uid,this.channelName))return;let n=this._users.find(i=>i.uid===r.uid);n&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),n._audio_pre_subscribed||n._video_pre_subscribed?n._is_pre_created=!0:dm(this._users,n),this._remoteStreamTypeCacheMap.delete(n.uid),this._streamFallbackTypeCacheMap.delete(n.uid),v.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(Ce.USER_LEAVED,n,r.reason))}),y(this,"_handleAddAudioOrVideoStream",(r,n,i,o,a,s,c)=>{if(b("BLOCK_LOCAL_CLIENT")&&ls(n,this.channelName))return;let l=this._users.find(d=>d.uid===n);if(!l)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(n,", type ").concat(r)),this.store.subscribe(l.uid,r,void 0,void 0,void 0,Date.now());let u=r==="audio"?l.hasAudio:l.hasVideo;l._uintid||(l._uintid=a||n),r==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,r==="audio"?(l._audio_added_=!0,i!==void 0&&(l._audioSSRC=i),o!==void 0&&(l._cname=o),s&&(l._audioOrtc=s)):(l._video_added_=!0,i!==void 0&&(l._videoSSRC=i),o!==void 0&&(l._cname=o),c!==void 0&&(l._rtxSsrcId=c),s&&(l._videoOrtc=s)),(r==="audio"?l.hasAudio:l.hasVideo)&&!u&&(v.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(r)),this.safeEmit(Ce.USER_PUBLISHED,l,r)),r==="video"?te.onGatewayStream(this._sessionId,$t.ON_ADD_VIDEO_STREAM,st.ON_ADD_VIDEO_STREAM,{peer:a||n,ssrc:l._videoSSRC}):te.onGatewayStream(this._sessionId,$t.ON_ADD_AUDIO_STREAM,st.ON_ADD_AUDIO_STREAM,{peer:a||n,ssrc:l._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(l,r,i).then(d=>{if(d&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(l.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Dp))return this._p2pChannel.unsubscribe(l,r,!0).then(()=>this._subscribe(l,r,!0).catch(h=>{v.error("[".concat(this._clientId,"] resubscribe error"),h.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(l,r)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,r,!0).catch(d=>{v.error("[".concat(this._clientId,"] resubscribe error"),d.toString())}))}),y(this,"_handleRemoveStream",r=>{if(b("BLOCK_LOCAL_CLIENT")&&ls(r.uid,this.channelName))return;let n=this._users.find(o=>o.uid===r.uid);if(!n)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let i=()=>{};n.hasAudio&&n.hasVideo?i=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished audio track")),this.safeEmit(Ce.USER_UNPUBLISHED,n,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished video track")),this.safeEmit(Ce.USER_UNPUBLISHED,n,"video")}:n.hasVideo?i=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished video track")),this.safeEmit(Ce.USER_UNPUBLISHED,n,"video")}:n.hasAudio&&(i=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished audio track")),this.safeEmit(Ce.USER_UNPUBLISHED,n,"audio")}),n._video_pre_subscribed||n._audio_pre_subscribed||(n._trust_audio_stream_added_state_=!0,n._trust_video_stream_added_state_=!0,n._audio_added_=!1,n._video_added_=!1,this._p2pChannel instanceof Dp&&this._p2pChannel.unsubscribe(n).then(o=>{if(o)return this._gateway.unsubscribe(o,n.uid)}),n._audioSSRC=void 0,n._videoSSRC=void 0,n._audioOrtc=void 0,n._videoOrtc=void 0,n._rtxSsrcId=void 0),te.onGatewayStream(this._sessionId,$t.ON_REMOVE_STREAM,st.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),i()}),y(this,"_handleSetStreamLocalEnable",(r,n,i)=>{if(b("BLOCK_LOCAL_CLIENT")&&ls(n,this.channelName))return;let o=this._users.find(c=>c.uid===n);if(!o)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(i?"enabled":"disabled"," with uid ").concat(n));let a=r==="audio"?o.hasAudio:o.hasVideo;if(r==="audio"){o._trust_audio_enabled_state_=!0;let c=o._audio_enabled_;if(o._audio_enabled_=i,o._audio_enabled_===c)return;{let l=o._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(n,", msg: ").concat(l)),this.safeEmit(Ce.USER_INFO_UPDATED,n,l)}}else{o._trust_video_enabled_state_=!0;let c=o._video_enabled_;if(o._video_enabled_=i,o._video_enabled_===c)return;{let l=o._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(l)),this.safeEmit(Ce.USER_INFO_UPDATED,n,l)}}let s=r==="audio"?o.hasAudio:o.hasVideo;return a!==s?!a&&s?(v.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(Ce.USER_PUBLISHED,o,r)):(r==="video"&&o._videoTrack&&o._videoTrack._destroy(),r==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,r),v.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),void this.safeEmit(Ce.USER_UNPUBLISHED,o,r)):void 0}),y(this,"_handleMuteStream",(r,n,i)=>{if(b("BLOCK_LOCAL_CLIENT")&&ls(r,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),r,n,i);let o=this._users.find(c=>c.uid===r);if(!o)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));let a=n==="audio"?o.hasAudio:o.hasVideo;if(n==="audio"){o._trust_audio_mute_state_=!0;let c=o._audio_muted_;if(o._audio_muted_=i,o._audio_muted_===c)return;{let l=o._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(l)),this.safeEmit(Ce.USER_INFO_UPDATED,r,l)}}else{o._trust_video_mute_state_=!0;let c=o._video_muted_;if(o._video_muted_=i,o._video_muted_===c)return;{let l=o._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(l)),this.safeEmit(Ce.USER_INFO_UPDATED,r,l)}}let s=n==="audio"?o.hasAudio:o.hasVideo;if(a!==s){if(!a&&s)return(n==="audio"?o._audioSSRC:o._videoSSRC)?(v.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(Ce.USER_PUBLISHED,o,n)):void v.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(n," unmute message  before add stream message, ").concat(n," SSRC doesn't exist yet."));n==="video"&&o._videoTrack&&!o._video_pre_subscribed&&o._videoTrack._destroy(),n==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,n),v.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),this.safeEmit(Ce.USER_UNPUBLISHED,o,n)}}),y(this,"_handleP2PLost",async r=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),y(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ce.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),y(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),y(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ce.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ce.NETWORK_QUALITY,r)}),y(this,"_handleP2PAddAudioOrVideoStream",(r,n,i,o)=>{let a=this._users.find(c=>c.uid===n);if(!a)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(n,", type ").concat(r)),this.store.subscribe(a.uid,r,void 0,void 0,void 0,Date.now());let s=r==="audio"?a.hasAudio:a.hasVideo;r==="audio"?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,r==="audio"?(a._audio_added_=!0,i!==void 0&&(a._audioSSRC=i),o!==void 0&&(a._audioMid=o)):(a._video_added_=!0,i!==void 0&&(a._videoSSRC=i),o!==void 0&&(a._videoMid=o)),(r==="audio"?a.hasAudio:a.hasVideo)&&!s&&(v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(r)),this.safeEmit(Ce.USER_PUBLISHED,a,r)),this._p2pChannel.hasPendingRemoteMedia(a,r)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,r,!0).catch(c=>{v.error("[".concat(this._clientId,"] resubscribe error"),c.toString())}))}),this._config=e,this._clientId=Ke(5,"client-"),this.store=new f$(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(zn," build: ").concat(AR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{WA(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(r){v.warning("[".concat(this._clientId,"] ").concat(r.toString()))}this._statsCollector=new HV(this.store),this._statsCollector.onStatsException=(r,n,i)=>{v.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(n,", uid: ").concat(i)),this.safeEmit(Ce.EXCEPTION,{code:r,msg:n,uid:i})},this._statsCollector.onUploadPublishDuration=(r,n,i,o)=>{let a=this._users.find(s=>s.uid===r);a&&te.peerPublishStatus(this._sessionId,{subscribeElapse:o,audioPublishDuration:n,videoPublishDuration:i,peer:a._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new HX(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Pt,httpRetryConfig:e.httpRetryConfig||Pt,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new eJ,this.store.useP2P?(this._p2pChannel=new an(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Dp(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,n,i){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],a=arguments.length>6&&arguments[6]!==void 0&&arguments[6];je("JOIN_GATEWAY_USE_443PORT_ONLY",o),je("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);let s=this._gateway.signal.websocket;return s instanceof OR&&(s.use443PortOnly=o,s.tryDoubleDomain=a),async function(c,l,u){up.get(c)||up.set(c,[]),dp.get(c)||dp.set(c,l),eo.get(c)||eo.set(c,0);let d=up.get(c),h=dp.get(c);if(!d||!h)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(eo.get(c)===h){let E=Bd();d.push(E),await E.promise}eo.set(c,eo.get(c)+1);for(var p=arguments.length,m=new Array(p>3?p-3:0),f=3;f<p;f++)m[f-3]=arguments[f];let _=await u(...m);return eo.set(c,eo.get(c)-1),eo.get(c)===h-1&&d.length>0&&(d[0].resolve(),d.shift()),eo.get(c)===0&&(up.set(c,[]),dp.set(c,0),eo.set(c,0)),_}("client.join",b("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,n,i)}async join(e,t,r,n,i){let o=++this._numberOfJoinCount;this.store.joinStart(),n&&(this.store.uid=n);let a=(pp||pp||(pp=(window.location.protocol.split(":")[0]||"").toUpperCase(),pp))==="HTTPS",s=XA()?window.isSecureContext:"Browser Not Support";(!XA()&&!a||!window.isSecureContext)&&v.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),te.setAppId(e);try{if(!r&&r!==null)throw new M(C.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&qt(r,"token",1,2047),qt(e,"appid",1,2047),v_(t),n&&S_(n),i&&qt(i,"optionalInfo",1,2047)}catch(f){throw te.reportApiInvoke(Xc(),{name:Lt.JOIN,options:[e,t,r,n],states:{isHttps:a,isSecureContext:s},tag:pt.TRACER}).onError(f),f}if(this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let f=new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw te.reportApiInvoke(Xc(),{name:Lt.JOIN,options:[e,t,r,n],states:{isHttps:a,isSecureContext:s},tag:pt.TRACER}).onError(f),f}this._gateway.state="CONNECTING";let c=await CP({appId:e,cname:t,uid:n,stringUid:typeof n=="string"?n:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let l=(c==null?void 0:c.sid)||Xc();v.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);let u=te.reportApiInvoke(l,{name:Lt.JOIN,options:[e,t,r,n],states:{isHttps:a,isSecureContext:s},tag:pt.TRACER}),d=Vi(Vi({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof n!="string"?n:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(d.setLocalAPVersion=this._setLocalAPVersion),typeof n=="string"&&(d.stringUid=n,this._uintUid?(d.uid=this._uintUid,this._uintUid=void 0):d.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(d.aesmode=this._encryptionMode,d.aespassword=await(async f=>{let _=function(R){let w=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),A=new Uint8Array(new ArrayBuffer(w.length));for(let N=0;N<w.length;N+=1)A[N]=w.charCodeAt(N);return A}(),E=await window.crypto.subtle.importKey("spki",_,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),g=RR(f),T=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},E,g);return function(R){let w="";for(let A=0;A<R.length;A+=1)w+=String.fromCharCode(R[A]);return window.btoa(w)}(new Uint8Array(T))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let f=new TextEncoder,_=b("USE_PURE_ENCRYPTION_MASTER_KEY")?f.encode(d.appId+this._encryptionSecret+this._encryptionSecret):f.encode(d.appId+d.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(E,g,T){let R=await window.crypto.subtle.importKey("raw",g,"PBKDF2",!1,["deriveBits","deriveKey"]),w=E==="aes-128-gcm2"?128:256,A=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:QA,hash:"SHA-256",salt:T},R,w+m$);return new Uint8Array(A).subarray(w/8)}(this._encryptionMode,_,Os(this._encryptionSalt)),this._encryptDataStreamKey=await async function(E,g,T){let R=await window.crypto.subtle.importKey("raw",g,"PBKDF2",!1,["deriveBits","deriveKey"]),w=E==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:QA,hash:"SHA-256",salt:T},R,{name:"AES-GCM",length:w},!0,["encrypt","decrypt"])}(this._encryptionMode,_,Os(this._encryptionSalt))}else s?v.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):v.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,v.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:d.stringUid});let h=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&h===this._sessionId&&te.joinChannelTimeout(this._sessionId,5)},5e3);try{var p;let f,_=d.cloudProxyServer;if(q(p=["proxy3","proxy4","proxy5"]).call(p,_)){let w=b("PROXY_SERVER_TYPE3");Array.isArray(w)?d.proxyServer=w[0]:d.proxyServer=w}if(te.setProxyServer(d.proxyServer),v.setProxyServer(d.proxyServer),this.store.requestAPStart(),c){if(v.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(d.stringUid?", ".concat(d.stringUid," => ").concat(c.intUid):""," ")),d.stringUid&&!d.uid&&(d.uid=c.intUid),f={gatewayInfo:c.ap.gatewayInfo},b("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&d.turnServer.mode==="auto")if(c.ap.proxyInfo.addresses.length===0)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let w=(await Hx(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map(A=>({turnServerURL:A.address,tcpport:A.tcpport||ir.tcpport,udpport:A.udpport||ir.udpport,username:A.username||ir.username,password:A.password||ir.password,forceturn:!1,security:!0}));d.turnServer={mode:"manual",servers:w}}IP(c,d.stringUid)}else{if(d.stringUid&&!d.uid){let w;[w,f]=await Y.all([MV(d.stringUid,d,this._axiosCancelSource.token,this._config.httpRetryConfig||Pt,this.store),AN(d,this._axiosCancelSource.token,this._config.httpRetryConfig||Pt,!0,this.store)]),v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d.stringUid," => ").concat(w)),d.uid=w,f.gatewayInfo.uid=w,f.gatewayInfo.res.uid=w}else f=await AN(d,this._axiosCancelSource.token,this._config.httpRetryConfig||Pt,!0,this.store);if(!this._joinAndNotLeaveYet)throw new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(d,this._axiosCancelSource.token),this._configDistribute.on(gT.UPDATE_BITRATE_LIMIT,w=>{this._p2pChannel.updateBitrateLimit(w)})},0),this._key=r||e;let E=f.gatewayInfo,g=d.uid?d.uid:E.uid;this._joinInfo=Vi(Vi({},d),{},{cid:E.cid,uid:g,vid:E.vid,apResponse:E.res,apGatewayAddress:E.apGatewayAddress,uni_lbs_ip:E.uni_lbs_ip,gatewayAddrs:E.gatewayAddrs}),this.store.intUid=g;let T=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));u.onSuccess(T),this._appId=e,this._channelName=d.cname,this._uid=T,this.store.uid=T,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(cr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let R=d.stringUid?"string uid: ".concat(d.stringUid,",uid: ").concat(d.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(R)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),m=this,q(ya).call(ya,m)||ya.push(m),this._cloudProxyServerMode==="disabled"&&Pe().supportWebCrypto&&b("ENABLE_PRELOAD")&&YR(this._joinInfo),T}catch(f){let _=Array.isArray(f)?f[0]:f;throw _&&_.code===C.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),_):v.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),_),_.code!==C.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),u.onError(_),_}var m}_joinGateway(){if(!this._joinInfo||!this._key)throw new M(C.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!b("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(cr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let r=ya.indexOf(t);r!==-1&&ya.splice(r,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Zc))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new M(C.INVALID_PARAMS,"param list is empty");let r=e;if(this._gateway.role==="audience")throw new M(C.INVALID_OPERATION,"audience can not publish stream");for(let i of r){if(!(i instanceof Zc))throw new M(C.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new M(C.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(i=>"".concat(i.getTrackId()," "))));let n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(i=>{let o=this._configDistribute.getBitrateLimit();i instanceof Xe&&o&&i.setBitrateLimit(o.uplink)});try{await this._publishHighStream(r),v.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw v.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{n()}}async _publishDataChannel(e){Be(e.id,"id",0,65535,!0),Ho(e.ordered,"ordered"),qt(e.metadata,"metadata",0,512),v.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new M(C.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new M(C.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&b("FORCE_TURN")&&!b("TURN_ENABLE_TCP")&&!b("TURN_ENABLE_UDP"))throw new M(C.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let r=function(i){return vP(i,!1)}(e),n=await this._p2pChannel.publishDataChannel([r]);if(n.length>0){if(typeof r._originDataChannelId!="number")throw v.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new M(C.CREATE_DATACHANNEL_ERROR);try{await Y.all(n.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await r._waitTillOpen()}catch(i){if(i.code!==C.DISCONNECT_P2P)throw i}}return v.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw v.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new M(C.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Zc))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(n=>"".concat(n.getTrackId()," "))," "));let r=await this._publishMutex.lock();try{if(this._p2pChannel instanceof an){let n=await this._p2pChannel.unpublish(t);n&&await this._gateway.sendExtensionMessage(Et.UNPUBLISH,{unpubMsg:n},!0)}else{let n=await this._p2pChannel.unpublish(t);n&&await this._gateway.unpublish(n,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(n){throw v.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),v.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));let t=await this._publishMutex.lock();try{let r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),v.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(n=>"".concat(n.id))))}catch(r){throw v.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof Ca)){let n=this.remoteUsers.find(i=>i.uid===e);if(!n)throw new M(C.INVALID_REMOTE_USER,"user is not in the channel");e=n}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(Ut(t,"mediaType",["audio","video"]),this._p2pChannel instanceof an)throw new M(C.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new M(C.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r=t===re.AUDIO,n=t===re.VIDEO,i=await this._subscribeMutex.lock();try{let{ssrcId:o,ortc:a,rtxSsrcId:s,cname:c,uint_id:l}=await this._gateway.presubscribe(e,t,!0);if(o==null)throw new M(C.UNEXPECTED_RESPONSE,"no ssrc id");let u=this._users.find(h=>h.uid===e);u||(u=new Ca(e,l||e),u._is_pre_created=!0,this._users.push(u)),c&&(u._cname=c),u._uintid||(u._uintid=l||e),r&&(u._audioSSRC=o,u._audio_pre_subscribed=!0,a&&(u._audioOrtc=a)),n&&(u._videoSSRC=o,u._video_pre_subscribed=!0,a&&(u._videoOrtc=a),s!=null&&(u._rtxSsrcId=s)),v.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(u,t,o,s,a);let d=r?u._audioTrack:u._videoTrack;if(!d)throw new M(C.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(u._trust_audio_stream_added_state_=!0,u._audio_added_=!0),n&&(u._trust_video_stream_added_state_=!0,u._video_added_=!0),d}catch(o){throw v.error("[".concat(this._clientId,"] presub user ").concat(e," error"),o),o}finally{i()}}async _subscribeDataChannel(e,t){var r;if(Be(t,"channelId",0,65535,!0),!this._joinInfo)throw new M(C.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e))throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new M(C.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new M(C.INVALID_REMOTE_USER,"user is not published");let n=(r=e._dataChannels)===null||r===void 0?void 0:r.find(a=>a.id===t);if(!n)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new M(C.REMOTE_USER_IS_NOT_PUBLISHED);let i=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let a=await this._p2pChannel.subscribeDataChannel(e,[n]);if(a&&q(a).call(a,n.id))try{var o;if(typeof n._originDataChannelId!="number")throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new M(C.CREATE_DATACHANNEL_ERROR);let s={id:n.id,datachannelId:n._originDataChannelId,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:(o=n.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,s,!0),await n._waitTillOpen()}catch(s){if((s==null?void 0:s.code)!==C.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[n]),s;await this._p2pChannel.unsubscribeDataChannel(e,[n]),this._p2pChannel.setPendingRemoteDataChannel(e,n.id)}return v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),n}finally{i()}}async _p2pSubscribe(e,t,r){if(Ut(t,"mediaType",["audio","video"]),!this._joinInfo)throw new M(C.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(i=>i===e)){let i=new M(C.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),i}if(!e.hasAudio&&!e.hasVideo){let i=new M(C.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),i}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let i=new M(C.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),i}let n=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let o=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof an&&await this._p2pChannel.subscribe(e,t,o,a)}catch(o){throw o}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});let i=t==="audio"?e._audioTrack:e._videoTrack;if(!i)throw new M(C.UNEXPECTED_ERROR,"can not find remote track in user object");return i}catch(i){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),i),i}finally{n()}}async _subscribe(e,t,r){if(this._p2pChannel instanceof an)return this._p2pSubscribe(e,t);if(Ut(t,"mediaType",["audio","video"]),!this._joinInfo)throw new M(C.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){let c=new M(C.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){let c=new M(C.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let c=new M(C.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}let n=t==="audio"?e._audioSSRC:e._videoSSRC,i=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,a={stream_type:t==="audio"?re.AUDIO:re.VIDEO,ssrcId:n},s=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let l=t==="audio"?e._audioSSRC:e._videoSSRC;l!==void 0&&l!==n&&(n=l,i=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,a={stream_type:t==="audio"?re.AUDIO:re.VIDEO,ssrcId:n}),fr.markSubscribeStart(this.store.clientId,n),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,n,o,i);try{this._p2pChannel.isPreSubScribe(n)||await this._gateway.subscribe(e.uid,a,!0)}catch(u){if((u==null?void 0:u.code)!==C.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),u;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(l){throw this._p2pChannel.reportSubscribeEvent(!1,l==null?void 0:l.code,e,t),l}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(l=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});let c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new M(C.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{s()}}async massSubscribe(e){if(jo(e,"subscribeList"),!this._joinInfo)throw new M(C.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),r=new Map,n=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(s=>{let{user:c,mediaType:l}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(l)}).join("; ")));let i=(e=[...e]).map(s=>{let{user:c,mediaType:l}=s;return{user:c,mediaType:l}}),o=await this._p2pChannel.globalLock();try{var a;for(let c=e.length-1;c>=0;c--){let l=e[c],{user:u,mediaType:d}=l;if(Ut(d,"mediaType",["audio","video"]),!u){let m=new M(C.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),m}if(!this._users.find(m=>m===u)){let m=new M(C.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(u.uid,", this user is not in the channel")),i[c].error=m,e.splice(c,1);continue}if(d==="audio"&&(!u.hasAudio||u._audioSSRC===void 0)||d==="video"&&(!u.hasVideo||u._videoSSRC===void 0)){let m=new M(C.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(u.uid," with mediaType ").concat(d,", remote user is not published")),i[c].error=m,e.splice(c,1);continue}let h=jt.Video|jt.LwoVideo,p=r.get(u);if(p){if(d==="video"?p&h:p&jt.Audio){e.splice(c,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(u.uid,", mediaType:").concat(d," twice"));continue}r.set(u,p|(d==="video"?h:jt.Audio))}else r.set(u,d==="video"?h:jt.Audio)}for(let c=e.length-1;c>=0;c--){let l=e[c],{user:u,mediaType:d}=l,h=jt.Video|jt.LwoVideo;if(this._p2pChannel.hasRemoteMedia(u,d)){await this._p2pChannel.unmuteRemoteNoLock(u,d);let p=r.get(u);r.set(u,d==="video"?p^h:p^jt.Audio),e.splice(c,1)}}this.store.massSubscribe(e.map(c=>({userId:c.user.uid,type:c.mediaType})),t);let s=qi(a=Array.from(r.entries())).call(a,(c,l)=>{let[u,d]=l;if(d===0)return c;let h={stream_id:u.uid,stream_type:d};return d&jt.Audio&&(h.audio_ssrc=u._audioSSRC),d&jt.Video&&(h.video_ssrc=u._videoSSRC),c.push(h),c},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(l=>{let{user:u,mediaType:d}=l;return{user:u,mediaType:d,ssrcId:d===re.VIDEO?u._videoSSRC:u._audioSSRC,rtxSsrcId:d===re.VIDEO?u._rtxSsrcId:void 0}}));let c=new Map;if(s=s.filter(l=>l.video_ssrc&&!this._p2pChannel.isPreSubScribe(l.video_ssrc)||l.audio_ssrc&&!this._p2pChannel.isPreSubScribe(l.audio_ssrc)||!l.video_ssrc&&!l.audio_ssrc),s.length>0){let l=await this._gateway.subscribeAll(s,!0);((l==null?void 0:l.users)||[]).forEach(u=>{let{stream_id:d,video_error_code:h,audio_error_code:p,error_code:m}=u;(h||p||m)&&c.set(d,{video_error_code:h,audio_error_code:p,error_code:m})})}if(Array.from(c.entries()).length>0){let l=[];Array.from(c.entries()).forEach(u=>{let[d,h]=u,p=this.remoteUsers.find(m=>m.uid===d);if(p){let m;h.error_code||h.video_error_code&&h.audio_error_code?m=void 0:h.video_error_code?m=re.VIDEO:h.audio_error_code&&(m=re.AUDIO),l.push({user:p,mediaType:m})}}),l.length>0&&await this._p2pChannel.massUnsubscribeNoLock(l)}for(let l of i){let u=c.get(l.user.uid);if(u){let d=u.error_code||l.mediaType==="audio"&&u.audio_error_code||l.mediaType==="video"&&u.video_error_code;if(d){let h=Kd(d);v.error("user:".concat(l.user.uid," mediaType:").concat(l.mediaType," has massSubscribe error ").concat(h.desc)),l.error=new M(C.SUBSCRIBE_FAILED,"code ".concat(d,": ").concat(h.desc))}}l.error||(l.mediaType==="video"?l.track=l.user.videoTrack:l.track=l.user.audioTrack)}return this.store.massSubscribe(i.filter(l=>!l.error).map(l=>({userId:l.user.uid,type:l.mediaType})),void 0,Date.now()),i.forEach(l=>{var u;te.subscribe(this.store.sessionId,{succ:!!l.error,ec:((u=l.error)===null||u===void 0?void 0:u.code)||null,video:l.mediaType===re.VIDEO,audio:l.mediaType===re.AUDIO,peerid:l.user.uid,subscribeRequestid:l.mediaType===re.VIDEO?l.user._videoSSRC:l.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(l.user._videoSSRC)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(l=>{let{user:u,mediaType:d}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(d)}).join("; "))),i}catch(c){throw await this._p2pChannel.massUnsubscribeNoLock(e),c}}finally{o(),n()}}async unsubscribe(e,t,r){if(!(e instanceof Ca)){let i=this.remoteUsers.find(o=>o.uid===e);if(!i)throw new M(C.INVALID_REMOTE_USER,"user is not in the channel");e=i}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&Ut(t,"mediaType",["audio","video"]),!this._joinInfo)throw new M(C.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(i=>i===e)){let i=new M(C.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let n=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof an)await this._p2pChannel.unsubscribe(e,t);else{let i=await this._p2pChannel.unsubscribe(e,t);i&&await this._gateway.unsubscribe(i,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&dm(this._users,e),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(i){if(i.code===C.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}finally{n()}}async _unsubscribeDataChannel(e,t){if(t&&Be(t,"id",0,65535,!0),!this._joinInfo)throw new M(C.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(n=>n===e)){let n=new M(C.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),n}let r;if(typeof t=="number"){let n=e._dataChannels.find(i=>i.id===t);n&&(r=[n])}else r=e._dataChannels;if(r===void 0){let n=new M(C.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(n=>n.id)));try{let n=await this._p2pChannel.unsubscribeDataChannel(e,r);n&&await this._gateway.unsubscribeDataChannel(n,e.uid),v.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n))}catch(n){if(n.code===C.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),n.toString()),n}}async massUnsubscribe(e){if(jo(e,"unsubscribeList"),!this._joinInfo)throw new M(C.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:n,mediaType:i}=r;return"user: ".concat(n==null?void 0:n.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:n,mediaType:i}=e[r];if(!n){let a=new M(C.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a}if(Ut(i,"mediaType",["video","audio",void 0]),!this._users.find(a=>a===n)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),e.splice(r,1);continue}let o=jt.Video|jt.LwoVideo;if(t.has(n)){let a=t.get(n),s;switch(i){case"video":s=a&o;break;case"audio":s=a&jt.Audio;break;default:s=a&(jt.Audio|o)}if(s){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n.uid,",mediaType:").concat(i," twice.")),e.splice(r,1);continue}i?i==="audio"?t.set(n,a|jt.Audio):i==="video"&&t.set(n,a|o):t.set(n,a|jt.Audio|o)}else i?i==="audio"?t.set(n,jt.Audio):i==="video"&&t.set(n,o):t.set(n,jt.Audio|o)}try{let r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(o,";")}).join()))}catch(r){if(r.code===C.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new V(C.INVALID_PARAMS);at(r.width)||fg(r.width,"streamParameter.width"),at(r.height)||fg(r.height,"streamParameter.height"),at(r.framerate)||fg(r.framerate,"streamParameter.framerate"),at(r.bitrate)||Be(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,H.LocalVideoLowTrack)}async enableDualStream(){if(!Pe().supportDualStream)throw te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new M(C.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new M(C.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new M(C.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(H.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){Ut(r,"role",["audience","host"])}(e),t&&WA(t),this.mode==="rtc"||this.mode==="p2p")throw v.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new M(C.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new M(C.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new M(C.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,v.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(qt(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new M(C.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new M(C.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,te.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new M(C.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new M(C.INVALID_OPERATION,"You have already set the proxy")}if(m_(e))return this._turnServer={servers:e,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>Nx(r)),this._turnServer={servers:e,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new M(C.INVALID_OPERATION,"you should set license before join channel");if(qt(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new M(C.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,v.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new M(C.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new M(C.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new M(C.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new M(C.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new M(C.INVALID_OPERATION,"Stop proxy server after leave channel");te.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new M(C.INVALID_PARAMS,"accessPoints is required.");jo(e.accessPoints.serverList,"accessPoints.serverList"),qt(e.accessPoints.domain,"accessPoints.domain");let t=(h,p)=>{Be(h,p,0,65535,!0)},r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new M(C.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");b("CLOSE_AFB_FOR_LOCAL_AP")&&(je("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),je("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let n=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map(h=>n.test(h)?"".concat(h.replace(/\./g,"-"),".").concat(i):h),a=o.map(h=>"".concat(h,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,je("WEBCS_DOMAIN",a),je("WEBCS_DOMAIN_BACKUP_LIST",a),je("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(jo(e.report.hostname,"report.hostname"),je("EVENT_REPORT_DOMAIN",e.report.hostname[0]),je("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(je("EVENT_REPORT_DOMAIN",o[0]),je("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),je("STATS_COLLECTOR_PORT",s),e.report?je("ENABLE_EVENT_REPORT",!0):je("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(jo(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),je("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let u=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(jo(e.cds.hostname,"cds.hostname"),u=e.cds.hostname):u=o;let d=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),d=e.cds.port),je("CDS_AP",u.map(h=>"".concat(h,":").concat(d))),e.cds?je("ENABLE_CONFIG_DISTRIBUTE",!0):je("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(jo(e,"serverList"),qt(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new M(C.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(n=>r.test(n)?"".concat(n.replace(/\./g,"-"),".").concat(t):n),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,je("WEBCS_DOMAIN",e),je("WEBCS_DOMAIN_BACKUP_LIST",e),je("GATEWAY_DOMAINS",[t]),je("EVENT_REPORT_DOMAIN",e[0]),je("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),je("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ut(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Ut(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let r=this._users.find(n=>n.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}v.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Ut(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw v.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}v.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,n){(function(o){Ut(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),qt(t,"secret");let i=["aes-128-gcm2","aes-256-gcm2"];if(q(i).call(i,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new M(C.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new M(C.INVALID_PARAMS,"current encrypt mode does not need salt");if(n){if(Ho(n,"encryptDataStream"),!q(i).call(i,e))throw new M(C.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=Ha(r))}async renewToken(e){if(qt(e,"token",1,2047),!this._key||!this._joinInfo)throw new M(C.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let r=await this._renewTokenMutex.lock();try{if(b("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let n=await ZX(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Pt);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:n})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(n){throw this._key=t,this._joinInfo.token=t,v.error("[".concat(this._clientId,"] renewToken failed"),n.toString()),n}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(Ce.VOLUME_INDICATOR,e)},b("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new M(C.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new M(C.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new M(C.LIVE_STREAMING_TASK_CONFLICT);let r=t?Yo.TRANSCODE:Yo.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(Yo.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new M(C.INVALID_PARAMS,"can not find live streaming url to stop");await Y.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){aP(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){aP(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new M(C.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let i=new TextEncoder;e.payload=i.encode(e.payload)}let n=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&q(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(n=!0,e.payload=await async function(i,o,a){var s;let c=qi(s=Array.from(a)).call(s,(f,_)=>f+_,0),l={serverTs:0,seq:_$++,length:a.length,checkSum:c},u=new Uint8Array(qA(c,2)),d=new ArrayBuffer(fc),h=new DataView(d);h.setUint32(0,l.serverTs),h.setUint16(4,l.seq),h.setUint16(6,l.length),h.setUint16(8,l.checkSum);let p=16-a.length%16;a=KA(a,new Uint8Array(p));let m=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:JA,additionalData:u},o,a);return KA(new Uint8Array(d),new Uint8Array(m))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new M(C.INVALID_PARAMS,n?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(de.DATA_STREAM,{payload:Ha(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-CJ},!r)}sendMetadata(e){if(!this._joinInfo)throw new M(C.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new M(C.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(de.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ha(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(g$),!this._joinInfo)throw new M(C.INVALID_OPERATION,"can not send custom report, not joined");await te.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Ut(t.spatialLayer,"spatialLayer",[0,1,2,3]),Ut(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:r}=e;if(Ho(t,"apRTM"),Be(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,v.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=$r.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&ZV(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new _r("client-publish"),this._subscribeMutex=new _r("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;let n=e||Xc();e?v.debug("[".concat(this._clientId,"] new Session ").concat(n)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n));let i=e?"":this._sessionId||"";this._sessionId=n,this.store.sessionId=n;let o={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};te.sessionInit(this._sessionId,Vi({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new M(C.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&b("FORCE_TURN")&&!b("TURN_ENABLE_TCP")&&!b("TURN_ENABLE_UDP"))throw new M(C.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof an){let n=(await r.next()).value;if(n){try{await this._gateway.sendExtensionMessage(Et.PUBLISH,n,!0)}catch(i){throw r.throw(i),i}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let n=(await r.next()).value;if(n){var t;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(o){if(o.code!==C.DISCONNECT_P2P)throw r.throw(o),o}await r.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let i of e)i instanceof Xe&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===C.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new M(C.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(C.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await r.next()).value;if(n){var t;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(o){if(o.code!==C.DISCONNECT_P2P)throw r.throw(o),o}r.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===C.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new M(C.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let r=(n={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Gu("LiveStreaming").create(n));var n;return r.onLiveStreamError=(i,o)=>{te.reportApiInvoke(this._sessionId,{name:Lt.ON_LIVE_STREAM_ERROR,options:[i,o],tag:pt.TRACER}).onSuccess(),this.safeEmit(Ce.LIVE_STREAMING_ERROR,i,o)},r.onLiveStreamWarning=(i,o)=>{te.reportApiInvoke(this._sessionId,{name:Lt.ON_LIVE_STREAM_WARNING,options:[i,o],tag:pt.TRACER}).onSuccess(),this.safeEmit(Ce.LIVE_STREAMING_WARNING,i,o)},r.on(ET.REQUEST_WORKER_MANAGER_LIST,(i,o,a)=>{if(!this._joinInfo)return a(new M(C.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(s,c,l,u){let d=b("UAP_AP").slice(0,b("AJAX_REQUEST_CONCURRENT")).map(h=>c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap"));return await YX(d,s,c,l,u)})(i,this._joinInfo,this._axiosCancelSource.token,Pt).then(o).catch(a)}),r};return e===Yo.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new M(C.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),n=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},Gu("ChannelMediaRelay").create(e));n.on("state",i=>{i===Zr.RELAY_STATE_FAILURE&&n&&n.dispose(),this.safeEmit(Ce.CHANNEL_MEDIA_RELAY_STATE,i)}),n.on("event",i=>{this.safeEmit(Ce.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=n,this._statsCollector.onStatsChanged=(i,o)=>{var a;i==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(o))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:r,deleted:n}=e,i=[];if(t){let o=[];this._users.forEach(a=>{a._dataChannels.forEach(s=>{r.every(c=>c.uid!==a._uintid||c.stream_id!==s.id)&&o.push({uid:a._uintid,stream_id:s.id,ordered:s.ordered,max_retrans_times:s.maxRetransmits,metadata:s.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(r)&&r.length>0&&r.forEach(o=>{let{uid:a,stream_id:s,ordered:c,max_retrans_times:l,metadata:u}=o,d=this._users.find(h=>h._uintid===a);if(!d)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(v.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(a)),q(i).call(i,d)||i.push(d),d._uintid||(d._uintid=a),d._dataChannels.findIndex(h=>h.id===o.stream_id)===-1){let h={id:s,ordered:!!c,maxRetransmits:l,metadata:u},p=function(m){return vP(m,!0)}(h);d._dataChannels.push(p),v.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published datachannel")),t||this.safeEmit(Ce.USER_PUBLISHED,d,"datachannel",h)}this._p2pChannel.hasPendingRemoteDataChannel(d,o.stream_id)&&(v.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(d.uid," after reconnect.")),this._subscribeDataChannel(d,o.stream_id).catch(h=>{v.error("[".concat(this._clientId,"] resubscribe datachannel error"),h.toString())}))}),t&&(this.safeEmit(Ce.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n)&&n.length>0&&n.forEach(o=>{let{uid:a,stream_id:s}=o,c=this._users.find(u=>u._uintid===a);if(!c)return void v.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let l=c._dataChannels.find(u=>u.id===o.stream_id);l&&(v.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(a)),this._p2pChannel.unsubscribeDataChannel(c,[l]).then(u=>{if(c._dataChannels=c._dataChannels.filter(d=>d!==l),u)return this._gateway.unsubscribeDataChannel(u,c.uid)}),v.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished datachannel ,id:").concat(l.id)),this.safeEmit(Ce.USER_UNPUBLISHED,c,"datachannel",l._config))})}_handleRemoveDataChannels(e){let t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){v.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let r=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(n=>{this.safeEmit(Ce.USER_UNPUBLISHED,t,"datachannel",n._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(n=>{if(n)return this._gateway.unsubscribeDataChannel(n,t.uid)}),r()}}else v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(nr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(nr.CONNECTION_STATE_CHANGE,(e,t,r)=>{var n;if(r===Ve.FALLBACK)return;let i=()=>{this.safeEmit(Ce.CONNECTION_STATE_CHANGE,e,t,r)};if(te.reportApiInvoke(this._sessionId||((n=this._gateway.joinInfo)===null||n===void 0?void 0:n.sid)||null,{name:Lt.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:pt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),v.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(a=>{a._trust_in_room_=!1,a._trust_audio_enabled_state_=!1,a._trust_video_enabled_state_=!1,a._trust_audio_mute_state_=!1,a._trust_video_mute_state_=!1,a._trust_audio_stream_added_state_=!1,a._trust_video_stream_added_state_=!1,a._is_pre_created||(a._audio_pre_subscribed||(a._audioSSRC=void 0,a._audioOrtc=void 0),a._video_pre_subscribed||(a._videoSSRC=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),a._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((a,s)=>{this._gateway.setStreamFallbackOption(s,a).catch(c=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),c)})}),this._remoteStreamTypeCacheMap.forEach((a,s)=>{this._gateway.setRemoteVideoStreamType(s,a).catch(c=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),c)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(a=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(a))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(a=>!a._trust_in_room_).forEach(a=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(a.uid)),this._handleUserOffline({uid:a.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(a=>{a._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,re.AUDIO,!1)),a._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,re.VIDEO,!1)),a._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(a.uid)),this._handleSetStreamLocalEnable("audio",a.uid,!0)),a._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(a.uid)),this._handleSetStreamLocalEnable("video",a.uid,!0)),a._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(a.uid)),this._handleResetAddStream(a,"video")),a._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(a.uid)),this._handleResetAddStream(a,"audio")),a._video_added_||a._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(a.uid)),this._handleRemoveStream({uid:a.uid,uint_id:a._uintid}))}))},1e3))}i()}),this._gateway.on(nr.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new M(C.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r,n=await CP(Vi(Vi({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(r=n.ap,IP(n),this._joinInfo.preload=!0):(r=await NT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Pt,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);let i=[];r.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:a}=o,[s,c]=a.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:s,port:c}):i.push({host:s,port:c})}),e(i)}catch(r){t(r)}}),this._gateway.on(nr.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ce.NETWORK_QUALITY,e)}),this._gateway.on(nr.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Ce.STREAM_TYPE_CHANGED,e,t),te.reportApiInvoke(this._sessionId,{name:Lt.STREAM_TYPE_CHANGE,options:[e,t],tag:pt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(nr.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(nr.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let n=await this._p2pChannel.getEstablishParams();b("ENABLE_PREALLOC_PC")&&n||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(n){r(n)}}),this._gateway.on(nr.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r=SN(e.ortc,t,e.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(r)}),this._gateway.on(nr.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var n;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:i,cid:o}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(i),icePwd:"".concat(o,"_").concat(i)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(n=b("FINGERPRINT"))!==null&&n!==void 0?n:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ye.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ye.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ye.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(ye.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(ye.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(ye.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ye.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ye.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ye.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,re.AUDIO,!0)),this._gateway.signal.on(ye.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,re.AUDIO,!1)),this._gateway.signal.on(ye.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,re.VIDEO,!0)),this._gateway.signal.on(ye.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,re.VIDEO,!1)),this._gateway.signal.on(ye.RECEIVE_METADATA,e=>{let t=Os(e.metadata);this.safeEmit(Ce.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(ye.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=Os(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&q(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<fc)throw new M(C.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(fc));r=await async function(i,o,a){let s=a.subarray(0,fc),c=s.slice(8,fc),l=(c[0]<<8)+c[1],u=(s[6]<<8)+s[7],d=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:i,tagLength:JA,additionalData:new Uint8Array(qA(l,2))},o,a.subarray(fc));return new Uint8Array(d).subarray(0,u)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let n=0;if(e.ordered||e.syncWithAudio){let i=this._p2pChannel.getStats(),o=this.remoteUsers.find(s=>s.uid===e.uid),a=i==null?void 0:i.audioRecv.find(s=>s.ssrc===(o==null?void 0:o._audioSSRC));n=a==null?void 0:a.jitterBufferMs}n==null&&(n=0),wJ(Vi(Vi({},e),{},{payload:r}),n,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ye.ON_CRYPT_ERROR,()=>{Qa(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ce.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ye.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ve.TOKEN_EXPIRE),this.safeEmit(Ce.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ye.ON_STREAM_FALLBACK_UPDATE,e=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Ce.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ye.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(ye.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(ye.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(he.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case de.PUBLISH:{if(!t)return;let i=t.ortc;if(i){var r,n;let o=i.some(c=>{let{stream_type:l}=c;return l===Me.Audio}),a=i.some(c=>{let{stream_type:l}=c;return l!==Me.Audio}),s=i.some(c=>{let{stream_type:l}=c;return l===Me.Screen||l===Me.ScreenLow});t.state==="offer"&&te.publish(this._joinInfo.sid,{eventElapse:fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:C.TIMEOUT,audio:o,video:a,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:s,audioName:o?(r=i.find(c=>{let{stream_type:l}=c;return l===Me.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:a?(n=i.find(c=>{let{stream_type:l}=c;return l!==Me.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0})}break}case de.SUBSCRIBE:t&&te.subscribe(this._joinInfo.sid,{succ:!1,ec:C.TIMEOUT,audio:t.stream_type===re.AUDIO,video:t.stream_type===re.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:fr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(ye.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(ye.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;b("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(n=>!ls(n.string_id||n.stream_id,this.channelName)));let t=[],r=[];for(let n of e.users){let i=this._users.find(u=>u._uintid===n.stream_id);i?i._trust_in_room_=!0:(i=new Ca(n.string_id||n.stream_id,n.stream_id),this._users.push(i),this.getListeners(Ce.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),n.stream_id),this.safeEmit(Ce.USER_JOINED,i)));let o=jt.Audio&n.stream_type,a=(jt.Video|jt.LwoVideo)&n.stream_type,s=(65280&n.stream_type)!=0,c=o&&i.hasAudio,l=a&&i.hasVideo;a&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=n.video_ssrc,i._rtxSsrcId=n.video_rtx),o&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=n.audio_ssrc),o&&!c&&this.getListeners(Ce.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Ce.USER_PUBLISHED,i,"audio")),a&&!l&&this.getListeners(Ce.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Ce.USER_PUBLISHED,i,"video")),(o&&!c||a&&!l||s)&&t.push(i),a&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&r.push({user:i,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&r.push({user:i,mediaType:"audio"})}r.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(n=>"user: ".concat(n.user.uid,", mediaType: ").concat(n.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(n=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),n.toString())})),this.getListeners(Ce.PUBLISHED_USER_LIST).length>0?b("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(n=>n.uid).join(", "))),this.safeEmit(Ce.PUBLISHED_USER_LIST,t)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(n=>n.uid).join(", ")))}),this._gateway.signal.on(ye.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof Dp&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var n;return q(n=Object.keys(g_)).call(n,r)}))})}_handleP2PEvents(){this._gateway.signal.on(ye.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Et.PUBLISH,(e,t,r)=>{let{uid:n}=e;e.forEach(i=>{let{kind:o,ssrcs:a,mid:s,isMuted:c}=i;this._handleP2PAddAudioOrVideoStream(o,n,a[0].ssrcId,s);let l=this._users.find(u=>u.uid===n);return l&&this._p2pChannel instanceof an?this._p2pChannel.mockSubscribe(l,o,a[0].ssrcId,s).then(()=>{t()}).catch(r):t(),this._handleMuteStream(n,o,!!c)})}),this._gateway.signal.on(Et.CALL,async(e,t,r)=>{if(this._p2pChannel instanceof an)try{var n;t(await this._p2pChannel.startP2P({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer},e))}catch(i){r(i)}}),this._gateway.signal.on(he.P2P_CONNECTION,async e=>{this._p2pChannel instanceof an&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(Et.UNPUBLISH,async(e,t,r)=>{if(this._p2pChannel instanceof an){let{unpubMsg:n,uid:i}=e,o=this._users.find(a=>a.uid===i);if(!o)return v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{n.forEach(async a=>{let{stream_type:s}=a,c=s===Me.Audio?re.AUDIO:re.VIDEO;await this._p2pChannel.unsubscribe(o,c),this._handleMuteStream(i,c,!0)}),t()}catch(a){r(a)}}}),this._gateway.signal.on(Et.CONTROL,async(e,t)=>{let{action:r}=e;switch(r){case Pa.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,re.VIDEO,!0);break;case Pa.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,re.AUDIO,!0);break;case Pa.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,re.VIDEO,!1);break;case Pa.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,re.AUDIO,!1)}}),this._gateway.signal.on(Et.RESTART_ICE,async(e,t,r)=>{if(this._p2pChannel instanceof an)try{let{direction:n,iceParameter:i}=e;n!==Ur.SEND_ONLY||i?t(await this._p2pChannel.restartICE(n,i)):(this._p2pChannel.handleDisconnect(n),t())}catch(n){r(n)}}),this._gateway.signal.on(Et.CANDIDATE,e=>{if(this._p2pChannel instanceof an){let{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(le.RequestP2PRestartICE,async(e,t,r)=>{try{let{direction:n}=e;t(await this._gateway.sendExtensionMessage(Et.RESTART_ICE,e,n===Ur.SEND_ONLY))}catch(n){r(n)}}),this._p2pChannel.on(le.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Et.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(le.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(Et.CONTROL,e,!0),t()}catch(n){r(n)}}),this._p2pChannel.on(le.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===C.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(le.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===C.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(le.StateChange,(e,t)=>{t===Le.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(le.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===C.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(le.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===C.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(le.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(le.RequestRePublishDataChannel,(e,t,r)=>{Y.all(e.map(async n=>{let i=await this._p2pChannel.publishDataChannel([n]);try{i.forEach(o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)})}catch(o){if(o.code!==C.DISCONNECT_P2P)throw o}})).then(t).catch(r)}),this._p2pChannel.on(le.RequestReSubscribe,async(e,t,r)=>{try{for(let{user:n,kind:i}of e)i===re.VIDEO?await this.subscribe(n,"video"):await this.subscribe(n,"audio");t()}catch(n){r(n)}}),this._p2pChannel.on(le.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(le.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(le.MediaReconnectStart,e=>{this.safeEmit(Ce.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(le.MediaReconnectEnd,e=>{this.safeEmit(Ce.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(le.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(le.RequestRestartICE,async e=>{if(this._p2pChannel instanceof an)return;let t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;let n=r.value,i;try{i=await this._gateway.restartICE({iceParameters:n})}catch(a){return void t.throw(a)}let{iceParameters:o}=function(a){let s=a.iceParameters;return{iceParameters:{iceUfrag:s.iceUfrag,icePwd:s.icePwd}}}(i);await t.next({remoteIceParameters:o})}),this._p2pChannel.on(le.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(le.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:r,rtpCapabilities:n}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:n}),a=SN(i,o);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(le.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(le.P2PLost,()=>{this.safeEmit(Ce.P2P_LOST,this.store.uid)}),this._p2pChannel.on(le.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(le.ConnectionTypeChange,e=>{this.safeEmit(Ce.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(le.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(le.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let r=(t={config:e},Gu("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);let{appId:n,cname:i,sid:o,token:a,uid:s,cid:c,vid:l}=this._joinInfo;await r.init({appId:n,areaCode:"",cname:i,sid:o,token:a,uid:s,cid:c,vid:l?Number(l):0},Pt)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(Kt.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(Ce.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===li.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ce.CONTENT_INSPECT_ERROR,new M(C.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Kt.INSPECT_RESULT,(t,r)=>{var n;if((r==null?void 0:r.code)===C.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(n=this._inspect)===null||n===void 0||n.close(),void(this._inspect=void 0);this.safeEmit(Ce.CONTENT_INSPECT_RESULT,t,r)}),e.on(Kt.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Ho(e,"enabled"),e){if(!t)throw new M(C.INVALID_PARAMS,"config is required");if(oF(t),!this._joinInfo)throw new M(C.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let n=(r={config:t},Gu("ImageModeration").create(r));this._moderation=n,this.handleImageModerationEvents(n);let{appId:i,cname:o,sid:a,token:s,uid:c,cid:l,vid:u}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:o,sid:a,token:s,uid:c,cid:l,vid:u?Number(u):0},Pt)}}catch(n){throw Array.isArray(n)?n[0]:n}}else{var r;if(!this._moderation)throw new M(C.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(e){e.on(Ui.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(Ce.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===xn.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new M(C.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Ui.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Ut(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new M(C.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,v.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Ho(e,"enabled"),je("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Z($.prototype,"leave",[LP],Object.getOwnPropertyDescriptor($.prototype,"leave"),$.prototype),Z($.prototype,"publish",[MP],Object.getOwnPropertyDescriptor($.prototype,"publish"),$.prototype),Z($.prototype,"unpublish",[UP],Object.getOwnPropertyDescriptor($.prototype,"unpublish"),$.prototype),Z($.prototype,"subscribe",[xP],Object.getOwnPropertyDescriptor($.prototype,"subscribe"),$.prototype),Z($.prototype,"presubscribe",[VP],Object.getOwnPropertyDescriptor($.prototype,"presubscribe"),$.prototype),Z($.prototype,"massSubscribe",[FP],Object.getOwnPropertyDescriptor($.prototype,"massSubscribe"),$.prototype),Z($.prototype,"unsubscribe",[jP],Object.getOwnPropertyDescriptor($.prototype,"unsubscribe"),$.prototype),Z($.prototype,"massUnsubscribe",[BP],Object.getOwnPropertyDescriptor($.prototype,"massUnsubscribe"),$.prototype),Z($.prototype,"setLowStreamParameter",[GP],Object.getOwnPropertyDescriptor($.prototype,"setLowStreamParameter"),$.prototype),Z($.prototype,"enableDualStream",[WP],Object.getOwnPropertyDescriptor($.prototype,"enableDualStream"),$.prototype),Z($.prototype,"disableDualStream",[HP],Object.getOwnPropertyDescriptor($.prototype,"disableDualStream"),$.prototype),Z($.prototype,"setClientRole",[KP],Object.getOwnPropertyDescriptor($.prototype,"setClientRole"),$.prototype),Z($.prototype,"setProxyServer",[zP],Object.getOwnPropertyDescriptor($.prototype,"setProxyServer"),$.prototype),Z($.prototype,"setTurnServer",[YP],Object.getOwnPropertyDescriptor($.prototype,"setTurnServer"),$.prototype),Z($.prototype,"setLicense",[$P],Object.getOwnPropertyDescriptor($.prototype,"setLicense"),$.prototype),Z($.prototype,"startProxyServer",[qP],Object.getOwnPropertyDescriptor($.prototype,"startProxyServer"),$.prototype),Z($.prototype,"stopProxyServer",[XP],Object.getOwnPropertyDescriptor($.prototype,"stopProxyServer"),$.prototype),Z($.prototype,"setLocalAccessPointsV2",[JP],Object.getOwnPropertyDescriptor($.prototype,"setLocalAccessPointsV2"),$.prototype),Z($.prototype,"setLocalAccessPoints",[QP],Object.getOwnPropertyDescriptor($.prototype,"setLocalAccessPoints"),$.prototype),Z($.prototype,"setRemoteDefaultVideoStreamType",[ZP],Object.getOwnPropertyDescriptor($.prototype,"setRemoteDefaultVideoStreamType"),$.prototype),Z($.prototype,"setRemoteVideoStreamType",[eD],Object.getOwnPropertyDescriptor($.prototype,"setRemoteVideoStreamType"),$.prototype),Z($.prototype,"setStreamFallbackOption",[tD],Object.getOwnPropertyDescriptor($.prototype,"setStreamFallbackOption"),$.prototype),Z($.prototype,"setEncryptionConfig",[rD],Object.getOwnPropertyDescriptor($.prototype,"setEncryptionConfig"),$.prototype),Z($.prototype,"renewToken",[nD],Object.getOwnPropertyDescriptor($.prototype,"renewToken"),$.prototype),Z($.prototype,"enableAudioVolumeIndicator",[iD],Object.getOwnPropertyDescriptor($.prototype,"enableAudioVolumeIndicator"),$.prototype),Z($.prototype,"startLiveStreaming",[oD],Object.getOwnPropertyDescriptor($.prototype,"startLiveStreaming"),$.prototype),Z($.prototype,"setLiveTranscoding",[aD],Object.getOwnPropertyDescriptor($.prototype,"setLiveTranscoding"),$.prototype),Z($.prototype,"stopLiveStreaming",[sD],Object.getOwnPropertyDescriptor($.prototype,"stopLiveStreaming"),$.prototype),Z($.prototype,"startChannelMediaRelay",[cD],Object.getOwnPropertyDescriptor($.prototype,"startChannelMediaRelay"),$.prototype),Z($.prototype,"updateChannelMediaRelay",[lD],Object.getOwnPropertyDescriptor($.prototype,"updateChannelMediaRelay"),$.prototype),Z($.prototype,"stopChannelMediaRelay",[uD],Object.getOwnPropertyDescriptor($.prototype,"stopChannelMediaRelay"),$.prototype),Z($.prototype,"sendCustomReportMessage",[dD],Object.getOwnPropertyDescriptor($.prototype,"sendCustomReportMessage"),$.prototype),Z($.prototype,"pickSVCLayer",[hD],Object.getOwnPropertyDescriptor($.prototype,"pickSVCLayer"),$.prototype),Z($.prototype,"setRTMConfig",[pD],Object.getOwnPropertyDescriptor($.prototype,"setRTMConfig"),$.prototype),Z($.prototype,"enableContentInspect",[fD],Object.getOwnPropertyDescriptor($.prototype,"enableContentInspect"),$.prototype),Z($.prototype,"disableContentInspect",[mD],Object.getOwnPropertyDescriptor($.prototype,"disableContentInspect"),$.prototype),Z($.prototype,"setImageModeration",[_D],Object.getOwnPropertyDescriptor($.prototype,"setImageModeration"),$.prototype),Z($.prototype,"setP2PTransport",[ED],Object.getOwnPropertyDescriptor($.prototype,"setP2PTransport"),$.prototype),Z($.prototype,"getJoinChannelServiceRecords",[gD],Object.getOwnPropertyDescriptor($.prototype,"getJoinChannelServiceRecords"),$.prototype),Z($.prototype,"setPublishAudioFilterEnabled",[vD],Object.getOwnPropertyDescriptor($.prototype,"setPublishAudioFilterEnabled"),$.prototype),$),aF=class xT{constructor(t,r){y(this,"id",0),y(this,"element",void 0),y(this,"peerPair",void 0),y(this,"context",void 0),y(this,"audioPlayerElement",void 0),y(this,"audioTrack",void 0),xT.count+=1,this.id=xT.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;let t=async(n,i)=>{let o=i==="offer"?await n.createOffer():await n.createAnswer();return await n.setLocalDescription(o),n.iceGatheringState==="complete"?n.localDescription:new Y(a=>{n.onicegatheringstatechange=()=>{n.iceGatheringState==="complete"&&a(n.localDescription)}})},r=async(n,i)=>await n.setRemoteDescription(i);try{let n=await t(this.peerPair[0],"offer");await r(this.peerPair[1],n);let i=await t(this.peerPair[1],"answer");await r(this.peerPair[0],i)}catch(n){throw new M(C.LOCAL_AEC_ERROR,n.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(i){throw new M(C.LOCAL_AEC_ERROR,i.toString()).print()}if(!r)throw new M(C.LOCAL_AEC_ERROR,"no dest node when local aec").print();let n=r.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}},TD,Lp;y(aF,"count",0);var HJ=window.AudioContext||window.webkitAudioContext,KJ=new(TD=ce({report:te}),Z((Lp=class{constructor(){y(this,"units",[]),y(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new HJ);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new aF(e,this.context),this.units.push(t)),t.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Ne().name!==Ue.SAFARI}}).prototype,"processExternalMediaAEC",[TD],Object.getOwnPropertyDescriptor(Lp.prototype,"processExternalMediaAEC"),Lp.prototype),Lp);function yD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function RD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yD(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yD(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var uv=window||document;function sF(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!uv)return;let r=dt._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);let n=i=>{if(!(i&&i.blockedURI&&(dt.onSecurityPolicyViolation||dt.getListeners(ho.SECURITY_POLICY_VIOLATION).length>0)))return;let o=i.blockedURI;b("CSP_DETECTED_HOSTNAME_LIST").some(a=>q(o).call(o,a))&&(dt.onSecurityPolicyViolation&&typeof dt.onSecurityPolicyViolation=="function"&&dt.onSecurityPolicyViolation(i),dt.getListeners(ho.SECURITY_POLICY_VIOLATION).length>0&&dt.safeEmit(ho.SECURITY_POLICY_VIOLATION,i))};r&&uv.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||dt.getListeners(ho.SECURITY_POLICY_VIOLATION).length>0)&&uv.addEventListener("securitypolicyviolation",n),dt._cspEventHandlerPointer=n}var zJ=Br,YJ=ax,CD=RegExp.prototype,$J=function(e){return e===CD||zJ(CD,e)?YJ(e):e.flags},Cr=Tt($J);function Xl(e){let t=e.length;for(;--t>=0;)e[t]=0}var $R=256,cF=286,cd=30,ld=15,VT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),wf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),qJ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ID=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Go=new Array(576);Xl(Go);var ud=new Array(60);Xl(ud);var Zd=new Array(512);Xl(Zd);var eh=new Array(256);Xl(eh);var qR=new Array(29);Xl(qR);var Rm=new Array(cd);function dv(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}var wD,AD,bD;function hv(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Xl(Rm);var lF=e=>e<256?Zd[e]:Zd[256+(e>>>7)],th=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},In=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,th(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},po=(e,t,r)=>{In(e,r[2*t],r[2*t+1])},uF=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},dF=(e,t,r)=>{let n=new Array(16),i,o,a=0;for(i=1;i<=ld;i++)a=a+r[i-1]<<1,n[i]=a;for(o=0;o<=t;o++){let s=e[2*o+1];s!==0&&(e[2*o]=uF(n[s]++,s))}},hF=e=>{let t;for(t=0;t<cF;t++)e.dyn_ltree[2*t]=0;for(t=0;t<cd;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},pF=e=>{e.bi_valid>8?th(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},OD=(e,t,r,n)=>{let i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]},pv=(e,t,r)=>{let n=e.heap[r],i=r<<1;for(;i<=e.heap_len&&(i<e.heap_len&&OD(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!OD(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n},ND=(e,t,r)=>{let n,i,o,a,s=0;if(e.sym_next!==0)do n=255&e.pending_buf[e.sym_buf+s++],n+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],n===0?po(e,i,t):(o=eh[i],po(e,o+$R+1,t),a=VT[o],a!==0&&(i-=qR[o],In(e,i,a)),n--,o=lF(n),po(e,o,r),a=wf[o],a!==0&&(n-=Rm[o],In(e,n,a)));while(s<e.sym_next);po(e,256,t)},fv=(e,t)=>{let r=t.dyn_tree,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems,a,s,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<o;a++)r[2*a]!==0?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):r[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,r[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=n[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)pv(e,r,a);c=o;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pv(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,r[2*c]=r[2*a]+r[2*s],e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,r[2*a+1]=r[2*s+1]=c,e.heap[1]=c++,pv(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((u,d)=>{let h=d.dyn_tree,p=d.max_code,m=d.stat_desc.static_tree,f=d.stat_desc.has_stree,_=d.stat_desc.extra_bits,E=d.stat_desc.extra_base,g=d.stat_desc.max_length,T,R,w,A,N,P,x=0;for(A=0;A<=ld;A++)u.bl_count[A]=0;for(h[2*u.heap[u.heap_max]+1]=0,T=u.heap_max+1;T<573;T++)R=u.heap[T],A=h[2*h[2*R+1]+1]+1,A>g&&(A=g,x++),h[2*R+1]=A,R>p||(u.bl_count[A]++,N=0,R>=E&&(N=_[R-E]),P=h[2*R],u.opt_len+=P*(A+N),f&&(u.static_len+=P*(m[2*R+1]+N)));if(x!==0){do{for(A=g-1;u.bl_count[A]===0;)A--;u.bl_count[A]--,u.bl_count[A+1]+=2,u.bl_count[g]--,x-=2}while(x>0);for(A=g;A!==0;A--)for(R=u.bl_count[A];R!==0;)w=u.heap[--T],w>p||(h[2*w+1]!==A&&(u.opt_len+=(A-h[2*w+1])*h[2*w],h[2*w+1]=A),R--)}})(e,t),dF(r,l,e.bl_count)},PD=(e,t,r)=>{let n,i,o=-1,a=t[1],s=0,c=7,l=4;for(a===0&&(c=138,l=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<c&&i===a||(s<l?e.bl_tree[2*i]+=s:i!==0?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,a===0?(c=138,l=3):i===a?(c=6,l=3):(c=7,l=4))},DD=(e,t,r)=>{let n,i,o=-1,a=t[1],s=0,c=7,l=4;for(a===0&&(c=138,l=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<c&&i===a)){if(s<l)do po(e,i,e.bl_tree);while(--s!=0);else i!==0?(i!==o&&(po(e,i,e.bl_tree),s--),po(e,16,e.bl_tree),In(e,s-3,2)):s<=10?(po(e,17,e.bl_tree),In(e,s-3,3)):(po(e,18,e.bl_tree),In(e,s-11,7));s=0,o=i,a===0?(c=138,l=3):i===a?(c=6,l=3):(c=7,l=4)}},kD=!1,fF=(e,t,r,n)=>{In(e,0+(n?1:0),3),pF(e),th(e,r),th(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},XJ=e=>{kD||((()=>{let t,r,n,i,o,a=new Array(16);for(n=0,i=0;i<28;i++)for(qR[i]=n,t=0;t<1<<VT[i];t++)eh[n++]=i;for(eh[n-1]=i,o=0,i=0;i<16;i++)for(Rm[i]=o,t=0;t<1<<wf[i];t++)Zd[o++]=i;for(o>>=7;i<cd;i++)for(Rm[i]=o<<7,t=0;t<1<<wf[i]-7;t++)Zd[256+o++]=i;for(r=0;r<=ld;r++)a[r]=0;for(t=0;t<=143;)Go[2*t+1]=8,t++,a[8]++;for(;t<=255;)Go[2*t+1]=9,t++,a[9]++;for(;t<=279;)Go[2*t+1]=7,t++,a[7]++;for(;t<=287;)Go[2*t+1]=8,t++,a[8]++;for(dF(Go,287,a),t=0;t<cd;t++)ud[2*t+1]=5,ud[2*t]=uF(t,5);wD=new dv(Go,VT,257,cF,ld),AD=new dv(ud,wf,0,cd,ld),bD=new dv(new Array(0),qJ,0,19,7)})(),kD=!0),e.l_desc=new hv(e.dyn_ltree,wD),e.d_desc=new hv(e.dyn_dtree,AD),e.bl_desc=new hv(e.bl_tree,bD),e.bi_buf=0,e.bi_valid=0,hF(e)},JJ=(e,t,r,n)=>{let i,o,a=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(s=>{let c,l=4093624447;for(c=0;c<=31;c++,l>>>=1)if(1&l&&s.dyn_ltree[2*c]!==0)return 0;if(s.dyn_ltree[18]!==0||s.dyn_ltree[20]!==0||s.dyn_ltree[26]!==0)return 1;for(c=32;c<$R;c++)if(s.dyn_ltree[2*c]!==0)return 1;return 0})(e)),fv(e,e.l_desc),fv(e,e.d_desc),a=(s=>{let c;for(PD(s,s.dyn_ltree,s.l_desc.max_code),PD(s,s.dyn_dtree,s.d_desc.max_code),fv(s,s.bl_desc),c=18;c>=3&&s.bl_tree[2*ID[c]+1]===0;c--);return s.opt_len+=3*(c+1)+5+5+4,c})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&t!==-1?fF(e,t,r,n):e.strategy===4||o===i?(In(e,2+(n?1:0),3),ND(e,Go,ud)):(In(e,4+(n?1:0),3),((s,c,l,u)=>{let d;for(In(s,c-257,5),In(s,l-1,5),In(s,u-4,4),d=0;d<u;d++)In(s,s.bl_tree[2*ID[d]+1],3);DD(s,s.dyn_ltree,c-1),DD(s,s.dyn_dtree,l-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),ND(e,e.dyn_ltree,e.dyn_dtree)),hF(e),n&&pF(e)},QJ=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(eh[r]+$R+1)]++,e.dyn_dtree[2*lF(t)]++),e.sym_next===e.sym_end),ZJ=e=>{In(e,2,3),po(e,256,Go),(t=>{t.bi_valid===16?(th(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},eQ={_tr_init:XJ,_tr_stored_block:fF,_tr_flush_block:JJ,_tr_tally:QJ,_tr_align:ZJ},rh=(e,t,r,n)=>{let i=65535&e|0,o=e>>>16&65535|0,a=0;for(;r!==0;){a=r>2e3?2e3:r,r-=a;do i=i+t[n++]|0,o=o+i|0;while(--a);i%=65521,o%=65521}return i|o<<16|0},tQ=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})()),Lr=(e,t,r,n)=>{let i=tQ,o=n+r;e^=-1;for(let a=n;a<o;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},Xs={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Jl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:rQ,_tr_stored_block:FT,_tr_flush_block:nQ,_tr_tally:Ka,_tr_align:iQ}=eQ,{Z_NO_FLUSH:za,Z_PARTIAL_FLUSH:oQ,Z_FULL_FLUSH:aQ,Z_FINISH:Ei,Z_BLOCK:LD,Z_OK:Hr,Z_STREAM_END:MD,Z_STREAM_ERROR:So,Z_DATA_ERROR:sQ,Z_BUF_ERROR:mv,Z_DEFAULT_COMPRESSION:cQ,Z_FILTERED:lQ,Z_HUFFMAN_ONLY:Mp,Z_RLE:uQ,Z_FIXED:dQ,Z_DEFAULT_STRATEGY:hQ,Z_UNKNOWN:pQ,Z_DEFLATED:R_}=Jl,jT=286,fQ=30,mQ=19,_Q=2*jT+1,EQ=15,Ps=258,To=262,kl=42,Ds=113,Hu=666,ks=(e,t)=>(e.msg=Xs[t],t),UD=e=>2*e-(e>4?9:0),Ia=e=>{let t=e.length;for(;--t>=0;)e[t]=0},gQ=e=>{let t,r,n,i=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=i?r-i:0;while(--t);t=i,n=t;do r=e.prev[--n],e.prev[n]=r>=i?r-i:0;while(--t)},Ya=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,Fn=e=>{let t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Gn=(e,t)=>{nQ(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Fn(e.strm)},_t=(e,t)=>{e.pending_buf[e.pending++]=t},Au=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},BT=(e,t,r,n)=>{let i=e.avail_in;return i>n&&(i=n),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),e.state.wrap===1?e.adler=rh(e.adler,t,i,r):e.state.wrap===2&&(e.adler=Lr(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},mF=(e,t)=>{let r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-To?e.strstart-(e.w_size-To):0,l=e.window,u=e.w_mask,d=e.prev,h=e.strstart+Ps,p=l[o+a-1],m=l[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do if(r=t,l[r+a]===m&&l[r+a-1]===p&&l[r]===l[o]&&l[++r]===l[o+1]){o+=2,r++;do;while(l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&o<h);if(n=Ps-(h-o),o=h-Ps,n>a){if(e.match_start=t,a=n,n>=s)break;p=l[o+a-1],m=l[o+a]}}while((t=d[t&u])>c&&--i!=0);return a<=e.lookahead?a:e.lookahead},Ll=e=>{let t=e.w_size,r,n,i;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-To)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),gQ(e),n+=t),e.strm.avail_in===0)break;if(r=BT(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Ya(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Ya(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<To&&e.strm.avail_in!==0)},_F=(e,t)=>{let r,n,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(r=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>i&&(r=i),r<o&&(r===0&&t!==Ei||t===za||r!==n+e.strm.avail_in)))break;a=t===Ei&&r===n+e.strm.avail_in?1:0,FT(e,0,0,a),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Fn(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(BT(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(a===0);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==za&&t!==Ei&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(BT(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,n=e.strstart-e.block_start,(n>=o||(n||t===Ei)&&t!==za&&e.strm.avail_in===0&&n<=i)&&(r=n>i?i:n,a=t===Ei&&e.strm.avail_in===0&&r===n?1:0,FT(e,e.block_start,r,a),e.block_start+=r,Fn(e.strm)),a?3:1)},_v=(e,t)=>{let r,n;for(;;){if(e.lookahead<To){if(Ll(e),e.lookahead<To&&t===za)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Ya(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-To&&(e.match_length=mF(e,r)),e.match_length>=3)if(n=Ka(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Ya(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Ya(e,e.ins_h,e.window[e.strstart+1]);else n=Ka(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Gn(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ei?(Gn(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Gn(e,!1),e.strm.avail_out===0)?1:2},Cc=(e,t)=>{let r,n,i;for(;;){if(e.lookahead<To){if(Ll(e),e.lookahead<To&&t===za)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Ya(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-To&&(e.match_length=mF(e,r),e.match_length<=5&&(e.strategy===lQ||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=Ka(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Ya(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(Gn(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(n=Ka(e,0,e.window[e.strstart-1]),n&&Gn(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Ka(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ei?(Gn(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Gn(e,!1),e.strm.avail_out===0)?1:2};function so(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}var Ku=[new so(0,0,0,0,_F),new so(4,4,8,4,_v),new so(4,5,16,8,_v),new so(4,6,32,32,_v),new so(4,4,16,16,Cc),new so(8,16,32,32,Cc),new so(8,16,128,128,Cc),new so(8,32,128,256,Cc),new so(32,128,258,1024,Cc),new so(32,258,258,4096,Cc)];function vQ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*_Q),this.dyn_dtree=new Uint16Array(2*(2*fQ+1)),this.bl_tree=new Uint16Array(2*(2*mQ+1)),Ia(this.dyn_ltree),Ia(this.dyn_dtree),Ia(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(EQ+1),this.heap=new Uint16Array(2*jT+1),Ia(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jT+1),Ia(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var nh=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==kl&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Ds&&t.status!==Hu?1:0},EF=e=>{if(nh(e))return ks(e,So);e.total_in=e.total_out=0,e.data_type=pQ;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?kl:Ds,e.adler=t.wrap===2?0:1,t.last_flush=-2,rQ(t),Hr},gF=e=>{let t=EF(e);return t===Hr&&(r=>{r.window_size=2*r.w_size,Ia(r.head),r.max_lazy_match=Ku[r.level].max_lazy,r.good_match=Ku[r.level].good_length,r.nice_match=Ku[r.level].nice_length,r.max_chain_length=Ku[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},xD=(e,t,r,n,i,o)=>{if(!e)return So;let a=1;if(t===cQ&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>9||r!==R_||n<8||n>15||t<0||t>9||o<0||o>dQ||n===8&&a!==1)return ks(e,So);n===8&&(n=9);let s=new vQ;return e.state=s,s.strm=e,s.status=kl,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=r,gF(e)},SQ=(e,t)=>{if(nh(e)||t>LD||t<0)return e?ks(e,So):So;let r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===Hu&&t!==Ei)return ks(e,e.avail_out===0?mv:So);let n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Fn(e),e.avail_out===0)return r.last_flush=-1,Hr}else if(e.avail_in===0&&UD(t)<=UD(n)&&t!==Ei)return ks(e,mv);if(r.status===Hu&&e.avail_in!==0)return ks(e,mv);if(r.status===kl&&r.wrap===0&&(r.status=Ds),r.status===kl){let i=R_+(r.w_bits-8<<4)<<8,o=-1;if(o=r.strategy>=Mp||r.level<2?0:r.level<6?1:r.level===6?2:3,i|=o<<6,r.strstart!==0&&(i|=32),i+=31-i%31,Au(r,i),r.strstart!==0&&(Au(r,e.adler>>>16),Au(r,65535&e.adler)),e.adler=1,r.status=Ds,Fn(e),r.pending!==0)return r.last_flush=-1,Hr}if(r.status===57){if(e.adler=0,_t(r,31),_t(r,139),_t(r,8),r.gzhead)_t(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),_t(r,255&r.gzhead.time),_t(r,r.gzhead.time>>8&255),_t(r,r.gzhead.time>>16&255),_t(r,r.gzhead.time>>24&255),_t(r,r.level===9?2:r.strategy>=Mp||r.level<2?4:0),_t(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(_t(r,255&r.gzhead.extra.length),_t(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Lr(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(_t(r,0),_t(r,0),_t(r,0),_t(r,0),_t(r,0),_t(r,r.level===9?2:r.strategy>=Mp||r.level<2?4:0),_t(r,3),r.status=Ds,Fn(e),r.pending!==0)return r.last_flush=-1,Hr}if(r.status===69){if(r.gzhead.extra){let i=r.pending,o=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let s=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>i&&(e.adler=Lr(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex+=s,Fn(e),r.pending!==0)return r.last_flush=-1,Hr;i=0,o-=s}let a=new Uint8Array(r.gzhead.extra);r.pending_buf.set(a.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>i&&(e.adler=Lr(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let i,o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(e.adler=Lr(e.adler,r.pending_buf,r.pending-o,o)),Fn(e),r.pending!==0)return r.last_flush=-1,Hr;o=0}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,_t(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(e.adler=Lr(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let i,o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(e.adler=Lr(e.adler,r.pending_buf,r.pending-o,o)),Fn(e),r.pending!==0)return r.last_flush=-1,Hr;o=0}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,_t(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(e.adler=Lr(e.adler,r.pending_buf,r.pending-o,o))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Fn(e),r.pending!==0))return r.last_flush=-1,Hr;_t(r,255&e.adler),_t(r,e.adler>>8&255),e.adler=0}if(r.status=Ds,Fn(e),r.pending!==0)return r.last_flush=-1,Hr}if(e.avail_in!==0||r.lookahead!==0||t!==za&&r.status!==Hu){let i=r.level===0?_F(r,t):r.strategy===Mp?((o,a)=>{let s;for(;;){if(o.lookahead===0&&(Ll(o),o.lookahead===0)){if(a===za)return 1;break}if(o.match_length=0,s=Ka(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,s&&(Gn(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,a===Ei?(Gn(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(Gn(o,!1),o.strm.avail_out===0)?1:2})(r,t):r.strategy===uQ?((o,a)=>{let s,c,l,u,d=o.window;for(;;){if(o.lookahead<=Ps){if(Ll(o),o.lookahead<=Ps&&a===za)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(l=o.strstart-1,c=d[l],c===d[++l]&&c===d[++l]&&c===d[++l])){u=o.strstart+Ps;do;while(c===d[++l]&&c===d[++l]&&c===d[++l]&&c===d[++l]&&c===d[++l]&&c===d[++l]&&c===d[++l]&&c===d[++l]&&l<u);o.match_length=Ps-(u-l),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(s=Ka(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(s=Ka(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),s&&(Gn(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,a===Ei?(Gn(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(Gn(o,!1),o.strm.avail_out===0)?1:2})(r,t):Ku[r.level].func(r,t);if(i!==3&&i!==4||(r.status=Hu),i===1||i===3)return e.avail_out===0&&(r.last_flush=-1),Hr;if(i===2&&(t===oQ?iQ(r):t!==LD&&(FT(r,0,0,!1),t===aQ&&(Ia(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Fn(e),e.avail_out===0))return r.last_flush=-1,Hr}return t!==Ei?Hr:r.wrap<=0?MD:(r.wrap===2?(_t(r,255&e.adler),_t(r,e.adler>>8&255),_t(r,e.adler>>16&255),_t(r,e.adler>>24&255),_t(r,255&e.total_in),_t(r,e.total_in>>8&255),_t(r,e.total_in>>16&255),_t(r,e.total_in>>24&255)):(Au(r,e.adler>>>16),Au(r,65535&e.adler)),Fn(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Hr:MD)},TQ=(e,t)=>{let r=t.length;if(nh(e))return So;let n=e.state,i=n.wrap;if(i===2||i===1&&n.status!==kl||n.lookahead)return So;if(i===1&&(e.adler=rh(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){i===0&&(Ia(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(t.subarray(r-n.w_size,r),0),t=c,r=n.w_size}let o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Ll(n);n.lookahead>=3;){let c=n.strstart,l=n.lookahead-2;do n.ins_h=Ya(n,n.ins_h,n.window[c+3-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--l);n.strstart=c,n.lookahead=2,Ll(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,n.wrap=i,Hr},dd={deflateInit:(e,t)=>xD(e,t,R_,15,8,hQ),deflateInit2:xD,deflateReset:gF,deflateResetKeep:EF,deflateSetHeader:(e,t)=>nh(e)||e.state.wrap!==2?So:(e.state.gzhead=t,Hr),deflate:SQ,deflateEnd:e=>{if(nh(e))return So;let t=e.state.status;return e.state=null,t===Ds?ks(e,sQ):Hr},deflateSetDictionary:TQ,deflateInfo:"pako deflate (from Nodeca project)"},yQ=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),C_={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let n in r)yQ(r,n)&&(e[n]=r[n])}}return e},flattenChunks:e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;let r=new Uint8Array(t);for(let n=0,i=0,o=e.length;n<o;n++){let a=e[n];r.set(a,i),i+=a.length}return r}},vF=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{vF=!1}var ih=new Uint8Array(256);for(let e=0;e<256;e++)ih[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ih[254]=ih[254]=1;var oh={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,i,o,a=e.length,s=0;for(i=0;i<a;i++)r=e.charCodeAt(i),(64512&r)==55296&&i+1<a&&(n=e.charCodeAt(i+1),(64512&n)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),o=0,i=0;o<s;i++)r=e.charCodeAt(i),(64512&r)==55296&&i+1<a&&(n=e.charCodeAt(i+1),(64512&n)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},buf2string:(e,t)=>{let r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,i,o=new Array(2*r);for(i=0,n=0;n<r;){let a=e[n++];if(a<128){o[i++]=a;continue}let s=ih[a];if(s>4)o[i++]=65533,n+=s-1;else{for(a&=s===2?31:s===3?15:7;s>1&&n<r;)a=a<<6|63&e[n++],s--;s>1?o[i++]=65533:a<65536?o[i++]=a:(a-=65536,o[i++]=55296|a>>10&1023,o[i++]=56320|1023&a)}}return((a,s)=>{if(s<65534&&a.subarray&&vF)return String.fromCharCode.apply(null,a.length===s?a:a.subarray(0,s));let c="";for(let l=0;l<s;l++)c+=String.fromCharCode(a[l]);return c})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+ih[e[r]]>t?r:t}},SF=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},TF=Object.prototype.toString,{Z_NO_FLUSH:RQ,Z_SYNC_FLUSH:CQ,Z_FULL_FLUSH:IQ,Z_FINISH:wQ,Z_OK:Cm,Z_STREAM_END:AQ,Z_DEFAULT_COMPRESSION:bQ,Z_DEFAULT_STRATEGY:OQ,Z_DEFLATED:NQ}=Jl;function hd(e){this.options=C_.assign({level:bQ,method:NQ,chunkSize:16384,windowBits:15,memLevel:8,strategy:OQ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new SF,this.strm.avail_out=0;let r=dd.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Cm)throw new Error(Xs[r]);if(t.header&&dd.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(n=typeof t.dictionary=="string"?oh.string2buf(t.dictionary):TF.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=dd.deflateSetDictionary(this.strm,n),r!==Cm)throw new Error(Xs[r]);this._dict_set=!0}}function Ev(e,t){let r=new hd(t);if(r.push(e,!0),r.err)throw r.msg||Xs[r.err];return r.result}hd.prototype.push=function(e,t){let r=this.strm,n=this.options.chunkSize,i,o;if(this.ended)return!1;for(o=t===~~t?t:t===!0?wQ:RQ,typeof e=="string"?r.input=oh.string2buf(e):TF.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===CQ||o===IQ)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=dd.deflate(r,o),i===AQ)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=dd.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Cm;if(r.avail_out!==0){if(o>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},hd.prototype.onData=function(e){this.chunks.push(e)},hd.prototype.onEnd=function(e){e===Cm&&(this.result=C_.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var PQ={Deflate:hd,deflate:Ev,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Ev(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Ev(e,t)},constants:Jl},Up=16209,DQ=function(e,t){let r,n,i,o,a,s,c,l,u,d,h,p,m,f,_,E,g,T,R,w,A,N,P,x,G=e.state;r=e.next_in,P=e.input,n=r+(e.avail_in-5),i=e.next_out,x=e.output,o=i-(t-e.avail_out),a=i+(e.avail_out-257),s=G.dmax,c=G.wsize,l=G.whave,u=G.wnext,d=G.window,h=G.hold,p=G.bits,m=G.lencode,f=G.distcode,_=(1<<G.lenbits)-1,E=(1<<G.distbits)-1;e:do{p<15&&(h+=P[r++]<<p,p+=8,h+=P[r++]<<p,p+=8),g=m[h&_];t:for(;;){if(T=g>>>24,h>>>=T,p-=T,T=g>>>16&255,T===0)x[i++]=65535&g;else{if(!(16&T)){if(!(64&T)){g=m[(65535&g)+(h&(1<<T)-1)];continue t}if(32&T){G.mode=16191;break e}e.msg="invalid literal/length code",G.mode=Up;break e}R=65535&g,T&=15,T&&(p<T&&(h+=P[r++]<<p,p+=8),R+=h&(1<<T)-1,h>>>=T,p-=T),p<15&&(h+=P[r++]<<p,p+=8,h+=P[r++]<<p,p+=8),g=f[h&E];r:for(;;){if(T=g>>>24,h>>>=T,p-=T,T=g>>>16&255,!(16&T)){if(!(64&T)){g=f[(65535&g)+(h&(1<<T)-1)];continue r}e.msg="invalid distance code",G.mode=Up;break e}if(w=65535&g,T&=15,p<T&&(h+=P[r++]<<p,p+=8,p<T&&(h+=P[r++]<<p,p+=8)),w+=h&(1<<T)-1,w>s){e.msg="invalid distance too far back",G.mode=Up;break e}if(h>>>=T,p-=T,T=i-o,w>T){if(T=w-T,T>l&&G.sane){e.msg="invalid distance too far back",G.mode=Up;break e}if(A=0,N=d,u===0){if(A+=c-T,T<R){R-=T;do x[i++]=d[A++];while(--T);A=i-w,N=x}}else if(u<T){if(A+=c+u-T,T-=u,T<R){R-=T;do x[i++]=d[A++];while(--T);if(A=0,u<R){T=u,R-=T;do x[i++]=d[A++];while(--T);A=i-w,N=x}}}else if(A+=u-T,T<R){R-=T;do x[i++]=d[A++];while(--T);A=i-w,N=x}for(;R>2;)x[i++]=N[A++],x[i++]=N[A++],x[i++]=N[A++],R-=3;R&&(x[i++]=N[A++],R>1&&(x[i++]=N[A++]))}else{A=i-w;do x[i++]=x[A++],x[i++]=x[A++],x[i++]=x[A++],R-=3;while(R>2);R&&(x[i++]=x[A++],R>1&&(x[i++]=x[A++]))}break}}break}}while(r<n&&i<a);R=p>>3,r-=R,p-=R<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=i,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=i<a?a-i+257:257-(i-a),G.hold=h,G.bits=p},xp=15,kQ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),LQ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),MQ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),UQ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),pd=(e,t,r,n,i,o,a,s)=>{let c=s.bits,l,u,d,h,p,m,f=0,_=0,E=0,g=0,T=0,R=0,w=0,A=0,N=0,P=0,x=null,G=new Uint16Array(16),ne=new Uint16Array(16),z,k,F,K=null;for(f=0;f<=xp;f++)G[f]=0;for(_=0;_<n;_++)G[t[r+_]]++;for(T=c,g=xp;g>=1&&G[g]===0;g--);if(T>g&&(T=g),g===0)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(E=1;E<g&&G[E]===0;E++);for(T<E&&(T=E),A=1,f=1;f<=xp;f++)if(A<<=1,A-=G[f],A<0)return-1;if(A>0&&(e===0||g!==1))return-1;for(ne[1]=0,f=1;f<xp;f++)ne[f+1]=ne[f]+G[f];for(_=0;_<n;_++)t[r+_]!==0&&(a[ne[t[r+_]]++]=_);if(e===0?(x=K=a,m=20):e===1?(x=kQ,K=LQ,m=257):(x=MQ,K=UQ,m=0),P=0,_=0,f=E,p=o,R=T,w=0,d=-1,N=1<<T,h=N-1,e===1&&N>852||e===2&&N>592)return 1;for(;;){z=f-w,a[_]+1<m?(k=0,F=a[_]):a[_]>=m?(k=K[a[_]-m],F=x[a[_]-m]):(k=96,F=0),l=1<<f-w,u=1<<R,E=u;do u-=l,i[p+(P>>w)+u]=z<<24|k<<16|F|0;while(u!==0);for(l=1<<f-1;P&l;)l>>=1;if(l!==0?(P&=l-1,P+=l):P=0,_++,--G[f]==0){if(f===g)break;f=t[r+a[_]]}if(f>T&&(P&h)!==d){for(w===0&&(w=T),p+=E,R=f-w,A=1<<R;R+w<g&&(A-=G[R+w],!(A<=0));)R++,A<<=1;if(N+=1<<R,e===1&&N>852||e===2&&N>592)return 1;d=P&h,i[d]=T<<24|R<<16|p-o|0}}return P!==0&&(i[p+P]=f-w<<24|64<<16|0),s.bits=T,0},{Z_FINISH:VD,Z_BLOCK:xQ,Z_TREES:Vp,Z_OK:js,Z_STREAM_END:VQ,Z_NEED_DICT:FQ,Z_STREAM_ERROR:gi,Z_DATA_ERROR:yF,Z_MEM_ERROR:RF,Z_BUF_ERROR:jQ,Z_DEFLATED:FD}=Jl,I_=16180,Im=16190,Lo=16191,gv=16192,vv=16194,Fp=16199,jp=16200,Sv=16206,Ht=16209,jD=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function BQ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Bs=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<I_||t.mode>16211?1:0},CF=e=>{if(Bs(e))return gi;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=I_,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,js},IF=e=>{if(Bs(e))return gi;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,CF(e)},wF=(e,t)=>{let r;if(Bs(e))return gi;let n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?gi:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,IF(e))},BD=(e,t)=>{if(!e)return gi;let r=new BQ;e.state=r,r.strm=e,r.window=null,r.mode=I_;let n=wF(e,t);return n!==js&&(e.state=null),n},Tv,yv,GD=!0,GQ=e=>{if(GD){Tv=new Int32Array(512),yv=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pd(1,e.lens,0,288,Tv,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pd(2,e.lens,0,32,yv,0,e.work,{bits:5}),GD=!1}e.lencode=Tv,e.lenbits=9,e.distcode=yv,e.distbits=5},AF=(e,t,r,n)=>{let i,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(t.subarray(r-n,r-n+i),o.wnext),(n-=i)?(o.window.set(t.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},WQ=(e,t)=>{let r,n,i,o,a,s,c,l,u,d,h,p,m,f,_,E,g,T,R,w,A,N,P=0,x=new Uint8Array(4),G,ne,z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Bs(e)||!e.output||!e.input&&e.avail_in!==0)return gi;r=e.state,r.mode===Lo&&(r.mode=gv),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,l=r.hold,u=r.bits,d=s,h=c,N=js;e:for(;;)switch(r.mode){case I_:if(r.wrap===0){r.mode=gv;break}for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(2&r.wrap&&l===35615){r.wbits===0&&(r.wbits=15),r.check=0,x[0]=255&l,x[1]=l>>>8&255,r.check=Lr(r.check,x,2,0),l=0,u=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=Ht;break}if((15&l)!==FD){e.msg="unknown compression method",r.mode=Ht;break}if(l>>>=4,u-=4,A=8+(15&l),r.wbits===0&&(r.wbits=A),A>15||A>r.wbits){e.msg="invalid window size",r.mode=Ht;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&l?16189:Lo,l=0,u=0;break;case 16181:for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(r.flags=l,(255&Cr(r))!==FD){e.msg="unknown compression method",r.mode=Ht;break}if(57344&Cr(r)){e.msg="unknown header flags set",r.mode=Ht;break}r.head&&(r.head.text=l>>8&1),512&Cr(r)&&4&r.wrap&&(x[0]=255&l,x[1]=l>>>8&255,r.check=Lr(r.check,x,2,0)),l=0,u=0,r.mode=16182;case 16182:for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.head&&(r.head.time=l),512&Cr(r)&&4&r.wrap&&(x[0]=255&l,x[1]=l>>>8&255,x[2]=l>>>16&255,x[3]=l>>>24&255,r.check=Lr(r.check,x,4,0)),l=0,u=0,r.mode=16183;case 16183:for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&Cr(r)&&4&r.wrap&&(x[0]=255&l,x[1]=l>>>8&255,r.check=Lr(r.check,x,2,0)),l=0,u=0,r.mode=16184;case 16184:if(1024&Cr(r)){for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.length=l,r.head&&(r.head.extra_len=l),512&Cr(r)&&4&r.wrap&&(x[0]=255&l,x[1]=l>>>8&255,r.check=Lr(r.check,x,2,0)),l=0,u=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&Cr(r)&&(p=r.length,p>s&&(p=s),p&&(r.head&&(A=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+p),A)),512&Cr(r)&&4&r.wrap&&(r.check=Lr(r.check,n,p,o)),s-=p,o+=p,r.length-=p),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&Cr(r)){if(s===0)break e;p=0;do A=n[o+p++],r.head&&A&&r.length<65536&&(r.head.name+=String.fromCharCode(A));while(A&&p<s);if(512&Cr(r)&&4&r.wrap&&(r.check=Lr(r.check,n,p,o)),s-=p,o+=p,A)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&Cr(r)){if(s===0)break e;p=0;do A=n[o+p++],r.head&&A&&r.length<65536&&(r.head.comment+=String.fromCharCode(A));while(A&&p<s);if(512&Cr(r)&&4&r.wrap&&(r.check=Lr(r.check,n,p,o)),s-=p,o+=p,A)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&Cr(r)){for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(4&r.wrap&&l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Ht;break}l=0,u=0}r.head&&(r.head.hcrc=Cr(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Lo;break;case 16189:for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}e.adler=r.check=jD(l),l=0,u=0,r.mode=Im;case Im:if(r.havedict===0)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=l,r.bits=u,FQ;e.adler=r.check=1,r.mode=Lo;case Lo:if(t===xQ||t===Vp)break e;case gv:if(r.last){l>>>=7&u,u-=7&u,r.mode=Sv;break}for(;u<3;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}switch(r.last=1&l,l>>>=1,u-=1,3&l){case 0:r.mode=16193;break;case 1:if(GQ(r),r.mode=Fp,t===Vp){l>>>=2,u-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Ht}l>>>=2,u-=2;break;case 16193:for(l>>>=7&u,u-=7&u;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Ht;break}if(r.length=65535&l,l=0,u=0,r.mode=vv,t===Vp)break e;case vv:r.mode=16195;case 16195:if(p=r.length,p){if(p>s&&(p=s),p>c&&(p=c),p===0)break e;i.set(n.subarray(o,o+p),a),s-=p,o+=p,c-=p,a+=p,r.length-=p;break}r.mode=Lo;break;case 16196:for(;u<14;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(r.nlen=257+(31&l),l>>>=5,u-=5,r.ndist=1+(31&l),l>>>=5,u-=5,r.ncode=4+(15&l),l>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Ht;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;u<3;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.lens[z[r.have++]]=7&l,l>>>=3,u-=3}for(;r.have<19;)r.lens[z[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,G={bits:r.lenbits},N=pd(0,r.lens,0,19,r.lencode,0,r.work,G),r.lenbits=G.bits,N){e.msg="invalid code lengths set",r.mode=Ht;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;P=r.lencode[l&(1<<r.lenbits)-1],_=P>>>24,E=P>>>16&255,g=65535&P,!(_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(g<16)l>>>=_,u-=_,r.lens[r.have++]=g;else{if(g===16){for(ne=_+2;u<ne;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(l>>>=_,u-=_,r.have===0){e.msg="invalid bit length repeat",r.mode=Ht;break}A=r.lens[r.have-1],p=3+(3&l),l>>>=2,u-=2}else if(g===17){for(ne=_+3;u<ne;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=_,u-=_,A=0,p=3+(7&l),l>>>=3,u-=3}else{for(ne=_+7;u<ne;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=_,u-=_,A=0,p=11+(127&l),l>>>=7,u-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Ht;break}for(;p--;)r.lens[r.have++]=A}}if(r.mode===Ht)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Ht;break}if(r.lenbits=9,G={bits:r.lenbits},N=pd(1,r.lens,0,r.nlen,r.lencode,0,r.work,G),r.lenbits=G.bits,N){e.msg="invalid literal/lengths set",r.mode=Ht;break}if(r.distbits=6,r.distcode=r.distdyn,G={bits:r.distbits},N=pd(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,G),r.distbits=G.bits,N){e.msg="invalid distances set",r.mode=Ht;break}if(r.mode=Fp,t===Vp)break e;case Fp:r.mode=jp;case jp:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=l,r.bits=u,DQ(e,h),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,l=r.hold,u=r.bits,r.mode===Lo&&(r.back=-1);break}for(r.back=0;P=r.lencode[l&(1<<r.lenbits)-1],_=P>>>24,E=P>>>16&255,g=65535&P,!(_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(E&&!(240&E)){for(T=_,R=E,w=g;P=r.lencode[w+((l&(1<<T+R)-1)>>T)],_=P>>>24,E=P>>>16&255,g=65535&P,!(T+_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=T,u-=T,r.back+=T}if(l>>>=_,u-=_,r.back+=_,r.length=g,E===0){r.mode=16205;break}if(32&E){r.back=-1,r.mode=Lo;break}if(64&E){e.msg="invalid literal/length code",r.mode=Ht;break}r.extra=15&E,r.mode=16201;case 16201:if(r.extra){for(ne=r.extra;u<ne;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;P=r.distcode[l&(1<<r.distbits)-1],_=P>>>24,E=P>>>16&255,g=65535&P,!(_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(!(240&E)){for(T=_,R=E,w=g;P=r.distcode[w+((l&(1<<T+R)-1)>>T)],_=P>>>24,E=P>>>16&255,g=65535&P,!(T+_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=T,u-=T,r.back+=T}if(l>>>=_,u-=_,r.back+=_,64&E){e.msg="invalid distance code",r.mode=Ht;break}r.offset=g,r.extra=15&E,r.mode=16203;case 16203:if(r.extra){for(ne=r.extra;u<ne;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Ht;break}r.mode=16204;case 16204:if(c===0)break e;if(p=h-c,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Ht;break}p>r.wnext?(p-=r.wnext,m=r.wsize-p):m=r.wnext-p,p>r.length&&(p=r.length),f=r.window}else f=i,m=a-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do i[a++]=f[m++];while(--p);r.length===0&&(r.mode=jp);break;case 16205:if(c===0)break e;i[a++]=r.length,c--,r.mode=jp;break;case Sv:if(r.wrap){for(;u<32;){if(s===0)break e;s--,l|=n[o++]<<u,u+=8}if(h-=c,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=Cr(r)?Lr(r.check,i,h,a-h):rh(r.check,i,h,a-h)),h=c,4&r.wrap&&(Cr(r)?l:jD(l))!==r.check){e.msg="incorrect data check",r.mode=Ht;break}l=0,u=0}r.mode=16207;case 16207:if(r.wrap&&Cr(r)){for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(4&r.wrap&&l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Ht;break}l=0,u=0}r.mode=16208;case 16208:N=VQ;break e;case Ht:N=yF;break e;case 16210:return RF;default:return gi}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=l,r.bits=u,(r.wsize||h!==e.avail_out&&r.mode<Ht&&(r.mode<Sv||t!==VD))&&AF(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=Cr(r)?Lr(r.check,i,h,e.next_out-h):rh(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Lo?128:0)+(r.mode===Fp||r.mode===vv?256:0),(d===0&&h===0||t===VD)&&N===js&&(N=jQ),N},Wo={inflateReset:IF,inflateReset2:wF,inflateResetKeep:CF,inflateInit:e=>BD(e,15),inflateInit2:BD,inflate:WQ,inflateEnd:e=>{if(Bs(e))return gi;let t=e.state;return t.window&&(t.window=null),e.state=null,js},inflateGetHeader:(e,t)=>{if(Bs(e))return gi;let r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,js):gi},inflateSetDictionary:(e,t)=>{let r=t.length,n,i,o;return Bs(e)?gi:(n=e.state,n.wrap!==0&&n.mode!==Im?gi:n.mode===Im&&(i=1,i=rh(i,t,r,0),i!==n.check)?yF:(o=AF(e,t,r,r),o?(n.mode=16210,RF):(n.havedict=1,js)))},inflateInfo:"pako inflate (from Nodeca project)"},HQ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},bF=Object.prototype.toString,{Z_NO_FLUSH:KQ,Z_FINISH:zQ,Z_OK:fd,Z_STREAM_END:Rv,Z_NEED_DICT:Cv,Z_STREAM_ERROR:YQ,Z_DATA_ERROR:WD,Z_MEM_ERROR:$Q}=Jl;function md(e){this.options=C_.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new SF,this.strm.avail_out=0;let r=Wo.inflateInit2(this.strm,t.windowBits);if(r!==fd)throw new Error(Xs[r]);if(this.header=new HQ,Wo.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=oh.string2buf(t.dictionary):bF.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Wo.inflateSetDictionary(this.strm,t.dictionary),r!==fd)))throw new Error(Xs[r])}function Iv(e,t){let r=new md(t);if(r.push(e),r.err)throw r.msg||Xs[r.err];return r.result}md.prototype.push=function(e,t){let r=this.strm,n=this.options.chunkSize,i=this.options.dictionary,o,a,s;if(this.ended)return!1;for(a=t===~~t?t:t===!0?zQ:KQ,bF.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=Wo.inflate(r,a),o===Cv&&i&&(o=Wo.inflateSetDictionary(r,i),o===fd?o=Wo.inflate(r,a):o===WD&&(o=Cv));r.avail_in>0&&o===Rv&&r.state.wrap>0&&e[r.next_in]!==0;)Wo.inflateReset(r),o=Wo.inflate(r,a);switch(o){case YQ:case WD:case Cv:case $Q:return this.onEnd(o),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(r.avail_out===0||o===Rv))if(this.options.to==="string"){let c=oh.utf8border(r.output,r.next_out),l=r.next_out-c,u=oh.buf2string(r.output,c);r.next_out=l,r.avail_out=n-l,l&&r.output.set(r.output.subarray(c,c+l),0),this.onData(u)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(o!==fd||s!==0){if(o===Rv)return o=Wo.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},md.prototype.onData=function(e){this.chunks.push(e)},md.prototype.onEnd=function(e){e===fd&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=C_.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var qQ={Inflate:md,inflate:Iv,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Iv(e,t)},ungzip:Iv,constants:Jl},{Deflate:e1,deflate:XQ,deflateRaw:t1,gzip:r1}=PQ,{Inflate:n1,inflate:JQ,inflateRaw:i1,ungzip:o1}=qQ,QQ=XQ,ZQ=JQ,OF=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(OF||{}),eZ=class{constructor(){y(this,"_sequence",0),y(this,"_startTime",Date.now()),y(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){let t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let a=new Uint8Array(4);a.set([1,0,0,0]);let s={id:0,length:4,data:a.buffer},c={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[s]};t.commonPacketHeader.extension=1,t.extension=c,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;b("SHOW_DATASTREAM2_LOG")&&v.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));let r=new ArrayBuffer(t.commonPacketHeader.length),n=new Uint8Array(r),i=new DataView(r),o=0;if(i.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,i.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,i.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){let a=this.serializeExtension(t.extension);n.set(new Uint8Array(a),o),o+=a.byteLength}if(n.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);let t=new DataView(e),r=0,n=t.getUint16(r,!0);r+=2;let i={length:16383&n,reserved:(16384&n)>>14,extension:(32768&n)>>15,sequence:t.getUint16(r+2,!0)<<16|t.getUint16(r,!0)},o,a;if(r+=4,b("SHOW_DATASTREAM2_LOG")&&v.debug("receive data header: ".concat(JSON.stringify(i))),t.getUint16(r,!0),r+=2,i.extension){a=this.deserializeExtension(e.slice(r)),r+=2+a.length,o=e.slice(r);let s=!1;if(a.datas.length>0){let c=a.datas.find(l=>l.id===0);c&&(s=(1&new DataView(c.data).getUint32(0,!0))==1)}o=s?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){let{profile:t,length:r,datas:n}=e,i=new ArrayBuffer(r+2),o=new Uint8Array(i),a=new DataView(i),s=0;if(a.setUint8(s++,t),a.setUint8(s++,r),n.forEach(c=>{t?(a.setUint8(s++,c.id),a.setUint8(s++,c.length),o.set(new Uint8Array(c.data),s),s+=c.data.byteLength):(a.setUint8(s++,c.id|c.length<<4),o.set(new Uint8Array(c.data),s),s+=c.data.byteLength)}),s!==r+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(r+2));return i}deserializeExtension(e){let t=new DataView(e),r=0,n=t.getUint8(r);r++;let i=t.getUint8(r);r++;let o=n===OF.TWO_BYTE,a=[],s=new DataView(e,2),c=0;for(;c<i;){let l=0,u=0,d=new ArrayBuffer(0);o?(l=s.getUint8(c),c++,u=s.getUint8(c),c++):(l=15&s.getUint8(c),u=s.getUint8(c)>>4,c++),u>0&&(d=s.buffer.slice(c+2,c+2+u),c+=d.byteLength),a.push({id:l,length:u,data:d})}if(c!==i)throw Error("parse error");return{profile:n,length:i,datas:a}}decompress(e){return ZQ(new Uint8Array(e))}compress(e){return QQ(new Uint8Array(e))}},tZ={name:"DataStream",create:(e,t)=>{let r=t?new jX(e):new BX(e);return r.useDataStream(new eZ),r}},rZ=class extends lt{constructor(e,t,r){super(),y(this,"ws",void 0),y(this,"requestId",1),y(this,"heartBeatTimer",void 0),y(this,"joinInfo",void 0),y(this,"clientId",void 0),y(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),y(this,"onClose",n=>{this.emit("close"),this.dispose()}),y(this,"onMessage",n=>{let i=JSON.parse(n.data);if(!i||i.command!=="serverResponse"||!i.requestId)return i&&i.command==="serverStatus"&&i.serverStatus&&i.serverStatus.command?(this.emit("status",i.serverStatus),void this.emit(i.serverStatus.command,i.serverStatus)):void 0;this.emit("req_".concat(i.requestId),i)}),this.joinInfo=e,this.clientId=t,this.ws=new zd("cross-channel-".concat(this.clientId),r),this.ws.on(pe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(pe.CONNECTED,this.onOpen),this.ws.on(pe.ON_MESSAGE,this.onMessage),this.ws.on(pe.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new Y((t,r)=>{let n=window.setTimeout(()=>{r(new M(C.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,i=>{window.clearTimeout(n),i.state&&i.state!==0?r(new M(C.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(n),r(new M(C.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new M(C.WS_DISCONNECT);let t=()=>new Y((o,a)=>{this.ws.once(pe.CLOSED,()=>a(new M(C.WS_ABORT))),this.ws.once(pe.CONNECTED,o)});this.ws.state!=="connected"&&await t();let r=this.sendMessage(e),n=new Y((o,a)=>{let s=()=>{a(new M(C.WS_ABORT))};this.ws.once(pe.RECONNECTING,s),this.ws.once(pe.CLOSED,s),this.once("req_".concat(r),o),er(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(pe.RECONNECTING,s),this.ws.off(pe.CLOSED,s),a(new M(C.TIMEOUT,"cross channel ws request timeout"))})}),i=await n;if(!i||i.code!==200)throw new M(C.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(pe.REQUEST_NEW_URLS),this.ws.on(pe.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}},nZ=class extends lt{set state(e){e!==this._state&&(e!==Zr.RELAY_STATE_FAILURE&&(this.errorCode=bc.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,r,n,i){super(),y(this,"joinInfo",void 0),y(this,"sid",void 0),y(this,"clientId",void 0),y(this,"cancelToken",$r.CancelToken.source()),y(this,"workerToken",void 0),y(this,"requestId",0),y(this,"signal",void 0),y(this,"prevChannelMediaConfig",void 0),y(this,"httpRetryConfig",void 0),y(this,"_resolution",void 0),y(this,"_state",Zr.RELAY_STATE_IDLE),y(this,"errorCode",bc.RELAY_OK),y(this,"onStatus",o=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",Mo.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",Mo.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=bc.SRC_TOKEN_EXPIRED,this.state=Zr.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=bc.DEST_TOKEN_EXPIRED,this.state=Zr.RELAY_STATE_FAILURE))}),y(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Mo.NETWORK_DISCONNECTED),this.state=Zr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==Zr.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",o.toString()),this.errorCode=bc.SERVER_CONNECTION_LOST,this.state=Zr.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=Xc(),this.signal=new rZ(this.joinInfo,this.clientId,r),this.httpRetryConfig=n,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==Zr.RELAY_STATE_IDLE)throw new M(C.INVALID_OPERATION);this.state=Zr.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){throw t.data&&t.data.serverResponse&&t.data.serverResponse.command==="SetSourceChannel"?new M(C.CROSS_CHANNEL_FAILED_JOIN_SRC):t.data&&t.data.serverResponse&&t.serverResponse.command==="SetDestChannelStatus"?new M(C.CROSS_CHANNEL_FAILED_JOIN_DEST):t.data&&t.data.serverResponse&&t.serverResponse.command==="StartPacketTransfer"?new M(C.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Zr.RELAY_STATE_RUNNING)throw new M(C.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Zr.RELAY_STATE_RUNNING)throw new M(C.INVALID_OPERATION);let t=this.genMessage(kr.SetVideoProfile);await this.signal.request(t),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Zr.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=$r.CancelToken.source(),this.state=Zr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await QX(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Mo.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let t=this.genMessage(kr.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let r=this.genMessage(kr.SetSdkProfile,e);await this.signal.request(r),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let n=this.genMessage(kr.SetSourceChannel,e);await this.signal.request(n),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Mo.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let i=this.genMessage(kr.SetSourceUserId,e);await this.signal.request(i),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let o=this.genMessage(kr.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Mo.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let a=this.genMessage(kr.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",Mo.PACKET_SENT_TO_DEST_CHANNEL),this.state=Zr.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let t=this.genMessage(kr.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",Mo.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(kr.StopPacketTransfer);await this.signal.request(e),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let r=[],n=[],i=[];this.requestId+=1;let o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:zn,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.22.0"&&(o.sdkVersion="0.0.1");let a=null,s=null;switch(e){case kr.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case kr.SetSourceChannel:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new M(C.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},o;case kr.SetSourceUserId:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new M(C.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:s.uid+""},o;case kr.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new M(C.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(c=>{r.push(c.channelName),n.push(c.uid+""),i.push(c.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:r,uid:n,token:i},o;case kr.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case kr.Reconnect:return o.clientRequest={command:"Reconnect"},o;case kr.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case kr.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new M(C.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(c=>{r.push(c.channelName),n.push(c.uid+""),i.push(c.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:n,token:i},o;case kr.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}},iZ={name:"ChannelMediaRelay",create:function(e){return new nZ(e.joinInfo,e.clientId,e.websocketRetryConfig||Pt,e.httpRetryConfig||Pt,e.resolution)}};function HD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function bu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HD(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HD(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var oZ=class extends lt{constructor(e,t,r,n){super(),y(this,"spec",void 0),y(this,"token",void 0),y(this,"websocket",void 0),y(this,"pingpongTimer",void 0),y(this,"reconnectMode","retry"),y(this,"serviceMode",void 0),y(this,"reqId",0),y(this,"commandReqId",0),y(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),y(this,"handleWebSocketMessage",i=>{if(!i.data)return;let o=JSON.parse(i.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(te.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===Yo.TRANSCODE?1:2}),this.emit(Ra.PUBLISH_STREAM_STATUS,o))}),this.spec=t,this.token=e,this.serviceMode=n,this.websocket=new zd("live-streaming",r),this.websocket.on(pe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pe.REQUEST_NEW_URLS,(i,o)=>{lr(this,Ra.REQUEST_NEW_ADDRESS).then(i).catch(o)}),this.websocket.on(pe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,r,n){this.reqId+=1,e==="request"&&(this.commandReqId+=1);let i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new M(C.UNEXPECTED_ERROR);let a=bu({command:e,sdkVersion:zn==="4.22.0"?"0.0.1":zn,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if(this.websocket.state==="closed")throw new M(C.WS_DISCONNECT);let s=()=>new Y((d,h)=>{this.websocket.once(pe.CLOSED,()=>h(new M(C.WS_ABORT))),this.websocket.once(pe.CONNECTED,d)});this.websocket.state!=="connected"&&await s(),a.clientRequest&&(a.clientRequest.workerToken=this.token);let c=new Y((d,h)=>{let p=()=>{h(new M(C.WS_ABORT))};this.websocket.once(pe.RECONNECTING,p),this.websocket.once(pe.CLOSED,p),this.once("@".concat(o,"-").concat(this.spec.sid),m=>{d(m)})});n&&te.workerEvent(this.spec.sid,bu(bu({},n),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));let l=Date.now();this.websocket.sendMessage(a);let u=null;try{u=await c}catch(d){if(this.websocket.state==="closed")throw d;return await s(),await this.request(e,t,r)}return n&&te.workerEvent(this.spec.sid,bu(bu({},n),{},{requestId:i,actionType:"response",payload:JSON.stringify(u.serverResponse),serverCode:u.code,success:u.code===200,responseTime:Date.now()-l})),u.code!==200&&this.handleResponseError(u),u}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e=zn==="4.22.0"?"0.0.1":zn;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case kt.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case kt.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case kt.LIVE_STREAM_RESPONSE_BAD_STREAM:case kt.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new M(C.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case kt.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new M(C.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case kt.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new M(C.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case kt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t=new M(C.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ra.WARNING,t,e.serverResponse.url)}case kt.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t=new M(C.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ra.WARNING,t,e.serverResponse.url)}case kt.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new M(C.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case kt.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new M(C.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case kt.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t=new M(C.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ra.WARNING,t,e.serverResponse.url)}case kt.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new M(C.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case kt.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new M(C.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case kt.LIVE_STREAM_RESPONSE_WORKER_LOST:case kt.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new M(C.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case kt.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new M(C.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new M(C.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case kt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case kt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case kt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case kt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new M(C.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(E_)},6e3)}};function KD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Qr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KD(Object(r),!0).forEach(function(n){y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KD(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var aZ=class extends lt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pt,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Pt;super(),y(this,"onLiveStreamWarning",void 0),y(this,"onLiveStreamError",void 0),y(this,"spec",void 0),y(this,"retryTimeout",1e4),y(this,"connection",void 0),y(this,"httpRetryConfig",void 0),y(this,"wsRetryConfig",void 0),y(this,"streamingTasks",new Map),y(this,"isStartingStreamingTask",!1),y(this,"taskMutex",new _r("live-streaming")),y(this,"cancelToken",$r.CancelToken.source()),y(this,"transcodingConfig",void 0),y(this,"uapResponse",void 0),y(this,"lastTaskId",1),y(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=r,this.wsRetryConfig=t}async setTranscodingConfig(e){let t=Qr(Qr({},iq),e);t.videoCodecProfile!==66&&t.videoCodecProfile!==77&&t.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(o=>Qr(Qr(Qr({},nq),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){at(o.width)||Be(o.width,"config.width",0,1e4),at(o.height)||Be(o.height,"config.height",0,1e4),at(o.videoBitrate)||Be(o.videoBitrate,"config.videoBitrate",1,1e6),at(o.videoFrameRate)||Be(o.videoFrameRate,"config.videoFrameRate"),at(o.lowLatency)||Ho(o.lowLatency,"config.lowLatency"),at(o.audioSampleRate)||Ut(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),at(o.audioBitrate)||Be(o.audioBitrate,"config.audioBitrate",1,128),at(o.audioChannels)||Ut(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),at(o.videoGop)||Be(o.videoGop,"config.videoGop"),at(o.videoCodecProfile)||Ut(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),at(o.userCount)||Be(o.userCount,"config.userCount",0,17),at(o.backgroundColor)||Be(o.backgroundColor,"config.backgroundColor",0,16777215),at(o.userConfigExtraInfo)||qt(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!at(o.transcodingUsers)&&(jo(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((a,s)=>{S_(a.uid),at(a.x)||Be(a.x,"transcodingUser[".concat(s,"].x"),0,1e4),at(a.y)||Be(a.y,"transcodingUser[".concat(s,"].y"),0,1e4),at(a.width)||Be(a.width,"transcodingUser[".concat(s,"].width"),0,1e4),at(a.height)||Be(a.height,"transcodingUser[".concat(s,"].height"),0,1e4),at(a.zOrder)||Be(a.zOrder-1,"transcodingUser[".concat(s,"].zOrder"),0,100),at(a.alpha)||Be(a.alpha,"transcodingUser[".concat(s,"].alpha"),0,1,!1)})),at(o.watermark)||Cg(o.watermark,"watermark"),at(o.backgroundImage)||Cg(o.backgroundImage,"backgroundImage"),o.images&&!at(o.images)&&(jo(o.images,"config.images"),o.images.forEach((a,s)=>{Cg(a,"images[".concat(s,"]"))}))}(t);let r=[];t.images&&r.push(...t.images.map(o=>Qr(Qr(Qr({},Rg),o),{},{zOrder:255}))),t.backgroundImage&&(r.push(Qr(Qr(Qr({},Rg),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(r.push(Qr(Qr(Qr({},Rg),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=r,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(o=>Qr({},o)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);let n=(t.userConfigs||[]).map(o=>typeof o.uid=="number"?Y.resolve(o.uid):MV(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Y.all(n)).forEach((o,a)=>{t.userConfigs&&t.userConfigs[a]&&(t.userConfigs[a].uid=o)}),this.transcodingConfig=t,this.connection)try{var i;let o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Jo(i=this.streamingTasks).call(i)).map(a=>a.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(a=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,o).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(a.url," success"))}).catch(s=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),a.url,s.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,s)})})}}async startLiveStreamingTask(e,t,r){if(!this.transcodingConfig&&t===Yo.TRANSCODE)throw new M(C.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let n={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));let i=await this.taskMutex.lock();if(!this.connection&&r)return void i();if(this.streamingTasks.get(e)&&!r)return i(),new M(C.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(a){throw i(),a}switch(t){case Yo.TRANSCODE:n.transcodingConfig=Qr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(n.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let o=this.lastTaskId++;try{let a=new Y((c,l)=>{er(this.retryTimeout).then(()=>{if(r)return l(r);let u=this.statusError.get(e);return u?(this.statusError.delete(e),l(u)):void 0})}),s=await Y.race([this.connection.request("request",{clientRequest:n},!0,{url:e,command:"PublishStream",workerType:t===Yo.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),a]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:n,mode:t,url:e,taskId:o}),i()}catch(a){if(i(),this.isStartingStreamingTask=!1,!a.data||!a.data.retry||r)throw a;return a.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,a)):await this.startLiveStreamingTask(e,t,a)}}stopLiveStreamingTask(e){return new Y((t,r)=>{let n=this.streamingTasks.get(e);if(!n||!this.connection)return new M(C.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let i=n.mode;n.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:n.url}},!1,{url:e,command:"UnPublishStream",workerType:i===Yo.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(r)})}resetAllTask(){var e;let t=Array.from(Jo(e=this.streamingTasks).call(e));this.terminate();for(let r of t)this.startLiveStreamingTask(r.url,r.mode).catch(n=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,n)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=$r.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new M(C.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await lr(this,ET.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new oZ(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Ra.WARNING,(r,n)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(n,r)),this.connection.on(Ra.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Ra.REQUEST_NEW_ADDRESS,(r,n)=>{if(!this.connection)return n(new M(C.UNEXPECTED_ERROR,"can not get new live streaming address list"));lr(this,ET.REQUEST_WORKER_MANAGER_LIST,e).then(i=>{this.uapResponse=i,r(i.addressList)}).catch(n)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){let t=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(t),n=e.reason;switch(e.code){case kt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case kt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case kt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case kt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let o=new M(C.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return v.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,o);if(!this.isStartingStreamingTask)return;this.statusError.set(t,o)}case kt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let o=new M(C.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,n);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,o)}case kt.LIVE_STREAM_RESPONSE_WORKER_LOST:case kt.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();let o=Array.from(Jo(i=this.streamingTasks).call(i));for(let a of o)a.abortTask?a.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,new M(C.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),a.url)}).catch(s=>{v.error(s.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,s)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}},sZ={name:"LiveStreaming",create:function(e){return new aZ(e.joinInfo,e.websocketRetryConfig||Pt,e.httpRetryConfig||Pt)}};function cZ(e){let t=zD();return function(r,n){let i=r.appId;i!==void 0&&(xe(n,10),lo(n,i));let o=r.cid;o!==void 0&&(xe(n,16),xe(n,o));let a=r.cname;a!==void 0&&(xe(n,26),lo(n,a));let s=r.deviceId;s!==void 0&&(xe(n,34),lo(n,s));let c=r.elapse;c!==void 0&&(xe(n,40),ma(n,c));let l=r.fileSize;l!==void 0&&(xe(n,48),ma(n,Ic(l)));let u=r.height;u!==void 0&&(xe(n,56),ma(n,Ic(u)));let d=r.jpg;d!==void 0&&(xe(n,66),xe(n,d.length),function(oe,U){let D=Ql(oe,U.length);oe.bytes.set(U,D)}(n,d));let h=r.networkType;h!==void 0&&(xe(n,72),ma(n,Ic(h)));let p=r.osType;p!==void 0&&(xe(n,80),ma(n,Ic(p)));let m=r.requestId;m!==void 0&&(xe(n,90),lo(n,m));let f=r.sdkVersion;f!==void 0&&(xe(n,98),lo(n,f));let _=r.sequence;_!==void 0&&(xe(n,104),ma(n,Ic(_)));let E=r.sid;E!==void 0&&(xe(n,114),lo(n,E));let g=r.timestamp;g!==void 0&&(xe(n,120),ma(n,g));let T=r.uid;T!==void 0&&(xe(n,128),xe(n,T));let R=r.vid;R!==void 0&&(xe(n,136),xe(n,R));let w=r.width;w!==void 0&&(xe(n,144),ma(n,Ic(w)));let A=r.service;A!==void 0&&(xe(n,152),xe(n,A));let N=r.callbackData;N!==void 0&&(xe(n,162),lo(n,N));let P=r.jpgEncryption;P!==void 0&&(xe(n,168),xe(n,P));let x=r.requestType;x!==void 0&&(xe(n,176),xe(n,x));let G=r.scorePorn;G!==void 0&&(xe(n,185),bv(n,G));let ne=r.scoreSexy;ne!==void 0&&(xe(n,193),bv(n,ne));let z=r.scoreNeutral;z!==void 0&&(xe(n,201),bv(n,z));let k=r.scene;k!==void 0&&(xe(n,208),xe(n,k));let F=r.ossFilePrefix;F!==void 0&&(xe(n,218),lo(n,F));let K=r.serviceVendor;if(K!==void 0)for(let oe of K){xe(n,226);let U=zD();dZ(oe,U),xe(n,U.limit),mZ(n,U),fZ(U)}}(e,t),function(r){let n=r.bytes,i=r.limit;return n.length===i?n:n.subarray(0,i)}(t)}function lZ(e){return function(r){let n={};e:for(;!DF(r);){let i=fo(r);switch(i>>>3){case 0:break e;case 1:n.code=fo(r);break;case 2:n.msg=kF(r,fo(r));break;case 3:{let o=hZ(r);n.data=uZ(r),r.limit=o;break}default:NF(r,7&i)}}return n}({bytes:t=e,offset:0,limit:t.length});var t}function uZ(e){let t={};e:for(;!DF(e);){let r=fo(e);switch(r>>>3){case 0:break e;case 1:t.requestId=kF(e,fo(e));break;case 2:t.requestType=fo(e)>>>0;break;case 3:t.scorePorn=Av(e);break;case 4:t.scoreSexy=Av(e);break;case 5:t.scoreNeutral=Av(e);break;case 6:t.requestScene=fo(e)>>>0;break;case 7:t.scene=fo(e)>>>0;break;default:NF(e,7&r)}}return t}function dZ(e,t){let r=e.service;r!==void 0&&(xe(t,8),xe(t,r));let n=e.vendor;n!==void 0&&(xe(t,16),xe(t,n));let i=e.token;i!==void 0&&(xe(t,26),lo(t,i));let o=e.callbackUrl;o!==void 0&&(xe(t,34),lo(t,o))}function hZ(e){let t=fo(e),r=e.limit;return e.limit=e.offset+t,r}function NF(e,t){switch(t){case 0:for(;128&LF(e););break;case 2:wv(e,fo(e));break;case 5:wv(e,4);break;case 1:wv(e,8);break;default:throw new Error("Unimplemented type: "+t)}}var pZ=new Float32Array(1);new Uint8Array(pZ.buffer);var XR=new Float64Array(1),en=new Uint8Array(XR.buffer);function Ic(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var PF=[];function zD(){let e=PF.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function fZ(e){PF.push(e)}function wv(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function DF(e){return e.offset>=e.limit}function Ql(e,t){let r=e.bytes,n=e.offset,i=e.limit,o=n+t;if(o>r.length){let a=new Uint8Array(2*o);a.set(r),e.bytes=a}return e.offset=o,o>i&&(e.limit=o),n}function JR(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function kF(e,t){let r=JR(e,t),n=String.fromCharCode,i=e.bytes,o="",a="";for(let s=0;s<t;s++){let c,l,u,d,h=i[s+r];128&h?(224&h)==192?s+1>=t?a+=o:(c=i[s+r+1],(192&c)!=128?a+=o:(d=(31&h)<<6|63&c,d<128?a+=o:(a+=n(d),s++))):(240&h)==224?s+2>=t?a+=o:(c=i[s+r+1],l=i[s+r+2],(49344&(c|l<<8))!=32896?a+=o:(d=(15&h)<<12|(63&c)<<6|63&l,d<2048||d>=55296&&d<=57343?a+=o:(a+=n(d),s+=2))):(248&h)==240?s+3>=t?a+=o:(c=i[s+r+1],l=i[s+r+2],u=i[s+r+3],(12632256&(c|l<<8|u<<16))!=8421504?a+=o:(d=(7&h)<<18|(63&c)<<12|(63&l)<<6|63&u,d<65536||d>1114111?a+=o:(d-=65536,a+=n(55296+(d>>10),56320+(1023&d)),s+=3))):a+=o:a+=n(h)}return a}function lo(e,t){let r=t.length,n=0;for(let a=0;a<r;a++){let s=t.charCodeAt(a);s>=55296&&s<=56319&&a+1<r&&(s=(s<<10)+t.charCodeAt(++a)-56613888),n+=s<128?1:s<2048?2:s<65536?3:4}xe(e,n);let i=Ql(e,n),o=e.bytes;for(let a=0;a<r;a++){let s=t.charCodeAt(a);s>=55296&&s<=56319&&a+1<r&&(s=(s<<10)+t.charCodeAt(++a)-56613888),s<128?o[i++]=s:(s<2048?o[i++]=s>>6&31|192:(s<65536?o[i++]=s>>12&15|224:(o[i++]=s>>18&7|240,o[i++]=s>>12&63|128),o[i++]=s>>6&63|128),o[i++]=63&s|128)}}function mZ(e,t){let r=Ql(e,t.limit),n=e.bytes,i=t.bytes;for(let o=0,a=t.limit;o<a;o++)n[o+r]=i[o]}function LF(e){return e.bytes[JR(e,1)]}function YD(e,t){let r=Ql(e,1);e.bytes[r]=t}function Av(e){let t=JR(e,8),r=e.bytes;return en[0]=r[t++],en[1]=r[t++],en[2]=r[t++],en[3]=r[t++],en[4]=r[t++],en[5]=r[t++],en[6]=r[t++],en[7]=r[t++],XR[0]}function bv(e,t){let r=Ql(e,8),n=e.bytes;XR[0]=t,n[r++]=en[0],n[r++]=en[1],n[r++]=en[2],n[r++]=en[3],n[r++]=en[4],n[r++]=en[5],n[r++]=en[6],n[r++]=en[7]}function fo(e){let t,r=0,n=0;do t=LF(e),r<32&&(n|=(127&t)<<r),r+=7;while(128&t);return n}function xe(e,t){for(t>>>=0;t>=128;)YD(e,127&t|128),t>>>=7;YD(e,t)}function ma(e,t){let r=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=i===0?n===0?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,a=Ql(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=o!==9?128|i:127&i;case 8:s[a+7]=o!==8?n>>>21|128:n>>>21&127;case 7:s[a+6]=o!==7?n>>>14|128:n>>>14&127;case 6:s[a+5]=o!==6?n>>>7|128:n>>>7&127;case 5:s[a+4]=o!==5?128|n:127&n;case 4:s[a+3]=o!==4?r>>>21|128:r>>>21&127;case 3:s[a+2]=o!==3?r>>>14|128:r>>>14&127;case 2:s[a+1]=o!==2?r>>>7|128:r>>>7&127;case 1:s[a]=o!==1?128|r:127&r}}function $D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}var _Z=new Map([["moderation",1],["supervise",2]]);function qD(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var EZ=class extends lt{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(Kt.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=qi(t=e.map(r=>_Z.get(r)||0)).call(t,(r,n)=>r+n),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),y(this,"name","AgoraRTCVideoContentInspect"),y(this,"_connectionState",li.CONNECTING),y(this,"_innerConnectionState",void 0),y(this,"sequence",0),y(this,"inspectStartTime",void 0),y(this,"workerManagerConnection",void 0),y(this,"workerConnection",void 0),y(this,"workerMessageLengthLimit",void 0),y(this,"inspectIntervalMinimum",void 0),y(this,"qualityRatio",void 0),y(this,"_connectInfo",void 0),y(this,"_cancelTokenSource",$r.CancelToken.source()),y(this,"_retryConfig",void 0),y(this,"wmSequence",0),y(this,"inspectInterval",void 0),y(this,"inspectTimer",null),y(this,"ossFilePrefix",void 0),y(this,"extraInfo",void 0),y(this,"_inspectType",void 0),y(this,"_inspectMode",void 0),y(this,"_quality",1),y(this,"qualityTimer",null),y(this,"_inspectId",void 0),y(this,"_needWorkUrlOnly",!1),y(this,"inspectImage",()=>{if(this.connectionState!==li.CONNECTED)throw new M(C.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===li.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ke(5,"inspect-"),this.workerMessageLengthLimit=b("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=b("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=b("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new zd("worker-manager-"+this._inspectId,Pt),this.on(Kt.STATE_CHANGE,(t,r)=>{this._innerConnectionState=t,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ni[t]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new zd("worker-"+this._inspectId,Pt),this.handleWorkerEvents()}async init(e,t){this.emit(Kt.STATE_CHANGE,ni.CONNECT_AP),this._connectInfo=e;let r=this._cancelTokenSource.token;return this._retryConfig=t,new Y((n,i)=>{this.on(Kt.CONNECTION_STATE_CHANGE,(o,a)=>{a===li.CONNECTED&&n()}),this.requestAP(e,r,t).then(o=>{this.connectWorkerManager(o)}).catch(o=>{i(o)})})}async requestAP(e,t,r){let n=b("WEBCS_DOMAIN").map(a=>"https://".concat(a,"/api/v1")),i=await function(a,s,c,l){let{appId:u,areaCode:d,cname:h,sid:p,token:m,uid:f}=s;pl++;let _="image_moderation_api",E={service_name:_,json_body:JSON.stringify({appId:u,areaCode:d,cname:h,command:"allocateEdge",requestId:pl,seq:pl,sid:p,token:m,ts:Date.now(),uid:f+""})},g,T,R=a[0];return Ji(async()=>{g=Date.now();let w=await Qi(R,{data:E,cancelToken:c,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(T=Date.now()-g,w.code!==0){let x=new M(C.UNEXPECTED_RESPONSE,"image inspect ap error, code"+w.code,{retry:!0,responseTime:T});throw v.error(x.toString()),x}let A=JSON.parse(w.json_body);if(A.code!==200){let x=new M(C.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(A.code,", reason: ").concat(A.reason),{code:A.code,responseTime:T});throw v.error(x.toString()),x}if(!A.servers||!Array.isArray(A.servers)||A.servers.length===0){let x=new M(C.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:A.code,responseTime:T});throw v.error(x.toString()),x}let N=b("VIDEO_INSPECT_WORKER_MANAGER_HOST"),P=b("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:A.servers.map(x=>{let{address:G,wss:ne}=x;if(G&&ne)return"wss://".concat(G.replace(/\./g,"-"),".").concat(N,":").concat(P||ne)}).filter(x=>!!x),workerToken:A.workerToken,vid:A.vid,responseTime:T}},(w,A)=>(te.apworkerEvent(p,{success:!0,sc:200,serviceName:_,responseDetail:JSON.stringify(w.addressList),firstSuccess:A===0,responseTime:T,serverIp:a[A%a.length]}),!1),(w,A)=>(te.apworkerEvent(p,{success:!1,sc:w.data&&w.data.code||200,serviceName:_,responseTime:T,serverIp:a[A%a.length]}),!!(w.code!==C.OPERATION_ABORTED&&w.code!==C.UNEXPECTED_RESPONSE||w.data&&w.data.retry)&&(R=a[(A+1)%a.length],!0)),l)}(n,e,t,r);this.emit(Kt.STATE_CHANGE,ni.AP_CONNECTED);let{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=t,this.emit(Kt.STATE_CHANGE,ni.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(pe.CONNECTED,async()=>{this.emit(Kt.STATE_CHANGE,ni.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(pe.CLOSED,()=>{this._innerConnectionState<ni.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(pe.FAILED,()=>{this._innerConnectionState<ni.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(pe.RECONNECTING,()=>{this._innerConnectionState<ni.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(pe.ON_MESSAGE,async e=>{this.emit(Kt.STATE_CHANGE,ni.GET_WORKER_MANAGER_RESPONSE);let t=this.workerManagerConnection.url;this.workerManagerConnection.close();let r=JSON.parse(e.data);if(r.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new M(C.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&t))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new M(C.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{let n=b("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,i=t.replace(/:\d+\/?$/,":".concat(n));this.emit(Kt.STATE_CHANGE,ni.CONNECT_WORKER,i),this._needWorkUrlOnly?this.emit(Kt.REQUEST_NEW_WORKER_URL,i):await this.connectWorker(i)}}),this.workerManagerConnection.on(pe.WILL_RECONNECT,(e,t,r)=>{r(e)}),this.workerManagerConnection.on(pe.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(pe.CONNECTED,async()=>{this.emit(Kt.STATE_CHANGE,ni.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=li.CONNECTED}),this.workerConnection.on(pe.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let r=lZ(new Uint8Array(e.data));if(b("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Kt.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var t;let n={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},i=qi(t=Object.keys(n)).call(t,(a,s)=>n[a]>n[s]?a:s,"porn"),o=Object.keys(n).find(a=>a===i);this.emit(Kt.INSPECT_RESULT,o)}else this.emit(Kt.INSPECT_RESULT,void 0,new M(C.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Kt.INSPECT_RESULT,void 0,new M(C.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Kt.INSPECT_RESULT,void 0,new M(C.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(pe.CLOSED,()=>{this.connectionState=li.CLOSED}),this.workerConnection.on(pe.FAILED,()=>{this.connectionState=li.CLOSED}),this.workerConnection.on(pe.RECONNECTING,()=>{this.connectionState=this.connectionState===li.CONNECTED?li.RECONNECTING:li.CONNECTING}),this.workerConnection.on(pe.WILL_RECONNECT,(e,t,r)=>{e==="recover"&&r(e),r("tryNext")}),this.workerConnection.on(pe.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(Kt.REQUEST_NEW_WORKER_URL,r=>{e([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{t(r)})})}async requestToInspectImage(){this.sequence++;let e=Kn(this,Kt.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Kt.INSPECT_RESULT,void 0,new M(C.INVALID_OPERATION,"Only the track being played can be inspected"));let r=await this.generateRequestData(e,t);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Kt.INSPECT_RESULT,void 0,new M(C.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:r,cname:n,cid:i,vid:o,sid:a,uid:s}=t,c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),u=await _V(l,r,n),d=this.sequence+"-"+i+"-"+s+"-"+c+"-"+Ke(12,""),h={appId:r,cid:i,cname:n,deviceId:"",elapse:qD(Number(c-this.inspectStartTime)),fileSize:u.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:d,sdkVersion:"4.22.0",sequence:this.sequence,sid:a,timestamp:qD(c),uid:s,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete h.callbackData,this.ossFilePrefix===void 0&&delete h.ossFilePrefix;let p=cZ(h);if(p.byteLength<this.workerMessageLengthLimit){if(b("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let m=function(f){for(var _=1;_<arguments.length;_++){var E=arguments[_]!=null?arguments[_]:{};_%2?$D(Object(E),!0).forEach(function(g){y(f,g,E[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(E)):$D(Object(E)).forEach(function(g){Object.defineProperty(f,g,Object.getOwnPropertyDescriptor(E,g))})}return f}({},h);delete m.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(m))}return p}{let m=this.quality*this.qualityRatio;return this.quality=m,await this.generateRequestData(e,{appId:r,cname:n,cid:i,vid:o,sid:a,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=$r.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=li.CLOSED,this.emit(Kt.STATE_CHANGE,ni.CLOSED)}},gZ={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new M(C.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new M(C.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let n=[...new Set(r.inspectType)];n.forEach(i=>{var o;if(!q(o=["supervise","moderation"]).call(o,i))throw new M(C.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),r.inspectType=n}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new M(C.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new EZ(t)}};je("PROCESS_ID","process-".concat(Ke(8,""),"-").concat(Ke(4,""),"-").concat(Ke(4,""),"-").concat(Ke(4,""),"-").concat(Ke(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void v.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();v.debug("Loading global parameters from cache",t),Object.keys(t).forEach(n=>{if(Object.prototype.hasOwnProperty.call(vt,n)){let{value:i,expires:o}=t[n];if(o&&o<=r)return;Na[n]=i,vt[n]=i}})}catch(t){v.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Na.AREAS)&&Na.AREAS.length>0&&BR(Na.AREAS,!0);var XD=(e,t,r)=>{v.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),je(e,t,r)};wu(iZ,!1),wu(sZ,!1),wu(GJ,!1),wu(gZ,!1),wu(tZ,!1);var dt=function(e){let t=new lt,r=e,n={getListeners:t.getListeners.bind(t),on:(i,o)=>(function(a,s){a===ho.SECURITY_POLICY_VIOLATION&&sF(s,!0)}(i,o),t.on.bind(t)(i,o)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return RD(RD({},r),n)}({__TRACK_LIST__:Oc,VERSION:zn,BUILD:AR,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:XD,getParameter:b,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,r=await async function(n){let i;return Pe().supportUnifiedPlan?(n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}),i=(await n.createOffer()).sdp):i=(await n.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!r)return e;t.close(),t=null,e=function(n){let i={video:[],audio:[]};return n.match(/ VP8/i)&&i.video.push("VP8"),n.match(/ VP9/i)&&i.video.push("VP9"),n.match(/ AV1/i)&&i.video.push("AV1"),n.match(/ H264/i)&&i.video.push("H264"),n.match(/ H265/i)&&i.video.push("H265"),n.match(/ opus/i)&&i.audio.push("OPUS"),n.match(/ PCMU/i)&&i.audio.push("PCMU"),n.match(/ PCMA/i)&&i.audio.push("PCMA"),n.match(/ G722/i)&&i.audio.push("G722"),i}(r)}catch(t){throw new M(C.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=te.reportApiInvoke(null,{name:Lt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:pt.TRACER}),t=!1;try{let o=window.RTCPeerConnection,a=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,s=window.WebSocket;t=!!(o&&a&&s),t&&yR()&&Tx(75)&&new o().close()}catch(o){return v.error("check system requirement failed: ",o),!1}let r=!1,n=Ne();n.name===Ue.CHROME&&Number(n.version)>=58&&(Bi.engine.name!=="WebKit"||function(){let o=Ne();if(um()){if(o.os===Gt.MAC_OS)return!0;if(o.os===Gt.IOS){let a=Bi.os.version&&Bi.os.version.split(".");if(a&&Number(a[0])===14&&a[1]&&Number(a[1])>=3||a&&Number(a[0])>14)return!0}}return!1}())&&(r=!0),(n.name===Ue.FIREFOX&&Number(n.version)>=56||n.name===Ue.OPERA&&Number(n.version)>=45||n.name===Ue.SAFARI&&Number(n.version)>=11||n.name==="WebKit"&&(Vr()||yi())&&n.osVersion&&Number(n.osVersion.split(".")[0])>=11||Ix()||Ne().name===Ue.QQ)&&(r=!0),v.debug("checkSystemRequirements, api:",t,"browser",r);let i=t&&r;return e.onSuccess(i),i},getDevices:function(e){return bn.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return bn.getRecordingDevices(e)},getCameras:function(e){return bn.getCamerasDevices(e)},getElectronScreenSources:aV,getPlaybackDevices:function(e){return bn.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},r=te.reportApiInvoke(null,{name:Lt.CREATE_CLIENT,options:[t],tag:pt.TRACER});try{(function(n){Ut(n.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ut(n.mode,"config.mode",["rtc","live","p2p"]),n.audioCodec!==void 0&&Ut(n.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),n.proxyServer!==void 0&&qt(n.proxyServer,"config.proxyServer",1,1e4),n.turnServer!==void 0&&Nx(n.turnServer),n.httpRetryConfig!==void 0&&GA(n.httpRetryConfig),n.websocketRetryConfig!==void 0&&GA(n.websocketRetryConfig)})(t)}catch(n){throw r.onError(n),n}return(Rx(16,0)||Cx(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",v.debug("browser not support vp9, force use vp8")),je("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new WJ(Vi(Vi({forceWaitGatewayResponse:!0},t),{},{role:q(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=b("CAMERA_CAPTURE_CONFIG"),r=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CREATE_CAM_VIDEO_TRACK,options:[rt({},e),t]});t&&(e.encoderConfig=t);let n=fm(e),i=Ke(8,"track-cam-"),o=null;v.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{o=(await Cn({video:n},i)).getVideoTracks()[0]||null}catch(s){throw r.onError(s),s}if(!o){let s=new V(C.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(s),s.throw(v)}e.optimizationMode&&qg(i,o,e,Eo(e.encoderConfig));let a=new wT(o,e,n,e.scalabiltyMode?yp(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return r.onSuccess(a.getTrackId()),v.info("create camera video success, trackId:",i),a},createCustomVideoTrack:function(e){let t=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new Xe(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?yp(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,Ke(8,"track-cus-"),[et.CUSTOM_TRACK]);return t.onSuccess(r.getTrackId()),v.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",r=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CREATE_SCREEN_VIDEO_TRACK,options:[rt({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let n=function(u){let d={};u.screenSourceType&&(d.mediaSource=u.screenSourceType),u.extensionId&&Wa()&&(d.extensionId=u.extensionId);let{displaySurface:h,selfBrowserSurface:p,surfaceSwitching:m,systemAudio:f}=u;(uT(107)||UA(107)||xA(93))&&(h&&(Ut(h,"displaySurface",["browser","window","monitor"]),d.displaySurface=h),p?(Ut(p,"selfBrowserSurface",["exclude","include"]),d.selfBrowserSurface=p):d.selfBrowserSurface="include",m&&(Ut(m,"surfaceSwitching",["exclude","include"]),d.surfaceSwitching=m)),(uT(105)||UA(105)||xA(91))&&f&&(Ut(f,"systemAudio",["exclude","include"]),d.systemAudio=f),u.electronScreenSourceId&&(d.sourceId=u.electronScreenSourceId);let _=u.encoderConfig?Kg(u.encoderConfig):null;return d.mandatory={chromeMediaSource:"desktop",maxWidth:_?_.width:void 0,maxHeight:_?_.height:void 0},_&&(_.frameRate&&(typeof _.frameRate=="number"?(d.mandatory.maxFrameRate=_.frameRate,d.mandatory.minFrameRate=_.frameRate):(d.mandatory.maxFrameRate=_.frameRate.max||_.frameRate.ideal||_.frameRate.exact||void 0,d.mandatory.minFrameRate=_.frameRate.min||_.frameRate.ideal||_.frameRate.exact||void 0),d.frameRate=_.frameRate),_.width&&(d.width=_.width),_.height&&(d.height=_.height)),d}(e),i=Ke(8,"track-scr-v-"),o=null,a=null,s=Pe();if(!s.supportShareAudio&&t==="enable"){let u=new V(C.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(u),u.throw(v)}v.info("start create screen video track with config",e,"withAudio",t,"trackId",i);try{let u=await Cn({screen:n,screenAudio:t==="auto"?s.supportShareAudio:t==="enable"},i);o=u.getVideoTracks()[0]||null,a=u.getAudioTracks()[0]||null}catch(u){throw r.onError(u),u}if(!o){let u=new V(C.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(u),u.throw(v)}if(!a&&t==="enable"){o&&o.stop();let u=new V(C.SHARE_AUDIO_NOT_ALLOWED);return r.onError(u),u.throw(v)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(qg(i,o,e,e.encoderConfig&&Kg(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let c=new Xe(o,e.encoderConfig?Kg(e.encoderConfig):{},e.scalabiltyMode?yp(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[et.SCREEN_TRACK]);if(!a)return r.onSuccess(c.getTrackId()),v.info("create screen video track success","video:",c.getTrackId()),c;let l=new ht(a,void 0,Ke(8,"track-scr-a-"),!1);return r.onSuccess([c.getTrackId(),l.getTrackId()]),v.info("create screen video track success","video:",c.getTrackId(),"audio:",l.getTrackId()),[c,l]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=b("CAMERA_CAPTURE_CONFIG"),n=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);let i=fm(t),o=Wb(e),a=Ke(8,"track-mic-"),s=Ke(8,"track-cam-"),c=null,l=null;v.info("start create camera video track(".concat(s,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let h=await Cn({audio:o,video:i},"".concat(a,"-").concat(s));c=h.getAudioTracks()[0],l=h.getVideoTracks()[0]}catch(h){throw n.onError(h),h}if(!c||!l){let h=new V(C.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(h),h.throw(v)}t.optimizationMode&&qg(s,l,t,Eo(t.encoderConfig));let u=new mm(c,e,o,a),d=new wT(l,t,i,t.scalabiltyMode?yp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return n.onSuccess([u.getTrackId(),d.getTrackId()]),v.info("create camera video track(".concat(s,") and microphone audio track(").concat(a,") success")),[u,d]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=Wb(e),n=Ke(8,"track-mic-"),i=null;v.info("start create microphone audio track with config",JSON.stringify(e),"trackId",n);try{i=(await Cn({audio:r},n)).getAudioTracks()[0]||null}catch(a){throw t.onError(a),a}if(!i){let a=new V(C.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(a),a.throw(v)}let o=new mm(i,e,r,n);return t.onSuccess(o.getTrackId()),v.info("create microphone audio track success, trackId:",n),o},createCustomAudioTrack:function(e){let t=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new ht(e.mediaStreamTrack,e.encoderConfig?pm(e.encoderConfig):{},Ke(8,"track-cus-"),!1);return v.info("create custom audio track success with config",e,"trackId",r.getTrackId()),t.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:r,encoderConfig:n}=e,{source:i}=e,o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:r,encoderConfig:n},a=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(b("DISABLE_WEBAUDIO"))throw new V(C.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let s=Ke(8,"track-buf-");v.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",s);let c=i;if(!(i instanceof AudioBuffer))try{i=await async function(d,h){let p=null;if(typeof d=="string"){let f=AO.get(d);if(f)return v.debug("use cached audio resource: ",d),f;try{p=(await Ji(()=>$r.get(d,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(_){throw new V(C.FETCH_AUDIO_FILE_FAILED,_.toString())}}else p=await new Y((f,_)=>{let E=new FileReader;E.onload=g=>{g.target?f(g.target.result):_(new V(C.READ_LOCAL_AUDIO_FILE_ERROR))},E.onerror=()=>{_(new V(C.READ_LOCAL_AUDIO_FILE_ERROR))},E.readAsArrayBuffer(d)});let m=await function(f){let _=$l();return new Y((E,g)=>{_.decodeAudioData(f,T=>{E(T)},T=>{g(new V(C.DECODE_AUDIO_FILE_FAILED,T.toString()))})})}(p);return typeof d=="string"&&h&&AO.set(d,m),m}(i,r)}catch(d){return a.onError(d),d.throw(v)}let l=new FX(i),u=new VX(c,l,n?pm(n):{},s);return v.info("create buffer source audio track success, trackId:",s),a.onSuccess(u.getTrackId()),u},setAppType:function(e){if(v.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw v.debug("Invalid appType"),new M(C.INVALID_PARAMS,"invalid app type",e);je("APP_TYPE",Math.floor(e))},setLogLevel:function(e){v.setLogLevel(e)},enableLogUpload:function(){b("USE_NEW_LOG")?je("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){b("USE_NEW_LOG")?je("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new KV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof ht||e instanceof hl)){let c=new M(C.INVALID_TRACK,"the parameter is not a audio track");return r.onError(c),c.throw()}t&&t<1e3&&(t=1e3);let n=e instanceof ht?e.getTrackLabel():"remote_track",i=e.getVolumeLevel(),o=i,a=i,s=Date.now();return new Y(c=>{let l=setInterval(()=>{let u=e.getVolumeLevel();o=u>o?u:o,a=u<a?u:a;let d=o-a>1e-4,h=Date.now()-s;if(d||h>t){clearInterval(l);let p=d,m={duration:h,deviceLabel:n,maxVolumeLevel:o,result:p};v.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(m))),r.onSuccess(m),c(p)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=te.reportApiInvoke(null,{tag:pt.TRACER,name:Lt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Xe||e instanceof dl)){let d=new M(C.INVALID_TRACK,"the parameter is not a video track");return r.onError(d),d.throw()}t&&t<1e3&&(t=1e3);let n=e instanceof Xe?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(cr()||um())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();let a=document.createElement("canvas");a.width=160,a.height=120;let s=0,c=0;try{let d=Date.now();s=await function(h,p,m,f){let _,E=0,g=null;return new Y((T,R)=>{function w(){E>f&&_&&(_(),T(E));let A=m.getContext("2d");if(!A){let x=new M(C.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(x.toString()),void R(x)}A.drawImage(h,0,0,160,120);let N=A.getImageData(0,0,m.width,m.height),P=Math.floor(N.data.length/3);if(g){for(let x=0;x<P;x+=3)if(N.data[x]!==g[x])return E+=1,void(g=N.data);g=N.data}else g=N.data}setTimeout(()=>{_&&(_(),T(E))},p),_=MR(()=>{w()},30)})}(o,t,a,4),c=Date.now()-d}catch(d){throw r.onError(d),d}AJ===Ue.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;let l=s>4,u={duration:c,changedPicNum:s,deviceLabel:n,result:l};return v.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(u))),r.onSuccess(u),l},setArea:BR,audioElementPlayCenter:Kr,resumeAudioContext:function(){Kr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){KJ.processExternalMediaAEC(e)},registerExtensions:function(e){let t=b("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!q(t).call(t,r.name)&&t.push(r.name);let n=r;n.__registered__=!0,n.logger.hookLog=v.extLog,n.reporter.hookApiInvoke=te.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(i=>{n.parameters[i]=b(i)})}),XD("PLUGIN_INFO",t)},ChannelMediaRelayError:bc,ChannelMediaRelayEvent:Mo,ChannelMediaRelayState:Zr,RemoteStreamFallbackType:PX,RemoteStreamType:NX,ConnectionDisconnectedReason:Ve,AudienceLatencyLevelType:u$,AREAS:ke,preload:async function(e,t,r,n){return JV(e,t,r,n)}});Object.defineProperties(dt,{onAudioAutoplayFailed:{get:()=>Sn.onAudioAutoplayFailed,set:e=>{Sn.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Sn.onAutoplayFailed,set:e=>{Sn.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>dt._onSecurityPolicyViolation,set(e){dt._onSecurityPolicyViolation=e,sF(e)}},__CLIENT_LIST__:{get:()=>b("SHOW_GLOBAL_CLIENT_LIST")?ya:[]}}),bn.on(Ns.CAMERA_DEVICE_CHANGED,e=>{v.info("camera device changed",JSON.stringify(e)),dt.onCameraChanged&&dt.onCameraChanged(e),dt.safeEmit(ho.CAMERA_CHANGED,e)}),bn.on(Ns.RECORDING_DEVICE_CHANGED,e=>{v.info("microphone device changed",JSON.stringify(e)),dt.onMicrophoneChanged&&dt.onMicrophoneChanged(e),dt.safeEmit(ho.MICROPHONE_CHANGED,e)}),bn.on(Ns.PLAYOUT_DEVICE_CHANGED,e=>{v.debug("playout device changed",JSON.stringify(e)),dt.onPlaybackDeviceChanged&&dt.onPlaybackDeviceChanged(e),dt.safeEmit(ho.PLAYBACK_DEVICE_CHANGED,e)}),Kr.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),Sn.onAudioAutoplayFailed&&Sn.onAudioAutoplayFailed()},Fe.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),Sn.onAudioAutoplayFailed&&Sn.onAudioAutoplayFailed(),dt.safeEmit(ho.AUTOPLAY_FAILED)}),Fe.on(Jt.STATE_CHANGE,(e,t)=>{v.info("audio context state changed: ".concat(t," => ").concat(e)),dt.onAudioContextStateChanged&&dt.onAudioContextStateChanged(e,t),dt.safeEmit(ho.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),wt.on($c.NETWORK_STATE_CHANGE,(e,t)=>{v.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=dt);function $o(e,t,r){return e.on(t,r),()=>e.off(t,r)}function vZ(e){try{return e()}catch(t){console.error(t)}}function Ih(e){return()=>e.forEach(vZ)}function SZ(e,t){let r=setTimeout(e,t);return()=>clearTimeout(r)}function QR(){let e,t,r;function n(){if(t){let l=t;t=void 0,l()}}async function i(){if(r){let l=r;r=void 0;try{await l()}catch(u){console.error(u)}}}async function o(l){e=!0,await i();try{r=await l()}catch(u){console.error(u)}e=!1,n()}async function a(){e=!0,await i(),e=!1,n()}function s(l){e?t=()=>o(l):o(l)}function c(){e?t=a:a()}return{run:s,dispose:c}}var MF=typeof document<"u"?Q.useLayoutEffect:Q.useEffect;function TZ(e){return e!=null&&typeof e.then=="function"}function Zl(){let e=Q.useRef(!1);return Q.useEffect(()=>(e.current=!1,()=>{e.current=!0}),[]),e}function yZ(){let e=Zl();function t(r,n){return new Promise(async(i,o)=>{try{let a=await r;e.current||i(a)}catch(a){e.current?n&&n(a):o(a)}})}return Q.useCallback(t,[e])}function UF(e){let t=yZ(),[r,n]=Q.useState();return MF(()=>{TZ(e)?t(e).then(n):n(e)},[e,t]),r}function wh(e,t){let r=Q.useRef();Q.useEffect(()=>{let{run:n,dispose:i}=r.current||(r.current=QR());return n(e),i},t)}function RZ(e,t){let r=e.split("."),n=t.split("."),i=Math.max(r.length,n.length);for(let o=0;o<i;o++){let a=parseInt(r[o]||"0"),s=parseInt(n[o]||"0");if(a>s)return 1;if(a<s)return-1}return 0}var xF=Q.createContext(null);function CZ({client:e,children:t}){return fe.jsx(xF.Provider,{value:e,children:t})}function IZ(e){let t=Q.useContext(xF);return e||t}function oc(e){let t=IZ(e);if(!t)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return t}Q.createContext(null);function eu(e){let t=oc(e),[r,n]=Q.useState(t?t.connectionState==="CONNECTED":!1);return Q.useEffect(()=>{if(t){n(t.connectionState==="CONNECTED");let i;return Ih([$o(t,"connection-state-change",o=>{i==null||i(),i=SZ(()=>n(o==="CONNECTED"),0)}),()=>i==null?void 0:i()])}else n(!1)},[t]),r}var yo=class extends Error{constructor(t,r){var e=(...Oee)=>(super(...Oee),ru(this,"rtcMethod"),ru(this,"rtcError"),ru(this,"name","AgoraRTCReactException"),this);e(typeof r=="string"?r:r.message),this.rtcMethod=t,this.rtcError=r}log(t){console[t](this)}};function wZ(e,t=!0,r){let n=oc(r),i=eu(r),o=Q.useRef(),[a,s]=Q.useState(!1),[c,l]=Q.useState(0),[u,d]=Q.useState(null),h=Zl();return wh(async()=>{if(h.current||(d(null),l(0),s(!1)),t&&n){try{h.current||s(!0);let{appid:m,channel:f,token:_,uid:E}=typeof e=="function"?await e():e,g=await n.join(m,f,_,E);h.current||l(g)}catch(m){console.error(m),h.current||d(new yo("IAgoraRTCClient.join",m))}h.current||s(!1);let p=o.current||(o.current=QR());return Ih([()=>{p.dispose()},()=>{p.run(()=>n.unpublish(n.localTracks))},()=>{for(let m of n.localTracks)m.isPlaying&&m.stop(),m.close();p.run(()=>n.leave())}])}},[t,r]),{data:c,isLoading:a,isConnected:i,error:u}}function AZ(e,t=!0,r){let n=oc(r),i=eu(r),o=Q.useRef([]),[a,s]=Q.useState(!1),[c,l]=Q.useState(null),u=Zl();return wh(async()=>{if(u.current||(s(!1),l(null)),!n||!i||!t)return;let d=e.filter(Boolean),h=f=>{let _=RZ(dt.VERSION,"4.18.2")>=0;return _||new yo("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),_?n.mode!=="live"||n.role!=="audience":!0},p=f=>o.current.some(_=>_&&_.getTrackId()===f.getTrackId()),m=f=>h()&&f.enabled&&t&&!p(f);for(let f=0;f<d.length;f++){let _=d[f];if(_&&m(_)){await n.unpublish(o.current.filter(E=>(E==null?void 0:E.trackMediaType)===_.trackMediaType));try{u.current||s(!0),await n.publish(_)}catch(E){console.error(E),u.current||l(new yo("IAgoraRTCClient.publish",E))}u.current||s(!1)}}o.current=d},[i,t,n,e]),{isLoading:a,error:c}}function bZ(e=!0,t={ANS:!0,AEC:!0},r){let n=eu(r),[i,o]=Q.useState(null),[a,s]=Q.useState(!1),[c,l]=Q.useState(null),u=Zl();return wh(async()=>{if(u.current||(s(!1),l(null)),n&&e&&!i){try{u.current||s(!0);let d=await dt.createMicrophoneAudioTrack(t);u.current||o(d)}catch(d){console.error(d),u.current||l(new yo("IAgoraRTC.createMicrophoneAudioTrack",d))}u.current||s(!1)}!n&&!u.current&&o(null)},[n,e]),{localMicrophoneTrack:i,isLoading:a,error:c}}function OZ(e,t){let r=oc(t),[n,i]=Q.useState([]),o=eu(),a=Q.useRef([]),[s,c]=Q.useState(!1),[l,u]=Q.useState(null),d=Zl();return wh(async()=>{if(d.current||u(null),!Array.isArray(e)||!o)return;let h=async f=>{if(!f.audioTrack&&e.some(({uid:_})=>f.uid===_)){try{d.current||c(!0),await r.subscribe(f,"audio")}catch(_){console.error(_),d.current||u(new yo("IAgoraRTCClient.subscribe",_))}f.audioTrack&&!a.current.some(_=>_.getUserId()===f.uid)&&a.current.push(f.audioTrack),a.current=a.current.map(_=>f.audioTrack&&_.getUserId()===f.uid&&_.getTrackId()!==f.audioTrack.getTrackId()?f.audioTrack:_),d.current||(i([...a.current]),c(!1))}},p=async f=>{if(e.some(({uid:_})=>f.uid===_)){d.current||(a.current=a.current.filter(_=>_.getUserId()!==f.uid),i([...a.current]));try{d.current||c(!0),await r.unsubscribe(f,"audio")}catch(_){console.error(_),d.current||u(new yo("IAgoraRTCClient.unsubscribe",_))}d.current||c(!1)}};e.map(f=>{!f.audioTrack&&f.hasAudio&&h(f)});let m=[];for(let f=0;f<a.current.length;f++){let _=a.current[f];if(!e.some(E=>E.uid===_.getUserId())){let E=r.remoteUsers.find(g=>g.uid===_.getUserId());E&&m.push({user:E,mediaType:"audio"}),a.current.splice(f,1),f--}}if(m.length>0){try{d.current||c(!0),await r.massUnsubscribe(m)}catch(f){console.error(f),d.current||u(new yo("IAgoraRTCClient.massUnsubscribe",f))}d.current||(i(a.current.slice()),c(!1))}return Ih([$o(r,"user-published",(f,_)=>{e.find(E=>E.uid===f.uid)&&_==="audio"&&h(f)}),$o(r,"user-unpublished",(f,_)=>{e.find(E=>E.uid===f.uid)&&_==="audio"&&p(f)})])},[o,r,e]),{audioTracks:n,isLoading:s,error:l}}function JD(e,t,r){let n=oc(r),i=t==="audio"?"audioTrack":"videoTrack",[o,a]=Q.useState(e&&e[i]),s=eu(),c=Q.useRef(),[l,u]=Q.useState(!1),[d,h]=Q.useState(null);return Q.useEffect(()=>{if(!e||!s)return;let p=!1;p||h(null);let m=t==="audio"?"hasAudio":"hasVideo",f=e.uid,_=async(T,R)=>{if(T[i]&&n.remoteUsers.some(({uid:w})=>T.uid===w))try{p||u(!0),await n.unsubscribe(T,R)}catch(w){p||h(new yo("IAgoraRTCClient.unsubscribe",w)),console.error(w)}p||(a(void 0),u(!1))},E=async(T,R)=>{try{!T[i]&&n.remoteUsers.some(({uid:w})=>T.uid===w)&&(p||u(!0),await n.subscribe(T,R)),p||a(T[i])}catch(w){p||h(new yo("IAgoraRTCClient.subscribe",w)),console.error(w)}p||u(!1)},g=c.current||(c.current=QR());return!e[i]&&e[m]?g.run(()=>E(e,t)):a(e[i]),Ih([()=>{p=!0,g.dispose()},$o(n,"user-published",(T,R)=>{T.uid===f&&R===t&&g.run(()=>E(T,t))}),$o(n,"user-unpublished",(T,R)=>{T.uid===f&&R===t&&g.run(()=>_(T,t))})])},[s,n,e,t,i]),{track:o,isLoading:l,error:d}}function NZ(e){let t=oc(e),[r,n]=Q.useState(t?t.remoteUsers:[]);return Q.useEffect(()=>{if(t){let i=()=>n(t.remoteUsers.slice());return Ih([$o(t,"user-joined",i),$o(t,"user-left",i),$o(t,"user-published",i),$o(t,"user-unpublished",i)])}},[t]),r}function PZ(e=!0,t,r,n){let i=eu(n),[o,a]=Q.useState(null),[s,c]=Q.useState(!1),[l,u]=Q.useState(null),d=Zl();return wh(async()=>{if(d.current||(c(!1),u(null)),i&&e&&!o){try{d.current||c(!0);let h=await dt.createScreenVideoTrack(t,r);d.current||a(h)}catch(h){console.error(h),d.current||u(new yo("IAgoraRTC.createScreenVideoTrack",h))}d.current||c(!1)}(!i||!e)&&!d.current&&a(null)},[i,e]),{screenTrack:o,isLoading:s,error:l}}var VF=Q.createContext(void 0);function FF(e,t,r,n){let i=Q.useContext(VF);Q.useEffect(()=>{if(e)return n&&t?e.play(n,r||void 0):e.stop(),i?(i.onMount(e),()=>i.onUnmount(e)):()=>{e.isPlaying&&e.stop()}},[e,n,t,i,r])}function jF(e,t){let r=Q.useContext(VF);MF(()=>{if(e)return t?e.play():e.stop(),r?(r.onMount(e),()=>r.onUnmount(e)):()=>{e.isPlaying&&e.stop()}},[e,t,r])}function DZ({track:e,play:t=!1,volume:r,disabled:n,muted:i,children:o}){let a=UF(e);return jF(a,t),Q.useEffect(()=>{a&&r!=null&&a.setVolume(r)},[a,r]),Q.useEffect(()=>{a&&n!=null&&a.setEnabled(!n).catch(console.warn)},[n,a]),Q.useEffect(()=>{a&&i!=null&&a.setMuted(i).catch(console.warn)},[i,a]),o?fe.jsx(fe.Fragment,{children:o}):null}var BF={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},GF={width:"100%",height:"100%"},ZR={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},w_=(e,t)=>Q.useMemo(()=>({...e,...t}),[e,t]);function kZ({track:e,play:t,disabled:r,muted:n,style:i,videoPlayerConfig:o,...a}){let s=w_(GF,i),[c,l]=Q.useState(null),u=UF(e);return FF(u,t,o,c),Q.useEffect(()=>{u&&r!=null&&u.setEnabled(!r).catch(console.warn)},[r,u]),Q.useEffect(()=>{u&&n!=null&&u.setMuted(n).catch(console.warn)},[n,u]),fe.jsx("div",{...a,ref:l,style:s})}var LZ={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},MZ={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function WF({cover:e}){return fe.jsx("div",{style:ZR,children:typeof e=="string"?fe.jsxs(fe.Fragment,{children:[fe.jsx("div",{style:{...LZ,backgroundImage:`url(${e})`}}),fe.jsx("img",{src:e,style:MZ})]}):e()})}function UZ({micOn:e,cameraOn:t,audioTrack:r,videoTrack:n,playAudio:i,playVideo:o,volume:a,cover:s,children:c,style:l,...u}){let d=w_(BF,l);return o=o??!!t,i=i??!!e,fe.jsxs("div",{...u,style:d,children:[fe.jsx(kZ,{disabled:!t,play:o,track:n}),fe.jsx(DZ,{disabled:!e,play:i,track:r,volume:a}),s&&!t&&fe.jsx(WF,{cover:s}),fe.jsx("div",{style:ZR,children:c})]})}function xZ({track:e,play:t=!1,playbackDeviceId:r,volume:n,children:i}){return jF(e,t),Q.useEffect(()=>{e&&r!=null&&e.setPlaybackDevice(r).catch(console.warn)},[e,r]),Q.useEffect(()=>{e&&n!=null&&e.setVolume(n)},[e,n]),i?fe.jsx(fe.Fragment,{children:i}):null}function VZ({track:e,play:t,style:r,videoPlayerConfig:n,...i}){let o=w_(GF,r),[a,s]=Q.useState(null);return FF(e,t,n,a),fe.jsx("div",{...i,ref:s,style:o})}function QD({user:e,playVideo:t,playAudio:r,playbackDeviceId:n,volume:i,cover:o,style:a,children:s,videoPlayerConfig:c,...l}){let u=w_(BF,a),{track:d}=JD(e,"video"),{track:h}=JD(e,"audio");return t=t??(e==null?void 0:e.hasVideo),r=r??(e==null?void 0:e.hasAudio),fe.jsxs("div",{...l,style:u,children:[fe.jsx(VZ,{play:t,track:d,videoPlayerConfig:c}),fe.jsx(xZ,{play:r,playbackDeviceId:n,track:h,volume:i}),o&&!t&&fe.jsx(WF,{cover:o}),fe.jsx("div",{style:ZR,children:s})]})}var FZ=class{constructor(){ru(this,"appType",1001);dt.setAppType(this.appType)}};new FZ;var HF=dt,wm,Am;(function(e){e.STATIONARY_NS="STATIONARY_NS",e.NSNG="NSNG"})(wm||(wm={})),function(e){e.SOFT="SOFT",e.AGGRESSIVE="AGGRESSIVE"}(Am||(Am={}));var ZD,Nt={exports:{}};function Gi(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(l){try{c(n.next(l))}catch(u){o(u)}}function s(l){try{c(n.throw(l))}catch(u){o(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof r?u:new r(function(d){d(u)})).then(a,s)}c((n=n.apply(e,[])).next())})}ZD=()=>(()=>{var e={3536:(i,o,a)=>{var s=a(1910);i.exports=s},8171:(i,o,a)=>{a(6450);var s=a(4058).Object,c=i.exports=function(l,u,d){return s.defineProperty(l,u,d)};s.defineProperty.sham&&(c.sham=!0)},2956:(i,o,a)=>{a(7627),a(6274),a(5967),a(8881),a(4560),a(7206),a(4349),a(7971);var s=a(4058);i.exports=s.Promise},3685:(i,o,a)=>{i.exports=a(621)},621:(i,o,a)=>{var s=a(3536);i.exports=s},4883:(i,o,a)=>{var s=a(7475),c=a(9826),l=TypeError;i.exports=function(u){if(s(u))return u;throw l(c(u)+" is not a function")}},174:(i,o,a)=>{var s=a(4284),c=a(9826),l=TypeError;i.exports=function(u){if(s(u))return u;throw l(c(u)+" is not a constructor")}},1851:(i,o,a)=>{var s=a(7475),c=String,l=TypeError;i.exports=function(u){if(typeof u=="object"||s(u))return u;throw l("Can't set "+c(u)+" as a prototype")}},8479:i=>{i.exports=function(){}},5743:(i,o,a)=>{var s=a(7046),c=TypeError;i.exports=function(l,u){if(s(u,l))return l;throw c("Incorrect invocation")}},6059:(i,o,a)=>{var s=a(941),c=String,l=TypeError;i.exports=function(u){if(s(u))return u;throw l(c(u)+" is not an object")}},1692:(i,o,a)=>{var s=a(4529),c=a(9413),l=a(623),u=function(d){return function(h,p,m){var f,_=s(h),E=l(_),g=c(m,E);if(d&&p!=p){for(;E>g;)if((f=_[g++])!=f)return!0}else for(;E>g;g++)if((d||g in _)&&_[g]===p)return d||g||0;return!d&&-1}};i.exports={includes:u(!0),indexOf:u(!1)}},3765:(i,o,a)=>{var s=a(5329);i.exports=s([].slice)},1385:(i,o,a)=>{var s=a(9813)("iterator"),c=!1;try{var l=0,u={next:function(){return{done:!!l++}},return:function(){c=!0}};u[s]=function(){return this},Array.from(u,function(){throw 2})}catch{}i.exports=function(d,h){if(!h&&!c)return!1;var p=!1;try{var m={};m[s]=function(){return{next:function(){return{done:p=!0}}}},d(m)}catch{}return p}},2532:(i,o,a)=>{var s=a(4163),c=s({}.toString),l=s("".slice);i.exports=function(u){return l(c(u),8,-1)}},9697:(i,o,a)=>{var s=a(2885),c=a(7475),l=a(2532),u=a(9813)("toStringTag"),d=Object,h=l(function(){return arguments}())=="Arguments";i.exports=s?l:function(p){var m,f,_;return p===void 0?"Undefined":p===null?"Null":typeof(f=function(E,g){try{return E[g]}catch{}}(m=d(p),u))=="string"?f:h?l(m):(_=l(m))=="Object"&&c(m.callee)?"Arguments":_}},3489:(i,o,a)=>{var s=a(953),c=a(1136),l=a(9677),u=a(5988);i.exports=function(d,h,p){for(var m=c(h),f=u.f,_=l.f,E=0;E<m.length;E++){var g=m[E];s(d,g)||p&&s(p,g)||f(d,g,_(h,g))}}},4160:(i,o,a)=>{var s=a(5981);i.exports=!s(function(){function c(){}return c.prototype.constructor=null,Object.getPrototypeOf(new c)!==c.prototype})},3538:i=>{i.exports=function(o,a){return{value:o,done:a}}},2029:(i,o,a)=>{var s=a(5746),c=a(5988),l=a(1887);i.exports=s?function(u,d,h){return c.f(u,d,l(1,h))}:function(u,d,h){return u[d]=h,u}},1887:i=>{i.exports=function(o,a){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:a}}},5929:(i,o,a)=>{var s=a(2029);i.exports=function(c,l,u,d){return d&&d.enumerable?c[l]=u:s(c,l,u),c}},5609:(i,o,a)=>{var s=a(1899),c=Object.defineProperty;i.exports=function(l,u){try{c(s,l,{value:u,configurable:!0,writable:!0})}catch{s[l]=u}return u}},5746:(i,o,a)=>{var s=a(5981);i.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},6616:i=>{var o=typeof document=="object"&&document.all,a=o===void 0&&o!==void 0;i.exports={all:o,IS_HTMLDDA:a}},1333:(i,o,a)=>{var s=a(1899),c=a(941),l=s.document,u=c(l)&&c(l.createElement);i.exports=function(d){return u?l.createElement(d):{}}},3281:i=>{i.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},3321:(i,o,a)=>{var s=a(8501),c=a(6049);i.exports=!s&&!c&&typeof window=="object"&&typeof document=="object"},8501:i=>{i.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},4470:(i,o,a)=>{var s=a(2861),c=a(1899);i.exports=/ipad|iphone|ipod/i.test(s)&&c.Pebble!==void 0},2749:(i,o,a)=>{var s=a(2861);i.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(s)},6049:(i,o,a)=>{var s=a(2532),c=a(1899);i.exports=s(c.process)=="process"},8045:(i,o,a)=>{var s=a(2861);i.exports=/web0s(?!.*chrome)/i.test(s)},2861:(i,o,a)=>{var s=a(626);i.exports=s("navigator","userAgent")||""},3385:(i,o,a)=>{var s,c,l=a(1899),u=a(2861),d=l.process,h=l.Deno,p=d&&d.versions||h&&h.version,m=p&&p.v8;m&&(c=(s=m.split("."))[0]>0&&s[0]<4?1:+(s[0]+s[1])),!c&&u&&(!(s=u.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=u.match(/Chrome\/(\d+)/))&&(c=+s[1]),i.exports=c},6759:i=>{i.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3995:(i,o,a)=>{var s=a(5329),c=Error,l=s("".replace),u=String(c("zxcasd").stack),d=/\n\s*at [^:]*:[^\n]*/,h=d.test(u);i.exports=function(p,m){if(h&&typeof p=="string"&&!c.prepareStackTrace)for(;m--;)p=l(p,d,"");return p}},8780:(i,o,a)=>{var s=a(5981),c=a(1887);i.exports=!s(function(){var l=Error("a");return!("stack"in l)||(Object.defineProperty(l,"stack",c(1,7)),l.stack!==7)})},6887:(i,o,a)=>{var s=a(1899),c=a(9730),l=a(5329),u=a(7475),d=a(9677).f,h=a(7252),p=a(4058),m=a(6843),f=a(2029),_=a(953),E=function(g){var T=function(R,w,A){if(this instanceof T){switch(arguments.length){case 0:return new g;case 1:return new g(R);case 2:return new g(R,w)}return new g(R,w,A)}return c(g,this,arguments)};return T.prototype=g.prototype,T};i.exports=function(g,T){var R,w,A,N,P,x,G,ne,z=g.target,k=g.global,F=g.stat,K=g.proto,oe=k?s:F?s[z]:(s[z]||{}).prototype,U=k?p:p[z]||f(p,z,{})[z],D=U.prototype;for(A in T)R=!h(k?A:z+(F?".":"#")+A,g.forced)&&oe&&_(oe,A),P=U[A],R&&(x=g.dontCallGetSet?(ne=d(oe,A))&&ne.value:oe[A]),N=R&&x?x:T[A],R&&typeof P==typeof N||(G=g.bind&&R?m(N,s):g.wrap&&R?E(N):K&&u(N)?l(N):N,(g.sham||N&&N.sham||P&&P.sham)&&f(G,"sham",!0),f(U,A,G),K&&(_(p,w=z+"Prototype")||f(p,w,{}),f(p[w],A,N),g.real&&D&&!D[A]&&f(D,A,N)))}},5981:i=>{i.exports=function(o){try{return!!o()}catch{return!0}}},9730:(i,o,a)=>{var s=a(8285),c=Function.prototype,l=c.apply,u=c.call;i.exports=typeof Reflect=="object"&&Reflect.apply||(s?u.bind(l):function(){return u.apply(l,arguments)})},6843:(i,o,a)=>{var s=a(5329),c=a(4883),l=a(8285),u=s(s.bind);i.exports=function(d,h){return c(d),h===void 0?d:l?u(d,h):function(){return d.apply(h,arguments)}}},8285:(i,o,a)=>{var s=a(5981);i.exports=!s(function(){var c=(function(){}).bind();return typeof c!="function"||c.hasOwnProperty("prototype")})},8834:(i,o,a)=>{var s=a(8285),c=Function.prototype.call;i.exports=s?c.bind(c):function(){return c.apply(c,arguments)}},9417:(i,o,a)=>{var s=a(5746),c=a(953),l=Function.prototype,u=s&&Object.getOwnPropertyDescriptor,d=c(l,"name"),h=d&&(function(){}).name==="something",p=d&&(!s||s&&u(l,"name").configurable);i.exports={EXISTS:d,PROPER:h,CONFIGURABLE:p}},4163:(i,o,a)=>{var s=a(8285),c=Function.prototype,l=c.call,u=s&&c.bind.bind(l,l);i.exports=s?u:function(d){return function(){return l.apply(d,arguments)}}},5329:(i,o,a)=>{var s=a(2532),c=a(4163);i.exports=function(l){if(s(l)==="Function")return c(l)}},626:(i,o,a)=>{var s=a(4058),c=a(1899),l=a(7475),u=function(d){return l(d)?d:void 0};i.exports=function(d,h){return arguments.length<2?u(s[d])||u(c[d]):s[d]&&s[d][h]||c[d]&&c[d][h]}},2902:(i,o,a)=>{var s=a(9697),c=a(4229),l=a(2119),u=a(2077),d=a(9813)("iterator");i.exports=function(h){if(!l(h))return c(h,d)||c(h,"@@iterator")||u[s(h)]}},3476:(i,o,a)=>{var s=a(8834),c=a(4883),l=a(6059),u=a(9826),d=a(2902),h=TypeError;i.exports=function(p,m){var f=arguments.length<2?d(p):m;if(c(f))return l(s(f,p));throw h(u(p)+" is not iterable")}},4229:(i,o,a)=>{var s=a(4883),c=a(2119);i.exports=function(l,u){var d=l[u];return c(d)?void 0:s(d)}},1899:(i,o,a)=>{var s=function(c){return c&&c.Math==Math&&c};i.exports=s(typeof globalThis=="object"&&globalThis)||s(typeof window=="object"&&window)||s(typeof self=="object"&&self)||s(typeof a.g=="object"&&a.g)||function(){return this}()||Function("return this")()},953:(i,o,a)=>{var s=a(5329),c=a(9678),l=s({}.hasOwnProperty);i.exports=Object.hasOwn||function(u,d){return l(c(u),d)}},7748:i=>{i.exports={}},4845:(i,o,a)=>{var s=a(1899);i.exports=function(c,l){var u=s.console;u&&u.error&&(arguments.length==1?u.error(c):u.error(c,l))}},5463:(i,o,a)=>{var s=a(626);i.exports=s("document","documentElement")},2840:(i,o,a)=>{var s=a(5746),c=a(5981),l=a(1333);i.exports=!s&&!c(function(){return Object.defineProperty(l("div"),"a",{get:function(){return 7}}).a!=7})},7026:(i,o,a)=>{var s=a(5329),c=a(5981),l=a(2532),u=Object,d=s("".split);i.exports=c(function(){return!u("z").propertyIsEnumerable(0)})?function(h){return l(h)=="String"?d(h,""):u(h)}:u},1302:(i,o,a)=>{var s=a(5329),c=a(7475),l=a(3030),u=s(Function.toString);c(l.inspectSource)||(l.inspectSource=function(d){return u(d)}),i.exports=l.inspectSource},3794:(i,o,a)=>{var s=a(941),c=a(2029);i.exports=function(l,u){s(u)&&"cause"in u&&c(l,"cause",u.cause)}},5402:(i,o,a)=>{var s,c,l,u=a(7093),d=a(1899),h=a(941),p=a(2029),m=a(953),f=a(3030),_=a(4262),E=a(7748),g="Object already initialized",T=d.TypeError,R=d.WeakMap;if(u||f.state){var w=f.state||(f.state=new R);w.get=w.get,w.has=w.has,w.set=w.set,s=function(N,P){if(w.has(N))throw T(g);return P.facade=N,w.set(N,P),P},c=function(N){return w.get(N)||{}},l=function(N){return w.has(N)}}else{var A=_("state");E[A]=!0,s=function(N,P){if(m(N,A))throw T(g);return P.facade=N,p(N,A,P),P},c=function(N){return m(N,A)?N[A]:{}},l=function(N){return m(N,A)}}i.exports={set:s,get:c,has:l,enforce:function(N){return l(N)?c(N):s(N,{})},getterFor:function(N){return function(P){var x;if(!h(P)||(x=c(P)).type!==N)throw T("Incompatible receiver, "+N+" required");return x}}}},6782:(i,o,a)=>{var s=a(9813),c=a(2077),l=s("iterator"),u=Array.prototype;i.exports=function(d){return d!==void 0&&(c.Array===d||u[l]===d)}},7475:(i,o,a)=>{var s=a(6616),c=s.all;i.exports=s.IS_HTMLDDA?function(l){return typeof l=="function"||l===c}:function(l){return typeof l=="function"}},4284:(i,o,a)=>{var s=a(5329),c=a(5981),l=a(7475),u=a(9697),d=a(626),h=a(1302),p=function(){},m=[],f=d("Reflect","construct"),_=/^\s*(?:class|function)\b/,E=s(_.exec),g=!_.exec(p),T=function(w){if(!l(w))return!1;try{return f(p,m,w),!0}catch{return!1}},R=function(w){if(!l(w))return!1;switch(u(w)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return g||!!E(_,h(w))}catch{return!0}};R.sham=!0,i.exports=!f||c(function(){var w;return T(T.call)||!T(Object)||!T(function(){w=!0})||w})?R:T},7252:(i,o,a)=>{var s=a(5981),c=a(7475),l=/#|\.prototype\./,u=function(f,_){var E=h[d(f)];return E==m||E!=p&&(c(_)?s(_):!!_)},d=u.normalize=function(f){return String(f).replace(l,".").toLowerCase()},h=u.data={},p=u.NATIVE="N",m=u.POLYFILL="P";i.exports=u},2119:i=>{i.exports=function(o){return o==null}},941:(i,o,a)=>{var s=a(7475),c=a(6616),l=c.all;i.exports=c.IS_HTMLDDA?function(u){return typeof u=="object"?u!==null:s(u)||u===l}:function(u){return typeof u=="object"?u!==null:s(u)}},2529:i=>{i.exports=!0},6664:(i,o,a)=>{var s=a(626),c=a(7475),l=a(7046),u=a(2302),d=Object;i.exports=u?function(h){return typeof h=="symbol"}:function(h){var p=s("Symbol");return c(p)&&l(p.prototype,d(h))}},3091:(i,o,a)=>{var s=a(6843),c=a(8834),l=a(6059),u=a(9826),d=a(6782),h=a(623),p=a(7046),m=a(3476),f=a(2902),_=a(7609),E=TypeError,g=function(R,w){this.stopped=R,this.result=w},T=g.prototype;i.exports=function(R,w,A){var N,P,x,G,ne,z,k,F=A&&A.that,K=!(!A||!A.AS_ENTRIES),oe=!(!A||!A.IS_RECORD),U=!(!A||!A.IS_ITERATOR),D=!(!A||!A.INTERRUPTED),W=s(w,F),L=function(I){return N&&_(N,"normal",I),new g(!0,I)},S=function(I){return K?(l(I),D?W(I[0],I[1],L):W(I[0],I[1])):D?W(I,L):W(I)};if(oe)N=R.iterator;else if(U)N=R;else{if(!(P=f(R)))throw E(u(R)+" is not iterable");if(d(P)){for(x=0,G=h(R);G>x;x++)if((ne=S(R[x]))&&p(T,ne))return ne;return new g(!1)}N=m(R,P)}for(z=oe?R.next:N.next;!(k=c(z,N)).done;){try{ne=S(k.value)}catch(I){_(N,"throw",I)}if(typeof ne=="object"&&ne&&p(T,ne))return ne}return new g(!1)}},7609:(i,o,a)=>{var s=a(8834),c=a(6059),l=a(4229);i.exports=function(u,d,h){var p,m;c(u);try{if(!(p=l(u,"return"))){if(d==="throw")throw h;return h}p=s(p,u)}catch(f){m=!0,p=f}if(d==="throw")throw h;if(m)throw p;return c(p),h}},3847:(i,o,a)=>{var s=a(5143).IteratorPrototype,c=a(9290),l=a(1887),u=a(904),d=a(2077),h=function(){return this};i.exports=function(p,m,f,_){var E=m+" Iterator";return p.prototype=c(s,{next:l(+!_,f)}),u(p,E,!1,!0),d[E]=h,p}},5105:(i,o,a)=>{var s=a(6887),c=a(8834),l=a(2529),u=a(9417),d=a(7475),h=a(3847),p=a(249),m=a(8929),f=a(904),_=a(2029),E=a(5929),g=a(9813),T=a(2077),R=a(5143),w=u.PROPER,A=u.CONFIGURABLE,N=R.IteratorPrototype,P=R.BUGGY_SAFARI_ITERATORS,x=g("iterator"),G="keys",ne="values",z="entries",k=function(){return this};i.exports=function(F,K,oe,U,D,W,L){h(oe,K,U);var S,I,O,B=function(Nr){if(Nr===D&&yt)return yt;if(!P&&Nr in ve)return ve[Nr];switch(Nr){case G:case ne:case z:return function(){return new oe(this,Nr)}}return function(){return new oe(this)}},se=K+" Iterator",ge=!1,ve=F.prototype,ut=ve[x]||ve["@@iterator"]||D&&ve[D],yt=!P&&ut||B(D),Zn=K=="Array"&&ve.entries||ut;if(Zn&&(S=p(Zn.call(new F)))!==Object.prototype&&S.next&&(l||p(S)===N||(m?m(S,N):d(S[x])||E(S,x,k)),f(S,se,!0,!0),l&&(T[se]=k)),w&&D==ne&&ut&&ut.name!==ne&&(!l&&A?_(ve,"name",ne):(ge=!0,yt=function(){return c(ut,this)})),D)if(I={values:B(ne),keys:W?yt:B(G),entries:B(z)},L)for(O in I)(P||ge||!(O in ve))&&E(ve,O,I[O]);else s({target:K,proto:!0,forced:P||ge},I);return l&&!L||ve[x]===yt||E(ve,x,yt,{name:D}),T[K]=yt,I}},5143:(i,o,a)=>{var s,c,l,u=a(5981),d=a(7475),h=a(941),p=a(9290),m=a(249),f=a(5929),_=a(9813),E=a(2529),g=_("iterator"),T=!1;[].keys&&("next"in(l=[].keys())?(c=m(m(l)))!==Object.prototype&&(s=c):T=!0),!h(s)||u(function(){var R={};return s[g].call(R)!==R})?s={}:E&&(s=p(s)),d(s[g])||f(s,g,function(){return this}),i.exports={IteratorPrototype:s,BUGGY_SAFARI_ITERATORS:T}},2077:i=>{i.exports={}},623:(i,o,a)=>{var s=a(3057);i.exports=function(c){return s(c.length)}},5331:i=>{var o=Math.ceil,a=Math.floor;i.exports=Math.trunc||function(s){var c=+s;return(c>0?a:o)(c)}},6132:(i,o,a)=>{var s,c,l,u,d,h,p,m,f=a(1899),_=a(6843),E=a(9677).f,g=a(2941).set,T=a(2749),R=a(4470),w=a(8045),A=a(6049),N=f.MutationObserver||f.WebKitMutationObserver,P=f.document,x=f.process,G=f.Promise,ne=E(f,"queueMicrotask"),z=ne&&ne.value;z||(s=function(){var k,F;for(A&&(k=x.domain)&&k.exit();c;){F=c.fn,c=c.next;try{F()}catch(K){throw c?u():l=void 0,K}}l=void 0,k&&k.enter()},T||A||w||!N||!P?!R&&G&&G.resolve?((p=G.resolve(void 0)).constructor=G,m=_(p.then,p),u=function(){m(s)}):A?u=function(){x.nextTick(s)}:(g=_(g,f),u=function(){g(s)}):(d=!0,h=P.createTextNode(""),new N(s).observe(h,{characterData:!0}),u=function(){h.data=d=!d})),i.exports=z||function(k){var F={fn:k,next:void 0};l&&(l.next=F),c||(c=F,u()),l=F}},9520:(i,o,a)=>{var s=a(4883),c=TypeError,l=function(u){var d,h;this.promise=new u(function(p,m){if(d!==void 0||h!==void 0)throw c("Bad Promise constructor");d=p,h=m}),this.resolve=s(d),this.reject=s(h)};i.exports.f=function(u){return new l(u)}},4649:(i,o,a)=>{var s=a(5803);i.exports=function(c,l){return c===void 0?arguments.length<2?"":l:s(c)}},9290:(i,o,a)=>{var s,c=a(6059),l=a(9938),u=a(6759),d=a(7748),h=a(5463),p=a(1333),m=a(4262)("IE_PROTO"),f=function(){},_=function(T){return"<script>"+T+"<\/script>"},E=function(T){T.write(_("")),T.close();var R=T.parentWindow.Object;return T=null,R},g=function(){try{s=new ActiveXObject("htmlfile")}catch{}var T,R;g=typeof document<"u"?document.domain&&s?E(s):((R=p("iframe")).style.display="none",h.appendChild(R),R.src="javascript:",(T=R.contentWindow.document).open(),T.write(_("document.F=Object")),T.close(),T.F):E(s);for(var w=u.length;w--;)delete g.prototype[u[w]];return g()};d[m]=!0,i.exports=Object.create||function(T,R){var w;return T!==null?(f.prototype=c(T),w=new f,f.prototype=null,w[m]=T):w=g(),R===void 0?w:l.f(w,R)}},9938:(i,o,a)=>{var s=a(5746),c=a(3937),l=a(5988),u=a(6059),d=a(4529),h=a(4771);o.f=s&&!c?Object.defineProperties:function(p,m){u(p);for(var f,_=d(m),E=h(m),g=E.length,T=0;g>T;)l.f(p,f=E[T++],_[f]);return p}},5988:(i,o,a)=>{var s=a(5746),c=a(2840),l=a(3937),u=a(6059),d=a(3894),h=TypeError,p=Object.defineProperty,m=Object.getOwnPropertyDescriptor;o.f=s?l?function(f,_,E){if(u(f),_=d(_),u(E),typeof f=="function"&&_==="prototype"&&"value"in E&&"writable"in E&&!E.writable){var g=m(f,_);g&&g.writable&&(f[_]=E.value,E={configurable:"configurable"in E?E.configurable:g.configurable,enumerable:"enumerable"in E?E.enumerable:g.enumerable,writable:!1})}return p(f,_,E)}:p:function(f,_,E){if(u(f),_=d(_),u(E),c)try{return p(f,_,E)}catch{}if("get"in E||"set"in E)throw h("Accessors not supported");return"value"in E&&(f[_]=E.value),f}},9677:(i,o,a)=>{var s=a(5746),c=a(8834),l=a(6760),u=a(1887),d=a(4529),h=a(3894),p=a(953),m=a(2840),f=Object.getOwnPropertyDescriptor;o.f=s?f:function(_,E){if(_=d(_),E=h(E),m)try{return f(_,E)}catch{}if(p(_,E))return u(!c(l.f,_,E),_[E])}},946:(i,o,a)=>{var s=a(5629),c=a(6759).concat("length","prototype");o.f=Object.getOwnPropertyNames||function(l){return s(l,c)}},7857:(i,o)=>{o.f=Object.getOwnPropertySymbols},249:(i,o,a)=>{var s=a(953),c=a(7475),l=a(9678),u=a(4262),d=a(4160),h=u("IE_PROTO"),p=Object,m=p.prototype;i.exports=d?p.getPrototypeOf:function(f){var _=l(f);if(s(_,h))return _[h];var E=_.constructor;return c(E)&&_ instanceof E?E.prototype:_ instanceof p?m:null}},7046:(i,o,a)=>{var s=a(5329);i.exports=s({}.isPrototypeOf)},5629:(i,o,a)=>{var s=a(5329),c=a(953),l=a(4529),u=a(1692).indexOf,d=a(7748),h=s([].push);i.exports=function(p,m){var f,_=l(p),E=0,g=[];for(f in _)!c(d,f)&&c(_,f)&&h(g,f);for(;m.length>E;)c(_,f=m[E++])&&(~u(g,f)||h(g,f));return g}},4771:(i,o,a)=>{var s=a(5629),c=a(6759);i.exports=Object.keys||function(l){return s(l,c)}},6760:(i,o)=>{var a={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,c=s&&!a.call({1:2},1);o.f=c?function(l){var u=s(this,l);return!!u&&u.enumerable}:a},8929:(i,o,a)=>{var s=a(5329),c=a(6059),l=a(1851);i.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var u,d=!1,h={};try{(u=s(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(h,[]),d=h instanceof Array}catch{}return function(p,m){return c(p),l(m),d?u(p,m):p.__proto__=m,p}}():void 0)},5623:(i,o,a)=>{var s=a(2885),c=a(9697);i.exports=s?{}.toString:function(){return"[object "+c(this)+"]"}},9811:(i,o,a)=>{var s=a(8834),c=a(7475),l=a(941),u=TypeError;i.exports=function(d,h){var p,m;if(h==="string"&&c(p=d.toString)&&!l(m=s(p,d))||c(p=d.valueOf)&&!l(m=s(p,d))||h!=="string"&&c(p=d.toString)&&!l(m=s(p,d)))return m;throw u("Can't convert object to primitive value")}},1136:(i,o,a)=>{var s=a(626),c=a(5329),l=a(946),u=a(7857),d=a(6059),h=c([].concat);i.exports=s("Reflect","ownKeys")||function(p){var m=l.f(d(p)),f=u.f;return f?h(m,f(p)):m}},4058:i=>{i.exports={}},2:i=>{i.exports=function(o){try{return{error:!1,value:o()}}catch(a){return{error:!0,value:a}}}},7742:(i,o,a)=>{var s=a(1899),c=a(6991),l=a(7475),u=a(7252),d=a(1302),h=a(9813),p=a(3321),m=a(8501),f=a(2529),_=a(3385),E=c&&c.prototype,g=h("species"),T=!1,R=l(s.PromiseRejectionEvent),w=u("Promise",function(){var A=d(c),N=A!==String(c);if(!N&&_===66||f&&(!E.catch||!E.finally))return!0;if(!_||_<51||!/native code/.test(A)){var P=new c(function(G){G(1)}),x=function(G){G(function(){},function(){})};if((P.constructor={})[g]=x,!(T=P.then(function(){})instanceof x))return!0}return!N&&(p||m)&&!R});i.exports={CONSTRUCTOR:w,REJECTION_EVENT:R,SUBCLASSING:T}},6991:(i,o,a)=>{var s=a(1899);i.exports=s.Promise},6584:(i,o,a)=>{var s=a(6059),c=a(941),l=a(9520);i.exports=function(u,d){if(s(u),c(d)&&d.constructor===u)return d;var h=l.f(u);return(0,h.resolve)(d),h.promise}},1542:(i,o,a)=>{var s=a(6991),c=a(1385),l=a(7742).CONSTRUCTOR;i.exports=l||!c(function(u){s.all(u).then(void 0,function(){})})},8397:i=>{var o=function(){this.head=null,this.tail=null};o.prototype={add:function(a){var s={item:a,next:null};this.head?this.tail.next=s:this.head=s,this.tail=s},get:function(){var a=this.head;if(a)return this.head=a.next,this.tail===a&&(this.tail=null),a.item}},i.exports=o},8219:(i,o,a)=>{var s=a(2119),c=TypeError;i.exports=function(l){if(s(l))throw c("Can't call method on "+l);return l}},4431:(i,o,a)=>{var s=a(626),c=a(5988),l=a(9813),u=a(5746),d=l("species");i.exports=function(h){var p=s(h),m=c.f;u&&p&&!p[d]&&m(p,d,{configurable:!0,get:function(){return this}})}},904:(i,o,a)=>{var s=a(2885),c=a(5988).f,l=a(2029),u=a(953),d=a(5623),h=a(9813)("toStringTag");i.exports=function(p,m,f,_){if(p){var E=f?p:p.prototype;u(E,h)||c(E,h,{configurable:!0,value:m}),_&&!s&&l(E,"toString",d)}}},4262:(i,o,a)=>{var s=a(8726),c=a(9418),l=s("keys");i.exports=function(u){return l[u]||(l[u]=c(u))}},3030:(i,o,a)=>{var s=a(1899),c=a(5609),l="__core-js_shared__",u=s[l]||c(l,{});i.exports=u},8726:(i,o,a)=>{var s=a(2529),c=a(3030);(i.exports=function(l,u){return c[l]||(c[l]=u!==void 0?u:{})})("versions",[]).push({version:"3.26.0",mode:s?"pure":"global",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})},487:(i,o,a)=>{var s=a(6059),c=a(174),l=a(2119),u=a(9813)("species");i.exports=function(d,h){var p,m=s(d).constructor;return m===void 0||l(p=s(m)[u])?h:c(p)}},4620:(i,o,a)=>{var s=a(5329),c=a(2435),l=a(5803),u=a(8219),d=s("".charAt),h=s("".charCodeAt),p=s("".slice),m=function(f){return function(_,E){var g,T,R=l(u(_)),w=c(E),A=R.length;return w<0||w>=A?f?"":void 0:(g=h(R,w))<55296||g>56319||w+1===A||(T=h(R,w+1))<56320||T>57343?f?d(R,w):g:f?p(R,w,w+2):T-56320+(g-55296<<10)+65536}};i.exports={codeAt:m(!1),charAt:m(!0)}},3405:(i,o,a)=>{var s=a(3385),c=a(5981);i.exports=!!Object.getOwnPropertySymbols&&!c(function(){var l=Symbol();return!String(l)||!(Object(l)instanceof Symbol)||!Symbol.sham&&s&&s<41})},2941:(i,o,a)=>{var s,c,l,u,d=a(1899),h=a(9730),p=a(6843),m=a(7475),f=a(953),_=a(5981),E=a(5463),g=a(3765),T=a(1333),R=a(8348),w=a(2749),A=a(6049),N=d.setImmediate,P=d.clearImmediate,x=d.process,G=d.Dispatch,ne=d.Function,z=d.MessageChannel,k=d.String,F=0,K={};try{s=d.location}catch{}var oe=function(L){if(f(K,L)){var S=K[L];delete K[L],S()}},U=function(L){return function(){oe(L)}},D=function(L){oe(L.data)},W=function(L){d.postMessage(k(L),s.protocol+"//"+s.host)};N&&P||(N=function(L){R(arguments.length,1);var S=m(L)?L:ne(L),I=g(arguments,1);return K[++F]=function(){h(S,void 0,I)},c(F),F},P=function(L){delete K[L]},A?c=function(L){x.nextTick(U(L))}:G&&G.now?c=function(L){G.now(U(L))}:z&&!w?(u=(l=new z).port2,l.port1.onmessage=D,c=p(u.postMessage,u)):d.addEventListener&&m(d.postMessage)&&!d.importScripts&&s&&s.protocol!=="file:"&&!_(W)?(c=W,d.addEventListener("message",D,!1)):c="onreadystatechange"in T("script")?function(L){E.appendChild(T("script")).onreadystatechange=function(){E.removeChild(this),oe(L)}}:function(L){setTimeout(U(L),0)}),i.exports={set:N,clear:P}},9413:(i,o,a)=>{var s=a(2435),c=Math.max,l=Math.min;i.exports=function(u,d){var h=s(u);return h<0?c(h+d,0):l(h,d)}},4529:(i,o,a)=>{var s=a(7026),c=a(8219);i.exports=function(l){return s(c(l))}},2435:(i,o,a)=>{var s=a(5331);i.exports=function(c){var l=+c;return l!=l||l===0?0:s(l)}},3057:(i,o,a)=>{var s=a(2435),c=Math.min;i.exports=function(l){return l>0?c(s(l),9007199254740991):0}},9678:(i,o,a)=>{var s=a(8219),c=Object;i.exports=function(l){return c(s(l))}},6935:(i,o,a)=>{var s=a(8834),c=a(941),l=a(6664),u=a(4229),d=a(9811),h=a(9813),p=TypeError,m=h("toPrimitive");i.exports=function(f,_){if(!c(f)||l(f))return f;var E,g=u(f,m);if(g){if(_===void 0&&(_="default"),E=s(g,f,_),!c(E)||l(E))return E;throw p("Can't convert object to primitive value")}return _===void 0&&(_="number"),d(f,_)}},3894:(i,o,a)=>{var s=a(6935),c=a(6664);i.exports=function(l){var u=s(l,"string");return c(u)?u:u+""}},2885:(i,o,a)=>{var s={};s[a(9813)("toStringTag")]="z",i.exports=String(s)==="[object z]"},5803:(i,o,a)=>{var s=a(9697),c=String;i.exports=function(l){if(s(l)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return c(l)}},9826:i=>{var o=String;i.exports=function(a){try{return o(a)}catch{return"Object"}}},9418:(i,o,a)=>{var s=a(5329),c=0,l=Math.random(),u=s(1 .toString);i.exports=function(d){return"Symbol("+(d===void 0?"":d)+")_"+u(++c+l,36)}},2302:(i,o,a)=>{var s=a(3405);i.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},3937:(i,o,a)=>{var s=a(5746),c=a(5981);i.exports=s&&c(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},8348:i=>{var o=TypeError;i.exports=function(a,s){if(a<s)throw o("Not enough arguments");return a}},7093:(i,o,a)=>{var s=a(1899),c=a(7475),l=s.WeakMap;i.exports=c(l)&&/native code/.test(String(l))},9813:(i,o,a)=>{var s=a(1899),c=a(8726),l=a(953),u=a(9418),d=a(3405),h=a(2302),p=c("wks"),m=s.Symbol,f=m&&m.for,_=h?m:m&&m.withoutSetter||u;i.exports=function(E){if(!l(p,E)||!d&&typeof p[E]!="string"){var g="Symbol."+E;d&&l(m,E)?p[E]=m[E]:p[E]=h&&f?f(g):_(g)}return p[E]}},9812:(i,o,a)=>{var s=a(6887),c=a(7046),l=a(249),u=a(8929),d=a(3489),h=a(9290),p=a(2029),m=a(1887),f=a(3995),_=a(3794),E=a(3091),g=a(4649),T=a(9813),R=a(8780),w=T("toStringTag"),A=Error,N=[].push,P=function(G,ne){var z,k=arguments.length>2?arguments[2]:void 0,F=c(x,this);u?z=u(A(),F?l(this):x):(z=F?this:h(x),p(z,w,"Error")),ne!==void 0&&p(z,"message",g(ne)),R&&p(z,"stack",f(z.stack,1)),_(z,k);var K=[];return E(G,N,{that:K}),p(z,"errors",K),z};u?u(P,A):d(P,A,{name:!0});var x=P.prototype=h(A.prototype,{constructor:m(1,P),message:m(1,""),name:m(1,"AggregateError")});s({global:!0,constructor:!0,arity:2},{AggregateError:P})},7627:(i,o,a)=>{a(9812)},6274:(i,o,a)=>{var s=a(4529),c=a(8479),l=a(2077),u=a(5402),d=a(5988).f,h=a(5105),p=a(3538),m=a(2529),f=a(5746),_="Array Iterator",E=u.set,g=u.getterFor(_);i.exports=h(Array,"Array",function(R,w){E(this,{type:_,target:s(R),index:0,kind:w})},function(){var R=g(this),w=R.target,A=R.kind,N=R.index++;return!w||N>=w.length?(R.target=void 0,p(void 0,!0)):p(A=="keys"?N:A=="values"?w[N]:[N,w[N]],!1)},"values");var T=l.Arguments=l.Array;if(c("keys"),c("values"),c("entries"),!m&&f&&T.name!=="values")try{d(T,"name",{value:"values"})}catch{}},6450:(i,o,a)=>{var s=a(6887),c=a(5746),l=a(5988).f;s({target:"Object",stat:!0,forced:Object.defineProperty!==l,sham:!c},{defineProperty:l})},5967:()=>{},4560:(i,o,a)=>{var s=a(6887),c=a(8834),l=a(4883),u=a(9520),d=a(2),h=a(3091);s({target:"Promise",stat:!0},{allSettled:function(p){var m=this,f=u.f(m),_=f.resolve,E=f.reject,g=d(function(){var T=l(m.resolve),R=[],w=0,A=1;h(p,function(N){var P=w++,x=!1;A++,c(T,m,N).then(function(G){x||(x=!0,R[P]={status:"fulfilled",value:G},--A||_(R))},function(G){x||(x=!0,R[P]={status:"rejected",reason:G},--A||_(R))})}),--A||_(R)});return g.error&&E(g.value),f.promise}})},6890:(i,o,a)=>{var s=a(6887),c=a(8834),l=a(4883),u=a(9520),d=a(2),h=a(3091);s({target:"Promise",stat:!0,forced:a(1542)},{all:function(p){var m=this,f=u.f(m),_=f.resolve,E=f.reject,g=d(function(){var T=l(m.resolve),R=[],w=0,A=1;h(p,function(N){var P=w++,x=!1;A++,c(T,m,N).then(function(G){x||(x=!0,R[P]=G,--A||_(R))},E)}),--A||_(R)});return g.error&&E(g.value),f.promise}})},7206:(i,o,a)=>{var s=a(6887),c=a(8834),l=a(4883),u=a(626),d=a(9520),h=a(2),p=a(3091),m="No one promise resolved";s({target:"Promise",stat:!0},{any:function(f){var _=this,E=u("AggregateError"),g=d.f(_),T=g.resolve,R=g.reject,w=h(function(){var A=l(_.resolve),N=[],P=0,x=1,G=!1;p(f,function(ne){var z=P++,k=!1;x++,c(A,_,ne).then(function(F){k||G||(G=!0,T(F))},function(F){k||G||(k=!0,N[z]=F,--x||R(new E(N,m)))})}),--x||R(new E(N,m))});return w.error&&R(w.value),g.promise}})},3376:(i,o,a)=>{var s=a(6887),c=a(2529),l=a(7742).CONSTRUCTOR,u=a(6991),d=a(626),h=a(7475),p=a(5929),m=u&&u.prototype;if(s({target:"Promise",proto:!0,forced:l,real:!0},{catch:function(_){return this.then(void 0,_)}}),!c&&h(u)){var f=d("Promise").prototype.catch;m.catch!==f&&p(m,"catch",f,{unsafe:!0})}},6934:(i,o,a)=>{var s,c,l,u=a(6887),d=a(2529),h=a(6049),p=a(1899),m=a(8834),f=a(5929),_=a(8929),E=a(904),g=a(4431),T=a(4883),R=a(7475),w=a(941),A=a(5743),N=a(487),P=a(2941).set,x=a(6132),G=a(4845),ne=a(2),z=a(8397),k=a(5402),F=a(6991),K=a(7742),oe=a(9520),U="Promise",D=K.CONSTRUCTOR,W=K.REJECTION_EVENT,L=K.SUBCLASSING,S=k.getterFor(U),I=k.set,O=F&&F.prototype,B=F,se=O,ge=p.TypeError,ve=p.document,ut=p.process,yt=oe.f,Zn=yt,Nr=!!(ve&&ve.createEvent&&p.dispatchEvent),qr="unhandledrejection",Oi=function(ue){var Ie;return!(!w(ue)||!R(Ie=ue.then))&&Ie},No=function(ue,Ie){var Qe,Ot,Ln,tu=Ie.value,eC=Ie.state==1,A_=eC?ue.ok:ue.fail,tC=ue.resolve,Ah=ue.reject,ac=ue.domain;try{A_?(eC||(Ie.rejection===2&&ei(Ie),Ie.rejection=1),A_===!0?Qe=tu:(ac&&ac.enter(),Qe=A_(tu),ac&&(ac.exit(),Ln=!0)),Qe===ue.promise?Ah(ge("Promise-chain cycle")):(Ot=Oi(Qe))?m(Ot,Qe,tC,Ah):tC(Qe)):Ah(tu)}catch(zF){ac&&!Ln&&ac.exit(),Ah(zF)}},ot=function(ue,Ie){ue.notified||(ue.notified=!0,x(function(){for(var Qe,Ot=ue.reactions;Qe=Ot.get();)No(Qe,ue);ue.notified=!1,Ie&&!ue.rejection&&Ye(ue)}))},mt=function(ue,Ie,Qe){var Ot,Ln;Nr?((Ot=ve.createEvent("Event")).promise=Ie,Ot.reason=Qe,Ot.initEvent(ue,!1,!0),p.dispatchEvent(Ot)):Ot={promise:Ie,reason:Qe},!W&&(Ln=p["on"+ue])?Ln(Ot):ue===qr&&G("Unhandled promise rejection",Qe)},Ye=function(ue){m(P,p,function(){var Ie,Qe=ue.facade,Ot=ue.value;if(Pr(ue)&&(Ie=ne(function(){h?ut.emit("unhandledRejection",Ot,Qe):mt(qr,Qe,Ot)}),ue.rejection=h||Pr(ue)?2:1,Ie.error))throw Ie.value})},Pr=function(ue){return ue.rejection!==1&&!ue.parent},ei=function(ue){m(P,p,function(){var Ie=ue.facade;h?ut.emit("rejectionHandled",Ie):mt("rejectionhandled",Ie,ue.value)})},qe=function(ue,Ie,Qe){return function(Ot){ue(Ie,Ot,Qe)}},Re=function(ue,Ie,Qe){ue.done||(ue.done=!0,Qe&&(ue=Qe),ue.value=Ie,ue.state=2,ot(ue,!0))},gr=function(ue,Ie,Qe){if(!ue.done){ue.done=!0,Qe&&(ue=Qe);try{if(ue.facade===Ie)throw ge("Promise can't be resolved itself");var Ot=Oi(Ie);Ot?x(function(){var Ln={done:!1};try{m(Ot,Ie,qe(gr,Ln,ue),qe(Re,Ln,ue))}catch(tu){Re(Ln,tu,ue)}}):(ue.value=Ie,ue.state=1,ot(ue,!1))}catch(Ln){Re({done:!1},Ln,ue)}}};if(D&&(se=(B=function(ue){A(this,se),T(ue),m(s,this);var Ie=S(this);try{ue(qe(gr,Ie),qe(Re,Ie))}catch(Qe){Re(Ie,Qe)}}).prototype,(s=function(ue){I(this,{type:U,done:!1,notified:!1,parent:!1,reactions:new z,rejection:!1,state:0,value:void 0})}).prototype=f(se,"then",function(ue,Ie){var Qe=S(this),Ot=yt(N(this,B));return Qe.parent=!0,Ot.ok=!R(ue)||ue,Ot.fail=R(Ie)&&Ie,Ot.domain=h?ut.domain:void 0,Qe.state==0?Qe.reactions.add(Ot):x(function(){No(Ot,Qe)}),Ot.promise}),c=function(){var ue=new s,Ie=S(ue);this.promise=ue,this.resolve=qe(gr,Ie),this.reject=qe(Re,Ie)},oe.f=yt=function(ue){return ue===B||ue===void 0?new c(ue):Zn(ue)},!d&&R(F)&&O!==Object.prototype)){l=O.then,L||f(O,"then",function(ue,Ie){var Qe=this;return new B(function(Ot,Ln){m(l,Qe,Ot,Ln)}).then(ue,Ie)},{unsafe:!0});try{delete O.constructor}catch{}_&&_(O,se)}u({global:!0,constructor:!0,wrap:!0,forced:D},{Promise:B}),E(B,U,!1,!0),g(U)},4349:(i,o,a)=>{var s=a(6887),c=a(2529),l=a(6991),u=a(5981),d=a(626),h=a(7475),p=a(487),m=a(6584),f=a(5929),_=l&&l.prototype;if(s({target:"Promise",proto:!0,real:!0,forced:!!l&&u(function(){_.finally.call({then:function(){}},function(){})})},{finally:function(g){var T=p(this,d("Promise")),R=h(g);return this.then(R?function(w){return m(T,g()).then(function(){return w})}:g,R?function(w){return m(T,g()).then(function(){throw w})}:g)}}),!c&&h(l)){var E=d("Promise").prototype.finally;_.finally!==E&&f(_,"finally",E,{unsafe:!0})}},8881:(i,o,a)=>{a(6934),a(6890),a(3376),a(5921),a(4069),a(4482)},5921:(i,o,a)=>{var s=a(6887),c=a(8834),l=a(4883),u=a(9520),d=a(2),h=a(3091);s({target:"Promise",stat:!0,forced:a(1542)},{race:function(p){var m=this,f=u.f(m),_=f.reject,E=d(function(){var g=l(m.resolve);h(p,function(T){c(g,m,T).then(f.resolve,_)})});return E.error&&_(E.value),f.promise}})},4069:(i,o,a)=>{var s=a(6887),c=a(8834),l=a(9520);s({target:"Promise",stat:!0,forced:a(7742).CONSTRUCTOR},{reject:function(u){var d=l.f(this);return c(d.reject,void 0,u),d.promise}})},4482:(i,o,a)=>{var s=a(6887),c=a(626),l=a(2529),u=a(6991),d=a(7742).CONSTRUCTOR,h=a(6584),p=c("Promise"),m=l&&!d;s({target:"Promise",stat:!0,forced:l||d},{resolve:function(f){return h(m&&this===p?u:this,f)}})},7971:(i,o,a)=>{var s=a(4620).charAt,c=a(5803),l=a(5402),u=a(5105),d=a(3538),h="String Iterator",p=l.set,m=l.getterFor(h);u(String,"String",function(f){p(this,{type:h,string:c(f),index:0})},function(){var f,_=m(this),E=_.string,g=_.index;return g>=E.length?d(void 0,!0):(f=s(E,g),_.index+=f.length,d(f,!1))})},7634:(i,o,a)=>{a(6274);var s=a(3281),c=a(1899),l=a(9697),u=a(2029),d=a(2077),h=a(9813)("toStringTag");for(var p in s){var m=c[p],f=m&&m.prototype;f&&l(f)!==h&&u(f,h,p),d[p]=d.Array}},1910:(i,o,a)=>{var s=a(8171);i.exports=s},7460:(i,o,a)=>{var s=a(2956);a(7634),i.exports=s},9662:(i,o,a)=>{var s=a(614),c=a(6330),l=TypeError;i.exports=function(u){if(s(u))return u;throw l(c(u)+" is not a function")}},6077:(i,o,a)=>{var s=a(614),c=String,l=TypeError;i.exports=function(u){if(typeof u=="object"||s(u))return u;throw l("Can't set "+c(u)+" as a prototype")}},1223:(i,o,a)=>{var s=a(5112),c=a(30),l=a(3070).f,u=s("unscopables"),d=Array.prototype;d[u]==null&&l(d,u,{configurable:!0,value:c(null)}),i.exports=function(h){d[u][h]=!0}},9670:(i,o,a)=>{var s=a(111),c=String,l=TypeError;i.exports=function(u){if(s(u))return u;throw l(c(u)+" is not an object")}},1318:(i,o,a)=>{var s=a(5656),c=a(1400),l=a(6244),u=function(d){return function(h,p,m){var f,_=s(h),E=l(_),g=c(m,E);if(d&&p!=p){for(;E>g;)if((f=_[g++])!=f)return!0}else for(;E>g;g++)if((d||g in _)&&_[g]===p)return d||g||0;return!d&&-1}};i.exports={includes:u(!0),indexOf:u(!1)}},4326:(i,o,a)=>{var s=a(84),c=s({}.toString),l=s("".slice);i.exports=function(u){return l(c(u),8,-1)}},648:(i,o,a)=>{var s=a(1694),c=a(614),l=a(4326),u=a(5112)("toStringTag"),d=Object,h=l(function(){return arguments}())=="Arguments";i.exports=s?l:function(p){var m,f,_;return p===void 0?"Undefined":p===null?"Null":typeof(f=function(E,g){try{return E[g]}catch{}}(m=d(p),u))=="string"?f:h?l(m):(_=l(m))=="Object"&&c(m.callee)?"Arguments":_}},9920:(i,o,a)=>{var s=a(2597),c=a(3887),l=a(1236),u=a(3070);i.exports=function(d,h,p){for(var m=c(h),f=u.f,_=l.f,E=0;E<m.length;E++){var g=m[E];s(d,g)||p&&s(p,g)||f(d,g,_(h,g))}}},8544:(i,o,a)=>{var s=a(7293);i.exports=!s(function(){function c(){}return c.prototype.constructor=null,Object.getPrototypeOf(new c)!==c.prototype})},6178:i=>{i.exports=function(o,a){return{value:o,done:a}}},8880:(i,o,a)=>{var s=a(9781),c=a(3070),l=a(9114);i.exports=s?function(u,d,h){return c.f(u,d,l(1,h))}:function(u,d,h){return u[d]=h,u}},9114:i=>{i.exports=function(o,a){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:a}}},8052:(i,o,a)=>{var s=a(614),c=a(3070),l=a(6339),u=a(3072);i.exports=function(d,h,p,m){m||(m={});var f=m.enumerable,_=m.name!==void 0?m.name:h;if(s(p)&&l(p,_,m),m.global)f?d[h]=p:u(h,p);else{try{m.unsafe?d[h]&&(f=!0):delete d[h]}catch{}f?d[h]=p:c.f(d,h,{value:p,enumerable:!1,configurable:!m.nonConfigurable,writable:!m.nonWritable})}return d}},3072:(i,o,a)=>{var s=a(7854),c=Object.defineProperty;i.exports=function(l,u){try{c(s,l,{value:u,configurable:!0,writable:!0})}catch{s[l]=u}return u}},9781:(i,o,a)=>{var s=a(7293);i.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},4154:i=>{var o=typeof document=="object"&&document.all,a=o===void 0&&o!==void 0;i.exports={all:o,IS_HTMLDDA:a}},317:(i,o,a)=>{var s=a(7854),c=a(111),l=s.document,u=c(l)&&c(l.createElement);i.exports=function(d){return u?l.createElement(d):{}}},8324:i=>{i.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(i,o,a)=>{var s=a(317)("span").classList,c=s&&s.constructor&&s.constructor.prototype;i.exports=c===Object.prototype?void 0:c},8113:(i,o,a)=>{var s=a(5005);i.exports=s("navigator","userAgent")||""},7392:(i,o,a)=>{var s,c,l=a(7854),u=a(8113),d=l.process,h=l.Deno,p=d&&d.versions||h&&h.version,m=p&&p.v8;m&&(c=(s=m.split("."))[0]>0&&s[0]<4?1:+(s[0]+s[1])),!c&&u&&(!(s=u.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=u.match(/Chrome\/(\d+)/))&&(c=+s[1]),i.exports=c},748:i=>{i.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},1060:(i,o,a)=>{var s=a(1702),c=Error,l=s("".replace),u=String(c("zxcasd").stack),d=/\n\s*at [^:]*:[^\n]*/,h=d.test(u);i.exports=function(p,m){if(h&&typeof p=="string"&&!c.prepareStackTrace)for(;m--;)p=l(p,d,"");return p}},2914:(i,o,a)=>{var s=a(7293),c=a(9114);i.exports=!s(function(){var l=Error("a");return!("stack"in l)||(Object.defineProperty(l,"stack",c(1,7)),l.stack!==7)})},2109:(i,o,a)=>{var s=a(7854),c=a(1236).f,l=a(8880),u=a(8052),d=a(3072),h=a(9920),p=a(4705);i.exports=function(m,f){var _,E,g,T,R,w=m.target,A=m.global,N=m.stat;if(_=A?s:N?s[w]||d(w,{}):(s[w]||{}).prototype)for(E in f){if(T=f[E],g=m.dontCallGetSet?(R=c(_,E))&&R.value:_[E],!p(A?E:w+(N?".":"#")+E,m.forced)&&g!==void 0){if(typeof T==typeof g)continue;h(T,g)}(m.sham||g&&g.sham)&&l(T,"sham",!0),u(_,E,T,m)}}},7293:i=>{i.exports=function(o){try{return!!o()}catch{return!0}}},2104:(i,o,a)=>{var s=a(4374),c=Function.prototype,l=c.apply,u=c.call;i.exports=typeof Reflect=="object"&&Reflect.apply||(s?u.bind(l):function(){return u.apply(l,arguments)})},4374:(i,o,a)=>{var s=a(7293);i.exports=!s(function(){var c=(function(){}).bind();return typeof c!="function"||c.hasOwnProperty("prototype")})},6916:(i,o,a)=>{var s=a(4374),c=Function.prototype.call;i.exports=s?c.bind(c):function(){return c.apply(c,arguments)}},6530:(i,o,a)=>{var s=a(9781),c=a(2597),l=Function.prototype,u=s&&Object.getOwnPropertyDescriptor,d=c(l,"name"),h=d&&(function(){}).name==="something",p=d&&(!s||s&&u(l,"name").configurable);i.exports={EXISTS:d,PROPER:h,CONFIGURABLE:p}},84:(i,o,a)=>{var s=a(4374),c=Function.prototype,l=c.call,u=s&&c.bind.bind(l,l);i.exports=s?u:function(d){return function(){return l.apply(d,arguments)}}},1702:(i,o,a)=>{var s=a(4326),c=a(84);i.exports=function(l){if(s(l)==="Function")return c(l)}},5005:(i,o,a)=>{var s=a(7854),c=a(614),l=function(u){return c(u)?u:void 0};i.exports=function(u,d){return arguments.length<2?l(s[u]):s[u]&&s[u][d]}},8173:(i,o,a)=>{var s=a(9662),c=a(8554);i.exports=function(l,u){var d=l[u];return c(d)?void 0:s(d)}},7854:(i,o,a)=>{var s=function(c){return c&&c.Math==Math&&c};i.exports=s(typeof globalThis=="object"&&globalThis)||s(typeof window=="object"&&window)||s(typeof self=="object"&&self)||s(typeof a.g=="object"&&a.g)||function(){return this}()||Function("return this")()},2597:(i,o,a)=>{var s=a(1702),c=a(7908),l=s({}.hasOwnProperty);i.exports=Object.hasOwn||function(u,d){return l(c(u),d)}},3501:i=>{i.exports={}},490:(i,o,a)=>{var s=a(5005);i.exports=s("document","documentElement")},4664:(i,o,a)=>{var s=a(9781),c=a(7293),l=a(317);i.exports=!s&&!c(function(){return Object.defineProperty(l("div"),"a",{get:function(){return 7}}).a!=7})},8361:(i,o,a)=>{var s=a(1702),c=a(7293),l=a(4326),u=Object,d=s("".split);i.exports=c(function(){return!u("z").propertyIsEnumerable(0)})?function(h){return l(h)=="String"?d(h,""):u(h)}:u},9587:(i,o,a)=>{var s=a(614),c=a(111),l=a(7674);i.exports=function(u,d,h){var p,m;return l&&s(p=d.constructor)&&p!==h&&c(m=p.prototype)&&m!==h.prototype&&l(u,m),u}},2788:(i,o,a)=>{var s=a(1702),c=a(614),l=a(5465),u=s(Function.toString);c(l.inspectSource)||(l.inspectSource=function(d){return u(d)}),i.exports=l.inspectSource},8340:(i,o,a)=>{var s=a(111),c=a(8880);i.exports=function(l,u){s(u)&&"cause"in u&&c(l,"cause",u.cause)}},9909:(i,o,a)=>{var s,c,l,u=a(4811),d=a(7854),h=a(111),p=a(8880),m=a(2597),f=a(5465),_=a(6200),E=a(3501),g="Object already initialized",T=d.TypeError,R=d.WeakMap;if(u||f.state){var w=f.state||(f.state=new R);w.get=w.get,w.has=w.has,w.set=w.set,s=function(N,P){if(w.has(N))throw T(g);return P.facade=N,w.set(N,P),P},c=function(N){return w.get(N)||{}},l=function(N){return w.has(N)}}else{var A=_("state");E[A]=!0,s=function(N,P){if(m(N,A))throw T(g);return P.facade=N,p(N,A,P),P},c=function(N){return m(N,A)?N[A]:{}},l=function(N){return m(N,A)}}i.exports={set:s,get:c,has:l,enforce:function(N){return l(N)?c(N):s(N,{})},getterFor:function(N){return function(P){var x;if(!h(P)||(x=c(P)).type!==N)throw T("Incompatible receiver, "+N+" required");return x}}}},614:(i,o,a)=>{var s=a(4154),c=s.all;i.exports=s.IS_HTMLDDA?function(l){return typeof l=="function"||l===c}:function(l){return typeof l=="function"}},4705:(i,o,a)=>{var s=a(7293),c=a(614),l=/#|\.prototype\./,u=function(f,_){var E=h[d(f)];return E==m||E!=p&&(c(_)?s(_):!!_)},d=u.normalize=function(f){return String(f).replace(l,".").toLowerCase()},h=u.data={},p=u.NATIVE="N",m=u.POLYFILL="P";i.exports=u},8554:i=>{i.exports=function(o){return o==null}},111:(i,o,a)=>{var s=a(614),c=a(4154),l=c.all;i.exports=c.IS_HTMLDDA?function(u){return typeof u=="object"?u!==null:s(u)||u===l}:function(u){return typeof u=="object"?u!==null:s(u)}},1913:i=>{i.exports=!1},2190:(i,o,a)=>{var s=a(5005),c=a(614),l=a(7976),u=a(3307),d=Object;i.exports=u?function(h){return typeof h=="symbol"}:function(h){var p=s("Symbol");return c(p)&&l(p.prototype,d(h))}},3061:(i,o,a)=>{var s=a(3383).IteratorPrototype,c=a(30),l=a(9114),u=a(8003),d=a(7497),h=function(){return this};i.exports=function(p,m,f,_){var E=m+" Iterator";return p.prototype=c(s,{next:l(+!_,f)}),u(p,E,!1,!0),d[E]=h,p}},1656:(i,o,a)=>{var s=a(2109),c=a(6916),l=a(1913),u=a(6530),d=a(614),h=a(3061),p=a(9518),m=a(7674),f=a(8003),_=a(8880),E=a(8052),g=a(5112),T=a(7497),R=a(3383),w=u.PROPER,A=u.CONFIGURABLE,N=R.IteratorPrototype,P=R.BUGGY_SAFARI_ITERATORS,x=g("iterator"),G="keys",ne="values",z="entries",k=function(){return this};i.exports=function(F,K,oe,U,D,W,L){h(oe,K,U);var S,I,O,B=function(Nr){if(Nr===D&&yt)return yt;if(!P&&Nr in ve)return ve[Nr];switch(Nr){case G:case ne:case z:return function(){return new oe(this,Nr)}}return function(){return new oe(this)}},se=K+" Iterator",ge=!1,ve=F.prototype,ut=ve[x]||ve["@@iterator"]||D&&ve[D],yt=!P&&ut||B(D),Zn=K=="Array"&&ve.entries||ut;if(Zn&&(S=p(Zn.call(new F)))!==Object.prototype&&S.next&&(l||p(S)===N||(m?m(S,N):d(S[x])||E(S,x,k)),f(S,se,!0,!0),l&&(T[se]=k)),w&&D==ne&&ut&&ut.name!==ne&&(!l&&A?_(ve,"name",ne):(ge=!0,yt=function(){return c(ut,this)})),D)if(I={values:B(ne),keys:W?yt:B(G),entries:B(z)},L)for(O in I)(P||ge||!(O in ve))&&E(ve,O,I[O]);else s({target:K,proto:!0,forced:P||ge},I);return l&&!L||ve[x]===yt||E(ve,x,yt,{name:D}),T[K]=yt,I}},3383:(i,o,a)=>{var s,c,l,u=a(7293),d=a(614),h=a(111),p=a(30),m=a(9518),f=a(8052),_=a(5112),E=a(1913),g=_("iterator"),T=!1;[].keys&&("next"in(l=[].keys())?(c=m(m(l)))!==Object.prototype&&(s=c):T=!0),!h(s)||u(function(){var R={};return s[g].call(R)!==R})?s={}:E&&(s=p(s)),d(s[g])||f(s,g,function(){return this}),i.exports={IteratorPrototype:s,BUGGY_SAFARI_ITERATORS:T}},7497:i=>{i.exports={}},6244:(i,o,a)=>{var s=a(7466);i.exports=function(c){return s(c.length)}},6339:(i,o,a)=>{var s=a(7293),c=a(614),l=a(2597),u=a(9781),d=a(6530).CONFIGURABLE,h=a(2788),p=a(9909),m=p.enforce,f=p.get,_=Object.defineProperty,E=u&&!s(function(){return _(function(){},"length",{value:8}).length!==8}),g=String(String).split("String"),T=i.exports=function(R,w,A){String(w).slice(0,7)==="Symbol("&&(w="["+String(w).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),A&&A.getter&&(w="get "+w),A&&A.setter&&(w="set "+w),(!l(R,"name")||d&&R.name!==w)&&(u?_(R,"name",{value:w,configurable:!0}):R.name=w),E&&A&&l(A,"arity")&&R.length!==A.arity&&_(R,"length",{value:A.arity});try{A&&l(A,"constructor")&&A.constructor?u&&_(R,"prototype",{writable:!1}):R.prototype&&(R.prototype=void 0)}catch{}var N=m(R);return l(N,"source")||(N.source=g.join(typeof w=="string"?w:"")),R};Function.prototype.toString=T(function(){return c(this)&&f(this).source||h(this)},"toString")},4758:i=>{var o=Math.ceil,a=Math.floor;i.exports=Math.trunc||function(s){var c=+s;return(c>0?a:o)(c)}},6277:(i,o,a)=>{var s=a(1340);i.exports=function(c,l){return c===void 0?arguments.length<2?"":l:s(c)}},30:(i,o,a)=>{var s,c=a(9670),l=a(6048),u=a(748),d=a(3501),h=a(490),p=a(317),m=a(6200)("IE_PROTO"),f=function(){},_=function(T){return"<script>"+T+"<\/script>"},E=function(T){T.write(_("")),T.close();var R=T.parentWindow.Object;return T=null,R},g=function(){try{s=new ActiveXObject("htmlfile")}catch{}var T,R;g=typeof document<"u"?document.domain&&s?E(s):((R=p("iframe")).style.display="none",h.appendChild(R),R.src="javascript:",(T=R.contentWindow.document).open(),T.write(_("document.F=Object")),T.close(),T.F):E(s);for(var w=u.length;w--;)delete g.prototype[u[w]];return g()};d[m]=!0,i.exports=Object.create||function(T,R){var w;return T!==null?(f.prototype=c(T),w=new f,f.prototype=null,w[m]=T):w=g(),R===void 0?w:l.f(w,R)}},6048:(i,o,a)=>{var s=a(9781),c=a(3353),l=a(3070),u=a(9670),d=a(5656),h=a(1956);o.f=s&&!c?Object.defineProperties:function(p,m){u(p);for(var f,_=d(m),E=h(m),g=E.length,T=0;g>T;)l.f(p,f=E[T++],_[f]);return p}},3070:(i,o,a)=>{var s=a(9781),c=a(4664),l=a(3353),u=a(9670),d=a(4948),h=TypeError,p=Object.defineProperty,m=Object.getOwnPropertyDescriptor;o.f=s?l?function(f,_,E){if(u(f),_=d(_),u(E),typeof f=="function"&&_==="prototype"&&"value"in E&&"writable"in E&&!E.writable){var g=m(f,_);g&&g.writable&&(f[_]=E.value,E={configurable:"configurable"in E?E.configurable:g.configurable,enumerable:"enumerable"in E?E.enumerable:g.enumerable,writable:!1})}return p(f,_,E)}:p:function(f,_,E){if(u(f),_=d(_),u(E),c)try{return p(f,_,E)}catch{}if("get"in E||"set"in E)throw h("Accessors not supported");return"value"in E&&(f[_]=E.value),f}},1236:(i,o,a)=>{var s=a(9781),c=a(6916),l=a(5296),u=a(9114),d=a(5656),h=a(4948),p=a(2597),m=a(4664),f=Object.getOwnPropertyDescriptor;o.f=s?f:function(_,E){if(_=d(_),E=h(E),m)try{return f(_,E)}catch{}if(p(_,E))return u(!c(l.f,_,E),_[E])}},8006:(i,o,a)=>{var s=a(6324),c=a(748).concat("length","prototype");o.f=Object.getOwnPropertyNames||function(l){return s(l,c)}},5181:(i,o)=>{o.f=Object.getOwnPropertySymbols},9518:(i,o,a)=>{var s=a(2597),c=a(614),l=a(7908),u=a(6200),d=a(8544),h=u("IE_PROTO"),p=Object,m=p.prototype;i.exports=d?p.getPrototypeOf:function(f){var _=l(f);if(s(_,h))return _[h];var E=_.constructor;return c(E)&&_ instanceof E?E.prototype:_ instanceof p?m:null}},7976:(i,o,a)=>{var s=a(1702);i.exports=s({}.isPrototypeOf)},6324:(i,o,a)=>{var s=a(1702),c=a(2597),l=a(5656),u=a(1318).indexOf,d=a(3501),h=s([].push);i.exports=function(p,m){var f,_=l(p),E=0,g=[];for(f in _)!c(d,f)&&c(_,f)&&h(g,f);for(;m.length>E;)c(_,f=m[E++])&&(~u(g,f)||h(g,f));return g}},1956:(i,o,a)=>{var s=a(6324),c=a(748);i.exports=Object.keys||function(l){return s(l,c)}},5296:(i,o)=>{var a={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,c=s&&!a.call({1:2},1);o.f=c?function(l){var u=s(this,l);return!!u&&u.enumerable}:a},7674:(i,o,a)=>{var s=a(1702),c=a(9670),l=a(6077);i.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var u,d=!1,h={};try{(u=s(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(h,[]),d=h instanceof Array}catch{}return function(p,m){return c(p),l(m),d?u(p,m):p.__proto__=m,p}}():void 0)},2140:(i,o,a)=>{var s=a(6916),c=a(614),l=a(111),u=TypeError;i.exports=function(d,h){var p,m;if(h==="string"&&c(p=d.toString)&&!l(m=s(p,d))||c(p=d.valueOf)&&!l(m=s(p,d))||h!=="string"&&c(p=d.toString)&&!l(m=s(p,d)))return m;throw u("Can't convert object to primitive value")}},3887:(i,o,a)=>{var s=a(5005),c=a(1702),l=a(8006),u=a(5181),d=a(9670),h=c([].concat);i.exports=s("Reflect","ownKeys")||function(p){var m=l.f(d(p)),f=u.f;return f?h(m,f(p)):m}},2626:(i,o,a)=>{var s=a(3070).f;i.exports=function(c,l,u){u in c||s(c,u,{configurable:!0,get:function(){return l[u]},set:function(d){l[u]=d}})}},4488:(i,o,a)=>{var s=a(8554),c=TypeError;i.exports=function(l){if(s(l))throw c("Can't call method on "+l);return l}},8003:(i,o,a)=>{var s=a(3070).f,c=a(2597),l=a(5112)("toStringTag");i.exports=function(u,d,h){u&&!h&&(u=u.prototype),u&&!c(u,l)&&s(u,l,{configurable:!0,value:d})}},6200:(i,o,a)=>{var s=a(2309),c=a(9711),l=s("keys");i.exports=function(u){return l[u]||(l[u]=c(u))}},5465:(i,o,a)=>{var s=a(7854),c=a(3072),l="__core-js_shared__",u=s[l]||c(l,{});i.exports=u},2309:(i,o,a)=>{var s=a(1913),c=a(5465);(i.exports=function(l,u){return c[l]||(c[l]=u!==void 0?u:{})})("versions",[]).push({version:"3.26.0",mode:s?"pure":"global",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})},6293:(i,o,a)=>{var s=a(7392),c=a(7293);i.exports=!!Object.getOwnPropertySymbols&&!c(function(){var l=Symbol();return!String(l)||!(Object(l)instanceof Symbol)||!Symbol.sham&&s&&s<41})},1400:(i,o,a)=>{var s=a(9303),c=Math.max,l=Math.min;i.exports=function(u,d){var h=s(u);return h<0?c(h+d,0):l(h,d)}},5656:(i,o,a)=>{var s=a(8361),c=a(4488);i.exports=function(l){return s(c(l))}},9303:(i,o,a)=>{var s=a(4758);i.exports=function(c){var l=+c;return l!=l||l===0?0:s(l)}},7466:(i,o,a)=>{var s=a(9303),c=Math.min;i.exports=function(l){return l>0?c(s(l),9007199254740991):0}},7908:(i,o,a)=>{var s=a(4488),c=Object;i.exports=function(l){return c(s(l))}},7593:(i,o,a)=>{var s=a(6916),c=a(111),l=a(2190),u=a(8173),d=a(2140),h=a(5112),p=TypeError,m=h("toPrimitive");i.exports=function(f,_){if(!c(f)||l(f))return f;var E,g=u(f,m);if(g){if(_===void 0&&(_="default"),E=s(g,f,_),!c(E)||l(E))return E;throw p("Can't convert object to primitive value")}return _===void 0&&(_="number"),d(f,_)}},4948:(i,o,a)=>{var s=a(7593),c=a(2190);i.exports=function(l){var u=s(l,"string");return c(u)?u:u+""}},1694:(i,o,a)=>{var s={};s[a(5112)("toStringTag")]="z",i.exports=String(s)==="[object z]"},1340:(i,o,a)=>{var s=a(648),c=String;i.exports=function(l){if(s(l)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return c(l)}},6330:i=>{var o=String;i.exports=function(a){try{return o(a)}catch{return"Object"}}},9711:(i,o,a)=>{var s=a(1702),c=0,l=Math.random(),u=s(1 .toString);i.exports=function(d){return"Symbol("+(d===void 0?"":d)+")_"+u(++c+l,36)}},3307:(i,o,a)=>{var s=a(6293);i.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},3353:(i,o,a)=>{var s=a(9781),c=a(7293);i.exports=s&&c(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},4811:(i,o,a)=>{var s=a(7854),c=a(614),l=s.WeakMap;i.exports=c(l)&&/native code/.test(String(l))},5112:(i,o,a)=>{var s=a(7854),c=a(2309),l=a(2597),u=a(9711),d=a(6293),h=a(3307),p=c("wks"),m=s.Symbol,f=m&&m.for,_=h?m:m&&m.withoutSetter||u;i.exports=function(E){if(!l(p,E)||!d&&typeof p[E]!="string"){var g="Symbol."+E;d&&l(m,E)?p[E]=m[E]:p[E]=h&&f?f(g):_(g)}return p[E]}},9191:(i,o,a)=>{var s=a(5005),c=a(2597),l=a(8880),u=a(7976),d=a(7674),h=a(9920),p=a(2626),m=a(9587),f=a(6277),_=a(8340),E=a(1060),g=a(2914),T=a(9781),R=a(1913);i.exports=function(w,A,N,P){var x="stackTraceLimit",G=P?2:1,ne=w.split("."),z=ne[ne.length-1],k=s.apply(null,ne);if(k){var F=k.prototype;if(!R&&c(F,"cause")&&delete F.cause,!N)return k;var K=s("Error"),oe=A(function(U,D){var W=f(P?D:U,void 0),L=P?new k(U):new k;return W!==void 0&&l(L,"message",W),g&&l(L,"stack",E(L.stack,2)),this&&u(F,this)&&m(L,this,oe),arguments.length>G&&_(L,arguments[G]),L});if(oe.prototype=F,z!=="Error"?d?d(oe,K):h(oe,K,{name:!0}):T&&x in k&&(p(oe,k,x),p(oe,k,"prepareStackTrace")),h(oe,k),!R)try{F.name!==z&&l(F,"name",z),F.constructor=oe}catch{}return oe}}},6992:(i,o,a)=>{var s=a(5656),c=a(1223),l=a(7497),u=a(9909),d=a(3070).f,h=a(1656),p=a(6178),m=a(1913),f=a(9781),_="Array Iterator",E=u.set,g=u.getterFor(_);i.exports=h(Array,"Array",function(R,w){E(this,{type:_,target:s(R),index:0,kind:w})},function(){var R=g(this),w=R.target,A=R.kind,N=R.index++;return!w||N>=w.length?(R.target=void 0,p(void 0,!0)):p(A=="keys"?N:A=="values"?w[N]:[N,w[N]],!1)},"values");var T=l.Arguments=l.Array;if(c("keys"),c("values"),c("entries"),!m&&f&&T.name!=="values")try{d(T,"name",{value:"values"})}catch{}},1703:(i,o,a)=>{var s=a(2109),c=a(7854),l=a(2104),u=a(9191),d=c.WebAssembly,h=Error("e",{cause:7}).cause!==7,p=function(f,_){var E={};E[f]=u(f,_,h),s({global:!0,constructor:!0,arity:1,forced:h},E)},m=function(f,_){if(d&&d[f]){var E={};E[f]=u("WebAssembly."+f,_,h),s({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:h},E)}};p("Error",function(f){return function(_){return l(f,this,arguments)}}),p("EvalError",function(f){return function(_){return l(f,this,arguments)}}),p("RangeError",function(f){return function(_){return l(f,this,arguments)}}),p("ReferenceError",function(f){return function(_){return l(f,this,arguments)}}),p("SyntaxError",function(f){return function(_){return l(f,this,arguments)}}),p("TypeError",function(f){return function(_){return l(f,this,arguments)}}),p("URIError",function(f){return function(_){return l(f,this,arguments)}}),m("CompileError",function(f){return function(_){return l(f,this,arguments)}}),m("LinkError",function(f){return function(_){return l(f,this,arguments)}}),m("RuntimeError",function(f){return function(_){return l(f,this,arguments)}})},3948:(i,o,a)=>{var s=a(7854),c=a(8324),l=a(8509),u=a(6992),d=a(8880),h=a(5112),p=h("iterator"),m=h("toStringTag"),f=u.values,_=function(g,T){if(g){if(g[p]!==f)try{d(g,p,f)}catch{g[p]=f}if(g[m]||d(g,m,T),c[T]){for(var R in u)if(g[R]!==u[R])try{d(g,R,u[R])}catch{g[R]=u[R]}}}};for(var E in c)_(s[E]&&s[E].prototype,E);_(l,"DOMTokenList")},6226:(i,o,a)=>{i.exports=a(7460)},7445:(i,o,a)=>{i.exports=a(3685)}},t={};function r(i){var o=t[i];if(o!==void 0)return o.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,r),a.exports}r.n=i=>{var o=i&&i.__esModule?()=>i.default:()=>i;return r.d(o,{a:o}),o},r.d=(i,o)=>{for(var a in o)r.o(o,a)&&!r.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:o[a]})},r.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(i,o)=>Object.prototype.hasOwnProperty.call(i,o),r.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var n={};return(()=>{r.r(n),r.d(n,{AudioExtension:()=>N,AudioProcessor:()=>w,Extension:()=>A,PromiseMutex:()=>ne,Ticker:()=>x,VideoProcessor:()=>R,logger:()=>p,reporter:()=>_});var i=r(7445);function o(z,k,F){return k in z?i(z,k,{value:F,enumerable:!0,configurable:!0,writable:!0}):z[k]=F,z}r(1703),r(6992),r(3948);var a=r(6226),s=r.n(a);function c(){let z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,k=arguments.length>1?arguments[1]:void 0;const F=Math.random().toString(16).substr(2,z).toLowerCase();return F.length===z?"".concat(k).concat(F):"".concat(k).concat(F)+c(z-F.length,"")}const l=Date.now(),u={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4};function d(){const z=new Date;return z.toTimeString().split(" ")[0]+":"+z.getMilliseconds()}const h=z=>{for(const k in u)if(Object.prototype.hasOwnProperty.call(u,k)&&u[k]===z)return k;return"DEFAULT"},p=new class{constructor(){o(this,"logLevel",u.DEBUG),o(this,"hookLog",void 0)}debug(){for(var z=arguments.length,k=new Array(z),F=0;F<z;F++)k[F]=arguments[F];const K=[u.DEBUG].concat(k);this.log.apply(this,K)}info(){for(var z=arguments.length,k=new Array(z),F=0;F<z;F++)k[F]=arguments[F];const K=[u.INFO].concat(k);this.log.apply(this,K)}warning(){for(var z=arguments.length,k=new Array(z),F=0;F<z;F++)k[F]=arguments[F];const K=[u.WARNING].concat(k);this.log.apply(this,K)}error(){for(var z=arguments.length,k=new Array(z),F=0;F<z;F++)k[F]=arguments[F];const K=[u.ERROR].concat(k);this.log.apply(this,K)}log(){for(var z,k=arguments.length,F=new Array(k),K=0;K<k;K++)F[K]=arguments[K];if(Date.now()-l<100)return void setTimeout(()=>{this.log(...F)},Date.now()-l);const oe=Math.max(0,Math.min(4,F[0]));if(F[0]=d()+" Agora-Extension [".concat(h(oe),"]:"),oe<this.logLevel)return;const U=d()+" %cAgora-Extension [".concat(h(oe),"]:");let D=[];switch(oe){case u.DEBUG:D=[U,"color: #64B5F6;"].concat(F.slice(1)),console.log.apply(console,D);break;case u.INFO:D=[U,"color: #1E88E5; font-weight: bold;"].concat(F.slice(1)),console.log.apply(console,D);break;case u.WARNING:D=[U,"color: #FB8C00; font-weight: bold;"].concat(F.slice(1)),console.warn.apply(console,D);break;case u.ERROR:D=[U,"color: #B00020; font-weight: bold;"].concat(F.slice(1)),console.error.apply(console,D)}(z=this.hookLog)===null||z===void 0||z.call(this,oe,D)}};function m(z,k){var F=Object.keys(z);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(z);k&&(K=K.filter(function(oe){return Object.getOwnPropertyDescriptor(z,oe).enumerable})),F.push.apply(F,K)}return F}function f(z){for(var k=1;k<arguments.length;k++){var F=arguments[k]!=null?arguments[k]:{};k%2?m(Object(F),!0).forEach(function(K){o(z,K,F[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(F)):m(Object(F)).forEach(function(K){Object.defineProperty(z,K,Object.getOwnPropertyDescriptor(F,K))})}return z}const _=new class{constructor(){o(this,"apiInvokeMsgQueue",[]),o(this,"hookApiInvoke",void 0)}reportApiInvoke(z){z.timeout=z.timeout||6e4,z.reportResult=z.reportResult===void 0||z.reportResult;const k=Date.now(),F=()=>({name:z.name,apiInvokeTime:k,options:z.options});let K=!1;var oe;(oe=z.timeout,new(s())(D=>{window.setTimeout(D,oe)})).then(()=>{K||(this.sendApiInvoke(f(f({},F()),{},{error:"API_INVOKE_TIMEOUT",success:!1})),p.debug("".concat(z.name," timeout")))});const U=new Error("".concat(z.name,": this api invoke is end"));return{onSuccess:D=>{if(K)throw U;K=!0,this.sendApiInvoke(f(f({},F()),{},{success:!0},z.reportResult&&{result:D}))},onError:D=>{if(K)throw D;K=!0,this.sendApiInvoke(f(f({},F()),{},{success:!1,error:D.toString()}))}}}sendApiInvoke(z){this.hookApiInvoke?(this.hookApiInvoke([...this.apiInvokeMsgQueue,z]),this.apiInvokeMsgQueue=[]):this.apiInvokeMsgQueue.push(z)}};function E(z,k){var F=Object.keys(z);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(z);k&&(K=K.filter(function(oe){return Object.getOwnPropertyDescriptor(z,oe).enumerable})),F.push.apply(F,K)}return F}function g(z){for(var k=1;k<arguments.length;k++){var F=arguments[k]!=null?arguments[k]:{};k%2?E(Object(F),!0).forEach(function(K){o(z,K,F[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(F)):E(Object(F)).forEach(function(K){Object.defineProperty(z,K,Object.getOwnPropertyDescriptor(F,K))})}return z}class T extends class{constructor(){o(this,"_events",{}),o(this,"addListener",this.on)}getListeners(k){return this._events[k]?this._events[k].map(F=>F.listener):[]}on(k,F){this._events[k]||(this._events[k]=[]);const K=this._events[k];this._indexOfListener(K,F)===-1&&K.push({listener:F,once:!1})}once(k,F){this._events[k]||(this._events[k]=[]);const K=this._events[k];this._indexOfListener(K,F)===-1&&K.push({listener:F,once:!0})}off(k,F){if(!this._events[k])return;const K=this._events[k],oe=this._indexOfListener(K,F);oe!==-1&&K.splice(oe,1),this._events[k].length===0&&delete this._events[k]}removeAllListeners(k){k?delete this._events[k]:this._events={}}emit(k){this._events[k]||(this._events[k]=[]);const F=this._events[k].map(D=>D);for(var K=arguments.length,oe=new Array(K>1?K-1:0),U=1;U<K;U++)oe[U-1]=arguments[U];for(let D=0;D<F.length;D+=1){const W=F[D];W.once&&this.off(k,W.listener),W.listener.apply(this,oe||[])}}_indexOfListener(k,F){let K=k.length;for(;K--;)if(k[K].listener===F)return K;return-1}emitAsPromise(k){for(var F=arguments.length,K=new Array(F>1?F-1:0),oe=1;oe<F;oe++)K[oe-1]=arguments[oe];return this.getListeners(k).length===0?s().reject(new Error("No promise event handler.")):new(s())((U,D)=>{this.emit(k,...K,U,D)})}emitAsPromiseNoResponse(k){for(var F=arguments.length,K=new Array(F>1?F-1:0),oe=1;oe<F;oe++)K[oe-1]=arguments[oe];return this.getListeners(k).length===0?s().resolve():new(s())((U,D)=>{this.emit(k,...K,U,D)})}}{get enabled(){return this._enabled}output(k,F){if(this.outputTrack===k)return;const K=_.reportApiInvoke({name:"".concat(this.name,".output"),options:{track:k==null?void 0:k.toString()}});this.outputTrack=k,this.destination&&this.destination.updateInput({track:k,context:F}),K.onSuccess()}constructor(){super(),o(this,"inputTrack",void 0),o(this,"outputTrack",void 0),o(this,"_enabled",!0),o(this,"_source",void 0),o(this,"ID",c(6,"")),o(this,"destination",void 0),o(this,"context",void 0),o(this,"name",void 0)}enable(){if(this._enabled)return;const k=_.reportApiInvoke({name:"".concat(this.name,".enable"),options:!0});p.info("".concat(this.name,"-").concat(this.ID," enabled")),this._enabled=!0;try{var F;const K=(F=this.onEnableChange)===null||F===void 0?void 0:F.call(this,this._enabled);if(K instanceof s())return K.then(()=>{k.onSuccess()}).catch(oe=>{throw k.onError(oe),oe});k.onSuccess()}catch(K){throw k.onError(K),K}}disable(){if(!this._enabled)return;const k=_.reportApiInvoke({name:"".concat(this.name,".enable"),options:!1});p.info("".concat(this.name,"-").concat(this.ID," disabled")),this._enabled=!1;try{var F;const K=(F=this.onEnableChange)===null||F===void 0?void 0:F.call(this,this._enabled);if(K instanceof s())return K.then(()=>{k.onSuccess()}).catch(oe=>{throw k.onError(oe),oe});k.onSuccess()}catch(K){throw k.onError(K),K}}}class R extends T{get kind(){return"video"}pipe(k){const F=_.reportApiInvoke({name:"".concat(this.name,".pipe"),options:{processor:k.name}});if(this.destination===k)return F.onSuccess(),k;if(k._source){const K=new Error("Processor ".concat(k.name," already being piped, please call ").concat(k._source.name,".unpipe() beforehand."));throw F.onError(K),K}return this.destination&&this.unpipe(),this.destination=k,k._source=this,this.context&&this.destination.updateInput({track:this.outputTrack,context:this.context}),F.onSuccess(),k}unpipe(){if(!this.destination)return;const k=_.reportApiInvoke({name:"".concat(this.name,".unpipe"),options:{processor:this.destination.name}});p.info("unpiping processor ".concat(this.destination.name,"-").concat(this.destination.ID));try{const F=this.destination;this.destination._source=void 0,this.destination=void 0,F.reset()}finally{k.onSuccess()}}updateInput(k){var F,K;k.context!==this.context&&(this.context=k.context,(F=this.onPiped)===null||F===void 0||F.call(this,this.context),this.destination&&this.destination.updateInput({track:this.outputTrack,context:k.context})),k.track&&this.inputTrack!==k.track&&(this.inputTrack=k.track,(K=this.onTrack)===null||K===void 0||K.call(this,k.track,this.context))}reset(){var k;this.context&&this.context.requestRevertConstraints(this),this.inputTrack=void 0,this.context=void 0,(k=this.onUnpiped)===null||k===void 0||k.call(this),this.destination&&this.destination.reset()}}class w extends T{constructor(){super(...arguments),o(this,"inputNode",void 0),o(this,"outputNode",void 0),o(this,"destination",void 0),o(this,"context",void 0)}get kind(){return"audio"}pipe(k){const F=_.reportApiInvoke({name:"".concat(this.name,".pipe"),options:{processor:k.name}});if(this.destination===k)return F.onSuccess(),k;if(k._source){const K=new Error("Processor ".concat(k.name," already being piped, please call ").concat(k._source.name,".unpipe() beforehand."));throw F.onError(K),K}return this.destination&&this.unpipe(),this.destination=k,k._source=this,this.context&&this.destination.updateInput({track:this.outputTrack,node:this.outputNode,context:this.context}),F.onSuccess(),k}unpipe(){if(!this.destination)return;p.info("unpiping processor ".concat(this.destination.name,"-").concat(this.destination.ID));const k=_.reportApiInvoke({name:"".concat(this.name,".unpipe"),options:{processor:this.destination.name}});try{var F;let K=this.destination;(F=this.outputNode)===null||F===void 0||F.disconnect(),this.destination._source=void 0,this.destination=void 0,K.reset()}finally{k.onSuccess()}}output(k,F){if(k instanceof MediaStreamTrack)super.output(k,F);else if(k instanceof AudioNode){if(this.outputNode===k)return;const K=_.reportApiInvoke({name:"".concat(this.name,".output"),options:g(g({},k instanceof MediaStreamTrack&&{track:k.toString()}),k instanceof AudioNode&&{audioNode:k.toString()})});this.outputNode=k,this.destination&&this.destination.updateInput({node:k,context:F}),K.onSuccess()}}updateInput(k){var F,K,oe;k.context!==this.context&&(this.context=k.context,(F=this.onPiped)===null||F===void 0||F.call(this,this.context),this.destination&&this.destination.updateInput({track:this.outputTrack,node:this.outputNode,context:k.context})),k.track&&this.inputTrack!==k.track&&(this.inputTrack=k.track,(K=this.onTrack)===null||K===void 0||K.call(this,k.track,this.context)),k.node&&this.inputNode!==k.node&&(this.inputNode=k.node,(oe=this.onNode)===null||oe===void 0||oe.call(this,k.node,this.context))}reset(){var k;this.context&&this.context.requestRevertConstraints(this),this.inputTrack=void 0,this.inputNode=void 0,(k=this.onUnpiped)===null||k===void 0||k.call(this,this.context),this.context=void 0,this.destination&&this.destination.reset()}}class A{constructor(){o(this,"__registered__",!1),o(this,"logger",p),o(this,"reporter",_),o(this,"parameters",{})}createProcessor(){if(!this.__registered__)throw new Error("Extension not registered yet!");return this._createProcessor()}}class N extends A{}let P;class x{get running(){return this._running}constructor(k,F){if(o(this,"type",void 0),o(this,"interval",void 0),o(this,"fn",void 0),o(this,"_running",!1),o(this,"_osc",void 0),!k)throw new Error;if(F<=0)throw new Error;this.type=k,this.interval=F}add(k){this.fn=k}remove(){this.fn=void 0}start(){if(!this._running)switch(this._running=!0,this.type){case"Timer":{const k=()=>{setTimeout(()=>{this.fn&&this.fn(),this._running&&k()},this.interval)};k();break}case"RAF":{const k=F=>{requestAnimationFrame(K=>{K-F<this.interval?this._running&&k(F):(this.fn&&this.fn(),this._running&&k(K))})};k(performance.now());break}case"Oscillator":{P||(P=new AudioContext);const k=P.createGain();let F;k.gain.value=0,k.connect(P.destination);const K=()=>{this.fn&&this.fn(),F&&F.disconnect(),F=P.createOscillator(),this._osc=F,F.connect(k),this._running&&(F.onended=K,F.start(0),F.stop(P.currentTime+this.interval/1e3))};K();break}}}stop(){this._running=!1,this._osc&&(this._osc.onended=null,this._osc=void 0)}}let G=1;class ne{constructor(k){o(this,"lockingPromise",s().resolve()),o(this,"locks",0),o(this,"name",""),o(this,"lockId",void 0),this.lockId=G++,k&&(this.name=k)}get isLocked(){return this.locks>0}lock(k){let F;this.locks+=1;const K=new(s())(U=>{F=()=>{this.locks-=1,U()}}),oe=this.lockingPromise.then(()=>F);return this.lockingPromise=this.lockingPromise.then(()=>K),oe}}})(),n})(),Nt.exports=ZD();const jZ={ADJUST_3A_FROM_PLUGINS:!0,AI_DENOISER_PARAMETERS:{}},ek={echoCancellation:!0,noiseSuppression:!1,autoGainControl:!0},BZ={numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[1]},GZ={ains:!0,agc:!0,bufferTime:30,dumpBundleNums:3,threshold:2},WZ={nsRoute:0},HZ={nsRoute:2},KZ={lowerBound:.08,lowerMask:.05,statisticalBound:.05,finalLowerMask:.03},zZ={lowerBound:.01,lowerMask:.01,statisticalBound:0,finalLowerMask:.008},tk=["remote"],sn={};function KF(){return!!globalThis.AudioWorklet&&!!globalThis.AudioWorkletNode}class Ls extends EventTarget{constructor(t,r){super(),this.workletNode=new AudioWorkletNode(t,"ai-denoiser-worklet-processor",Object.assign(Object.assign({},BZ),r)),this.workletNode.port.addEventListener("message",this.handleMessageEvent.bind(this)),this.workletNode.port.start()}static create(t,r,n,i,o,a,s,c){return Gi(this,void 0,void 0,function*(){if(!KF())throw new Error("does not support AudioWorklet");if(t.state==="closed")throw new Error("context has been closed");if(!Ls.registeredContexts.has(t)){const u=new Blob([`/**
 * AgoraExtensionAIDenoiser-1.1.0-9019a23(11/10/2022, 5:31:24 PM) Copyright AgoraInc.
 */

!function(){"use strict";var e={exports:{}};!function(e,t){var n,r=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,r,a;e=e||{},"function"==typeof AudioWorkletGlobalScope&&(t=globalThis.Module),t||(t=void 0!==e?e:{}),t.ready=new Promise((function(e,t){r=e,a=t}));var i,o=Object.assign({},t),u="./this.program",s="object"==typeof window,c="function"==typeof importScripts,l="function"==typeof AudioWorkletGlobalScope,f="";s||c?(c?f=self.location.href:"undefined"!=typeof document&&document.currentScript&&(f=document.currentScript.src),n&&(f=n),f=0!==f.indexOf("blob:")?f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):"",c&&(i=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)})):l&&Object.assign(globalThis,{performance:{start:Date.now(),now:function(){return Date.now()-performance.start}}});var h,d=t.print||console.log.bind(console),p=t.printErr||console.warn.bind(console);Object.assign(t,o),o=null,t.thisProgram&&(u=t.thisProgram),t.wasmBinary&&(h=t.wasmBinary),t.noExitRuntime,"object"!=typeof WebAssembly&&$("no native wasm support detected");var m,v=!1,g="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function y(e,t,n){var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.subarray&&g)return g.decode(e.subarray(t,n));for(r="";t<n;){var a=e[t++];if(128&a){var i=63&e[t++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&e[t++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&e[t++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function b(e,t,n,r){if(0<r){r=n+r-1;for(var a=0;a<e.length;++a){var i=e.charCodeAt(a);if(55296<=i&&57343>=i&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++a)),127>=i){if(n>=r)break;t[n++]=i}else{if(2047>=i){if(n+1>=r)break;t[n++]=192|i>>6}else{if(65535>=i){if(n+2>=r)break;t[n++]=224|i>>12}else{if(n+3>=r)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63}t[n++]=128|i>>6&63}t[n++]=128|63&i}}t[n]=0}}function w(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),127>=r?++t:t=2047>=r?t+2:65535>=r?t+3:t+4}return t}var A,T,C,k,_,D,P,E,O,S="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function W(e,t){for(var n=e>>1,r=n+t/2;!(n>=r)&&_[n];)++n;if(32<(n<<=1)-e&&S)return S.decode(C.subarray(e,n));for(n="",r=0;!(r>=t/2);++r){var a=k[e+2*r>>1];if(0==a)break;n+=String.fromCharCode(a)}return n}function F(e,t,n){if(void 0===n&&(n=2147483647),2>n)return 0;var r=t;n=(n-=2)<2*e.length?n/2:e.length;for(var a=0;a<n;++a)k[t>>1]=e.charCodeAt(a),t+=2;return k[t>>1]=0,t-r}function M(e){return 2*e.length}function j(e,t){for(var n=0,r="";!(n>=t/4);){var a=D[e+4*n>>2];if(0==a)break;++n,65536<=a?(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a)):r+=String.fromCharCode(a)}return r}function R(e,t,n){if(void 0===n&&(n=2147483647),4>n)return 0;var r=t;n=r+n-4;for(var a=0;a<e.length;++a){var i=e.charCodeAt(a);if(55296<=i&&57343>=i&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++a)),D[t>>2]=i,(t+=4)+4>n)break}return D[t>>2]=0,t-r}function N(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&++n,t+=4}return t}function I(){var e=m.buffer;A=e,t.HEAP8=T=new Int8Array(e),t.HEAP16=k=new Int16Array(e),t.HEAP32=D=new Int32Array(e),t.HEAPU8=C=new Uint8Array(e),t.HEAPU16=_=new Uint16Array(e),t.HEAPU32=P=new Uint32Array(e),t.HEAPF32=E=new Float32Array(e),t.HEAPF64=O=new Float64Array(e)}var U,B=[],Y=[],x=[];function H(){var e=t.preRun.shift();B.unshift(e)}var V,L=0,z=null;function $(e){throw t.onAbort&&t.onAbort(e),p(e="Aborted("+e+")"),v=!0,e=new WebAssembly.RuntimeError(e+". Build with -s ASSERTIONS=1 for more info."),a(e),e}function G(){return V.startsWith("data:application/octet-stream;base64,")}if(t.preloadedImages={},t.preloadedAudios={},V="audio_denoiser.wasm",!G()){var q=V;V=t.locateFile?t.locateFile(q,f):f+q}function J(){var e=V;try{if(e==V&&h)return new Uint8Array(h);if(i)return i(e);throw"both async and sync fetching of the wasm failed"}catch(e){$(e)}}function X(e){for(;0<e.length;){var n=e.shift();if("function"==typeof n)n(t);else{var r=n.ib;"number"==typeof r?void 0===n.Ba?Z(r)():Z(r)(n.Ba):r(void 0===n.Ba?null:n.Ba)}}}var K=[];function Z(e){var t=K[e];return t||(e>=K.length&&(K.length=e+1),K[e]=t=U.get(e)),t}function Q(e){this.ea=e-16,this.Xa=function(e){D[this.ea+4>>2]=e},this.Ra=function(e){D[this.ea+8>>2]=e},this.Sa=function(){D[this.ea>>2]=0},this.Pa=function(){T[this.ea+12>>0]=0},this.Ua=function(){T[this.ea+13>>0]=0},this.Na=function(e,t){this.Xa(e),this.Ra(t),this.Sa(),this.Pa(),this.Ua()}}var ee={};function te(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function ne(e){return this.fromWireType(P[e>>2])}var re={},ae={},ie={};function oe(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return 48<=t&&57>=t?"_"+e:e}function ue(e,t){return e=oe(e),function(){return t.apply(this,arguments)}}function se(e){var t=Error,n=ue(e,(function(t){this.name=e,this.message=t,void 0!==(t=Error(t).stack)&&(this.stack=this.toString()+"\\n"+t.replace(/^Error(:[^\\n]*)?\\n/,""))}));return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var ce=void 0;function le(e){throw new ce(e)}function fe(e,t,n){function r(t){(t=n(t)).length!==e.length&&le("Mismatched type converter count");for(var r=0;r<e.length;++r)ye(e[r],t[r])}e.forEach((function(e){ie[e]=t}));var a=Array(t.length),i=[],o=0;t.forEach((function(e,t){ae.hasOwnProperty(e)?a[t]=ae[e]:(i.push(e),re.hasOwnProperty(e)||(re[e]=[]),re[e].push((function(){a[t]=ae[e],++o===i.length&&r(a)})))})),0===i.length&&r(a)}var he={};function de(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var pe=void 0;function me(e){for(var t="";C[e];)t+=pe[C[e++]];return t}var ve=void 0;function ge(e){throw new ve(e)}function ye(e,t,n={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||ge('type "'+r+'" must have a positive integer typeid pointer'),ae.hasOwnProperty(e)){if(n.Ya)return;ge("Cannot register type '"+r+"' twice")}ae[e]=t,delete ie[e],re.hasOwnProperty(e)&&(t=re[e],delete re[e],t.forEach((function(e){e()})))}function be(e){ge(e.ca.fa.da.name+" instance already deleted")}var we=!1;function Ae(){}function Te(e){--e.count.value,0===e.count.value&&(e.ga?e.ka.ja(e.ga):e.fa.da.ja(e.ea))}function Ce(e,t,n){return t===n?e:void 0===n.la||null===(e=Ce(e,t,n.la))?null:n.Qa(e)}var ke={},_e=[];function De(){for(;_e.length;){var e=_e.pop();e.ca.pa=!1,e.delete()}}var Pe=void 0,Ee={};function Oe(e,t){return t.fa&&t.ea||le("makeClassHandle requires ptr and ptrType"),!!t.ka!=!!t.ga&&le("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Se(Object.create(e,{ca:{value:t}}))}function Se(e){return"undefined"==typeof FinalizationRegistry?(Se=e=>e,e):(we=new FinalizationRegistry((e=>{Te(e.ca)})),Ae=e=>{we.unregister(e)},(Se=e=>{var t=e.ca;return t.ga&&we.register(e,{ca:t},e),e})(e))}function We(){}function Fe(e,t,n){if(void 0===e[t].ma){var r=e[t];e[t]=function(){return e[t].ma.hasOwnProperty(arguments.length)||ge("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].ma+")!"),e[t].ma[arguments.length].apply(this,arguments)},e[t].ma=[],e[t].ma[r.va]=r}}function Me(e,n){t.hasOwnProperty(e)?(ge("Cannot register public name '"+e+"' twice"),Fe(t,e,e),t.hasOwnProperty(void 0)&&ge("Cannot register multiple overloads of a function with the same number of arguments (undefined)!"),t[e].ma[void 0]=n):t[e]=n}function je(e,t,n,r,a,i,o,u){this.name=e,this.constructor=t,this.na=n,this.ja=r,this.la=a,this.Va=i,this.ua=o,this.Qa=u,this.$a=[]}function Re(e,t,n){for(;t!==n;)t.ua||ge("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.ua(e),t=t.la;return e}function Ne(e,t){return null===t?(this.Fa&&ge("null is not a valid "+this.name),0):(t.ca||ge('Cannot pass "'+et(t)+'" as a '+this.name),t.ca.ea||ge("Cannot pass deleted object as a pointer of type "+this.name),Re(t.ca.ea,t.ca.fa.da,this.da))}function Ie(e,t){if(null===t){if(this.Fa&&ge("null is not a valid "+this.name),this.xa){var n=this.sa();return null!==e&&e.push(this.ja,n),n}return 0}if(t.ca||ge('Cannot pass "'+et(t)+'" as a '+this.name),t.ca.ea||ge("Cannot pass deleted object as a pointer of type "+this.name),!this.wa&&t.ca.fa.wa&&ge("Cannot convert argument of type "+(t.ca.ka?t.ca.ka.name:t.ca.fa.name)+" to parameter type "+this.name),n=Re(t.ca.ea,t.ca.fa.da,this.da),this.xa)switch(void 0===t.ca.ga&&ge("Passing raw pointer to smart pointer is illegal"),this.bb){case 0:t.ca.ka===this?n=t.ca.ga:ge("Cannot convert argument of type "+(t.ca.ka?t.ca.ka.name:t.ca.fa.name)+" to parameter type "+this.name);break;case 1:n=t.ca.ga;break;case 2:if(t.ca.ka===this)n=t.ca.ga;else{var r=t.clone();n=this.ab(n,Ke((function(){r.delete()}))),null!==e&&e.push(this.ja,n)}break;default:ge("Unsupporting sharing policy")}return n}function Ue(e,t){return null===t?(this.Fa&&ge("null is not a valid "+this.name),0):(t.ca||ge('Cannot pass "'+et(t)+'" as a '+this.name),t.ca.ea||ge("Cannot pass deleted object as a pointer of type "+this.name),t.ca.fa.wa&&ge("Cannot convert argument of type "+t.ca.fa.name+" to parameter type "+this.name),Re(t.ca.ea,t.ca.fa.da,this.da))}function Be(e,t,n,r){this.name=e,this.da=t,this.Fa=n,this.wa=r,this.xa=!1,this.ja=this.ab=this.sa=this.Ma=this.bb=this.Za=void 0,void 0!==t.la?this.toWireType=Ie:(this.toWireType=r?Ne:Ue,this.ia=null)}function Ye(e,n){var r=(e=me(e)).includes("j")?function(e,n){var r=[];return function(){if(r.length=0,Object.assign(r,arguments),e.includes("j")){var a=t["dynCall_"+e];a=r&&r.length?a.apply(null,[n].concat(r)):a.call(null,n)}else a=Z(n).apply(null,r);return a}}(e,n):Z(n);return"function"!=typeof r&&ge("unknown function pointer with signature "+e+": "+n),r}var xe=void 0;function He(e){var t=me(e=At(e));return wt(e),t}function Ve(e,t){var n=[],r={};throw t.forEach((function e(t){r[t]||ae[t]||(ie[t]?ie[t].forEach(e):(n.push(t),r[t]=!0))})),new xe(e+": "+n.map(He).join([", "]))}function Le(e,t){for(var n=[],r=0;r<e;r++)n.push(D[(t>>2)+r]);return n}function ze(e,t,n,r,a){var i=t.length;2>i&&ge("argTypes array size mismatch! Must at least get return value and 'this' types!");var o=null!==t[1]&&null!==n,u=!1;for(n=1;n<t.length;++n)if(null!==t[n]&&void 0===t[n].ia){u=!0;break}var s="void"!==t[0].name,c=i-2,l=Array(c),f=[],h=[];return function(){if(arguments.length!==c&&ge("function "+e+" called with "+arguments.length+" arguments, expected "+c+" args!"),h.length=0,f.length=o?2:1,f[0]=a,o){var n=t[1].toWireType(h,this);f[1]=n}for(var i=0;i<c;++i)l[i]=t[i+2].toWireType(h,arguments[i]),f.push(l[i]);if(i=r.apply(null,f),u)te(h);else for(var d=o?1:2;d<t.length;d++){var p=1===d?n:l[d-2];null!==t[d].ia&&t[d].ia(p)}return n=s?t[0].fromWireType(i):void 0}}function $e(e,t,n){return e instanceof Object||ge(n+' with invalid "this": '+e),e instanceof t.da.constructor||ge(n+' incompatible with "this" of type '+e.constructor.name),e.ca.ea||ge("cannot call emscripten binding method "+n+" on deleted object"),Re(e.ca.ea,e.ca.fa.da,t.da)}var Ge=[],qe=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Je(e){4<e&&0==--qe[e].Ga&&(qe[e]=void 0,Ge.push(e))}function Xe(e){return e||ge("Cannot use deleted val. handle = "+e),qe[e].value}function Ke(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=Ge.length?Ge.pop():qe.length;return qe[t]={Ga:1,value:e},t}}function Ze(e,t,n){switch(t){case 0:return function(e){return this.fromWireType((n?T:C)[e])};case 1:return function(e){return this.fromWireType((n?k:_)[e>>1])};case 2:return function(e){return this.fromWireType((n?D:P)[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function Qe(e,t){var n=ae[e];return void 0===n&&ge(t+" has unknown type "+He(e)),n}function et(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function tt(e,t){switch(t){case 2:return function(e){return this.fromWireType(E[e>>2])};case 3:return function(e){return this.fromWireType(O[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function nt(e,t,n){switch(t){case 0:return n?function(e){return T[e]}:function(e){return C[e]};case 1:return n?function(e){return k[e>>1]}:function(e){return _[e>>1]};case 2:return n?function(e){return D[e>>2]}:function(e){return P[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var rt,at={};rt=()=>performance.now();var it={};function ot(){if(!ut){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"};for(e in it)void 0===it[e]?delete t[e]:t[e]=it[e];var n=[];for(e in t)n.push(e+"="+t[e]);ut=n}return ut}var ut,st=[null,[],[]],ct={};function lt(e){return 0==e%4&&(0!=e%100||0==e%400)}function ft(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}var ht=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function pt(e,t){for(e=new Date(e.getTime());0<t;){var n=e.getMonth(),r=(lt(e.getFullYear())?ht:dt)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return e}function mt(e,t,n,r){function a(e,t,n){for(e="number"==typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function i(e,t){return a(e,t,"0")}function o(e,t){function n(e){return 0>e?-1:0<e?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function u(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function s(e){e=pt(new Date(e.ha+1900,0,1),e.Aa);var t=new Date(e.getFullYear()+1,0,4),n=u(new Date(e.getFullYear(),0,4));return t=u(t),0>=o(n,e)?0>=o(t,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var c=D[r+40>>2];for(var l in r={fb:D[r>>2],eb:D[r+4>>2],ya:D[r+8>>2],ta:D[r+12>>2],qa:D[r+16>>2],ha:D[r+20>>2],za:D[r+24>>2],Aa:D[r+28>>2],lb:D[r+32>>2],cb:D[r+36>>2],gb:c&&c?y(C,c,void 0):""},n=n?y(C,n,void 0):"",c={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(l,"g"),c[l]);var f="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),h="January February March April May June July August September October November December".split(" ");for(l in c={"%a":function(e){return f[e.za].substring(0,3)},"%A":function(e){return f[e.za]},"%b":function(e){return h[e.qa].substring(0,3)},"%B":function(e){return h[e.qa]},"%C":function(e){return i((e.ha+1900)/100|0,2)},"%d":function(e){return i(e.ta,2)},"%e":function(e){return a(e.ta,2," ")},"%g":function(e){return s(e).toString().substring(2)},"%G":function(e){return s(e)},"%H":function(e){return i(e.ya,2)},"%I":function(e){return 0==(e=e.ya)?e=12:12<e&&(e-=12),i(e,2)},"%j":function(e){return i(e.ta+ft(lt(e.ha+1900)?ht:dt,e.qa-1),3)},"%m":function(e){return i(e.qa+1,2)},"%M":function(e){return i(e.eb,2)},"%n":function(){return"\\n"},"%p":function(e){return 0<=e.ya&&12>e.ya?"AM":"PM"},"%S":function(e){return i(e.fb,2)},"%t":function(){return"\\t"},"%u":function(e){return e.za||7},"%U":function(e){var t=new Date(e.ha+1900,0,1),n=0===t.getDay()?t:pt(t,7-t.getDay());return 0>o(n,e=new Date(e.ha+1900,e.qa,e.ta))?i(Math.ceil((31-n.getDate()+(ft(lt(e.getFullYear())?ht:dt,e.getMonth()-1)-31)+e.getDate())/7),2):0===o(n,t)?"01":"00"},"%V":function(e){var t=new Date(e.ha+1901,0,4),n=u(new Date(e.ha+1900,0,4));t=u(t);var r=pt(new Date(e.ha+1900,0,1),e.Aa);return 0>o(r,n)?"53":0>=o(t,r)?"01":i(Math.ceil((n.getFullYear()<e.ha+1900?e.Aa+32-n.getDate():e.Aa+1-n.getDate())/7),2)},"%w":function(e){return e.za},"%W":function(e){var t=new Date(e.ha,0,1),n=1===t.getDay()?t:pt(t,0===t.getDay()?1:7-t.getDay()+1);return 0>o(n,e=new Date(e.ha+1900,e.qa,e.ta))?i(Math.ceil((31-n.getDate()+(ft(lt(e.getFullYear())?ht:dt,e.getMonth()-1)-31)+e.getDate())/7),2):0===o(n,t)?"01":"00"},"%y":function(e){return(e.ha+1900).toString().substring(2)},"%Y":function(e){return e.ha+1900},"%z":function(e){var t=0<=(e=e.cb);return e=Math.abs(e)/60,(t?"+":"-")+String("0000"+(e/60*100+e%60)).slice(-4)},"%Z":function(e){return e.gb},"%%":function(){return"%"}},n=n.replace(/%%/g,"\\0\\0"),c)n.includes(l)&&(n=n.replace(new RegExp(l,"g"),c[l](r)));return l=function(e){var t=Array(w(e)+1);return b(e,t,0,t.length),t}(n=n.replace(/\\0\\0/g,"%")),l.length>t?0:(T.set(l,e),l.length-1)}ce=t.InternalError=se("InternalError");for(var vt=Array(256),gt=0;256>gt;++gt)vt[gt]=String.fromCharCode(gt);pe=vt,ve=t.BindingError=se("BindingError"),We.prototype.isAliasOf=function(e){if(!(this instanceof We&&e instanceof We))return!1;var t=this.ca.fa.da,n=this.ca.ea,r=e.ca.fa.da;for(e=e.ca.ea;t.la;)n=t.ua(n),t=t.la;for(;r.la;)e=r.ua(e),r=r.la;return t===r&&n===e},We.prototype.clone=function(){if(this.ca.ea||be(this),this.ca.ra)return this.ca.count.value+=1,this;var e=Se,t=Object,n=t.create,r=Object.getPrototypeOf(this),a=this.ca;return(e=e(n.call(t,r,{ca:{value:{count:a.count,pa:a.pa,ra:a.ra,ea:a.ea,fa:a.fa,ga:a.ga,ka:a.ka}}}))).ca.count.value+=1,e.ca.pa=!1,e},We.prototype.delete=function(){this.ca.ea||be(this),this.ca.pa&&!this.ca.ra&&ge("Object already scheduled for deletion"),Ae(this),Te(this.ca),this.ca.ra||(this.ca.ga=void 0,this.ca.ea=void 0)},We.prototype.isDeleted=function(){return!this.ca.ea},We.prototype.deleteLater=function(){return this.ca.ea||be(this),this.ca.pa&&!this.ca.ra&&ge("Object already scheduled for deletion"),_e.push(this),1===_e.length&&Pe&&Pe(De),this.ca.pa=!0,this},t.getInheritedInstanceCount=function(){return Object.keys(Ee).length},t.getLiveInheritedInstances=function(){var e,t=[];for(e in Ee)Ee.hasOwnProperty(e)&&t.push(Ee[e]);return t},t.flushPendingDeletes=De,t.setDelayFunction=function(e){Pe=e,_e.length&&Pe&&Pe(De)},Be.prototype.Wa=function(e){return this.Ma&&(e=this.Ma(e)),e},Be.prototype.Ka=function(e){this.ja&&this.ja(e)},Be.prototype.argPackAdvance=8,Be.prototype.readValueFromPointer=ne,Be.prototype.deleteObject=function(e){null!==e&&e.delete()},Be.prototype.fromWireType=function(e){function t(){return this.xa?Oe(this.da.na,{fa:this.Za,ea:n,ka:this,ga:e}):Oe(this.da.na,{fa:this,ea:e})}var n=this.Wa(e);if(!n)return this.Ka(e),null;var r=function(e,t){for(void 0===t&&ge("ptr should not be undefined");e.la;)t=e.ua(t),e=e.la;return Ee[t]}(this.da,n);if(void 0!==r)return 0===r.ca.count.value?(r.ca.ea=n,r.ca.ga=e,r.clone()):(r=r.clone(),this.Ka(e),r);if(r=this.da.Va(n),!(r=ke[r]))return t.call(this);r=this.wa?r.Oa:r.pointerType;var a=Ce(n,this.da,r.da);return null===a?t.call(this):this.xa?Oe(r.da.na,{fa:r,ea:a,ka:this,ga:e}):Oe(r.da.na,{fa:r,ea:a})},xe=t.UnboundTypeError=se("UnboundTypeError"),t.count_emval_handles=function(){for(var e=0,t=5;t<qe.length;++t)void 0!==qe[t]&&++e;return e},t.get_first_emval=function(){for(var e=5;e<qe.length;++e)if(void 0!==qe[e])return qe[e];return null};var yt={k:function(e){return bt(e+16)+16},j:function(e,t,n){throw new Q(e).Na(t,n),e},N:function(e){var t=ee[e];delete ee[e];var n=t.elements,r=n.length,a=n.map((function(e){return e.Ea})).concat(n.map((function(e){return e.Ia}))),i=t.sa,o=t.ja;fe([e],a,(function(e){return n.forEach((function(t,n){var a=e[n],i=t.Ca,o=t.Da,u=e[n+r],s=t.Ha,c=t.Ja;t.read=e=>a.fromWireType(i(o,e)),t.write=(e,t)=>{var n=[];s(c,e,u.toWireType(n,t)),te(n)}})),[{name:t.name,fromWireType:function(e){for(var t=Array(r),a=0;a<r;++a)t[a]=n[a].read(e);return o(e),t},toWireType:function(e,a){if(r!==a.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+r+", actual="+a.length);for(var u=i(),s=0;s<r;++s)n[s].write(u,a[s]);return null!==e&&e.push(o,u),u},argPackAdvance:8,readValueFromPointer:ne,ia:o}]}))},P:function(e){var t=he[e];delete he[e];var n=t.sa,r=t.ja,a=t.La;fe([e],a.map((function(e){return e.Ea})).concat(a.map((function(e){return e.Ia}))),(function(e){var i={};return a.forEach((function(t,n){var r=e[n],o=t.Ca,u=t.Da,s=e[n+a.length],c=t.Ha,l=t.Ja;i[t.Ta]={read:function(e){return r.fromWireType(o(u,e))},write:function(e,t){var n=[];c(l,e,s.toWireType(n,t)),te(n)}}})),[{name:t.name,fromWireType:function(e){var t,n={};for(t in i)n[t]=i[t].read(e);return r(e),n},toWireType:function(e,t){for(var a in i)if(!(a in t))throw new TypeError('Missing field:  "'+a+'"');var o=n();for(a in i)i[a].write(o,t[a]);return null!==e&&e.push(r,o),o},argPackAdvance:8,readValueFromPointer:ne,ia:r}]}))},A:function(){},K:function(e,t,n,r,a){var i=de(n);ye(e,{name:t=me(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:a},argPackAdvance:8,readValueFromPointer:function(e){if(1===n)var r=T;else if(2===n)r=k;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=D}return this.fromWireType(r[e>>i])},ia:null})},w:function(e,n,r,a,i,o,u,s,c,l,f,h,d){f=me(f),o=Ye(i,o),s&&(s=Ye(u,s)),l&&(l=Ye(c,l)),d=Ye(h,d);var p=oe(f);Me(p,(function(){Ve("Cannot construct "+f+" due to unbound types",[a])})),fe([e,n,r],a?[a]:[],(function(n){if(n=n[0],a)var r=n.da,i=r.na;else i=We.prototype;n=ue(p,(function(){if(Object.getPrototypeOf(this)!==u)throw new ve("Use 'new' to construct "+f);if(void 0===c.oa)throw new ve(f+" has no accessible constructor");var e=c.oa[arguments.length];if(void 0===e)throw new ve("Tried to invoke ctor of "+f+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(c.oa).toString()+") parameters instead!");return e.apply(this,arguments)}));var u=Object.create(i,{constructor:{value:n}});n.prototype=u;var c=new je(f,n,u,d,r,o,s,l);r=new Be(f,c,!0,!1),i=new Be(f+"*",c,!1,!1);var h=new Be(f+" const*",c,!1,!0);return ke[e]={pointerType:i,Oa:h},function(e,n){t.hasOwnProperty(e)||le("Replacing nonexistant public symbol"),t[e]=n,t[e].va=void 0}(p,n),[r,i,h]}))},t:function(e,t,n,r,a,i){0<t||$(void 0);var o=Le(t,n);a=Ye(r,a),fe([],[e],(function(e){var n="constructor "+(e=e[0]).name;if(void 0===e.da.oa&&(e.da.oa=[]),void 0!==e.da.oa[t-1])throw new ve("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.da.oa[t-1]=()=>{Ve("Cannot construct "+e.name+" due to unbound types",o)},fe([],o,(function(r){return r.splice(1,0,null),e.da.oa[t-1]=ze(n,r,null,a,i),[]})),[]}))},l:function(e,t,n,r,a,i,o,u){var s=Le(n,r);t=me(t),i=Ye(a,i),fe([],[e],(function(e){function r(){Ve("Cannot call "+a+" due to unbound types",s)}var a=(e=e[0]).name+"."+t;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),u&&e.da.$a.push(t);var c=e.da.na,l=c[t];return void 0===l||void 0===l.ma&&l.className!==e.name&&l.va===n-2?(r.va=n-2,r.className=e.name,c[t]=r):(Fe(c,t,a),c[t].ma[n-2]=r),fe([],s,(function(r){return r=ze(a,r,e,i,o),void 0===c[t].ma?(r.va=n-2,c[t]=r):c[t].ma[n-2]=r,[]})),[]}))},m:function(e,t,n,r,a,i,o,u,s,c){t=me(t),a=Ye(r,a),fe([],[e],(function(e){var r=(e=e[0]).name+"."+t,l={get:function(){Ve("Cannot access "+r+" due to unbound types",[n,o])},enumerable:!0,configurable:!0};return l.set=s?()=>{Ve("Cannot access "+r+" due to unbound types",[n,o])}:()=>{ge(r+" is a read-only property")},Object.defineProperty(e.da.na,t,l),fe([],s?[n,o]:[n],(function(n){var o=n[0],l={get:function(){var t=$e(this,e,r+" getter");return o.fromWireType(a(i,t))},enumerable:!0};if(s){s=Ye(u,s);var f=n[1];l.set=function(t){var n=$e(this,e,r+" setter"),a=[];s(c,n,f.toWireType(a,t)),te(a)}}return Object.defineProperty(e.da.na,t,l),[]})),[]}))},J:function(e,t){ye(e,{name:t=me(t),fromWireType:function(e){var t=Xe(e);return Je(e),t},toWireType:function(e,t){return Ke(t)},argPackAdvance:8,readValueFromPointer:ne,ia:null})},M:function(e,t,n,r){function a(){}n=de(n),t=me(t),a.values={},ye(e,{name:t,constructor:a,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:Ze(t,n,r),ia:null}),Me(t,a)},n:function(e,t,n){var r=Qe(e,"enum");t=me(t),e=r.constructor,r=Object.create(r.constructor.prototype,{value:{value:n},constructor:{value:ue(r.name+"_"+t,(function(){}))}}),e.values[n]=r,e[t]=r},u:function(e,t,n){n=de(n),ye(e,{name:t=me(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:tt(t,n),ia:null})},i:function(e,t,n,r,a){t=me(t),-1===a&&(a=4294967295),a=de(n);var i=e=>e;if(0===r){var o=32-8*n;i=e=>e<<o>>>o}n=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t},ye(e,{name:t,fromWireType:i,toWireType:n,argPackAdvance:8,readValueFromPointer:nt(t,a,0!==r),ia:null})},g:function(e,t,n){function r(e){var t=P;return new a(A,t[1+(e>>=2)],t[e])}var a=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];ye(e,{name:n=me(n),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{Ya:!0})},v:function(e,t){var n="std::string"===(t=me(t));ye(e,{name:t,fromWireType:function(e){var t=P[e>>2];if(n)for(var r=e+4,a=0;a<=t;++a){var i=e+4+a;if(a==t||0==C[i]){if(r=r?y(C,r,i-r):"",void 0===o)var o=r;else o+=String.fromCharCode(0),o+=r;r=i+1}}else{for(o=Array(t),a=0;a<t;++a)o[a]=String.fromCharCode(C[e+4+a]);o=o.join("")}return wt(e),o},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ge("Cannot pass non-string to std::string");var a=(n&&r?()=>w(t):()=>t.length)(),i=bt(4+a+1);if(P[i>>2]=a,n&&r)b(t,C,i+4,a+1);else if(r)for(r=0;r<a;++r){var o=t.charCodeAt(r);255<o&&(wt(i),ge("String has UTF-16 code units that do not fit in 8 bits")),C[i+4+r]=o}else for(r=0;r<a;++r)C[i+4+r]=t[r];return null!==e&&e.push(wt,i),i},argPackAdvance:8,readValueFromPointer:ne,ia:function(e){wt(e)}})},q:function(e,t,n){if(n=me(n),2===t)var r=W,a=F,i=M,o=()=>_,u=1;else 4===t&&(r=j,a=R,i=N,o=()=>P,u=2);ye(e,{name:n,fromWireType:function(e){for(var n,a=P[e>>2],i=o(),s=e+4,c=0;c<=a;++c){var l=e+4+c*t;c!=a&&0!=i[l>>u]||(s=r(s,l-s),void 0===n?n=s:(n+=String.fromCharCode(0),n+=s),s=l+t)}return wt(e),n},toWireType:function(e,r){"string"!=typeof r&&ge("Cannot pass non-string to C++ string type "+n);var o=i(r),s=bt(4+o+t);return P[s>>2]=o>>u,a(r,s+4,o+t),null!==e&&e.push(wt,s),s},argPackAdvance:8,readValueFromPointer:ne,ia:function(e){wt(e)}})},O:function(e,t,n,r,a,i){ee[e]={name:me(t),sa:Ye(n,r),ja:Ye(a,i),elements:[]}},r:function(e,t,n,r,a,i,o,u,s){ee[e].elements.push({Ea:t,Ca:Ye(n,r),Da:a,Ia:i,Ha:Ye(o,u),Ja:s})},Q:function(e,t,n,r,a,i){he[e]={name:me(t),sa:Ye(n,r),ja:Ye(a,i),La:[]}},o:function(e,t,n,r,a,i,o,u,s,c){he[e].La.push({Ta:me(t),Ea:n,Ca:Ye(r,a),Da:i,Ia:o,Ha:Ye(u,s),Ja:c})},L:function(e,t){ye(e,{kb:!0,name:t=me(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},f:function(e,t,n){e=Xe(e),t=Qe(t,"emval::as");var r=[],a=Ke(r);return D[n>>2]=a,t.toWireType(r,e)},a:Je,d:function(e,t){return Ke((e=Xe(e))[t=Xe(t)])},x:function(e){4<e&&(qe[e].Ga+=1)},b:function(e){return"number"==typeof(e=Xe(e))},c:function(e){var t=at[e];return Ke(void 0===t?me(e):t)},e:function(e){te(Xe(e)),Je(e)},y:function(e,t){return Ke(e=(e=Qe(e,"_emval_take_value")).readValueFromPointer(t))},h:function(){$("")},G:function(e,t){if(0===e)e=Date.now();else{if(1!==e&&4!==e)return D[Ct()>>2]=28,-1;e=rt()}return D[t>>2]=e/1e3|0,D[t+4>>2]=e%1e3*1e6|0,0},I:function(e,t,n){C.copyWithin(e,t,t+n)},p:function(e){var t=C.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var a=Math;r=Math.max(e,r),a=a.min.call(a,2147483648,r+(65536-r%65536)%65536);e:{try{m.grow(a-A.byteLength+65535>>>16),I();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1},D:function(e,t){var n=0;return ot().forEach((function(r,a){var i=t+n;for(a=D[e+4*a>>2]=i,i=0;i<r.length;++i)T[a++>>0]=r.charCodeAt(i);T[a>>0]=0,n+=r.length+1})),0},E:function(e,t){var n=ot();D[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),D[t>>2]=r,0},H:function(){return 0},F:function(e,t,n,r){return e=ct.jb(e),t=ct.hb(e,t,n),D[r>>2]=t,0},z:function(){},s:function(e,t,n,r){for(var a=0,i=0;i<n;i++){var o=D[t>>2],u=D[t+4>>2];t+=8;for(var s=0;s<u;s++){var c=C[o+s],l=st[e];0===c||10===c?((1===e?d:p)(y(l,0)),l.length=0):l.push(c)}a+=u}return D[r>>2]=a,0},B:function(){},C:function(e,t,n,r){return mt(e,t,n,r)}};!function(){function e(e){t.asm=e.exports,m=t.asm.R,I(),U=t.asm.V,Y.unshift(t.asm.S),L--,t.monitorRunDependencies&&t.monitorRunDependencies(L),0==L&&z&&(e=z,z=null,e())}function n(t){e(t.instance)}function r(e){return(h||!s&&!c||"function"!=typeof fetch?Promise.resolve().then((function(){return J()})):fetch(V,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+V+"'";return e.arrayBuffer()})).catch((function(){return J()}))).then((function(e){return WebAssembly.instantiate(e,i)})).then((function(e){return e})).then(e,(function(e){p("failed to asynchronously prepare wasm: "+e),$(e)}))}var i={a:yt};if(L++,t.monitorRunDependencies&&t.monitorRunDependencies(L),t.instantiateWasm)try{return t.instantiateWasm(i,e)}catch(e){return p("Module.instantiateWasm callback failed with error: "+e),!1}(h||"function"!=typeof WebAssembly.instantiateStreaming||G()||"function"!=typeof fetch?r(n):fetch(V,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,i).then(n,(function(e){return p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(a)}(),t.___wasm_call_ctors=function(){return(t.___wasm_call_ctors=t.asm.S).apply(null,arguments)};var bt=t._malloc=function(){return(bt=t._malloc=t.asm.T).apply(null,arguments)},wt=t._free=function(){return(wt=t._free=t.asm.U).apply(null,arguments)},At=t.___getTypeName=function(){return(At=t.___getTypeName=t.asm.W).apply(null,arguments)};t.___embind_register_native_and_builtin_types=function(){return(t.___embind_register_native_and_builtin_types=t.asm.X).apply(null,arguments)};var Tt,Ct=t.___errno_location=function(){return(Ct=t.___errno_location=t.asm.Y).apply(null,arguments)};function kt(){function e(){if(!Tt&&(Tt=!0,t.calledRun=!0,!v)){if(X(Y),r(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;){var e=t.postRun.shift();x.unshift(e)}X(x)}}if(!(0<L)){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)H();X(B),0<L||(t.setStatus?(t.setStatus("Running..."),setTimeout((function(){setTimeout((function(){t.setStatus("")}),1),e()}),1)):e())}}if(t.dynCall_jiji=function(){return(t.dynCall_jiji=t.asm.Z).apply(null,arguments)},t.dynCall_viijii=function(){return(t.dynCall_viijii=t.asm._).apply(null,arguments)},t.dynCall_iiiiij=function(){return(t.dynCall_iiiiij=t.asm.$).apply(null,arguments)},t.dynCall_iiiiijj=function(){return(t.dynCall_iiiiijj=t.asm.aa).apply(null,arguments)},t.dynCall_iiiiiijj=function(){return(t.dynCall_iiiiiijj=t.asm.ba).apply(null,arguments)},z=function e(){Tt||kt(),Tt||(z=e)},t.run=kt,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();return kt(),e.ready});e.exports=r,"function"==typeof AudioWorkletGlobalScope&&(globalThis.createAudioEngine=r)}(e);var t=e.exports;const n=30,r=3,a=2;function i(e){const t=new Int16Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.round(Math.max(-32768,Math.min(32767,32768*e[n])));return t}class o extends AudioWorkletProcessor{constructor(){super(),this.enabled=!1,this.frameCount=0,this.bufferTime=n,this.dumpBundleNums=r,this.threshold=a,this.isDumping=!1,this.dumpBundleNumCount=0,this.dumpBundleFrameCount=0,this.port.onmessage=this.handleMessageEvent.bind(this)}process(e,t){const[[n]]=e;if(!n)return!0;const[[r]]=t;if(this.enabled&&this.buffer&&this.kernel)try{const e=this.buffer;e.getChannelData(0).set(n);const t=this.kernel.process(e,e);r.set(e.getChannelData(0)),t!==this.lastStatus&&(this.onStatusChange(t),this.lastStatus=t),this.isDumping&&(this.dumpBundleFrameCount+=r.length,this.dumpBundleFrameCount>=this.bufferTime*sampleRate&&(this.dumpBundleFrameCount=0,this.dump())),this.frameCount+=r.length;const a=sampleRate/2;for(;this.frameCount>=a;)this.uploadStats(),this.frameCount-=a}catch(e){r.set(n),this.log("error",\`[ai-denoiser-worklet] detect error from wasm: \${e}\`)}else r.set(n);return!0}log(e,t){this.port.postMessage({event:"log",level:e,message:t})}getValue(){var e;const t=this.enabled?null===(e=this.kernel)||void 0===e?void 0:e.value:1;this.port.postMessage({event:"getValue",value:t})}getLevel(){var e;const t=this.enabled?null===(e=this.kernel)||void 0===e?void 0:e.level:1;this.port.postMessage({event:"getLevel",level:t})}enable(){this.enabled||(this.enabled=!0,this.log("debug","[ai-denoiser-worklet] denoiser was enabled")),this.port.postMessage({event:"enable"})}disable(){this.enabled&&(this.enabled=!1,this.isDumping&&(this.dump(),this.endDump()),this.reset(),this.log("debug","[ai-denoiser-worklet] denoiser was disabled")),this.port.postMessage({event:"disable"})}startDump(){this.isDumping?this.log("debug","[ai-denoiser-worklet] dump has already started"):(this.isDumping=!0,this.dumpBundleNumCount=0,this.dumpBundleFrameCount=0,this.dump(),this.log("debug","[ai-denoiser-worklet] dump started"))}dump(){if(this.kernel){const e=this.kernel.dump(this.bufferTime),t=new Float32Array(e[0].numberOfFrames),n=new Float32Array(e[1].numberOfFrames),r=new Float32Array(e[2].numberOfFrames);t.set(e[0].getChannelData(0)),n.set(e[1].getChannelData(0)),r.set(e[2].getChannelData(0)),e[0].delete(),e[1].delete(),e[2].delete();const a=i(t),o=i(n),u=i(r);this.log("debug",\`[ai-denoiser-worklet] dump: input \${a.length*Int16Array.BYTES_PER_ELEMENT} bytes, nsOut \${o.length*Int16Array.BYTES_PER_ELEMENT} bytes, agcOut \${u.length*Int16Array.BYTES_PER_ELEMENT} bytes\`),this.port.postMessage({event:"dump",dump:{input:a,nsOut:o,agcOut:u},lts:Date.now()},[a.buffer,o.buffer,u.buffer]),this.dumpBundleNumCount+=1,this.dumpBundleNumCount>=this.dumpBundleNums&&this.endDump()}}endDump(){this.isDumping?(this.isDumping=!1,this.log("debug","[ai-denoiser-worklet] dump ended")):this.log("debug","[ai-denoiser-worklet] dump has already ended"),this.port.postMessage({evnet:"dumpend"})}setParameters(e){this.kernel&&(this.kernel.setNsParams(e),this.log("debug",\`[ai-denoiser-worklet] set ns params \${JSON.stringify(e)}\`)),this.port.postMessage({event:"setParameters"})}setAgcParameters(e){this.kernel&&(this.kernel.setAgcParams(e),this.log("debug",\`[ai-denoiser-worklet] set agc params \${JSON.stringify(e)}\`)),this.port.postMessage({event:"setAgcParameters"})}initialize(e,n,r,a,i,o){t({wasmBinary:e}).then((e=>{this.module=e,this.buffer=new e.AudioBuffer(1,128),this.kernel=new e.AudioDenoiser(sampleRate,n,r,a),this.lastStatus=e.AudioDenoiserStatus.UNCERTAIN,this.bufferTime=a,this.dumpBundleNums=i,this.threshold=o,this.log("debug",\`[ai-denoiser-worklet] kernel version: \${this.kernel.version}-\${this.kernel.buildInfo}, options: {sampleRate: \${sampleRate}, enabled: \${n}, agc: \${r}, bufferTime: \${a}, dumpBundleNums: \${i}, threshold: \${o}}\`),this.port.postMessage({event:"initialize"})})).catch((e=>{this.port.postMessage({event:"initialize",error:e})}))}reset(){var e,t;null===(e=this.kernel)||void 0===e||e.reset(),this.lastStatus=null===(t=this.module)||void 0===t?void 0:t.AudioDenoiserStatus.UNCERTAIN}destroy(){var e,t;this.module=void 0,null===(e=this.buffer)||void 0===e||e.delete(),this.buffer=void 0,null===(t=this.kernel)||void 0===t||t.delete(),this.kernel=void 0,this.lastStatus=void 0,this.log("debug","[ai-denoiser-worklet] denoiser was destroyed"),this.port.postMessage({event:"destroy"})}uploadStats(){if(!this.kernel)return;const e=this.kernel.getStats();this.port.postMessage({event:"stats",stats:{ebn:e.energy_bf_ns,ean:e.energy_af_ns,ns:e.ns_state,vl:e.vad_loss}}),this.threshold>0&&e.elapsed_time>this.threshold&&this.port.postMessage({event:"overload",elpasedTime:e.elapsed_time})}onStatusChange(e){var t;let n="UNKNOWN",r="debug";const a=null===(t=this.module)||void 0===t?void 0:t.AudioDenoiserStatus;a&&(e===a.UNCERTAIN?n="UNCERTAIN":e===a.NORMAL?n="NORMAL":e===a.DANGLY?n="DANGLY":e===a.STRONGBAD?(n="STRONGBAD",r="warning"):e===a.NOINPUT?(n="NOINPUT",r="warning"):e===a.NOOUTPUT&&(n="NOOUTPUT",r="warning")),this.log(r,\`[ai-denoiser-worklet] kernel status changed to \${n}\`)}handleMessageEvent(e){const t=e.data,n=t.event;"getValue"===n?this.getValue():"getLevel"===n?this.getLevel():"enable"===n?this.enable():"disable"===n?this.disable():"dump"===n?this.startDump():"setParameters"===n?this.setParameters(t.parameters):"setAgcParameters"===n?this.setAgcParameters(t.agcParameters):"initialize"===n?this.initialize(t.wasmSource,t.enabled,t.agc,t.bufferTime,t.dumpBundleNums,t.threshold):"destroy"===n&&this.destroy()}}registerProcessor("ai-denoiser-worklet-processor",o)}();
`],{type:"text/javascript"}),d=URL.createObjectURL(u);yield t.audioWorklet.addModule(d),setTimeout(()=>URL.revokeObjectURL(d),0),Ls.registeredContexts.add(t),t.addEventListener("statechange",function h(){t.state==="closed"&&(Ls.registeredContexts.delete(t),t.removeEventListener("statechange",h))})}const l=new Ls(t,c);return yield l.initialize(r,n,i,o,a,s),l})}get node(){return this.workletNode}getValue(){return Gi(this,void 0,void 0,function*(){return(yield this.requestResponse({event:"getValue"})).value})}getLevel(){return Gi(this,void 0,void 0,function*(){return(yield this.requestResponse({event:"getLevel"})).level})}enable(){return this.requestResponse({event:"enable"})}disable(){return this.requestResponse({event:"disable"})}dump(){this.workletNode.port.postMessage({event:"dump"})}setParameters(t){return this.requestResponse({event:"setParameters",parameters:t})}setAgcParameters(t){return this.requestResponse({event:"setAgcParameters",agcParameters:t})}initialize(t,r,n,i,o,a){return this.requestResponse({event:"initialize",wasmSource:t,enabled:r,agc:n,bufferTime:i,dumpBundleNums:o,threshold:a})}destroy(){return this.requestResponse({event:"destroy"})}handleMessageEvent(t){const r=t.data,n=r.event;n==="stats"?this.dispatchEvent(new CustomEvent("stats",{detail:{stats:r.stats}})):n==="log"?Nt.exports.logger[r.level](r.message):n==="overload"?this.dispatchEvent(new CustomEvent("overload",{detail:{elapsedTime:r.elapsedTime}})):n==="dump"?this.dispatchEvent(new CustomEvent("dump",{detail:{dump:r.dump,lts:r.lts}})):n==="dumpend"&&this.dispatchEvent(new CustomEvent("dumpend"))}requestResponse(t,r=[]){return new Promise((n,i)=>{const o=this.workletNode.port;o.addEventListener("message",function a(s){s.data.event===t.event&&(o.removeEventListener("message",a),s.data.error?i(s.data.error):n(s.data))}),o.postMessage(t,r),o.start()})}}Ls.registeredContexts=new Set;class YZ extends Nt.exports.AudioProcessor{constructor(t){var r,n;super(),this.name="AIDenoiserProcessor",this.wasmSource=t.wasmSource,this.statsCount=0,this._enabled=((n=(r=sn.parameters)===null||r===void 0?void 0:r.AI_DENOISER_PARAMETERS)===null||n===void 0?void 0:n.enabled)===!0,this.on("dump",(i,o)=>{var a;return(a=this.ondump)===null||a===void 0?void 0:a.call(this,i,o)}),this.on("dumpend",()=>{var i;return(i=this.ondumpend)===null||i===void 0?void 0:i.call(this)}),this.on("overload",i=>{var o;return(o=this.onoverload)===null||o===void 0?void 0:o.call(this,i)}),Nt.exports.logger.debug(`[ai-denoiser-processor] construct denoiser processor, enabled: ${this.enabled}`),Nt.exports.reporter.reportApiInvoke({name:`${this.name}.constructor`,options:[]}).onSuccess()}dump(){const t=Nt.exports.reporter.reportApiInvoke({name:`${this.name}.dump`,options:[]});if(!this.workletHandler){const r=new Error("processor is not piped");throw t.onError(r),r}this.workletHandler.then(r=>{r.dump(),t.onSuccess()}).catch(r=>{Nt.exports.logger.error(`[ai-denoiser-processor] failed to dump: ${r}`),t.onError(r)})}setMode(t){return Gi(this,void 0,void 0,function*(){const r=Nt.exports.reporter.reportApiInvoke({name:`${this.name}.setMode`,options:[t]});try{if(!this.workletHandler)throw new Error("processor is not piped");const n=yield this.workletHandler;if(t===wm.STATIONARY_NS)yield n.setParameters(WZ);else{if(t!==wm.NSNG)throw Nt.exports.logger.error(`[ai-denoiser-processor] unknown mode: ${t}`),new Error(`unknown mode: ${t}`);yield n.setParameters(HZ)}r.onSuccess()}catch(n){throw r.onError(n),n}})}setLevel(t){return Gi(this,void 0,void 0,function*(){const r=Nt.exports.reporter.reportApiInvoke({name:`${this.name}.setLevel`,options:[t]});try{if(!this.workletHandler)throw new Error("processor is not piped");const n=yield this.workletHandler;if(t===Am.SOFT)yield n.setParameters(KZ);else{if(t!==Am.AGGRESSIVE)throw Nt.exports.logger.error(`[ai-denoiser-processor] unknown level: ${t}`),new Error(`unknown level: ${t}`);yield n.setParameters(zZ)}r.onSuccess()}catch(n){throw r.onError(n),n}})}setNsParams(t){return Gi(this,void 0,void 0,function*(){const r=Nt.exports.reporter.reportApiInvoke({name:`${this.name}.setNsParams`,options:[t]});try{if(!this.workletHandler)throw new Error("processor is not piped");yield(yield this.workletHandler).setParameters(t),r.onSuccess()}catch(n){throw r.onError(n),n}})}setAgcParams(t){return Gi(this,void 0,void 0,function*(){const r=Nt.exports.reporter.reportApiInvoke({name:`${this.name}.setAgcParams`,options:[t]});try{if(!this.workletHandler)throw new Error("processor is not piped");yield(yield this.workletHandler).setAgcParameters(t),r.onSuccess()}catch(n){throw r.onError(n),n}})}onEnableChange(){var t,r,n,i;return Gi(this,void 0,void 0,function*(){this.enabled?(!((t=sn.parameters)===null||t===void 0)&&t.ADJUST_3A_FROM_PLUGINS&&(yield(r=this.context)===null||r===void 0?void 0:r.requestApplyConstraints(ek,this)),this.workletHandler&&(yield(yield this.workletHandler).enable(),Nt.exports.logger.debug("[ai-denoiser-processor] denoiser node enabled"))):(!((n=sn.parameters)===null||n===void 0)&&n.ADJUST_3A_FROM_PLUGINS&&(yield(i=this.context)===null||i===void 0?void 0:i.requestRevertConstraints(this)),this.workletHandler&&(yield(yield this.workletHandler).disable(),Nt.exports.logger.debug("[ai-denoiser-processor] denoiser node disabled")))})}onPiped(t){if(typeof t.getDirection!="function")throw new Error("does not support sdk <4.15.0");this.workletHandler||(this.workletHandler=this.wasmSource.then(r=>{var n,i;Nt.exports.logger.debug(`[ai-denoiser-processor] denosier node init ${JSON.stringify((n=sn.parameters)===null||n===void 0?void 0:n.AI_DENOISER_PARAMETERS)}`);const o=Object.assign(Object.assign({},GZ),(i=sn.parameters)===null||i===void 0?void 0:i.AI_DENOISER_PARAMETERS);return Ls.create(t.getAudioContext(),r,o.ains,o.agc,o.bufferTime,o.dumpBundleNums,o.threshold)}).then(r=>this.setup(r))),this.workletHandler=this.workletHandler.then(r=>{var n,i,o,a;this.enabled&&(!((n=sn.parameters)===null||n===void 0)&&n.ADJUST_3A_FROM_PLUGINS)&&t.requestApplyConstraints(ek,this),t.registerStats(this,"denoiser_stats",()=>{const u=this.stats;return this.stats=void 0,u});const s=t.getDirection(),c=(a=(o=(i=sn.parameters)===null||i===void 0?void 0:i.AI_DENOISER_PARAMETERS)===null||o===void 0?void 0:o.excludedLinks)!==null&&a!==void 0?a:tk,l=s==="remote"?"ainsV2Downlink":"ainsV2";return c.includes(s)||t.registerUsage(this,()=>Gi(this,void 0,void 0,function*(){const u=yield r.getValue(),d=yield r.getLevel();return{id:l,level:d??1,value:u??1}})),r})}onUnpiped(){var t,r,n,i;if(this.context){const o=this.context;this.enabled&&(!((t=sn.parameters)===null||t===void 0)&&t.ADJUST_3A_FROM_PLUGINS)&&o.requestRevertConstraints(this),o.unregisterStats(this,"denoiser_stats");const a=(i=(n=(r=sn.parameters)===null||r===void 0?void 0:r.AI_DENOISER_PARAMETERS)===null||n===void 0?void 0:n.excludedLinks)!==null&&i!==void 0?i:tk,s=o.getDirection();a.includes(s)||o.unregisterUsage(this)}}onNode(t,r){var n;(n=this.workletHandler)===null||n===void 0||n.then(i=>{var o;const a=i.node;try{(o=this.lastInputNode)===null||o===void 0||o.disconnect(a)}catch{}t.connect(a),this.lastInputNode=t,this.output(a,r),Nt.exports.logger.debug("[ai-denoiser-processor] connected worklet node"),a.onprocessorerror=s=>{Nt.exports.logger.error(`[ai-denoiser-processor] detected error from worklet node: ${s.error}`),this.output(t,r)}}).catch(i=>{Nt.exports.logger.error(`[ai-denoiser-processor] failed to pipe: ${i}`),this.emitAsPromiseNoResponse("loaderror",i),this.output(t,r)})}handleStatsEvent(t){const r=t.detail.stats;(++this.statsCount>=4||!this.stats)&&(this.statsCount=0,this.stats={ebn:0,ean:0,ns:0,vl:0}),r.ebn&&(this.stats.ebn=this.stats.ebn<<8&4294967295|255&r.ebn),r.ean&&(this.stats.ean=this.stats.ean<<8&4294967295|255&r.ean),r.ns&&(this.stats.ns=this.stats.ns<<8&4294967295|255&r.ns),r.vl&&(this.stats.vl=this.stats.vl<<8&4294967295|255&r.vl)}handleDump(t,r){const n=new Blob([t],{type:"audio/pcm"});this.emitAsPromiseNoResponse("dump",n,r)}handleDumpEvent(t){var r,n,i;const o=t.detail,a=o.dump,s=o.lts;!((r=a.input)===null||r===void 0)&&r.length&&this.handleDump(a.input,`input_16000hz_1ch_${s}.pcm`),!((n=a.nsOut)===null||n===void 0)&&n.length&&this.handleDump(a.nsOut,`ns_out_16000hz_1ch_${s}.pcm`),!((i=a.agcOut)===null||i===void 0)&&i.length&&this.handleDump(a.agcOut,`agc_out_16000hz_1ch_${s}.pcm`)}handleOverloadEvent(t){const r=t.detail.elapsedTime;Nt.exports.logger.warning(`[ai-denoiser-processor] denoiser overload, elapsed time: ${r}ms`),this.emitAsPromiseNoResponse("overload",r)}setup(t){var r;return Gi(this,void 0,void 0,function*(){return t.addEventListener("stats",this.handleStatsEvent.bind(this)),t.addEventListener("dump",this.handleDumpEvent.bind(this)),t.addEventListener("dumpend",()=>this.emitAsPromiseNoResponse("dumpend")),t.addEventListener("overload",this.handleOverloadEvent.bind(this)),this.enabled?(yield t.enable(),Nt.exports.logger.debug("[ai-denoiser-processor] denoiser node enabled")):(yield t.disable(),Nt.exports.logger.debug("[ai-denoiser-processor] denoiser node disabled")),!((r=sn.parameters)===null||r===void 0)&&r.AI_DENOISER_PARAMETERS&&(sn.parameters.AI_DENOISER_PARAMETERS.nsParameters&&(yield t.setParameters(sn.parameters.AI_DENOISER_PARAMETERS.nsParameters)),sn.parameters.AI_DENOISER_PARAMETERS.agcParameters&&(yield t.setAgcParameters(sn.parameters.AI_DENOISER_PARAMETERS.agcParameters))),Nt.exports.logger.debug("[ai-denoiser-processor] denoiser node initialized"),t})}}function $Z(e){return Gi(this,void 0,void 0,function*(){const t=yield(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))(),r=`${e}/${t?"denoiser-wasm-simd.wasm":"denoiser-wasm.wasm"}`,n=yield fetch(r);if(!n.ok)throw new Error(`failed to load WASM, response status: ${n.status}`);return n})}class qZ extends Nt.exports.AudioExtension{constructor(t){super(),this.parameters=jZ,this.VERSION="1.1.0",this.BUILD="9019a23(11/10/2022, 5:31:24 PM)",this.wasmSource=$Z(t.assetsPath).then(r=>r.arrayBuffer()),sn.parameters=this.parameters,Nt.exports.logger.debug(`[ai-denoiser-extension] ${this.VERSION}, ${this.BUILD} constructor ${JSON.stringify(t)}`),Nt.exports.reporter.reportApiInvoke({name:"AIDenoiserExtension.constructor",options:[`${this.VERSION}_${this.BUILD}`]}).onSuccess()}checkCompatibility(){try{const t=KF()&&!!globalThis.WebAssembly&&!!globalThis.WebAssembly.compile;return Nt.exports.logger.debug(`[ai-denoiser-extension] supported AudioWorklet and WASM: ${t}`),t}catch{return!1}}_createProcessor(){Nt.exports.logger.debug("[ai-denoiser-extension] start create processor");const t=new YZ({wasmSource:this.wasmSource});return t.on("loaderror",r=>{var n;return(n=this.onloaderror)===null||n===void 0?void 0:n.call(this,r)}),t}}function XZ(e){const t=e;return t.sort((r,n)=>(r.hasVideo?1:0)-(n.hasVideo?1:0)),t}const JZ=e=>{const r=e.client.uid,{channelName:n}=ZB(),[i,o]=Q.useState(!0),[a,s]=Q.useState(!1),[c,l]=Q.useState(!1),{localMicrophoneTrack:u}=bZ(a),{screenTrack:d}=PZ(c,{encoderConfig:"1080p_1",optimizationMode:"detail"},"disable"),h=new qZ({assetsPath:"./external"});HF.registerExtensions([h]);const p=h.createProcessor();p.enable(),p.on("overload",()=>{p.disable()}),u&&(u.pipe(p),u.pipe(u.processorDestination));const m=CM();wZ({appid:e.appId,channel:n,token:null},i),AZ([u,d]);const f=NZ(),{audioTracks:_}=OZ(f);_.forEach(A=>{A.play()}),a?u==null||u.setMuted(!1):u==null||u.setMuted(!0);const[E,g]=Q.useState(!1),[T,R]=Q.useState(f[0]),w=A=>{R(A),g(!E)};return fe.jsxs("div",{className:"container",children:[fe.jsxs("div",{className:"navbar",children:[fe.jsx("h2",{children:"ZeroFK"}),fe.jsxs("div",{className:"navbarData",style:{display:"flex"},children:[fe.jsx("div",{children:`Lobby: ${n} `}),fe.jsx("div",{style:{color:"transparent"},children:"----"}),fe.jsx("div",{children:`User ID: ${r} `})]})]}),E?fe.jsxs("div",{style:{display:"flex"},children:[fe.jsx("div",{className:"backBTN",onClick:()=>g(!1),children:"Back"}),fe.jsxs("div",{className:"remote-modal-container",children:[fe.jsx("div",{id:`user-${T.uid}`,className:"remote-video-modal",children:fe.jsx(QD,{user:T})},T.uid),fe.jsx("div",{id:"userUID",children:fe.jsx("div",{className:"text-user",children:T.uid})})]})]}):fe.jsxs(fe.Fragment,{children:[fe.jsx("div",{id:"remoteVideoGrid",children:XZ(f).reverse().map(A=>fe.jsxs("div",{children:[fe.jsx("div",{id:`user-${A.uid}`,className:"remote-video-container",onClick:()=>{w(A)},children:fe.jsx(QD,{user:A})},A.uid),fe.jsx("div",{id:"userUID",children:fe.jsx("div",{className:"text-user",children:A.uid})})]}))}),fe.jsx("div",{children:fe.jsxs("div",{id:"localVideo",children:[fe.jsx(UZ,{videoTrack:d,cameraOn:c,micOn:a,playAudio:a,playVideo:c,className:""}),fe.jsx("div",{children:fe.jsx("div",{id:"controlsToolbar",children:fe.jsxs("div",{id:"mediaControls",children:[fe.jsx("button",{className:a?"buttonOn":"buttonOff",onClick:()=>s(A=>!A),children:"Micro"}),fe.jsx("button",{className:c?"buttonOn":"buttonOff",onClick:()=>l(A=>!A),children:"Share screen"}),fe.jsx("button",{id:"endConnection",onClick:()=>{l(!1),o(!1),m("/zerofk")},children:" Disconnect"})]})})})]})})]})]})};function QZ(){const e=CM(),t=oc(HF.createClient({codec:"av1",mode:"rtc"})),[r,n]=Q.useState(""),i=(o,a)=>{n(a),e(`/via/${o}`)};return fe.jsxs(p4,{children:[fe.jsx(RS,{path:"/",element:fe.jsx(g4,{connectToVideo:i})}),fe.jsx(RS,{path:"/via/:channelName",element:fe.jsx(CZ,{client:t,children:fe.jsx(JZ,{client:t,appId:r})})})]})}Ov.createRoot(document.getElementById("root")).render(fe.jsx(hk.StrictMode,{children:fe.jsx(_4,{children:fe.jsx(QZ,{})})}));
